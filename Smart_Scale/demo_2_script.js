[{"id":"b686905e.e5876","type":"tab","label":"Scripts for device Main "},{"id":"1ae68ce0.e5e003","type":"tab","label":"Main"},{"id":"7e40a951.76a278","type":"tab","label":"processing_scale"},{"id":"e9f10ed.2f840f","type":"tab","label":"Scripts for Send Serial and IP"},{"id":"a4671a65.4f14b8","type":"tab","label":"Flow 1"},{"id":"48b81a90.8639d4","type":"subflow","name":"ETTN","info":"","in":[],"out":[]},{"id":"b4644ffa.83a58","type":"subflow","name":"Subflow 1","info":"","in":[],"out":[]},{"id":"4caad361.a145cc","type":"subflow","name":"ETTN (2)","info":"","in":[],"out":[]},{"id":"3431fd9a.ca08e2","type":"subflow","name":"Subflow 1 (2)","info":"","in":[],"out":[]},{"id":"5fa1e64f.1647f8","type":"subflow","name":"Subflow 1 (3)","info":"","in":[],"out":[]},{"id":"c591f95c.3e1ca8","type":"ui_tab","z":"","name":"Smart Scales","icon":"dashboard"},{"id":"a4c3407e.41614","type":"ui_base","name":"Scale dasboard","theme":"theme-dark"},{"id":"359baf79.3daa","type":"socket-io-event","z":"","addr":"getWeight"},{"id":"1b257f1d.bd5401","type":"ui_base","name":"Scale dasboard","theme":"theme-light"},{"id":"a5c8dc6c.5eb02","type":"socket-io-server","z":"","port":"4003"},{"id":"a95c0781.59d588","type":"ui_group","z":"","name":"Шлагбаум 2","tab":"10e375d2.a920aa","order":6,"disp":true,"width":"9"},{"id":"30ef9a79.c5a046","type":"ui_group","z":"","name":"Графік ваги","tab":"1b2b903.c67817","disp":true,"width":"6"},{"id":"b0397653.651578","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"1b2b903.c67817","type":"ui_tab","z":"","name":"Smart Scales","icon":"dashboard"},{"id":"10e375d2.a920aa","type":"ui_tab","z":"","name":"Device","icon":"dashboard"},{"id":"b3259c0f.1d2d3","type":"ui_group","z":"","name":"Світлофор 2","tab":"10e375d2.a920aa","order":2,"disp":true,"width":"4"},{"id":"92261734.263388","type":"ui_group","z":"","name":"Світлофор 3","tab":"10e375d2.a920aa","order":3,"disp":true,"width":"6"},{"id":"6f959189.21a6a","type":"ui_group","z":"","name":"Світлофор 1","tab":"10e375d2.a920aa","order":1,"disp":true,"width":"4"},{"id":"34456d59.5e5232","type":"ui_group","z":"","name":"Шлагбаум 1","tab":"10e375d2.a920aa","order":5,"disp":true,"width":"10"},{"id":"63e69f50.b9e34","type":"ui_group","z":"","name":"Інформаційне Табло","tab":"10e375d2.a920aa","order":4,"disp":true,"width":"6"},{"id":"40c1c2c2.48da6c","type":"comment","z":"b686905e.e5876","name":"INITIALIZING","info":"","x":90,"y":20,"wires":[]},{"id":"8f3b68e8.f25198","type":"link out","z":"b686905e.e5876","name":"","links":["18e7d347.653bed","13fa0fce.4d239","5c770ccd.1ac3b4","919c582.0f22da8"],"x":379,"y":301,"wires":[]},{"id":"468e9f9.de9286","type":"inject","z":"b686905e.e5876","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":109,"y":419,"wires":[["ab85d147.0f752"]]},{"id":"ab85d147.0f752","type":"exec","z":"b686905e.e5876","command":"ls /dev","addpay":false,"append":"","useSpawn":"","timer":"","name":"","x":242,"y":413.5,"wires":[["2a9ccd0b.b8a802"],[],[]]},{"id":"2a9ccd0b.b8a802","type":"debug","z":"b686905e.e5876","name":"","active":false,"console":"false","complete":"false","x":397,"y":403,"wires":[]},{"id":"f7cea8ed.b81998","type":"comment","z":"b686905e.e5876","name":"ttyACM1 ttyACM0 ttyUSB0 usb девайси","info":"","x":276,"y":361,"wires":[]},{"id":"6541fbdb.025534","type":"inject","z":"b686905e.e5876","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":195,"y":1497,"wires":[["605e19d9.56d578"]]},{"id":"605e19d9.56d578","type":"function","z":"b686905e.e5876","name":"VP01-m C 1.0.28.1","func":"//msg.payload = String.fromCharCode(2)+String.fromCharCode(65)+String.fromCharCode(66)+String.fromCharCode(0)+String.fromCharCode(4)+String.fromCharCode(3); \nmsg.payload = String.fromCharCode(2)+String.fromCharCode(41)+String.fromCharCode(42)+String.fromCharCode(30)+String.fromCharCode(33)+String.fromCharCode(3); \n//#02#41#42#30#33#03\nBuffer.from(\"02 41 42 30 33 03\", \"hex\")\n/*\nString.fromCharCode(2)+String.fromCharCode(65)+String.fromCharCode(66)+String.fromCharCode(48)+String.fromCharCode(51)+String.fromCharCode(3); \n\n0: 2\n1: 65\n2: 66\n3: 48\n4: 51\n5: 3\n*/\n\nreturn msg","outputs":1,"noerr":0,"x":369,"y":1498,"wires":[["5f9b54b5.a9ccec"]]},{"id":"5f9b54b5.a9ccec","type":"debug","z":"b686905e.e5876","name":"","active":true,"console":"false","complete":"false","x":555,"y":1498,"wires":[]},{"id":"409fb76f.21e358","type":"function","z":"1ae68ce0.e5e003","name":"GET WEIGHT","func":"var payload = msg.payload;\nvar parser = flow.get('parser');\nvar currentWeight = parser(payload);\n\nflow.set('currentWeight',currentWeight);\n\nmsg.payload = currentWeight;\n\nreturn msg;","outputs":1,"noerr":0,"x":299,"y":158,"wires":[["75895482.ee04bc"]]},{"id":"f7e27164.78c1c","type":"inject","z":"1ae68ce0.e5e003","name":"init","topic":"","payload":"init","payloadType":"str","repeat":"","crontab":"","once":true,"x":127.99999618530273,"y":100.99999809265137,"wires":[["bc1ceb86.f97148"]]},{"id":"88a46280.2b5b8","type":"comment","z":"1ae68ce0.e5e003","name":"INITIALIZING","info":"","x":147.99999618530273,"y":60.99999809265137,"wires":[]},{"id":"bc1ceb86.f97148","type":"function","z":"1ae68ce0.e5e003","name":"Модель весов","func":"flow.set('inputString',\"CMD\");\nflow.set('parser',function(v){\n            \n        //v = v.replace('S','');\n        //v = v.replace('D','');\n        //v = v.replace('kg','');\n        return Number(v);\n        \n        }\n    );\nglobal.set('scale_id_in','');\nglobal.set('ip','192.168.0.102');\nglobal.set('video_camera_url_1','http://admin:admin333@192.168.104.58/ISAPI/Streaming/channels/101/picture?snapShotImageType=JPEG');\n   \nreturn msg;","outputs":1,"noerr":0,"x":338,"y":100.4285659790039,"wires":[[]]},{"id":"75895482.ee04bc","type":"link out","z":"1ae68ce0.e5e003","name":"s3","links":["b1100106.fb387","2c53da3f.f1a3f6","1457cbdc.a15a84"],"x":541.7142333984375,"y":155,"wires":[]},{"id":"919c582.0f22da8","type":"link in","z":"1ae68ce0.e5e003","name":"","links":["8f3b68e8.f25198"],"x":126,"y":158.14285278320312,"wires":[["409fb76f.21e358"]]},{"id":"8d327709.3f2338","type":"file","z":"7e40a951.76a278","name":"deivce_config","filename":"deivce_config.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":426,"y":184,"wires":[]},{"id":"43c7a19e.2c524","type":"exec","z":"7e40a951.76a278","command":"cat /proc/cpuinfo","addpay":true,"append":"| grep Serial","useSpawn":"","timer":"5","name":"","x":396,"y":64,"wires":[["e7c31445.c4fe48","268b3abe.7e9ef6"],[],[]]},{"id":"cf249c03.d3375","type":"function","z":"7e40a951.76a278","name":"main config","func":"flow.set('prevWeight',null);\nflow.set('transaction',null);\nflow.set('transactionData',[]);\nflow.set('transactionMaxWeight',null);\nflow.set('transactionHasMinWeight',null);\nflow.set('transactionHasMaxWeight',null);\nflow.set('transactionHasMaxDuration',null);\nflow.set('lasttimedata', new Date());\nflow.set('checkHealth',null);\nflow.set('transactionWaybill',null);\nflow.set('transactionAccWeight', null);\nflow.set('transactionHasOverLoad', null);\nreturn msg;\n","outputs":1,"noerr":0,"x":408.85713958740234,"y":299.7142810821533,"wires":[[]]},{"id":"b00efe7a.2afc4","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":118.28571319580078,"y":316,"wires":[["5a8f91ac.1655f","cf249c03.d3375"]]},{"id":"3f395a80.e6d526","type":"http in","z":"7e40a951.76a278","name":"","url":"/firmware_4","method":"post","swaggerDoc":"","x":154.00000762939453,"y":193.5714340209961,"wires":[["8d327709.3f2338"]]},{"id":"5a8f91ac.1655f","type":"file in","z":"7e40a951.76a278","name":"deivce_config","filename":"deivce_config.json","format":"utf8","x":417.42857360839844,"y":259.71428203582764,"wires":[["c622def9.5bcd6"]]},{"id":"9f9a87f4.b96198","type":"http in","z":"7e40a951.76a278","name":"","url":"/serial_4","method":"get","swaggerDoc":"","x":161.71428680419922,"y":64.00000190734863,"wires":[["43c7a19e.2c524"]]},{"id":"e7c31445.c4fe48","type":"http response","z":"7e40a951.76a278","name":"","x":592.4285545349121,"y":55.07143211364746,"wires":[]},{"id":"268b3abe.7e9ef6","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = msg.payload.split(':')[1].replace('\\n','').replace(' ','');\nreturn msg;","outputs":1,"noerr":0,"x":596.0000267028809,"y":93.99999809265137,"wires":[["2682c9d0.6e8c66"]]},{"id":"2682c9d0.6e8c66","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"false","x":744.5714263916016,"y":92.57143211364746,"wires":[]},{"id":"8fd6a720.2ed218","type":"inject","z":"7e40a951.76a278","name":"DEMO","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":126,"y":126.85714340209961,"wires":[["314d6b31.015564","3ee1159f.a2016a"]]},{"id":"314d6b31.015564","type":"function","z":"7e40a951.76a278","name":"DEMO Data","func":"var device_config = {\n    'event_move_in_id':'80096D9ABE7F68F3E0533300000A6C0D',\n    'event_move_in_minus_id':'8DB9B239DF5252F0E055000000000001',\n    'event_move_out_id':'80096D9ABE8068F3E0533300000A6C0D',\n    'event_max_weight_id':'85A255F950F9BEF4E0533300000AC45D',\n    'event_on_id': '85A2CC45702A2DD1E0533300000A0C94',\n    'event_off_id':'85A2CC4570292DD1E0533300000A0C94',\n    'event_max_duration':'8642EE858DE89BAAE0533300000AFCC7',\n    'event_fake_traffic':'80096EF60C186574E0533300000ADBA5',\n    'event_get_weight_acc':'800970AC1FDC683CE0533300000AF1B0',\n    'event_min_weight':'875C3EB5C9DD092DE055000000000001',\n    'event_driver_in':'8E68D8D8B2977181E055000000000001',\n    'event_over_load':'B3EB5F800EFD2620E0530101007F8A05',\n    'snapshot_events':['80096D9ABE7F68F3E0533300000A6C0D','85A255F950F9BEF4E0533300000AC45D','8642EE858DE89BAAE0533300000AFCC7','800970AC1FDC683CE0533300000AF1B0',\"8E68D8D8B2977181E055000000000001\",\"B3EB5F800EFD2620E0530101007F8A05\"],\n    'main_host':'http://78.46.24.220:8080/ords/demo_ettn',\n    'event_url':'/iot_cli/events/log',\n    'state_url':'/iot_cli/device',\n    'snapshot_url':'/iot_cli/events/snapshot',\n    'maxWeight':60000,\n    'maxDuration':600000,\n    'minWeight':-40,\n    'checkHealthTimeout':3000,\n    'minTriggerWeight':40,\n    'driverWeight':80\n}\nmsg.payload = device_config;\n// flow.set('scale_id','80096CB0EFD83B63E0533300000A4334');\n// flow.set('event_move_in_id','80096D9ABE7F68F3E0533300000A6C0D');\n// flow.set('event_move_out_id','80096D9ABE8068F3E0533300000A6C0D');\n// flow.set('event_max_weight_id','85A255F950F9BEF4E0533300000AC45D');\n// flow.set('event_off_id','85A2CC4570292DD1E0533300000A0C94');\n// flow.set('event_on_id', '85A2CC45702A2DD1E0533300000A0C94');\n// flow.set('event_max_duration','8642EE858DE89BAAE0533300000AFCC7');\n// flow.set('main_host','http://prod.apex.rest/ords/ettn');\n// flow.set('event_url','/iot_cli/events/log');\n// flow.set('state_url','/v1/device');\n// flow.set('maxWeight',40000);\n// flow.set('maxDuration',20000);\n// flow.set('checkHealthTimeout',3000);\nreturn msg;","outputs":1,"noerr":0,"x":305,"y":124,"wires":[["8d327709.3f2338"]]},{"id":"c622def9.5bcd6","type":"function","z":"7e40a951.76a278","name":"device config","func":"var device_config = JSON.parse(msg.payload);\n\nflow.set('scale_id',device_config.scale_id);\nflow.set('event_move_in_id',device_config.event_move_in_id);\nflow.set('event_move_in_minus_id',device_config.event_move_in_minus_id);\nflow.set('event_move_out_id',device_config.event_move_out_id);\nflow.set('event_max_weight_id',device_config.event_max_weight_id);\nflow.set('event_off_id',device_config.event_off_id);\nflow.set('event_on_id', device_config.event_on_id);\nflow.set('event_max_duration',device_config.event_max_duration);\nflow.set('event_fake_traffic',device_config.event_fake_traffic);\nflow.set('event_driver_in', device_config.event_driver_in);\nflow.set('event_over_load',device_config.event_over_load);\nflow.set('main_host',device_config.main_host);\nflow.set('event_url',device_config.event_url);\nflow.set('state_url',device_config.state_url);\nflow.set('maxWeight',device_config.maxWeight);\nflow.set('minWeight',device_config.minWeight);\nflow.set('maxDuration',device_config.maxDuration);\nflow.set('checkHealthTimeout',device_config.checkHealthTimeout);\nflow.set('event_get_weight_acc',device_config.event_get_weight_acc);\nflow.set('event_min_weight',device_config.event_min_weight);\nflow.set('minTriggerWeight',device_config.minTriggerWeight);\nflow.set('snapshot_url',device_config.snapshot_url);\nflow.set('snapshot_events',device_config.snapshot_events);\nflow.set('driverWeight',device_config.driverWeight);\nflow.set('overLoadWeight', device_config.overLoadWeight);\n\nmsg.payload = {\n\tscale_id: flow.get('scale_id'),\n\tevent_move_in_id: flow.get('event_move_in_id'),\n\tevent_move_in_minus_id: flow.get('event_move_in_minus_id'),\n\tevent_move_out_id: flow.get('event_move_out_id'),\n\tevent_max_weight_id: flow.get('event_max_weight_id'),\n\tevent_off_id: flow.get('event_off_id'),\n\tevent_on_id: flow.get('event_on_id'),\n\tevent_max_duration: flow.get('event_max_duration'),\n\tevent_fake_traffic: flow.get('event_fake_traffic'),\n\tevent_driver_in: flow.get('event_driver_in'),\n\tevent_over_load: flow.get('event_over_load'),\n\tmain_host: flow.get('main_host'),\n\tevent_url: flow.get('event_url'),\n\tstate_url: flow.get('state_url'),\n\tmaxWeight: flow.get('maxWeight'),\n\tminWeight: flow.get('minWeight'),\n\tmaxDuration: flow.get('maxDuration'),\n\tcheckHealthTimeout: flow.get('checkHealthTimeout'),\n\tevent_get_weight_acc: flow.get('event_get_weight_acc'),\n\tevent_min_weight: flow.get('event_min_weight'),\n\tminTriggerWeight: flow.get('minTriggerWeight'),\n\tsnapshot_url: flow.get('snapshot_url'),\n\tsnapshot_events: flow.get('snapshot_events'),\n\tdriverWeight: flow.get('driverWeight'),\n\toverLoadWeight: flow.get('overLoadWeight')\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":611,"y":184,"wires":[["8ef3ae1d.efe41"]]},{"id":"8ef3ae1d.efe41","type":"json","z":"7e40a951.76a278","name":"","x":757,"y":182,"wires":[["f4d89978.1ec308"]]},{"id":"f4d89978.1ec308","type":"debug","z":"7e40a951.76a278","name":"IN device config","active":false,"console":"true","complete":"payload","x":919,"y":180,"wires":[]},{"id":"69046c26.f5c864","type":"function","z":"7e40a951.76a278","name":"transactionHasMaxWeight","func":"msg.event_id = flow.get('event_max_weight_id');\nmsg.description = 'Перевищена максимально-допустима вага, кг: ' + msg.metadata.weight;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":692.6666297912598,"y":564.6666259765625,"wires":[["4626c464.94a27c"]]},{"id":"1ecff707.07c959","type":"switch","z":"7e40a951.76a278","name":"switch max weight","property":"transactionHasMaxWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":422.6666259765625,"y":564.6666374206543,"wires":[["69046c26.f5c864"]]},{"id":"4626c464.94a27c","type":"function","z":"7e40a951.76a278","name":"events payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id');\nvar snapshot_events = flow.get('snapshot_events');\nvar snapshot = false;\n\nif (snapshot_events.indexOf(event_id)>=0){\n    snapshot = true;\n}\n\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'devices':[{'id':scale_id}],\n    'data':msg.metadata,\n    'description':msg.description\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('event_url');\nmsg.main_host = flow.get('main_host');\nmsg.event_url = flow.get('event_url');\nmsg.snapshot = snapshot;\nreturn msg;","outputs":1,"noerr":0,"x":1056.9999771118164,"y":535.7618007659912,"wires":[["edbc54de.1061f8","86ee19a6.a4b978","73366b29.e9dfb4"]]},{"id":"873eafc0.2822c","type":"function","z":"7e40a951.76a278","name":"main module","func":"var prevWeight = flow.get('prevWeight');\nvar transaction = flow.get('transaction');\nvar transactionData = flow.get('transactionData');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar transactionHasMaxWeight = flow.get('transactionHasMaxWeight');\nvar transactionHasMinWeight = flow.get('transactionHasMinWeight');\nvar transactionHasMaxDuration = flow.get('transactionHasMaxDuration');\nvar waybill = flow.get('transactionWaybill');\nvar weight = msg.payload;\nvar stableSize = 5;\nvar duration = 0;\nvar maxWeight = flow.get('maxWeight');\nvar maxDuration = flow.get('maxDuration');\nvar prevTransaction = transaction;\nvar minWeight = flow.get('minWeight');\nvar minTriggerWeight = flow.get('minTriggerWeight');\nvar is_minus = false;\nvar transactionAccWeight = flow.get('transactionAccWeight');//облікова вага\nvar overLoadWeight = flow.get('overLoadWeight');\n\n//transaction\nif (prevWeight === null){\n    prevWeight = msg.payload;    \n}else{\n    if((prevWeight <= 0) && (weight > 0) && (weight > minTriggerWeight)){\n        //start of transaction\n        transaction = Date.now();\n        msg.on = true;\n        flow.set('transaction',transaction);\n    }else if((prevWeight > 0) && (weight <=0) && (transaction)){\n        //transaction = 0;\n        msg.on = false;\n        transactionData = [];\n        flow.set('transaction',0);\n        flow.set('transactionMaxWeight',null);\n        flow.set('transactionHasMaxWeight',null);\n        flow.set('transactionHasMinWeight',null);\n        flow.set('transactionHasMaxDuration',null);\n        flow.set('transactionHasOverLoad',null);//облікова вага\n        flow.set('transactionWaybill',null);\n        flow.set('transactionMetadata',null);\n        flow.set('transactionAccWeight', null);//облікова вага\n    }else if((transaction === null) && (weight>0) && (weight > minTriggerWeight)){\n        transaction = Date.now();\n        flow.set('transaction',transaction);\n    }\n    if((prevWeight < 0) && ((weight-prevWeight) > minTriggerWeight)){\n        //start of transaction\n        is_minus = true;\n        msg.prevWeight = prevWeight;\n    }\n}\n\nif (transaction > 0){\n    transactionData.push(weight);    \n\n    //stable\n    if(transactionData.length > stableSize+1){\n        var stabletmp = true;\n        for (var i = transactionData.length-1; i > transactionData.length-1-stableSize; i--){\n            if (transactionData[i] !== transactionData[i-1]){\n                stabletmp = false;\n                msg.stable = stabletmp;\n                break;\n            }\n            msg.stable = stabletmp;\n        }\n    }else{\n        msg.stable = false;\n    }\n\n    //duration & transactionMaxWeight\n    duration = (Number(Date.now()) - Number(transaction));\n    if( (weight>transactionMaxWeight) || (transactionMaxWeight === null)){\n        transactionMaxWeight = weight;\n        flow.set(\"transactionMaxWeight\",transactionMaxWeight);\n    }\n    \n    if(!transactionHasMaxWeight && weight > maxWeight){\n        msg.transactionHasMaxWeight = true;\n        flow.set('transactionHasMaxWeight',true);\n    }\n    \n    if(!transactionHasMinWeight && weight < minWeight){\n        msg.transactionHasMinWeight = true;\n        flow.set('transactionHasMinWeight',true);\n    }\n    \n    //max duartion\n    if(!transactionHasMaxDuration && duration > maxDuration){\n        msg.transactionHasMaxDuration = true;\n        flow.set('transactionHasMaxDuration',true);\n    }\n}\n\n//result\nmsg.metadata = {\n    'weight':weight,\n    'prevWeight':prevWeight,\n    'prevTransaction':prevTransaction,\n    'transaction':transaction,\n    'on':msg.on,\n    'transactionDataCount':transactionData.length,\n    'stable':msg.stable,\n    'duration':Math.round(duration/1000),\n    'transactionMaxWeight':transactionMaxWeight,\n    'transactionAccWeight':transactionAccWeight,\n    'waybill':waybill,\n    'perimetr':true,\n    'weight1':msg.weight1,\n    'weight2':msg.weight2,\n    'weight_center':msg.weight_center,\n    'driverInCar':false\n}\nflow.set('transactionData',transactionData);\nflow.set('prevWeight',weight);\nflow.set('transactionMetadata',msg.metadata);\nflow.set('lasttimedata', new Date());\nmsg.is_minus = is_minus;\n\nif(transactionAccWeight){\n    \n   flow.set('transactionHasOverLoad',(weight-transactionAccWeight)>overLoadWeight);\n   \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":223.6666259765625,"y":543.6666259765625,"wires":[["696153f9.9a6fdc","1ecff707.07c959","77906f60.4b129","f188b7df.017f78","cf41b492.e31c88"]]},{"id":"ba8056f7.763aa8","type":"function","z":"7e40a951.76a278","name":"get weight from accounting system","func":"var transactionMetadata = flow.get('transactionMetadata');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar driverWeight = flow.get('driverWeight');\nvar buisness_data = msg.req.query;\n\nmsg.metadata = Object.assign(transactionMetadata,buisness_data);\n\n//check driver in a car\nvar driver_in = false;\nmsg.driverWeight = driverWeight;\nif((transactionMaxWeight - msg.metadata.weight) < driverWeight){\n    driver_in = true;\n}\n\nmsg.event_id = flow.get('event_get_weight_acc');\ntransactionWaybill = flow.get('transactionWaybill');\nif (!transactionWaybill){\n    flow.set('transactionWaybill',msg.req.query.reader);\n}\nmsg.description = ' '+buisness_data.operation_name+'. '+buisness_data.operation_type+'. Зважили в 1С. Поточна вага: ' + msg.metadata.weight+\" Номер авто: \"+buisness_data.truck1+\" \"+buisness_data.truck2+\" \"+buisness_data.item_name + \", ТТН: \" + buisness_data.waybill;\nmsg.transactionMetadata = transactionMetadata;\nmsg.driver_in = driver_in;\n\nflow.set('transactionAccWeight',  msg.metadata.weight);//облікова вага\n\nreturn msg;","outputs":1,"noerr":0,"x":502.6666259765625,"y":844.6666374206543,"wires":[["86fa8770.e03c48","49afb400.df967c","4626c464.94a27c"]]},{"id":"3b04ae0e.398eb2","type":"http request","z":"7e40a951.76a278","name":"EVENTS","method":"POST","ret":"txt","url":"","tls":"","x":1266.0000076293945,"y":560.2221832275391,"wires":[["c4f78a9b.1aad68","3620ca66.8bb496"]]},{"id":"b847b473.cdd0c8","type":"switch","z":"7e40a951.76a278","name":"take snapshot","property":"snapshot","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1299.8095703125,"y":664.6666374206543,"wires":[["1a3b210.990a3df"]]},{"id":"edbc54de.1061f8","type":"json","z":"7e40a951.76a278","name":"","x":1152.6666259765625,"y":463.2380180358887,"wires":[["be571c2.c47b1e"]]},{"id":"86ee19a6.a4b978","type":"debug","z":"7e40a951.76a278","name":"IN event","active":false,"console":"true","complete":"true","x":1166.6666259765625,"y":418.6666259765625,"wires":[]},{"id":"93e59bf1.dbe068","type":"function","z":"7e40a951.76a278","name":"move in","func":"msg.event_id = flow.get('event_move_in_id');\nmsg.description = 'Заїзд на ваги. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":642.6666297912598,"y":484.6666259765625,"wires":[["4626c464.94a27c"]]},{"id":"f6672372.2fdb9","type":"function","z":"7e40a951.76a278","name":"off","func":"msg.event_id = flow.get('event_off_id');\nmsg.description = 'Прилад відключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\nreturn msg;","outputs":1,"noerr":0,"x":642.6666259765625,"y":724.6666374206543,"wires":[["4626c464.94a27c"]]},{"id":"df2c5650.d66cb8","type":"function","z":"7e40a951.76a278","name":"on","func":"msg.event_id = flow.get('event_on_id');\nmsg.description = 'Прилад підключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":642.6666259765625,"y":684.6666374206543,"wires":[["4626c464.94a27c"]]},{"id":"611c6a91.4cf9d4","type":"function","z":"7e40a951.76a278","name":"move out","func":"msg.event_id = flow.get('event_move_out_id');\nmsg.description = 'Зїзд з ваг. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":642.6666297912598,"y":524.6666259765625,"wires":[["4626c464.94a27c"]]},{"id":"2cff1926.71f6a6","type":"function","z":"7e40a951.76a278","name":"transaction has max duration","func":"msg.event_id = flow.get('event_max_duration');\nmsg.description = 'Перевищено максимальний час находження на вагах, сек: ' + msg.metadata.duration;\n\nreturn msg;","outputs":1,"noerr":0,"x":702.6666297912598,"y":604.6666259765625,"wires":[["4626c464.94a27c"]]},{"id":"6e02d448.54ff3c","type":"function","z":"7e40a951.76a278","name":"empty waybill","func":"msg.event_id = flow.get('event_fake_traffic');\nmsg.description = 'Холостий проїзд по вагам. Тривалість проїзду ' + Math.round(msg.metadata.duration/60)+ 'хв.';\n\nreturn msg;","outputs":1,"noerr":0,"x":802.6666297912598,"y":444.6666259765625,"wires":[["4626c464.94a27c"]]},{"id":"16b6cca9.7f8a83","type":"function","z":"7e40a951.76a278","name":"transactionHasMinWeight","func":"msg.event_id = flow.get('event_min_weight');\nmsg.description = 'Перевищена мінімально-допустима вага, кг: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":692.6666297912598,"y":644.6666259765625,"wires":[["4626c464.94a27c"]]},{"id":"24f0f0b9.64b72","type":"function","z":"7e40a951.76a278","name":"move in minus","func":"msg.event_id = flow.get('event_move_in_minus_id');\nmsg.description = 'Заїзд із мінусом. ' + msg.prevWeight +' кг.';\n\nreturn msg;","outputs":1,"noerr":0,"x":662.6666526794434,"y":404.66661167144775,"wires":[["4626c464.94a27c"]]},{"id":"b1100106.fb387","type":"link in","z":"7e40a951.76a278","name":"s4","links":["75895482.ee04bc"],"x":67.6666259765625,"y":544.6666374206543,"wires":[["b951b41c.2f7f08","cdad534b.26ff8","4a568e7e.0a503","96883c23.50bdb","6b93152d.2fe48c","873eafc0.2822c"]]},{"id":"696153f9.9a6fdc","type":"switch","z":"7e40a951.76a278","name":"switch move","property":"on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":422.6666259765625,"y":524.6666374206543,"wires":[["93e59bf1.dbe068"],["611c6a91.4cf9d4","d186857e.affab8","f63bfb90.0d3398"]]},{"id":"77906f60.4b129","type":"switch","z":"7e40a951.76a278","name":"max duration","property":"transactionHasMaxDuration","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":402.6666259765625,"y":604.6666374206543,"wires":[["2cff1926.71f6a6"]]},{"id":"f188b7df.017f78","type":"switch","z":"7e40a951.76a278","name":"switch min weight","property":"transactionHasMinWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":422.6666259765625,"y":644.6666374206543,"wires":[["16b6cca9.7f8a83"]]},{"id":"cf41b492.e31c88","type":"switch","z":"7e40a951.76a278","name":"switch minus in","property":"is_minus","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":422.6666259765625,"y":464.6666374206543,"wires":[["24f0f0b9.64b72"]]},{"id":"86fa8770.e03c48","type":"switch","z":"7e40a951.76a278","name":"","property":"driver_in","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":792.6666259765625,"y":784.6666374206543,"wires":[["dd2dfe60.18618","761bef56.144a9"]]},{"id":"49afb400.df967c","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":758.6666259765625,"y":845.6666259765625,"wires":[]},{"id":"c037a81f.05c1f8","type":"http in","z":"7e40a951.76a278","name":"","url":"/getWeight_5","method":"get","swaggerDoc":"","x":152.6666259765625,"y":841.6666259765625,"wires":[["3e6b07be.b2de28","ba8056f7.763aa8","bcc2a81.5b9ff58"]]},{"id":"c4f78a9b.1aad68","type":"function","z":"7e40a951.76a278","name":"parser","func":"var str = {\n    payload: msg.payload,\n    event_id: msg.event_id,\n    metadata: msg.metadata,\n    driverWeight: msg.driverWeight,\n    description: msg.description,\n    url: msg.url,\n    main_host: msg.main_host,\n    event_url: msg.event_url,\n    statusCode: msg.statusCode,\n    responseUrl: msg.responseUrl\n    \n};\nmsg.payload = JSON.stringify(str);\nreturn msg;","outputs":1,"noerr":0,"x":1407.666748046875,"y":614.6666069030762,"wires":[["43834c18.a37e44"]]},{"id":"3620ca66.8bb496","type":"debug","z":"7e40a951.76a278","name":"","active":false,"console":"false","complete":"true","x":1424.1666259765625,"y":551.4166259765625,"wires":[]},{"id":"dd2dfe60.18618","type":"function","z":"7e40a951.76a278","name":"driver_in event","func":"msg.event_id = flow.get('event_driver_in');\nmsg.description = 'При зважуванні водій в кабіні. Вага: ' + msg.metadata.weight+\"кг. Номер авто: \"+msg.metadata.truck1+\" \"+msg.metadata.truck2+\" \"+msg.metadata.item_name;\n\nreturn msg;","outputs":1,"noerr":0,"x":1024.6825561523438,"y":686.8730583190918,"wires":[["4626c464.94a27c"]]},{"id":"be571c2.c47b1e","type":"debug","z":"7e40a951.76a278","name":"IN event","active":false,"console":"true","complete":"payload","x":1265.5238037109375,"y":498.6666069030762,"wires":[]},{"id":"65230368.72ac2c","type":"switch","z":"7e40a951.76a278","name":"","property":"checkHealth","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":502.6666259765625,"y":744.6666374206543,"wires":[["df2c5650.d66cb8"],["f6672372.2fdb9"]]},{"id":"d186857e.affab8","type":"switch","z":"7e40a951.76a278","name":"waybill","property":"metadata.waybill","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","outputs":1,"x":634.3332977294922,"y":442.9999465942383,"wires":[["6e02d448.54ff3c"]]},{"id":"b951b41c.2f7f08","type":"socket-io-out","z":"7e40a951.76a278","name":"socket 4003","event":"359baf79.3daa","server":"a5c8dc6c.5eb02","x":202.6666259765625,"y":624.6666374206543,"wires":[]},{"id":"cdad534b.26ff8","type":"debug","z":"7e40a951.76a278","name":"IN weight","active":false,"console":"true","complete":"payload","x":199.6666259765625,"y":479.6666374206543,"wires":[]},{"id":"4a568e7e.0a503","type":"ui_text","z":"7e40a951.76a278","group":"30ef9a79.c5a046","order":1,"width":0,"height":0,"name":"","label":"Поточна вага:","format":"{{msg.payload}}","layout":"row-spread","x":209.6666259765625,"y":701.6666374206543,"wires":[]},{"id":"96883c23.50bdb","type":"ui_chart","z":"7e40a951.76a278","name":"","group":"30ef9a79.c5a046","order":2,"width":"6","height":"6","label":"Графік ваги","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"0==","ymax":"","removeOlder":"10","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"x":215.6666259765625,"y":439.6666259765625,"wires":[[],[]]},{"id":"761bef56.144a9","type":"debug","z":"7e40a951.76a278","name":"","active":false,"console":"false","complete":"true","x":931.6666259765625,"y":825.6666374206543,"wires":[]},{"id":"3e6b07be.b2de28","type":"function","z":"7e40a951.76a278","name":"response","func":"msg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nif(transactionWaybill && transactionWaybill !== msg.req.query.reader){\n    msg.payload.status = false;    \n}else {\n    msg.payload.status = true;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":417.6666259765625,"y":958.6666259765625,"wires":[["d61c6795.3f5078","2b854c11.2f9864"]]},{"id":"43834c18.a37e44","type":"debug","z":"7e40a951.76a278","name":"IN response event","active":false,"console":"true","complete":"payload","x":1570.6666259765625,"y":599.0951957702637,"wires":[]},{"id":"e9226b29.ab1a58","type":"function","z":"7e40a951.76a278","name":"photo","func":"\n\n\n\nif(msg.random == 1){\n           msg.payload = {\n            snapshot: flow.get(\"p1\")\n            }   \n    }else if(msg.random == 2){\n      msg.payload = {\n            snapshot: flow.get(\"p2\")\n            }    \n    }else{\n      msg.payload = {\n            snapshot: flow.get(\"p3\")\n            }   \n    }\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1650.6666259765625,"y":665.6666374206543,"wires":[["aab814ae.97cbb8"]]},{"id":"f5b4b4be.35d918","type":"function","z":"7e40a951.76a278","name":"check scale health","func":"var lastcheckHealth = flow.get('checkHealth');\nvar checkHealth = null;\nvar lasttimedata = flow.get('lasttimedata');\n\nvar currenttimedata = new Date();\n\nif ((currenttimedata - lasttimedata) > 3000){\n    checkHealth = false;\n} else {\n    checkHealth = true;\n}\n\nflow.set(\"checkHealth\",checkHealth);\n\nif (lastcheckHealth != checkHealth){\n    msg.checkHealth = checkHealth;\n}else{\n    msg.checkHealth = null;\n}\nmsg.payload = checkHealth;\n\nreturn msg;","outputs":1,"noerr":0,"x":322.6666259765625,"y":784.6666374206543,"wires":[["65230368.72ac2c"]]},{"id":"d61c6795.3f5078","type":"http response","z":"7e40a951.76a278","name":"","x":574.6666259765625,"y":936.6666259765625,"wires":[]},{"id":"2b854c11.2f9864","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"false","x":722.6666259765625,"y":958.6666259765625,"wires":[]},{"id":"aab814ae.97cbb8","type":"function","z":"7e40a951.76a278","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in');\n//var tbase64   = msg.payload.toString('base64');\nvar tbase64   = msg.payload.snapshot;\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":1910.6666259765625,"y":657.6666374206543,"wires":[["604c57e.cdb03a8","e6b7c9e5.e5eb58"]]},{"id":"12555727.be48f9","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"4","crontab":"","once":false,"x":142.6666259765625,"y":784.6666374206543,"wires":[["f5b4b4be.35d918"]]},{"id":"604c57e.cdb03a8","type":"http request","z":"7e40a951.76a278","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"b0397653.651578","x":2145.66650390625,"y":561.6666259765625,"wires":[["8b1630d7.bf822","b64ce12a.2a2b8"]]},{"id":"e6b7c9e5.e5eb58","type":"debug","z":"7e40a951.76a278","name":"Camera 1","active":false,"console":"true","complete":"payload","x":2129.6666259765625,"y":664.6666259765625,"wires":[]},{"id":"8b1630d7.bf822","type":"json","z":"7e40a951.76a278","name":"","x":2322.6666259765625,"y":653.6666374206543,"wires":[["486fe44c.53e72c"]]},{"id":"486fe44c.53e72c","type":"debug","z":"7e40a951.76a278","name":"event Apex","active":false,"console":"true","complete":"payload","x":2513.66650390625,"y":650.6666259765625,"wires":[]},{"id":"8e01629b.63adf","type":"http in","z":"7e40a951.76a278","name":"","url":"/getSimpleWeight_5","method":"get","swaggerDoc":"","x":224.33331298828125,"y":1076.333254814148,"wires":[["af0904d3.20b918"]]},{"id":"af0904d3.20b918","type":"function","z":"7e40a951.76a278","name":"response","func":"msg.payload = flow.get('transactionMetadata').weight;\nreturn msg;","outputs":1,"noerr":0,"x":470.50000762939453,"y":1073.833267211914,"wires":[["b8f79934.46e808"]]},{"id":"b8f79934.46e808","type":"http response","z":"7e40a951.76a278","name":"","x":612.9166984558105,"y":1079.8332681655884,"wires":[]},{"id":"f58a67c4.f45978","type":"http in","z":"7e40a951.76a278","name":"","url":"/socket_5","method":"get","swaggerDoc":"","x":170.66665077209473,"y":1567.4998779296875,"wires":[["560b79bb.47a358"]]},{"id":"8827178b.2d78d8","type":"template","z":"7e40a951.76a278","name":"socket page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n     \n  <body>\n    <h1><p id='weight'></p></h1>\n    \n     <script>\n    setTimeout(function() {\n       ;(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.io=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_(\"./lib/\")},{\"./lib/\":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_(\"./socket\");module.exports.parser=_dereq_(\"engine.io-parser\")},{\"./socket\":3,\"engine.io-parser\":19}],3:[function(_dereq_,module,exports){(function(global){var transports=_dereq_(\"./transports\");var Emitter=_dereq_(\"component-emitter\");var debug=_dereq_(\"debug\")(\"engine.io-client:socket\");var index=_dereq_(\"indexof\");var parser=_dereq_(\"engine.io-parser\");var parseuri=_dereq_(\"parseuri\");var parsejson=_dereq_(\"parsejson\");var parseqs=_dereq_(\"parseqs\");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&\"object\"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==\"https\"||uri.protocol==\"wss\";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&\"https:\"==location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?\"443\":\"80\"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:\"localhost\");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if(\"string\"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||\"t\";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||[\"polling\",\"websocket\"];this.readyState=\"\";this.writeBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?null:opts.rejectUnauthorized;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}}this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_(\"./transport\");Socket.transports=_dereq_(\"./transports\");Socket.parser=_dereq_(\"engine.io-parser\");Socket.prototype.createTransport=function(name){debug('creating transport \"%s\"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf(\"websocket\")!=-1){transport=\"websocket\"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit(\"error\",\"No transports available\")},0);return}else{transport=this.transports[0]}this.readyState=\"opening\";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug(\"setting transport %s\",transport.name);var self=this;if(this.transport){debug(\"clearing existing transport %s\",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on(\"drain\",function(){self.onDrain()}).on(\"packet\",function(packet){self.onPacket(packet)}).on(\"error\",function(e){self.onError(e)}).on(\"close\",function(){self.onClose(\"transport close\")})};Socket.prototype.probe=function(name){debug('probing transport \"%s\"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport \"%s\" opened',name);transport.send([{type:\"ping\",data:\"probe\"}]);transport.once(\"packet\",function(msg){if(failed)return;if(\"pong\"==msg.type&&\"probe\"==msg.data){debug('probe transport \"%s\" pong',name);self.upgrading=true;self.emit(\"upgrading\",transport);if(!transport)return;Socket.priorWebsocketSuccess=\"websocket\"==transport.name;debug('pausing current transport \"%s\"',self.transport.name);self.transport.pause(function(){if(failed)return;if(\"closed\"==self.readyState)return;debug(\"changing transport and sending upgrade packet\");cleanup();self.setTransport(transport);transport.send([{type:\"upgrade\"}]);self.emit(\"upgrade\",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport \"%s\" failed',name);var err=new Error(\"probe error\");err.transport=transport.name;self.emit(\"upgradeError\",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error(\"probe error: \"+err);error.transport=transport.name;freezeTransport();debug('probe transport \"%s\" failed because of error: %s',name,err);self.emit(\"upgradeError\",error)}function onTransportClose(){onerror(\"transport closed\")}function onclose(){onerror(\"socket closed\")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('\"%s\" works - aborting \"%s\"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener(\"open\",onTransportOpen);transport.removeListener(\"error\",onerror);transport.removeListener(\"close\",onTransportClose);self.removeListener(\"close\",onclose);self.removeListener(\"upgrading\",onupgrade)}transport.once(\"open\",onTransportOpen);transport.once(\"error\",onerror);transport.once(\"close\",onTransportClose);this.once(\"close\",onclose);this.once(\"upgrading\",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug(\"socket open\");this.readyState=\"open\";Socket.priorWebsocketSuccess=\"websocket\"==this.transport.name;this.emit(\"open\");this.flush();if(\"open\"==this.readyState&&this.upgrade&&this.transport.pause){debug(\"starting upgrade probes\");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if(\"opening\"==this.readyState||\"open\"==this.readyState){debug('socket receive: type \"%s\", data \"%s\"',packet.type,packet.data);this.emit(\"packet\",packet);this.emit(\"heartbeat\");switch(packet.type){case\"open\":this.onHandshake(parsejson(packet.data));break;case\"pong\":this.setPing();this.emit(\"pong\");break;case\"error\":var err=new Error(\"server error\");err.code=packet.data;this.onError(err);break;case\"message\":this.emit(\"data\",packet.data);this.emit(\"message\",packet.data);break}}else{debug('packet received with socket readyState \"%s\"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit(\"handshake\",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if(\"closed\"==this.readyState)return;this.setPing();this.removeListener(\"heartbeat\",this.onHeartbeat);this.on(\"heartbeat\",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if(\"closed\"==self.readyState)return;self.onClose(\"ping timeout\")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug(\"writing ping packet - expecting pong within %sms\",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket(\"ping\",function(){self.emit(\"ping\")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit(\"drain\")}else{this.flush()}};Socket.prototype.flush=function(){if(\"closed\"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug(\"flushing %d packets in socket\",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit(\"flush\")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket(\"message\",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if(\"function\"==typeof data){fn=data;data=undefined}if(\"function\"==typeof options){fn=options;options=null}if(\"closing\"==this.readyState||\"closed\"==this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit(\"packetCreate\",packet);this.writeBuffer.push(packet);if(fn)this.once(\"flush\",fn);this.flush()};Socket.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.readyState=\"closing\";var self=this;if(this.writeBuffer.length){this.once(\"drain\",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose(\"forced close\");debug(\"socket closing - telling transport to close\");self.transport.close()}function cleanupAndClose(){self.removeListener(\"upgrade\",cleanupAndClose);self.removeListener(\"upgradeError\",cleanupAndClose);close()}function waitForUpgrade(){self.once(\"upgrade\",cleanupAndClose);self.once(\"upgradeError\",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug(\"socket error %j\",err);Socket.priorWebsocketSuccess=false;this.emit(\"error\",err);this.onClose(\"transport error\",err)};Socket.prototype.onClose=function(reason,desc){if(\"opening\"==this.readyState||\"open\"==this.readyState||\"closing\"==this.readyState){debug('socket close with reason: \"%s\"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners(\"close\");this.transport.close();this.transport.removeAllListeners();this.readyState=\"closed\";this.id=null;this.emit(\"close\",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./transport\":4,\"./transports\":5,\"component-emitter\":15,debug:17,\"engine.io-parser\":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(_dereq_,module,exports){var parser=_dereq_(\"engine.io-parser\");var Emitter=_dereq_(\"component-emitter\");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState=\"\";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type=\"TransportError\";err.description=desc;this.emit(\"error\",err);return this};Transport.prototype.open=function(){if(\"closed\"==this.readyState||\"\"==this.readyState){this.readyState=\"opening\";this.doOpen()}return this};Transport.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if(\"open\"==this.readyState){this.write(packets)}else{throw new Error(\"Transport not open\")}};Transport.prototype.onOpen=function(){this.readyState=\"open\";this.writable=true;this.emit(\"open\")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit(\"packet\",packet)};Transport.prototype.onClose=function(){this.readyState=\"closed\";this.emit(\"close\")}},{\"component-emitter\":15,\"engine.io-parser\":19}],5:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var XHR=_dereq_(\"./polling-xhr\");var JSONP=_dereq_(\"./polling-jsonp\");var websocket=_dereq_(\"./websocket\");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if(\"open\"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error(\"JSONP disabled\");return new JSONP(opts)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling-jsonp\":6,\"./polling-xhr\":7,\"./websocket\":9,\"xmlhttprequest-ssl\":10}],6:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_(\"./polling\");var inherit=_dereq_(\"component-inherit\");module.exports=JSONPPolling;var rNewline=/\\n/g;var rEscapedNewline=/\\\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener(\"beforeunload\",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement(\"script\");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError(\"jsonp poll error\",e)};var insertAt=document.getElementsByTagName(\"script\")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko=\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement(\"iframe\");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement(\"form\");var area=document.createElement(\"textarea\");var id=this.iframeId=\"eio_iframe_\"+this.index;var iframe;form.className=\"socketio\";form.style.position=\"absolute\";form.style.top=\"-1000px\";form.style.left=\"-1000px\";form.target=id;form.method=\"POST\";form.setAttribute(\"accept-charset\",\"utf-8\");area.name=\"d\";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError(\"jsonp polling iframe removal error\",e)}}try{var html='<iframe src=\"javascript:0\" name=\"'+self.iframeId+'\">';iframe=document.createElement(html)}catch(e){iframe=document.createElement(\"iframe\");iframe.name=self.iframeId;iframe.src=\"javascript:0\"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,\"\\\\\\n\");this.area.value=data.replace(rNewline,\"\\\\n\");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==\"complete\"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-inherit\":16}],7:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var Polling=_dereq_(\"./polling\");var Emitter=_dereq_(\"component-emitter\");var inherit=_dereq_(\"component-inherit\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling-xhr\");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}else{this.extraHeaders=opts.extraHeaders}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!==\"string\"&&data!==undefined;var req=this.request({method:\"POST\",data:data,isBinary:isBinary});var self=this;req.on(\"success\",fn);req.on(\"error\",function(err){self.onError(\"xhr post error\",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug(\"xhr poll\");var req=this.request();var self=this;req.on(\"data\",function(data){self.onData(data)});req.on(\"error\",function(err){self.onError(\"xhr poll error\",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||\"GET\";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug(\"xhr open %s: %s\",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){xhr.responseType=\"arraybuffer\"}if(\"POST\"==this.method){try{if(this.isBinary){xhr.setRequestHeader(\"Content-type\",\"application/octet-stream\")}else{xhr.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}}catch(e){}}if(\"withCredentials\"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug(\"xhr data %s\",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit(\"success\");this.cleanup()};Request.prototype.onData=function(data){this.emit(\"data\",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit(\"error\",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if(\"undefined\"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader(\"Content-Type\").split(\";\")[0]}catch(e){}if(contentType===\"application/octet-stream\"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var ui8Arr=new Uint8Array(this.xhr.response);var dataArray=[];for(var idx=0,length=ui8Arr.length;idx<length;idx++){dataArray.push(ui8Arr[idx])}data=String.fromCharCode.apply(null,dataArray)}}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return\"undefined\"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent(\"onunload\",unloadHandler)}else if(global.addEventListener){global.addEventListener(\"beforeunload\",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-emitter\":15,\"component-inherit\":16,debug:17,\"xmlhttprequest-ssl\":10}],8:[function(_dereq_,module,exports){var Transport=_dereq_(\"../transport\");var parseqs=_dereq_(\"parseqs\");var parser=_dereq_(\"engine.io-parser\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling\");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name=\"polling\";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState=\"pausing\";function pause(){debug(\"paused\");self.readyState=\"paused\";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug(\"we are currently polling - waiting to pause\");total++;this.once(\"pollComplete\",function(){debug(\"pre-pause polling complete\");--total||pause()})}if(!this.writable){debug(\"we are currently writing - waiting to pause\");total++;this.once(\"drain\",function(){debug(\"pre-pause writing complete\");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug(\"polling\");this.polling=true;this.doPoll();this.emit(\"poll\")};Polling.prototype.onData=function(data){var self=this;debug(\"polling got data %s\",data);var callback=function(packet,index,total){if(\"opening\"==self.readyState){self.onOpen()}if(\"close\"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if(\"closed\"!=this.readyState){this.polling=false;this.emit(\"pollComplete\");if(\"open\"==this.readyState){this.poll()}else{debug('ignoring poll - transport state \"%s\"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug(\"writing close packet\");self.write([{type:\"close\"}])}if(\"open\"==this.readyState){debug(\"transport open - closing\");close()}else{debug(\"transport not open - deferring close\");this.once(\"open\",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit(\"drain\")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"https\":\"http\";var port=\"\";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&(\"https\"==schema&&this.port!=443||\"http\"==schema&&this.port!=80)){port=\":\"+this.port}if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query}},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,\"xmlhttprequest-ssl\":10,yeast:30}],9:[function(_dereq_,module,exports){(function(global){var Transport=_dereq_(\"../transport\");var parser=_dereq_(\"engine.io-parser\");var parseqs=_dereq_(\"parseqs\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:websocket\");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window===\"undefined\"){try{WebSocket=_dereq_(\"ws\")}catch(e){}}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name=\"websocket\";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}this.ws=BrowserWebSocket?new WebSocket(uri):new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType=\"buffer\"}else{this.ws.binaryType=\"arraybuffer\"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError(\"websocket error\",e)}};if(\"undefined\"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!BrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len=\"string\"==typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(BrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug(\"websocket closed before onclose event\")}--total||done()})})(packets[i])}function done(){self.emit(\"flush\");setTimeout(function(){self.writable=true;self.emit(\"drain\")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!==\"undefined\"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"wss\":\"ws\";var port=\"\";if(this.port&&(\"wss\"==schema&&this.port!=443||\"ws\"==schema&&this.port!=80)){port=\":\"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!(\"__initialize\"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,ws:undefined,yeast:30}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_(\"has-cors\");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if(\"undefined\"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(e){}}}},{\"has-cors\":22}],11:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error(\"after called too many times\")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],12:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],13:[function(_dereq_,module,exports){(function(chars){\"use strict\";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64=\"\";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];\nbase64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+\"=\"}else if(len%3===1){base64=base64.substring(0,base64.length-2)+\"==\"}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]===\"=\"){bufferLength--;if(base64[base64.length-2]===\"=\"){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\")},{}],14:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob([\"hi\"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],15:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],16:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],17:[function(_dereq_,module,exports){exports=module.exports=_dereq_(\"./debug\");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=\"undefined\"!=typeof chrome&&\"undefined\"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"];function useColors(){return\"WebkitAppearance\"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?\"%c\":\"\")+this.namespace+(useColors?\" %c\":\" \")+args[0]+(useColors?\"%c \":\" \")+\"+\"+exports.humanize(this.diff);if(!useColors)return args;var c=\"color: \"+this.color;args=[args[0],c,\"color: inherit\"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if(\"%%\"===match)return;index++;if(\"%c\"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return\"object\"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem(\"debug\")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{\"./debug\":18}],18:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_(\"ms\");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if(\"string\"!==typeof args[0]){args=[\"%o\"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match===\"%%\")return match;index++;var formatter=exports.formatters[format];if(\"function\"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if(\"function\"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||\"\").split(/[\\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\\*/g,\".*?\");if(namespaces[0]===\"-\"){exports.skips.push(new RegExp(\"^\"+namespaces.substr(1)+\"$\"))}else{exports.names.push(new RegExp(\"^\"+namespaces+\"$\"))}}}function disable(){exports.enable(\"\")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:25}],19:[function(_dereq_,module,exports){(function(global){var keys=_dereq_(\"./keys\");var hasBinary=_dereq_(\"has-binary\");var sliceBuffer=_dereq_(\"arraybuffer.slice\");var base64encoder=_dereq_(\"base64-arraybuffer\");var after=_dereq_(\"after\");var utf8=_dereq_(\"utf8\");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:\"error\",data:\"parser error\"};var Blob=_dereq_(\"blob\");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if(\"function\"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if(\"function\"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(\"\"+encoded)};function encodeBase64Object(packet,callback){var message=\"b\"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message=\"b\"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(\",\")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data==\"string\"||data===undefined){if(data.charAt(0)==\"b\"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType===\"blob\"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType===\"blob\"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary==\"function\"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback(\"0:\")}function setLengthHeader(message){return message.length+\":\"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(\"\"))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!=\"string\"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var packet;if(data==\"\"){return callback(err,0,1)}var length=\"\",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(\":\"!=chr){length+=chr}else{if(\"\"==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=\"\"}}if(length!=\"\"){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p===\"string\"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p===\"string\";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded===\"string\"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength=\"\";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg=\"\";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./keys\":20,after:11,\"arraybuffer.slice\":12,\"base64-arraybuffer\":13,blob:14,\"has-binary\":21,utf8:29}],20:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],21:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:24}],22:[function(_dereq_,module,exports){try{module.exports=typeof XMLHttpRequest!==\"undefined\"&&\"withCredentials\"in new XMLHttpRequest}catch(err){module.exports=false}},{}],23:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],24:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)==\"[object Array]\"}},{}],25:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if(\"string\"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=\"\"+str;if(str.length>1e4)return;var match=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||\"ms\").toLowerCase();switch(type){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return n*y;case\"days\":case\"day\":case\"d\":return n*d;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return n*h;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return n*m;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return n*s;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+\"d\";if(ms>=h)return Math.round(ms/h)+\"h\";if(ms>=m)return Math.round(ms/m)+\"m\";if(ms>=s)return Math.round(ms/s)+\"s\";return ms+\"ms\"}function long(ms){return plural(ms,d,\"day\")||plural(ms,h,\"hour\")||plural(ms,m,\"minute\")||plural(ms,s,\"second\")||ms+\" ms\"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+\" \"+name;return Math.ceil(ms/n)+\" \"+name+\"s\"}},{}],26:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\\],:{}\\s]*$/;var rvalidescape=/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\\s*\\[)+/g;var rtrimLeft=/^\\s+/;var rtrimRight=/\\s+$/;module.exports=function parsejson(data){if(\"string\"!=typeof data||!data){return null}data=data.replace(rtrimLeft,\"\").replace(rtrimRight,\"\");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,\"@\").replace(rvalidtokens,\"]\").replace(rvalidbraces,\"\"))){return new Function(\"return \"+data)()}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],27:[function(_dereq_,module,exports){exports.encode=function(obj){var str=\"\";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+=\"&\";str+=encodeURIComponent(i)+\"=\"+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split(\"&\");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split(\"=\");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],28:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;var parts=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];module.exports=function parseuri(str){var src=str,b=str.indexOf(\"[\"),e=str.indexOf(\"]\");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,\";\")+str.substring(e,str.length)}var m=re.exec(str||\"\"),uri={},i=14;while(i--){uri[parts[i]]=m[i]||\"\"}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,\":\");uri.authority=uri.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\");uri.ipv6uri=true}return uri}},{}],29:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports==\"object\"&&exports;var freeModule=typeof module==\"object\"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output=\"\";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error(\"Lone surrogate U+\"+codePoint.toString(16).toUpperCase()+\" is not a scalar value\")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol=\"\";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString=\"\";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error(\"Invalid byte index\")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error(\"Invalid continuation byte\")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error(\"Invalid byte index\")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error(\"Invalid UTF-8 detected\")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:\"2.0.0\",encode:utf8encode,decode:utf8decode};if(typeof define==\"function\"&&typeof define.amd==\"object\"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],30:[function(_dereq_,module,exports){\"use strict\";var alphabet=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded=\"\";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+\".\"+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],31:[function(_dereq_,module,exports){var url=_dereq_(\"./url\");var parser=_dereq_(\"socket.io-parser\");var Manager=_dereq_(\"./manager\");var debug=_dereq_(\"debug\")(\"socket.io-client\");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==\"object\"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts[\"force new connection\"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug(\"ignoring socket cache for %s\",source);io=Manager(source,opts)}else{if(!cache[id]){debug(\"new io instance for %s\",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_(\"./manager\");exports.Socket=_dereq_(\"./socket\")},{\"./manager\":32,\"./socket\":34,\"./url\":35,debug:39,\"socket.io-parser\":47}],32:[function(_dereq_,module,exports){var eio=_dereq_(\"engine.io-client\");var Socket=_dereq_(\"./socket\");var Emitter=_dereq_(\"component-emitter\");var parser=_dereq_(\"socket.io-parser\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:manager\");var indexOf=_dereq_(\"indexof\");var Backoff=_dereq_(\"backo2\");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&\"object\"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||\"/socket.io\";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState=\"closed\";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.engine.id}}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug(\"readyState %s\",this.readyState);if(~this.readyState.indexOf(\"open\"))return this;debug(\"opening %s\",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState=\"opening\";this.skipReconnect=false;var openSub=on(socket,\"open\",function(){self.onopen();fn&&fn()});var errorSub=on(socket,\"error\",function(data){debug(\"connect_error\");self.cleanup();self.readyState=\"closed\";self.emitAll(\"connect_error\",data);if(fn){var err=new Error(\"Connection error\");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug(\"connect attempt will timeout after %d\",timeout);var timer=setTimeout(function(){debug(\"connect attempt timed out after %d\",timeout);openSub.destroy();socket.close();socket.emit(\"error\",\"timeout\");self.emitAll(\"connect_timeout\",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug(\"open\");this.cleanup();this.readyState=\"open\";this.emit(\"open\");var socket=this.engine;this.subs.push(on(socket,\"data\",bind(this,\"ondata\")));this.subs.push(on(socket,\"ping\",bind(this,\"onping\")));this.subs.push(on(socket,\"pong\",bind(this,\"onpong\")));this.subs.push(on(socket,\"error\",bind(this,\"onerror\")));this.subs.push(on(socket,\"close\",bind(this,\"onclose\")));this.subs.push(on(this.decoder,\"decoded\",bind(this,\"ondecoded\")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll(\"ping\")};Manager.prototype.onpong=function(){this.emitAll(\"pong\",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit(\"packet\",packet)};Manager.prototype.onerror=function(err){debug(\"error\",err);this.emitAll(\"error\",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on(\"connecting\",onConnecting);\nsocket.on(\"connect\",function(){socket.id=self.engine.id});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug(\"writing packet %j\",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug(\"cleanup\");var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug(\"disconnect\");this.skipReconnect=true;this.reconnecting=false;if(\"opening\"==this.readyState){this.cleanup()}this.backoff.reset();this.readyState=\"closed\";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug(\"onclose\");this.cleanup();this.backoff.reset();this.readyState=\"closed\";this.emit(\"close\",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug(\"reconnect failed\");this.backoff.reset();this.emitAll(\"reconnect_failed\");this.reconnecting=false}else{var delay=this.backoff.duration();debug(\"will wait %dms before reconnect attempt\",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug(\"attempting reconnect\");self.emitAll(\"reconnect_attempt\",self.backoff.attempts);self.emitAll(\"reconnecting\",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug(\"reconnect attempt error\");self.reconnecting=false;self.reconnect();self.emitAll(\"reconnect_error\",err.data)}else{debug(\"reconnect success\");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll(\"reconnect\",attempt)}},{\"./on\":33,\"./socket\":34,backo2:36,\"component-bind\":37,\"component-emitter\":38,debug:39,\"engine.io-client\":1,indexof:42,\"socket.io-parser\":47}],33:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],34:[function(_dereq_,module,exports){var parser=_dereq_(\"socket.io-parser\");var Emitter=_dereq_(\"component-emitter\");var toArray=_dereq_(\"to-array\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:socket\");var hasBin=_dereq_(\"has-binary\");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,\"open\",bind(this,\"onopen\")),on(io,\"packet\",bind(this,\"onpacket\")),on(io,\"close\",bind(this,\"onclose\"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if(\"open\"==this.io.readyState)this.onopen();this.emit(\"connecting\");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift(\"message\");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if(\"function\"==typeof args[args.length-1]){debug(\"emitting packet with ack id %d\",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug(\"transport is open - connecting\");if(\"/\"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug(\"close (%s)\",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit(\"disconnect\",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit(\"error\",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug(\"emitting event %j\",args);if(null!=packet.id){debug(\"attaching ack callback to event\");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug(\"sending ack %j\",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if(\"function\"==typeof ack){debug(\"calling ack %s with %j\",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug(\"bad ack %s\",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit(\"connect\");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug(\"server disconnect (%s)\",this.nsp);this.destroy();this.onclose(\"io server disconnect\")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug(\"performing disconnect (%s)\",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose(\"io client disconnect\")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{\"./on\":33,\"component-bind\":37,\"component-emitter\":38,debug:39,\"has-binary\":41,\"socket.io-parser\":47,\"to-array\":51}],35:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_(\"parseuri\");var debug=_dereq_(\"debug\")(\"socket.io-client:url\");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+\"//\"+loc.host;if(\"string\"==typeof uri){if(\"/\"==uri.charAt(0)){if(\"/\"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\\/\\//.test(uri)){debug(\"protocol-less url %s\",uri);if(\"undefined\"!=typeof loc){uri=loc.protocol+\"//\"+uri}else{uri=\"https://\"+uri}}debug(\"parse %s\",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port=\"80\"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port=\"443\"}}obj.path=obj.path||\"/\";var ipv6=obj.host.indexOf(\":\")!==-1;var host=ipv6?\"[\"+obj.host+\"]\":obj.host;obj.id=obj.protocol+\"://\"+host+\":\"+obj.port;obj.href=obj.protocol+\"://\"+host+(loc&&loc.port==obj.port?\"\":\":\"+obj.port);return obj}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{debug:39,parseuri:45}],36:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],37:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if(\"string\"==typeof fn)fn=obj[fn];if(\"function\"!=typeof fn)throw new Error(\"bind() requires a function\");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],38:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[\"$\"+event]=this._callbacks[\"$\"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[\"$\"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[\"$\"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[\"$\"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[\"$\"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],39:[function(_dereq_,module,exports){arguments[4][17][0].apply(exports,arguments)},{\"./debug\":40,dup:17}],40:[function(_dereq_,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:44}],41:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON&&\"function\"==typeof obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:43}],42:[function(_dereq_,module,exports){arguments[4][23][0].apply(exports,arguments)},{dup:23}],43:[function(_dereq_,module,exports){arguments[4][24][0].apply(exports,arguments)},{dup:24}],44:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],45:[function(_dereq_,module,exports){arguments[4][28][0].apply(exports,arguments)},{dup:28}],46:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");var isBuf=_dereq_(\"./is-buffer\");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if(\"object\"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&\"object\"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&\"object\"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./is-buffer\":48,isarray:43}],47:[function(_dereq_,module,exports){var debug=_dereq_(\"debug\")(\"socket.io-parser\");var json=_dereq_(\"json3\");var isArray=_dereq_(\"isarray\");var Emitter=_dereq_(\"component-emitter\");var binary=_dereq_(\"./binary\");var isBuf=_dereq_(\"./is-buffer\");exports.protocol=4;exports.types=[\"CONNECT\",\"DISCONNECT\",\"EVENT\",\"BINARY_EVENT\",\"ACK\",\"BINARY_ACK\",\"ERROR\"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug(\"encoding packet %j\",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str=\"\";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+=\"-\"}if(obj.nsp&&\"/\"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=\",\";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=\",\";str+=json.stringify(obj.data)}debug(\"encoded %j as %s\",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if(\"string\"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit(\"decoded\",packet)}}else{this.emit(\"decoded\",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error(\"got binary data when not reconstructing a packet\")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit(\"decoded\",packet)}}}else{throw new Error(\"Unknown type: \"+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf=\"\";while(str.charAt(++i)!=\"-\"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!=\"-\"){throw new Error(\"Illegal attachments\")}p.attachments=Number(buf)}if(\"/\"==str.charAt(i+1)){p.nsp=\"\";while(++i){var c=str.charAt(i);if(\",\"==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp=\"/\"}var next=str.charAt(i+1);if(\"\"!==next&&Number(next)==next){p.id=\"\";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug(\"decoded %s as %j\",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:\"parser error\"}}},{\"./binary\":46,\"./is-buffer\":48,\"component-emitter\":49,debug:39,isarray:43,json3:50}],48:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],49:[function(_dereq_,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],50:[function(_dereq_,module,exports){(function(global){(function(){var isLoader=typeof define===\"function\"&&define.amd;var objectTypes={\"function\":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global==\"object\"&&global;if(freeGlobal&&(freeGlobal[\"global\"]===freeGlobal||freeGlobal[\"window\"]===freeGlobal||freeGlobal[\"self\"]===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root[\"Object\"]());exports||(exports=root[\"Object\"]());var Number=context[\"Number\"]||root[\"Number\"],String=context[\"String\"]||root[\"String\"],Object=context[\"Object\"]||root[\"Object\"],Date=context[\"Date\"]||root[\"Date\"],SyntaxError=context[\"SyntaxError\"]||root[\"SyntaxError\"],TypeError=context[\"TypeError\"]||root[\"TypeError\"],Math=context[\"Math\"]||root[\"Math\"],nativeJSON=context[\"JSON\"]||root[\"JSON\"];if(typeof nativeJSON==\"object\"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name==\"bug-string-char-index\"){isSupported=\"a\"[0]!=\"a\"}else if(name==\"json\"){isSupported=has(\"json-stringify\")&&has(\"json-parse\")}else{var value,serialized='{\"a\":[1,true,false,null,\"\\\\u0000\\\\b\\\\n\\\\f\\\\r\\\\t\"]}';if(name==\"json-stringify\"){var stringify=exports.stringify,stringifySupported=typeof stringify==\"function\"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)===\"0\"&&stringify(new Number)===\"0\"&&stringify(new String)=='\"\"'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)===\"1\"&&stringify([value])==\"[1]\"&&stringify([undef])==\"[null]\"&&stringify(null)==\"null\"&&stringify([undef,getClass,null])==\"[null,null,null]\"&&stringify({a:[value,true,false,null,\"\\x00\\b\\n\\f\\r\t\"]})==serialized&&stringify(null,value)===\"1\"&&stringify([1,2],null,1)==\"[\\n 1,\\n 2\\n]\"&&stringify(new Date(-864e13))=='\"-271821-04-20T00:00:00.000Z\"'&&stringify(new Date(864e13))=='\"+275760-09-13T00:00:00.000Z\"'&&stringify(new Date(-621987552e5))=='\"-000001-01-01T00:00:00.000Z\"'&&stringify(new Date(-1))=='\"1969-12-31T23:59:59.999Z\"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name==\"json-parse\"){var parse=exports.parse;if(typeof parse==\"function\"){try{if(parse(\"0\")===0&&!parse(false)){value=parse(serialized);var parseSupported=value[\"a\"].length==5&&value[\"a\"][0]===1;if(parseSupported){try{parseSupported=!parse('\"\t\"')}catch(exception){}if(parseSupported){try{parseSupported=parse(\"01\")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse(\"1.\")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has(\"json\")){var functionClass=\"[object Function]\",dateClass=\"[object Date]\",numberClass=\"[object Number]\",stringClass=\"[object String]\",arrayClass=\"[object Array]\",booleanClass=\"[object Boolean]\";var charIndexBuggy=has(\"bug-string-char-index\");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=[\"valueOf\",\"toString\",\"toLocaleString\",\"propertyIsEnumerable\",\"isPrototypeOf\",\"hasOwnProperty\",\"constructor\"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!=\"function\"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property==\"prototype\")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property==\"prototype\")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property==\"prototype\")&&isProperty.call(object,property)&&!(isConstructor=property===\"constructor\")){callback(property)}}if(isConstructor||isProperty.call(object,property=\"constructor\")){callback(property)}}}return forEach(object,callback)};if(!has(\"json-stringify\")){var Escapes={92:\"\\\\\\\\\",34:'\\\\\"',8:\"\\\\b\",12:\"\\\\f\",10:\"\\\\n\",13:\"\\\\r\",9:\"\\\\t\"};var leadingZeroes=\"000000\";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix=\"\\\\u00\";var quote=function(value){var result='\"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(\"\"):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'\"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value==\"object\"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,\"toJSON\")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?\"-\":\"+\")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+\"-\"+toPaddedString(2,month+1)+\"-\"+toPaddedString(2,date)+\"T\"+toPaddedString(2,hours)+\":\"+toPaddedString(2,minutes)+\":\"+toPaddedString(2,seconds)+\".\"+toPaddedString(3,milliseconds)+\"Z\"}else{value=null}}else if(typeof value.toJSON==\"function\"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,\"toJSON\"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return\"null\"}className=getClass.call(value);if(className==booleanClass){return\"\"+value}else if(className==numberClass){return value>-1/0&&value<1/0?\"\"+value:\"null\"}else if(className==stringClass){return quote(\"\"+value)}if(typeof value==\"object\"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?\"null\":element)}result=results.length?whitespace?\"[\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"]\":\"[\"+results.join(\",\")+\"]\":\"[]\"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+\":\"+(whitespace?\" \":\"\")+element)}});result=results.length?whitespace?\"{\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"}\":\"{\"+results.join(\",\")+\"}\":\"{}\"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace=\"\",width>10&&(width=10);whitespace.length<width;whitespace+=\" \");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize(\"\",(value={},value[\"\"]=source,value),callback,properties,whitespace,\"\",[])}}if(!has(\"json-parse\")){var fromCharCode=String.fromCharCode;var Unescapes={92:\"\\\\\",34:'\"',47:\"/\",98:\"\\b\",116:\"\t\",110:\"\\n\",102:\"\\f\",114:\"\\r\"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value=\"@\",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode(\"0x\"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)==\"true\"){Index+=4;return true}else if(source.slice(Index,Index+5)==\"false\"){Index+=5;return false}else if(source.slice(Index,Index+4)==\"null\"){Index+=4;return null}abort()}}return\"$\"};var get=function(value){var results,hasMembers;if(value==\"$\"){abort()}if(typeof value==\"string\"){if((charIndexBuggy?value.charAt(0):value[0])==\"@\"){return value.slice(1)}if(value==\"[\"){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"]\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"]\"){abort()}}else{abort()}}if(value==\",\"){abort()}results.push(get(value))}return results}else if(value==\"{\"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"}\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"}\"){abort()}}else{abort()}}if(value==\",\"||typeof value!=\"string\"||(charIndexBuggy?value.charAt(0):value[0])!=\"@\"||lex()!=\":\"){abort()}results[value.slice(1)]=get(lex())\n}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value==\"object\"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=\"\"+source;result=get(lex());if(lex()!=\"$\"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[\"\"]=result,value),\"\",callback):result}}}exports[\"runInContext\"]=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root[\"JSON3\"],isRestored=false;var JSON3=runInContext(root,root[\"JSON3\"]={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root[\"JSON3\"]=previousJSON;nativeJSON=previousJSON=null}return JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],51:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[31])(31)});\n\n    \n      ;var weight = document.getElementById('weight');\n      var socket = io('http://{{ip}}:4003');\n      socket.on('getWeight', function(msg) {\n        weight.innerHTML = msg;\n    \n      }); \n    }, 1000);\n    </script>\n\n  </body>\n</html>\n","x":600.9642486572266,"y":1565.2975807189941,"wires":[["362fcfe.9c0183"]]},{"id":"362fcfe.9c0183","type":"http response","z":"7e40a951.76a278","name":"","x":752.0357284545898,"y":1563.154688835144,"wires":[]},{"id":"560b79bb.47a358","type":"function","z":"7e40a951.76a278","name":"set ip","func":"msg.ip = global.get('ip');\nreturn msg;","outputs":1,"noerr":0,"x":458.1071357727051,"y":1566.3689918518066,"wires":[["8827178b.2d78d8"]]},{"id":"637ddc6c.c56934","type":"http in","z":"7e40a951.76a278","name":"","url":"/getsnapshot","method":"get","swaggerDoc":"","x":179.33331298828125,"y":1485.333251953125,"wires":[["18cb1be.1b081e4","dc09f774.e9dcf8"]]},{"id":"c90527e1.a5c3b8","type":"function","z":"7e40a951.76a278","name":"","func":"var max = 1;\nvar min = 101;\n\nvar img = (Math.random() * (max - min) + min).toFixed();\n\nmsg.payload = \"/distr/data/noCar/\" + img + \".jpg\";\nmsg.filename = msg.payload;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":617.7500076293945,"y":1427.7223052978516,"wires":[["959194d.fe3f168"]]},{"id":"959194d.fe3f168","type":"file in","z":"7e40a951.76a278","name":"noCar","filename":"","format":"","x":754.4166488647461,"y":1431.055679321289,"wires":[["3f7995f9.4bd61a"]]},{"id":"2350f5c6.f6058a","type":"function","z":"7e40a951.76a278","name":"","func":"var max = 1;\nvar min = 15;\n\nvar img = (Math.random() * (max - min) + min).toFixed();\n\nmsg.payload = \"/distr/data/front/\" + img + \".jpg\";\nmsg.filename = msg.payload;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":614.2777328491211,"y":1463.9724426269531,"wires":[["fc5261ac.baddf"]]},{"id":"fc5261ac.baddf","type":"file in","z":"7e40a951.76a278","name":"front","filename":"","format":"","x":754.6943588256836,"y":1469.8058166503906,"wires":[["3f7995f9.4bd61a"]]},{"id":"18cb1be.1b081e4","type":"switch","z":"7e40a951.76a278","name":"","property":"w_demo","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"gt","v":"0","vt":"num"}],"checkall":"true","outputs":2,"x":475.25000762939453,"y":1453.000015258789,"wires":[["c90527e1.a5c3b8"],["2350f5c6.f6058a"]]},{"id":"6b93152d.2fe48c","type":"function","z":"7e40a951.76a278","name":"w_demo","func":"flow.set(\"w_demo\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":208.75,"y":377.5,"wires":[[]]},{"id":"b210e3b0.6cd38","type":"http response","z":"7e40a951.76a278","name":"","x":1046.5000305175781,"y":1429.250153541565,"wires":[]},{"id":"10ae9393.49652c","type":"function","z":"7e40a951.76a278","name":"","func":"var sn = {\n            snapshot: msg.payload\n        }   \nmsg.payload = sn;\nreturn msg;","outputs":1,"noerr":0,"x":905.2500267028809,"y":1469.2501525878906,"wires":[["b210e3b0.6cd38","cd010586.396108"]]},{"id":"bd177e9e.266d","type":"function","z":"7e40a951.76a278","name":"","func":"var max = 1;\nvar min = 101;\n\nvar img = (Math.random() * (max - min) + min).toFixed();\n\nmsg.payload = \"/distr/data/noCar/\" + img + \".jpg\";\nmsg.filename = msg.payload;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1692.749984741211,"y":943.75,"wires":[["3f67dac3.3253d6"]]},{"id":"3f67dac3.3253d6","type":"file in","z":"7e40a951.76a278","name":"noCar","filename":"","format":"","x":1829.4166259765625,"y":947.0833740234375,"wires":[["c6e50ff2.563eb"]]},{"id":"50d41ba5.f92974","type":"function","z":"7e40a951.76a278","name":"","func":"var max = 1;\nvar min = 15;\n\nvar img = (Math.random() * (max - min) + min).toFixed();\n\nmsg.payload = \"/distr/data/front/\" + img + \".jpg\";\nmsg.filename = msg.payload;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1693.0277099609375,"y":996.2501373291016,"wires":[["56bafc72.bb5ab4"]]},{"id":"56bafc72.bb5ab4","type":"file in","z":"7e40a951.76a278","name":"front","filename":"","format":"","x":1829.694351196289,"y":999.5835113525391,"wires":[["c6e50ff2.563eb"]]},{"id":"1a3b210.990a3df","type":"switch","z":"7e40a951.76a278","name":"","property":"w_demo","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"gt","v":"0","vt":"num"}],"checkall":"true","outputs":2,"x":1543.7500114440918,"y":970.2777252197266,"wires":[["bd177e9e.266d"],["50d41ba5.f92974"]]},{"id":"b460f3c7.3ecb7","type":"function","z":"7e40a951.76a278","name":"","func":"var sn = {\n            snapshot: msg.payload\n        }   \nmsg.payload = sn;\nreturn msg;","outputs":1,"noerr":0,"x":2111.25,"y":972.2777709960938,"wires":[["aab814ae.97cbb8","efbdc9fd.7aa9a8"]]},{"id":"dc09f774.e9dcf8","type":"debug","z":"7e40a951.76a278","name":"","active":false,"console":"false","complete":"true","x":462.74999237060547,"y":1494.25,"wires":[]},{"id":"cd010586.396108","type":"debug","z":"7e40a951.76a278","name":"","active":false,"console":"false","complete":"true","x":1047.7500305175781,"y":1469.2500324249268,"wires":[]},{"id":"efbdc9fd.7aa9a8","type":"debug","z":"7e40a951.76a278","name":"Camera 2","active":false,"console":"true","complete":"payload","x":2329,"y":1000,"wires":[]},{"id":"b64ce12a.2a2b8","type":"debug","z":"7e40a951.76a278","name":"Camera 3","active":false,"console":"true","complete":"payload","x":2364,"y":523,"wires":[]},{"id":"bf0ad7ce.389cb8","type":"debug","z":"7e40a951.76a278","name":"IN event","active":false,"console":"false","complete":"payload","x":1229,"y":790,"wires":[]},{"id":"a5c41d59.5e9a4","type":"http in","z":"7e40a951.76a278","name":"","url":"/getsnapshot_2","method":"get","swaggerDoc":"","x":168,"y":1371,"wires":[["f0ddee5f.31442"]]},{"id":"de0e35.20b5c1c8","type":"function","z":"7e40a951.76a278","name":"","func":"var max = 1;\nvar min = 15;\n\nvar img = (Math.random() * (max - min) + min).toFixed();\n\nmsg.payload = \"/distr/data/front/\" + img + \".jpg\";\nmsg.filename = msg.payload;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":618.7500095367432,"y":1336.7500171661377,"wires":[["df929ef5.322b8"]]},{"id":"df929ef5.322b8","type":"file in","z":"7e40a951.76a278","name":"front","filename":"","format":"","x":755.4166431427002,"y":1342.5833921432495,"wires":[["52c3ad63.1c2224"]]},{"id":"f0ddee5f.31442","type":"switch","z":"7e40a951.76a278","name":"","property":"w_demo","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"gt","v":"0","vt":"num"}],"checkall":"true","outputs":2,"x":472.22228622436523,"y":1327.027587890625,"wires":[["79d705c2.33a80c"],["de0e35.20b5c1c8"]]},{"id":"79d705c2.33a80c","type":"function","z":"7e40a951.76a278","name":"","func":"var max = 1;\nvar min = 101;\n\nvar img = (Math.random() * (max - min) + min).toFixed();\n\nmsg.payload = \"/distr/data/noCar/\" + img + \".jpg\";\nmsg.filename = msg.payload;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":618.4722766876221,"y":1305.4998626708984,"wires":[["13ffe008.d5eac"]]},{"id":"13ffe008.d5eac","type":"file in","z":"7e40a951.76a278","name":"noCar","filename":"","format":"","x":755.1389179229736,"y":1308.833236694336,"wires":[["52c3ad63.1c2224"]]},{"id":"b79053bb.b9768","type":"function","z":"7e40a951.76a278","name":"","func":"//var ph = \"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADtSURBVFiFY+wRkPnPMICAaSAtH3XAqANGHcDAwMDAQk3Dit8/Jkpdr6AsdR0gY2nGwMjMTJZeih1gVpDNYFtfQbZ+itKAgrM9g01tGcPtLTsYVvmGkWUG2SEgoCjP4D1nKsPbm7cZtqfnM/z+9o0yB5CSgFi5uBj8l85lYGBgYNgYnQy3HDlxkewAYoGsjSWDYXoSg7C6KsO6sDiGD/cfkmwpRQ4I27yKgYGBgeFwYwfDg70HKbKcLAes8g1j+P/3L8OT46cotpwsBzw+cpwqFsMA42iLaKAdMOCV0YCHwKgDBtwBo+XAqANGHQAADwk7UsL4LxEAAAAASUVORK5CYII=\";\n\n\nvar sn = {\n            snapshot: msg.payload\n            //snapshot:ph\n        } ; \n        \n        \n        \n        \nmsg.payload = sn;\nreturn msg;","outputs":1,"noerr":0,"x":907.2223072052002,"y":1364.5277271270752,"wires":[["83843450.542798","12809a4e.174e86"]]},{"id":"83843450.542798","type":"http response","z":"7e40a951.76a278","name":"","x":1084.7222900390625,"y":1329.5277118682861,"wires":[]},{"id":"12809a4e.174e86","type":"debug","z":"7e40a951.76a278","name":"","active":false,"console":"false","complete":"true","x":1097.2223110198975,"y":1369.5276069641113,"wires":[]},{"id":"cf6566bc.f39b08","type":"http in","z":"7e40a951.76a278","name":"","url":"/getsnapshot_3","method":"get","swaggerDoc":"","x":182,"y":1224,"wires":[["64da5573.1ab42c"]]},{"id":"64da5573.1ab42c","type":"switch","z":"7e40a951.76a278","name":"","property":"w_demo","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"gt","v":"0","vt":"num"}],"checkall":"true","outputs":2,"x":474.22228622436523,"y":1228.027587890625,"wires":[["429269d3.178d48"],["af8dcf13.dc333"]]},{"id":"429269d3.178d48","type":"function","z":"7e40a951.76a278","name":"","func":"var max = 1;\nvar min = 101;\n\nvar img = (Math.random() * (max - min) + min).toFixed();\n\nmsg.payload = \"/distr/data/noCar/\" + img + \".jpg\";\nmsg.filename = msg.payload;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":620.4722766876221,"y":1206.4998626708984,"wires":[["3b26dfad.36f8b"]]},{"id":"af8dcf13.dc333","type":"function","z":"7e40a951.76a278","name":"","func":"var max = 1;\nvar min = 15;\n\nvar img = (Math.random() * (max - min) + min).toFixed();\n\nmsg.payload = \"/distr/data/front/\" + img + \".jpg\";\nmsg.filename = msg.payload;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":620.7500095367432,"y":1237.7500171661377,"wires":[["28db5779.b73fd8"]]},{"id":"3b26dfad.36f8b","type":"file in","z":"7e40a951.76a278","name":"noCar","filename":"","format":"","x":757.1389179229736,"y":1209.833236694336,"wires":[["720b509e.5a038"]]},{"id":"28db5779.b73fd8","type":"file in","z":"7e40a951.76a278","name":"front","filename":"","format":"","x":757.4166431427002,"y":1243.5833921432495,"wires":[["720b509e.5a038"]]},{"id":"daf2e640.3a68f8","type":"function","z":"7e40a951.76a278","name":"","func":"//var ph = \"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADtSURBVFiFY+wRkPnPMICAaSAtH3XAqANGHcDAwMDAQk3Dit8/Jkpdr6AsdR0gY2nGwMjMTJZeih1gVpDNYFtfQbZ+itKAgrM9g01tGcPtLTsYVvmGkWUG2SEgoCjP4D1nKsPbm7cZtqfnM/z+9o0yB5CSgFi5uBj8l85lYGBgYNgYnQy3HDlxkewAYoGsjSWDYXoSg7C6KsO6sDiGD/cfkmwpRQ4I27yKgYGBgeFwYwfDg70HKbKcLAes8g1j+P/3L8OT46cotpwsBzw+cpwqFsMA42iLaKAdMOCV0YCHwKgDBtwBo+XAqANGHQAADwk7UsL4LxEAAAAASUVORK5CYII=\";\n\n\nvar sn = {\n            snapshot: msg.payload\n            //snapshot:ph\n        } ; \n        \n        \n        \n        \nmsg.payload = sn;\nreturn msg;","outputs":1,"noerr":0,"x":909.2223072052002,"y":1265.5277271270752,"wires":[["b099b570.dfd418","84b381de.2d1c6"]]},{"id":"b099b570.dfd418","type":"http response","z":"7e40a951.76a278","name":"","x":1086.7222900390625,"y":1230.5277118682861,"wires":[]},{"id":"84b381de.2d1c6","type":"debug","z":"7e40a951.76a278","name":"","active":false,"console":"false","complete":"true","x":1099.2223110198975,"y":1270.5276069641113,"wires":[]},{"id":"cacfe9fe.00bed8","type":"function","z":"b686905e.e5876","name":"time_rasp","func":"var time = new Date();\nflow.set(\"time_rasp\", time);\n\nreturn msg;","outputs":1,"noerr":0,"x":265,"y":182,"wires":[["56d0821d.136b8c"]]},{"id":"922a59b9.1a02c8","type":"inject","z":"b686905e.e5876","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":107,"y":186,"wires":[["cacfe9fe.00bed8"]]},{"id":"56d0821d.136b8c","type":"function","z":"b686905e.e5876","name":"sub time","func":"var weigth_time = flow.get(\"weigth_time\");\nvar time_rasp = flow.get(\"time_rasp\");\n\nvar sub = time_rasp - weigth_time;\n//msg.payload = {\n//    sub: time_rasp - weigth_time,\n//    weigth_time: weigth_time,\n//    time_rasp: time_rasp\n//}\n\n    if(sub > 5000){\n    msg.payload = 0;\n    return msg;\n    }\n","outputs":1,"noerr":0,"x":432,"y":185,"wires":[["cb74121f.51e39"]]},{"id":"cb74121f.51e39","type":"debug","z":"b686905e.e5876","name":"","active":false,"console":"false","complete":"false","x":591,"y":187,"wires":[]},{"id":"5b29118d.c075c","type":"function","z":"1ae68ce0.e5e003","name":"time_rasp","func":"var time = new Date();\nflow.set(\"time_rasp\", time);\n\nreturn msg;","outputs":1,"noerr":0,"x":287,"y":405,"wires":[["111c229.b96b8dd"]]},{"id":"4e65e7bd.22f238","type":"inject","z":"1ae68ce0.e5e003","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":129,"y":409,"wires":[["5b29118d.c075c"]]},{"id":"111c229.b96b8dd","type":"function","z":"1ae68ce0.e5e003","name":"sub time","func":"var weigth_time = flow.get(\"weigth_time\");\nvar time_rasp = flow.get(\"time_rasp\");\n\nvar sub = time_rasp - weigth_time;\n//msg.payload = {\n//    sub: time_rasp - weigth_time,\n//    weigth_time: weigth_time,\n//    time_rasp: time_rasp\n//}\n\n    if(sub > 5000){\n    msg.payload = 0;\n    return msg;\n    }\n","outputs":1,"noerr":0,"x":466,"y":401,"wires":[["365d54d8.457dec"]]},{"id":"365d54d8.457dec","type":"debug","z":"1ae68ce0.e5e003","name":"","active":true,"console":"false","complete":"false","x":613,"y":410,"wires":[]},{"id":"eb0818d3.b47c78","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"transactionWaybill","payloadType":"flow","repeat":"","crontab":"","once":false,"x":143,"y":990,"wires":[["5d0aa116.156df"]]},{"id":"5d0aa116.156df","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":326,"y":992,"wires":[]},{"id":"1cea26c0.8b28d9","type":"http request","z":"7e40a951.76a278","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"b0397653.651578","x":2173,"y":793,"wires":[["8b1630d7.bf822"]]},{"id":"420761d3.08abf","type":"function","z":"7e40a951.76a278","name":"","func":"msg.url = \"http://176.9.9.121:8080/ords/demo_ettn/iot_cli/events/log\";\nreturn msg;","outputs":1,"noerr":0,"x":2005,"y":794,"wires":[["1cea26c0.8b28d9"]]},{"id":"2a0696ea.adf72a","type":"comment","z":"7e40a951.76a278","name":"Відправка на сервер Польща","info":"","x":2113,"y":755,"wires":[]},{"id":"410e899c.339f38","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1648,"y":804,"wires":[["bd177e9e.266d"]]},{"id":"bcc2a81.5b9ff58","type":"link out","z":"7e40a951.76a278","name":"","links":["19b63fbe.0bae7"],"x":710.0000047683716,"y":898.5714302062988,"wires":[]},{"id":"73366b29.e9dfb4","type":"json","z":"7e40a951.76a278","name":"","x":1035,"y":765,"wires":[["bf0ad7ce.389cb8"]]},{"id":"6e60c70c.3d5a28","type":"inject","z":"e9f10ed.2f840f","name":"","topic":"","payload":"","payloadType":"date","repeat":"300","crontab":"","once":false,"x":138,"y":172,"wires":[["5548c890.e78b38"]]},{"id":"5548c890.e78b38","type":"function","z":"e9f10ed.2f840f","name":"","func":"msg.payload = {\n    \"login\":\"user\",\n    \"password\":\"user\",\n    \"name\":\"new_Demo_2\",\n    \"serial\": \"1921680102\",\n    \"ip\":\"176.32.13.110\",\n    \"port\": \"4000\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBwb3J0IiwiaWF0IjoxNjAzNzA5ODU1fQ.9Qz2hbEkoWqyRFAMZ_HQw94-lK9UBRLGkokxkOR6rMo\"\n}\n\nflow.set(\"serial\",msg.payload.serial);\nflow.set(\"ip\",msg.payload.ip);\nreturn msg;","outputs":1,"noerr":0,"x":275,"y":171,"wires":[["5b35fac0.e09bb4","d9a7fbf2.caa1a8"]]},{"id":"5b35fac0.e09bb4","type":"debug","z":"e9f10ed.2f840f","name":"","active":true,"console":"false","complete":"false","x":470,"y":210,"wires":[]},{"id":"783456ed.1a92c8","type":"http request","z":"e9f10ed.2f840f","name":"","method":"POST","ret":"obj","url":"http://demo.skelya.online:8080/ords/demo_ettn/v1/auth_dev","tls":"","x":713,"y":164,"wires":[["53c87dc.3002e84"]]},{"id":"7cb450bf.ef25c","type":"debug","z":"e9f10ed.2f840f","name":"","active":true,"console":"false","complete":"false","x":1047,"y":160,"wires":[]},{"id":"df35c3b7.8c59b","type":"http in","z":"e9f10ed.2f840f","name":"","url":"/post/serial","method":"post","swaggerDoc":"","x":179,"y":385,"wires":[["59bc6ff5.219da","9877cc3e.63ce8"]]},{"id":"59bc6ff5.219da","type":"debug","z":"e9f10ed.2f840f","name":"","active":true,"console":"false","complete":"true","x":394,"y":349,"wires":[]},{"id":"9877cc3e.63ce8","type":"function","z":"e9f10ed.2f840f","name":"","func":"var serial_post = msg.payload.serial;\nvar serial_flow = flow.get(\"serial\");\n\n\n\nif(serial_post === serial_flow){\n\n\n\n    msg.payload = {\"status\":\"1\"};\n\n} else {\n    msg.payload = {\"status\":\"0\"};\n}\n\n\nmsg.serial_post = serial_post;\n\n\nflow.set(\"autentification_block\", 1);\nreturn msg;","outputs":1,"noerr":0,"x":524,"y":388,"wires":[["dbd57634.6194f8","11f458a5.9b9237"]]},{"id":"dbd57634.6194f8","type":"http response","z":"e9f10ed.2f840f","name":"","x":755,"y":378,"wires":[]},{"id":"11f458a5.9b9237","type":"debug","z":"e9f10ed.2f840f","name":"","active":true,"console":"false","complete":"true","x":647,"y":340,"wires":[]},{"id":"310197f7.10b748","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":137,"y":29,"wires":[["43c7a19e.2c524"]]},{"id":"d9a7fbf2.caa1a8","type":"switch","z":"e9f10ed.2f840f","name":"","property":"autentification_block","propertyType":"flow","rules":[{"t":"neq","v":"1","vt":"num"}],"checkall":"true","outputs":1,"x":479,"y":170,"wires":[["783456ed.1a92c8"]]},{"id":"53c87dc.3002e84","type":"function","z":"e9f10ed.2f840f","name":"","func":"flow.set(\"autentification_block\", 0);\nreturn msg;","outputs":1,"noerr":0,"x":859,"y":168,"wires":[["7cb450bf.ef25c"]]},{"id":"8f4620a8.2b1f6","type":"inject","z":"e9f10ed.2f840f","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":684,"y":254,"wires":[["53c87dc.3002e84"]]},{"id":"48c6d386.2f9cec","type":"http in","z":"e9f10ed.2f840f","name":"","url":"/get/device","method":"get","swaggerDoc":"","x":178.75,"y":556.25,"wires":[["22ef58c.5a9bfa8","7362b18c.242e5"]]},{"id":"22ef58c.5a9bfa8","type":"function","z":"e9f10ed.2f840f","name":"","func":"msg.payload = {\n  \"getawey_serial\": \"00000000db95b409\",\n  \"devices\": [\n    {\n      \"name\": \"автоваги демо\",\n      \"type\": \"scale\",\n      \"sybtype\": \"avto\",\n      \"guid\": \"53ca4216-7b59-4266-9ae5-d32a4420a8cf\"\n    },\n    {\n      \"name\": \"Відеокамера демо №1\",\n      \"type\": \"videocamera\",\n      \"sybtype\": \"\",\n      \"guid\": \"1f2c9c62-f044-4223-8745-b92707192fc4\"\n    },\n    {\n      \"name\": \"Відеокамера демо 2\",\n      \"type\": \"videocamera\",\n      \"sybtype\": \"\",\n      \"guid\": \"69d72a02-9833-4317-87e9-0c007512b53a\"\n    },\n    {\n      \"name\": \"Відеокамера демо №3\",\n      \"type\": \"videocamera\",\n      \"sybtype\": \"\",\n      \"guid\": \"43679714-5a00-4ad1-b7b9-e213ec951fdf\"\n    }\n  ]\n}\nreturn msg;","outputs":1,"noerr":0,"x":523.75,"y":559.25,"wires":[["b487d7fd.2b2128","306229ef.ddf6b6"]]},{"id":"b487d7fd.2b2128","type":"http response","z":"e9f10ed.2f840f","name":"","x":754.75,"y":549.25,"wires":[]},{"id":"7362b18c.242e5","type":"debug","z":"e9f10ed.2f840f","name":"","active":true,"console":"false","complete":"true","x":413.75,"y":508.75,"wires":[]},{"id":"306229ef.ddf6b6","type":"debug","z":"e9f10ed.2f840f","name":"","active":true,"console":"false","complete":"true","x":648.75,"y":515,"wires":[]},{"id":"4be2a212.78554c","type":"inject","z":"e9f10ed.2f840f","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":211.25,"y":447.5,"wires":[["22ef58c.5a9bfa8"]]},{"id":"3ee1159f.a2016a","type":"delay","z":"7e40a951.76a278","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":162.14285278320312,"y":252.71428871154785,"wires":[["5a8f91ac.1655f","cf249c03.d3375"]]},{"id":"60678b2.2761774","type":"http in","z":"7e40a951.76a278","name":"Serialgel_Weight","url":"/scale/88348A32BD3D149FE055000000000001/getWeight","method":"get","swaggerDoc":"","x":122,"y":899,"wires":[["3e6b07be.b2de28","ba8056f7.763aa8"]]},{"id":"febaeb8c.bc7ab8","type":"http in","z":"7e40a951.76a278","name":"Serialgel_/getsnapshot","url":"/scale/7FF53459E8E9131CE0533300000ABADC/getsnapshot","method":"get","swaggerDoc":"","x":154,"y":1188,"wires":[["64da5573.1ab42c"]]},{"id":"f22f4c15.35174","type":"http in","z":"7e40a951.76a278","name":"Serialgel_/getsnapshot","url":"/scale/69d72a02-9833-4317-87e9-0c007512b53a/getsnapshot","method":"get","swaggerDoc":"","x":143,"y":1334,"wires":[["f0ddee5f.31442"]]},{"id":"edd4a05.82fa86","type":"http in","z":"7e40a951.76a278","name":"Serialgel_/getsnapshot","url":"/scale/43679714-5a00-4ad1-b7b9-e213ec951fdf/getsnapshot","method":"get","swaggerDoc":"","x":153,"y":1450,"wires":[["18cb1be.1b081e4"]]},{"id":"d2a8afd2.08bf5","type":"inject","z":"b686905e.e5876","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":111,"y":252,"wires":[["496da397.a4ee1c"]]},{"id":"3e08cea2.26a6d2","type":"debug","z":"b686905e.e5876","name":"","active":false,"console":"false","complete":"false","x":442,"y":251,"wires":[]},{"id":"496da397.a4ee1c","type":"function","z":"b686905e.e5876","name":"","func":"var weight_1 = [0,0,0,0,0,1000,3260,7380,11420,15620,22460,29440,32340,47000,47000,47000,46850,46850,46850,46850,46850,46850,46850,46850,46850,46850, 47000, 47000, 47000, 47000, 32040, 21600, 11200, 4360, 1300, 580, 120,80,20,20,0,0,0]; \nvar weight_2 = [0,0,0,0,0,3200,7380,11560,15320,22440,32460,49000,61000,60850,60850,60850,60850,60850,60850,60850,60850,60850,60850,60850,60850,60850, 47000, 47000, 47000, 47000, 21400, 18600, 11200, 4360, 1300, 580, 120,80,20,20,0,0,0]; \nvar weight_3 = [0,0,0,0,0,250,250,750,1300,2700,4400,6300,9200,15600,23000,23000,22900,22900,22900,22900,22900,22900,22900,22900,22900,29000, 23000, 23000, 20000, 16000, 11000, 7400, 3200, 1200, 200, 80, 20,20,20,0,0,0,0]; \n\nvar module = flow.get(\"module_weight\");\n\n\nif(module == 1){\n    \n    var count = flow.get(\"count\");\n    \n    msg.payload = weight_1[count];\n    \n    count = count + 1;\n    flow.set(\"count\",count);\n    \n    \n    if(count == weight_1.length){\n      count = 0;  \n      flow.set(\"count\",0);\n      module = module + 1;\n      flow.set(\"module_weight\", module);\n        if(module == 4){\n           module = 1;\n           flow.set(\"module_weight\", module);\n        }\n      \n    }\n    \n    \n}else if(module == 2){\n    var count = flow.get(\"count\");\n    \n    msg.payload = weight_2[count];\n    count = count + 1;\n    flow.set(\"count\",count);\n    \n    \n    \n    if(count == weight_2.length){\n      count = 0;  \n      flow.set(\"count\",0);\n      module = module + 1;\n      flow.set(\"module_weight\", module);\n        if(module == 4){\n           module = 1;\n           flow.set(\"module_weight\", module);\n        }\n      \n    }\n    \n}else if(module == 3){\n    var count = flow.get(\"count\");\n    \n    msg.payload = weight_3[count];\n    count = count + 1;\n    flow.set(\"count\",count);\n    \n    \n    if(count == weight_3.length){\n      count = 0;  \n      flow.set(\"count\",0);\n      module = module + 1;\n      flow.set(\"module_weight\", module);\n        if(module == 4){\n           module = 1;\n           flow.set(\"module_weight\", module);\n        }\n  \n    }\n    \n    \n}\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":251,"y":253,"wires":[["3e08cea2.26a6d2","8f3b68e8.f25198"]]},{"id":"f1303d0c.b9a6f","type":"inject","z":"b686905e.e5876","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":74,"y":547,"wires":[["f8bb8809.079958"]]},{"id":"d0be16b.9f3bde8","type":"debug","z":"b686905e.e5876","name":"","active":true,"console":"false","complete":"false","x":355,"y":549,"wires":[]},{"id":"f8bb8809.079958","type":"function","z":"b686905e.e5876","name":"","func":"function randomInteger(min, max) {\n  // случайное число от min до (max+1)\n  let rand = min + Math.random() * (max + 1 - min);\n  return Math.floor(rand);\n}\n\n\nvar delta = [0,20,40,60,80,0];\n\nvar weigth = delta[randomInteger(1, 5)];\nmsg.payload = weigth;\nreturn msg;","outputs":1,"noerr":0,"x":206,"y":547,"wires":[["d0be16b.9f3bde8"]]},{"id":"720b509e.5a038","type":"base64","z":"7e40a951.76a278","name":"","action":"","property":"payload","x":885.7142562866211,"y":1212.8570537567139,"wires":[["daf2e640.3a68f8"]]},{"id":"52c3ad63.1c2224","type":"base64","z":"7e40a951.76a278","name":"","action":"","property":"payload","x":901.4285888671875,"y":1314.2857666015625,"wires":[["b79053bb.b9768"]]},{"id":"3f7995f9.4bd61a","type":"base64","z":"7e40a951.76a278","name":"","action":"","property":"payload","x":902.857177734375,"y":1430,"wires":[["10ae9393.49652c"]]},{"id":"c6e50ff2.563eb","type":"base64","z":"7e40a951.76a278","name":"","action":"","property":"payload","x":1974.2857360839844,"y":972.8571357727051,"wires":[["b460f3c7.3ecb7"]]},{"id":"7a3e71ae.491bb","type":"comment","z":"7e40a951.76a278","name":"Нове","info":"","x":111.42856407165527,"y":1631.4285085201263,"wires":[]},{"id":"6d7eaa51.77e334","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/barreir/e3d03060-62a1-5942-7140-59ed1f019000/opens_once","method":"post","swaggerDoc":"","x":390,"y":1715.7143440246582,"wires":[["aa4929f0.617d08","a517b2d9.54088"]]},{"id":"aa4929f0.617d08","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":825.7143325805664,"y":1715.7141523361206,"wires":[["95f452a5.f1711","367a37e8.0302f8"]]},{"id":"95f452a5.f1711","type":"http response","z":"7e40a951.76a278","name":"","x":952.8571624755859,"y":1718.5711364746094,"wires":[]},{"id":"a517b2d9.54088","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":825.7142372131348,"y":1757.1428270339966,"wires":[]},{"id":"a21b48a5.863198","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/barreir/e3d03060-62a1-5942-7140-59ed1f019000/opens_constantly","method":"post","swaggerDoc":"","x":397.1428527832031,"y":1794.2857880592346,"wires":[["7355d18d.52f49","50f753d.09fb7ac"]]},{"id":"7355d18d.52f49","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":828.5715103149414,"y":1821.4284181594849,"wires":[["e85d6c72.3ede5","6690c5d5.bdb19c"]]},{"id":"e85d6c72.3ede5","type":"http response","z":"7e40a951.76a278","name":"","x":954.2857685089111,"y":1818.5712928771973,"wires":[]},{"id":"50f753d.09fb7ac","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":828.571475982666,"y":1857.1427211761475,"wires":[]},{"id":"c84da04a.7751b","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/barreir/e3d03060-62a1-5942-7140-59ed1f019000/closes","method":"post","swaggerDoc":"","x":381.42857360839844,"y":1891.4285736083984,"wires":[["fc6cf462.602208","b848fbb7.588588"]]},{"id":"fc6cf462.602208","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":831.428653717041,"y":1899.9997749328613,"wires":[["9fac5957.7a8248","1635a6b9.1f6369"]]},{"id":"9fac5957.7a8248","type":"http response","z":"7e40a951.76a278","name":"","x":961.4285545349121,"y":1902.8569011688232,"wires":[]},{"id":"b848fbb7.588588","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":834.2858219146729,"y":1939.9998445510864,"wires":[]},{"id":"3495181a.c248c8","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/lights/7a4ccf4c-8d05-9080-b140-13141f019000/green","method":"post","swaggerDoc":"","x":334.2857131958008,"y":2345.71435546875,"wires":[["a172be2b.e1679","a236d7a9.9069e8"]]},{"id":"a172be2b.e1679","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":787.1429138183594,"y":2348.5712890625,"wires":[["d7dd0284.9dffd","afcb5904.a5f338"]]},{"id":"d7dd0284.9dffd","type":"http response","z":"7e40a951.76a278","name":"","x":898.571418762207,"y":2345.714493751526,"wires":[]},{"id":"a236d7a9.9069e8","type":"debug","z":"7e40a951.76a278","name":"1 green","active":true,"console":"false","complete":"true","x":797.1428527832031,"y":2379.999963760376,"wires":[]},{"id":"f46d7703.18c468","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/lights/7a4ccf4c-8d05-9080-b140-13141f019000/red","method":"post","swaggerDoc":"","x":328.57141304016113,"y":2424.285575866699,"wires":[["ecd94375.18b85","7b7c8a94.502d94"]]},{"id":"ecd94375.18b85","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":784.2857418060303,"y":2422.8568620681763,"wires":[["de40058e.0a3b28","cd953ce2.e06b"]]},{"id":"de40058e.0a3b28","type":"http response","z":"7e40a951.76a278","name":"","x":941.4285869598389,"y":2448.571252822876,"wires":[]},{"id":"7b7c8a94.502d94","type":"debug","z":"7e40a951.76a278","name":"1 red","active":true,"console":"false","complete":"true","x":710.0000152587891,"y":2462.857000350952,"wires":[]},{"id":"8d6dc465.34b448","type":"comment","z":"7e40a951.76a278","name":"Шлагбаум 1","info":"/device/barreir/e3d03060-62a1-5942-7140-59ed1f019000/opens_once\n/device/barreir/e3d03060-62a1-5942-7140-59ed1f019000/opens_constantly\n/device/barreir/e3d03060-62a1-5942-7140-59ed1f019000/closes","x":118.57142639160156,"y":1680.0000066757202,"wires":[]},{"id":"910267f1.f4b2e8","type":"comment","z":"7e40a951.76a278","name":"Світлофор 1","info":"/device/lights/7a4ccf4c-8d05-9080-b140-13141f019000/green\n/device/lights/7a4ccf4c-8d05-9080-b140-13141f019000/red","x":132.8571319580078,"y":2300.0001735687256,"wires":[]},{"id":"6c390f07.63d8d","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/lights/2190c77f-9f47-8fd1-f140-63c21f019000/green","method":"post","swaggerDoc":"","x":328.5714340209961,"y":2602.8573875427246,"wires":[["2cde7b6.2af5084","c565cdb0.10517"]]},{"id":"2cde7b6.2af5084","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":791.4286346435547,"y":2605.7143211364746,"wires":[["1042f8fe.5c0b67","f3cd3182.bf28d"]]},{"id":"1042f8fe.5c0b67","type":"http response","z":"7e40a951.76a278","name":"","x":931.4285945892334,"y":2608.57160282135,"wires":[]},{"id":"c565cdb0.10517","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":825.7143249511719,"y":2652.857385635376,"wires":[]},{"id":"b632a6c6.75bfb8","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/lights/2190c77f-9f47-8fd1-f140-63c21f019000/red","method":"post","swaggerDoc":"","x":322.85713958740234,"y":2687.1431283950806,"wires":[["da9edf53.b87c9","bb179bc1.4ad1a8"]]},{"id":"da9edf53.b87c9","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":778.5714683532715,"y":2685.7144145965576,"wires":[["810b9ddb.ce98b","420fd93f.137048"]]},{"id":"810b9ddb.ce98b","type":"http response","z":"7e40a951.76a278","name":"","x":935.7143135070801,"y":2711.4288053512573,"wires":[]},{"id":"bb179bc1.4ad1a8","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":704.2857418060303,"y":2725.7145528793335,"wires":[]},{"id":"da60070.66909f8","type":"comment","z":"7e40a951.76a278","name":"Світлофор 2","info":"/device/lights/2190c77f-9f47-8fd1-f140-63c21f019000/green\n/device/lights/2190c77f-9f47-8fd1-f140-63c21f019000/red","x":137.14285278320312,"y":2557.1432056427,"wires":[]},{"id":"8ed31271.36d1f","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/lights/f75b0b75-56ba-fe6c-f140-90081f019000/green","method":"post","swaggerDoc":"","x":347.1428451538086,"y":2874.2858543395996,"wires":[["5ad819b3.ffbc48","9d5d8857.b62c18"]]},{"id":"5ad819b3.ffbc48","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":800.0000457763672,"y":2877.1427879333496,"wires":[["ec2c0e70.62b33","5e37a19a.d60f8"]]},{"id":"ec2c0e70.62b33","type":"http response","z":"7e40a951.76a278","name":"","x":934.2857246398926,"y":2875.7140674591064,"wires":[]},{"id":"9d5d8857.b62c18","type":"debug","z":"7e40a951.76a278","name":"","active":false,"console":"false","complete":"true","x":801.4286651611328,"y":2912.857306957245,"wires":[]},{"id":"3dcae3.98aae51e","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/lights/f75b0b75-56ba-fe6c-f140-90081f019000/red","method":"post","swaggerDoc":"","x":341.42855072021484,"y":2955.7144479751587,"wires":[["ce5904a6.a3b838","c053e5e2.c16738"]]},{"id":"ce5904a6.a3b838","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":797.142879486084,"y":2954.2857341766357,"wires":[["ff4a2462.5dd018","4cb1077c.af1988"]]},{"id":"ff4a2462.5dd018","type":"http response","z":"7e40a951.76a278","name":"","x":932.857120513916,"y":2954.285982131958,"wires":[]},{"id":"c053e5e2.c16738","type":"debug","z":"7e40a951.76a278","name":"","active":false,"console":"false","complete":"true","x":722.8571529388428,"y":2994.2858724594116,"wires":[]},{"id":"a0003d3e.93c5c","type":"comment","z":"7e40a951.76a278","name":"Світлофор 3","info":"/device/lights/f75b0b75-56ba-fe6c-f140-90081f019000/green\n/device/lights/f75b0b75-56ba-fe6c-f140-90081f019000/red","x":145.71426391601562,"y":2828.571672439575,"wires":[]},{"id":"fa2443fc.87c06","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/barreir/fb003d3f-3cce-59c1-7140-c89b1f019000/opens_once","method":"post","swaggerDoc":"","x":390.00000953674316,"y":2015.7144243717194,"wires":[["8ccdda56.a19ff8","f152104d.62354"]]},{"id":"8ccdda56.a19ff8","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":841.4286155700684,"y":2007.142840385437,"wires":[["5b36625c.644adc","c7f999fb.1f5858"]]},{"id":"5b36625c.644adc","type":"http response","z":"7e40a951.76a278","name":"","x":1087.1429138183594,"y":2017.1426124572754,"wires":[]},{"id":"f152104d.62354","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":835.7142467498779,"y":2057.1429073810577,"wires":[]},{"id":"b10f6037.257ef","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/barreir/fb003d3f-3cce-59c1-7140-c89b1f019000/opens_constantly","method":"post","swaggerDoc":"","x":407.1428623199463,"y":2094.285868406296,"wires":[["109726a2.845689","731e7d23.67ddc4"]]},{"id":"109726a2.845689","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":838.5715198516846,"y":2121.428498506546,"wires":[["f2e454a7.05a198","d960b407.0b6a18"]]},{"id":"f2e454a7.05a198","type":"http response","z":"7e40a951.76a278","name":"","x":964.2857780456543,"y":2118.5713732242584,"wires":[]},{"id":"731e7d23.67ddc4","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":838.5714855194092,"y":2157.1428015232086,"wires":[]},{"id":"3798c36d.8dbb4c","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/barreir/fb003d3f-3cce-59c1-7140-c89b1f019000/closes","method":"post","swaggerDoc":"","x":365.71429443359375,"y":2190.000171661377,"wires":[["702f1069.e2e9c","8bb25f4f.04889"]]},{"id":"702f1069.e2e9c","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":841.4286632537842,"y":2199.9998552799225,"wires":[["5cd54437.68949c","60958948.dc5fb8"]]},{"id":"5cd54437.68949c","type":"http response","z":"7e40a951.76a278","name":"","x":971.4285640716553,"y":2202.8569815158844,"wires":[]},{"id":"8bb25f4f.04889","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":844.285831451416,"y":2239.9999248981476,"wires":[]},{"id":"b0e1e8cf.5c4e58","type":"comment","z":"7e40a951.76a278","name":"Шлагбаум 2","info":"/device/barreir/fb003d3f-3cce-59c1-7140-c89b1f019000/opens_once\n/device/barreir/fb003d3f-3cce-59c1-7140-c89b1f019000/opens_constantly\n/device/barreir/fb003d3f-3cce-59c1-7140-c89b1f019000/closes\n\n\nfb003d3f-3cce-59c1-7140-c89b1f019000","x":128.57143592834473,"y":1980.0000870227814,"wires":[]},{"id":"b929059d.8dc668","type":"http in","z":"7e40a951.76a278","name":"","url":"/device/board/a1604422-0f0c-ed3c-3540-72311f019000","method":"post","swaggerDoc":"","x":319.28572845458984,"y":3137.142822265625,"wires":[["a714cedf.c2ee4","e8f20078.91b2","cc3cecf.48ebd1"]]},{"id":"a714cedf.c2ee4","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = {\"status\":true};\nreturn msg;","outputs":1,"noerr":0,"x":792.1429290771484,"y":3139.999755859375,"wires":[["73dbf6dc.588958"]]},{"id":"73dbf6dc.588958","type":"http response","z":"7e40a951.76a278","name":"","x":926.4286079406738,"y":3138.571035385132,"wires":[]},{"id":"e8f20078.91b2","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":793.5715484619141,"y":3175.7142748832703,"wires":[]},{"id":"e45f58ff.096888","type":"comment","z":"7e40a951.76a278","name":"Tablo","info":"/device/board/{guid}\n\n/device/board/guid","x":117.85714721679688,"y":3091.4286403656006,"wires":[]},{"id":"d62fcd17.38d","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":371.99999999999994,"y":3447.999999999999,"wires":[["7cd03197.1155f"]]},{"id":"54bef288.37e71c","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":367.1428527832031,"y":3494.285888671875,"wires":[["1b4d4b35.1815b5"]]},{"id":"65dd75c8.5c4e4c","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":361.4285888671875,"y":3560,"wires":[["f1b25659.14d7a8"]]},{"id":"b8ec082a.81a258","type":"ui_template","z":"7e40a951.76a278","group":"b3259c0f.1d2d3","name":"Світлофор 2","order":1,"width":0,"height":0,"format":"<style>\n    .w3docs_tool_circle_2_1 {\n   width: 100px;\n   height: 100px;\n   background-color: {{msg.color_2_1}};\n   -moz-border-radius: 50%;\n   -webkit-border-radius: 50%;\n   border-radius: 50%;\n}\n    .w3docs_tool_circle_2_2 {\n   width: 100px;\n   height: 100px;\n   background-color: {{msg.color_2_2}};\n   -moz-border-radius: 50%;\n   -webkit-border-radius: 50%;\n   border-radius: 50%;\n}\n</style>\n\n<div class=\"w3docs_tool_circle_2_1\"></div>\n<div class=\"w3docs_tool_circle_2_2\"></div>\n\n\n","storeOutMessages":true,"fwdInMessages":true,"x":710.5714569091797,"y":3566.2859001159677,"wires":[["e07bf7d4.bd8a58"]]},{"id":"f1b25659.14d7a8","type":"function","z":"7e40a951.76a278","name":"Зелений","func":"//msg.color = \"#4ed134\"\nmsg.color_2_1 = \"#3cd134\";\nmsg.color_2_2 = \"#909090\";\n\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":510.85716029575883,"y":3557.7142857142862,"wires":[["b8ec082a.81a258"]]},{"id":"481f4a03.3a4274","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":356.5714416503906,"y":3606.285888671876,"wires":[["422bbbf7.cbcb14"]]},{"id":"422bbbf7.cbcb14","type":"function","z":"7e40a951.76a278","name":"Червоний","func":"msg.color_2_2 = \"red\";\nmsg.color_2_1 = \"#909090\";\n//msg.color = \"#3cd134\"\n\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":506.0000130789622,"y":3604.000174386162,"wires":[["b8ec082a.81a258"]]},{"id":"e07bf7d4.bd8a58","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":922.2857780456543,"y":3561.999906539918,"wires":[]},{"id":"174d576b.234759","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":345.71429443359375,"y":3692.857177734375,"wires":[["96502656.30efb8"]]},{"id":"abfeb0b9.e4d88","type":"ui_template","z":"7e40a951.76a278","group":"92261734.263388","name":"Світлофор 3","order":1,"width":0,"height":0,"format":"<style>\n    .w3docs_tool_circle_3_1 {\n   width: 100px;\n   height: 100px;\n   background-color: {{msg.color_3_1}};\n   -moz-border-radius: 50%;\n   -webkit-border-radius: 50%;\n   border-radius: 50%;\n}\n    .w3docs_tool_circle_3_2 {\n   width: 100px;\n   height: 100px;\n   background-color: {{msg.color_3_2}};\n   -moz-border-radius: 50%;\n   -webkit-border-radius: 50%;\n   border-radius: 50%;\n}\n</style>\n\n<div class=\"w3docs_tool_circle_3_1\"></div>\n<div class=\"w3docs_tool_circle_3_2\"></div>\n\n\n","storeOutMessages":true,"fwdInMessages":true,"x":694.8571624755859,"y":3699.1430778503427,"wires":[["955e123a.c3784"]]},{"id":"96502656.30efb8","type":"function","z":"7e40a951.76a278","name":"Зелений","func":"//msg.color = \"#4ed134\"\nmsg.color_3_1 = \"#3cd134\";\nmsg.color_3_2 = \"#909090\";\n\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":495.1428658621651,"y":3690.5714634486612,"wires":[["abfeb0b9.e4d88"]]},{"id":"b12ebf19.4f3f4","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":340.85714721679693,"y":3739.143066406251,"wires":[["395c823d.0ab53e"]]},{"id":"395c823d.0ab53e","type":"function","z":"7e40a951.76a278","name":"Червоний","func":"msg.color_3_2 = \"red\";\nmsg.color_3_1 = \"#909090\"\n//msg.color = \"#3cd134\"\n\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":490.2857186453684,"y":3736.857352120537,"wires":[["abfeb0b9.e4d88"]]},{"id":"955e123a.c3784","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":906.5714836120605,"y":3694.857084274293,"wires":[]},{"id":"f10dea09.8bd3b8","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":376.9047050476074,"y":3864.761777639389,"wires":[["61a9700e.6815e"]]},{"id":"33ace690.454eba","type":"ui_template","z":"7e40a951.76a278","group":"34456d59.5e5232","name":"Шлагбаум 1","order":0,"width":"9","height":"5","format":"\n<img src=  {{msg.payload}}>\n\n\n","storeOutMessages":true,"fwdInMessages":true,"x":761.1903953552246,"y":3891.9047391414642,"wires":[[]]},{"id":"f3befbb4.9b6ee8","type":"ui_template","z":"7e40a951.76a278","group":"a95c0781.59d588","name":"Шлагбаум 2","order":0,"width":"9","height":"5","format":"<img src=  {{msg.payload}}>\n\n","storeOutMessages":true,"fwdInMessages":true,"x":754.0476237705775,"y":4012.3809531075617,"wires":[[]]},{"id":"a6eaf03c.78f31","type":"http in","z":"7e40a951.76a278","name":"","url":"/hl_1","method":"get","swaggerDoc":"","x":158.33334350585938,"y":4292.857587814331,"wires":[["93aee38a.d046e"]]},{"id":"93aee38a.d046e","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = \"/distr/data/close.jpg\";\nmsg.filename = msg.payload;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":337.6547737121582,"y":4297.179157733917,"wires":[["74514c82.b63a14"]]},{"id":"74514c82.b63a14","type":"file in","z":"7e40a951.76a278","name":"close","filename":"","format":"","x":461.4642677307129,"y":4298.726555347443,"wires":[["e4273026.3e29d"]]},{"id":"e4273026.3e29d","type":"http response","z":"7e40a951.76a278","name":"","x":587.912727355957,"y":4298.528347492218,"wires":[]},{"id":"8116737f.db36b","type":"http in","z":"7e40a951.76a278","name":"","url":"/hl_2","method":"get","swaggerDoc":"","x":156.90476989746094,"y":4335.714626789093,"wires":[["87463509.78fee8"]]},{"id":"87463509.78fee8","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = \"/distr/data/open.png\";\nmsg.filename = msg.payload;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":336.22618103027344,"y":4334.322327136993,"wires":[["1c685835.53d238"]]},{"id":"1c685835.53d238","type":"file in","z":"7e40a951.76a278","name":"open","filename":"","format":"","x":462.89280700683594,"y":4333.011919498444,"wires":[["f3d7f29.178181"]]},{"id":"f3d7f29.178181","type":"http response","z":"7e40a951.76a278","name":"","x":586.4841918945312,"y":4331.385036945343,"wires":[]},{"id":"61a9700e.6815e","type":"function","z":"7e40a951.76a278","name":"close","func":"msg.payload = \"http://176.32.13.110:4000/api/platform/hl_1\";\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":556.9047164916992,"y":3866.1906640529633,"wires":[["33ace690.454eba"]]},{"id":"c82c6c3d.0bc94","type":"function","z":"7e40a951.76a278","name":"open","func":"msg.payload = \"http://176.32.13.110:4000/api/platform/hl_2\";\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":558.3332939147949,"y":3903.3332726955414,"wires":[["33ace690.454eba"]]},{"id":"b430fd0b.b9b41","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":371.1904411315918,"y":3909.0476281642914,"wires":[["c82c6c3d.0bc94"]]},{"id":"cf713725.3d6348","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":377.6190414428711,"y":4008.095413208008,"wires":[["ac4c182d.f93d38"]]},{"id":"ac4c182d.f93d38","type":"function","z":"7e40a951.76a278","name":"close","func":"msg.payload = \"http://176.32.13.110:4000/api/platform/hl_1\";\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":557.6190528869629,"y":4009.524299621582,"wires":[["f3befbb4.9b6ee8","857a5d98.bfebb"]]},{"id":"6facdc19.b3d864","type":"function","z":"7e40a951.76a278","name":"open","func":"msg.payload = \"http://176.32.13.110:4000/api/platform/hl_2\";\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":559.0476303100586,"y":4046.66690826416,"wires":[["f3befbb4.9b6ee8"]]},{"id":"e5ecf9c.6e75b08","type":"inject","z":"7e40a951.76a278","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":371.90477752685547,"y":4052.38126373291,"wires":[["6facdc19.b3d864"]]},{"id":"d31a02f4.4766c","type":"ui_template","z":"7e40a951.76a278","group":"6f959189.21a6a","name":"Світлофор 1","order":1,"width":"0","height":"0","format":"<style>\n    .w3docs_tool_circle_1_1 {\n   width: 100px;\n   height: 100px;\n   background-color: {{msg.color_1_1}};\n   -moz-border-radius: 50%;\n   -webkit-border-radius: 50%;\n   border-radius: 50%;\n}\n    .w3docs_tool_circle_1_2 {\n   width: 100px;\n   height: 100px;\n   background-color: {{msg.color_1_2}};\n   -moz-border-radius: 50%;\n   -webkit-border-radius: 50%;\n   border-radius: 50%;\n}\n</style>\n\n<div class=\"w3docs_tool_circle_1_1\"></div>\n<div class=\"w3docs_tool_circle_1_2\"></div>\n\n\n","storeOutMessages":true,"fwdInMessages":true,"x":721.1428680419922,"y":3454.285900115967,"wires":[["a5ef9ea7.2ffb2"]]},{"id":"7cd03197.1155f","type":"function","z":"7e40a951.76a278","name":"Зелений","func":"//msg.color = \"#4ed134\"\nmsg.color_1_1 = \"#3cd134\";\nmsg.color_1_2 = \"#909090\";\n\ndelete msg.req;\ndelete msg.res;\n\nreturn msg;","outputs":1,"noerr":0,"x":521.4285714285713,"y":3445.7142857142853,"wires":[["d31a02f4.4766c"]]},{"id":"1b4d4b35.1815b5","type":"function","z":"7e40a951.76a278","name":"Червоний","func":"msg.color_1_2 = \"red\";\nmsg.color_1_1 = \"#909090\";\n//msg.color = \"#3cd134\"\n\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":516.5714242117746,"y":3492.0001743861612,"wires":[["d31a02f4.4766c"]]},{"id":"a5ef9ea7.2ffb2","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":932.8571891784668,"y":3449.999906539917,"wires":[]},{"id":"a7705419.a67998","type":"link in","z":"7e40a951.76a278","name":"с1 з","links":["afcb5904.a5f338"],"x":225.7142791748047,"y":3434.285831451416,"wires":[["7cd03197.1155f"]]},{"id":"2cd8976a.669238","type":"link in","z":"7e40a951.76a278","name":"с1 ч","links":["cd953ce2.e06b"],"x":225.71430778503418,"y":3485.714298248291,"wires":[["1b4d4b35.1815b5"]]},{"id":"9ba29045.e228e","type":"link in","z":"7e40a951.76a278","name":"с2 з","links":["f3cd3182.bf28d"],"x":220,"y":3552.857177734375,"wires":[["f1b25659.14d7a8"]]},{"id":"a32f7d5a.ef78e","type":"link in","z":"7e40a951.76a278","name":"с2 ч","links":["420fd93f.137048"],"x":220.0000286102295,"y":3604.28564453125,"wires":[["422bbbf7.cbcb14"]]},{"id":"a8917320.90733","type":"link in","z":"7e40a951.76a278","name":"с3 з","links":["5e37a19a.d60f8"],"x":214.2857208251953,"y":3690,"wires":[["96502656.30efb8"]]},{"id":"3ca9506e.f20e7","type":"link in","z":"7e40a951.76a278","name":"с3 ч","links":["4cb1077c.af1988"],"x":214.2857494354248,"y":3741.428466796875,"wires":[["395c823d.0ab53e"]]},{"id":"afcb5904.a5f338","type":"link out","z":"7e40a951.76a278","name":"","links":["a7705419.a67998"],"x":874.285810470581,"y":2308.5714588165283,"wires":[]},{"id":"cd953ce2.e06b","type":"link out","z":"7e40a951.76a278","name":"","links":["2cd8976a.669238"],"x":1025.71435546875,"y":2391.4287109375,"wires":[]},{"id":"f3cd3182.bf28d","type":"link out","z":"7e40a951.76a278","name":"","links":["9ba29045.e228e"],"x":1091.4285714285713,"y":2607.142857142857,"wires":[]},{"id":"420fd93f.137048","type":"link out","z":"7e40a951.76a278","name":"","links":["a32f7d5a.ef78e"],"x":1094.2857142857142,"y":2654.285714285714,"wires":[]},{"id":"5e37a19a.d60f8","type":"link out","z":"7e40a951.76a278","name":"","links":["a8917320.90733"],"x":1115.7142839431763,"y":2861.4285583496094,"wires":[]},{"id":"4cb1077c.af1988","type":"link out","z":"7e40a951.76a278","name":"","links":["3ca9506e.f20e7"],"x":1110.0000157356262,"y":2942.857057571411,"wires":[]},{"id":"367a37e8.0302f8","type":"link out","z":"7e40a951.76a278","name":"1h open once","links":["dd56cb72.faf628"],"x":1021.6666666666665,"y":1669.9999999999998,"wires":[]},{"id":"6690c5d5.bdb19c","type":"link out","z":"7e40a951.76a278","name":"1h open","links":["945510d3.b8224"],"x":1031.6666259765625,"y":1781.6666259765625,"wires":[]},{"id":"1635a6b9.1f6369","type":"link out","z":"7e40a951.76a278","name":"1h close","links":["f79edc31.f9ced"],"x":1040,"y":1869.9998779296875,"wires":[]},{"id":"c7f999fb.1f5858","type":"link out","z":"7e40a951.76a278","name":"2h once","links":["59056533.a703bc"],"x":1078.333251953125,"y":1978.333251953125,"wires":[]},{"id":"d960b407.0b6a18","type":"link out","z":"7e40a951.76a278","name":"2h open","links":["37d14b2d.801f34"],"x":1078.333251953125,"y":2091.66650390625,"wires":[]},{"id":"60958948.dc5fb8","type":"link out","z":"7e40a951.76a278","name":"2h close","links":["f7544ac5.4523b8"],"x":1086.6666259765625,"y":2160,"wires":[]},{"id":"f79edc31.f9ced","type":"link in","z":"7e40a951.76a278","name":"","links":["1635a6b9.1f6369"],"x":91.66666412353516,"y":3828.3333225250244,"wires":[["61a9700e.6815e"]]},{"id":"945510d3.b8224","type":"link in","z":"7e40a951.76a278","name":"","links":["6690c5d5.bdb19c"],"x":83.33334159851074,"y":3878.333242416382,"wires":[["c82c6c3d.0bc94"]]},{"id":"dd56cb72.faf628","type":"link in","z":"7e40a951.76a278","name":"","links":["367a37e8.0302f8"],"x":81.66666412353516,"y":3963.333409309387,"wires":[["c82c6c3d.0bc94","7bd1be66.28b12"]]},{"id":"7bd1be66.28b12","type":"delay","z":"7e40a951.76a278","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":178.33334350585938,"y":3921.666666030884,"wires":[["61a9700e.6815e"]]},{"id":"f7544ac5.4523b8","type":"link in","z":"7e40a951.76a278","name":"","links":["60958948.dc5fb8"],"x":78.33333206176758,"y":4046.6665840148926,"wires":[["ac4c182d.f93d38"]]},{"id":"37d14b2d.801f34","type":"link in","z":"7e40a951.76a278","name":"","links":["d960b407.0b6a18"],"x":76.66666412353516,"y":4081.66650390625,"wires":[["6facdc19.b3d864"]]},{"id":"59056533.a703bc","type":"link in","z":"7e40a951.76a278","name":"","links":["c7f999fb.1f5858"],"x":76.66666412353516,"y":4121.66650390625,"wires":[["b2eee8e6.e18aa8","6facdc19.b3d864"]]},{"id":"b2eee8e6.e18aa8","type":"delay","z":"7e40a951.76a278","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":224.99998474121094,"y":4145,"wires":[["ac4c182d.f93d38"]]},{"id":"857a5d98.bfebb","type":"debug","z":"7e40a951.76a278","name":"","active":true,"console":"false","complete":"true","x":674.9999999999999,"y":4159.999999999999,"wires":[]},{"id":"7f4d5a7e.0b8944","type":"ui_template","z":"7e40a951.76a278","group":"63e69f50.b9e34","name":"","order":0,"width":"6","height":"3","format":"<style>\n    .text {\n   font-size:40px;\n}\n\n</style>\n\n<div class=\"text\" ng-bind-html=\"msg.payload\"></div>\n","storeOutMessages":true,"fwdInMessages":true,"x":738.7500152587891,"y":3376.250047683716,"wires":[[]]},{"id":"cc3cecf.48ebd1","type":"function","z":"7e40a951.76a278","name":"","func":"msg.payload = msg.payload.text;\ndelete msg.req;\ndelete msg.res;\n\nreturn msg;","outputs":1,"noerr":0,"x":518.7500076293945,"y":3382.5000495910645,"wires":[["7f4d5a7e.0b8944"]]},{"id":"fb195d9b.0502c","type":"inject","z":"b686905e.e5876","name":"init","topic":"","payload":"init","payloadType":"str","repeat":"","crontab":"","once":true,"x":90,"y":80,"wires":[["140686ea.cb4069"]]},{"id":"140686ea.cb4069","type":"function","z":"b686905e.e5876","name":"Scale PARSER","func":"flow.set('inputString',\"CMD\");\nflow.set('parser',function(v){\n       //v = v.substring(0,4);\n       //v = v;\n       return Number(v);\n    }\n  );\nglobal.set('scale_id','80096CB0EFD83B63E0533300000A4334');\nglobal.set('ip','81.30.161.168');\nglobal.set('video_camera_url','http://test:Test2003@192.168.0.150/ISAPI/Streaming/channels/101/picture?snapShotImageType=JPEG');\n\n\n\nflow.set(\"count\", 0);\nflow.set(\"module_weight\", 1);\nreturn msg;","outputs":1,"noerr":0,"x":291,"y":79,"wires":[[]]},{"id":"f63bfb90.0d3398","type":"switch","z":"7e40a951.76a278","name":"","property":"transactionHasOverLoad","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":633.3810043334961,"y":365.1428985595703,"wires":[["7cd518ed.ce8488"]]},{"id":"7cd518ed.ce8488","type":"function","z":"7e40a951.76a278","name":"over_load","func":"msg.event_id = flow.get('event_over_load');\nmsg.description = 'Можливий досип після зважування. Максимальная вага: ' + msg.metadata.transactionMaxWeight + \"кг. Облікова вага: \" + msg.metadata.transactionAccWeight + \"кг.\";\n\nreturn msg;","outputs":1,"noerr":0,"x":763.3810081481934,"y":365.1428680419922,"wires":[["4626c464.94a27c"]]}]
