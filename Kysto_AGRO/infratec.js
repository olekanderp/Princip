[{"id":"7bffe39.fd9051c","type":"tab","label":"Infratek"},{"id":"a145e34f.c64f5","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"19200","databits":"8","parity":"none","stopbits":"1","newline":"1000","bin":"false","out":"time","addchar":true},{"id":"dc163e5b.17987","type":"socket-io-event","z":"","addr":"getWeight"},{"id":"26991421.3341ac","type":"socket-io-server","z":"","port":"4001"},{"id":"c5c09306.302b6","type":"ui_group","z":"","name":"Автомобільні ваги 80т","tab":"5a0bfa34.ad9ed4","order":1,"disp":true,"width":"6"},{"id":"c67658d0.8656b8","type":"ui_group","z":"","name":"Поточний стан контрольних точок","tab":"5a0bfa34.ad9ed4","order":2,"disp":true,"width":"3"},{"id":"9aa983ef.834f2","type":"ui_group","z":"","name":"Події","tab":"5a0bfa34.ad9ed4","order":3,"disp":true,"width":"6"},{"id":"59f8530e.3b479c","type":"ui_group","z":"","name":"Стан зв'язку","tab":"5a0bfa34.ad9ed4","order":5,"disp":true,"width":"6"},{"id":"5a0bfa34.ad9ed4","type":"ui_tab","z":"","name":"Smart Scales","icon":"dashboard"},{"id":"d0b30d9d.a6c8d","type":"ui_group","z":"","name":"Тривалість зважування","tab":"5a0bfa34.ad9ed4","order":4,"disp":true,"width":"6"},{"id":"521e2989.574f88","type":"serial-port","z":"","serialport":"/dev/ttyUSB1","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"634c7d54.3db4f4","type":"serial-port","z":"","serialport":"/dev/ttyACM0","serialbaud":"115200","databits":"8","parity":"none","stopbits":"1","newline":"100","bin":"false","out":"time","addchar":false},{"id":"9d4b2727.260258","type":"serial-port","z":"","serialport":"/dev/ttyACM0","serialbaud":"115200","databits":"8","parity":"none","stopbits":"1","newline":"100","bin":"false","out":"time","addchar":false},{"id":"b6047642.0a4038","type":"tcp in","z":"7bffe39.fd9051c","name":"","server":"server","host":"","port":"4003","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":80,"y":60,"wires":[["17210f61.378121"]]},{"id":"7e754f53.f3f7b","type":"debug","z":"7bffe39.fd9051c","name":"","active":true,"console":"false","complete":"false","x":530,"y":60,"wires":[]},{"id":"17210f61.378121","type":"function","z":"7bffe39.fd9051c","name":"","func":"flow.set('lastAnalys',msg.payload);\nflow.set('barcode',\"\")\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":60,"wires":[["1c275d10.16e793","5d92a32c.9f9a0c"]]},{"id":"bf24224a.1bbd5","type":"http in","z":"7bffe39.fd9051c","name":"","url":"/getQuality","method":"get","swaggerDoc":"","x":140,"y":120,"wires":[["5919f05c.d8566","b97cf2a4.a60b4"]]},{"id":"e6935077.7521b","type":"http response","z":"7bffe39.fd9051c","name":"","x":630,"y":120,"wires":[]},{"id":"5919f05c.d8566","type":"function","z":"7bffe39.fd9051c","name":"","func":"var load = flow.get('load');\nif (load){\n    msg.payload = flow.get('parseQA');    \n}else{\n    msg.payload = {};\n}\nmsg.payload.barcode = flow.get('barcode');\nflow.set(\"load\",false);\n\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":120,"wires":[["e6935077.7521b","b97cf2a4.a60b4"]]},{"id":"1c275d10.16e793","type":"function","z":"7bffe39.fd9051c","name":"","func":"var result = {\n    localdate:new Date()\n};\n\nvar sdata = msg.payload;\nvar arr_sdata = sdata.split('\\n');\n\nresult.length = arr_sdata.length;\n\n//Ambient Temperature\nvar ambietTemperature = arr_sdata[7];\nvar arr_ambietTemperature = ambietTemperature.split(\":\");\nresult.ambietTemperature = arr_ambietTemperature[1];\n\n//Analysis Counter\nvar analysisCounter = arr_sdata[8];\nvar arr_analysisCounter = analysisCounter.split(\":\");\nresult.analysisCounter = arr_analysisCounter[1];\n\n//Sub sample\nvar subSample = arr_sdata[11];\nvar arr_subSample = subSample.split(\":\");\nvar arr_subSample_1 = arr_subSample[0].split(\"     \");\n\nresult.subsample = {\n   id : arr_subSample[0].replace(\"NrOFSubSamples\",\"\"),\n   NrOFSubSamples : arr_subSample[1]\n}\n\n//Sample hash\nvar sampleHash = arr_sdata[13];\nresult.sampleHash = sampleHash;\n\n//read quailities \nvar startQ  = 14;\nvar qLength = 7;\nvar endStr  = \"#\";\n\nvar qualities = [];\n\nfor( var i = startQ; i <= arr_sdata.length-qLength; ){\n    \n    var q = {\n        id:arr_sdata[i],\n        value:arr_sdata[i+1].split(String.fromCharCode(20)),\n        minmax:arr_sdata[i+4].split(String.fromCharCode(20))\n    }\n    qualities.push(q);   \n    i = i+qLength;\n    \n}\n\nresult.qualities = qualities;\nresult.datahash  = Buffer.from(msg.payload).toString('base64');\n// msg.payload = arr_sdata;\nmsg.payload = result;\nflow.set('parseQA',result);\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":60,"wires":[["7e754f53.f3f7b"]]},{"id":"5d92a32c.9f9a0c","type":"debug","z":"7bffe39.fd9051c","name":"","active":true,"console":"false","complete":"false","x":410,"y":20,"wires":[]},{"id":"c1223306.51422","type":"serial in","z":"7bffe39.fd9051c","name":"","serial":"9d4b2727.260258","x":110,"y":200,"wires":[["d34bef70.d5085"]]},{"id":"1acdcb91.5e2844","type":"debug","z":"7bffe39.fd9051c","name":"","active":false,"console":"false","complete":"false","x":466,"y":200,"wires":[]},{"id":"25c9d7ee.46aab8","type":"inject","z":"7bffe39.fd9051c","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":90,"y":280,"wires":[["4805e884.998b38"]]},{"id":"4805e884.998b38","type":"function","z":"7bffe39.fd9051c","name":"","func":"flow.set('load',true);\nflow.set('barcode',\"\");\nreturn msg;","outputs":1,"noerr":0,"x":245,"y":281,"wires":[[]]},{"id":"d34bef70.d5085","type":"function","z":"7bffe39.fd9051c","name":"","func":"flow.set(\"barcode\",msg.payload.replace(\"\\r\",\"\"));\nflow.set('load',true);\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":200,"wires":[["1acdcb91.5e2844"]]},{"id":"b97cf2a4.a60b4","type":"debug","z":"7bffe39.fd9051c","name":"","active":true,"console":"false","complete":"false","x":660,"y":160,"wires":[]}]
