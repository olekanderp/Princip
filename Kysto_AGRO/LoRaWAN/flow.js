[{"id":"b401ea4b.6f4f28","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"86eaa48.baa2f58","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"822d9426.0ca7b8","type":"ttn app","z":"","appId":"breakout_board","accessKey":"ttn-account-v2.00TP8sRtihBq6LTK415A6QXPtpdPwwRiOv62RBdWf8c","discovery":"discovery.thethingsnetwork.org:1900"},{"id":"5397d8a0.c7d2b8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"ae7e7aa.c8bd288","type":"influxdb","z":"","hostname":"192.168.0.101","port":"8086","protocol":"http","database":"","name":"","usetls":false,"tls":""},{"id":"d78265e7.26d26","type":"ui_tab","z":"","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"ce5b2d4.b2c36d","type":"ui_group","z":"","name":"Default","tab":"d78265e7.26d26","disp":true,"width":"6","collapse":false},{"id":"84467c2.d76218","type":"ui_group","z":"","name":"Default_2","tab":"d78265e7.26d26","disp":true,"width":"12","collapse":false},{"id":"341c118b.24d79e","type":"ttn uplink","z":"b401ea4b.6f4f28","name":"nodeOTA","app":"822d9426.0ca7b8","dev_id":"dev1","field":"","x":84.767333984375,"y":113.26042175292969,"wires":[["13c79169.37bdef","aa1932da.9b8fc","90a84472.c682a8","d30b7986.abaa28"]]},{"id":"13c79169.37bdef","type":"debug","z":"b401ea4b.6f4f28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":363.34722900390625,"y":70.35415649414062,"wires":[]},{"id":"f60598f5.d03cf8","type":"ttn event","z":"b401ea4b.6f4f28","name":"","app":"822d9426.0ca7b8","dev_id":"dev1","event":"#","x":80.5,"y":37,"wires":[["3850c1dd.6c875e"]]},{"id":"3850c1dd.6c875e","type":"debug","z":"b401ea4b.6f4f28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":214.25,"y":37,"wires":[]},{"id":"44a1af6b.ad874","type":"debug","z":"b401ea4b.6f4f28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":462.2499465942383,"y":647.4999923706055,"wires":[]},{"id":"317bfd9e.d62c52","type":"inject","z":"b401ea4b.6f4f28","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":119,"y":647.7500333786011,"wires":[["3dcf9290.ee256e"]]},{"id":"3dcf9290.ee256e","type":"file in","z":"b401ea4b.6f4f28","name":"","filename":"/home/pi/log.txt","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":300,"y":647.5,"wires":[["44a1af6b.ad874"]]},{"id":"aa1932da.9b8fc","type":"function","z":"b401ea4b.6f4f28","name":"last","func":"flow.set(\"last\", msg);\nreturn msg;","outputs":1,"noerr":0,"x":211.5,"y":73.75,"wires":[[]]},{"id":"cc42f693.a91bf","type":"inject","z":"b401ea4b.6f4f28","name":"","topic":"","payload":"last","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":605,"wires":[["b39b503a.7eb2d8"]]},{"id":"b39b503a.7eb2d8","type":"debug","z":"b401ea4b.6f4f28","name":"LoraWan","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":300,"y":607.5,"wires":[]},{"id":"90a84472.c682a8","type":"function","z":"b401ea4b.6f4f28","name":"","func":"var inLidar = msg.payload;\nvar lenLidar = inLidar.length;\nvar lidarArray_1 = [];\nvar lidarArray_2 = [];\nvar mainArrayLidar = [];\n\n    for (var i = 0; i < lenLidar; i++) {\n        \n        if(inLidar[i] == 0x59){\n        \n        var numI = i;//2\n        var sub = lenLidar - numI;//8\n        var coorectArray = lenLidar - sub;\n            //початок масива, шукаєм префікс\n            for (var j = 0; j < numI; j++) {\n            lidarArray_1[j] =  inLidar[j]   \n            }\n            // кінець масива\n            for (var f = 0; f < sub; f++) {\n            lidarArray_2[f] =  inLidar[numI + f];\n                    \n                }\n            \n                \n            break;\n            \n\n\n        \n        }\n    }\n\n\n mainArrayLidar = lidarArray_2.join(\",\") + \",\" + lidarArray_1.join(\",\");\n mainArrayLidar = mainArrayLidar.split(',');\n      for (var k = 0; k < mainArrayLidar.length; k++) {\n        mainArrayLidar[k] = Number(mainArrayLidar[k]);\n      }\n/*\nmsg.payload = {\n    lidarArray_1:lidarArray_1,\n    lidarArray_2:lidarArray_2,\n    lidarArray_all:mainArrayLidar\n    \n}\n*/\nmsg.payload = mainArrayLidar;\n\nreturn msg;","outputs":1,"noerr":0,"x":138.125,"y":212.5,"wires":[["d7a9a2d4.9f4d88","dbe32a3.6a867d8"]]},{"id":"d7a9a2d4.9f4d88","type":"debug","z":"b401ea4b.6f4f28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":361.875,"y":211.25,"wires":[]},{"id":"dbe32a3.6a867d8","type":"function","z":"b401ea4b.6f4f28","name":"parse","func":"var b1 = 0;\nvar b2 = 0;\nvar b3 = 0;\nvar b4 = 0;\nvar b5 = 0;\nvar b6 = 0;\n var dist_1 = 0;\nvar strength = 0;\n var temprature = 0;\n\n\n\nif(msg.payload[0] == 0x59 && msg.payload[1] == 0x59 && msg.payload[2] != 0x59){\n\n     b1 = msg.payload[2];\n     b2 = msg.payload[3];\n    \n     b3 = msg.payload[4];\n     b4 = msg.payload[5];\n     b5 = msg.payload[6];\n     b6 = msg.payload[7];\n    \n     dist_1 = b1 + b2 * 256; \n    \n     strength = b3 + b4 * 256; //calculate signal strength value\n     temprature = b5 + b6 *256;//calculate chip temprature\n    temprature = temprature/8 - 256 - 16;\n    \n    msg.payload = {\n        dist: dist_1.toString(),\n        level: (7.40 - dist_1).toFixed(2),\n        strength: strength,\n        temprature: temprature,\n        date : flow.get(\"date\")\n    }\n}\n\nif(msg.payload[0] == 0x59 && msg.payload[1] == 0x59 && msg.payload[2] == 0x59){\n\n     b1 = msg.payload[3];\n     b2 = msg.payload[4];\n    \n     b3 = msg.payload[5];\n     b4 = msg.payload[6];\n     b5 = msg.payload[7];\n     b6 = msg.payload[8];\n    \n     dist_1 = b1 + b2 * 256; \n    \n     strength = b3 + b4 * 256; //calculate signal strength value\n     temprature = b5 + b6 *256;//calculate chip temprature\n    temprature = temprature/8 - 256 - 16;\n    \n    msg.payload = {\n        dist: dist_1.toString(),\n        level: (7.40 - dist_1).toFixed(2),\n        strength: strength,\n        temprature: temprature,\n        date : flow.get(\"date\")\n    }\n}\n\n\n\nflow.set(\"triger\", false);\nreturn msg;","outputs":1,"noerr":0,"x":145.625,"y":270,"wires":[["691f118b.250b6","e1169819.224898","c9567f34.6ce648","3442dbd1.51739c","c238581a.3f5dc8"]]},{"id":"691f118b.250b6","type":"debug","z":"b401ea4b.6f4f28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":321.875,"y":295,"wires":[]},{"id":"fd273f46.0080b","type":"ui_text","z":"b401ea4b.6f4f28","group":"ce5b2d4.b2c36d","order":0,"width":0,"height":0,"name":"","label":"счетчик сообщений:","format":"{{msg.payload}}","layout":"row-left","x":496.875,"y":165,"wires":[]},{"id":"37e177d9.4a1f48","type":"ui_text","z":"b401ea4b.6f4f28","group":"ce5b2d4.b2c36d","order":0,"width":0,"height":0,"name":"","label":"Расстояние до зерна, м:","format":"{{msg.payload}}","layout":"row-left","x":525,"y":343.75,"wires":[]},{"id":"34fbc3ce.883d04","type":"ui_text","z":"b401ea4b.6f4f28","group":"ce5b2d4.b2c36d","order":0,"width":0,"height":0,"name":"","label":"Температура датчика, град. С:","format":"{{msg.payload}}","layout":"row-left","x":375,"y":537.5,"wires":[]},{"id":"d30b7986.abaa28","type":"function","z":"b401ea4b.6f4f28","name":"","func":"\nvar counter = msg.counter;\nmsg.payload = counter;\nreturn msg;","outputs":1,"noerr":0,"x":266.875,"y":167.5,"wires":[["fd273f46.0080b","10667cb9.09de43"]]},{"id":"e1169819.224898","type":"function","z":"b401ea4b.6f4f28","name":"","func":"msg.payload = (Number(msg.payload.dist))/100;\nreturn msg;","outputs":1,"noerr":0,"x":103.75,"y":350,"wires":[["37e177d9.4a1f48","4c07c031.42d7"]]},{"id":"c9567f34.6ce648","type":"function","z":"b401ea4b.6f4f28","name":"","func":"msg.payload = msg.payload.temprature;\nreturn msg;","outputs":1,"noerr":0,"x":145,"y":537.5,"wires":[["34fbc3ce.883d04","44571e02.9f5b1"]]},{"id":"10667cb9.09de43","type":"debug","z":"b401ea4b.6f4f28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":447.5,"y":126.25,"wires":[]},{"id":"4e58cab2.5d9dc4","type":"ui_chart","z":"b401ea4b.6f4f28","name":"","group":"84467c2.d76218","order":3,"width":0,"height":0,"label":"Уровень в силосе(силос б48), м","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"0","ymax":"12","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":561.875,"y":465,"wires":[[]]},{"id":"44571e02.9f5b1","type":"ui_chart","z":"b401ea4b.6f4f28","name":"","group":"84467c2.d76218","order":4,"width":0,"height":0,"label":"Температура датчика, град. С:","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"0","ymax":"50","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":371.25,"y":500,"wires":[[]]},{"id":"4c07c031.42d7","type":"function","z":"b401ea4b.6f4f28","name":"","func":"var in_d = msg.payload;\n\nmsg.payload = (7.40 - in_d);\nvar i = msg.payload.toFixed(2);\nmsg.payload = i;\nreturn msg;","outputs":1,"noerr":0,"x":268.75,"y":386.25,"wires":[["4e58cab2.5d9dc4","c5eeb9a9.d5058"]]},{"id":"14e3eb21.e4cc85","type":"file","z":"b401ea4b.6f4f28","name":"","filename":"/home/pi/log.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","encoding":"utf8","x":476.875,"y":258.75,"wires":[["de387cbf.292e28"]]},{"id":"3442dbd1.51739c","type":"json","z":"b401ea4b.6f4f28","name":"","property":"payload","action":"str","pretty":false,"x":323.125,"y":255,"wires":[["14e3eb21.e4cc85"]]},{"id":"de387cbf.292e28","type":"debug","z":"b401ea4b.6f4f28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":633.75,"y":253.75,"wires":[]},{"id":"c5eeb9a9.d5058","type":"ui_text","z":"b401ea4b.6f4f28","group":"ce5b2d4.b2c36d","order":0,"width":0,"height":0,"name":"","label":"Уровень в силосе(силос б48), м:","format":"{{msg.payload}}","layout":"row-left","x":560,"y":426.25,"wires":[]},{"id":"c238581a.3f5dc8","type":"ui_text","z":"b401ea4b.6f4f28","group":"ce5b2d4.b2c36d","order":0,"width":0,"height":0,"name":"","label":"дата последнего замера:","format":"{{msg.payload.date}}","layout":"row-left","x":537.5,"y":382.5,"wires":[]},{"id":"6ffda9df.ed0e28","type":"inject","z":"b401ea4b.6f4f28","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":197.99998474121094,"y":1058.9999866485596,"wires":[["e20ce78a.a9f728"]]},{"id":"e20ce78a.a9f728","type":"date-converter","z":"b401ea4b.6f4f28","name":"","topic":"","input":"payload","inputType":"msg","inTz":"","adjAmount":"3","adjType":"hours","adjDir":"add","format":"","locale":"ru","output":"payload","outputType":"msg","outTz":"","x":230.99999237060547,"y":1105.0000438690186,"wires":[["a6802bf9.8041a8","5bc96f16.bebd2"],[]]},{"id":"5bc96f16.bebd2","type":"debug","z":"b401ea4b.6f4f28","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":471.0000228881836,"y":1101.0000162124634,"wires":[]},{"id":"a6802bf9.8041a8","type":"function","z":"b401ea4b.6f4f28","name":"","func":"var d = msg.payload;\nd = d.replace(\"-\",\":\");\nd = d.replace(\"-\",\":\");\nd = d.replace(\"T\",\" \");\nd = d.replace(\"Z\",\"\")\nd = d.substring(0,19);\n\nvar m = d.substring(5,7);\nvar y = d.substring(0,4);\nvar day = d.substring(8,10);\nvar t = d.substring(10,19);\n//msg.payload = d;\n\nmsg.payload = day + \":\" + m + \":\" + y +  \" \"+ t;\nflow.set(\"date\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":361.0000114440918,"y":1149.999994277954,"wires":[["5bc96f16.bebd2"]]},{"id":"7910e52e.b1046c","type":"http response","z":"b401ea4b.6f4f28","name":"","statusCode":"","headers":{},"x":492.6840476989746,"y":744.920202255249,"wires":[]},{"id":"bfceea68.08e258","type":"http in","z":"b401ea4b.6f4f28","name":"","url":"/get/file","method":"get","upload":false,"swaggerDoc":"","x":120.68402481079102,"y":746.3472194671631,"wires":[["46426101.f1d7b"]]},{"id":"46426101.f1d7b","type":"file in","z":"b401ea4b.6f4f28","name":"","filename":"/home/pi/log.txt","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":316.0173797607422,"y":745.565996170044,"wires":[["7910e52e.b1046c"]]},{"id":"74d76b7e.0be964","type":"comment","z":"b401ea4b.6f4f28","name":"Отримати файл","info":"","x":118.69096374511719,"y":706.3298721313477,"wires":[]},{"id":"91ecd31a.3dc9f","type":"comment","z":"b401ea4b.6f4f28","name":"Видалити файл","info":"","x":131.01734924316406,"y":803.5661106109619,"wires":[]},{"id":"23d7019c.edc38e","type":"inject","z":"b401ea4b.6f4f28","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":103.68749237060547,"y":856.8578424453735,"wires":[["3cd04918.441bd6"]]},{"id":"3cd04918.441bd6","type":"file","z":"b401ea4b.6f4f28","name":"","filename":"/home/pi/log.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","encoding":"none","x":289.6805419921875,"y":855.968864440918,"wires":[["c8b47af.26c7a88"]]},{"id":"c8b47af.26c7a88","type":"debug","z":"b401ea4b.6f4f28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":483.017391204834,"y":856.4549160003662,"wires":[]}]
