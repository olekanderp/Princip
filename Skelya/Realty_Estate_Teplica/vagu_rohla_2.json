[
    {
        "id": "06cec62d38b037ce",
        "type": "tab",
        "label": "Поток 1",
        "disabled": false,
        "info": ""
    },
    {
        "id": "fc0637b703c449c7",
        "type": "tab",
        "label": "Поток 1",
        "disabled": false,
        "info": ""
    },
    {
        "id": "6153bc726fed9ae6",
        "type": "inject",
        "z": "fc0637b703c449c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1.5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 150,
        "y": 140,
        "wires": [
            [
                "fb094479b0a86ef9"
            ]
        ]
    },
    {
        "id": "fb094479b0a86ef9",
        "type": "function",
        "z": "fc0637b703c449c7",
        "name": "cmd",
        "func": "msg.payload = new Buffer(\"53490d0a\", \"hex\");\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 180,
        "wires": [
            [
                "babbf03780a3af14"
            ]
        ]
    },
    {
        "id": "2de66b09e268be22",
        "type": "debug",
        "z": "fc0637b703c449c7",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 160,
        "wires": []
    },
    {
        "id": "babbf03780a3af14",
        "type": "tcp request",
        "z": "fc0637b703c449c7",
        "server": "192.168.17.103",
        "port": "1001",
        "out": "char",
        "splitc": "\\n",
        "name": "",
        "x": 270,
        "y": 220,
        "wires": [
            [
                "878974a1f31d9a9b"
            ]
        ]
    },
    {
        "id": "878974a1f31d9a9b",
        "type": "function",
        "z": "fc0637b703c449c7",
        "name": "",
        "func": "var weight = msg.payload.toString();\nweight = weight.replace(\"kg\", \"\")\nmsg.payload = Number(weight);\n\n\nflow.set('current_weight', msg.payload)\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 220,
        "wires": [
            [
                "2de66b09e268be22"
            ]
        ]
    },
    {
        "id": "55bc265a547e9f36",
        "type": "inject",
        "z": "fc0637b703c449c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 150,
        "y": 40,
        "wires": [
            [
                "033c5eca39065f52"
            ]
        ]
    },
    {
        "id": "033c5eca39065f52",
        "type": "function",
        "z": "fc0637b703c449c7",
        "name": "correct_date",
        "func": "  \nvar d = new Date();\n\nvar utc = d.getTime() + (d.getTimezoneOffset() * 60000);\n\nvar offset = 4; // This is the offset for UTC+3, in your case (UTC+1) should be 1\n\nnewDate = new Date(utc + (3600000*offset));\n\nmsg.payload = newDate;\n//msg.payload = newDate.toLocaleString();\n\nflow.set(\"correct_date\", msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 40,
        "wires": [
            [
                "14467a23a2324bbb"
            ]
        ]
    },
    {
        "id": "14467a23a2324bbb",
        "type": "debug",
        "z": "fc0637b703c449c7",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 40,
        "wires": []
    },
    {
        "id": "2472a4245e50fc3d",
        "type": "file",
        "z": "fc0637b703c449c7",
        "name": "",
        "filename": "/home/pi/all_Data/file_weight.json",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 420,
        "y": 540,
        "wires": [
            [
                "ae2ae7fdb67fe4ea"
            ]
        ]
    },
    {
        "id": "858a6860a2073126",
        "type": "function",
        "z": "fc0637b703c449c7",
        "name": "",
        "func": "var send_file = {\n    \"barcode\": flow.get('barcode'),\n    \"weight\": flow.get('current_weight'),\n    \"date\": flow.get('correct_date'),\n  }\n  \nmsg.payload = send_file;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 540,
        "wires": [
            [
                "2472a4245e50fc3d"
            ]
        ]
    },
    {
        "id": "78127884387f37ce",
        "type": "inject",
        "z": "fc0637b703c449c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.4",
        "topic": "",
        "payloadType": "date",
        "x": 140,
        "y": 420,
        "wires": [
            [
                "a14fe03daca55d77"
            ]
        ]
    },
    {
        "id": "a14fe03daca55d77",
        "type": "exec",
        "z": "fc0637b703c449c7",
        "command": "sudo python read-rfid-on-rpi.py",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 410,
        "y": 420,
        "wires": [
            [
                "2abed1e12bd93e1e",
                "b5f616246bb31283"
            ],
            [],
            []
        ]
    },
    {
        "id": "93480d898ca0c147",
        "type": "debug",
        "z": "fc0637b703c449c7",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 810,
        "y": 340,
        "wires": []
    },
    {
        "id": "cb63ed8df9520ae1",
        "type": "comment",
        "z": "fc0637b703c449c7",
        "name": "info",
        "info": " sudo killall python read-*",
        "x": 150,
        "y": 360,
        "wires": []
    },
    {
        "id": "2abed1e12bd93e1e",
        "type": "function",
        "z": "fc0637b703c449c7",
        "name": "",
        "func": "var barccode = msg.payload;\nif(barccode.length > 3){\n   barccode = barccode.replace(\"\\n\", \"\");\n    flow.set('barcode', barccode);\n    return msg; \n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 420,
        "wires": [
            [
                "93480d898ca0c147",
                "858a6860a2073126"
            ]
        ]
    },
    {
        "id": "b5f616246bb31283",
        "type": "delay",
        "z": "fc0637b703c449c7",
        "name": "",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "x": 410,
        "y": 360,
        "wires": [
            [
                "a14fe03daca55d77"
            ]
        ]
    },
    {
        "id": "ae2ae7fdb67fe4ea",
        "type": "debug",
        "z": "fc0637b703c449c7",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 540,
        "wires": []
    },
    {
        "id": "6c86ba9172cda28c",
        "type": "inject",
        "z": "fc0637b703c449c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.3",
        "topic": "",
        "payloadType": "date",
        "x": 130,
        "y": 80,
        "wires": [
            [
                "28ef073c0d49da44"
            ]
        ]
    },
    {
        "id": "28ef073c0d49da44",
        "type": "function",
        "z": "fc0637b703c449c7",
        "name": "INIT",
        "func": "flow.set(\"tr_start_write_to_file\", false);\nflow.set('barcode',\"\");\nflow.set('current_weight',0);\nflow.set('correct_date', \"\");\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "89bc066565200fcd",
        "type": "function",
        "z": "fc0637b703c449c7",
        "name": "",
        "func": "var date = msg.req.query.date;\nmsg.date = new Date(date);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 740,
        "wires": [
            [
                "7a2f4b3f17f176dc"
            ]
        ]
    },
    {
        "id": "6e602dbda89f8b6e",
        "type": "http in",
        "z": "fc0637b703c449c7",
        "name": "",
        "url": "/getFile",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 740,
        "wires": [
            [
                "89bc066565200fcd"
            ]
        ]
    },
    {
        "id": "7a2f4b3f17f176dc",
        "type": "file in",
        "z": "fc0637b703c449c7",
        "name": "",
        "filename": "/home/pi/all_Data/file_weight.json",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 510,
        "y": 740,
        "wires": [
            [
                "4776a018.75ad8"
            ]
        ]
    },
    {
        "id": "4776a018.75ad8",
        "type": "function",
        "z": "fc0637b703c449c7",
        "name": "",
        "func": "var array = msg.payload;\nvar allJson = []\nvar ArrayJsonString = array.split(\"\\n\");\nArrayJsonString.splice(ArrayJsonString.length-1, 1); // начиная с позиции 1, удалить 1 элемент\n\nfor (var i in ArrayJsonString) {\n  var obj = JSON.parse(ArrayJsonString[i]);\n  allJson.push(obj);\n}\n\n//msg.payload = allJson;\n\nvar sortArray = [];\nfor (var j = 0; j < allJson.length; j++) {\n    allJson[j].date = new Date(allJson[j].date);\n    if(allJson[j].date >= msg.date){\n       sortArray.push(allJson[j]); \n    }\n}\n\n//allJson[5].date = new Date(allJson[5].date) - flow.get(\"correct_date2\");\n//msg.payload = allJson[5].date;\nmsg.payload = sortArray;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 740,
        "wires": [
            [
                "13d7811b.cdb0af",
                "f815731c.46217"
            ]
        ]
    },
    {
        "id": "13d7811b.cdb0af",
        "type": "http response",
        "z": "fc0637b703c449c7",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 940,
        "y": 780,
        "wires": []
    },
    {
        "id": "f815731c.46217",
        "type": "debug",
        "z": "fc0637b703c449c7",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 940,
        "y": 740,
        "wires": []
    },
    {
        "id": "1bf8c339bcac0f8f",
        "type": "inject",
        "z": "fc0637b703c449c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "12312312323\\n",
        "payloadType": "str",
        "x": 420,
        "y": 300,
        "wires": [
            [
                "2abed1e12bd93e1e",
                "93480d898ca0c147"
            ]
        ]
    }
]
