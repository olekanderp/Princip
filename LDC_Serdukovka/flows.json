[{"id":"d3d5daa0.5f1058","type":"tab","label":"Авторазгрузка 2 "},{"id":"e749f9b0.ca5bf8","type":"tab","label":"Авторазгрузка 3"},{"id":"797be67.0f76418","type":"tab","label":"Авторазгрузка 4"},{"id":"2fd1bb9e.ef4684","type":"tab","label":"ЖД ваги"},{"id":"f4c119b9.194fb8","type":"tab","label":"КПП"},{"id":"e6ad0c7b.94dac","type":"tab","label":"Вагова"},{"id":"c94645b6.8b6ca8","type":"tab","label":"Світлофори"},{"id":"628e4e9b.6792d","type":"tab","label":"Шлагбауми"},{"id":"ddef2aec.70f948","type":"tab","label":"Периметр"},{"id":"725358f3.31ba08","type":"tab","label":"All variable"},{"id":"b744ff99.c78b6","type":"tab","label":"Avto_1 Ліві"},{"id":"55db58b3.1c1c98","type":"tab","label":"Avto_1 processing_scale1"},{"id":"25dc673e.e08538","type":"tab","label":"Avto_2 Праві"},{"id":"73798026.159ca","type":"tab","label":"Avto_2 processing_scale1"},{"id":"415d6a1.76aa494","type":"tab","label":"Аналізатор"},{"id":"38f5b6db.4b422a","type":"tab","label":"Табло"},{"id":"fdab393b.c717e8","type":"tab","label":"ЖД ваги"},{"id":"104f345f.4f25ac","type":"tab","label":"ЖД ваги processing_scale1"},{"id":"3d95eac6.3e2b96","type":"tab","label":"SEND 1C"},{"id":"ead0a2e8.f93de","type":"tab","label":"Trassir Photo"},{"id":"a63d4f5f.2cb8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey","palette":"light"}}},{"id":"93684658.7f9308","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey","palette":"light"}}},{"id":"e1dd70f.94c7c9","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"d36e64bc.d23ab8","type":"socket-io-event","z":"","addr":"getWeight"},{"id":"cf047825.2045b8","type":"socket-io-server","z":"","port":"4001"},{"id":"c7a6cbb7.d20b88","type":"ui_group","z":"","name":"Поточна вага","tab":"921209d1.0fa0b8","order":1,"disp":true,"width":"6"},{"id":"2bcc2e47.b16732","type":"ui_group","z":"","name":"Графік ваги","tab":"921209d1.0fa0b8","order":2,"disp":true,"width":"6"},{"id":"7eb4a526.3db92c","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"5bd22a1d.f94584","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"7b3842bd.4285fc","type":"ui_group","z":"","name":"Стабільність","tab":"921209d1.0fa0b8","order":1,"disp":true,"width":"6"},{"id":"5364d6e7.c9f778","type":"ui_group","z":"","name":"Графіки стаільності","tab":"921209d1.0fa0b8","order":3,"disp":true,"width":"6"},{"id":"cff4b7fb.603008","type":"ui_group","z":"","name":"info 1c","tab":"921209d1.0fa0b8","disp":true,"width":"6"},{"id":"b5b65a42.eba3f8","type":"ui_group","z":"","name":"Зважування","tab":"921209d1.0fa0b8","disp":true,"width":"6"},{"id":"921209d1.0fa0b8","type":"ui_tab","z":"","name":"Smart Scales","icon":"dashboard"},{"id":"78cfb926.b98d58","type":"socket-io-server","z":"","port":"4002"},{"id":"1cf9158.3a16deb","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"64b3a67f.195858","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"1447043e.dce9ec","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"a2010731.069d98","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"495927f6.e541f8","type":"socket-io-event","z":"","addr":"getWeight"},{"id":"56ba6d7c.6db594","type":"socket-io-server","z":"","port":"4004"},{"id":"8a5da72b.f366d8","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"b1e74ada.4ff668","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"1ae58ed1.914c61","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"4f13272d.e94778","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"1de7a4ba.95520b","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"12802375.3fc33d","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"b10a666.216e998","type":"inject","z":"d3d5daa0.5f1058","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":120,"wires":[["4ba7f42b.4ee4dc","81b53091.23aa2"]]},{"id":"4ba7f42b.4ee4dc","type":"function","z":"d3d5daa0.5f1058","name":"","func":"msg.payload = '<s1>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":120,"wires":[["f32a8f04.8d443"]]},{"id":"f32a8f04.8d443","type":"converter","z":"d3d5daa0.5f1058","name":"","from":"win1251","x":470,"y":140,"wires":[[]]},{"id":"81b53091.23aa2","type":"function","z":"d3d5daa0.5f1058","name":"","func":"msg.payload = '<s2>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":160,"wires":[["f32a8f04.8d443"]]},{"id":"105a86c6.79a5e9","type":"inject","z":"d3d5daa0.5f1058","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":280,"wires":[["beeb285e.4ac2c8"]]},{"id":"beeb285e.4ac2c8","type":"function","z":"d3d5daa0.5f1058","name":"","func":"msg.url = 'http://admin:admin@10.107.21.44/protect/leds.cgi?led=0&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":280,"wires":[["26e6b111.87ab3e"]]},{"id":"26e6b111.87ab3e","type":"http request","z":"d3d5daa0.5f1058","name":"","method":"GET","ret":"txt","url":"","x":550,"y":280,"wires":[[]]},{"id":"15290d1b.3487a3","type":"comment","z":"d3d5daa0.5f1058","name":"QL 6 Таблло 10.107.25.127","info":"","x":350,"y":80,"wires":[]},{"id":"4a4d6ef3.bb48c","type":"comment","z":"d3d5daa0.5f1058","name":"A6.1 - ВК-модуль, Світлофор(HL4.2) 10.107.25.135","info":"виключений - червоний\nвключене - зелене\nled=0\n\n\n\n http://10.107.25.135/protect/leds.cgi?led=0&timeout=0","x":430,"y":240,"wires":[]},{"id":"be060a9.fc795f8","type":"inject","z":"d3d5daa0.5f1058","name":"status","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":340,"wires":[["3d9b66f9.2ef57a"]]},{"id":"3d9b66f9.2ef57a","type":"function","z":"d3d5daa0.5f1058","name":"status вигрузка 2","func":"msg.url = 'http://admin:admin@10.107.21.44/protect/status.xml'\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":340,"wires":[["d2d00dc9.83514"]]},{"id":"d2d00dc9.83514","type":"http request","z":"d3d5daa0.5f1058","name":"","method":"GET","ret":"txt","url":"","x":590,"y":340,"wires":[["7060908e.32214"]]},{"id":"da82dc6.b8ba92","type":"comment","z":"d3d5daa0.5f1058","name":"new A6.1 - ВК-модуль, Світлофор(HL4.2) 10.107.21.44","info":"виключений - червоний\nвключене - зелене\nled=0\n\n\n\n http://10.107.21.44/protect/leds.cgi?led=0&timeout=0","x":440,"y":200,"wires":[]},{"id":"46f6c733.d61a38","type":"inject","z":"e749f9b0.ca5bf8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":200,"y":140,"wires":[["6ec07c4b.cea584","2e9e5759.df2f38"]]},{"id":"6ec07c4b.cea584","type":"function","z":"e749f9b0.ca5bf8","name":"","func":"msg.payload = '<s1>Тест 2'\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":140,"wires":[["bfab5da.a6040a"]]},{"id":"bfab5da.a6040a","type":"converter","z":"e749f9b0.ca5bf8","name":"","from":"win1251","x":500,"y":160,"wires":[[]]},{"id":"2e9e5759.df2f38","type":"function","z":"e749f9b0.ca5bf8","name":"","func":"msg.payload = '<s2>тест 1'\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":180,"wires":[["bfab5da.a6040a"]]},{"id":"b7d72d25.afe3","type":"inject","z":"e749f9b0.ca5bf8","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":300,"wires":[["79de15c1.b4684c"]]},{"id":"79de15c1.b4684c","type":"function","z":"e749f9b0.ca5bf8","name":"","func":"msg.url = 'http://admin:admin@10.107.21.51/protect/leds.cgi?led=0&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":300,"wires":[["ab74dccb.4f918"]]},{"id":"ab74dccb.4f918","type":"http request","z":"e749f9b0.ca5bf8","name":"","method":"GET","ret":"txt","url":"","x":580,"y":300,"wires":[["37c4fd6f.3916e2"]]},{"id":"af0086fb.a54c88","type":"comment","z":"e749f9b0.ca5bf8","name":"QL 9 Таблло 10.107.25.138","info":"","x":380,"y":100,"wires":[]},{"id":"ae3ca554.e3be38","type":"comment","z":"e749f9b0.ca5bf8","name":"A8.1 - ВК-модуль, Світлофор(HL5.1) 10.107.25.142","info":"виключений - червоний\nвключене - зелене\nled=0\n\n<led0>0</led0> - червоне\n<led0>1</led0> - зелене\n<led1>0</led1> - резерв\n\n\n\n\n\n http://10.107.25.142/protect/leds.cgi?led=0&timeout=0","x":460,"y":260,"wires":[]},{"id":"6fd5aade.633dd4","type":"inject","z":"e749f9b0.ca5bf8","name":"status","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":200,"y":360,"wires":[["469f370f.a61198"]]},{"id":"469f370f.a61198","type":"function","z":"e749f9b0.ca5bf8","name":"status","func":"msg.url = 'http://admin:admin@10.107.21.51/protect/status.xml'\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":360,"wires":[["c663e7de.8c7988"]]},{"id":"c663e7de.8c7988","type":"http request","z":"e749f9b0.ca5bf8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":580,"y":360,"wires":[["7878a514.47164c"]]},{"id":"37c4fd6f.3916e2","type":"debug","z":"e749f9b0.ca5bf8","name":"","active":true,"console":false,"complete":"false","x":740,"y":300,"wires":[]},{"id":"7878a514.47164c","type":"debug","z":"e749f9b0.ca5bf8","name":"","active":true,"console":false,"complete":"false","x":750,"y":360,"wires":[]},{"id":"3bc56ee9.b65d32","type":"comment","z":"e749f9b0.ca5bf8","name":"new A8.1 - ВК-модуль, Світлофор(HL5.1) 10.107.21.51","info":"виключений - червоний\nвключене - зелене\nled=0\n\n<led0>0</led0> - червоне\n<led0>1</led0> - зелене\n<led1>0</led1> - резерв\n\n\n\n\n\n http://10.107.21.51/protect/leds.cgi?led=0&timeout=0","x":460,"y":220,"wires":[]},{"id":"c5cadb0d.289768","type":"inject","z":"797be67.0f76418","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":180,"y":140,"wires":[["4faa8563.faf4dc","b7f036.24538fc8"]]},{"id":"4faa8563.faf4dc","type":"function","z":"797be67.0f76418","name":"","func":"msg.payload = '<s1>10.107.25.137'\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":140,"wires":[["a31c1eab.7bf17"]]},{"id":"a31c1eab.7bf17","type":"converter","z":"797be67.0f76418","name":"","from":"win1251","x":480,"y":160,"wires":[[]]},{"id":"b7f036.24538fc8","type":"function","z":"797be67.0f76418","name":"","func":"msg.payload = '<s2>'\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":180,"wires":[["a31c1eab.7bf17"]]},{"id":"f9de10b4.f181e","type":"inject","z":"797be67.0f76418","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":300,"wires":[["7b0d4282.232c2c"]]},{"id":"7b0d4282.232c2c","type":"function","z":"797be67.0f76418","name":"","func":"msg.url = 'http://admin:admin@10.107.21.50/protect/leds.cgi?led=0&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":300,"wires":[["7d2eb1b4.9f713"]]},{"id":"7d2eb1b4.9f713","type":"http request","z":"797be67.0f76418","name":"","method":"GET","ret":"txt","url":"","x":560,"y":300,"wires":[["7cfaad6a.eb3f44"]]},{"id":"c0763b8c.eb2128","type":"comment","z":"797be67.0f76418","name":"QL 8 Таблло 10.107.25.137 не працювало з щита","info":"","x":430,"y":100,"wires":[]},{"id":"ed7a3ea0.5859c","type":"comment","z":"797be67.0f76418","name":"A7.1 - ВК-модуль, Світлофор(HL5.2) 10.107.25.141","info":"виключений - червоний\nвключене - зелене\nled=0\n\n<led0>0</led0> - червоне\n<led0>1</led0> - зелене\n<led1>0</led1> - резерв\n\n\n\n\n\n http://10.107.25.141/protect/leds.cgi?led=0&timeout=0","x":440,"y":260,"wires":[]},{"id":"e17b9199.0d888","type":"inject","z":"797be67.0f76418","name":"status","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":180,"y":360,"wires":[["97603337.2bd43"]]},{"id":"97603337.2bd43","type":"function","z":"797be67.0f76418","name":"status","func":"msg.url = 'http://admin:admin@10.107.21.50/protect/status.xml'\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":360,"wires":[["5eaee652.0c50b8"]]},{"id":"5eaee652.0c50b8","type":"http request","z":"797be67.0f76418","name":"","method":"GET","ret":"txt","url":"","tls":"","x":560,"y":360,"wires":[["a4e76f0d.c1829"]]},{"id":"7cfaad6a.eb3f44","type":"debug","z":"797be67.0f76418","name":"","active":true,"console":false,"complete":"false","x":720,"y":300,"wires":[]},{"id":"a4e76f0d.c1829","type":"debug","z":"797be67.0f76418","name":"","active":true,"console":false,"complete":"false","x":730,"y":360,"wires":[]},{"id":"eb8c7a67.381bc8","type":"comment","z":"797be67.0f76418","name":"new A7.1 - ВК-модуль, Світлофор(HL5.2) 10.107.21.50","info":"виключений - червоний\nвключене - зелене\nled=0\n\n<led0>0</led0> - червоне\n<led0>1</led0> - зелене\n<led1>0</led1> - резерв\n\n\n\n\n\n http://10.107.21.50/protect/leds.cgi?led=0&timeout=0","x":440,"y":220,"wires":[]},{"id":"ae2925c2.d60518","type":"inject","z":"2fd1bb9e.ef4684","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":100,"wires":[["a594cdc0.bdcc6"]]},{"id":"a594cdc0.bdcc6","type":"function","z":"2fd1bb9e.ef4684","name":"","func":"msg.payload = String.fromCharCode(0);\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":100,"wires":[["5e34aeab.b452"]]},{"id":"5e34aeab.b452","type":"tcp request","z":"2fd1bb9e.ef4684","server":"10.107.21.45","port":"9761","out":"count","splitc":"10","name":"","x":240,"y":180,"wires":[["70c6162d.d36a58","38509388.a8c9bc"]]},{"id":"38509388.a8c9bc","type":"debug","z":"2fd1bb9e.ef4684","name":"","active":true,"console":false,"complete":"false","x":670,"y":180,"wires":[]},{"id":"70c6162d.d36a58","type":"function","z":"2fd1bb9e.ef4684","name":"parse","func":"var weight = msg.payload;\n\nfunction parse (v){\n        \n           var k1 = v.readInt16LE(1,2)*10;\n           var k2 = v.readInt16LE(3,2)*10;\n           var k3 = v.readInt16LE(5,2)*10;\n           var k4 = v.readInt16LE(7,2)*10;\n           \n           return k1+k2+k3+k4;\n           \n        }\n\nmsg.payload = parse(weight);\n\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":200,"wires":[["38509388.a8c9bc"]]},{"id":"e771c95f.e75f78","type":"comment","z":"2fd1bb9e.ef4684","name":"new Ваги A6.2 10.107.21.45","info":"0: 0xaa\n1: 0x0\n2: 0x0\n3: 0x0\n4: 0x0\n5: 0xff\n6: 0xff\n7: 0x0\n8: 0x0\n9: 0xa9\n\n0: 170\n1: 0x0\n2: 0x0\n3: 0x0\n4: 0x0\n5: 255\n6: 255\n7: 0x0\n8: 0x0\n9: 0xa9","x":340,"y":20,"wires":[]},{"id":"16497904.e791a7","type":"inject","z":"2fd1bb9e.ef4684","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":380,"wires":[["23f693a6.78c02c","a58de9c8.b51628"]]},{"id":"23f693a6.78c02c","type":"function","z":"2fd1bb9e.ef4684","name":"","func":"msg.payload = '<s1>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":380,"wires":[["625608b0.719ba8"]]},{"id":"625608b0.719ba8","type":"converter","z":"2fd1bb9e.ef4684","name":"","from":"win1251","x":440,"y":400,"wires":[[]]},{"id":"a58de9c8.b51628","type":"function","z":"2fd1bb9e.ef4684","name":"","func":"msg.payload = '<s2>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":420,"wires":[["625608b0.719ba8"]]},{"id":"b2265e24.c38e6","type":"comment","z":"2fd1bb9e.ef4684","name":"QL 7 - 10.107.25.128 табло жд не працювало","info":"","x":410,"y":340,"wires":[]},{"id":"20b5032e.e3c1ec","type":"comment","z":"2fd1bb9e.ef4684","name":"Ваги A6.2 10.107.25.136","info":"0: 0xaa\n1: 0x0\n2: 0x0\n3: 0x0\n4: 0x0\n5: 0xff\n6: 0xff\n7: 0x0\n8: 0x0\n9: 0xa9\n\n0: 170\n1: 0x0\n2: 0x0\n3: 0x0\n4: 0x0\n5: 255\n6: 255\n7: 0x0\n8: 0x0\n9: 0xa9","x":330,"y":60,"wires":[]},{"id":"707a47c6.622cc8","type":"inject","z":"f4c119b9.194fb8","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":200,"wires":[["1096e881.a27137"]]},{"id":"1096e881.a27137","type":"function","z":"f4c119b9.194fb8","name":"HL1.1 вїзд","func":"msg.url = 'http://admin:admin@10.107.21.11/protect/leds.cgi?led=0&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":200,"wires":[["5d77187b.d99778"]]},{"id":"5d77187b.d99778","type":"http request","z":"f4c119b9.194fb8","name":"","method":"GET","ret":"txt","url":"","x":510,"y":200,"wires":[["1f8cbee9.c5f4e1"]]},{"id":"ec6af143.29e3c","type":"comment","z":"f4c119b9.194fb8","name":"A1.2 - ВК-модуль, Світлофор(HL1.1 - 1.4) 10.107.25.107","info":"виключений - червоний\nвключене - зелене\nled=0\n\n<response>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.107/protect/leds.cgi?led=0&timeout=0","x":390,"y":140,"wires":[]},{"id":"d6362cce.81045","type":"inject","z":"f4c119b9.194fb8","name":"status","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":130,"y":460,"wires":[["66311ab9.758334"]]},{"id":"66311ab9.758334","type":"function","z":"f4c119b9.194fb8","name":"status","func":"msg.url = 'http://admin:admin@10.107.21.11/protect/status.xml'\n\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":460,"wires":[["dcf517c.82aece8"]]},{"id":"dcf517c.82aece8","type":"http request","z":"f4c119b9.194fb8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":510,"y":460,"wires":[["eaaca3f1.f3dde"]]},{"id":"1f8cbee9.c5f4e1","type":"debug","z":"f4c119b9.194fb8","name":"","active":true,"console":false,"complete":"false","x":690,"y":200,"wires":[]},{"id":"eaaca3f1.f3dde","type":"debug","z":"f4c119b9.194fb8","name":"","active":true,"console":false,"complete":"false","x":690,"y":460,"wires":[]},{"id":"ae3fdab6.913a28","type":"inject","z":"f4c119b9.194fb8","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":240,"wires":[["e5f01142.e0a4b"]]},{"id":"e5f01142.e0a4b","type":"function","z":"f4c119b9.194fb8","name":"HL1.2 виїзд","func":"msg.url = 'http://admin:admin@10.107.21.11/protect/leds.cgi?led=1&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":240,"wires":[["b5c9d1fc.56b5d"]]},{"id":"b5c9d1fc.56b5d","type":"http request","z":"f4c119b9.194fb8","name":"","method":"GET","ret":"txt","url":"","x":510,"y":240,"wires":[["397984d3.475f2c"]]},{"id":"397984d3.475f2c","type":"debug","z":"f4c119b9.194fb8","name":"","active":true,"console":false,"complete":"false","x":690,"y":240,"wires":[]},{"id":"a343ae60.44369","type":"inject","z":"f4c119b9.194fb8","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":280,"wires":[["e6ced29.9ea833"]]},{"id":"e6ced29.9ea833","type":"function","z":"f4c119b9.194fb8","name":"HL1.3 вїзд","func":"msg.url = 'http://admin:admin@10.107.21.11/protect/leds.cgi?led=2&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":280,"wires":[["3ef64728.73af38"]]},{"id":"3ef64728.73af38","type":"http request","z":"f4c119b9.194fb8","name":"","method":"GET","ret":"txt","url":"","x":510,"y":280,"wires":[["f11cb183.1aeae"]]},{"id":"f11cb183.1aeae","type":"debug","z":"f4c119b9.194fb8","name":"","active":true,"console":false,"complete":"false","x":690,"y":280,"wires":[]},{"id":"522acd3c.2e8dd4","type":"inject","z":"f4c119b9.194fb8","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":320,"wires":[["c577e6cc.be2008"]]},{"id":"c577e6cc.be2008","type":"function","z":"f4c119b9.194fb8","name":"HL1.4 виїзд","func":"msg.url = 'http://admin:admin@10.107.21.11/protect/leds.cgi?led=3&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":320,"wires":[["4ef1128.5ff37ec"]]},{"id":"4ef1128.5ff37ec","type":"http request","z":"f4c119b9.194fb8","name":"","method":"GET","ret":"txt","url":"","x":510,"y":320,"wires":[["c84d8613.e1d4d8"]]},{"id":"c84d8613.e1d4d8","type":"debug","z":"f4c119b9.194fb8","name":"","active":true,"console":false,"complete":"false","x":690,"y":320,"wires":[]},{"id":"cfb03406.55da68","type":"comment","z":"f4c119b9.194fb8","name":"new A1.2 - ВК-модуль, Світлофор(HL1.1 - 1.4) 10.107.21.11","info":"виключений - червоний\nвключене - зелене\nled=0\n\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.107/protect/leds.cgi?led=0&timeout=0","x":400,"y":100,"wires":[]},{"id":"8ef59512.8153f8","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":110,"y":120,"wires":[["be58f7fe.7c93d8"]]},{"id":"be58f7fe.7c93d8","type":"function","z":"e6ad0c7b.94dac","name":"HL3.1 авто 1(праві ваги, направлені на ваги для виїзду)","func":"msg.url = 'http://admin:vkmodule@10.107.21.20/protect/leds.cgi?led=0&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":120,"wires":[["f518938b.76b9a"]]},{"id":"f518938b.76b9a","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":710,"y":120,"wires":[["7ae78369.4c9b0c"]]},{"id":"3b9cb6e2.7e515a","type":"comment","z":"e6ad0c7b.94dac","name":"A3.2 - ВК-модуль, Світлофор(HL3.1 - 3.4) 10.107.25.114 від воріт","info":"виключений - червоний\nвключене - зелене\nled=0\n\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.107/protect/leds.cgi?led=0&timeout=0","x":500,"y":80,"wires":[]},{"id":"7ae78369.4c9b0c","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":890,"y":120,"wires":[]},{"id":"88dc1993.c53d58","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":110,"y":160,"wires":[["fb2f1c12.2ed08"]]},{"id":"fb2f1c12.2ed08","type":"function","z":"e6ad0c7b.94dac","name":"HL3.2 авто 1 (праві ваги, направлені від вагів для заїзду)","func":"msg.url = 'http://admin:vkmodule@10.107.21.20/protect/leds.cgi?led=1&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":160,"wires":[["e03a3d27.b1c88"]]},{"id":"e03a3d27.b1c88","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":730,"y":160,"wires":[["3578f45d.a638bc"]]},{"id":"3578f45d.a638bc","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":890,"y":160,"wires":[]},{"id":"4eccd137.ce18f","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":420,"wires":[["6b2ec021.ca824"]]},{"id":"6b2ec021.ca824","type":"function","z":"e6ad0c7b.94dac","name":"Закрити Тех проїзд","func":"msg.url = 'http://admin:vkmodule@10.107.21.20/protect/leds.cgi?led=4&timeout=2'\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":420,"wires":[["54e80ee2.bf322"]]},{"id":"54e80ee2.bf322","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":590,"y":420,"wires":[["2b65082a.1c4d28"]]},{"id":"2b65082a.1c4d28","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":770,"y":420,"wires":[]},{"id":"9dbe8dc4.c9aaf","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":460,"wires":[["22ea0b29.40c104"]]},{"id":"22ea0b29.40c104","type":"function","z":"e6ad0c7b.94dac","name":"Открити Тех проїзд","func":"msg.url = 'http://admin:vkmodule@10.107.21.20/protect/leds.cgi?led=5&timeout=2'\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":460,"wires":[["d6be2ad3.ff2908"]]},{"id":"d6be2ad3.ff2908","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":590,"y":460,"wires":[["2497c1a2.629cbe"]]},{"id":"2497c1a2.629cbe","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":770,"y":460,"wires":[]},{"id":"c476586c.fb1da8","type":"comment","z":"e6ad0c7b.94dac","name":"A3.2 - ВК-модуль, Шлагбаум SH2 Тех проїзд 10.107.25.114","info":"виключений - червоний\nвключене - зелене\nled=0\n\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.107/protect/leds.cgi?led=0&timeout=0","x":460,"y":380,"wires":[]},{"id":"192591f4.6fcb5e","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":110,"y":240,"wires":[["aac9898.892e778"]]},{"id":"aac9898.892e778","type":"function","z":"e6ad0c7b.94dac","name":"HL3.3 авто 2 (ліві ваги, направлені до вагів для виїзду)","func":"msg.url = 'http://admin:vkmodule@10.107.21.20/protect/leds.cgi?led=2&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":240,"wires":[["69487634.bf3fd8"]]},{"id":"69487634.bf3fd8","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":730,"y":240,"wires":[["5286ace.9442954"]]},{"id":"5286ace.9442954","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":890,"y":240,"wires":[]},{"id":"6c306401.346d2c","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":110,"y":280,"wires":[["e636db1e.778ba8"]]},{"id":"e636db1e.778ba8","type":"function","z":"e6ad0c7b.94dac","name":"HL3.4 авто 2 (ліві ваги, направлені від вагів для заїзду)","func":"msg.url = 'http://admin:vkmodule@10.107.21.20/protect/leds.cgi?led=3&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":280,"wires":[["6e4707c9.15b4c8"]]},{"id":"6e4707c9.15b4c8","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":730,"y":280,"wires":[["6a3599c5.1dccc8"]]},{"id":"6a3599c5.1dccc8","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":890,"y":280,"wires":[]},{"id":"180d9839.e5fa88","type":"inject","z":"e6ad0c7b.94dac","name":"status","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":520,"wires":[["dcbe375d.2f6138"]]},{"id":"dcbe375d.2f6138","type":"function","z":"e6ad0c7b.94dac","name":"status 21.20","func":"msg.url = 'http://admin:vkmodule@10.107.21.20/protect/status.xml'\n\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":520,"wires":[["85b48282.88ea9"]]},{"id":"85b48282.88ea9","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","tls":"","x":530,"y":520,"wires":[["b1f017d2.432d38"]]},{"id":"b1f017d2.432d38","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":700,"y":520,"wires":[]},{"id":"ce4f1bf4.48da38","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":680,"wires":[["188838cf.558dc7"]]},{"id":"188838cf.558dc7","type":"function","z":"e6ad0c7b.94dac","name":"Закрити Веса ліві SH5","func":"msg.url = 'http://admin:vkmodule@10.107.21.18/protect/leds.cgi?led=2&timeout=2'\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":680,"wires":[["5d154718.470948"]]},{"id":"5d154718.470948","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":590,"y":680,"wires":[["972271a5.e736d"]]},{"id":"972271a5.e736d","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":770,"y":680,"wires":[]},{"id":"77dcdd7c.5f4104","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":720,"wires":[["c647ca4d.abe618"]]},{"id":"c647ca4d.abe618","type":"function","z":"e6ad0c7b.94dac","name":"Відкрити Веса ліві SH5","func":"msg.url = 'http://admin:vkmodule@10.107.21.18/protect/leds.cgi?led=3&timeout=2'\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":720,"wires":[["a1761c22.3931b"]]},{"id":"a1761c22.3931b","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":590,"y":720,"wires":[["46d61444.890d1c"]]},{"id":"46d61444.890d1c","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":770,"y":720,"wires":[]},{"id":"3bb0f3b8.e55f3c","type":"comment","z":"e6ad0c7b.94dac","name":"A2.2 - ВК-модуль(ip від 2.1) Шлагбаум SH1, SH5 - Веса 1 і 2 10.107.25.112 від воріт","info":"\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.112/protect/leds.cgi?led=0&timeout=0","x":540,"y":640,"wires":[]},{"id":"ea246f2e.9b486","type":"inject","z":"e6ad0c7b.94dac","name":"status","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":210,"y":980,"wires":[["e3161e65.22bde"]]},{"id":"e3161e65.22bde","type":"function","z":"e6ad0c7b.94dac","name":"status 21.18","func":"msg.url = 'http://admin:vkmodule@10.107.21.18/protect/status.xml'\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":980,"wires":[["607850d3.33d22"]]},{"id":"607850d3.33d22","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","tls":"","x":590,"y":980,"wires":[["8edf0c1b.d326f"]]},{"id":"8edf0c1b.d326f","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":760,"y":980,"wires":[]},{"id":"d4f18274.d8621","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":820,"wires":[["8aeeaa5.f7e4e58"]]},{"id":"8aeeaa5.f7e4e58","type":"function","z":"e6ad0c7b.94dac","name":"Закрити Веса праві SH1","func":"msg.url = 'http://admin:vkmodule@10.107.21.18/protect/leds.cgi?led=4&timeout=2'\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":820,"wires":[["9a40848c.a4c458"]]},{"id":"9a40848c.a4c458","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":590,"y":820,"wires":[["bdbea25e.e34ba"]]},{"id":"bdbea25e.e34ba","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":770,"y":820,"wires":[]},{"id":"7516e6a6.5c9058","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":860,"wires":[["ffddc66e.ebefe8"]]},{"id":"ffddc66e.ebefe8","type":"function","z":"e6ad0c7b.94dac","name":"Відкрити Веса праві SH1","func":"msg.url = 'http://admin:vkmodule@10.107.21.18/protect/leds.cgi?led=5&timeout=2'\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":860,"wires":[["b69a4c78.ebb98"]]},{"id":"b69a4c78.ebb98","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":590,"y":860,"wires":[["5f500e2c.cff15"]]},{"id":"5f500e2c.cff15","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":770,"y":860,"wires":[]},{"id":"3e84d7af.5f3d38","type":"comment","z":"e6ad0c7b.94dac","name":"A3.1 - ВК-модуль Датчики периметра -  Веса 1 і 2 для заїзду від відворіт 10.107.25.113","info":"<response>\n<btn0>dn</btn0> - ліві ваги(dn - непересічьон, up - пересічон),\n<btn1>dn</btn1> - праві ваги(dn - непересічьон, up - пересічон),\n<btn2>up</btn2> - резерв\n<btn3>up</btn3> - резерв\n</response>\n\n\n\n http://10.107.25.113/protect/leds.cgi?led=0&timeout=0","x":470,"y":1082.8571949005127,"wires":[]},{"id":"9a0a6bf8.22fab8","type":"inject","z":"e6ad0c7b.94dac","name":"status","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":190,"y":1160,"wires":[["d1354eeb.a60c5"]]},{"id":"d1354eeb.a60c5","type":"function","z":"e6ad0c7b.94dac","name":"status 21.19","func":"msg.url = 'http://admin:admin@10.107.21.19/protect/status.xml'\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":1160,"wires":[["3f5e66e9.836e4a"]]},{"id":"3f5e66e9.836e4a","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","tls":"","x":570,"y":1160,"wires":[["63835b1c.6c84e4","f2b354f7.3a88a8"]]},{"id":"63835b1c.6c84e4","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":740,"y":1160,"wires":[]},{"id":"be4bfbc5.6f8488","type":"comment","z":"e6ad0c7b.94dac","name":"A4.1 - ВК-модуль Датчики периметра -  Веса 1 і 2 для заїзду від елеватора 10.107.25.119","info":"<response>\n<btn0>dn</btn0> - ліві ваги(dn - непересічьон, up - пересічон),\n<btn1>dn</btn1> - праві ваги(dn - непересічьон, up - пересічон),\n<btn2>up</btn2> - резерв\n<btn3>up</btn3> - резерв\n</response>\n\n\n\n http://10.107.25.113/protect/leds.cgi?led=0&timeout=0","x":560,"y":1240,"wires":[]},{"id":"fb3e584d.f1ee58","type":"inject","z":"e6ad0c7b.94dac","name":"status","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":210,"y":1300,"wires":[["d268b72e.680388"]]},{"id":"d268b72e.680388","type":"function","z":"e6ad0c7b.94dac","name":"status 21.25","func":"msg.url = 'http://admin:admin@10.107.21.25/protect/status.xml'\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1300,"wires":[["1eb73270.a4dbee"]]},{"id":"1eb73270.a4dbee","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","tls":"","x":590,"y":1300,"wires":[["92c6b0bc.9fe07","f2b354f7.3a88a8"]]},{"id":"92c6b0bc.9fe07","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":760,"y":1300,"wires":[]},{"id":"170e7b37.e87175","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":130,"y":1420,"wires":[["dc3930b4.073a8"]]},{"id":"dc3930b4.073a8","type":"function","z":"e6ad0c7b.94dac","name":"HL3.5 авто 1(праві ваги, направлені на ваги для виїзду від елеватора)","func":"msg.url = 'http://admin:vkmodule@10.107.21.26/protect/leds.cgi?led=0&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":1420,"wires":[["f49b047f.63b998"]]},{"id":"f49b047f.63b998","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":850,"y":1420,"wires":[["3a2d6e4f.1d10a2"]]},{"id":"e99dfb82.961848","type":"comment","z":"e6ad0c7b.94dac","name":"A4.2 - ВК-модуль, Світлофор(HL3.5 - 3.8) 10.107.25.120 від елеватора","info":"виключений - червоний\nвключене - зелене\nled=0\n\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.107/protect/leds.cgi?led=0&timeout=0","x":540,"y":1380,"wires":[]},{"id":"3a2d6e4f.1d10a2","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":1050,"y":1420,"wires":[]},{"id":"75ce134d.88108c","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":130,"y":1460,"wires":[["ecb35346.b36"]]},{"id":"ecb35346.b36","type":"function","z":"e6ad0c7b.94dac","name":"HL3.6 авто 1 (праві ваги, направлені від вагів для заїзду від елеватора)","func":"msg.url = 'http://admin:vkmodule@10.107.21.26/protect/leds.cgi?led=1&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":1460,"wires":[["6b7d63e4.95616c"]]},{"id":"6b7d63e4.95616c","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":850,"y":1460,"wires":[["9f7bee31.cbbee"]]},{"id":"9f7bee31.cbbee","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":1050,"y":1460,"wires":[]},{"id":"d4c68441.ac20d8","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":130,"y":1540,"wires":[["c29c1712.8014f8"]]},{"id":"c29c1712.8014f8","type":"function","z":"e6ad0c7b.94dac","name":"HL3.7 авто 2 (ліві ваги, направлені від вагів для заїзду від елеватора)","func":"msg.url = 'http://admin:vkmodule@10.107.21.26/protect/leds.cgi?led=4&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":1540,"wires":[["19fc2220.33787e"]]},{"id":"19fc2220.33787e","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":890,"y":1540,"wires":[["a08550f8.298b4"]]},{"id":"a08550f8.298b4","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":1050,"y":1540,"wires":[]},{"id":"c5a974.7848669","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":130,"y":1580,"wires":[["de27fafc.f07eb8"]]},{"id":"de27fafc.f07eb8","type":"function","z":"e6ad0c7b.94dac","name":"HL3.8 авто 2 (ліві ваги, направлені до вагів для виїзду від елеватора)","func":"msg.url = 'http://admin:vkmodule@10.107.21.26/protect/leds.cgi?led=5&timeout=0'\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":1580,"wires":[["1a10a58a.cb21da"]]},{"id":"1a10a58a.cb21da","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":890,"y":1580,"wires":[["22fe79ce.6f8ac6"]]},{"id":"22fe79ce.6f8ac6","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":1050,"y":1580,"wires":[]},{"id":"3e579c0e.3460c4","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":1740,"wires":[["2801266a.299aba"]]},{"id":"2801266a.299aba","type":"function","z":"e6ad0c7b.94dac","name":"Закрити Веса  праві(немає плати)","func":"msg.url = 'http://admin:vkmodule@10.107.21.26/protect/leds.cgi?led=2&timeout=2'\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":1740,"wires":[["9f02d513.09c5c8"]]},{"id":"9f02d513.09c5c8","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":710,"y":1740,"wires":[["e7efaca1.f0194"]]},{"id":"e7efaca1.f0194","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":890,"y":1740,"wires":[]},{"id":"dc2def49.a5277","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":1780,"wires":[["f64d2f1b.c8591"]]},{"id":"f64d2f1b.c8591","type":"function","z":"e6ad0c7b.94dac","name":"Відкрити Веса праві(немає плати)","func":"msg.url = 'http://admin:vkmodule@10.107.21.26/protect/leds.cgi?led=3&timeout=2'\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":1780,"wires":[["542e3c58.663144"]]},{"id":"542e3c58.663144","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":710,"y":1780,"wires":[["3485a32e.993cdc"]]},{"id":"3485a32e.993cdc","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":890,"y":1780,"wires":[]},{"id":"d0979d60.a7cce","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":1880,"wires":[["9f4cb0f7.1eac5"]]},{"id":"9f4cb0f7.1eac5","type":"function","z":"e6ad0c7b.94dac","name":"Закрити Веса  ліві","func":"msg.url = 'http://admin:vkmodule@10.107.21.26/protect/leds.cgi?led=6&timeout=2'\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":1880,"wires":[["9ef385a2.b22c68"]]},{"id":"9ef385a2.b22c68","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":590,"y":1880,"wires":[["a8c1dd53.55101"]]},{"id":"a8c1dd53.55101","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":770,"y":1880,"wires":[]},{"id":"f512ef86.4c459","type":"inject","z":"e6ad0c7b.94dac","name":"перемикання","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":1920,"wires":[["f6afc557.0302d8"]]},{"id":"f6afc557.0302d8","type":"function","z":"e6ad0c7b.94dac","name":"Відкрити Веса ліві","func":"msg.url = 'http://admin:vkmodule@10.107.21.26/protect/leds.cgi?led=7&timeout=2'\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":1920,"wires":[["36786a6c.540a46"]]},{"id":"36786a6c.540a46","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","x":590,"y":1920,"wires":[["adfb0cda.ab8bf"]]},{"id":"adfb0cda.ab8bf","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":770,"y":1920,"wires":[]},{"id":"f0185ed7.46d2b","type":"comment","z":"e6ad0c7b.94dac","name":"A4.2 - ВК-модуль(ip від 2.1) Шлагбаум SH3, SH4 - Веса 1 і 2 10.107.21.26 від елеватора","info":"\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.112/protect/leds.cgi?led=0&timeout=0","x":590,"y":1680,"wires":[]},{"id":"ccb63122.dde59","type":"inject","z":"e6ad0c7b.94dac","name":"status","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":210,"y":2020,"wires":[["e05f6bba.01d4e8"]]},{"id":"e05f6bba.01d4e8","type":"function","z":"e6ad0c7b.94dac","name":"status 21.26","func":"msg.url = 'http://admin:vkmodule@10.107.21.26/protect/status.xml'\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":2020,"wires":[["e6a34394.ad7b4"]]},{"id":"e6a34394.ad7b4","type":"http request","z":"e6ad0c7b.94dac","name":"","method":"GET","ret":"txt","url":"","tls":"","x":590,"y":2020,"wires":[["663a0cc2.261544"]]},{"id":"663a0cc2.261544","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":760,"y":2020,"wires":[]},{"id":"bab62674.a39cb8","type":"comment","z":"e6ad0c7b.94dac","name":"A3.3 - ВК-модуль() ваги ліві ІП- 10.107.25.115","info":"\n\n\n\n http://10.107.25.115/protect/leds.cgi?led=0&timeout=0","x":400,"y":2140,"wires":[]},{"id":"115c399c.8f9e46","type":"inject","z":"e6ad0c7b.94dac","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":180,"y":2220,"wires":[["f5da1ebc.6acf2"]]},{"id":"f5da1ebc.6acf2","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = String.fromCharCode(0);\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":2220,"wires":[["6209e90d.bd6eb8"]]},{"id":"6209e90d.bd6eb8","type":"tcp request","z":"e6ad0c7b.94dac","server":"10.107.21.21","port":"9761","out":"time","splitc":"200","name":"","x":540,"y":2220,"wires":[["5855799f.b53638"]]},{"id":"5855799f.b53638","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":770,"y":2220,"wires":[]},{"id":"fb757182.5882e","type":"comment","z":"e6ad0c7b.94dac","name":"A3.4 - ВК-модуль() ваги праві ІП- 10.107.25.116","info":"\n\n\n\n http://10.107.25.115/protect/leds.cgi?led=0&timeout=0","x":380,"y":2320,"wires":[]},{"id":"ecb2229f.38443","type":"inject","z":"e6ad0c7b.94dac","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":180,"y":2380,"wires":[["607eaaf0.1365a4"]]},{"id":"607eaaf0.1365a4","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = String.fromCharCode(0);\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":2380,"wires":[["63dc51de.bd635"]]},{"id":"63dc51de.bd635","type":"tcp request","z":"e6ad0c7b.94dac","server":"10.107.21.22","port":"9761","out":"count","splitc":"12","name":"","x":540,"y":2380,"wires":[["7cd2bb37.65a164"]]},{"id":"847fa310.36344","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":false,"complete":"false","x":1010,"y":2380,"wires":[]},{"id":"7cd2bb37.65a164","type":"function","z":"e6ad0c7b.94dac","name":"","func":"var str = msg.payload\nmsg.payload = str.substring(1,8);\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":2380,"wires":[["847fa310.36344"]]},{"id":"98040cc1.bacd5","type":"comment","z":"e6ad0c7b.94dac","name":"QL3   Табло 10.107.25.123 Ваги праві дальні від воріт","info":"","x":440,"y":2560,"wires":[]},{"id":"fcd03830.112ad8","type":"inject","z":"e6ad0c7b.94dac","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":200,"y":2620,"wires":[["a5473d83.812f","913c76ec.e70d18"]]},{"id":"a5473d83.812f","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = '<s1>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":2620,"wires":[["42471c38.5e23a4"]]},{"id":"42471c38.5e23a4","type":"converter","z":"e6ad0c7b.94dac","name":"","from":"win1251","x":500,"y":2640,"wires":[[]]},{"id":"913c76ec.e70d18","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = '<s2>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":2660,"wires":[["42471c38.5e23a4"]]},{"id":"e39549f7.aee9f8","type":"comment","z":"e6ad0c7b.94dac","name":"QL4  Табло 10.107.25.124 Ваги ліві дальні від воріт","info":"","x":390,"y":2760,"wires":[]},{"id":"e0996914.f798b8","type":"inject","z":"e6ad0c7b.94dac","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":160,"y":2820,"wires":[["c827fd96.8f919","43dd7634.ca6eb8"]]},{"id":"c827fd96.8f919","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = '<s1>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":2820,"wires":[["91fd8172.f405b"]]},{"id":"91fd8172.f405b","type":"converter","z":"e6ad0c7b.94dac","name":"","from":"win1251","x":460,"y":2840,"wires":[[]]},{"id":"43dd7634.ca6eb8","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = '<s2>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":2860,"wires":[["91fd8172.f405b"]]},{"id":"a586fae0.de3a38","type":"comment","z":"e6ad0c7b.94dac","name":"QL1 Табло 10.107.25.121 Ваги ліві ближні до воріт","info":"","x":410,"y":2940,"wires":[]},{"id":"8c8c217e.94fdc","type":"inject","z":"e6ad0c7b.94dac","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":180,"y":3000,"wires":[["8bdba146.17015","5c85181c.2ebbc8"]]},{"id":"8bdba146.17015","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = '<s1>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":3000,"wires":[["da9b31bb.bec8e"]]},{"id":"da9b31bb.bec8e","type":"converter","z":"e6ad0c7b.94dac","name":"","from":"win1251","x":480,"y":3020,"wires":[[]]},{"id":"5c85181c.2ebbc8","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = '<s2>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":3040,"wires":[["da9b31bb.bec8e"]]},{"id":"ac40132d.7d06f","type":"comment","z":"e6ad0c7b.94dac","name":"QL2 Табло 10.107.25.122 Ваги праві ближні до ворті","info":"","x":420,"y":3120,"wires":[]},{"id":"a9b78ec7.a2e28","type":"inject","z":"e6ad0c7b.94dac","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":180,"y":3180,"wires":[["4ae9ce9e.f1b97","e18b213f.50eef"]]},{"id":"4ae9ce9e.f1b97","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = '<s1>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":3180,"wires":[["34fbedb0.16bca2"]]},{"id":"34fbedb0.16bca2","type":"converter","z":"e6ad0c7b.94dac","name":"","from":"win1251","x":480,"y":3200,"wires":[[]]},{"id":"e18b213f.50eef","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = '<s2>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":3220,"wires":[["34fbedb0.16bca2"]]},{"id":"a092864c.eff438","type":"comment","z":"e6ad0c7b.94dac","name":"QL10 Табло 10.107.25.125 Між воротами лівими і правими на 3 рядки","info":"","x":500,"y":3320,"wires":[]},{"id":"f2e5686a.596fa8","type":"inject","z":"e6ad0c7b.94dac","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":200,"y":3380,"wires":[["80f58ba5.83a378","76e3c352.a442cc"]]},{"id":"80f58ba5.83a378","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = '<s1>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":3380,"wires":[["5f1bb45a.b7c1bc"]]},{"id":"5f1bb45a.b7c1bc","type":"converter","z":"e6ad0c7b.94dac","name":"","from":"win1251","x":500,"y":3400,"wires":[[]]},{"id":"76e3c352.a442cc","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = '<s2>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":3420,"wires":[["5f1bb45a.b7c1bc"]]},{"id":"dd569b16.ae8808","type":"comment","z":"e6ad0c7b.94dac","name":"Додав сьогодні 8.02","info":"**Додав сьогодні**","x":170,"y":2480,"wires":[]},{"id":"f4908212.79676","type":"comment","z":"e6ad0c7b.94dac","name":" новий A3.2 - ВК-модуль, Світлофор(HL3.1 - 3.4) 10.107.21.20 від воріт","info":"виключений - червоний\nвключене - зелене\nled=0\n\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.107/protect/leds.cgi?led=0&timeout=0","x":520,"y":40,"wires":[]},{"id":"efd2ff8c.3a11a","type":"comment","z":"e6ad0c7b.94dac","name":"новий A3.2 - ВК-модуль, Шлагбаум SH2 Тех проїзд 10.107.21.20","info":"виключений - червоний\nвключене - зелене\nled=0\n\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.107/protect/leds.cgi?led=0&timeout=0","x":480,"y":340,"wires":[]},{"id":"a2e8a773.b2c638","type":"comment","z":"e6ad0c7b.94dac","name":"новий A2.2 - ВК-модуль(ip від 2.1) Шлагбаум SH1, SH5 - Веса 1 і 2 10.107.21.18 від воріт","info":"\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.112/protect/leds.cgi?led=0&timeout=0","x":560,"y":600,"wires":[]},{"id":"d0c35d3c.21838","type":"comment","z":"e6ad0c7b.94dac","name":"new A3.1 - ВК-модуль Датчики периметра -  Веса 1 і 2 для заїзду від відворіт 10.107.21.19","info":"<response>\n<btn0>dn</btn0> - ліві ваги(dn - непересічьон, up - пересічон),\n<btn1>dn</btn1> - праві ваги(dn - непересічьон, up - пересічон),\n<btn2>up</btn2> - резерв\n<btn3>up</btn3> - резерв\n</response>\n\n\n\n http://10.107.25.113/protect/leds.cgi?led=0&timeout=0","x":490,"y":1044.285732269287,"wires":[]},{"id":"3895c696.43762a","type":"comment","z":"e6ad0c7b.94dac","name":"new A4.1 - ВК-модуль Датчики периметра -  Веса 1 і 2 для заїзду від елеватора 10.107.21.25","info":"<response>\n<btn0>dn</btn0> - ліві ваги(dn - непересічьон, up - пересічон),\n<btn1>dn</btn1> - праві ваги(dn - непересічьон, up - пересічон),\n<btn2>up</btn2> - резерв\n<btn3>up</btn3> - резерв\n</response>\n\n\n\n http://10.107.25.113/protect/leds.cgi?led=0&timeout=0","x":570,"y":1200,"wires":[]},{"id":"79f09323.d308bc","type":"comment","z":"e6ad0c7b.94dac","name":"new A4.2 - ВК-модуль, Світлофор(HL3.5 - 3.8) 10.107.21.26 від елеватора","info":"виключений - червоний\nвключене - зелене\nled=0\n\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.107/protect/leds.cgi?led=0&timeout=0","x":550,"y":1340,"wires":[]},{"id":"67a7828c.1f859c","type":"comment","z":"e6ad0c7b.94dac","name":"new A3.3 - ВК-модуль() ваги ліві ІП- 10.107.21.21","info":"\n\n\n\n http://10.107.25.115/protect/leds.cgi?led=0&timeout=0","x":410,"y":2100,"wires":[]},{"id":"3544c102.26412e","type":"comment","z":"e6ad0c7b.94dac","name":"new A3.4 - ВК-модуль() ваги праві ІП- 10.107.21.22","info":"\n\n\n\n http://10.107.25.115/protect/leds.cgi?led=0&timeout=0","x":390,"y":2280,"wires":[]},{"id":"c9539b37.988fe8","type":"http in","z":"c94645b6.8b6ca8","name":"","url":"/unloading2/test","method":"post","swaggerDoc":"","x":180,"y":120,"wires":[["506eaae1.e32b14","16f9e330.55e9cd"]]},{"id":"2ae3e7ae.bea358","type":"comment","z":"c94645b6.8b6ca8","name":"Авторазгрузка 2; модуль A6.1: Світлофор(HL4.2) 10.107.21.44","info":"виключений - червоний\nвключене - зелене\nled=0\n\n\n","x":460,"y":80,"wires":[]},{"id":"a1491d4.3f249e","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1050,"y":120,"wires":[]},{"id":"506eaae1.e32b14","type":"function","z":"c94645b6.8b6ca8","name":"","func":"var url = msg.payload.url;\nmsg.url = url;\n\nreturn msg;\n\n/*\n\n{\n\"ip\": \"10.107.21.44\",\n\"login\": \"admin\",\n\"password\": \"admin\",\n\"led\": 0,\n\"status\": false,\n\"url\": \"http://admin:admin@10.107.21.44/protect/leds.cgi?led=0&timeout=0\"\n}\n\n*/\n\n","outputs":1,"noerr":0,"x":590,"y":120,"wires":[["1b14bc80.e0c964","aa71d5e0.6d1618"]]},{"id":"aa71d5e0.6d1618","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","x":910,"y":120,"wires":[["a1491d4.3f249e"]]},{"id":"bfc1be8b.fdb79","type":"comment","z":"c94645b6.8b6ca8","name":"Авторазгрузка 3; модуль A8.1: Світлофор(HL5.1) 10.107.21.51","info":"виключений - червоний\nвключене - зелене\nled=0\n\n\n","x":460,"y":180,"wires":[]},{"id":"14098e04.5fd5a2","type":"http in","z":"c94645b6.8b6ca8","name":"","url":"/unloading3/test","method":"post","swaggerDoc":"","x":240,"y":340,"wires":[["20952dbc.25f252","fddb4f.509904b"]]},{"id":"58809de7.397074","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1090,"y":340,"wires":[]},{"id":"2a6d1cce.9de5d4","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","x":910,"y":340,"wires":[["58809de7.397074"]]},{"id":"8c981ffd.5eb73","type":"comment","z":"c94645b6.8b6ca8","name":"Авторазгрузка 4; модуль A7.1: Світлофор(HL5.2) 10.107.21.50","info":"виключений - червоний\nвключене - зелене\nled=0\n\n\n","x":510,"y":440,"wires":[]},{"id":"107a076e.0e33f9","type":"http in","z":"c94645b6.8b6ca8","name":"","url":"/unloading4/test","method":"post","swaggerDoc":"","x":230,"y":480,"wires":[["434b2409.44739c"]]},{"id":"5772df97.c9a","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1050,"y":480,"wires":[]},{"id":"434b2409.44739c","type":"function","z":"c94645b6.8b6ca8","name":"","func":"var url = msg.payload.url;\nmsg.url = url;\n\n// var status2 = msg.payload.status;\n\n// //var status = flow.get(\"10.107.21.44_0\");\n// var flowVar = `${msg.payload.ip}_${msg.payload.led}`\n// var flowDynamic = flow.get(flowVar);\n// var toBoolen = flowDynamic[0] === \"1\"\n\n// if(status2 !== toBoolen){\n//     msg.restore = true\n//     return msg;\n// }\n// msg.restore = false\nreturn msg;\n\n\n//return msg;","outputs":1,"noerr":0,"x":515,"y":480,"wires":[["e49e67e1.6a8e78"]]},{"id":"e49e67e1.6a8e78","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","x":890,"y":480,"wires":[["5772df97.c9a"]]},{"id":"fddb4f.509904b","type":"function","z":"c94645b6.8b6ca8","name":"","func":"var url = msg.payload.url;\nmsg.url = url;\n\n// var status2 = msg.payload.status;\n\n// //var status = flow.get(\"10.107.21.44_0\");\n// var flowVar = `${msg.payload.ip}_${msg.payload.led}`\n// var flowDynamic = flow.get(flowVar);\n// var toBoolen = flowDynamic[0] === \"1\"\n\n// if(status2 !== toBoolen){\n//     msg.restore = true\n//     return msg;\n// }\n// msg.restore = false\nreturn msg;\n\n\n//return msg;","outputs":1,"noerr":0,"x":450,"y":340,"wires":[["2a6d1cce.9de5d4"]]},{"id":"444f4f41.14b46","type":"http in","z":"c94645b6.8b6ca8","name":"","url":"/kpp/test","method":"post","swaggerDoc":"","x":190,"y":600,"wires":[["2a9358c0.fbd948"]]},{"id":"ecf0495.ec969b8","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1010,"y":600,"wires":[]},{"id":"2a9358c0.fbd948","type":"function","z":"c94645b6.8b6ca8","name":"","func":"var url = msg.payload.url;\nmsg.url = url;\n\n\n// var status2 = msg.payload.status;\n\n// //var status = flow.get(\"10.107.21.44_0\");\n// var flowVar = `${msg.payload.ip}_${msg.payload.led}`\n// var flowDynamic = flow.get(flowVar);\n// var toBoolen = flowDynamic[0] === \"1\"\n\n// if(status2 !== toBoolen){\n//     msg.restore = true\n//     return msg;\n// }\n// msg.restore = false\nreturn msg;\n\n\n//return msg;","outputs":1,"noerr":0,"x":450,"y":600,"wires":[["d9707dfa.7ef69"]]},{"id":"d9707dfa.7ef69","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","x":850,"y":600,"wires":[["ecf0495.ec969b8"]]},{"id":"d8ea9fd.ce5b56","type":"comment","z":"c94645b6.8b6ca8","name":"КПП-Регистрация; модуль A1.2: Світлофор(HL1.1 - 1.4)  10.107.21.11","info":"виключений - червоний\nвключене - зелене\nled=0\n\n\n","x":510,"y":560,"wires":[]},{"id":"64277362.4f72bc","type":"comment","z":"c94645b6.8b6ca8","name":"Ліві і Праві ваги; Модуль: A4.2; Світлофор(HL3.5 - 3.8) 10.107.21.26 від елеватора(дальні)","info":"виключений - червоний\nвключене - зелене\nled=0\n\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.107/protect/leds.cgi?led=0&timeout=0","x":600,"y":740,"wires":[]},{"id":"6804ac03.f27ff4","type":"http in","z":"c94645b6.8b6ca8","name":"","url":"/LightsWeight/test","method":"post","swaggerDoc":"","x":220,"y":820,"wires":[["36e8d2f.18f6f2e","c5bcfee8.6426f"]]},{"id":"fc6459e0.929cb8","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1010,"y":820,"wires":[]},{"id":"36e8d2f.18f6f2e","type":"function","z":"c94645b6.8b6ca8","name":"","func":"var url = msg.payload.url;\nmsg.url = url;\n\n\n// var status2 = msg.payload.status;\n\n// //var status = flow.get(\"10.107.21.44_0\");\n// var flowVar = `${msg.payload.ip}_${msg.payload.led}`\n// var flowDynamic = flow.get(flowVar);\n// var toBoolen = flowDynamic[0] === \"1\"\n\n// if(status2 !== toBoolen){\n//     msg.restore = true\n//     return msg;\n// }\n// msg.restore = false\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":820,"wires":[["ce4bda62.b49678"]]},{"id":"ce4bda62.b49678","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","x":830,"y":820,"wires":[["fc6459e0.929cb8"]]},{"id":"dadff230.1aa79","type":"comment","z":"c94645b6.8b6ca8","name":"Ліві і Праві ваги; Модуль A3.2, Світлофор(HL3.1 - 3.4) 10.107.21.20 від воріт","info":"виключений - червоний\nвключене - зелене\nled=0\n\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.107/protect/leds.cgi?led=0&timeout=0","x":560,"y":780,"wires":[]},{"id":"43720e7a.fe8b2","type":"comment","z":"628e4e9b.6792d","name":"Тех проїзд: Модуль A3.2 , Шлагбаум SH2 10.107.21.20","info":"виключений - червоний\nвключене - зелене\nled=0\n\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.107/protect/leds.cgi?led=0&timeout=0","x":350,"y":60,"wires":[]},{"id":"8503eaa7.656e98","type":"comment","z":"628e4e9b.6792d","name":"Ліві і Праві ваги; Модуль A2.2 Шлагбаум SH1, SH5 10.107.21.18 від воріт","info":"\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.112/protect/leds.cgi?led=0&timeout=0","x":410,"y":100,"wires":[]},{"id":"c4f68c05.4920f","type":"comment","z":"628e4e9b.6792d","name":"Ліві і Праві ваги; Модуль A4.2 Шлагбаум SH3, SH4 10.107.21.26 від елеватора","info":"\nresponse>\n<led0>0</led0> - червоне\n<led1>0</led1> - червоне\n<led2>0</led2> - червоне\n<led3>1</led3> - зелене\n<led4>0</led4> - резер\n<led5>0</led5> - резер\n<led6>0</led6> - резер\n<led7>0</led7> - резер\n</response>\n\n\n\n\n http://10.107.25.112/protect/leds.cgi?led=0&timeout=0","x":420,"y":140,"wires":[]},{"id":"facebf76.7d237","type":"http in","z":"628e4e9b.6792d","name":"","url":"/barrierWeight","method":"post","swaggerDoc":"","x":150,"y":180,"wires":[["aabc79cb.09bc68"]]},{"id":"b528dd16.6cb9a","type":"http response","z":"628e4e9b.6792d","name":"","x":717.5,"y":181.25,"wires":[]},{"id":"aabc79cb.09bc68","type":"function","z":"628e4e9b.6792d","name":"","func":"var url = msg.payload.url;\nmsg.url = url;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":185,"wires":[["950a62e.7ec97a","b9d154a5.e2cf08"]]},{"id":"950a62e.7ec97a","type":"http request","z":"628e4e9b.6792d","name":"","method":"GET","ret":"txt","url":"","x":568.75,"y":178.75,"wires":[["b528dd16.6cb9a","b9d154a5.e2cf08"]]},{"id":"1ffd2f79.0345a1","type":"comment","z":"ddef2aec.70f948","name":"Ліві і Праві ваги: Модуль A3.1 Датчики периметра, заїзд від відворіт 10.107.21.19","info":"<response>\n<btn0>dn</btn0> - ліві ваги(dn - непересічьон, up - пересічон),\n<btn1>dn</btn1> - праві ваги(dn - непересічьон, up - пересічон),\n<btn2>up</btn2> - резерв\n<btn3>up</btn3> - резерв\n</response>\n\n\n\n http://10.107.25.113/protect/leds.cgi?led=0&timeout=0","x":310,"y":40,"wires":[]},{"id":"4cb28ab4.f15ed4","type":"http in","z":"ddef2aec.70f948","name":"","url":"/perimeterWeight","method":"post","swaggerDoc":"","x":180,"y":120,"wires":[["dc0e674f.e6e728"]]},{"id":"375daac8.ecefb6","type":"http response","z":"ddef2aec.70f948","name":"","x":1050,"y":120,"wires":[]},{"id":"dc0e674f.e6e728","type":"function","z":"ddef2aec.70f948","name":"","func":"var url = msg.payload.url;\nmsg.url = url;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":120,"wires":[["88bfeec8.4fedc"]]},{"id":"88bfeec8.4fedc","type":"http request","z":"ddef2aec.70f948","name":"","method":"GET","ret":"txt","url":"","x":570,"y":120,"wires":[["5c5ba1b9.56dda"]]},{"id":"16850e85.52d5d1","type":"comment","z":"ddef2aec.70f948","name":"Ліві і Праві ваги: Модуль A4.1 Датчики периметра, заїзд від елеватора 10.107.21.25","info":"<response>\n<btn0>dn</btn0> - ліві ваги(dn - непересічьон, up - пересічон),\n<btn1>dn</btn1> - праві ваги(dn - непересічьон, up - пересічон),\n<btn2>up</btn2> - резерв\n<btn3>up</btn3> - резерв\n</response>\n\n\n\n http://10.107.25.113/protect/leds.cgi?led=0&timeout=0","x":320,"y":80,"wires":[]},{"id":"670ae3f2.f98e6c","type":"debug","z":"d3d5daa0.5f1058","name":"","active":true,"console":"false","complete":"false","x":890,"y":340,"wires":[]},{"id":"178cf2ba.126afd","type":"http in","z":"ddef2aec.70f948","name":"","url":"/perimeterWeightGET","method":"get","swaggerDoc":"","x":170,"y":180,"wires":[["664345dd.7fb62c"]]},{"id":"9fbd0fe4.eb3f2","type":"http response","z":"ddef2aec.70f948","name":"","x":1050,"y":180,"wires":[]},{"id":"664345dd.7fb62c","type":"function","z":"ddef2aec.70f948","name":"","func":"msg.url = 'http://admin:admin@10.107.21.19/protect/status.xml'\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":180,"wires":[["44776b7b.ce43d4"]]},{"id":"44776b7b.ce43d4","type":"http request","z":"ddef2aec.70f948","name":"","method":"GET","ret":"txt","url":"","x":550,"y":180,"wires":[["ae9dea72.8528c8"]]},{"id":"20952dbc.25f252","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":"false","complete":"false","x":490,"y":380,"wires":[]},{"id":"c9538383.5c659","type":"inject","z":"725358f3.31ba08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":130,"y":120,"wires":[["8e63dc6b.38517"]]},{"id":"8e63dc6b.38517","type":"function","z":"725358f3.31ba08","name":"INIt","func":"//З Апекса в 1С\nglobal.set(\"send_1c_url_RaiseBarrier\", \"https://10.101.71.7/ONC_ELC_SCAT_TST/hs/PerimeterControl/api/Granary/RaiseBarrier\");\n//Аналізатор -  відправка з Атома на 1С\nglobal.set(\"send_1c_url_quality\", \"https://10.101.71.7/ONC_ELC_SCAT_TST/hs/PerimeterControl/api/SmartScales/quality\");\n//Зважування - відправка з Атома на 1С\nglobal.set(\"send_1c_url_GetWeight\", \"https://10.101.71.7/ONC_ELC_SCAT_TST/hs/PerimeterControl/api/Granary/GetWeight\");\n//Обмження для відправки зважування в 1С при зїзді\nglobal.set(\"filterSend1C\", 10);\n//Ітерації для перевірки на стабільність, базове величина, для деяких вагів редактувати\nglobal.set('iteration', 10);\n//дельта для стабільності\nglobal.set('stableDiff', 20);\n//час на очікування ваги, для відправки штучно 0 кг\nglobal.set(\"timeWaitWeight\", 40000);","outputs":1,"noerr":0,"x":290,"y":120,"wires":[[]]},{"id":"f0c6956f.fd0bd8","type":"comment","z":"725358f3.31ba08","name":"INIT","info":"","x":100,"y":80,"wires":[]},{"id":"ed6314a6.b02398","type":"inject","z":"725358f3.31ba08","name":"","topic":"","payload":"","payloadType":"date","repeat":"3600","crontab":"","once":false,"x":130,"y":260,"wires":[["2509860b.e671da"]]},{"id":"2509860b.e671da","type":"exec","z":"725358f3.31ba08","command":"rm -rf /distr/core.*","addpay":false,"append":"","useSpawn":"","timer":"","name":"","x":310,"y":260,"wires":[["a02bdcd0.e228a"],[],[]]},{"id":"a02bdcd0.e228a","type":"debug","z":"725358f3.31ba08","name":"","active":true,"console":"false","complete":"false","x":490,"y":240,"wires":[]},{"id":"85066348.2b325","type":"comment","z":"725358f3.31ba08","name":"remove core file","info":"","x":120,"y":220,"wires":[]},{"id":"a0cae709.7ee758","type":"function","z":"b744ff99.c78b6","name":"GET WEIGHT","func":"var payload = msg.payload;\nvar parser = flow.get('parser');\nvar currentWeight = parser(payload);\n\nif(currentWeight > -80){\n    flow.set('currentWeight',currentWeight);\n    msg.connect = \"yes\"\n    msg.payload = currentWeight;\n    global.set('weight_1', currentWeight);\n    return msg;\n}\n","outputs":1,"noerr":0,"x":700,"y":280,"wires":[["a4d7ca9c.e4ece8","23a52e15.7a8272"]]},{"id":"a84fb537.60e0c8","type":"inject","z":"b744ff99.c78b6","name":"init","topic":"","payload":"init","payloadType":"str","repeat":"","crontab":"","once":true,"x":87.99999618530273,"y":100.99999809265137,"wires":[["3e461d04.0d41d2"]]},{"id":"17ac343f.3b189c","type":"comment","z":"b744ff99.c78b6","name":"INITIALIZING Ліві ваги","info":"","x":100,"y":60,"wires":[]},{"id":"3e461d04.0d41d2","type":"function","z":"b744ff99.c78b6","name":"Модель весов","func":"flow.set('inputString',\"CMD\");\nflow.set('parser',function(v){\n        \n        var weight = v.split(\"\").reverse().join(\"\");\n        weight = weight.replace(\"=\",\"\")\n        weight = Number(weight)\n        //v = v.substring(0,6);\n        //v = v.replace('S','');\n        //v = v.replace('D','');\n        //v = v.replace('kg','');\n        //return Number(v);\n        v = weight;\n        return v;\n        }\n    );\nglobal.set('scale_id_in','12aa2a6c-1c4d-7481-1706-5db81f019000');\nglobal.set('ip','10.107.21.150');\nglobal.set('video_camera_url_1','');\n   \nreturn msg;","outputs":1,"noerr":0,"x":298,"y":100.4285659790039,"wires":[[]]},{"id":"23a52e15.7a8272","type":"link out","z":"b744ff99.c78b6","name":"Авто 1 W1","links":["19389fc4.c9581"],"x":855,"y":280,"wires":[]},{"id":"c93673a9.e1661","type":"comment","z":"b744ff99.c78b6","name":"Отимання ваги","info":"","x":80,"y":240,"wires":[]},{"id":"a4d7ca9c.e4ece8","type":"debug","z":"b744ff99.c78b6","name":"","active":false,"console":"false","complete":"payload","x":910,"y":240,"wires":[]},{"id":"a6dc2196.d480d","type":"debug","z":"b744ff99.c78b6","name":"","active":false,"console":"false","complete":"false","x":490,"y":320,"wires":[]},{"id":"5684a87c.e0a768","type":"delay","z":"b744ff99.c78b6","name":"","pauseType":"rate","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":490,"y":280,"wires":[["a0cae709.7ee758","5204a996.34c758"]]},{"id":"5204a996.34c758","type":"debug","z":"b744ff99.c78b6","name":"","active":false,"console":"false","complete":"false","x":690,"y":320,"wires":[]},{"id":"e1b809ca.8e5cd8","type":"function","z":"b744ff99.c78b6","name":"time_rasp","func":"var time = new Date();\nflow.set(\"time_rasp\", time);\n\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":500,"wires":[["f9b5a9de.f4edd8"]]},{"id":"f77afa89.948b68","type":"inject","z":"b744ff99.c78b6","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":110,"y":500,"wires":[["e1b809ca.8e5cd8"]]},{"id":"f9b5a9de.f4edd8","type":"function","z":"b744ff99.c78b6","name":"sub time","func":"var weigth_time = flow.get(\"weigth_time\");\nvar time_rasp = flow.get(\"time_rasp\");\nvar timeWait = global.get(\"timeWaitWeight\")\n\nvar sub = time_rasp - weigth_time;\n//msg.payload = {\n//    sub: time_rasp - weigth_time,\n//    weigth_time: weigth_time,\n//    time_rasp: time_rasp\n//}\n\n    if(sub > timeWait){\n    msg.payload = 0;\n    msg.connect = \"not\";\n    return msg;\n    }\n","outputs":1,"noerr":0,"x":480,"y":500,"wires":[["3826706e.9a225","23a52e15.7a8272"]]},{"id":"3826706e.9a225","type":"debug","z":"b744ff99.c78b6","name":"","active":false,"console":"false","complete":"false","x":650,"y":500,"wires":[]},{"id":"31601fe2.b5ed","type":"function","z":"b744ff99.c78b6","name":"weigth_time","func":"flow.set('weigth_time',new Date());\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":460,"wires":[[]]},{"id":"76daa2ff.c2b90c","type":"inject","z":"b744ff99.c78b6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":280,"wires":[["670e5242.028adc"]]},{"id":"670e5242.028adc","type":"tcp request","z":"b744ff99.c78b6","server":"10.107.21.21","port":"9761","out":"time","splitc":"200","name":"","x":300,"y":280,"wires":[["a6dc2196.d480d","5684a87c.e0a768","31601fe2.b5ed"]]},{"id":"f55643d.f3e37c","type":"comment","z":"b744ff99.c78b6","name":"Коли довго немає ваги генерую 0 кг.","info":"","x":190,"y":420,"wires":[]},{"id":"5491cdff.2ae9c4","type":"file","z":"55db58b3.1c1c98","name":"deivce_config_1.json","filename":"deivce_config_1.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":520,"y":100,"wires":[]},{"id":"eb92ef0d.92dda","type":"function","z":"55db58b3.1c1c98","name":"main config","func":"flow.set('prevWeight',null);\nflow.set('transaction',null);\nflow.set('transactionData',[]);\nflow.set('transactionMaxWeight',null);\nflow.set('transactionHasMinWeight',null);\nflow.set('transactionHasMaxWeight',null);\nflow.set('transactionHasMaxDuration',null);\nflow.set('lasttimedata', new Date());\nflow.set('checkHealth',null);\nflow.set('transactionWaybill',null);\nflow.set('transactionAccWeight', null);\nflow.set('transactionHasOverLoad', null);\nflow.set('transactionOperationName', null);\n//початкові значення\n flow.set('truck_id', \"\");\n flow.set('reader', \"\");\nreturn msg;\n","outputs":1,"noerr":0,"x":510,"y":220,"wires":[[]]},{"id":"23383739.535ca8","type":"inject","z":"55db58b3.1c1c98","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":150,"y":180,"wires":[["380f1e00.a386a2","b973f186.f1c72"]]},{"id":"8213d295.f0ca2","type":"file in","z":"55db58b3.1c1c98","name":"deivce_config_1.json","filename":"deivce_config_1.json","format":"utf8","x":540,"y":180,"wires":[["b8c1ac09.cfed8"]]},{"id":"49f46dd2.75bd24","type":"inject","z":"55db58b3.1c1c98","name":"DEMO","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":140,"y":100,"wires":[["f5f1c87c.3633e8"]]},{"id":"f5f1c87c.3633e8","type":"function","z":"55db58b3.1c1c98","name":"DEMO Data","func":"var device_config = {\n    'event_move_in_id':'80096D9ABE7F68F3E0533300000A6C0D',\n    'event_move_in_minus_id':'8DB9B239DF5252F0E055000000000001',\n    'event_move_out_id':'80096D9ABE8068F3E0533300000A6C0D',\n    'event_max_weight_id':'85A255F950F9BEF4E0533300000AC45D',\n    'event_on_id': '85A2CC45702A2DD1E0533300000A0C94',\n    'event_off_id':'85A2CC4570292DD1E0533300000A0C94',\n    'event_max_duration':'8642EE858DE89BAAE0533300000AFCC7',\n    'event_fake_traffic':'80096EF60C186574E0533300000ADBA5',\n    'event_get_weight_acc':'800970AC1FDC683CE0533300000AF1B0',\n    'event_min_weight':'875C3EB5C9DD092DE055000000000001',\n    'event_driver_in':'8E68D8D8B2977181E055000000000001',\n    'event_over_load':'B3EB5F800EFD2620E0530101007F8A05',\n    'snapshot_events':['80096D9ABE7F68F3E0533300000A6C0D','85A255F950F9BEF4E0533300000AC45D','8642EE858DE89BAAE0533300000AFCC7','800970AC1FDC683CE0533300000AF1B0', \"B3EB5F800EFD2620E0530101007F8A05\"],\n    'main_host':'https://10.107.21.150:8443/ords/ettn',\n    'event_url':'/iot_cli/events/log',\n    'state_url':'/iot_cli/device',\n    'snapshot_url':'/iot_cli/events/snapshot',\n    'maxWeight':60000,\n    'maxDuration':600000,\n    'minWeight':-40,\n    'checkHealthTimeout':3000,\n    'minTriggerWeight':20,//bylo 20\n    'driverWeight':80,\n    'overLoadWeight': 200,\n    'stableDiff': 60\n}\nmsg.payload = device_config;\n// flow.set('scale_id','80096CB0EFD83B63E0533300000A4334');\n// flow.set('event_move_in_id','80096D9ABE7F68F3E0533300000A6C0D');\n// flow.set('event_move_out_id','80096D9ABE8068F3E0533300000A6C0D');\n// flow.set('event_max_weight_id','85A255F950F9BEF4E0533300000AC45D');\n// flow.set('event_off_id','85A2CC4570292DD1E0533300000A0C94');\n// flow.set('event_on_id', '85A2CC45702A2DD1E0533300000A0C94');\n// flow.set('event_max_duration','8642EE858DE89BAAE0533300000AFCC7');\n// flow.set('main_host','http://prod.apex.rest/ords/ettn');\n// flow.set('event_url','/iot_cli/events/log');\n// flow.set('state_url','/v1/device');\n// flow.set('maxWeight',40000);\n// flow.set('maxDuration',20000);\n// flow.set('checkHealthTimeout',3000);\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":100,"wires":[["5491cdff.2ae9c4"]]},{"id":"b8c1ac09.cfed8","type":"function","z":"55db58b3.1c1c98","name":"device config","func":"var device_config = JSON.parse(msg.payload);\n\nflow.set('scale_id',device_config.scale_id);\nflow.set('event_move_in_id',device_config.event_move_in_id);\nflow.set('event_move_in_minus_id',device_config.event_move_in_minus_id);\nflow.set('event_move_out_id',device_config.event_move_out_id);\nflow.set('event_max_weight_id',device_config.event_max_weight_id);\nflow.set('event_off_id',device_config.event_off_id);\nflow.set('event_on_id', device_config.event_on_id);\nflow.set('event_max_duration',device_config.event_max_duration);\nflow.set('event_fake_traffic',device_config.event_fake_traffic);\nflow.set('event_driver_in', device_config.event_driver_in);\nflow.set('event_over_load',device_config.event_over_load);\nflow.set('main_host',device_config.main_host);\nflow.set('event_url',device_config.event_url);\nflow.set('state_url',device_config.state_url);\nflow.set('maxWeight',device_config.maxWeight);\nflow.set('minWeight',device_config.minWeight);\nflow.set('maxDuration',device_config.maxDuration);\nflow.set('checkHealthTimeout',device_config.checkHealthTimeout);\nflow.set('event_get_weight_acc',device_config.event_get_weight_acc);\nflow.set('event_min_weight',device_config.event_min_weight);\nflow.set('minTriggerWeight',device_config.minTriggerWeight);\nflow.set('snapshot_url',device_config.snapshot_url);\nflow.set('snapshot_events',device_config.snapshot_events);\nflow.set('driverWeight',device_config.driverWeight);\nflow.set('overLoadWeight', device_config.overLoadWeight);\nflow.set('stableDiff', device_config.stableDiff);\n\n\nmsg.payload = {\n\tscale_id: flow.get('scale_id'),\n\tevent_move_in_id: flow.get('event_move_in_id'),\n\tevent_move_in_minus_id: flow.get('event_move_in_minus_id'),\n\tevent_move_out_id: flow.get('event_move_out_id'),\n\tevent_max_weight_id: flow.get('event_max_weight_id'),\n\tevent_off_id: flow.get('event_off_id'),\n\tevent_on_id: flow.get('event_on_id'),\n\tevent_max_duration: flow.get('event_max_duration'),\n\tevent_fake_traffic: flow.get('event_fake_traffic'),\n\tevent_driver_in: flow.get('event_driver_in'),\n\tevent_over_load: flow.get('event_over_load'),\n\tmain_host: flow.get('main_host'),\n\tevent_url: flow.get('event_url'),\n\tstate_url: flow.get('state_url'),\n\tmaxWeight: flow.get('maxWeight'),\n\tminWeight: flow.get('minWeight'),\n\tmaxDuration: flow.get('maxDuration'),\n\tcheckHealthTimeout: flow.get('checkHealthTimeout'),\n\tevent_get_weight_acc: flow.get('event_get_weight_acc'),\n\tevent_min_weight: flow.get('event_min_weight'),\n\tminTriggerWeight: flow.get('minTriggerWeight'),\n\tsnapshot_url: flow.get('snapshot_url'),\n\tsnapshot_events: flow.get('snapshot_events'),\n\tdriverWeight: flow.get('driverWeight'),\n\toverLoadWeight: flow.get('overLoadWeight'),\n\tstableDiff: flow.get('stableDiff')\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":730,"y":180,"wires":[["3bb7c2ed.d3488e","a2ca680c.8eae78"]]},{"id":"3bb7c2ed.d3488e","type":"json","z":"55db58b3.1c1c98","name":"","x":870,"y":180,"wires":[["f036d4e6.91c088"]]},{"id":"f036d4e6.91c088","type":"debug","z":"55db58b3.1c1c98","name":"IN device config","active":false,"console":"false","complete":"true","x":1020,"y":180,"wires":[]},{"id":"55806f3c.acb92","type":"function","z":"55db58b3.1c1c98","name":"transactionHasMaxWeight","func":"msg.event_id = flow.get('event_max_weight_id');\nmsg.description = 'Перевищена максимально-допустима вага, кг: ' + msg.metadata.weight;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":580,"wires":[["e7b3dc85.269b8"]]},{"id":"f0b4c6aa.13aaa8","type":"switch","z":"55db58b3.1c1c98","name":"switch max weight","property":"transactionHasMaxWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":530,"y":580,"wires":[["55806f3c.acb92"]]},{"id":"e7b3dc85.269b8","type":"function","z":"55db58b3.1c1c98","name":"events payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in');\nvar snapshot_events = flow.get('snapshot_events');\nvar snapshot = false;\n\nif (snapshot_events.indexOf(event_id)>=0){\n    snapshot = true;\n}\n\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'devices':[{'id':scale_id}],\n    'data':msg.metadata,\n    'description':msg.description\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('event_url');\nmsg.main_host = flow.get('main_host');\nmsg.event_url = flow.get('event_url');\nmsg.snapshot = snapshot;\nreturn msg;","outputs":1,"noerr":0,"x":1540,"y":560,"wires":[["8b3bc413.4f8d88","2fbf651a.32fa6a"]]},{"id":"bdc08755.d16cf8","type":"function","z":"55db58b3.1c1c98","name":"main module","func":"var prevWeight = flow.get('prevWeight');\nvar transaction = flow.get('transaction');\nvar transactionData = flow.get('transactionData');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar transactionHasMaxWeight = flow.get('transactionHasMaxWeight');\nvar transactionHasMinWeight = flow.get('transactionHasMinWeight');\nvar transactionHasMaxDuration = flow.get('transactionHasMaxDuration');\nvar transactionOperationName = flow.get('transactionOperationName');\nvar stableDiff = flow.get('stableDiff');//дельта стабільності\nvar waybill = flow.get('transactionWaybill');\nvar weight = msg.payload;\nvar stableSize = 20;\nvar duration = 0;\nvar operation_name_income = \"Приход (авто)\";\nvar maxWeight = flow.get('maxWeight');\nvar maxDuration = flow.get('maxDuration');\nvar prevTransaction = transaction;\nvar minWeight = flow.get('minWeight');\nvar minTriggerWeight = flow.get('minTriggerWeight');\nvar is_minus = false;\nvar transactionAccWeight = flow.get('transactionAccWeight');//облікова вага\nvar overLoadWeight = flow.get('overLoadWeight');\n\n//transaction\nif (prevWeight === null){\n    prevWeight = msg.payload;    \n}else{\n    if((prevWeight <= 40) && (weight > 0) && (weight >= minTriggerWeight)){\n        //start of transaction\n        transaction = Date.now();\n        msg.on = true;\n        flow.set('transaction',transaction);\n    }else if((prevWeight > 0) && (Math.abs(weight) <= 80) && (transaction)){\n        //transaction = 0;\n        msg.on = false;\n        transactionData = [];\n        flow.set('transaction',0);\n        flow.set('transactionMaxWeight',null);\n        flow.set('transactionHasMaxWeight',null);\n        flow.set('transactionHasMinWeight',null);\n        flow.set('transactionHasMaxDuration',null);\n        flow.set('transactionHasOverLoad',null);\n        flow.set('transactionOperationName',null);\n        flow.set('transactionWaybill',null);\n        flow.set('transactionMetadata',null);\n        flow.set('transactionAccWeight', null);//облікова вага\n    }else if((transaction === null) && (weight>0) && (weight > minTriggerWeight)){\n        transaction = Date.now();\n        flow.set('transaction',transaction);\n    }\n    if((prevWeight < 0) && ((weight-prevWeight) > minTriggerWeight)){\n        //start of transaction\n        is_minus = true;\n        msg.prevWeight = prevWeight;\n    }\n}\nmsg.stable = true;\nif (transaction > 0){\n    transactionData.push(weight);    \n\n    //stable\n    if(transactionData.length > stableSize+1){\n        var stabletmp = true;\n        for (var i = transactionData.length-1; i > transactionData.length-1-stableSize; i--){\n            if ((transactionData[i] - transactionData[i-1]) > stableDiff || (transactionData[i] - transactionData[i-1]) < -stableDiff){\n                stabletmp  = false;\n                msg.stable = stabletmp;\n                break;\n            }\n            msg.stable = stabletmp;\n        }\n    }else{\n        msg.stable = false;\n    }\n\n    //duration & transactionMaxWeight\n    duration = (Number(Date.now()) - Number(transaction));\n    if( (weight>transactionMaxWeight) || (transactionMaxWeight === null)){\n        transactionMaxWeight = weight;\n        flow.set(\"transactionMaxWeight\",transactionMaxWeight);\n    }\n    \n    if(!transactionHasMaxWeight && weight > maxWeight){\n        msg.transactionHasMaxWeight = true;\n        flow.set('transactionHasMaxWeight',true);\n    }\n    \n    if(!transactionHasMinWeight && weight < minWeight){\n        msg.transactionHasMinWeight = true;\n        flow.set('transactionHasMinWeight',true);\n    }\n    \n    //max duartion\n    if(!transactionHasMaxDuration && duration > maxDuration){\n        msg.transactionHasMaxDuration = true;\n        flow.set('transactionHasMaxDuration',true);\n    }\n}\n\nmsg.transaction = transaction;\n//msg.stable = true; // add 17.07 10.54\n//result\nmsg.metadata = {\n    'weight':weight,\n    'prevWeight':prevWeight,\n    'prevTransaction':prevTransaction,\n    'transaction':transaction,\n    'on':msg.on,\n    'transactionDataCount':transactionData.length,\n    'stable':msg.stable,\n    'duration':Math.round(duration/1000),\n    'transactionMaxWeight':transactionMaxWeight,\n    'transactionAccWeight':transactionAccWeight,\n    'waybill':waybill,\n    'perimetr':true,\n    'weight1':msg.weight1,\n    'weight2':msg.weight2,\n    'weight_center':msg.weight_center,\n    'driverInCar':false,\n    'transactionOperationName':transactionOperationName\n}\nflow.set('transactionData',transactionData);\nflow.set('prevWeight',weight);\nflow.set('transactionMetadata',msg.metadata);\nflow.set('lasttimedata', new Date());\nmsg.is_minus = is_minus;\n\nif(transactionAccWeight && transactionOperationName!==operation_name_income){\n    \n   flow.set('transactionHasOverLoad',(weight-transactionAccWeight)>overLoadWeight);\n   \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":560,"wires":[["6d412b85.1add04","f0b4c6aa.13aaa8","428e746e.ad659c","2393b419.96644c","3585fca9.fa92b4","9dd4e2c5.16cba","40e9d9ed.37a408","664bd5f4.63514c","5b608f5.4ddff7","15c3705e.96d77"]]},{"id":"3f9666cc.8a89aa","type":"function","z":"55db58b3.1c1c98","name":"get weight from accounting system","func":"var transactionMetadata = flow.get('transactionMetadata');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar driverWeight = flow.get('driverWeight');\nvar buisness_data = msg.req.query;\n\nmsg.metadata = Object.assign(transactionMetadata,buisness_data);\n\n//check driver in a car\nvar driver_in = false;\nmsg.driverWeight = driverWeight;\nif((transactionMaxWeight - msg.metadata.weight) < driverWeight){\n    driver_in = true;\n}\n\nmsg.event_id = flow.get('event_get_weight_acc');\ntransactionWaybill = flow.get('transactionWaybill');\nif (!transactionWaybill){\n    flow.set('transactionWaybill',msg.req.query.waybill);\n}\nmsg.description = ' '+buisness_data.operation_name+'. '+buisness_data.operation_type+'. Зважили в 1С. Поточна вага: ' + msg.metadata.weight+\" Номер авто: \"+buisness_data.truck1+\" \"+buisness_data.truck2+\" \"+buisness_data.item_name + \", ТТН: \" + buisness_data.waybill;\nmsg.transactionMetadata = transactionMetadata;\nmsg.driver_in = driver_in;\n\nflow.set('transactionAccWeight',  msg.metadata.weight);//облікова вага\nflow.set('transactionOperationName',  msg.metadata.operation_name);//вид операції\n\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":1060,"wires":[["d018e18c.4d2b9","e7b3dc85.269b8"]]},{"id":"8b3bc413.4f8d88","type":"http request","z":"55db58b3.1c1c98","name":"EVENTS","method":"POST","ret":"txt","url":"","tls":"e1dd70f.94c7c9","x":1740,"y":560,"wires":[["1f5be891.21c947"]]},{"id":"558d9fc2.eb413","type":"function","z":"55db58b3.1c1c98","name":"move in","func":"msg.event_id = flow.get('event_move_in_id');\nmsg.description = 'Заїзд на ваги. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":500,"wires":[["e7b3dc85.269b8"]]},{"id":"52222319.d60cdc","type":"function","z":"55db58b3.1c1c98","name":"off","func":"msg.event_id = flow.get('event_off_id');\nmsg.description = 'Прилад відключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":940,"wires":[["42b8f87c.63b968"]]},{"id":"c98a8d9c.80da7","type":"function","z":"55db58b3.1c1c98","name":"on","func":"msg.event_id = flow.get('event_on_id');\nmsg.description = 'Прилад підключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":900,"wires":[["4f9959eb.a2af68"]]},{"id":"1c208f0f.f4b841","type":"function","z":"55db58b3.1c1c98","name":"move out","func":"msg.event_id = flow.get('event_move_out_id');\nmsg.description = 'Зїзд з ваг. Максимальна вага: ' + msg.metadata.transactionMaxWeight;\nmsg.transactionMaxWeight = msg.metadata.transactionMaxWeight;\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":540,"wires":[["e7b3dc85.269b8","715da772.9e6ff8","2b0126bb.3d6a7a"]]},{"id":"5d35f711.e208a8","type":"function","z":"55db58b3.1c1c98","name":"transaction has max duration","func":"msg.event_id = flow.get('event_max_duration');\nmsg.description = 'Перевищено максимальний час находження на вагах, сек: ' + msg.metadata.duration;\n\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":620,"wires":[["e7b3dc85.269b8"]]},{"id":"9626b5ae.d1b398","type":"function","z":"55db58b3.1c1c98","name":"empty waybill","func":"msg.event_id = flow.get('event_fake_traffic');\nmsg.description = 'Холостий проїзд по вагам. Тривалість проїзду ' + Math.round(msg.metadata.duration/60)+ 'хв.' + \" Максимальна вага: \" + msg.metadata.transactionMaxWeight + \" кг.\";\n\nreturn msg;","outputs":1,"noerr":0,"x":882.6666259765625,"y":464.6666374206543,"wires":[["e7b3dc85.269b8"]]},{"id":"4ef4470c.7fcbe8","type":"function","z":"55db58b3.1c1c98","name":"transactionHasMinWeight","func":"msg.event_id = flow.get('event_min_weight');\nmsg.description = 'Перевищена мінімально-допустима вага, кг: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":660,"wires":[["e7b3dc85.269b8"]]},{"id":"b63decde.28a61","type":"function","z":"55db58b3.1c1c98","name":"move in minus","func":"msg.event_id = flow.get('event_move_in_minus_id');\nmsg.description = 'Заїзд із мінусом. ' + msg.prevWeight +' кг.';\n\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":420,"wires":[["e7b3dc85.269b8"]]},{"id":"19389fc4.c9581","type":"link in","z":"55db58b3.1c1c98","name":"Авто 1 W1","links":["932af584.318238","23a52e15.7a8272"],"x":57.6666259765625,"y":564.6666259765625,"wires":[["7a7d3b16.60fb14","67f42ef6.cf741","bb29194d.84dbc8","8d49e123.d884d","bdc08755.d16cf8","e23792ce.fa50b"]]},{"id":"6d412b85.1add04","type":"switch","z":"55db58b3.1c1c98","name":"switch move","property":"on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":510,"y":520,"wires":[["558d9fc2.eb413"],["1c208f0f.f4b841","6692afaa.cf22d","8a1287f1.e3da88"]]},{"id":"428e746e.ad659c","type":"switch","z":"55db58b3.1c1c98","name":"max duration","property":"transactionHasMaxDuration","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":510,"y":620,"wires":[["5d35f711.e208a8"]]},{"id":"2393b419.96644c","type":"switch","z":"55db58b3.1c1c98","name":"switch min weight","property":"transactionHasMinWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":530,"y":660,"wires":[["4ef4470c.7fcbe8"]]},{"id":"3585fca9.fa92b4","type":"switch","z":"55db58b3.1c1c98","name":"switch minus in","property":"is_minus","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":510,"y":420,"wires":[["b63decde.28a61"]]},{"id":"d018e18c.4d2b9","type":"switch","z":"55db58b3.1c1c98","name":"","property":"driver_in","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":850,"y":1060,"wires":[["258a7c49.676474"]]},{"id":"d1d4ea68.c13678","type":"http in","z":"55db58b3.1c1c98","name":"","url":"/getWeight1","method":"get","swaggerDoc":"","x":220,"y":1060,"wires":[["fe10f245.9d468","fb9fcab1.375598","3f9666cc.8a89aa"]]},{"id":"258a7c49.676474","type":"function","z":"55db58b3.1c1c98","name":"driver_in event","func":"msg.event_id = flow.get('event_driver_in');\nmsg.description = 'При зважуванні водій в кабіні. Вага: ' + msg.metadata.weight+\"кг. Номер авто: \"+msg.metadata.truck1+\" \"+msg.metadata.truck2+\" \"+msg.metadata.item_name;\n\nreturn msg;","outputs":1,"noerr":0,"x":1120,"y":1060,"wires":[["e7b3dc85.269b8"]]},{"id":"960250c5.23773","type":"switch","z":"55db58b3.1c1c98","name":"","property":"checkHealth","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":530,"y":920,"wires":[["c98a8d9c.80da7"],["52222319.d60cdc"]]},{"id":"6692afaa.cf22d","type":"switch","z":"55db58b3.1c1c98","name":"waybill","property":"metadata.waybill","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","outputs":1,"x":710,"y":460,"wires":[["9626b5ae.d1b398"]]},{"id":"7a7d3b16.60fb14","type":"socket-io-out","z":"55db58b3.1c1c98","name":"socket 4001","event":"d36e64bc.d23ab8","server":"cf047825.2045b8","x":190,"y":640,"wires":[]},{"id":"67f42ef6.cf741","type":"debug","z":"55db58b3.1c1c98","name":"Avto 1 weight","active":false,"console":"true","complete":"payload","x":200,"y":520,"wires":[]},{"id":"bb29194d.84dbc8","type":"ui_text","z":"55db58b3.1c1c98","group":"c7a6cbb7.d20b88","order":0,"width":0,"height":0,"name":"","label":"Поточна вага ліві(Авто 1):","format":"{{msg.payload}}","layout":"row-spread","x":239,"y":674.0000114440918,"wires":[]},{"id":"fe10f245.9d468","type":"function","z":"55db58b3.1c1c98","name":"response","func":"msg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nif(transactionWaybill && transactionWaybill !== msg.req.query.waybill){\n    msg.payload.status = false;    \n}else {\n    msg.payload.status = true;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":1140,"wires":[["fd01ca4c.e40128","32712c21.c5ade4"]]},{"id":"2561d4c1.8ad8fc","type":"function","z":"55db58b3.1c1c98","name":"check scale health","func":"var lastcheckHealth = flow.get('checkHealth');\nvar checkHealth = null;\nvar lasttimedata = flow.get('lasttimedata');\n\nvar currenttimedata = new Date();\n\nif ((currenttimedata - lasttimedata) > 20000){\n    checkHealth = false;\n} else {\n    checkHealth = true;\n}\n\nflow.set(\"checkHealth\",checkHealth);\n\nif (lastcheckHealth != checkHealth){\n    msg.checkHealth = checkHealth;\n}else{\n    msg.checkHealth = null;\n}\nmsg.payload = checkHealth;\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":920,"wires":[["960250c5.23773"]]},{"id":"fd01ca4c.e40128","type":"http response","z":"55db58b3.1c1c98","name":"","x":630,"y":1140,"wires":[]},{"id":"51a53714.38e5e8","type":"inject","z":"55db58b3.1c1c98","name":"","topic":"","payload":"","payloadType":"date","repeat":"6","crontab":"","once":false,"x":190,"y":920,"wires":[["2561d4c1.8ad8fc"]]},{"id":"f940f47.51b4a08","type":"http in","z":"55db58b3.1c1c98","name":"","url":"/getSimpleWeight1","method":"get","swaggerDoc":"","x":240,"y":1240,"wires":[["3a7324c9.49f3dc"]]},{"id":"3a7324c9.49f3dc","type":"function","z":"55db58b3.1c1c98","name":"response","func":"msg.payload = flow.get('transactionMetadata').weight;\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":1240,"wires":[["502f9ecc.412fd"]]},{"id":"502f9ecc.412fd","type":"http response","z":"55db58b3.1c1c98","name":"","x":650,"y":1240,"wires":[]},{"id":"2e59ee88.dc6972","type":"http in","z":"55db58b3.1c1c98","name":"","url":"/socket1","method":"get","swaggerDoc":"","x":210,"y":1320,"wires":[["2a77e6a5.5b310a"]]},{"id":"4eb9e062.50a44","type":"template","z":"55db58b3.1c1c98","name":"socket page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n     \n  <body>\n    <h1><p id='weight'></p></h1>\n    \n     <script>\n    setTimeout(function() {\n       ;(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.io=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_(\"./lib/\")},{\"./lib/\":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_(\"./socket\");module.exports.parser=_dereq_(\"engine.io-parser\")},{\"./socket\":3,\"engine.io-parser\":19}],3:[function(_dereq_,module,exports){(function(global){var transports=_dereq_(\"./transports\");var Emitter=_dereq_(\"component-emitter\");var debug=_dereq_(\"debug\")(\"engine.io-client:socket\");var index=_dereq_(\"indexof\");var parser=_dereq_(\"engine.io-parser\");var parseuri=_dereq_(\"parseuri\");var parsejson=_dereq_(\"parsejson\");var parseqs=_dereq_(\"parseqs\");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&\"object\"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==\"https\"||uri.protocol==\"wss\";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&\"https:\"==location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?\"443\":\"80\"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:\"localhost\");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if(\"string\"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||\"t\";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||[\"polling\",\"websocket\"];this.readyState=\"\";this.writeBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?null:opts.rejectUnauthorized;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}}this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_(\"./transport\");Socket.transports=_dereq_(\"./transports\");Socket.parser=_dereq_(\"engine.io-parser\");Socket.prototype.createTransport=function(name){debug('creating transport \"%s\"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf(\"websocket\")!=-1){transport=\"websocket\"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit(\"error\",\"No transports available\")},0);return}else{transport=this.transports[0]}this.readyState=\"opening\";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug(\"setting transport %s\",transport.name);var self=this;if(this.transport){debug(\"clearing existing transport %s\",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on(\"drain\",function(){self.onDrain()}).on(\"packet\",function(packet){self.onPacket(packet)}).on(\"error\",function(e){self.onError(e)}).on(\"close\",function(){self.onClose(\"transport close\")})};Socket.prototype.probe=function(name){debug('probing transport \"%s\"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport \"%s\" opened',name);transport.send([{type:\"ping\",data:\"probe\"}]);transport.once(\"packet\",function(msg){if(failed)return;if(\"pong\"==msg.type&&\"probe\"==msg.data){debug('probe transport \"%s\" pong',name);self.upgrading=true;self.emit(\"upgrading\",transport);if(!transport)return;Socket.priorWebsocketSuccess=\"websocket\"==transport.name;debug('pausing current transport \"%s\"',self.transport.name);self.transport.pause(function(){if(failed)return;if(\"closed\"==self.readyState)return;debug(\"changing transport and sending upgrade packet\");cleanup();self.setTransport(transport);transport.send([{type:\"upgrade\"}]);self.emit(\"upgrade\",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport \"%s\" failed',name);var err=new Error(\"probe error\");err.transport=transport.name;self.emit(\"upgradeError\",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error(\"probe error: \"+err);error.transport=transport.name;freezeTransport();debug('probe transport \"%s\" failed because of error: %s',name,err);self.emit(\"upgradeError\",error)}function onTransportClose(){onerror(\"transport closed\")}function onclose(){onerror(\"socket closed\")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('\"%s\" works - aborting \"%s\"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener(\"open\",onTransportOpen);transport.removeListener(\"error\",onerror);transport.removeListener(\"close\",onTransportClose);self.removeListener(\"close\",onclose);self.removeListener(\"upgrading\",onupgrade)}transport.once(\"open\",onTransportOpen);transport.once(\"error\",onerror);transport.once(\"close\",onTransportClose);this.once(\"close\",onclose);this.once(\"upgrading\",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug(\"socket open\");this.readyState=\"open\";Socket.priorWebsocketSuccess=\"websocket\"==this.transport.name;this.emit(\"open\");this.flush();if(\"open\"==this.readyState&&this.upgrade&&this.transport.pause){debug(\"starting upgrade probes\");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if(\"opening\"==this.readyState||\"open\"==this.readyState){debug('socket receive: type \"%s\", data \"%s\"',packet.type,packet.data);this.emit(\"packet\",packet);this.emit(\"heartbeat\");switch(packet.type){case\"open\":this.onHandshake(parsejson(packet.data));break;case\"pong\":this.setPing();this.emit(\"pong\");break;case\"error\":var err=new Error(\"server error\");err.code=packet.data;this.onError(err);break;case\"message\":this.emit(\"data\",packet.data);this.emit(\"message\",packet.data);break}}else{debug('packet received with socket readyState \"%s\"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit(\"handshake\",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if(\"closed\"==this.readyState)return;this.setPing();this.removeListener(\"heartbeat\",this.onHeartbeat);this.on(\"heartbeat\",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if(\"closed\"==self.readyState)return;self.onClose(\"ping timeout\")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug(\"writing ping packet - expecting pong within %sms\",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket(\"ping\",function(){self.emit(\"ping\")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit(\"drain\")}else{this.flush()}};Socket.prototype.flush=function(){if(\"closed\"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug(\"flushing %d packets in socket\",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit(\"flush\")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket(\"message\",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if(\"function\"==typeof data){fn=data;data=undefined}if(\"function\"==typeof options){fn=options;options=null}if(\"closing\"==this.readyState||\"closed\"==this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit(\"packetCreate\",packet);this.writeBuffer.push(packet);if(fn)this.once(\"flush\",fn);this.flush()};Socket.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.readyState=\"closing\";var self=this;if(this.writeBuffer.length){this.once(\"drain\",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose(\"forced close\");debug(\"socket closing - telling transport to close\");self.transport.close()}function cleanupAndClose(){self.removeListener(\"upgrade\",cleanupAndClose);self.removeListener(\"upgradeError\",cleanupAndClose);close()}function waitForUpgrade(){self.once(\"upgrade\",cleanupAndClose);self.once(\"upgradeError\",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug(\"socket error %j\",err);Socket.priorWebsocketSuccess=false;this.emit(\"error\",err);this.onClose(\"transport error\",err)};Socket.prototype.onClose=function(reason,desc){if(\"opening\"==this.readyState||\"open\"==this.readyState||\"closing\"==this.readyState){debug('socket close with reason: \"%s\"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners(\"close\");this.transport.close();this.transport.removeAllListeners();this.readyState=\"closed\";this.id=null;this.emit(\"close\",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./transport\":4,\"./transports\":5,\"component-emitter\":15,debug:17,\"engine.io-parser\":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(_dereq_,module,exports){var parser=_dereq_(\"engine.io-parser\");var Emitter=_dereq_(\"component-emitter\");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState=\"\";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type=\"TransportError\";err.description=desc;this.emit(\"error\",err);return this};Transport.prototype.open=function(){if(\"closed\"==this.readyState||\"\"==this.readyState){this.readyState=\"opening\";this.doOpen()}return this};Transport.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if(\"open\"==this.readyState){this.write(packets)}else{throw new Error(\"Transport not open\")}};Transport.prototype.onOpen=function(){this.readyState=\"open\";this.writable=true;this.emit(\"open\")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit(\"packet\",packet)};Transport.prototype.onClose=function(){this.readyState=\"closed\";this.emit(\"close\")}},{\"component-emitter\":15,\"engine.io-parser\":19}],5:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var XHR=_dereq_(\"./polling-xhr\");var JSONP=_dereq_(\"./polling-jsonp\");var websocket=_dereq_(\"./websocket\");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if(\"open\"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error(\"JSONP disabled\");return new JSONP(opts)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling-jsonp\":6,\"./polling-xhr\":7,\"./websocket\":9,\"xmlhttprequest-ssl\":10}],6:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_(\"./polling\");var inherit=_dereq_(\"component-inherit\");module.exports=JSONPPolling;var rNewline=/\\n/g;var rEscapedNewline=/\\\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener(\"beforeunload\",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement(\"script\");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError(\"jsonp poll error\",e)};var insertAt=document.getElementsByTagName(\"script\")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko=\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement(\"iframe\");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement(\"form\");var area=document.createElement(\"textarea\");var id=this.iframeId=\"eio_iframe_\"+this.index;var iframe;form.className=\"socketio\";form.style.position=\"absolute\";form.style.top=\"-1000px\";form.style.left=\"-1000px\";form.target=id;form.method=\"POST\";form.setAttribute(\"accept-charset\",\"utf-8\");area.name=\"d\";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError(\"jsonp polling iframe removal error\",e)}}try{var html='<iframe src=\"javascript:0\" name=\"'+self.iframeId+'\">';iframe=document.createElement(html)}catch(e){iframe=document.createElement(\"iframe\");iframe.name=self.iframeId;iframe.src=\"javascript:0\"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,\"\\\\\\n\");this.area.value=data.replace(rNewline,\"\\\\n\");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==\"complete\"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-inherit\":16}],7:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var Polling=_dereq_(\"./polling\");var Emitter=_dereq_(\"component-emitter\");var inherit=_dereq_(\"component-inherit\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling-xhr\");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}else{this.extraHeaders=opts.extraHeaders}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!==\"string\"&&data!==undefined;var req=this.request({method:\"POST\",data:data,isBinary:isBinary});var self=this;req.on(\"success\",fn);req.on(\"error\",function(err){self.onError(\"xhr post error\",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug(\"xhr poll\");var req=this.request();var self=this;req.on(\"data\",function(data){self.onData(data)});req.on(\"error\",function(err){self.onError(\"xhr poll error\",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||\"GET\";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug(\"xhr open %s: %s\",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){xhr.responseType=\"arraybuffer\"}if(\"POST\"==this.method){try{if(this.isBinary){xhr.setRequestHeader(\"Content-type\",\"application/octet-stream\")}else{xhr.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}}catch(e){}}if(\"withCredentials\"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug(\"xhr data %s\",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit(\"success\");this.cleanup()};Request.prototype.onData=function(data){this.emit(\"data\",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit(\"error\",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if(\"undefined\"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader(\"Content-Type\").split(\";\")[0]}catch(e){}if(contentType===\"application/octet-stream\"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var ui8Arr=new Uint8Array(this.xhr.response);var dataArray=[];for(var idx=0,length=ui8Arr.length;idx<length;idx++){dataArray.push(ui8Arr[idx])}data=String.fromCharCode.apply(null,dataArray)}}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return\"undefined\"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent(\"onunload\",unloadHandler)}else if(global.addEventListener){global.addEventListener(\"beforeunload\",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-emitter\":15,\"component-inherit\":16,debug:17,\"xmlhttprequest-ssl\":10}],8:[function(_dereq_,module,exports){var Transport=_dereq_(\"../transport\");var parseqs=_dereq_(\"parseqs\");var parser=_dereq_(\"engine.io-parser\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling\");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name=\"polling\";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState=\"pausing\";function pause(){debug(\"paused\");self.readyState=\"paused\";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug(\"we are currently polling - waiting to pause\");total++;this.once(\"pollComplete\",function(){debug(\"pre-pause polling complete\");--total||pause()})}if(!this.writable){debug(\"we are currently writing - waiting to pause\");total++;this.once(\"drain\",function(){debug(\"pre-pause writing complete\");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug(\"polling\");this.polling=true;this.doPoll();this.emit(\"poll\")};Polling.prototype.onData=function(data){var self=this;debug(\"polling got data %s\",data);var callback=function(packet,index,total){if(\"opening\"==self.readyState){self.onOpen()}if(\"close\"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if(\"closed\"!=this.readyState){this.polling=false;this.emit(\"pollComplete\");if(\"open\"==this.readyState){this.poll()}else{debug('ignoring poll - transport state \"%s\"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug(\"writing close packet\");self.write([{type:\"close\"}])}if(\"open\"==this.readyState){debug(\"transport open - closing\");close()}else{debug(\"transport not open - deferring close\");this.once(\"open\",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit(\"drain\")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"https\":\"http\";var port=\"\";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&(\"https\"==schema&&this.port!=443||\"http\"==schema&&this.port!=80)){port=\":\"+this.port}if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query}},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,\"xmlhttprequest-ssl\":10,yeast:30}],9:[function(_dereq_,module,exports){(function(global){var Transport=_dereq_(\"../transport\");var parser=_dereq_(\"engine.io-parser\");var parseqs=_dereq_(\"parseqs\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:websocket\");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window===\"undefined\"){try{WebSocket=_dereq_(\"ws\")}catch(e){}}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name=\"websocket\";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}this.ws=BrowserWebSocket?new WebSocket(uri):new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType=\"buffer\"}else{this.ws.binaryType=\"arraybuffer\"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError(\"websocket error\",e)}};if(\"undefined\"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!BrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len=\"string\"==typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(BrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug(\"websocket closed before onclose event\")}--total||done()})})(packets[i])}function done(){self.emit(\"flush\");setTimeout(function(){self.writable=true;self.emit(\"drain\")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!==\"undefined\"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"wss\":\"ws\";var port=\"\";if(this.port&&(\"wss\"==schema&&this.port!=443||\"ws\"==schema&&this.port!=80)){port=\":\"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!(\"__initialize\"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,ws:undefined,yeast:30}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_(\"has-cors\");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if(\"undefined\"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(e){}}}},{\"has-cors\":22}],11:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error(\"after called too many times\")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],12:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],13:[function(_dereq_,module,exports){(function(chars){\"use strict\";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64=\"\";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];\nbase64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+\"=\"}else if(len%3===1){base64=base64.substring(0,base64.length-2)+\"==\"}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]===\"=\"){bufferLength--;if(base64[base64.length-2]===\"=\"){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\")},{}],14:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob([\"hi\"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],15:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],16:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],17:[function(_dereq_,module,exports){exports=module.exports=_dereq_(\"./debug\");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=\"undefined\"!=typeof chrome&&\"undefined\"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"];function useColors(){return\"WebkitAppearance\"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?\"%c\":\"\")+this.namespace+(useColors?\" %c\":\" \")+args[0]+(useColors?\"%c \":\" \")+\"+\"+exports.humanize(this.diff);if(!useColors)return args;var c=\"color: \"+this.color;args=[args[0],c,\"color: inherit\"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if(\"%%\"===match)return;index++;if(\"%c\"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return\"object\"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem(\"debug\")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{\"./debug\":18}],18:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_(\"ms\");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if(\"string\"!==typeof args[0]){args=[\"%o\"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match===\"%%\")return match;index++;var formatter=exports.formatters[format];if(\"function\"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if(\"function\"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||\"\").split(/[\\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\\*/g,\".*?\");if(namespaces[0]===\"-\"){exports.skips.push(new RegExp(\"^\"+namespaces.substr(1)+\"$\"))}else{exports.names.push(new RegExp(\"^\"+namespaces+\"$\"))}}}function disable(){exports.enable(\"\")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:25}],19:[function(_dereq_,module,exports){(function(global){var keys=_dereq_(\"./keys\");var hasBinary=_dereq_(\"has-binary\");var sliceBuffer=_dereq_(\"arraybuffer.slice\");var base64encoder=_dereq_(\"base64-arraybuffer\");var after=_dereq_(\"after\");var utf8=_dereq_(\"utf8\");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:\"error\",data:\"parser error\"};var Blob=_dereq_(\"blob\");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if(\"function\"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if(\"function\"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(\"\"+encoded)};function encodeBase64Object(packet,callback){var message=\"b\"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message=\"b\"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(\",\")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data==\"string\"||data===undefined){if(data.charAt(0)==\"b\"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType===\"blob\"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType===\"blob\"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary==\"function\"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback(\"0:\")}function setLengthHeader(message){return message.length+\":\"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(\"\"))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!=\"string\"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var packet;if(data==\"\"){return callback(err,0,1)}var length=\"\",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(\":\"!=chr){length+=chr}else{if(\"\"==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=\"\"}}if(length!=\"\"){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p===\"string\"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p===\"string\";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded===\"string\"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength=\"\";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg=\"\";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./keys\":20,after:11,\"arraybuffer.slice\":12,\"base64-arraybuffer\":13,blob:14,\"has-binary\":21,utf8:29}],20:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],21:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:24}],22:[function(_dereq_,module,exports){try{module.exports=typeof XMLHttpRequest!==\"undefined\"&&\"withCredentials\"in new XMLHttpRequest}catch(err){module.exports=false}},{}],23:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],24:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)==\"[object Array]\"}},{}],25:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if(\"string\"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=\"\"+str;if(str.length>1e4)return;var match=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||\"ms\").toLowerCase();switch(type){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return n*y;case\"days\":case\"day\":case\"d\":return n*d;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return n*h;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return n*m;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return n*s;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+\"d\";if(ms>=h)return Math.round(ms/h)+\"h\";if(ms>=m)return Math.round(ms/m)+\"m\";if(ms>=s)return Math.round(ms/s)+\"s\";return ms+\"ms\"}function long(ms){return plural(ms,d,\"day\")||plural(ms,h,\"hour\")||plural(ms,m,\"minute\")||plural(ms,s,\"second\")||ms+\" ms\"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+\" \"+name;return Math.ceil(ms/n)+\" \"+name+\"s\"}},{}],26:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\\],:{}\\s]*$/;var rvalidescape=/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\\s*\\[)+/g;var rtrimLeft=/^\\s+/;var rtrimRight=/\\s+$/;module.exports=function parsejson(data){if(\"string\"!=typeof data||!data){return null}data=data.replace(rtrimLeft,\"\").replace(rtrimRight,\"\");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,\"@\").replace(rvalidtokens,\"]\").replace(rvalidbraces,\"\"))){return new Function(\"return \"+data)()}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],27:[function(_dereq_,module,exports){exports.encode=function(obj){var str=\"\";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+=\"&\";str+=encodeURIComponent(i)+\"=\"+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split(\"&\");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split(\"=\");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],28:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;var parts=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];module.exports=function parseuri(str){var src=str,b=str.indexOf(\"[\"),e=str.indexOf(\"]\");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,\";\")+str.substring(e,str.length)}var m=re.exec(str||\"\"),uri={},i=14;while(i--){uri[parts[i]]=m[i]||\"\"}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,\":\");uri.authority=uri.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\");uri.ipv6uri=true}return uri}},{}],29:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports==\"object\"&&exports;var freeModule=typeof module==\"object\"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output=\"\";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error(\"Lone surrogate U+\"+codePoint.toString(16).toUpperCase()+\" is not a scalar value\")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol=\"\";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString=\"\";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error(\"Invalid byte index\")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error(\"Invalid continuation byte\")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error(\"Invalid byte index\")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error(\"Invalid UTF-8 detected\")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:\"2.0.0\",encode:utf8encode,decode:utf8decode};if(typeof define==\"function\"&&typeof define.amd==\"object\"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],30:[function(_dereq_,module,exports){\"use strict\";var alphabet=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded=\"\";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+\".\"+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],31:[function(_dereq_,module,exports){var url=_dereq_(\"./url\");var parser=_dereq_(\"socket.io-parser\");var Manager=_dereq_(\"./manager\");var debug=_dereq_(\"debug\")(\"socket.io-client\");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==\"object\"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts[\"force new connection\"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug(\"ignoring socket cache for %s\",source);io=Manager(source,opts)}else{if(!cache[id]){debug(\"new io instance for %s\",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_(\"./manager\");exports.Socket=_dereq_(\"./socket\")},{\"./manager\":32,\"./socket\":34,\"./url\":35,debug:39,\"socket.io-parser\":47}],32:[function(_dereq_,module,exports){var eio=_dereq_(\"engine.io-client\");var Socket=_dereq_(\"./socket\");var Emitter=_dereq_(\"component-emitter\");var parser=_dereq_(\"socket.io-parser\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:manager\");var indexOf=_dereq_(\"indexof\");var Backoff=_dereq_(\"backo2\");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&\"object\"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||\"/socket.io\";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState=\"closed\";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.engine.id}}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug(\"readyState %s\",this.readyState);if(~this.readyState.indexOf(\"open\"))return this;debug(\"opening %s\",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState=\"opening\";this.skipReconnect=false;var openSub=on(socket,\"open\",function(){self.onopen();fn&&fn()});var errorSub=on(socket,\"error\",function(data){debug(\"connect_error\");self.cleanup();self.readyState=\"closed\";self.emitAll(\"connect_error\",data);if(fn){var err=new Error(\"Connection error\");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug(\"connect attempt will timeout after %d\",timeout);var timer=setTimeout(function(){debug(\"connect attempt timed out after %d\",timeout);openSub.destroy();socket.close();socket.emit(\"error\",\"timeout\");self.emitAll(\"connect_timeout\",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug(\"open\");this.cleanup();this.readyState=\"open\";this.emit(\"open\");var socket=this.engine;this.subs.push(on(socket,\"data\",bind(this,\"ondata\")));this.subs.push(on(socket,\"ping\",bind(this,\"onping\")));this.subs.push(on(socket,\"pong\",bind(this,\"onpong\")));this.subs.push(on(socket,\"error\",bind(this,\"onerror\")));this.subs.push(on(socket,\"close\",bind(this,\"onclose\")));this.subs.push(on(this.decoder,\"decoded\",bind(this,\"ondecoded\")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll(\"ping\")};Manager.prototype.onpong=function(){this.emitAll(\"pong\",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit(\"packet\",packet)};Manager.prototype.onerror=function(err){debug(\"error\",err);this.emitAll(\"error\",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on(\"connecting\",onConnecting);\nsocket.on(\"connect\",function(){socket.id=self.engine.id});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug(\"writing packet %j\",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug(\"cleanup\");var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug(\"disconnect\");this.skipReconnect=true;this.reconnecting=false;if(\"opening\"==this.readyState){this.cleanup()}this.backoff.reset();this.readyState=\"closed\";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug(\"onclose\");this.cleanup();this.backoff.reset();this.readyState=\"closed\";this.emit(\"close\",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug(\"reconnect failed\");this.backoff.reset();this.emitAll(\"reconnect_failed\");this.reconnecting=false}else{var delay=this.backoff.duration();debug(\"will wait %dms before reconnect attempt\",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug(\"attempting reconnect\");self.emitAll(\"reconnect_attempt\",self.backoff.attempts);self.emitAll(\"reconnecting\",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug(\"reconnect attempt error\");self.reconnecting=false;self.reconnect();self.emitAll(\"reconnect_error\",err.data)}else{debug(\"reconnect success\");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll(\"reconnect\",attempt)}},{\"./on\":33,\"./socket\":34,backo2:36,\"component-bind\":37,\"component-emitter\":38,debug:39,\"engine.io-client\":1,indexof:42,\"socket.io-parser\":47}],33:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],34:[function(_dereq_,module,exports){var parser=_dereq_(\"socket.io-parser\");var Emitter=_dereq_(\"component-emitter\");var toArray=_dereq_(\"to-array\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:socket\");var hasBin=_dereq_(\"has-binary\");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,\"open\",bind(this,\"onopen\")),on(io,\"packet\",bind(this,\"onpacket\")),on(io,\"close\",bind(this,\"onclose\"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if(\"open\"==this.io.readyState)this.onopen();this.emit(\"connecting\");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift(\"message\");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if(\"function\"==typeof args[args.length-1]){debug(\"emitting packet with ack id %d\",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug(\"transport is open - connecting\");if(\"/\"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug(\"close (%s)\",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit(\"disconnect\",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit(\"error\",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug(\"emitting event %j\",args);if(null!=packet.id){debug(\"attaching ack callback to event\");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug(\"sending ack %j\",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if(\"function\"==typeof ack){debug(\"calling ack %s with %j\",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug(\"bad ack %s\",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit(\"connect\");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug(\"server disconnect (%s)\",this.nsp);this.destroy();this.onclose(\"io server disconnect\")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug(\"performing disconnect (%s)\",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose(\"io client disconnect\")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{\"./on\":33,\"component-bind\":37,\"component-emitter\":38,debug:39,\"has-binary\":41,\"socket.io-parser\":47,\"to-array\":51}],35:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_(\"parseuri\");var debug=_dereq_(\"debug\")(\"socket.io-client:url\");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+\"//\"+loc.host;if(\"string\"==typeof uri){if(\"/\"==uri.charAt(0)){if(\"/\"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\\/\\//.test(uri)){debug(\"protocol-less url %s\",uri);if(\"undefined\"!=typeof loc){uri=loc.protocol+\"//\"+uri}else{uri=\"https://\"+uri}}debug(\"parse %s\",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port=\"80\"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port=\"443\"}}obj.path=obj.path||\"/\";var ipv6=obj.host.indexOf(\":\")!==-1;var host=ipv6?\"[\"+obj.host+\"]\":obj.host;obj.id=obj.protocol+\"://\"+host+\":\"+obj.port;obj.href=obj.protocol+\"://\"+host+(loc&&loc.port==obj.port?\"\":\":\"+obj.port);return obj}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{debug:39,parseuri:45}],36:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],37:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if(\"string\"==typeof fn)fn=obj[fn];if(\"function\"!=typeof fn)throw new Error(\"bind() requires a function\");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],38:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[\"$\"+event]=this._callbacks[\"$\"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[\"$\"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[\"$\"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[\"$\"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[\"$\"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],39:[function(_dereq_,module,exports){arguments[4][17][0].apply(exports,arguments)},{\"./debug\":40,dup:17}],40:[function(_dereq_,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:44}],41:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON&&\"function\"==typeof obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:43}],42:[function(_dereq_,module,exports){arguments[4][23][0].apply(exports,arguments)},{dup:23}],43:[function(_dereq_,module,exports){arguments[4][24][0].apply(exports,arguments)},{dup:24}],44:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],45:[function(_dereq_,module,exports){arguments[4][28][0].apply(exports,arguments)},{dup:28}],46:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");var isBuf=_dereq_(\"./is-buffer\");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if(\"object\"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&\"object\"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&\"object\"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./is-buffer\":48,isarray:43}],47:[function(_dereq_,module,exports){var debug=_dereq_(\"debug\")(\"socket.io-parser\");var json=_dereq_(\"json3\");var isArray=_dereq_(\"isarray\");var Emitter=_dereq_(\"component-emitter\");var binary=_dereq_(\"./binary\");var isBuf=_dereq_(\"./is-buffer\");exports.protocol=4;exports.types=[\"CONNECT\",\"DISCONNECT\",\"EVENT\",\"BINARY_EVENT\",\"ACK\",\"BINARY_ACK\",\"ERROR\"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug(\"encoding packet %j\",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str=\"\";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+=\"-\"}if(obj.nsp&&\"/\"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=\",\";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=\",\";str+=json.stringify(obj.data)}debug(\"encoded %j as %s\",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if(\"string\"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit(\"decoded\",packet)}}else{this.emit(\"decoded\",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error(\"got binary data when not reconstructing a packet\")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit(\"decoded\",packet)}}}else{throw new Error(\"Unknown type: \"+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf=\"\";while(str.charAt(++i)!=\"-\"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!=\"-\"){throw new Error(\"Illegal attachments\")}p.attachments=Number(buf)}if(\"/\"==str.charAt(i+1)){p.nsp=\"\";while(++i){var c=str.charAt(i);if(\",\"==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp=\"/\"}var next=str.charAt(i+1);if(\"\"!==next&&Number(next)==next){p.id=\"\";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug(\"decoded %s as %j\",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:\"parser error\"}}},{\"./binary\":46,\"./is-buffer\":48,\"component-emitter\":49,debug:39,isarray:43,json3:50}],48:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],49:[function(_dereq_,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],50:[function(_dereq_,module,exports){(function(global){(function(){var isLoader=typeof define===\"function\"&&define.amd;var objectTypes={\"function\":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global==\"object\"&&global;if(freeGlobal&&(freeGlobal[\"global\"]===freeGlobal||freeGlobal[\"window\"]===freeGlobal||freeGlobal[\"self\"]===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root[\"Object\"]());exports||(exports=root[\"Object\"]());var Number=context[\"Number\"]||root[\"Number\"],String=context[\"String\"]||root[\"String\"],Object=context[\"Object\"]||root[\"Object\"],Date=context[\"Date\"]||root[\"Date\"],SyntaxError=context[\"SyntaxError\"]||root[\"SyntaxError\"],TypeError=context[\"TypeError\"]||root[\"TypeError\"],Math=context[\"Math\"]||root[\"Math\"],nativeJSON=context[\"JSON\"]||root[\"JSON\"];if(typeof nativeJSON==\"object\"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name==\"bug-string-char-index\"){isSupported=\"a\"[0]!=\"a\"}else if(name==\"json\"){isSupported=has(\"json-stringify\")&&has(\"json-parse\")}else{var value,serialized='{\"a\":[1,true,false,null,\"\\\\u0000\\\\b\\\\n\\\\f\\\\r\\\\t\"]}';if(name==\"json-stringify\"){var stringify=exports.stringify,stringifySupported=typeof stringify==\"function\"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)===\"0\"&&stringify(new Number)===\"0\"&&stringify(new String)=='\"\"'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)===\"1\"&&stringify([value])==\"[1]\"&&stringify([undef])==\"[null]\"&&stringify(null)==\"null\"&&stringify([undef,getClass,null])==\"[null,null,null]\"&&stringify({a:[value,true,false,null,\"\\x00\\b\\n\\f\\r\t\"]})==serialized&&stringify(null,value)===\"1\"&&stringify([1,2],null,1)==\"[\\n 1,\\n 2\\n]\"&&stringify(new Date(-864e13))=='\"-271821-04-20T00:00:00.000Z\"'&&stringify(new Date(864e13))=='\"+275760-09-13T00:00:00.000Z\"'&&stringify(new Date(-621987552e5))=='\"-000001-01-01T00:00:00.000Z\"'&&stringify(new Date(-1))=='\"1969-12-31T23:59:59.999Z\"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name==\"json-parse\"){var parse=exports.parse;if(typeof parse==\"function\"){try{if(parse(\"0\")===0&&!parse(false)){value=parse(serialized);var parseSupported=value[\"a\"].length==5&&value[\"a\"][0]===1;if(parseSupported){try{parseSupported=!parse('\"\t\"')}catch(exception){}if(parseSupported){try{parseSupported=parse(\"01\")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse(\"1.\")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has(\"json\")){var functionClass=\"[object Function]\",dateClass=\"[object Date]\",numberClass=\"[object Number]\",stringClass=\"[object String]\",arrayClass=\"[object Array]\",booleanClass=\"[object Boolean]\";var charIndexBuggy=has(\"bug-string-char-index\");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=[\"valueOf\",\"toString\",\"toLocaleString\",\"propertyIsEnumerable\",\"isPrototypeOf\",\"hasOwnProperty\",\"constructor\"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!=\"function\"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property==\"prototype\")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property==\"prototype\")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property==\"prototype\")&&isProperty.call(object,property)&&!(isConstructor=property===\"constructor\")){callback(property)}}if(isConstructor||isProperty.call(object,property=\"constructor\")){callback(property)}}}return forEach(object,callback)};if(!has(\"json-stringify\")){var Escapes={92:\"\\\\\\\\\",34:'\\\\\"',8:\"\\\\b\",12:\"\\\\f\",10:\"\\\\n\",13:\"\\\\r\",9:\"\\\\t\"};var leadingZeroes=\"000000\";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix=\"\\\\u00\";var quote=function(value){var result='\"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(\"\"):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'\"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value==\"object\"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,\"toJSON\")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?\"-\":\"+\")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+\"-\"+toPaddedString(2,month+1)+\"-\"+toPaddedString(2,date)+\"T\"+toPaddedString(2,hours)+\":\"+toPaddedString(2,minutes)+\":\"+toPaddedString(2,seconds)+\".\"+toPaddedString(3,milliseconds)+\"Z\"}else{value=null}}else if(typeof value.toJSON==\"function\"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,\"toJSON\"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return\"null\"}className=getClass.call(value);if(className==booleanClass){return\"\"+value}else if(className==numberClass){return value>-1/0&&value<1/0?\"\"+value:\"null\"}else if(className==stringClass){return quote(\"\"+value)}if(typeof value==\"object\"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?\"null\":element)}result=results.length?whitespace?\"[\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"]\":\"[\"+results.join(\",\")+\"]\":\"[]\"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+\":\"+(whitespace?\" \":\"\")+element)}});result=results.length?whitespace?\"{\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"}\":\"{\"+results.join(\",\")+\"}\":\"{}\"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace=\"\",width>10&&(width=10);whitespace.length<width;whitespace+=\" \");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize(\"\",(value={},value[\"\"]=source,value),callback,properties,whitespace,\"\",[])}}if(!has(\"json-parse\")){var fromCharCode=String.fromCharCode;var Unescapes={92:\"\\\\\",34:'\"',47:\"/\",98:\"\\b\",116:\"\t\",110:\"\\n\",102:\"\\f\",114:\"\\r\"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value=\"@\",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode(\"0x\"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)==\"true\"){Index+=4;return true}else if(source.slice(Index,Index+5)==\"false\"){Index+=5;return false}else if(source.slice(Index,Index+4)==\"null\"){Index+=4;return null}abort()}}return\"$\"};var get=function(value){var results,hasMembers;if(value==\"$\"){abort()}if(typeof value==\"string\"){if((charIndexBuggy?value.charAt(0):value[0])==\"@\"){return value.slice(1)}if(value==\"[\"){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"]\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"]\"){abort()}}else{abort()}}if(value==\",\"){abort()}results.push(get(value))}return results}else if(value==\"{\"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"}\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"}\"){abort()}}else{abort()}}if(value==\",\"||typeof value!=\"string\"||(charIndexBuggy?value.charAt(0):value[0])!=\"@\"||lex()!=\":\"){abort()}results[value.slice(1)]=get(lex())\n}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value==\"object\"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=\"\"+source;result=get(lex());if(lex()!=\"$\"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[\"\"]=result,value),\"\",callback):result}}}exports[\"runInContext\"]=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root[\"JSON3\"],isRestored=false;var JSON3=runInContext(root,root[\"JSON3\"]={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root[\"JSON3\"]=previousJSON;nativeJSON=previousJSON=null}return JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],51:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[31])(31)});\n\n    \n      ;var weight = document.getElementById('weight');\n      var socket = io('https://{{ip}}:1881');\n      socket.on('getWeight', function(msg) {\n        weight.innerHTML = msg;\n    \n      }); \n    }, 1000);\n    </script>\n\n  </body>\n</html>\n","x":530,"y":1320,"wires":[["368ceead.a31352"]]},{"id":"368ceead.a31352","type":"http response","z":"55db58b3.1c1c98","name":"","x":670,"y":1320,"wires":[]},{"id":"2a77e6a5.5b310a","type":"function","z":"55db58b3.1c1c98","name":"set ip","func":"msg.ip = global.get('ip');\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":1320,"wires":[["4eb9e062.50a44"]]},{"id":"8d49e123.d884d","type":"ui_chart","z":"55db58b3.1c1c98","name":"","group":"2bcc2e47.b16732","order":1,"width":"6","height":"6","label":"Ліві(Авто 1)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-20","ymax":"70000","removeOlder":"10","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"x":169.3333740234375,"y":710.3333740234375,"wires":[[],[]]},{"id":"4aab55db.df586c","type":"comment","z":"55db58b3.1c1c98","name":"Зважування","info":"","x":170,"y":1020,"wires":[]},{"id":"380f1e00.a386a2","type":"trigger","z":"55db58b3.1c1c98","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","name":"","x":320,"y":220,"wires":[["eb92ef0d.92dda"]]},{"id":"8a1287f1.e3da88","type":"switch","z":"55db58b3.1c1c98","name":"","property":"transactionHasOverLoad","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":710,"y":360,"wires":[["30f2a706.add598"]]},{"id":"30f2a706.add598","type":"function","z":"55db58b3.1c1c98","name":"over_load","func":"msg.event_id = flow.get('event_over_load');\nmsg.description = 'Можливий досип після зважування. Максимальная вага: ' + msg.metadata.transactionMaxWeight + \"кг. Облікова вага: \" + msg.metadata.transactionAccWeight + \"кг.\";\n\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":360,"wires":[["e7b3dc85.269b8"]]},{"id":"4f9959eb.a2af68","type":"delay","z":"55db58b3.1c1c98","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":820,"y":900,"wires":[["e7b3dc85.269b8"]]},{"id":"42b8f87c.63b968","type":"delay","z":"55db58b3.1c1c98","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":820,"y":940,"wires":[["e7b3dc85.269b8"]]},{"id":"8f592105.61b3","type":"http in","z":"55db58b3.1c1c98","name":"","url":"/get1","method":"get","swaggerDoc":"","x":200,"y":1180,"wires":[["13f78fbd.18689","3f9666cc.8a89aa"]]},{"id":"13f78fbd.18689","type":"function","z":"55db58b3.1c1c98","name":"response","func":"msg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nif(transactionWaybill && transactionWaybill !== msg.req.query.reader){\n    msg.payload.status = false;    \n}else {\n    msg.payload.status = true;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":1180,"wires":[["7a0e1dcd.c7ec24"]]},{"id":"7a0e1dcd.c7ec24","type":"http response","z":"55db58b3.1c1c98","name":"","x":610,"y":1180,"wires":[]},{"id":"284cd4.a3ac332c","type":"comment","z":"55db58b3.1c1c98","name":"Сокет, монітор вагів","info":"","x":200,"y":1280,"wires":[]},{"id":"b973f186.f1c72","type":"delay","z":"55db58b3.1c1c98","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":180,"wires":[["8213d295.f0ca2"]]},{"id":"7b09dd85.296ec4","type":"switch","z":"55db58b3.1c1c98","name":"","property":"start_timer","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":150,"y":2200,"wires":[["163b66fc.317999"]]},{"id":"163b66fc.317999","type":"function","z":"55db58b3.1c1c98","name":"logic","func":"var arrayCompare = flow.get(\"arrayCompare\");\nvar count = flow.get(\"count_1\");\nconst delta = global.get('stableDiff');//змінна порівння для стабільності 80 -60 = 20, якщо більше за дельту тоді false\nvar weight = msg.metadata.weight;\nvar prevWeight = msg.metadata.prevWeight;\nvar subWePr = weight - prevWeight;\n//\nvar send1C = true;\n\n//ітерації для перевірки\nvar iteration = global.get('iteration');\n\n\nif(arrayCompare.length == iteration){\n    arrayCompare.forEach((element) => {\n        if(element === false){\n            send1C = false  \n        }        \n    })\n    msg.send1C = send1C;\n    \n    \n    //flow.set(\"arrayCompare\", []);\n    //flow.set(\"start_timer\", false);\n}else {\n    if(subWePr >= 0 && weight > 0){\n        if(subWePr <= delta){\n            arrayCompare.push(true);    \n        }else {\n            arrayCompare.push(false);       \n        }\n    }else if(subWePr < 0 && weight > 0){\n        if(subWePr >= -delta){\n            arrayCompare.push(true);    \n        }else {\n            arrayCompare.push(false);       \n        }    \n    }\n}\n\n\nmsg.subWePr = subWePr;\nflow.set(\"arrayCompare\", arrayCompare);\nmsg.payload = arrayCompare; \nreturn msg;","outputs":1,"noerr":0,"x":270,"y":2200,"wires":[["adad1f8c.52566","ff46363e.fd7a68","4d9539ec.b8a5b8"]]},{"id":"adad1f8c.52566","type":"debug","z":"55db58b3.1c1c98","name":"false","active":false,"console":false,"complete":"true","x":430,"y":2020,"wires":[]},{"id":"4d9539ec.b8a5b8","type":"function","z":"55db58b3.1c1c98","name":"repeat cycle","func":"var array = msg.payload\n//ітерації\nvar iteration = global.get('iteration');\n\n//повторення циклу якщо принаймні один елемент false\nif(array.length == iteration){\n    array.forEach((element) => {\n        if(element === false){\n            flow.set(\"arrayCompare\",[])\n            flow.set(\"start_timer\", true);\n            return true;\n        }        \n    })\n    return msg;\n}\n","outputs":1,"noerr":0,"x":450,"y":2060,"wires":[["963c0c4a.48798"]]},{"id":"ff46363e.fd7a68","type":"switch","z":"55db58b3.1c1c98","name":"","property":"send1C","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":430,"y":2200,"wires":[["766aad03.2bbf04","6107ce11.9a7a2"]]},{"id":"963c0c4a.48798","type":"debug","z":"55db58b3.1c1c98","name":"false","active":false,"console":false,"complete":"true","x":610,"y":2060,"wires":[]},{"id":"6107ce11.9a7a2","type":"function","z":"55db58b3.1c1c98","name":"send 1C","func":"//формування відповіді\n\nmsg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nmsg.payload.status = true;    \n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id = flow.get('truck_id');\nmsg.payload.device_id = global.get('scale_id_in');\nmsg.payload.reader = flow.get('reader');\n\n//встановлення стабільності\nmsg.payload.stable = true;\n//видалення зайвого\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\n\n    //оновлення змінних для початку нового циклу перевірки\nflow.set(\"arrayCompare\", []);\nflow.set(\"start_timer\", false);\n    \n   //адреса для відправки \nmsg.url = global.get(\"send_1c_url_GetWeight\");   \n\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":2200,"wires":[["4d9aea40.b91d04","5a50ef1a.86bb5","ef4cd58d.516d88","4cb4e70.baad018"]]},{"id":"766aad03.2bbf04","type":"debug","z":"55db58b3.1c1c98","name":"true","active":false,"console":false,"complete":"true","x":590,"y":2280,"wires":[]},{"id":"a5b2c766.19ace8","type":"function","z":"55db58b3.1c1c98","name":"init conf  send 1C","func":"var transactionMetadata = flow.get(\"transactionMetadata\");\nvar currentWeight = transactionMetadata.weight;\nvar filterSend1C  = global.get(\"filterSend1C\"); // омеження ваги для відправки\n\n//if(currentWeight >= filterSend1C){\n    //змінні для перевірки стабільності\n    flow.set(\"count_1\", 0);\n    flow.set(\"start_timer\", true);\n    flow.set(\"arrayCompare\",[]);\n\n//ідентифікатори для відправки ваги\n    var reader = msg.payload.reader;\n    var truck_id = msg.payload.truck_id;\n    flow.set('transactionWaybill',reader);\n    flow.set('reader', reader);\n    flow.set('truck_id', truck_id);\n    \n    //JSON.parse(msg.payload); \n    return msg; \n\n//}","outputs":1,"noerr":0,"x":950,"y":1660,"wires":[["bbd008d0.5446d8","c90c8c12.a31f9","af3b8260.15883"]]},{"id":"bbd008d0.5446d8","type":"debug","z":"55db58b3.1c1c98","name":"1c send Avto 1","active":true,"console":"false","complete":"payload","x":1180,"y":1660,"wires":[]},{"id":"d6498f90.8054e","type":"comment","z":"55db58b3.1c1c98","name":"Отримання мітки і номеру авто","info":"","x":190,"y":1600,"wires":[]},{"id":"4d9aea40.b91d04","type":"http request","z":"55db58b3.1c1c98","name":"","method":"POST","ret":"txt","url":"","tls":"e1dd70f.94c7c9","x":870,"y":2200,"wires":[["1f616b0a.4524d5","4fd7cf49.ff772"]]},{"id":"1f616b0a.4524d5","type":"debug","z":"55db58b3.1c1c98","name":"true","active":false,"console":false,"complete":"true","x":1050,"y":2240,"wires":[]},{"id":"fb72d153.177ff","type":"trigger","z":"55db58b3.1c1c98","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"120","extend":true,"units":"s","reset":"","name":"","x":810,"y":1940,"wires":[["4f863357.dc703c"]]},{"id":"4f863357.dc703c","type":"function","z":"55db58b3.1c1c98","name":"send 1C","func":"//формування відповіді\nmsg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nmsg.payload.status = true;    \n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id = flow.get('truck_id');\nmsg.payload.device_id = global.get('scale_id_in');\nmsg.payload.reader = flow.get('reader');\n\n\n\n//видалення завих параметрів\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\n\n//присвоєння стабільності\nmsg.payload.stable = false;\n  \n//оновлення змінних для початку нового циклу перевірки    \nflow.set(\"arrayCompare\", []);\nflow.set(\"start_timer\", false);\n  \n  \n//адреса для відправки  \nmsg.url = global.get(\"send_1c_url_GetWeight\");  \nreturn msg;","outputs":1,"noerr":0,"x":960,"y":1940,"wires":[["2adf673d.2cdf38","4d9aea40.b91d04","ef4cd58d.516d88","4cb4e70.baad018"]]},{"id":"2adf673d.2cdf38","type":"debug","z":"55db58b3.1c1c98","name":"","active":false,"console":"false","complete":"false","x":1130,"y":1940,"wires":[]},{"id":"eae59d1f.8f12","type":"function","z":"55db58b3.1c1c98","name":"скидання тригера","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":1940,"wires":[["fb72d153.177ff"]]},{"id":"c90c8c12.a31f9","type":"link out","z":"55db58b3.1c1c98","name":"triger 1.1 W1","links":["1fac8e79.6b70d2"],"x":1115,"y":1740,"wires":[]},{"id":"1fac8e79.6b70d2","type":"link in","z":"55db58b3.1c1c98","name":"triger 1.1 W1","links":["c90c8c12.a31f9"],"x":695,"y":1900,"wires":[["fb72d153.177ff"]]},{"id":"5a50ef1a.86bb5","type":"link out","z":"55db58b3.1c1c98","name":"triger 1.2 W1","links":["b2748b.9bbb8b78"],"x":715,"y":2160,"wires":[]},{"id":"b2748b.9bbb8b78","type":"link in","z":"55db58b3.1c1c98","name":"triger 1.2 W1","links":["5a50ef1a.86bb5"],"x":415,"y":1940,"wires":[["eae59d1f.8f12"]]},{"id":"b1d2f1d6.aebb7","type":"http in","z":"55db58b3.1c1c98","name":"","url":"/getWeightStart1","method":"post","swaggerDoc":"","x":200,"y":1660,"wires":[["4b36c3f5.61059c","a0958084.276e1","867b7d62.31a87","b409b9d1.066db8","6322cf40.06b34","9dea0c95.e439d"]]},{"id":"4b36c3f5.61059c","type":"http response","z":"55db58b3.1c1c98","name":"","x":650,"y":1620,"wires":[]},{"id":"a079deb5.9aaa","type":"comment","z":"55db58b3.1c1c98","name":"Перевірка на стабільність","info":"","x":410,"y":2160,"wires":[]},{"id":"41082f55.4d87","type":"comment","z":"55db58b3.1c1c98","name":"Не стабільна вага","info":"","x":470,"y":1900,"wires":[]},{"id":"a0958084.276e1","type":"debug","z":"55db58b3.1c1c98","name":"","active":false,"console":"false","complete":"true","x":650,"y":1700,"wires":[]},{"id":"68cfa513.3c249c","type":"delay","z":"55db58b3.1c1c98","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1340,"y":320,"wires":[["f0824bd2.300878"]]},{"id":"715da772.9e6ff8","type":"switch","z":"55db58b3.1c1c98","name":"","property":"transactionMaxWeight","propertyType":"msg","rules":[{"t":"gt","v":"filterSend1C","vt":"global"}],"checkall":"true","outputs":1,"x":1210,"y":320,"wires":[["68cfa513.3c249c"]]},{"id":"f0824bd2.300878","type":"function","z":"55db58b3.1c1c98","name":"send 1C","func":"//формування відповіді\nmsg.payload = msg.metadata;\n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id  = flow.get('truck_id'); \nmsg.payload.device_id = global.get('scale_id_in');\n\n\n//видалення завих параметрів\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\ndelete msg.payload.transactionAccWeight;\ndelete msg.payload.waybill;\ndelete msg.payload.driverInCar;\ndelete msg.payload.transactionOperationName;\n\n\n\n\n//адреса для відправки  \nmsg.url = global.get(\"send_1c_url_GetWeight\");  \nreturn msg;","outputs":1,"noerr":0,"x":1480,"y":320,"wires":[["a7f91a4c.a57358","29ee75d2.65b09a"]]},{"id":"a7f91a4c.a57358","type":"http request","z":"55db58b3.1c1c98","name":"","method":"POST","ret":"txt","url":"","tls":"e1dd70f.94c7c9","x":1650,"y":320,"wires":[["3d22170.3bd5cea","95bc82ba.c46df"]]},{"id":"1f5be891.21c947","type":"debug","z":"55db58b3.1c1c98","name":"","active":true,"console":"false","complete":"true","x":1890,"y":560,"wires":[]},{"id":"77a3159e.8bd30c","type":"comment","z":"55db58b3.1c1c98","name":"Відправка в 1С після зїзду","info":"","x":1280,"y":280,"wires":[]},{"id":"b84b59a1.aed638","type":"function","z":"55db58b3.1c1c98","name":"sid","func":"//let sid = msg.payload.sid;\n//msg.sid = sid;\n\n//let sid = msg.payload.sid;\nlet sid = global.get('sidG');\n\nmsg.sid = sid;\n\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":2250,"y":700,"wires":[["55132308.8293dc"]]},{"id":"453c3a37.450144","type":"http request","z":"55db58b3.1c1c98","name":"","method":"GET","ret":"bin","url":"","tls":"7eb4a526.3db92c","x":2730,"y":700,"wires":[["aa25dd81.a349e","678a450a.d793e4"]]},{"id":"2fbf651a.32fa6a","type":"switch","z":"55db58b3.1c1c98","name":"take snapshot","property":"snapshot","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1760,"y":700,"wires":[["2793fc63.b48bf4"]]},{"id":"aa25dd81.a349e","type":"function","z":"55db58b3.1c1c98","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2910,"y":700,"wires":[["1e687538.c6b61b"]]},{"id":"1e687538.c6b61b","type":"http request","z":"55db58b3.1c1c98","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"5bd22a1d.f94584","x":3120,"y":700,"wires":[["83417a7e.a464b8","bb170e7d.96a92"]]},{"id":"3d22170.3bd5cea","type":"function","z":"55db58b3.1c1c98","name":"clear truck_id","func":" flow.set('truck_id', \"\");\n flow.set('reader', \"\");\nreturn msg;","outputs":1,"noerr":0,"x":1850,"y":320,"wires":[[]]},{"id":"d992f825.b23bb8","type":"function","z":"55db58b3.1c1c98","name":"delete","func":"\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\nflow.set('msg_photo', msg);\nreturn msg;","outputs":1,"noerr":0,"x":2110,"y":700,"wires":[["b84b59a1.aed638"]]},{"id":"fb9fcab1.375598","type":"debug","z":"55db58b3.1c1c98","name":"req","active":false,"console":"false","complete":"true","x":470,"y":1020,"wires":[]},{"id":"32712c21.c5ade4","type":"debug","z":"55db58b3.1c1c98","name":"res","active":false,"console":"false","complete":"true","x":630,"y":1100,"wires":[]},{"id":"e2440857.72d068","type":"http request","z":"55db58b3.1c1c98","name":"","method":"GET","ret":"bin","url":"","tls":"7eb4a526.3db92c","x":2731,"y":798,"wires":[["14739d89.793012","678a450a.d793e4"]]},{"id":"14739d89.793012","type":"function","z":"55db58b3.1c1c98","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2911,"y":798,"wires":[["986a36dd.2345f8"]]},{"id":"986a36dd.2345f8","type":"http request","z":"55db58b3.1c1c98","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"5bd22a1d.f94584","x":3121,"y":798,"wires":[["83417a7e.a464b8","1c32a6c2.0ecd29"]]},{"id":"65b4fdd3.f46c54","type":"http request","z":"55db58b3.1c1c98","name":"","method":"GET","ret":"bin","url":"","tls":"7eb4a526.3db92c","x":2730,"y":912,"wires":[["bece1c86.6284d","678a450a.d793e4"]]},{"id":"bece1c86.6284d","type":"function","z":"55db58b3.1c1c98","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2910,"y":912,"wires":[["68368767.2fe0b8"]]},{"id":"68368767.2fe0b8","type":"http request","z":"55db58b3.1c1c98","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"5bd22a1d.f94584","x":3120,"y":912,"wires":[["83417a7e.a464b8"]]},{"id":"55132308.8293dc","type":"delay","z":"55db58b3.1c1c98","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2400,"y":700,"wires":[["93eee308.ccad78"]]},{"id":"b4f47f13.ee976","type":"delay","z":"55db58b3.1c1c98","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2401,"y":798,"wires":[["44b4b609.928a8"]]},{"id":"146f07eb.fbe738","type":"delay","z":"55db58b3.1c1c98","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2390,"y":912,"wires":[["35aaa73d.b0e1e8"]]},{"id":"ebe1ca97.09e278","type":"comment","z":"55db58b3.1c1c98","name":"Зробити фото","info":"","x":1760,"y":660,"wires":[]},{"id":"9dd4e2c5.16cba","type":"ui_text","z":"55db58b3.1c1c98","group":"7b3842bd.4285fc","order":0,"width":0,"height":0,"name":"","label":"Стабільність ліві(Авто 1):","format":"{{msg.stable}}","layout":"row-spread","x":450,"y":740,"wires":[]},{"id":"2b0126bb.3d6a7a","type":"link out","z":"55db58b3.1c1c98","name":"зїзд вагів 1","links":["ea933432.53b748","51ec5d93.0bb344"],"x":1335,"y":420,"wires":[]},{"id":"40e9d9ed.37a408","type":"function","z":"55db58b3.1c1c98","name":"Графік стабільності","func":"if(msg.stable === true){\n    msg.payload = 1;\n}else if(msg.stable === false){\n    msg.payload = 0;\n}else{\n    msg.payload = -1;\n}\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":780,"wires":[["764eae3b.d67a6"]]},{"id":"764eae3b.d67a6","type":"ui_chart","z":"55db58b3.1c1c98","name":"","group":"5364d6e7.c9f778","order":1,"width":0,"height":0,"label":"Стабільність ліві(Авто 1)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-1","ymax":"2","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"x":610,"y":780,"wires":[[],[]]},{"id":"867b7d62.31a87","type":"delay","z":"55db58b3.1c1c98","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"4","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":680,"y":1660,"wires":[["a5b2c766.19ace8","efbb53e3.22c49"]]},{"id":"19d429d4.a93136","type":"ui_chart","z":"55db58b3.1c1c98","name":"","group":"2bcc2e47.b16732","order":2,"width":0,"height":0,"label":"Заїзд / зїзд ліві(Авто 1)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"Заїзд / зїзд ліві","ymin":"-1","ymax":"2","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"x":970,"y":720,"wires":[[],[]]},{"id":"664bd5f4.63514c","type":"function","z":"55db58b3.1c1c98","name":"Графік заїзду/зїзду","func":"if(msg.on === true){\n    msg.payload = 1;\n}else if(msg.on === false){\n    msg.payload = -1;\n}else{\n    msg.payload = 0;\n}\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":720,"wires":[["19d429d4.a93136"]]},{"id":"5b608f5.4ddff7","type":"function","z":"55db58b3.1c1c98","name":"Графік Транзакції","func":"msg.payload = msg.transaction;\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":760,"wires":[["59b69675.3d3e78"]]},{"id":"59b69675.3d3e78","type":"ui_chart","z":"55db58b3.1c1c98","name":"Транзакція (ліві)","group":"2bcc2e47.b16732","order":2,"width":0,"height":0,"label":"Транзакція ліві(Авто 1)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"Транзакція (ліві)","ymin":"0","ymax":"10000000000","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"x":1010,"y":760,"wires":[[],[]]},{"id":"697eb66b.928f38","type":"ui_text","z":"55db58b3.1c1c98","group":"cff4b7fb.603008","order":0,"width":0,"height":0,"name":"","label":"Ліві(Авто 1), truck_id","format":"{{msg.payload.truck_id}}","layout":"row-spread","x":320,"y":1780,"wires":[]},{"id":"5b120ad8.595354","type":"ui_text","z":"55db58b3.1c1c98","group":"cff4b7fb.603008","order":0,"width":0,"height":0,"name":"","label":"Ліві(Авто 1), дата","format":"{{msg.payload}}","layout":"row-spread","x":310,"y":1820,"wires":[]},{"id":"b409b9d1.066db8","type":"function","z":"55db58b3.1c1c98","name":"","func":"msg.payload = new Date();\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":1820,"wires":[["5b120ad8.595354"]]},{"id":"6322cf40.06b34","type":"function","z":"55db58b3.1c1c98","name":"","func":"delete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":1780,"wires":[["697eb66b.928f38"]]},{"id":"9dea0c95.e439d","type":"function","z":"55db58b3.1c1c98","name":"","func":"var transactionMetadata = flow.get(\"transactionMetadata\");\nvar currentWeight = transactionMetadata.weight;\nmsg.payload = currentWeight;\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":1860,"wires":[["60ebdf2.85f372"]]},{"id":"60ebdf2.85f372","type":"ui_text","z":"55db58b3.1c1c98","group":"cff4b7fb.603008","order":0,"width":0,"height":0,"name":"","label":"Ліві(Авто 1), Вага зважування","format":"{{msg.payload}}","layout":"row-spread","x":350,"y":1860,"wires":[]},{"id":"86d71e3a.e0ee3","type":"ui_chart","z":"55db58b3.1c1c98","name":"","group":"b5b65a42.eba3f8","order":0,"width":0,"height":0,"label":"Зважування ліві(Авто 1)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-1","ymax":"2","removeOlder":"5","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"x":1470,"y":2040,"wires":[[],[]]},{"id":"af3b8260.15883","type":"function","z":"55db58b3.1c1c98","name":"Отримав дані","func":"msg.payload = 1;\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":1300,"y":2040,"wires":[["86d71e3a.e0ee3"]]},{"id":"ef4cd58d.516d88","type":"function","z":"55db58b3.1c1c98","name":"Відправив дані","func":"msg.payload = -1;\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":1300,"y":2080,"wires":[["86d71e3a.e0ee3"]]},{"id":"da40a534.956518","type":"comment","z":"55db58b3.1c1c98","name":"Графік автоматичного зважування","info":"","x":1320,"y":2000,"wires":[]},{"id":"ba3cf31e.a6f53","type":"inject","z":"55db58b3.1c1c98","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1180,"y":420,"wires":[["2b0126bb.3d6a7a"]]},{"id":"e221fd04.d9147","type":"function","z":"55db58b3.1c1c98","name":"GET 1C","func":"var reader = msg.payload.reader;\nvar truck_id = msg.payload.truck_id;\n\nmsg.payload = {\n    name:\"GET 1C\",\n    truck_id: truck_id,\n    reader:  reader,\n    date: global.get('date_log')\n};\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":1180,"wires":[["12abd496.5b419b"]]},{"id":"12abd496.5b419b","type":"file","z":"55db58b3.1c1c98","name":"","filename":"/distr/data/left(1_weight_60t)/log_1c.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1850,"y":1180,"wires":[]},{"id":"98bdb2d0.d7085","type":"function","z":"55db58b3.1c1c98","name":"Send 1C","func":"var transactionMetadata = flow.get('transactionMetadata');\n\nvar truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name:\"SEND 1C\",\n    tM:transactionMetadata.weight,\n    truck_id: truck_id,\n    reader:  reader,\n    date: global.get('date_log')\n};\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":1220,"wires":[["12abd496.5b419b"]]},{"id":"c85a1a84.d019b8","type":"function","z":"55db58b3.1c1c98","name":"RES 1C","func":"var res = msg.payload;\nmsg.payload = {\n    name:\"RES 1C\",\n    status:msg.statusCode,\n    res:res,\n    date: global.get('date_log')\n};\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":1260,"wires":[["12abd496.5b419b"]]},{"id":"20565ce2.436384","type":"file","z":"55db58b3.1c1c98","name":"","filename":"/distr/data/left(1_weight_60t)/log_1c.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":2050,"y":440,"wires":[]},{"id":"e17f8613.05e968","type":"comment","z":"55db58b3.1c1c98","name":"Логування запиту зїзд з 1С","info":"","x":1820,"y":380,"wires":[]},{"id":"29ee75d2.65b09a","type":"function","z":"55db58b3.1c1c98","name":"M_OUT_SEND 1C","func":"var truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name:\"M_OUT_SEND 1C\",\n    truck_id: truck_id,\n    reader:  reader,\n    date: global.get('date_log')\n};\nreturn msg;","outputs":1,"noerr":0,"x":1730,"y":460,"wires":[["20565ce2.436384"]]},{"id":"95bc82ba.c46df","type":"function","z":"55db58b3.1c1c98","name":"M_OUT_RES 1C","func":"var truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name: \"M_OUT_RES 1C\",\n    status: msg.statusCode,\n    date: global.get('date_log')\n};\nreturn msg;","outputs":1,"noerr":0,"x":1730,"y":420,"wires":[["20565ce2.436384"]]},{"id":"83417a7e.a464b8","type":"debug","z":"55db58b3.1c1c98","name":"","active":false,"console":"false","complete":"false","x":3310,"y":700,"wires":[]},{"id":"2793fc63.b48bf4","type":"delay","z":"55db58b3.1c1c98","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1940,"y":700,"wires":[["d992f825.b23bb8"]]},{"id":"a2ca680c.8eae78","type":"debug","z":"55db58b3.1c1c98","name":"IN device config","active":false,"console":"false","complete":"true","x":900,"y":140,"wires":[]},{"id":"e23792ce.fa50b","type":"link out","z":"55db58b3.1c1c98","name":"/distr/data/weight_Left_1_log.txt W1","links":["adaf02d6.f055a"],"x":155,"y":360,"wires":[]},{"id":"95ea71aa.996be","type":"file","z":"55db58b3.1c1c98","name":"","filename":"/distr/data/left(1_weight_60t)/weight_log.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1830,"y":1380,"wires":[]},{"id":"530a124a.5c8bac","type":"function","z":"55db58b3.1c1c98","name":"msg","func":"var weight = msg.payload;\n\nmsg.payload = {\n    weight: weight,\n    date: global.get('date_log'),\n    connect: msg.connect\n};\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":1380,"wires":[["95ea71aa.996be"]]},{"id":"adaf02d6.f055a","type":"link in","z":"55db58b3.1c1c98","name":"get msg log weight 1 out","links":["e23792ce.fa50b"],"x":1455,"y":1380,"wires":[["530a124a.5c8bac"]]},{"id":"a6857eb0.999d2","type":"comment","z":"55db58b3.1c1c98","name":"Відправка ваги на табло після зїзду","info":"","x":1250,"y":380,"wires":[]},{"id":"c6c5f39c.184e9","type":"comment","z":"55db58b3.1c1c98","name":"Відправка події в Скелю","info":"","x":1570,"y":520,"wires":[]},{"id":"14756c3.0e90994","type":"comment","z":"55db58b3.1c1c98","name":"Подія на підключений/відключений прилад","info":"","x":290,"y":880,"wires":[]},{"id":"2769abc2.af7104","type":"comment","z":"55db58b3.1c1c98","name":"Подія водій на вагах","info":"","x":1120,"y":1020,"wires":[]},{"id":"6aa15a99.b4c7a4","type":"link in","z":"55db58b3.1c1c98","name":"автоматичне зважування W1","links":["15c3705e.96d77"],"x":55,"y":2200,"wires":[["7b09dd85.296ec4"]]},{"id":"18b50cab.e30103","type":"comment","z":"55db58b3.1c1c98","name":"Ініціалізація налаштувань","info":"","x":190,"y":60,"wires":[]},{"id":"1cc9eede.9e39d1","type":"comment","z":"55db58b3.1c1c98","name":"Зчитування налаштувань","info":"","x":190,"y":140,"wires":[]},{"id":"79a154fc.41c80c","type":"comment","z":"55db58b3.1c1c98","name":"Логування ваги","info":"","x":140,"y":320,"wires":[]},{"id":"42b47450.77450c","type":"comment","z":"55db58b3.1c1c98","name":"Автоматичне зважування","info":"","x":170,"y":400,"wires":[]},{"id":"15c3705e.96d77","type":"link out","z":"55db58b3.1c1c98","name":"відправка ваги для авто зважування W1","links":["6aa15a99.b4c7a4"],"x":155,"y":440,"wires":[]},{"id":"c29ddb2c.134b28","type":"comment","z":"55db58b3.1c1c98","name":"Автоматичне зважування","info":"","x":250,"y":1560,"wires":[]},{"id":"dcafb818.064238","type":"comment","z":"55db58b3.1c1c98","name":"Логування при автоматичному зважуванні","info":"","x":1590,"y":1140,"wires":[]},{"id":"efbb53e3.22c49","type":"link out","z":"55db58b3.1c1c98","name":"GET 1C W1","links":["23cee8d2.80c9e8"],"x":875,"y":1620,"wires":[]},{"id":"4cb4e70.baad018","type":"link out","z":"55db58b3.1c1c98","name":"Send 1C W1","links":["365480b5.64cdd"],"x":1035,"y":2060,"wires":[]},{"id":"4fd7cf49.ff772","type":"link out","z":"55db58b3.1c1c98","name":"RES 1C W1","links":["5e1b4697.a42d18"],"x":1015,"y":2200,"wires":[]},{"id":"23cee8d2.80c9e8","type":"link in","z":"55db58b3.1c1c98","name":"GET 1C W1 out","links":["efbb53e3.22c49"],"x":1455,"y":1180,"wires":[["e221fd04.d9147"]]},{"id":"365480b5.64cdd","type":"link in","z":"55db58b3.1c1c98","name":"Send 1C W1 out","links":["4cb4e70.baad018"],"x":1455,"y":1220,"wires":[["98bdb2d0.d7085"]]},{"id":"5e1b4697.a42d18","type":"link in","z":"55db58b3.1c1c98","name":"RES 1C W1 out","links":["4fd7cf49.ff772"],"x":1455,"y":1260,"wires":[["c85a1a84.d019b8"]]},{"id":"f953eb22.3ede78","type":"comment","z":"55db58b3.1c1c98","name":"Логування GET 1C","info":"","x":890,"y":1580,"wires":[]},{"id":"6172f58d.12a44c","type":"comment","z":"55db58b3.1c1c98","name":"Логування Send 1C","info":"","x":1030,"y":2020,"wires":[]},{"id":"dde372c.f0ecd9","type":"comment","z":"55db58b3.1c1c98","name":"Логування RES 1C","info":"","x":1030,"y":2160,"wires":[]},{"id":"20a4e098.ef83f","type":"comment","z":"55db58b3.1c1c98","name":"Інформація з 1С при авто. зважуванні","info":"","x":210,"y":1740,"wires":[]},{"id":"80ab6d5c.22ad4","type":"comment","z":"55db58b3.1c1c98","name":"Скидання тригера очікування","info":"","x":740,"y":2120,"wires":[]},{"id":"12acf166.33ac0f","type":"comment","z":"55db58b3.1c1c98","name":"Тригер очікування","info":"Коли вага довго не стабільна відправляєм вагу яка є, \nпри повторні відправці з 1С також скидаєм","x":710,"y":1860,"wires":[]},{"id":"420f45a0.cf11ec","type":"comment","z":"55db58b3.1c1c98","name":"Логування ваги від вагопроцесора","info":"","x":1560,"y":1340,"wires":[]},{"id":"c7b0e92e.5f3a68","type":"comment","z":"55db58b3.1c1c98","name":"Тригер очікування","info":"Коли вага довго не стабільна відправляєм вагу яка є, \nпри повторні відправці з 1С також скидаєм","x":1110,"y":1700,"wires":[]},{"id":"bb170e7d.96a92","type":"function","z":"55db58b3.1c1c98","name":"sid","func":"//let sid = msg.payload.sid;\n//msg.sid = sid;\nmsg = flow.get('msg_photo');\n//let sid = msg.payload.sid;\nlet sid = global.get('sidG');\nmsg.sid = sid;\n\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":2251,"y":798,"wires":[["b4f47f13.ee976"]]},{"id":"1c32a6c2.0ecd29","type":"function","z":"55db58b3.1c1c98","name":"sid","func":"//let sid = msg.payload.sid;\n//msg.sid = sid;\nmsg = flow.get('msg_photo');\n//let sid = msg.payload.sid;\nlet sid = global.get('sidG');\nmsg.sid = sid;\n\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":2250,"y":912,"wires":[["146f07eb.fbe738"]]},{"id":"fc8444a1.41bea8","type":"inject","z":"b744ff99.c78b6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":110,"y":460,"wires":[["31601fe2.b5ed"]]},{"id":"e6c863c5.5586f","type":"function","z":"25dc673e.e08538","name":"GET WEIGHT","func":"var payload = msg.payload;\nvar parser = flow.get('parser');\nvar currentWeight = parser(payload);\n\nif(currentWeight > -80){\n    flow.set('currentWeight',currentWeight);\n    msg.connect = \"yes\"\n    msg.payload = currentWeight;\n    global.set('weight_2', currentWeight);\n    return msg;\n}\n","outputs":1,"noerr":0,"x":760,"y":320,"wires":[["5d8bbaca.d0fd54","1ee14ec0.c90901"]]},{"id":"c7369368.87842","type":"inject","z":"25dc673e.e08538","name":"init","topic":"","payload":"init","payloadType":"str","repeat":"","crontab":"","once":true,"x":147.99999618530273,"y":140.99999809265137,"wires":[["6606cb0c.e2ea14"]]},{"id":"2714500e.ae4c8","type":"comment","z":"25dc673e.e08538","name":"INITIALIZING Ліві ваги","info":"","x":160,"y":100,"wires":[]},{"id":"6606cb0c.e2ea14","type":"function","z":"25dc673e.e08538","name":"Модель весов","func":"flow.set('inputString',\"CMD\");\nflow.set('parser',function(v){\n        v = v.toString();\n        var weight = v.substring(1,8);\n        weight = Number(weight);\n        \n        // if(weight > 50){\n        //     weight = weight * 100;\n        //     weight = weight + 1500;\n        // }\n        //weight = weight + 12345\n        v = weight;\n        return v;\n        }\n    );\nglobal.set('scale_id_in2','d5f3a37d-912c-2636-b060-9f2f1f019000');\nglobal.set('ip','10.107.21.150');\nglobal.set('video_camera_url_1','');\n   \nreturn msg;","outputs":1,"noerr":0,"x":358,"y":140.4285659790039,"wires":[[]]},{"id":"1ee14ec0.c90901","type":"link out","z":"25dc673e.e08538","name":"Авто 1 W2","links":["87a59a4.486d268"],"x":915,"y":320,"wires":[]},{"id":"267dacbe.0dad44","type":"comment","z":"25dc673e.e08538","name":"Отимання ваги","info":"0x3","x":140,"y":280,"wires":[]},{"id":"5d8bbaca.d0fd54","type":"debug","z":"25dc673e.e08538","name":"","active":true,"console":"false","complete":"payload","x":1030,"y":280,"wires":[]},{"id":"8da36bed.1cdd78","type":"debug","z":"25dc673e.e08538","name":"","active":false,"console":"false","complete":"false","x":510,"y":380,"wires":[]},{"id":"ac5c54f9.3d7f78","type":"delay","z":"25dc673e.e08538","name":"","pauseType":"rate","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":550,"y":320,"wires":[["e6c863c5.5586f"]]},{"id":"592af8f2.528368","type":"debug","z":"25dc673e.e08538","name":"","active":true,"console":"false","complete":"false","x":770,"y":440,"wires":[]},{"id":"c8365a7a.b8e358","type":"function","z":"25dc673e.e08538","name":"time_rasp","func":"var time = new Date();\nflow.set(\"time_rasp\", time);\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":540,"wires":[["c06b2671.c582f8"]]},{"id":"309ff743.d59ae8","type":"inject","z":"25dc673e.e08538","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":170,"y":540,"wires":[["c8365a7a.b8e358"]]},{"id":"c06b2671.c582f8","type":"function","z":"25dc673e.e08538","name":"sub time","func":"var weigth_time = flow.get(\"weigth_time\");\nvar time_rasp = flow.get(\"time_rasp\");\nvar timeWait = global.get(\"timeWaitWeight\")\n\nvar sub = time_rasp - weigth_time;\n//msg.payload = {\n//    sub: time_rasp - weigth_time,\n//    weigth_time: weigth_time,\n//    time_rasp: time_rasp\n//}\n\n    if(sub > timeWait){\n    msg.payload = 0;\n    msg.connect = \"not\";\n    return msg;\n    }\n","outputs":1,"noerr":0,"x":540,"y":540,"wires":[["72f9e2.0c2e362","1ee14ec0.c90901"]]},{"id":"72f9e2.0c2e362","type":"debug","z":"25dc673e.e08538","name":"","active":true,"console":"false","complete":"false","x":710,"y":540,"wires":[]},{"id":"ddede03c.0ad16","type":"function","z":"25dc673e.e08538","name":"weigth_time","func":"flow.set('weigth_time',new Date());\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":500,"wires":[[]]},{"id":"949c8c92.735ad","type":"inject","z":"25dc673e.e08538","name":"","topic":"","payload":"","payloadType":"date","repeat":"2","crontab":"","once":false,"x":110,"y":320,"wires":[["e0c58eef.028c1"]]},{"id":"83e85c17.36e08","type":"comment","z":"25dc673e.e08538","name":"Коли довго немає ваги генерую 0 кг.","info":"","x":250,"y":460,"wires":[]},{"id":"f82f90db.a0aac","type":"inject","z":"25dc673e.e08538","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":170,"y":500,"wires":[["ddede03c.0ad16"]]},{"id":"e0dba4b6.f52e48","type":"function","z":"73798026.159ca","name":"transactionHasMinWeight","func":"msg.event_id = flow.get('event_min_weight');\nmsg.description = 'Перевищена мінімально-допустима вага, кг: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":680,"wires":[["73be79dd.4a9f78"]]},{"id":"612a845e.323ecc","type":"file","z":"73798026.159ca","name":"deivce_config_1.json","filename":"deivce_config_1.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":560,"y":120,"wires":[]},{"id":"9fa7023d.0d1d6","type":"function","z":"73798026.159ca","name":"main config","func":"flow.set('prevWeight',null);\nflow.set('transaction',null);\nflow.set('transactionData',[]);\nflow.set('transactionMaxWeight',null);\nflow.set('transactionHasMinWeight',null);\nflow.set('transactionHasMaxWeight',null);\nflow.set('transactionHasMaxDuration',null);\nflow.set('lasttimedata', new Date());\nflow.set('checkHealth',null);\nflow.set('transactionWaybill',null);\nflow.set('transactionAccWeight', null);\nflow.set('transactionHasOverLoad', null);\nflow.set('transactionOperationName', null);\n//початкові значення\n flow.set('truck_id', \"\");\n flow.set('reader', \"\");\n flow.set(\"start_timer\", false);\nreturn msg;\n","outputs":1,"noerr":0,"x":550,"y":240,"wires":[[]]},{"id":"14cb4fd5.78a25","type":"inject","z":"73798026.159ca","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":190,"y":200,"wires":[["32e9e064.e7d0b","4c6855cb.33e21c"]]},{"id":"489fe388.9f37cc","type":"file in","z":"73798026.159ca","name":"deivce_config_1.json","filename":"deivce_config_1.json","format":"utf8","x":580,"y":200,"wires":[["ef76ae93.08c25"]]},{"id":"2f0b5408.8f4d9c","type":"inject","z":"73798026.159ca","name":"DEMO","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":180,"y":120,"wires":[["8901b532.320278"]]},{"id":"8901b532.320278","type":"function","z":"73798026.159ca","name":"DEMO Data","func":"var device_config = {\n    'event_move_in_id':'80096D9ABE7F68F3E0533300000A6C0D',\n    'event_move_in_minus_id':'8DB9B239DF5252F0E055000000000001',\n    'event_move_out_id':'80096D9ABE8068F3E0533300000A6C0D',\n    'event_max_weight_id':'85A255F950F9BEF4E0533300000AC45D',\n    'event_on_id': '85A2CC45702A2DD1E0533300000A0C94',\n    'event_off_id':'85A2CC4570292DD1E0533300000A0C94',\n    'event_max_duration':'8642EE858DE89BAAE0533300000AFCC7',\n    'event_fake_traffic':'80096EF60C186574E0533300000ADBA5',\n    'event_get_weight_acc':'800970AC1FDC683CE0533300000AF1B0',\n    'event_min_weight':'875C3EB5C9DD092DE055000000000001',\n    'event_driver_in':'8E68D8D8B2977181E055000000000001',\n    'event_over_load':'B3EB5F800EFD2620E0530101007F8A05',\n    'snapshot_events':['80096D9ABE7F68F3E0533300000A6C0D','85A255F950F9BEF4E0533300000AC45D','8642EE858DE89BAAE0533300000AFCC7','800970AC1FDC683CE0533300000AF1B0', \"B3EB5F800EFD2620E0530101007F8A05\"],\n    'main_host':'https://10.107.21.150:8443/ords/ettn',\n    'event_url':'/iot_cli/events/log',\n    'state_url':'/iot_cli/device',\n    'snapshot_url':'/iot_cli/events/snapshot',\n    'maxWeight':60000,\n    'maxDuration':600000,\n    'minWeight':-40,\n    'checkHealthTimeout':3000,\n    'minTriggerWeight':20,//bylo 20\n    'driverWeight':80,\n    'overLoadWeight': 200,\n    'stableDiff': 60\n}\nmsg.payload = device_config;\n// flow.set('scale_id','80096CB0EFD83B63E0533300000A4334');\n// flow.set('event_move_in_id','80096D9ABE7F68F3E0533300000A6C0D');\n// flow.set('event_move_out_id','80096D9ABE8068F3E0533300000A6C0D');\n// flow.set('event_max_weight_id','85A255F950F9BEF4E0533300000AC45D');\n// flow.set('event_off_id','85A2CC4570292DD1E0533300000A0C94');\n// flow.set('event_on_id', '85A2CC45702A2DD1E0533300000A0C94');\n// flow.set('event_max_duration','8642EE858DE89BAAE0533300000AFCC7');\n// flow.set('main_host','http://prod.apex.rest/ords/ettn');\n// flow.set('event_url','/iot_cli/events/log');\n// flow.set('state_url','/v1/device');\n// flow.set('maxWeight',40000);\n// flow.set('maxDuration',20000);\n// flow.set('checkHealthTimeout',3000);\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":120,"wires":[["612a845e.323ecc"]]},{"id":"ef76ae93.08c25","type":"function","z":"73798026.159ca","name":"device config","func":"var device_config = JSON.parse(msg.payload);\n\nflow.set('scale_id',device_config.scale_id);\nflow.set('event_move_in_id',device_config.event_move_in_id);\nflow.set('event_move_in_minus_id',device_config.event_move_in_minus_id);\nflow.set('event_move_out_id',device_config.event_move_out_id);\nflow.set('event_max_weight_id',device_config.event_max_weight_id);\nflow.set('event_off_id',device_config.event_off_id);\nflow.set('event_on_id', device_config.event_on_id);\nflow.set('event_max_duration',device_config.event_max_duration);\nflow.set('event_fake_traffic',device_config.event_fake_traffic);\nflow.set('event_driver_in', device_config.event_driver_in);\nflow.set('event_over_load',device_config.event_over_load);\nflow.set('main_host',device_config.main_host);\nflow.set('event_url',device_config.event_url);\nflow.set('state_url',device_config.state_url);\nflow.set('maxWeight',device_config.maxWeight);\nflow.set('minWeight',device_config.minWeight);\nflow.set('maxDuration',device_config.maxDuration);\nflow.set('checkHealthTimeout',device_config.checkHealthTimeout);\nflow.set('event_get_weight_acc',device_config.event_get_weight_acc);\nflow.set('event_min_weight',device_config.event_min_weight);\nflow.set('minTriggerWeight',device_config.minTriggerWeight);\nflow.set('snapshot_url',device_config.snapshot_url);\nflow.set('snapshot_events',device_config.snapshot_events);\nflow.set('driverWeight',device_config.driverWeight);\nflow.set('overLoadWeight', device_config.overLoadWeight);\nflow.set('stableDiff', device_config.stableDiff);\n\n\nmsg.payload = {\n\tscale_id: flow.get('scale_id'),\n\tevent_move_in_id: flow.get('event_move_in_id'),\n\tevent_move_in_minus_id: flow.get('event_move_in_minus_id'),\n\tevent_move_out_id: flow.get('event_move_out_id'),\n\tevent_max_weight_id: flow.get('event_max_weight_id'),\n\tevent_off_id: flow.get('event_off_id'),\n\tevent_on_id: flow.get('event_on_id'),\n\tevent_max_duration: flow.get('event_max_duration'),\n\tevent_fake_traffic: flow.get('event_fake_traffic'),\n\tevent_driver_in: flow.get('event_driver_in'),\n\tevent_over_load: flow.get('event_over_load'),\n\tmain_host: flow.get('main_host'),\n\tevent_url: flow.get('event_url'),\n\tstate_url: flow.get('state_url'),\n\tmaxWeight: flow.get('maxWeight'),\n\tminWeight: flow.get('minWeight'),\n\tmaxDuration: flow.get('maxDuration'),\n\tcheckHealthTimeout: flow.get('checkHealthTimeout'),\n\tevent_get_weight_acc: flow.get('event_get_weight_acc'),\n\tevent_min_weight: flow.get('event_min_weight'),\n\tminTriggerWeight: flow.get('minTriggerWeight'),\n\tsnapshot_url: flow.get('snapshot_url'),\n\tsnapshot_events: flow.get('snapshot_events'),\n\tdriverWeight: flow.get('driverWeight'),\n\toverLoadWeight: flow.get('overLoadWeight'),\n\tstableDiff: flow.get('stableDiff')\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":770,"y":200,"wires":[["f0ee8b2d.425888","3c03e21.dc9ee1e"]]},{"id":"f0ee8b2d.425888","type":"json","z":"73798026.159ca","name":"","x":910,"y":200,"wires":[["f0e857de.f012c8"]]},{"id":"f0e857de.f012c8","type":"debug","z":"73798026.159ca","name":"IN device config","active":false,"console":"false","complete":"true","x":1060,"y":200,"wires":[]},{"id":"84ccbb0a.1002c8","type":"function","z":"73798026.159ca","name":"transactionHasMaxWeight","func":"msg.event_id = flow.get('event_max_weight_id');\nmsg.description = 'Перевищена максимально-допустима вага, кг: ' + msg.metadata.weight;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":600,"wires":[["73be79dd.4a9f78"]]},{"id":"192da2da.f9bacd","type":"switch","z":"73798026.159ca","name":"switch max weight","property":"transactionHasMaxWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":570,"y":600,"wires":[["84ccbb0a.1002c8"]]},{"id":"73be79dd.4a9f78","type":"function","z":"73798026.159ca","name":"events payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in2');\nvar snapshot_events = flow.get('snapshot_events');\nvar snapshot = false;\n\nif (snapshot_events.indexOf(event_id)>=0){\n    snapshot = true;\n}\n\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'devices':[{'id':scale_id}],\n    'data':msg.metadata,\n    'description':msg.description\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('event_url');\nmsg.main_host = flow.get('main_host');\nmsg.event_url = flow.get('event_url');\nmsg.snapshot = snapshot;\nreturn msg;","outputs":1,"noerr":0,"x":1580,"y":580,"wires":[["bcbdab4.9d21558"]]},{"id":"cbf16f42.f910b","type":"function","z":"73798026.159ca","name":"main module","func":"var prevWeight = flow.get('prevWeight');\nvar transaction = flow.get('transaction');\nvar transactionData = flow.get('transactionData');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar transactionHasMaxWeight = flow.get('transactionHasMaxWeight');\nvar transactionHasMinWeight = flow.get('transactionHasMinWeight');\nvar transactionHasMaxDuration = flow.get('transactionHasMaxDuration');\nvar transactionOperationName = flow.get('transactionOperationName');\nvar stableDiff = flow.get('stableDiff');//дельта стабільності\nvar waybill = flow.get('transactionWaybill');\nvar weight = msg.payload;\nvar stableSize = 20;\nvar duration = 0;\nvar operation_name_income = \"Приход (авто)\";\nvar maxWeight = flow.get('maxWeight');\nvar maxDuration = flow.get('maxDuration');\nvar prevTransaction = transaction;\nvar minWeight = flow.get('minWeight');\nvar minTriggerWeight = flow.get('minTriggerWeight');\nvar is_minus = false;\nvar transactionAccWeight = flow.get('transactionAccWeight');//облікова вага\nvar overLoadWeight = flow.get('overLoadWeight');\n\n//transaction\nif (prevWeight === null){\n    prevWeight = msg.payload;    \n}else{\n    if((prevWeight <= 40) && (weight > 0) && (weight >= minTriggerWeight)){\n        //start of transaction\n        transaction = Date.now();\n        msg.on = true;\n        flow.set('transaction',transaction);\n    }else if((prevWeight > 0) && (Math.abs(weight) <= 80) && (transaction)){\n        //transaction = 0;\n        msg.on = false;\n        transactionData = [];\n        flow.set('transaction',0);\n        flow.set('transactionMaxWeight',null);\n        flow.set('transactionHasMaxWeight',null);\n        flow.set('transactionHasMinWeight',null);\n        flow.set('transactionHasMaxDuration',null);\n        flow.set('transactionHasOverLoad',null);\n        flow.set('transactionOperationName',null);\n        flow.set('transactionWaybill',null);\n        flow.set('transactionMetadata',null);\n        flow.set('transactionAccWeight', null);//облікова вага\n    }else if((transaction === null) && (weight>0) && (weight > minTriggerWeight)){\n        transaction = Date.now();\n        flow.set('transaction',transaction);\n    }\n    if((prevWeight < 0) && ((weight-prevWeight) > minTriggerWeight)){\n        //start of transaction\n        is_minus = true;\n        msg.prevWeight = prevWeight;\n    }\n}\nmsg.stable = true;\nif (transaction > 0){\n    transactionData.push(weight);    \n\n    //stable\n    if(transactionData.length > stableSize+1){\n        var stabletmp = true;\n        for (var i = transactionData.length-1; i > transactionData.length-1-stableSize; i--){\n            if ((transactionData[i] - transactionData[i-1]) > stableDiff || (transactionData[i] - transactionData[i-1]) < -stableDiff){\n                stabletmp  = false;\n                msg.stable = stabletmp;\n                break;\n            }\n            msg.stable = stabletmp;\n        }\n    }else{\n        msg.stable = false;\n    }\n\n    //duration & transactionMaxWeight\n    duration = (Number(Date.now()) - Number(transaction));\n    if( (weight>transactionMaxWeight) || (transactionMaxWeight === null)){\n        transactionMaxWeight = weight;\n        flow.set(\"transactionMaxWeight\",transactionMaxWeight);\n    }\n    \n    if(!transactionHasMaxWeight && weight > maxWeight){\n        msg.transactionHasMaxWeight = true;\n        flow.set('transactionHasMaxWeight',true);\n    }\n    \n    if(!transactionHasMinWeight && weight < minWeight){\n        msg.transactionHasMinWeight = true;\n        flow.set('transactionHasMinWeight',true);\n    }\n    \n    //max duartion\n    if(!transactionHasMaxDuration && duration > maxDuration){\n        msg.transactionHasMaxDuration = true;\n        flow.set('transactionHasMaxDuration',true);\n    }\n}\n\nmsg.transaction = transaction;\n//msg.stable = true; // add 17.07 10.54\n//result\nmsg.metadata = {\n    'weight':weight,\n    'prevWeight':prevWeight,\n    'prevTransaction':prevTransaction,\n    'transaction':transaction,\n    'on':msg.on,\n    'transactionDataCount':transactionData.length,\n    'stable':msg.stable,\n    'duration':Math.round(duration/1000),\n    'transactionMaxWeight':transactionMaxWeight,\n    'transactionAccWeight':transactionAccWeight,\n    'waybill':waybill,\n    'perimetr':true,\n    'weight1':msg.weight1,\n    'weight2':msg.weight2,\n    'weight_center':msg.weight_center,\n    'driverInCar':false,\n    'transactionOperationName':transactionOperationName\n}\nflow.set('transactionData',transactionData);\nflow.set('prevWeight',weight);\nflow.set('transactionMetadata',msg.metadata);\nflow.set('lasttimedata', new Date());\nmsg.is_minus = is_minus;\n\nif(transactionAccWeight && transactionOperationName!==operation_name_income){\n    \n   flow.set('transactionHasOverLoad',(weight-transactionAccWeight)>overLoadWeight);\n   \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":580,"wires":[["8e6d9bf3.9fa928","192da2da.f9bacd","d2ec14aa.243f88","f7db6a8.e8b1598","5ff84905.731338","a116bb30.f7a2a8","9a76a01f.1d7f6","be1cc059.bb325","9a6649cc.cf6f48","932c805c.88965"]]},{"id":"99eeea43.a952a8","type":"function","z":"73798026.159ca","name":"get weight from accounting system","func":"var transactionMetadata = flow.get('transactionMetadata');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar driverWeight = flow.get('driverWeight');\nvar buisness_data = msg.req.query;\n\nmsg.metadata = Object.assign(transactionMetadata,buisness_data);\n\n//check driver in a car\nvar driver_in = false;\nmsg.driverWeight = driverWeight;\nif((transactionMaxWeight - msg.metadata.weight) < driverWeight){\n    driver_in = true;\n}\n\nmsg.event_id = flow.get('event_get_weight_acc');\ntransactionWaybill = flow.get('transactionWaybill');\nif (!transactionWaybill){\n    flow.set('transactionWaybill',msg.req.query.waybill);\n}\nmsg.description = ' '+buisness_data.operation_name+'. '+buisness_data.operation_type+'. Зважили в 1С. Поточна вага: ' + msg.metadata.weight+\" Номер авто: \"+buisness_data.truck1+\" \"+buisness_data.truck2+\" \"+buisness_data.item_name + \", ТТН: \" + buisness_data.waybill;\nmsg.transactionMetadata = transactionMetadata;\nmsg.driver_in = driver_in;\n\nflow.set('transactionAccWeight',  msg.metadata.weight);//облікова вага\nflow.set('transactionOperationName',  msg.metadata.operation_name);//вид операції\n\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":1080,"wires":[["d859f111.dff3d","73be79dd.4a9f78"]]},{"id":"bcbdab4.9d21558","type":"http request","z":"73798026.159ca","name":"EVENTS","method":"POST","ret":"txt","url":"","tls":"e1dd70f.94c7c9","x":1780,"y":580,"wires":[["b79a19a5.8d8e18"]]},{"id":"f4096ccc.6420e","type":"function","z":"73798026.159ca","name":"move in","func":"msg.event_id = flow.get('event_move_in_id');\nmsg.description = 'Заїзд на ваги. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":520,"wires":[["73be79dd.4a9f78"]]},{"id":"4bbaaf69.a512e","type":"function","z":"73798026.159ca","name":"off","func":"msg.event_id = flow.get('event_off_id');\nmsg.description = 'Прилад відключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":960,"wires":[["c3c48dfe.0a44f"]]},{"id":"7c3a6187.97c17","type":"function","z":"73798026.159ca","name":"on","func":"msg.event_id = flow.get('event_on_id');\nmsg.description = 'Прилад підключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":920,"wires":[["fa4da55d.73d4c8"]]},{"id":"36aa0e03.1f0c52","type":"function","z":"73798026.159ca","name":"move out","func":"msg.event_id = flow.get('event_move_out_id');\nmsg.description = 'Зїзд з ваг. Максимальна вага: ' + msg.metadata.transactionMaxWeight;\nmsg.transactionMaxWeight = msg.metadata.transactionMaxWeight;\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":560,"wires":[["73be79dd.4a9f78","343baab6.f16f96","6c5dfb39.e8c144"]]},{"id":"bec09de8.e2edb","type":"function","z":"73798026.159ca","name":"transaction has max duration","func":"msg.event_id = flow.get('event_max_duration');\nmsg.description = 'Перевищено максимальний час находження на вагах, сек: ' + msg.metadata.duration;\n\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":640,"wires":[["73be79dd.4a9f78"]]},{"id":"a652b45c.ca7498","type":"function","z":"73798026.159ca","name":"empty waybill","func":"msg.event_id = flow.get('event_fake_traffic');\nmsg.description = 'Холостий проїзд по вагам. Тривалість проїзду ' + Math.round(msg.metadata.duration/60)+ 'хв.' + \" Максимальна вага: \" + msg.metadata.transactionMaxWeight + \" кг.\";\n\nreturn msg;","outputs":1,"noerr":0,"x":922.6666259765625,"y":484.6666374206543,"wires":[["73be79dd.4a9f78"]]},{"id":"7f80f2ce.a62d3c","type":"function","z":"73798026.159ca","name":"move in minus","func":"msg.event_id = flow.get('event_move_in_minus_id');\nmsg.description = 'Заїзд із мінусом. ' + msg.prevWeight +' кг.';\n\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":440,"wires":[["73be79dd.4a9f78"]]},{"id":"87a59a4.486d268","type":"link in","z":"73798026.159ca","name":"Авто 2 W2","links":["1ee14ec0.c90901"],"x":95,"y":580,"wires":[["749ceda3.240be4","25474899.707728","4fc6583c.ebe568","d31e61b3.09e5c","cbf16f42.f910b","3f07b0a.3bbb85"]]},{"id":"8e6d9bf3.9fa928","type":"switch","z":"73798026.159ca","name":"switch move","property":"on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":550,"y":540,"wires":[["f4096ccc.6420e"],["36aa0e03.1f0c52","1d914e99.e06bb1","9394ace5.7c2d"]]},{"id":"d2ec14aa.243f88","type":"switch","z":"73798026.159ca","name":"max duration","property":"transactionHasMaxDuration","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":550,"y":640,"wires":[["bec09de8.e2edb"]]},{"id":"f7db6a8.e8b1598","type":"switch","z":"73798026.159ca","name":"switch min weight","property":"transactionHasMinWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":570,"y":680,"wires":[["e0dba4b6.f52e48"]]},{"id":"5ff84905.731338","type":"switch","z":"73798026.159ca","name":"switch minus in","property":"is_minus","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":550,"y":440,"wires":[["7f80f2ce.a62d3c"]]},{"id":"d859f111.dff3d","type":"switch","z":"73798026.159ca","name":"","property":"driver_in","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":890,"y":1080,"wires":[["e9ae3d7b.5f4a7"]]},{"id":"8c539a18.587028","type":"http in","z":"73798026.159ca","name":"","url":"/getWeight2","method":"get","swaggerDoc":"","x":260,"y":1080,"wires":[["86d5d9d9.232278","8051fbe0.6f0ec8","99eeea43.a952a8"]]},{"id":"e9ae3d7b.5f4a7","type":"function","z":"73798026.159ca","name":"driver_in event","func":"msg.event_id = flow.get('event_driver_in');\nmsg.description = 'При зважуванні водій в кабіні. Вага: ' + msg.metadata.weight+\"кг. Номер авто: \"+msg.metadata.truck1+\" \"+msg.metadata.truck2+\" \"+msg.metadata.item_name;\n\nreturn msg;","outputs":1,"noerr":0,"x":1160,"y":1080,"wires":[["73be79dd.4a9f78"]]},{"id":"b841a5bb.c01e78","type":"switch","z":"73798026.159ca","name":"","property":"checkHealth","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":570,"y":940,"wires":[["7c3a6187.97c17"],["4bbaaf69.a512e"]]},{"id":"1d914e99.e06bb1","type":"switch","z":"73798026.159ca","name":"waybill","property":"metadata.waybill","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","outputs":1,"x":750,"y":480,"wires":[["a652b45c.ca7498"]]},{"id":"749ceda3.240be4","type":"socket-io-out","z":"73798026.159ca","name":"socket 4002","event":"d36e64bc.d23ab8","server":"78cfb926.b98d58","x":230,"y":660,"wires":[]},{"id":"25474899.707728","type":"debug","z":"73798026.159ca","name":"Avto 1 weight","active":false,"console":"true","complete":"payload","x":360,"y":500,"wires":[]},{"id":"4fc6583c.ebe568","type":"ui_text","z":"73798026.159ca","group":"c7a6cbb7.d20b88","order":0,"width":0,"height":0,"name":"","label":"Поточна вага праві(Авто 2):","format":"{{msg.payload}}","layout":"row-spread","x":279,"y":694.0000114440918,"wires":[]},{"id":"86d5d9d9.232278","type":"function","z":"73798026.159ca","name":"response","func":"msg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nif(transactionWaybill && transactionWaybill !== msg.req.query.waybill){\n    msg.payload.status = false;    \n}else {\n    msg.payload.status = true;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":1160,"wires":[["d6f47bbd.2a9168","55056caf.1351d4"]]},{"id":"8ea1648f.d66218","type":"function","z":"73798026.159ca","name":"check scale health","func":"var lastcheckHealth = flow.get('checkHealth');\nvar checkHealth = null;\nvar lasttimedata = flow.get('lasttimedata');\n\nvar currenttimedata = new Date();\n\nif ((currenttimedata - lasttimedata) > 20000){\n    checkHealth = false;\n} else {\n    checkHealth = true;\n}\n\nflow.set(\"checkHealth\",checkHealth);\n\nif (lastcheckHealth != checkHealth){\n    msg.checkHealth = checkHealth;\n}else{\n    msg.checkHealth = null;\n}\nmsg.payload = checkHealth;\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":940,"wires":[["b841a5bb.c01e78"]]},{"id":"d6f47bbd.2a9168","type":"http response","z":"73798026.159ca","name":"","x":670,"y":1160,"wires":[]},{"id":"4560743b.252dac","type":"inject","z":"73798026.159ca","name":"","topic":"","payload":"","payloadType":"date","repeat":"6","crontab":"","once":false,"x":230,"y":940,"wires":[["8ea1648f.d66218"]]},{"id":"8e345a3b.b20468","type":"http in","z":"73798026.159ca","name":"","url":"/getSimpleWeight2","method":"get","swaggerDoc":"","x":280,"y":1260,"wires":[["4d0b9a0.0513668"]]},{"id":"4d0b9a0.0513668","type":"function","z":"73798026.159ca","name":"response","func":"msg.payload = flow.get('transactionMetadata').weight;\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":1260,"wires":[["a53daa60.0cdb68"]]},{"id":"a53daa60.0cdb68","type":"http response","z":"73798026.159ca","name":"","x":690,"y":1260,"wires":[]},{"id":"2e944f1f.c383b","type":"http in","z":"73798026.159ca","name":"","url":"/socket2","method":"get","swaggerDoc":"","x":250,"y":1340,"wires":[["6ce96d7a.c896c4"]]},{"id":"b76a4e79.d0737","type":"template","z":"73798026.159ca","name":"socket page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n     \n  <body>\n    <h1><p id='weight'></p></h1>\n    \n     <script>\n    setTimeout(function() {\n       ;(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.io=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_(\"./lib/\")},{\"./lib/\":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_(\"./socket\");module.exports.parser=_dereq_(\"engine.io-parser\")},{\"./socket\":3,\"engine.io-parser\":19}],3:[function(_dereq_,module,exports){(function(global){var transports=_dereq_(\"./transports\");var Emitter=_dereq_(\"component-emitter\");var debug=_dereq_(\"debug\")(\"engine.io-client:socket\");var index=_dereq_(\"indexof\");var parser=_dereq_(\"engine.io-parser\");var parseuri=_dereq_(\"parseuri\");var parsejson=_dereq_(\"parsejson\");var parseqs=_dereq_(\"parseqs\");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&\"object\"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==\"https\"||uri.protocol==\"wss\";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&\"https:\"==location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?\"443\":\"80\"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:\"localhost\");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if(\"string\"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||\"t\";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||[\"polling\",\"websocket\"];this.readyState=\"\";this.writeBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?null:opts.rejectUnauthorized;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}}this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_(\"./transport\");Socket.transports=_dereq_(\"./transports\");Socket.parser=_dereq_(\"engine.io-parser\");Socket.prototype.createTransport=function(name){debug('creating transport \"%s\"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf(\"websocket\")!=-1){transport=\"websocket\"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit(\"error\",\"No transports available\")},0);return}else{transport=this.transports[0]}this.readyState=\"opening\";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug(\"setting transport %s\",transport.name);var self=this;if(this.transport){debug(\"clearing existing transport %s\",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on(\"drain\",function(){self.onDrain()}).on(\"packet\",function(packet){self.onPacket(packet)}).on(\"error\",function(e){self.onError(e)}).on(\"close\",function(){self.onClose(\"transport close\")})};Socket.prototype.probe=function(name){debug('probing transport \"%s\"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport \"%s\" opened',name);transport.send([{type:\"ping\",data:\"probe\"}]);transport.once(\"packet\",function(msg){if(failed)return;if(\"pong\"==msg.type&&\"probe\"==msg.data){debug('probe transport \"%s\" pong',name);self.upgrading=true;self.emit(\"upgrading\",transport);if(!transport)return;Socket.priorWebsocketSuccess=\"websocket\"==transport.name;debug('pausing current transport \"%s\"',self.transport.name);self.transport.pause(function(){if(failed)return;if(\"closed\"==self.readyState)return;debug(\"changing transport and sending upgrade packet\");cleanup();self.setTransport(transport);transport.send([{type:\"upgrade\"}]);self.emit(\"upgrade\",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport \"%s\" failed',name);var err=new Error(\"probe error\");err.transport=transport.name;self.emit(\"upgradeError\",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error(\"probe error: \"+err);error.transport=transport.name;freezeTransport();debug('probe transport \"%s\" failed because of error: %s',name,err);self.emit(\"upgradeError\",error)}function onTransportClose(){onerror(\"transport closed\")}function onclose(){onerror(\"socket closed\")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('\"%s\" works - aborting \"%s\"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener(\"open\",onTransportOpen);transport.removeListener(\"error\",onerror);transport.removeListener(\"close\",onTransportClose);self.removeListener(\"close\",onclose);self.removeListener(\"upgrading\",onupgrade)}transport.once(\"open\",onTransportOpen);transport.once(\"error\",onerror);transport.once(\"close\",onTransportClose);this.once(\"close\",onclose);this.once(\"upgrading\",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug(\"socket open\");this.readyState=\"open\";Socket.priorWebsocketSuccess=\"websocket\"==this.transport.name;this.emit(\"open\");this.flush();if(\"open\"==this.readyState&&this.upgrade&&this.transport.pause){debug(\"starting upgrade probes\");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if(\"opening\"==this.readyState||\"open\"==this.readyState){debug('socket receive: type \"%s\", data \"%s\"',packet.type,packet.data);this.emit(\"packet\",packet);this.emit(\"heartbeat\");switch(packet.type){case\"open\":this.onHandshake(parsejson(packet.data));break;case\"pong\":this.setPing();this.emit(\"pong\");break;case\"error\":var err=new Error(\"server error\");err.code=packet.data;this.onError(err);break;case\"message\":this.emit(\"data\",packet.data);this.emit(\"message\",packet.data);break}}else{debug('packet received with socket readyState \"%s\"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit(\"handshake\",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if(\"closed\"==this.readyState)return;this.setPing();this.removeListener(\"heartbeat\",this.onHeartbeat);this.on(\"heartbeat\",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if(\"closed\"==self.readyState)return;self.onClose(\"ping timeout\")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug(\"writing ping packet - expecting pong within %sms\",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket(\"ping\",function(){self.emit(\"ping\")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit(\"drain\")}else{this.flush()}};Socket.prototype.flush=function(){if(\"closed\"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug(\"flushing %d packets in socket\",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit(\"flush\")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket(\"message\",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if(\"function\"==typeof data){fn=data;data=undefined}if(\"function\"==typeof options){fn=options;options=null}if(\"closing\"==this.readyState||\"closed\"==this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit(\"packetCreate\",packet);this.writeBuffer.push(packet);if(fn)this.once(\"flush\",fn);this.flush()};Socket.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.readyState=\"closing\";var self=this;if(this.writeBuffer.length){this.once(\"drain\",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose(\"forced close\");debug(\"socket closing - telling transport to close\");self.transport.close()}function cleanupAndClose(){self.removeListener(\"upgrade\",cleanupAndClose);self.removeListener(\"upgradeError\",cleanupAndClose);close()}function waitForUpgrade(){self.once(\"upgrade\",cleanupAndClose);self.once(\"upgradeError\",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug(\"socket error %j\",err);Socket.priorWebsocketSuccess=false;this.emit(\"error\",err);this.onClose(\"transport error\",err)};Socket.prototype.onClose=function(reason,desc){if(\"opening\"==this.readyState||\"open\"==this.readyState||\"closing\"==this.readyState){debug('socket close with reason: \"%s\"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners(\"close\");this.transport.close();this.transport.removeAllListeners();this.readyState=\"closed\";this.id=null;this.emit(\"close\",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./transport\":4,\"./transports\":5,\"component-emitter\":15,debug:17,\"engine.io-parser\":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(_dereq_,module,exports){var parser=_dereq_(\"engine.io-parser\");var Emitter=_dereq_(\"component-emitter\");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState=\"\";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type=\"TransportError\";err.description=desc;this.emit(\"error\",err);return this};Transport.prototype.open=function(){if(\"closed\"==this.readyState||\"\"==this.readyState){this.readyState=\"opening\";this.doOpen()}return this};Transport.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if(\"open\"==this.readyState){this.write(packets)}else{throw new Error(\"Transport not open\")}};Transport.prototype.onOpen=function(){this.readyState=\"open\";this.writable=true;this.emit(\"open\")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit(\"packet\",packet)};Transport.prototype.onClose=function(){this.readyState=\"closed\";this.emit(\"close\")}},{\"component-emitter\":15,\"engine.io-parser\":19}],5:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var XHR=_dereq_(\"./polling-xhr\");var JSONP=_dereq_(\"./polling-jsonp\");var websocket=_dereq_(\"./websocket\");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if(\"open\"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error(\"JSONP disabled\");return new JSONP(opts)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling-jsonp\":6,\"./polling-xhr\":7,\"./websocket\":9,\"xmlhttprequest-ssl\":10}],6:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_(\"./polling\");var inherit=_dereq_(\"component-inherit\");module.exports=JSONPPolling;var rNewline=/\\n/g;var rEscapedNewline=/\\\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener(\"beforeunload\",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement(\"script\");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError(\"jsonp poll error\",e)};var insertAt=document.getElementsByTagName(\"script\")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko=\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement(\"iframe\");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement(\"form\");var area=document.createElement(\"textarea\");var id=this.iframeId=\"eio_iframe_\"+this.index;var iframe;form.className=\"socketio\";form.style.position=\"absolute\";form.style.top=\"-1000px\";form.style.left=\"-1000px\";form.target=id;form.method=\"POST\";form.setAttribute(\"accept-charset\",\"utf-8\");area.name=\"d\";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError(\"jsonp polling iframe removal error\",e)}}try{var html='<iframe src=\"javascript:0\" name=\"'+self.iframeId+'\">';iframe=document.createElement(html)}catch(e){iframe=document.createElement(\"iframe\");iframe.name=self.iframeId;iframe.src=\"javascript:0\"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,\"\\\\\\n\");this.area.value=data.replace(rNewline,\"\\\\n\");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==\"complete\"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-inherit\":16}],7:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var Polling=_dereq_(\"./polling\");var Emitter=_dereq_(\"component-emitter\");var inherit=_dereq_(\"component-inherit\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling-xhr\");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}else{this.extraHeaders=opts.extraHeaders}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!==\"string\"&&data!==undefined;var req=this.request({method:\"POST\",data:data,isBinary:isBinary});var self=this;req.on(\"success\",fn);req.on(\"error\",function(err){self.onError(\"xhr post error\",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug(\"xhr poll\");var req=this.request();var self=this;req.on(\"data\",function(data){self.onData(data)});req.on(\"error\",function(err){self.onError(\"xhr poll error\",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||\"GET\";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug(\"xhr open %s: %s\",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){xhr.responseType=\"arraybuffer\"}if(\"POST\"==this.method){try{if(this.isBinary){xhr.setRequestHeader(\"Content-type\",\"application/octet-stream\")}else{xhr.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}}catch(e){}}if(\"withCredentials\"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug(\"xhr data %s\",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit(\"success\");this.cleanup()};Request.prototype.onData=function(data){this.emit(\"data\",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit(\"error\",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if(\"undefined\"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader(\"Content-Type\").split(\";\")[0]}catch(e){}if(contentType===\"application/octet-stream\"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var ui8Arr=new Uint8Array(this.xhr.response);var dataArray=[];for(var idx=0,length=ui8Arr.length;idx<length;idx++){dataArray.push(ui8Arr[idx])}data=String.fromCharCode.apply(null,dataArray)}}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return\"undefined\"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent(\"onunload\",unloadHandler)}else if(global.addEventListener){global.addEventListener(\"beforeunload\",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-emitter\":15,\"component-inherit\":16,debug:17,\"xmlhttprequest-ssl\":10}],8:[function(_dereq_,module,exports){var Transport=_dereq_(\"../transport\");var parseqs=_dereq_(\"parseqs\");var parser=_dereq_(\"engine.io-parser\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling\");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name=\"polling\";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState=\"pausing\";function pause(){debug(\"paused\");self.readyState=\"paused\";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug(\"we are currently polling - waiting to pause\");total++;this.once(\"pollComplete\",function(){debug(\"pre-pause polling complete\");--total||pause()})}if(!this.writable){debug(\"we are currently writing - waiting to pause\");total++;this.once(\"drain\",function(){debug(\"pre-pause writing complete\");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug(\"polling\");this.polling=true;this.doPoll();this.emit(\"poll\")};Polling.prototype.onData=function(data){var self=this;debug(\"polling got data %s\",data);var callback=function(packet,index,total){if(\"opening\"==self.readyState){self.onOpen()}if(\"close\"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if(\"closed\"!=this.readyState){this.polling=false;this.emit(\"pollComplete\");if(\"open\"==this.readyState){this.poll()}else{debug('ignoring poll - transport state \"%s\"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug(\"writing close packet\");self.write([{type:\"close\"}])}if(\"open\"==this.readyState){debug(\"transport open - closing\");close()}else{debug(\"transport not open - deferring close\");this.once(\"open\",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit(\"drain\")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"https\":\"http\";var port=\"\";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&(\"https\"==schema&&this.port!=443||\"http\"==schema&&this.port!=80)){port=\":\"+this.port}if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query}},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,\"xmlhttprequest-ssl\":10,yeast:30}],9:[function(_dereq_,module,exports){(function(global){var Transport=_dereq_(\"../transport\");var parser=_dereq_(\"engine.io-parser\");var parseqs=_dereq_(\"parseqs\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:websocket\");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window===\"undefined\"){try{WebSocket=_dereq_(\"ws\")}catch(e){}}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name=\"websocket\";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}this.ws=BrowserWebSocket?new WebSocket(uri):new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType=\"buffer\"}else{this.ws.binaryType=\"arraybuffer\"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError(\"websocket error\",e)}};if(\"undefined\"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!BrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len=\"string\"==typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(BrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug(\"websocket closed before onclose event\")}--total||done()})})(packets[i])}function done(){self.emit(\"flush\");setTimeout(function(){self.writable=true;self.emit(\"drain\")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!==\"undefined\"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"wss\":\"ws\";var port=\"\";if(this.port&&(\"wss\"==schema&&this.port!=443||\"ws\"==schema&&this.port!=80)){port=\":\"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!(\"__initialize\"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,ws:undefined,yeast:30}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_(\"has-cors\");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if(\"undefined\"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(e){}}}},{\"has-cors\":22}],11:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error(\"after called too many times\")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],12:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],13:[function(_dereq_,module,exports){(function(chars){\"use strict\";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64=\"\";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];\nbase64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+\"=\"}else if(len%3===1){base64=base64.substring(0,base64.length-2)+\"==\"}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]===\"=\"){bufferLength--;if(base64[base64.length-2]===\"=\"){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\")},{}],14:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob([\"hi\"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],15:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],16:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],17:[function(_dereq_,module,exports){exports=module.exports=_dereq_(\"./debug\");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=\"undefined\"!=typeof chrome&&\"undefined\"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"];function useColors(){return\"WebkitAppearance\"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?\"%c\":\"\")+this.namespace+(useColors?\" %c\":\" \")+args[0]+(useColors?\"%c \":\" \")+\"+\"+exports.humanize(this.diff);if(!useColors)return args;var c=\"color: \"+this.color;args=[args[0],c,\"color: inherit\"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if(\"%%\"===match)return;index++;if(\"%c\"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return\"object\"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem(\"debug\")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{\"./debug\":18}],18:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_(\"ms\");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if(\"string\"!==typeof args[0]){args=[\"%o\"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match===\"%%\")return match;index++;var formatter=exports.formatters[format];if(\"function\"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if(\"function\"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||\"\").split(/[\\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\\*/g,\".*?\");if(namespaces[0]===\"-\"){exports.skips.push(new RegExp(\"^\"+namespaces.substr(1)+\"$\"))}else{exports.names.push(new RegExp(\"^\"+namespaces+\"$\"))}}}function disable(){exports.enable(\"\")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:25}],19:[function(_dereq_,module,exports){(function(global){var keys=_dereq_(\"./keys\");var hasBinary=_dereq_(\"has-binary\");var sliceBuffer=_dereq_(\"arraybuffer.slice\");var base64encoder=_dereq_(\"base64-arraybuffer\");var after=_dereq_(\"after\");var utf8=_dereq_(\"utf8\");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:\"error\",data:\"parser error\"};var Blob=_dereq_(\"blob\");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if(\"function\"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if(\"function\"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(\"\"+encoded)};function encodeBase64Object(packet,callback){var message=\"b\"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message=\"b\"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(\",\")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data==\"string\"||data===undefined){if(data.charAt(0)==\"b\"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType===\"blob\"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType===\"blob\"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary==\"function\"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback(\"0:\")}function setLengthHeader(message){return message.length+\":\"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(\"\"))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!=\"string\"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var packet;if(data==\"\"){return callback(err,0,1)}var length=\"\",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(\":\"!=chr){length+=chr}else{if(\"\"==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=\"\"}}if(length!=\"\"){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p===\"string\"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p===\"string\";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded===\"string\"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength=\"\";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg=\"\";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./keys\":20,after:11,\"arraybuffer.slice\":12,\"base64-arraybuffer\":13,blob:14,\"has-binary\":21,utf8:29}],20:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],21:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:24}],22:[function(_dereq_,module,exports){try{module.exports=typeof XMLHttpRequest!==\"undefined\"&&\"withCredentials\"in new XMLHttpRequest}catch(err){module.exports=false}},{}],23:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],24:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)==\"[object Array]\"}},{}],25:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if(\"string\"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=\"\"+str;if(str.length>1e4)return;var match=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||\"ms\").toLowerCase();switch(type){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return n*y;case\"days\":case\"day\":case\"d\":return n*d;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return n*h;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return n*m;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return n*s;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+\"d\";if(ms>=h)return Math.round(ms/h)+\"h\";if(ms>=m)return Math.round(ms/m)+\"m\";if(ms>=s)return Math.round(ms/s)+\"s\";return ms+\"ms\"}function long(ms){return plural(ms,d,\"day\")||plural(ms,h,\"hour\")||plural(ms,m,\"minute\")||plural(ms,s,\"second\")||ms+\" ms\"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+\" \"+name;return Math.ceil(ms/n)+\" \"+name+\"s\"}},{}],26:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\\],:{}\\s]*$/;var rvalidescape=/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\\s*\\[)+/g;var rtrimLeft=/^\\s+/;var rtrimRight=/\\s+$/;module.exports=function parsejson(data){if(\"string\"!=typeof data||!data){return null}data=data.replace(rtrimLeft,\"\").replace(rtrimRight,\"\");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,\"@\").replace(rvalidtokens,\"]\").replace(rvalidbraces,\"\"))){return new Function(\"return \"+data)()}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],27:[function(_dereq_,module,exports){exports.encode=function(obj){var str=\"\";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+=\"&\";str+=encodeURIComponent(i)+\"=\"+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split(\"&\");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split(\"=\");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],28:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;var parts=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];module.exports=function parseuri(str){var src=str,b=str.indexOf(\"[\"),e=str.indexOf(\"]\");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,\";\")+str.substring(e,str.length)}var m=re.exec(str||\"\"),uri={},i=14;while(i--){uri[parts[i]]=m[i]||\"\"}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,\":\");uri.authority=uri.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\");uri.ipv6uri=true}return uri}},{}],29:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports==\"object\"&&exports;var freeModule=typeof module==\"object\"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output=\"\";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error(\"Lone surrogate U+\"+codePoint.toString(16).toUpperCase()+\" is not a scalar value\")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol=\"\";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString=\"\";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error(\"Invalid byte index\")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error(\"Invalid continuation byte\")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error(\"Invalid byte index\")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error(\"Invalid UTF-8 detected\")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:\"2.0.0\",encode:utf8encode,decode:utf8decode};if(typeof define==\"function\"&&typeof define.amd==\"object\"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],30:[function(_dereq_,module,exports){\"use strict\";var alphabet=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded=\"\";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+\".\"+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],31:[function(_dereq_,module,exports){var url=_dereq_(\"./url\");var parser=_dereq_(\"socket.io-parser\");var Manager=_dereq_(\"./manager\");var debug=_dereq_(\"debug\")(\"socket.io-client\");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==\"object\"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts[\"force new connection\"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug(\"ignoring socket cache for %s\",source);io=Manager(source,opts)}else{if(!cache[id]){debug(\"new io instance for %s\",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_(\"./manager\");exports.Socket=_dereq_(\"./socket\")},{\"./manager\":32,\"./socket\":34,\"./url\":35,debug:39,\"socket.io-parser\":47}],32:[function(_dereq_,module,exports){var eio=_dereq_(\"engine.io-client\");var Socket=_dereq_(\"./socket\");var Emitter=_dereq_(\"component-emitter\");var parser=_dereq_(\"socket.io-parser\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:manager\");var indexOf=_dereq_(\"indexof\");var Backoff=_dereq_(\"backo2\");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&\"object\"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||\"/socket.io\";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState=\"closed\";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.engine.id}}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug(\"readyState %s\",this.readyState);if(~this.readyState.indexOf(\"open\"))return this;debug(\"opening %s\",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState=\"opening\";this.skipReconnect=false;var openSub=on(socket,\"open\",function(){self.onopen();fn&&fn()});var errorSub=on(socket,\"error\",function(data){debug(\"connect_error\");self.cleanup();self.readyState=\"closed\";self.emitAll(\"connect_error\",data);if(fn){var err=new Error(\"Connection error\");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug(\"connect attempt will timeout after %d\",timeout);var timer=setTimeout(function(){debug(\"connect attempt timed out after %d\",timeout);openSub.destroy();socket.close();socket.emit(\"error\",\"timeout\");self.emitAll(\"connect_timeout\",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug(\"open\");this.cleanup();this.readyState=\"open\";this.emit(\"open\");var socket=this.engine;this.subs.push(on(socket,\"data\",bind(this,\"ondata\")));this.subs.push(on(socket,\"ping\",bind(this,\"onping\")));this.subs.push(on(socket,\"pong\",bind(this,\"onpong\")));this.subs.push(on(socket,\"error\",bind(this,\"onerror\")));this.subs.push(on(socket,\"close\",bind(this,\"onclose\")));this.subs.push(on(this.decoder,\"decoded\",bind(this,\"ondecoded\")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll(\"ping\")};Manager.prototype.onpong=function(){this.emitAll(\"pong\",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit(\"packet\",packet)};Manager.prototype.onerror=function(err){debug(\"error\",err);this.emitAll(\"error\",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on(\"connecting\",onConnecting);\nsocket.on(\"connect\",function(){socket.id=self.engine.id});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug(\"writing packet %j\",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug(\"cleanup\");var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug(\"disconnect\");this.skipReconnect=true;this.reconnecting=false;if(\"opening\"==this.readyState){this.cleanup()}this.backoff.reset();this.readyState=\"closed\";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug(\"onclose\");this.cleanup();this.backoff.reset();this.readyState=\"closed\";this.emit(\"close\",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug(\"reconnect failed\");this.backoff.reset();this.emitAll(\"reconnect_failed\");this.reconnecting=false}else{var delay=this.backoff.duration();debug(\"will wait %dms before reconnect attempt\",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug(\"attempting reconnect\");self.emitAll(\"reconnect_attempt\",self.backoff.attempts);self.emitAll(\"reconnecting\",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug(\"reconnect attempt error\");self.reconnecting=false;self.reconnect();self.emitAll(\"reconnect_error\",err.data)}else{debug(\"reconnect success\");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll(\"reconnect\",attempt)}},{\"./on\":33,\"./socket\":34,backo2:36,\"component-bind\":37,\"component-emitter\":38,debug:39,\"engine.io-client\":1,indexof:42,\"socket.io-parser\":47}],33:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],34:[function(_dereq_,module,exports){var parser=_dereq_(\"socket.io-parser\");var Emitter=_dereq_(\"component-emitter\");var toArray=_dereq_(\"to-array\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:socket\");var hasBin=_dereq_(\"has-binary\");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,\"open\",bind(this,\"onopen\")),on(io,\"packet\",bind(this,\"onpacket\")),on(io,\"close\",bind(this,\"onclose\"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if(\"open\"==this.io.readyState)this.onopen();this.emit(\"connecting\");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift(\"message\");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if(\"function\"==typeof args[args.length-1]){debug(\"emitting packet with ack id %d\",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug(\"transport is open - connecting\");if(\"/\"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug(\"close (%s)\",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit(\"disconnect\",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit(\"error\",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug(\"emitting event %j\",args);if(null!=packet.id){debug(\"attaching ack callback to event\");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug(\"sending ack %j\",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if(\"function\"==typeof ack){debug(\"calling ack %s with %j\",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug(\"bad ack %s\",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit(\"connect\");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug(\"server disconnect (%s)\",this.nsp);this.destroy();this.onclose(\"io server disconnect\")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug(\"performing disconnect (%s)\",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose(\"io client disconnect\")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{\"./on\":33,\"component-bind\":37,\"component-emitter\":38,debug:39,\"has-binary\":41,\"socket.io-parser\":47,\"to-array\":51}],35:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_(\"parseuri\");var debug=_dereq_(\"debug\")(\"socket.io-client:url\");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+\"//\"+loc.host;if(\"string\"==typeof uri){if(\"/\"==uri.charAt(0)){if(\"/\"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\\/\\//.test(uri)){debug(\"protocol-less url %s\",uri);if(\"undefined\"!=typeof loc){uri=loc.protocol+\"//\"+uri}else{uri=\"https://\"+uri}}debug(\"parse %s\",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port=\"80\"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port=\"443\"}}obj.path=obj.path||\"/\";var ipv6=obj.host.indexOf(\":\")!==-1;var host=ipv6?\"[\"+obj.host+\"]\":obj.host;obj.id=obj.protocol+\"://\"+host+\":\"+obj.port;obj.href=obj.protocol+\"://\"+host+(loc&&loc.port==obj.port?\"\":\":\"+obj.port);return obj}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{debug:39,parseuri:45}],36:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],37:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if(\"string\"==typeof fn)fn=obj[fn];if(\"function\"!=typeof fn)throw new Error(\"bind() requires a function\");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],38:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[\"$\"+event]=this._callbacks[\"$\"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[\"$\"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[\"$\"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[\"$\"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[\"$\"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],39:[function(_dereq_,module,exports){arguments[4][17][0].apply(exports,arguments)},{\"./debug\":40,dup:17}],40:[function(_dereq_,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:44}],41:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON&&\"function\"==typeof obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:43}],42:[function(_dereq_,module,exports){arguments[4][23][0].apply(exports,arguments)},{dup:23}],43:[function(_dereq_,module,exports){arguments[4][24][0].apply(exports,arguments)},{dup:24}],44:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],45:[function(_dereq_,module,exports){arguments[4][28][0].apply(exports,arguments)},{dup:28}],46:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");var isBuf=_dereq_(\"./is-buffer\");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if(\"object\"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&\"object\"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&\"object\"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./is-buffer\":48,isarray:43}],47:[function(_dereq_,module,exports){var debug=_dereq_(\"debug\")(\"socket.io-parser\");var json=_dereq_(\"json3\");var isArray=_dereq_(\"isarray\");var Emitter=_dereq_(\"component-emitter\");var binary=_dereq_(\"./binary\");var isBuf=_dereq_(\"./is-buffer\");exports.protocol=4;exports.types=[\"CONNECT\",\"DISCONNECT\",\"EVENT\",\"BINARY_EVENT\",\"ACK\",\"BINARY_ACK\",\"ERROR\"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug(\"encoding packet %j\",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str=\"\";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+=\"-\"}if(obj.nsp&&\"/\"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=\",\";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=\",\";str+=json.stringify(obj.data)}debug(\"encoded %j as %s\",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if(\"string\"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit(\"decoded\",packet)}}else{this.emit(\"decoded\",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error(\"got binary data when not reconstructing a packet\")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit(\"decoded\",packet)}}}else{throw new Error(\"Unknown type: \"+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf=\"\";while(str.charAt(++i)!=\"-\"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!=\"-\"){throw new Error(\"Illegal attachments\")}p.attachments=Number(buf)}if(\"/\"==str.charAt(i+1)){p.nsp=\"\";while(++i){var c=str.charAt(i);if(\",\"==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp=\"/\"}var next=str.charAt(i+1);if(\"\"!==next&&Number(next)==next){p.id=\"\";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug(\"decoded %s as %j\",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:\"parser error\"}}},{\"./binary\":46,\"./is-buffer\":48,\"component-emitter\":49,debug:39,isarray:43,json3:50}],48:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],49:[function(_dereq_,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],50:[function(_dereq_,module,exports){(function(global){(function(){var isLoader=typeof define===\"function\"&&define.amd;var objectTypes={\"function\":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global==\"object\"&&global;if(freeGlobal&&(freeGlobal[\"global\"]===freeGlobal||freeGlobal[\"window\"]===freeGlobal||freeGlobal[\"self\"]===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root[\"Object\"]());exports||(exports=root[\"Object\"]());var Number=context[\"Number\"]||root[\"Number\"],String=context[\"String\"]||root[\"String\"],Object=context[\"Object\"]||root[\"Object\"],Date=context[\"Date\"]||root[\"Date\"],SyntaxError=context[\"SyntaxError\"]||root[\"SyntaxError\"],TypeError=context[\"TypeError\"]||root[\"TypeError\"],Math=context[\"Math\"]||root[\"Math\"],nativeJSON=context[\"JSON\"]||root[\"JSON\"];if(typeof nativeJSON==\"object\"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name==\"bug-string-char-index\"){isSupported=\"a\"[0]!=\"a\"}else if(name==\"json\"){isSupported=has(\"json-stringify\")&&has(\"json-parse\")}else{var value,serialized='{\"a\":[1,true,false,null,\"\\\\u0000\\\\b\\\\n\\\\f\\\\r\\\\t\"]}';if(name==\"json-stringify\"){var stringify=exports.stringify,stringifySupported=typeof stringify==\"function\"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)===\"0\"&&stringify(new Number)===\"0\"&&stringify(new String)=='\"\"'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)===\"1\"&&stringify([value])==\"[1]\"&&stringify([undef])==\"[null]\"&&stringify(null)==\"null\"&&stringify([undef,getClass,null])==\"[null,null,null]\"&&stringify({a:[value,true,false,null,\"\\x00\\b\\n\\f\\r\t\"]})==serialized&&stringify(null,value)===\"1\"&&stringify([1,2],null,1)==\"[\\n 1,\\n 2\\n]\"&&stringify(new Date(-864e13))=='\"-271821-04-20T00:00:00.000Z\"'&&stringify(new Date(864e13))=='\"+275760-09-13T00:00:00.000Z\"'&&stringify(new Date(-621987552e5))=='\"-000001-01-01T00:00:00.000Z\"'&&stringify(new Date(-1))=='\"1969-12-31T23:59:59.999Z\"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name==\"json-parse\"){var parse=exports.parse;if(typeof parse==\"function\"){try{if(parse(\"0\")===0&&!parse(false)){value=parse(serialized);var parseSupported=value[\"a\"].length==5&&value[\"a\"][0]===1;if(parseSupported){try{parseSupported=!parse('\"\t\"')}catch(exception){}if(parseSupported){try{parseSupported=parse(\"01\")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse(\"1.\")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has(\"json\")){var functionClass=\"[object Function]\",dateClass=\"[object Date]\",numberClass=\"[object Number]\",stringClass=\"[object String]\",arrayClass=\"[object Array]\",booleanClass=\"[object Boolean]\";var charIndexBuggy=has(\"bug-string-char-index\");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=[\"valueOf\",\"toString\",\"toLocaleString\",\"propertyIsEnumerable\",\"isPrototypeOf\",\"hasOwnProperty\",\"constructor\"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!=\"function\"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property==\"prototype\")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property==\"prototype\")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property==\"prototype\")&&isProperty.call(object,property)&&!(isConstructor=property===\"constructor\")){callback(property)}}if(isConstructor||isProperty.call(object,property=\"constructor\")){callback(property)}}}return forEach(object,callback)};if(!has(\"json-stringify\")){var Escapes={92:\"\\\\\\\\\",34:'\\\\\"',8:\"\\\\b\",12:\"\\\\f\",10:\"\\\\n\",13:\"\\\\r\",9:\"\\\\t\"};var leadingZeroes=\"000000\";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix=\"\\\\u00\";var quote=function(value){var result='\"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(\"\"):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'\"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value==\"object\"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,\"toJSON\")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?\"-\":\"+\")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+\"-\"+toPaddedString(2,month+1)+\"-\"+toPaddedString(2,date)+\"T\"+toPaddedString(2,hours)+\":\"+toPaddedString(2,minutes)+\":\"+toPaddedString(2,seconds)+\".\"+toPaddedString(3,milliseconds)+\"Z\"}else{value=null}}else if(typeof value.toJSON==\"function\"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,\"toJSON\"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return\"null\"}className=getClass.call(value);if(className==booleanClass){return\"\"+value}else if(className==numberClass){return value>-1/0&&value<1/0?\"\"+value:\"null\"}else if(className==stringClass){return quote(\"\"+value)}if(typeof value==\"object\"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?\"null\":element)}result=results.length?whitespace?\"[\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"]\":\"[\"+results.join(\",\")+\"]\":\"[]\"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+\":\"+(whitespace?\" \":\"\")+element)}});result=results.length?whitespace?\"{\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"}\":\"{\"+results.join(\",\")+\"}\":\"{}\"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace=\"\",width>10&&(width=10);whitespace.length<width;whitespace+=\" \");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize(\"\",(value={},value[\"\"]=source,value),callback,properties,whitespace,\"\",[])}}if(!has(\"json-parse\")){var fromCharCode=String.fromCharCode;var Unescapes={92:\"\\\\\",34:'\"',47:\"/\",98:\"\\b\",116:\"\t\",110:\"\\n\",102:\"\\f\",114:\"\\r\"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value=\"@\",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode(\"0x\"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)==\"true\"){Index+=4;return true}else if(source.slice(Index,Index+5)==\"false\"){Index+=5;return false}else if(source.slice(Index,Index+4)==\"null\"){Index+=4;return null}abort()}}return\"$\"};var get=function(value){var results,hasMembers;if(value==\"$\"){abort()}if(typeof value==\"string\"){if((charIndexBuggy?value.charAt(0):value[0])==\"@\"){return value.slice(1)}if(value==\"[\"){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"]\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"]\"){abort()}}else{abort()}}if(value==\",\"){abort()}results.push(get(value))}return results}else if(value==\"{\"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"}\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"}\"){abort()}}else{abort()}}if(value==\",\"||typeof value!=\"string\"||(charIndexBuggy?value.charAt(0):value[0])!=\"@\"||lex()!=\":\"){abort()}results[value.slice(1)]=get(lex())\n}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value==\"object\"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=\"\"+source;result=get(lex());if(lex()!=\"$\"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[\"\"]=result,value),\"\",callback):result}}}exports[\"runInContext\"]=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root[\"JSON3\"],isRestored=false;var JSON3=runInContext(root,root[\"JSON3\"]={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root[\"JSON3\"]=previousJSON;nativeJSON=previousJSON=null}return JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],51:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[31])(31)});\n\n    \n      ;var weight = document.getElementById('weight');\n      var socket = io('https://{{ip}}:1882');\n      socket.on('getWeight', function(msg) {\n        weight.innerHTML = msg;\n    \n      }); \n    }, 1000);\n    </script>\n\n  </body>\n</html>\n","x":570,"y":1340,"wires":[["66998bff.68f304"]]},{"id":"66998bff.68f304","type":"http response","z":"73798026.159ca","name":"","x":710,"y":1340,"wires":[]},{"id":"6ce96d7a.c896c4","type":"function","z":"73798026.159ca","name":"set ip","func":"msg.ip = global.get('ip');\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":1340,"wires":[["b76a4e79.d0737"]]},{"id":"d31e61b3.09e5c","type":"ui_chart","z":"73798026.159ca","name":"","group":"2bcc2e47.b16732","order":1,"width":"6","height":"6","label":"Праві(Авто 2)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-20","ymax":"70000","removeOlder":"10","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"x":209.3333740234375,"y":730.3333740234375,"wires":[[],[]]},{"id":"d3fadcd8.4724d","type":"comment","z":"73798026.159ca","name":"Зважування","info":"","x":210,"y":1040,"wires":[]},{"id":"32e9e064.e7d0b","type":"trigger","z":"73798026.159ca","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","name":"","x":360,"y":240,"wires":[["9fa7023d.0d1d6"]]},{"id":"9394ace5.7c2d","type":"switch","z":"73798026.159ca","name":"","property":"transactionHasOverLoad","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":750,"y":380,"wires":[["c76e32cc.5eef7"]]},{"id":"c76e32cc.5eef7","type":"function","z":"73798026.159ca","name":"over_load","func":"msg.event_id = flow.get('event_over_load');\nmsg.description = 'Можливий досип після зважування. Максимальная вага: ' + msg.metadata.transactionMaxWeight + \"кг. Облікова вага: \" + msg.metadata.transactionAccWeight + \"кг.\";\n\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":380,"wires":[["73be79dd.4a9f78"]]},{"id":"fa4da55d.73d4c8","type":"delay","z":"73798026.159ca","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":860,"y":920,"wires":[["73be79dd.4a9f78"]]},{"id":"c3c48dfe.0a44f","type":"delay","z":"73798026.159ca","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":860,"y":960,"wires":[["73be79dd.4a9f78"]]},{"id":"a8dfe523.04c2f8","type":"http in","z":"73798026.159ca","name":"","url":"/get2","method":"get","swaggerDoc":"","x":240,"y":1200,"wires":[["40caaa58.6323a4","99eeea43.a952a8"]]},{"id":"40caaa58.6323a4","type":"function","z":"73798026.159ca","name":"response","func":"msg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nif(transactionWaybill && transactionWaybill !== msg.req.query.reader){\n    msg.payload.status = false;    \n}else {\n    msg.payload.status = true;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":1200,"wires":[["220a5395.1cc79c"]]},{"id":"220a5395.1cc79c","type":"http response","z":"73798026.159ca","name":"","x":650,"y":1200,"wires":[]},{"id":"8b2277d4.3a5c78","type":"comment","z":"73798026.159ca","name":"Сокет, монітор вагів","info":"","x":240,"y":1300,"wires":[]},{"id":"4c6855cb.33e21c","type":"delay","z":"73798026.159ca","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":340,"y":200,"wires":[["489fe388.9f37cc"]]},{"id":"8239ba8b.65bc88","type":"switch","z":"73798026.159ca","name":"","property":"start_timer","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":190,"y":2220,"wires":[["485e730c.d7980c"]]},{"id":"485e730c.d7980c","type":"function","z":"73798026.159ca","name":"logic","func":"var arrayCompare = flow.get(\"arrayCompare\");\nvar count = flow.get(\"count_1\");\nconst delta = global.get('stableDiff');//змінна порівння для стабільності 80 -60 = 20, якщо більше за дельту тоді false\nvar weight = msg.metadata.weight;\nvar prevWeight = msg.metadata.prevWeight;\nvar subWePr = weight - prevWeight;\n//\nvar send1C = true;\n\n//ітерації для перевірки\nvar iteration = global.get('iteration');\n\n\nif(arrayCompare.length == iteration){\n    arrayCompare.forEach((element) => {\n        if(element === false){\n            send1C = false  \n        }        \n    })\n    msg.send1C = send1C;\n    \n    \n    //flow.set(\"arrayCompare\", []);\n    //flow.set(\"start_timer\", false);\n}else {\n    if(subWePr >= 0 && weight > 0){\n        if(subWePr <= delta){\n            arrayCompare.push(true);    \n        }else {\n            arrayCompare.push(false);       \n        }\n    }else if(subWePr < 0 && weight > 0){\n        if(subWePr >= -delta){\n            arrayCompare.push(true);    \n        }else {\n            arrayCompare.push(false);       \n        }    \n    }\n}\n\n\nmsg.subWePr = subWePr;\nflow.set(\"arrayCompare\", arrayCompare);\nmsg.payload = arrayCompare; \nreturn msg;","outputs":1,"noerr":0,"x":310,"y":2220,"wires":[["7ed64b69.e4f944","ec905c26.21133","8140b970.0ff3e8"]]},{"id":"7ed64b69.e4f944","type":"debug","z":"73798026.159ca","name":"false","active":true,"console":false,"complete":"true","x":470,"y":2040,"wires":[]},{"id":"8140b970.0ff3e8","type":"function","z":"73798026.159ca","name":"repeat cycle","func":"var array = msg.payload\n//ітерації\nvar iteration = global.get('iteration');\n\n//повторення циклу якщо принаймні один елемент false\nif(array.length == iteration){\n    array.forEach((element) => {\n        if(element === false){\n            flow.set(\"arrayCompare\",[])\n            flow.set(\"start_timer\", true);\n            return true;\n        }        \n    })\n    return msg;\n}\n","outputs":1,"noerr":0,"x":490,"y":2080,"wires":[["f5a17530.edabd8"]]},{"id":"ec905c26.21133","type":"switch","z":"73798026.159ca","name":"","property":"send1C","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":470,"y":2220,"wires":[["de8d34d6.1489b8","41d590b2.87947"]]},{"id":"f5a17530.edabd8","type":"debug","z":"73798026.159ca","name":"false","active":false,"console":false,"complete":"true","x":650,"y":2080,"wires":[]},{"id":"41d590b2.87947","type":"function","z":"73798026.159ca","name":"send 1C","func":"//формування відповіді\n\nmsg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nmsg.payload.status = true;    \n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id = flow.get('truck_id');\nmsg.payload.device_id = global.get('scale_id_in');\nmsg.payload.reader = flow.get('reader');\n\n//встановлення стабільності\nmsg.payload.stable = true;\n//видалення зайвого\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\n\n    //оновлення змінних для початку нового циклу перевірки\nflow.set(\"arrayCompare\", []);\nflow.set(\"start_timer\", false);\n    \n   //адреса для відправки \nmsg.url = global.get(\"send_1c_url_GetWeight\");   \n\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":2220,"wires":[["3661bb46.091b64","355c3189.8dbdde","cba38d09.3554a","7fd38d2b.613994","b9822198.7d841"]]},{"id":"de8d34d6.1489b8","type":"debug","z":"73798026.159ca","name":"true","active":false,"console":false,"complete":"true","x":630,"y":2300,"wires":[]},{"id":"ee7f0ce2.614f2","type":"function","z":"73798026.159ca","name":"init conf  send 1C","func":"var transactionMetadata = flow.get(\"transactionMetadata\");\nvar currentWeight = transactionMetadata.weight;\nvar filterSend1C  = global.get(\"filterSend1C\"); // омеження ваги для відправки\n\n//if(currentWeight >= filterSend1C){\n    //змінні для перевірки стабільності\n    flow.set(\"count_1\", 0);\n    flow.set(\"start_timer\", true);\n    flow.set(\"arrayCompare\",[]);\n\n//ідентифікатори для відправки ваги\n    var reader = msg.payload.reader;\n    var truck_id = msg.payload.truck_id;\n    flow.set('transactionWaybill',reader);\n    flow.set('reader', reader);\n    flow.set('truck_id', truck_id);\n    \n    //JSON.parse(msg.payload); \n    return msg; \n\n//}","outputs":1,"noerr":0,"x":990,"y":1680,"wires":[["538330c7.8e9e3","b1c17c6.531818","303ba5f7.c9fe9a"]]},{"id":"538330c7.8e9e3","type":"debug","z":"73798026.159ca","name":"1c send Avto 1","active":true,"console":"false","complete":"payload","x":1220,"y":1680,"wires":[]},{"id":"43f82301.a1df5c","type":"comment","z":"73798026.159ca","name":"Отримання мітки і номеру авто","info":"","x":230,"y":1620,"wires":[]},{"id":"3661bb46.091b64","type":"http request","z":"73798026.159ca","name":"","method":"POST","ret":"txt","url":"","tls":"e1dd70f.94c7c9","x":910,"y":2220,"wires":[["b9822198.7d841","bc201274.4ffc8"]]},{"id":"b9822198.7d841","type":"debug","z":"73798026.159ca","name":"true","active":true,"console":false,"complete":"true","x":1090,"y":2260,"wires":[]},{"id":"8276241b.a97c08","type":"trigger","z":"73798026.159ca","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"30","extend":true,"units":"s","reset":"","name":"","x":850,"y":1960,"wires":[["65aeb0bd.4fa31"]]},{"id":"65aeb0bd.4fa31","type":"function","z":"73798026.159ca","name":"send 1C","func":"//формування відповіді\nmsg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nmsg.payload.status = true;    \n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id = flow.get('truck_id');\nmsg.payload.device_id = global.get('scale_id_in');\nmsg.payload.reader = flow.get('reader');\n\n\n\n//видалення завих параметрів\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\n\n//присвоєння стабільності\nmsg.payload.stable = false;\n  \n//оновлення змінних для початку нового циклу перевірки    \nflow.set(\"arrayCompare\", []);\nflow.set(\"start_timer\", false);\n  \n  \n//адреса для відправки  \nmsg.url = global.get(\"send_1c_url_GetWeight\");  \nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":1960,"wires":[["ebcef418.405798","3661bb46.091b64","cba38d09.3554a","7fd38d2b.613994"]]},{"id":"ebcef418.405798","type":"debug","z":"73798026.159ca","name":"","active":true,"console":"false","complete":"false","x":1170,"y":1960,"wires":[]},{"id":"27d8d19.389fd2e","type":"function","z":"73798026.159ca","name":"скидання тригера","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":1960,"wires":[["8276241b.a97c08"]]},{"id":"b1c17c6.531818","type":"link out","z":"73798026.159ca","name":"triger 1.1 W2","links":["fa21d3e6.86794"],"x":1155,"y":1760,"wires":[]},{"id":"fa21d3e6.86794","type":"link in","z":"73798026.159ca","name":"triger 1.1 W2","links":["b1c17c6.531818"],"x":735,"y":1920,"wires":[["8276241b.a97c08"]]},{"id":"355c3189.8dbdde","type":"link out","z":"73798026.159ca","name":"triger 1.2 W2","links":["c285f41c.2e5d88"],"x":755,"y":2180,"wires":[]},{"id":"c285f41c.2e5d88","type":"link in","z":"73798026.159ca","name":"triger 1.2 W1","links":["355c3189.8dbdde"],"x":455,"y":1960,"wires":[["27d8d19.389fd2e"]]},{"id":"1ec2afd3.17608","type":"http in","z":"73798026.159ca","name":"","url":"/getWeightStart2","method":"post","swaggerDoc":"","x":240,"y":1680,"wires":[["47af3b38.886e74","bad68023.3f5f3","50ee73f0.a4ac2c","791a55fd.943f5c","c8192a85.774918","76f2ad90.6c21d4"]]},{"id":"47af3b38.886e74","type":"http response","z":"73798026.159ca","name":"","x":690,"y":1640,"wires":[]},{"id":"32e1d0d7.e5ef5","type":"comment","z":"73798026.159ca","name":"Перевірка на стабільність","info":"","x":450,"y":2180,"wires":[]},{"id":"994a1fd8.7053","type":"comment","z":"73798026.159ca","name":"Не стабільна вага","info":"","x":510,"y":1920,"wires":[]},{"id":"bad68023.3f5f3","type":"debug","z":"73798026.159ca","name":"","active":false,"console":"false","complete":"true","x":690,"y":1720,"wires":[]},{"id":"4a218cd4.2fe404","type":"delay","z":"73798026.159ca","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1380,"y":340,"wires":[["a7626502.94a128"]]},{"id":"6c5dfb39.e8c144","type":"switch","z":"73798026.159ca","name":"","property":"transactionMaxWeight","propertyType":"msg","rules":[{"t":"gt","v":"filterSend1C","vt":"global"}],"checkall":"true","outputs":1,"x":1250,"y":340,"wires":[["4a218cd4.2fe404"]]},{"id":"a7626502.94a128","type":"function","z":"73798026.159ca","name":"send 1C","func":"//формування відповіді\nmsg.payload = msg.metadata;\n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id  = flow.get('truck_id'); \nmsg.payload.device_id = global.get('scale_id_in');\n\n\n//видалення завих параметрів\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\ndelete msg.payload.transactionAccWeight;\ndelete msg.payload.waybill;\ndelete msg.payload.driverInCar;\ndelete msg.payload.transactionOperationName;\n\n\n\n\n//адреса для відправки  \nmsg.url = global.get(\"send_1c_url_GetWeight\");  \nreturn msg;","outputs":1,"noerr":0,"x":1520,"y":340,"wires":[["c25ada13.07e858","a130b2bf.c52d"]]},{"id":"c25ada13.07e858","type":"http request","z":"73798026.159ca","name":"","method":"POST","ret":"txt","url":"","tls":"e1dd70f.94c7c9","x":1690,"y":340,"wires":[["a5969113.0e3","5d8bc19d.6e064","9c2d6a11.940eb8"]]},{"id":"b79a19a5.8d8e18","type":"debug","z":"73798026.159ca","name":"","active":true,"console":"false","complete":"true","x":1930,"y":580,"wires":[]},{"id":"d346914d.3989d","type":"comment","z":"73798026.159ca","name":"Відправка в 1С після зїзду","info":"","x":1320,"y":300,"wires":[]},{"id":"66f33804.f81228","type":"function","z":"73798026.159ca","name":"sid","func":"//let sid = msg.payload.sid;\n//msg.sid = sid;\n\n//let sid = msg.payload.sid;\nlet sid = global.get('sidG');\nmsg.sid = sid;\n\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":720,"wires":[["4311aa4a.074264"]]},{"id":"316c874b.cbe758","type":"http request","z":"73798026.159ca","name":"","method":"GET","ret":"bin","url":"","tls":"7eb4a526.3db92c","x":2770,"y":720,"wires":[["734fe4a.afd9a1c","f6523ce6.c8aa3"]]},{"id":"1283efa3.0a276","type":"switch","z":"73798026.159ca","name":"take snapshot","property":"snapshot","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1740,"y":720,"wires":[["84afd09c.f2c9a","eaa9f1f3.418a1"]]},{"id":"734fe4a.afd9a1c","type":"function","z":"73798026.159ca","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in2');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2950,"y":720,"wires":[["2bfb9a7d.6d06f6"]]},{"id":"2bfb9a7d.6d06f6","type":"http request","z":"73798026.159ca","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"5bd22a1d.f94584","x":3160,"y":720,"wires":[["971fc8d7.b26ba8","335456cd.b2e91a"]]},{"id":"a5969113.0e3","type":"function","z":"73798026.159ca","name":"clear truck_id","func":" flow.set('truck_id', \"\");\n flow.set('reader', \"\");\nreturn msg;","outputs":1,"noerr":0,"x":1890,"y":340,"wires":[[]]},{"id":"8260bdee.54eb7","type":"function","z":"73798026.159ca","name":"delete","func":"\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\nflow.set('msg_photo', msg);\nreturn msg;","outputs":1,"noerr":0,"x":2150,"y":720,"wires":[["66f33804.f81228"]]},{"id":"8051fbe0.6f0ec8","type":"debug","z":"73798026.159ca","name":"req","active":true,"console":"false","complete":"true","x":510,"y":1040,"wires":[]},{"id":"55056caf.1351d4","type":"debug","z":"73798026.159ca","name":"res","active":true,"console":"false","complete":"true","x":670,"y":1120,"wires":[]},{"id":"cc53f832.41b7f8","type":"http request","z":"73798026.159ca","name":"","method":"GET","ret":"bin","url":"","tls":"7eb4a526.3db92c","x":2770,"y":780,"wires":[["b785c85d.ee9ae8","f6523ce6.c8aa3"]]},{"id":"b785c85d.ee9ae8","type":"function","z":"73798026.159ca","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in2');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2950,"y":780,"wires":[["d1dd0b54.4430e8"]]},{"id":"d1dd0b54.4430e8","type":"http request","z":"73798026.159ca","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"5bd22a1d.f94584","x":3160,"y":780,"wires":[["971fc8d7.b26ba8","50b84b3a.b73f34"]]},{"id":"be5a43b0.470d","type":"http request","z":"73798026.159ca","name":"","method":"GET","ret":"bin","url":"","tls":"7eb4a526.3db92c","x":2770,"y":840,"wires":[["79a4002c.cd5a4","f6523ce6.c8aa3"]]},{"id":"79a4002c.cd5a4","type":"function","z":"73798026.159ca","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in2');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2950,"y":840,"wires":[["1e10b3b4.bf16dc"]]},{"id":"1e10b3b4.bf16dc","type":"http request","z":"73798026.159ca","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"5bd22a1d.f94584","x":3160,"y":840,"wires":[["971fc8d7.b26ba8"]]},{"id":"4311aa4a.074264","type":"delay","z":"73798026.159ca","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2440,"y":720,"wires":[["f1d77115.63c648"]]},{"id":"f71d6154.418f1","type":"delay","z":"73798026.159ca","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2440,"y":780,"wires":[["52e009cd.f72a98"]]},{"id":"f7650886.dbce38","type":"delay","z":"73798026.159ca","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2430,"y":840,"wires":[["dd5951a5.3f2e8"]]},{"id":"ce3ff39c.c0f4a","type":"comment","z":"73798026.159ca","name":"Зробити фото","info":"","x":1820,"y":680,"wires":[]},{"id":"a116bb30.f7a2a8","type":"ui_text","z":"73798026.159ca","group":"7b3842bd.4285fc","order":0,"width":0,"height":0,"name":"","label":"Стабільність праві(Авто 2):","format":"{{msg.stable}}","layout":"row-spread","x":500,"y":760,"wires":[]},{"id":"343baab6.f16f96","type":"link out","z":"73798026.159ca","name":"зїзд вагів 2","links":["f018a68c.de9788","cf4a7654.c95488"],"x":1375,"y":440,"wires":[]},{"id":"9a76a01f.1d7f6","type":"function","z":"73798026.159ca","name":"Графік стабільності","func":"if(msg.stable === true){\n    msg.payload = 1;\n}else if(msg.stable === false){\n    msg.payload = 0;\n}else{\n    msg.payload = -1;\n}\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":800,"wires":[["3d624d27.20bec2"]]},{"id":"3d624d27.20bec2","type":"ui_chart","z":"73798026.159ca","name":"","group":"5364d6e7.c9f778","order":1,"width":0,"height":0,"label":"Стабільність праві(Авто 2)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-1","ymax":"2","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"x":650,"y":800,"wires":[[],[]]},{"id":"50ee73f0.a4ac2c","type":"delay","z":"73798026.159ca","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"4","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":720,"y":1680,"wires":[["ee7f0ce2.614f2","f9f5d21d.5e798"]]},{"id":"c24e5d5f.c25c2","type":"ui_chart","z":"73798026.159ca","name":"","group":"2bcc2e47.b16732","order":2,"width":0,"height":0,"label":"Заїзд / зїзд праві(Авто 2)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"Заїзд / зїзд ліві","ymin":"-1","ymax":"2","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"x":1010,"y":740,"wires":[[],[]]},{"id":"be1cc059.bb325","type":"function","z":"73798026.159ca","name":"Графік заїзду/зїзду","func":"if(msg.on === true){\n    msg.payload = 1;\n}else if(msg.on === false){\n    msg.payload = -1;\n}else{\n    msg.payload = 0;\n}\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":740,"wires":[["c24e5d5f.c25c2"]]},{"id":"9a6649cc.cf6f48","type":"function","z":"73798026.159ca","name":"Графік Транзакції","func":"msg.payload = msg.transaction;\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":780,"wires":[["5b2fc44.8b1c93c"]]},{"id":"5b2fc44.8b1c93c","type":"ui_chart","z":"73798026.159ca","name":"Транзакція (ліві)","group":"2bcc2e47.b16732","order":2,"width":0,"height":0,"label":"Транзакція праві(Авто 2)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"Транзакція (ліві)","ymin":"0","ymax":"10000000000","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"x":1050,"y":780,"wires":[[],[]]},{"id":"740031d8.35973","type":"ui_text","z":"73798026.159ca","group":"cff4b7fb.603008","order":0,"width":0,"height":0,"name":"","label":"Праві(Авто 2), truck_id","format":"{{msg.payload.truck_id}}","layout":"row-spread","x":370,"y":1800,"wires":[]},{"id":"f39c8b04.696018","type":"ui_text","z":"73798026.159ca","group":"cff4b7fb.603008","order":0,"width":0,"height":0,"name":"","label":"Праві(Авто 2), дата","format":"{{msg.payload}}","layout":"row-spread","x":360,"y":1840,"wires":[]},{"id":"791a55fd.943f5c","type":"function","z":"73798026.159ca","name":"","func":"msg.payload = new Date();\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":1840,"wires":[["f39c8b04.696018"]]},{"id":"c8192a85.774918","type":"function","z":"73798026.159ca","name":"","func":"delete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":1800,"wires":[["740031d8.35973"]]},{"id":"76f2ad90.6c21d4","type":"function","z":"73798026.159ca","name":"","func":"var transactionMetadata = flow.get(\"transactionMetadata\");\nvar currentWeight = transactionMetadata.weight;\nmsg.payload = currentWeight;\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":1880,"wires":[["b45eae15.b68e3"]]},{"id":"b45eae15.b68e3","type":"ui_text","z":"73798026.159ca","group":"cff4b7fb.603008","order":0,"width":0,"height":0,"name":"","label":"Праві(Авто 2), Вага зважування","format":"{{msg.payload}}","layout":"row-spread","x":400,"y":1880,"wires":[]},{"id":"7f18737b.e90abc","type":"ui_chart","z":"73798026.159ca","name":"","group":"b5b65a42.eba3f8","order":0,"width":0,"height":0,"label":"Зважування праві(Авто 2)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-1","ymax":"2","removeOlder":"5","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"x":1510,"y":2060,"wires":[[],[]]},{"id":"303ba5f7.c9fe9a","type":"function","z":"73798026.159ca","name":"Отримав дані","func":"msg.payload = 1;\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":1340,"y":2060,"wires":[["7f18737b.e90abc"]]},{"id":"cba38d09.3554a","type":"function","z":"73798026.159ca","name":"Відправив дані","func":"msg.payload = -1;\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":1340,"y":2100,"wires":[["7f18737b.e90abc"]]},{"id":"120305d4.249e9a","type":"comment","z":"73798026.159ca","name":"Графік автоматичного зважування","info":"","x":1360,"y":2020,"wires":[]},{"id":"3ed76bcf.b04814","type":"inject","z":"73798026.159ca","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1220,"y":440,"wires":[["343baab6.f16f96"]]},{"id":"41e5b654.0561f8","type":"function","z":"73798026.159ca","name":"GET 1C","func":"var reader = msg.payload.reader;\nvar truck_id = msg.payload.truck_id;\n\nmsg.payload = {\n    name:\"GET 1C\",\n    truck_id: truck_id,\n    reader:  reader,\n    date: global.get('date_log')\n};\nreturn msg;","outputs":1,"noerr":0,"x":1600,"y":1200,"wires":[["5ddd1a78.5faf54"]]},{"id":"5ddd1a78.5faf54","type":"file","z":"73798026.159ca","name":"","filename":"/distr/data/right(2_weight_80t)/log_1c.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1900,"y":1200,"wires":[]},{"id":"a4252f70.96f58","type":"function","z":"73798026.159ca","name":"Send 1C","func":"var transactionMetadata = flow.get('transactionMetadata');\n\nvar truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name:\"SEND 1C\",\n    tM:transactionMetadata.weight,\n    truck_id: truck_id,\n    reader:  reader,\n    date: global.get('date_log')\n};\nreturn msg;","outputs":1,"noerr":0,"x":1600,"y":1240,"wires":[["5ddd1a78.5faf54"]]},{"id":"f893f3.00bbac1","type":"function","z":"73798026.159ca","name":"RES 1C","func":"var res = msg.payload;\nmsg.payload = {\n    name:\"RES 1C\",\n    status:msg.statusCode,\n    res:res,\n    date: global.get('date_log')\n};\nreturn msg;","outputs":1,"noerr":0,"x":1600,"y":1280,"wires":[["5ddd1a78.5faf54"]]},{"id":"cc5d10d1.359f6","type":"file","z":"73798026.159ca","name":"","filename":"/distr/data/right(2_weight_80t)/log_1c.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":2100,"y":460,"wires":[]},{"id":"32def3fd.c34e7c","type":"comment","z":"73798026.159ca","name":"Логування запиту зїзд з 1С","info":"","x":1860,"y":400,"wires":[]},{"id":"a130b2bf.c52d","type":"function","z":"73798026.159ca","name":"M_OUT_SEND 1C","func":"var truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name:\"M_OUT_SEND 1C\",\n    truck_id: truck_id,\n    reader:  reader,\n    date: global.get('date_log')\n};\nreturn msg;","outputs":1,"noerr":0,"x":1770,"y":480,"wires":[["cc5d10d1.359f6"]]},{"id":"5d8bc19d.6e064","type":"function","z":"73798026.159ca","name":"M_OUT_RES 1C","func":"var truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name:\"M_OUT_RES 1C\",\n    status:msg.statusCode,\n    date: global.get('date_log')\n};\nreturn msg;","outputs":1,"noerr":0,"x":1770,"y":440,"wires":[["cc5d10d1.359f6"]]},{"id":"971fc8d7.b26ba8","type":"debug","z":"73798026.159ca","name":"","active":true,"console":"false","complete":"false","x":3350,"y":720,"wires":[]},{"id":"84afd09c.f2c9a","type":"delay","z":"73798026.159ca","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1980,"y":720,"wires":[["4ce59971.f885f8"]]},{"id":"3c03e21.dc9ee1e","type":"debug","z":"73798026.159ca","name":"IN device config","active":false,"console":"false","complete":"true","x":940,"y":160,"wires":[]},{"id":"3f07b0a.3bbb85","type":"link out","z":"73798026.159ca","name":"/distr/data/weight_right_2_log.txt W2","links":["6f31de03.a7da7"],"x":195,"y":380,"wires":[]},{"id":"c0347f80.4840e","type":"file","z":"73798026.159ca","name":"","filename":"/distr/data/right(2_weight_80t)/weight_log.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1910,"y":1400,"wires":[]},{"id":"ae8e10da.e65cf","type":"function","z":"73798026.159ca","name":"msg","func":"var weight = msg.payload;\n\nmsg.payload = {\n    weight: weight,\n    date: global.get('date_log'),\n    connect: msg.connect\n};\nreturn msg;","outputs":1,"noerr":0,"x":1610,"y":1400,"wires":[["c0347f80.4840e"]]},{"id":"6f31de03.a7da7","type":"link in","z":"73798026.159ca","name":"get msg log weight 2 out","links":["3f07b0a.3bbb85"],"x":1495,"y":1400,"wires":[["ae8e10da.e65cf"]]},{"id":"4b1d2115.fa00f","type":"comment","z":"73798026.159ca","name":"Відправка ваги на табло після зїзду","info":"","x":1290,"y":400,"wires":[]},{"id":"739fc4af.f2b3ac","type":"comment","z":"73798026.159ca","name":"Відправка події в Скелю","info":"","x":1610,"y":540,"wires":[]},{"id":"2c0d5e29.f34232","type":"comment","z":"73798026.159ca","name":"Подія на підключений/відключений прилад","info":"","x":330,"y":900,"wires":[]},{"id":"a29f41fa.794a3","type":"comment","z":"73798026.159ca","name":"Подія водій на вагах","info":"","x":1160,"y":1040,"wires":[]},{"id":"21df8f5f.79d04","type":"link in","z":"73798026.159ca","name":"автоматичне зважування W2","links":["932c805c.88965"],"x":95,"y":2220,"wires":[["8239ba8b.65bc88"]]},{"id":"cfe29e99.74408","type":"comment","z":"73798026.159ca","name":"Ініціалізація налаштувань","info":"","x":230,"y":80,"wires":[]},{"id":"1c9889e6.2f4586","type":"comment","z":"73798026.159ca","name":"Зчитування налаштувань","info":"","x":230,"y":160,"wires":[]},{"id":"a1e7e0e5.99546","type":"comment","z":"73798026.159ca","name":"Логування ваги","info":"","x":180,"y":340,"wires":[]},{"id":"1cc6df44.570ac1","type":"comment","z":"73798026.159ca","name":"Автоматичне зважування","info":"","x":210,"y":420,"wires":[]},{"id":"932c805c.88965","type":"link out","z":"73798026.159ca","name":"відправка ваги для авто зважування W2","links":["21df8f5f.79d04"],"x":195,"y":460,"wires":[]},{"id":"e40f32d7.e645","type":"comment","z":"73798026.159ca","name":"Автоматичне зважування","info":"","x":290,"y":1580,"wires":[]},{"id":"1356acc9.d6f523","type":"comment","z":"73798026.159ca","name":"Логування при автоматичному зважуванні","info":"","x":1630,"y":1160,"wires":[]},{"id":"f9f5d21d.5e798","type":"link out","z":"73798026.159ca","name":"GET 1C W2","links":["cc061620.1fcb08"],"x":915,"y":1640,"wires":[]},{"id":"7fd38d2b.613994","type":"link out","z":"73798026.159ca","name":"Send 1C W2","links":["27760aaf.78f7b6"],"x":1075,"y":2080,"wires":[]},{"id":"bc201274.4ffc8","type":"link out","z":"73798026.159ca","name":"RES 1C W2","links":["ecc8360f.83f5d8"],"x":1055,"y":2220,"wires":[]},{"id":"cc061620.1fcb08","type":"link in","z":"73798026.159ca","name":"GET 1C W2 out","links":["f9f5d21d.5e798"],"x":1495,"y":1200,"wires":[["41e5b654.0561f8"]]},{"id":"27760aaf.78f7b6","type":"link in","z":"73798026.159ca","name":"Send 1C W2 out","links":["7fd38d2b.613994"],"x":1495,"y":1240,"wires":[["a4252f70.96f58"]]},{"id":"ecc8360f.83f5d8","type":"link in","z":"73798026.159ca","name":"RES 1C W2 out","links":["bc201274.4ffc8"],"x":1495,"y":1280,"wires":[["f893f3.00bbac1"]]},{"id":"4524e71d.f057c8","type":"comment","z":"73798026.159ca","name":"Логування GET 1C","info":"","x":930,"y":1600,"wires":[]},{"id":"20cc4513.20b57a","type":"comment","z":"73798026.159ca","name":"Логування Send 1C","info":"","x":1070,"y":2040,"wires":[]},{"id":"73439a2d.e2d214","type":"comment","z":"73798026.159ca","name":"Логування RES 1C","info":"","x":1070,"y":2180,"wires":[]},{"id":"186fb698.a81129","type":"comment","z":"73798026.159ca","name":"Інформація з 1С при авто. зважуванні","info":"","x":250,"y":1760,"wires":[]},{"id":"91ffeff6.15edc","type":"comment","z":"73798026.159ca","name":"Скидання тригера очікування","info":"","x":780,"y":2140,"wires":[]},{"id":"2566355a.c6eb6a","type":"comment","z":"73798026.159ca","name":"Тригер очікування","info":"Коли вага довго не стабільна відправляєм вагу яка є, \nпри повторні відправці з 1С також скидаєм","x":750,"y":1880,"wires":[]},{"id":"abc8e23e.f6fcc","type":"comment","z":"73798026.159ca","name":"Логування ваги від вагопроцесора","info":"","x":1600,"y":1360,"wires":[]},{"id":"feef80e0.83327","type":"comment","z":"73798026.159ca","name":"Тригер очікування","info":"Коли вага довго не стабільна відправляєм вагу яка є, \nпри повторні відправці з 1С також скидаєм","x":1150,"y":1720,"wires":[]},{"id":"335456cd.b2e91a","type":"function","z":"73798026.159ca","name":"sid","func":"//let sid = msg.payload.sid;\n//msg.sid = sid;\nmsg = flow.get('msg_photo');\n//let sid = msg.payload.sid;\nlet sid = global.get('sidG');\nmsg.sid = sid;\n\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":780,"wires":[["f71d6154.418f1"]]},{"id":"50b84b3a.b73f34","type":"function","z":"73798026.159ca","name":"sid","func":"//let sid = msg.payload.sid;\n//msg.sid = sid;\nmsg = flow.get('msg_photo');\n//let sid = msg.payload.sid;\nlet sid = global.get('sidG');\nmsg.sid = sid;\n\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":840,"wires":[["f7650886.dbce38"]]},{"id":"a9b9387.4d2dcc8","type":"tcp in","z":"415d6a1.76aa494","name":"","server":"server","host":"","port":"4003","datamode":"single","datatype":"utf8","newline":"","topic":"","base64":false,"x":80,"y":200,"wires":[["70727cf6.dc8494","4ddaa48.4d5745c","84a671e1.a3fe1","4cdf8c81.9e6c14","e5e913fc.f4333"]]},{"id":"70727cf6.dc8494","type":"function","z":"415d6a1.76aa494","name":"set last Analys","func":"flow.set('lastAnalys',msg.payload);\nflow.set('barcode',\"\");\nglobal.set('device_id_infratec','1114d36d-6ef4-e468-10c6-25e51f019000');\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":200,"wires":[["3bee0482.d3bf2c"]]},{"id":"3bee0482.d3bf2c","type":"function","z":"415d6a1.76aa494","name":"parse quality","func":"var info = msg.payload;\n\nvar result = info.split(\"\\n\");\n\n\nvar cultura = result[1];\nvar ID = result[3].split(\"~\");\nconst quelity = [...result];\nquelity.splice(0, 7); \nvar filterQuelity = quelity.filter(item => item.length > 6);\n\n\nvar res = {\n    cultura,\n    analysisCounter:ID[4],\n    quelity: filterQuelity.join(',')\n};\n\nmsg.payload = res;\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":200,"wires":[["2617f3d4.34b1ec","c5f2a6e2.19e028","dd5a895b.c5a898"]]},{"id":"e3f2de9.9ad3c2","type":"debug","z":"415d6a1.76aa494","name":"Analysis","active":false,"console":"true","complete":"payload","x":830,"y":240,"wires":[]},{"id":"2617f3d4.34b1ec","type":"json","z":"415d6a1.76aa494","name":"","x":690,"y":240,"wires":[["e3f2de9.9ad3c2"]]},{"id":"1635053.95d18fb","type":"debug","z":"415d6a1.76aa494","name":"Analysis wihout parse","active":false,"console":"true","complete":"payload","x":590,"y":280,"wires":[]},{"id":"4ddaa48.4d5745c","type":"function","z":"415d6a1.76aa494","name":"","func":"msg.payload = {\n    msg:\"\" + msg.payload\n};\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":280,"wires":[["b1c0bf69.4ace8"]]},{"id":"b1c0bf69.4ace8","type":"json","z":"415d6a1.76aa494","name":"","x":390,"y":280,"wires":[["1635053.95d18fb"]]},{"id":"c5f2a6e2.19e028","type":"debug","z":"415d6a1.76aa494","name":"","active":true,"console":"false","complete":"false","x":830,"y":160,"wires":[]},{"id":"84a671e1.a3fe1","type":"function","z":"415d6a1.76aa494","name":"Body message","func":"let send1C = {\n    truck_id: \"\",\n    device_id: global.get('device_id_infratec'),\n    message: msg.payload\n};\n\n msg.payload = send1C;\n msg.url = global.get(\"send_1c_url_quality\");\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":400,"wires":[["4dedcea.f18fe3","874f3e9.ff433c","78512072.935ed"]]},{"id":"78512072.935ed","type":"http request","z":"415d6a1.76aa494","name":"Send","method":"POST","ret":"txt","url":"","tls":"1cf9158.3a16deb","x":570,"y":380,"wires":[["4dedcea.f18fe3"]]},{"id":"874f3e9.ff433c","type":"json","z":"415d6a1.76aa494","name":"","x":570,"y":420,"wires":[["4dedcea.f18fe3"]]},{"id":"4dedcea.f18fe3","type":"debug","z":"415d6a1.76aa494","name":"","active":true,"console":"false","complete":"true","x":750,"y":400,"wires":[]},{"id":"4cdf8c81.9e6c14","type":"debug","z":"415d6a1.76aa494","name":"","active":true,"console":"false","complete":"false","x":290,"y":240,"wires":[]},{"id":"b44d49f8.e42db8","type":"comment","z":"415d6a1.76aa494","name":"send 1c","info":"apiuser\napiuser","x":280,"y":360,"wires":[]},{"id":"8eda80c3.ccfe4","type":"http in","z":"415d6a1.76aa494","name":"","url":"/getQuality","method":"get","swaggerDoc":"","x":200,"y":560,"wires":[["4099faa3.bd4f64"]]},{"id":"9f3d8606.da9b08","type":"http response","z":"415d6a1.76aa494","name":"","x":670,"y":560,"wires":[]},{"id":"4099faa3.bd4f64","type":"function","z":"415d6a1.76aa494","name":"create response","func":"var load = flow.get('load');\nif (load){\n    msg.payload = flow.get('parseQA');    \n    msg.load = true;\n}else{\n    msg.payload = {};\n    msg.load = false;\n}\nmsg.payload.barcode = flow.get('barcode');\nflow.set(\"load\",false);\n\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":560,"wires":[["9f3d8606.da9b08","3ab37e30.5d4b12","f0346d4e.dc76d"]]},{"id":"6de16d65.1d1a94","type":"link out","z":"415d6a1.76aa494","name":"1c request Lab in","links":["a19b205c.ac8c","fd01ac91.ac739"],"x":775,"y":600,"wires":[]},{"id":"3ab37e30.5d4b12","type":"switch","z":"415d6a1.76aa494","name":"","property":"load","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":670,"y":600,"wires":[["6de16d65.1d1a94"]]},{"id":"f0346d4e.dc76d","type":"json","z":"415d6a1.76aa494","name":"","x":670,"y":640,"wires":[["bae996e1.22d858"]]},{"id":"bae996e1.22d858","type":"debug","z":"415d6a1.76aa494","name":"getQuality","active":false,"console":"true","complete":"payload","x":810,"y":640,"wires":[]},{"id":"1b63ccc9.ebf613","type":"switch","z":"38f5b6db.4b422a","name":"","property":"msg.payload.АдресУстройства","propertyType":"jsonata","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"7","vt":"str"},{"t":"eq","v":"8","vt":"str"},{"t":"eq","v":"9","vt":"str"}],"checkall":"true","outputs":9,"x":490,"y":560,"wires":[["dff8a0c4.b617f"],["608f419b.bff21"],["23ace13a.93129e"],["d1f4c9d.6c7bf38"],["4373bedc.3c948"],["37b38de8.83c002"],["3e5529f1.6a9e06"],["335ed36f.62785c"],["2f66ba31.583876"]]},{"id":"cf540102.55356","type":"http in","z":"38f5b6db.4b422a","name":"","url":"/sendOnBoard","method":"post","swaggerDoc":"","x":230,"y":300,"wires":[["dfdee04c.38ca4","84cbe3fd.a7dee","1b63ccc9.ebf613","22140892.6597f8"]]},{"id":"608f419b.bff21","type":"function","z":"38f5b6db.4b422a","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nreturn msg;\n","outputs":"1","noerr":0,"x":980.0000228881836,"y":320,"wires":[["39b8415a.26069e","f93f8043.85396","2bf3033a.753664"]]},{"id":"23ace13a.93129e","type":"function","z":"38f5b6db.4b422a","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nreturn msg;\n","outputs":"1","noerr":0,"x":980.0000228881836,"y":460,"wires":[["1915a85a.b668a8","382e5219.5c7f7e","dcd07e2c.70645"]]},{"id":"d1f4c9d.6c7bf38","type":"function","z":"38f5b6db.4b422a","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nreturn msg;\n","outputs":"1","noerr":0,"x":980.0000228881836,"y":600,"wires":[["e586e0a4.36fe6","c052795d.7a7b28","76ae46e6.adba88","f340794d.1cc65"]]},{"id":"4373bedc.3c948","type":"function","z":"38f5b6db.4b422a","name":"triger logic","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nvar findVesSt_1 = string_1.indexOf('#вес');\nvar findVesSt_2 = string_2.indexOf('#вес');\n\nif(findVesSt_1 > -1 || findVesSt_2 > -1){\n    flow.set('trigerWeight_5', true);\n}else if(findVesSt_1 == -1 && findVesSt_2 == -1){\n    flow.set('trigerWeight_5', false);\n    return msg;\n}\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":1130,"y":1160,"wires":[["560f1bc4.0a53d4","b6886f23.811cd"]]},{"id":"a5836bca.a4f0d8","type":"function","z":"38f5b6db.4b422a","name":"","func":"msg.payload = {\n    \"Строка1\": \"<s1> 1.Очікуємо:\",\n    \"Строка2\": \"<s2> \",\n    \"АдресУстройства\": 1\n}\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":420,"wires":[["1b63ccc9.ebf613","22140892.6597f8"]]},{"id":"dfdee04c.38ca4","type":"http response","z":"38f5b6db.4b422a","name":"","x":490,"y":300,"wires":[]},{"id":"84cbe3fd.a7dee","type":"debug","z":"38f5b6db.4b422a","name":"","active":true,"console":"false","complete":"true","x":490,"y":340,"wires":[]},{"id":"560f1bc4.0a53d4","type":"debug","z":"38f5b6db.4b422a","name":"ліві ваги","active":false,"console":"false","complete":"payload","x":1330,"y":1220,"wires":[]},{"id":"b6886f23.811cd","type":"function","z":"38f5b6db.4b422a","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":1370,"y":1160,"wires":[["3126237a.c06b0c","8fe4e7e1.257a28"]]},{"id":"4fc3117.84fb0f","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":420,"wires":[["a5836bca.a4f0d8"]]},{"id":"8a9d5ba1.046448","type":"function","z":"38f5b6db.4b422a","name":"1р","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_1');\nif(weight || weight === 0){\n    var sendStr = `<s1>  ${weight}`;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1590,"y":1020,"wires":[["67018d06.947434"]]},{"id":"304d6db1.3f8142","type":"function","z":"38f5b6db.4b422a","name":"2р","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_1');\nif(weight || weight === 0){\n    var sendStr = `<s2> `;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1590,"y":1060,"wires":[["cd715cd.c92b5a"]]},{"id":"353e6618.baf0ba","type":"switch","z":"38f5b6db.4b422a","name":"trigerWeight_5","property":"trigerWeight_5","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1280,"y":1020,"wires":[["8a9d5ba1.046448","3fe38dc3.8c8182"]]},{"id":"3fe38dc3.8c8182","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1450,"y":1060,"wires":[["304d6db1.3f8142"]]},{"id":"afd9e5ed.c8d128","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"2","crontab":"","once":false,"x":1090,"y":1020,"wires":[["353e6618.baf0ba"]]},{"id":"f93f8043.85396","type":"function","z":"38f5b6db.4b422a","name":"2р 1","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1160.0000228881836,"y":340,"wires":[["cd89165.3b7c9e8"]]},{"id":"39b8415a.26069e","type":"function","z":"38f5b6db.4b422a","name":"1р 1","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1160.0000228881836,"y":300,"wires":[["e5114f93.35b32"]]},{"id":"382e5219.5c7f7e","type":"function","z":"38f5b6db.4b422a","name":"2р 1","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1160.0000228881836,"y":480,"wires":[["fe7d3dc5.f3493"]]},{"id":"1915a85a.b668a8","type":"function","z":"38f5b6db.4b422a","name":"1р 1","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1160.0000228881836,"y":440,"wires":[["adc2e421.0c7b38"]]},{"id":"c052795d.7a7b28","type":"function","z":"38f5b6db.4b422a","name":"2р 1","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1160.0000228881836,"y":620,"wires":[["11905f38.71d7a1"]]},{"id":"e586e0a4.36fe6","type":"function","z":"38f5b6db.4b422a","name":"1р 1","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1160.0000228881836,"y":580,"wires":[["b77484e8.a27018"]]},{"id":"dff8a0c4.b617f","type":"function","z":"38f5b6db.4b422a","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nreturn msg;\n","outputs":"1","noerr":0,"x":980.0000228881836,"y":180,"wires":[["7a6433c4.e7b85c","a12893d0.4f67a","928ef496.aea4b8"]]},{"id":"397de245.416f0e","type":"tcp out","z":"38f5b6db.4b422a","host":"10.107.21.36","port":"5011","beserver":"client","base64":false,"end":true,"name":"","x":1700,"y":180,"wires":[]},{"id":"a12893d0.4f67a","type":"function","z":"38f5b6db.4b422a","name":"2р 1","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1160.0000228881836,"y":200,"wires":[["f08f1f3e.6877c"]]},{"id":"7a6433c4.e7b85c","type":"function","z":"38f5b6db.4b422a","name":"1р 1","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1160.0000228881836,"y":160,"wires":[["7e254cf3.006684"]]},{"id":"d671ff86.6f88c","type":"comment","z":"38f5b6db.4b422a","name":"Автовигрузка 2","info":"","x":1150.0000228881836,"y":120,"wires":[]},{"id":"bf15e948.4b59f8","type":"comment","z":"38f5b6db.4b422a","name":"Автовигрузка 3","info":"","x":1150.0000228881836,"y":260,"wires":[]},{"id":"6421c740.576268","type":"comment","z":"38f5b6db.4b422a","name":"Автовигрузка 4","info":"","x":1150.0000228881836,"y":400,"wires":[]},{"id":"318ca2d2.48337e","type":"comment","z":"38f5b6db.4b422a","name":"КПП","info":"","x":1120.0000228881836,"y":540,"wires":[]},{"id":"7e254cf3.006684","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1290.0000228881836,"y":160,"wires":[["397de245.416f0e"]]},{"id":"f08f1f3e.6877c","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1290.0000228881836,"y":200,"wires":[["b59899c2.29d91"]]},{"id":"5bedab30.6cd194","type":"tcp out","z":"38f5b6db.4b422a","host":"10.107.21.46","port":"5011","beserver":"client","base64":false,"end":true,"name":"","x":1700,"y":320,"wires":[]},{"id":"e5114f93.35b32","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1290.0000228881836,"y":300,"wires":[["5bedab30.6cd194"]]},{"id":"cd89165.3b7c9e8","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1290.0000228881836,"y":340,"wires":[["3d99f49a.6d733c"]]},{"id":"b14734b1.6bf608","type":"tcp out","z":"38f5b6db.4b422a","host":"10.107.21.47","port":"5011","beserver":"client","base64":false,"end":true,"name":"","x":1700,"y":460,"wires":[]},{"id":"adc2e421.0c7b38","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1290.0000228881836,"y":440,"wires":[["b14734b1.6bf608"]]},{"id":"fe7d3dc5.f3493","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1290.0000228881836,"y":480,"wires":[["bae2ff0e.fe789"]]},{"id":"b77484e8.a27018","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1290.0000228881836,"y":580,"wires":[["7bc157d7.9bff68"]]},{"id":"11905f38.71d7a1","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1290.0000228881836,"y":620,"wires":[["80ea258c.7869b8"]]},{"id":"76ae46e6.adba88","type":"function","z":"38f5b6db.4b422a","name":"3р 1","func":"msg.payload = msg.payload.Строка3;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1160.0000228881836,"y":660,"wires":[["5495b46c.db43ac"]]},{"id":"5495b46c.db43ac","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1290.0000228881836,"y":660,"wires":[["c1ccfd5c.d0dad8"]]},{"id":"8fe4e7e1.257a28","type":"function","z":"38f5b6db.4b422a","name":"2р 1","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1590,"y":1180,"wires":[["4140c40e.5ac89c"]]},{"id":"3126237a.c06b0c","type":"function","z":"38f5b6db.4b422a","name":"1р 1","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1590,"y":1140,"wires":[["36aea6ee.1b117a"]]},{"id":"36aea6ee.1b117a","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1720,"y":1140,"wires":[["b10be59e.084758"]]},{"id":"4140c40e.5ac89c","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1720,"y":1180,"wires":[["9a3ab742.65c718"]]},{"id":"67018d06.947434","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1720,"y":1020,"wires":[["f4258f54.e9be4"]]},{"id":"cd715cd.c92b5a","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1720,"y":1060,"wires":[["b10be59e.084758"]]},{"id":"5fdd5157.9da77","type":"comment","z":"38f5b6db.4b422a","name":"Вагова 1(ліві ваги 60т)","info":"","x":1420,"y":900,"wires":[]},{"id":"1f325801.4ceab8","type":"comment","z":"38f5b6db.4b422a","name":"Відправка ваги по команді #вес","info":"","x":1430,"y":980,"wires":[]},{"id":"37b38de8.83c002","type":"function","z":"38f5b6db.4b422a","name":"triger logic","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nvar findVesSt_1 = string_1.indexOf('#вес');\nvar findVesSt_2 = string_2.indexOf('#вес');\n\nif(findVesSt_1 > -1 || findVesSt_2 > -1){\n    flow.set('trigerWeight_6', true);\n}else if(findVesSt_1 == -1 && findVesSt_2 == -1){\n    flow.set('trigerWeight_6', false);\n    return msg;\n}\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":1110,"y":1580,"wires":[["1d9dc125.eb6f1f","50062af5.00e014"]]},{"id":"1d9dc125.eb6f1f","type":"debug","z":"38f5b6db.4b422a","name":"ліві ваги 2","active":false,"console":"false","complete":"payload","x":1320,"y":1640,"wires":[]},{"id":"50062af5.00e014","type":"function","z":"38f5b6db.4b422a","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":1350,"y":1580,"wires":[["fc8cb2b0.b8f84","c9d5beec.8ffa3"]]},{"id":"dbfe7f2c.ef65c","type":"function","z":"38f5b6db.4b422a","name":"1р","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_1');\nif(weight || weight === 0){\n    var sendStr = `<s1>  ${weight}`;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1570,"y":1440,"wires":[["e869a922.2f5e68"]]},{"id":"bcee5a6e.6fa698","type":"function","z":"38f5b6db.4b422a","name":"2р","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_1');\nif(weight || weight === 0){\n    var sendStr = `<s2> `;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1570,"y":1480,"wires":[["b1586ad9.bb5658"]]},{"id":"25e15c86.bcb364","type":"switch","z":"38f5b6db.4b422a","name":"trigerWeight_6","property":"trigerWeight_6","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1260,"y":1440,"wires":[["dbfe7f2c.ef65c","cf8ef8ad.33d698"]]},{"id":"cf8ef8ad.33d698","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1430,"y":1480,"wires":[["bcee5a6e.6fa698"]]},{"id":"3f837dac.99d582","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"2","crontab":"","once":false,"x":1070,"y":1440,"wires":[["25e15c86.bcb364"]]},{"id":"c9d5beec.8ffa3","type":"function","z":"38f5b6db.4b422a","name":"2р 1","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":1600,"wires":[["3587fa52.3acba6"]]},{"id":"fc8cb2b0.b8f84","type":"function","z":"38f5b6db.4b422a","name":"1р 1","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":1560,"wires":[["4ce58bc4.198c74"]]},{"id":"4ce58bc4.198c74","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1700,"y":1560,"wires":[["2508a58c.9154ca"]]},{"id":"3587fa52.3acba6","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1700,"y":1600,"wires":[["9e742f25.8056e"]]},{"id":"e869a922.2f5e68","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1700,"y":1440,"wires":[["2508a58c.9154ca"]]},{"id":"b1586ad9.bb5658","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1700,"y":1480,"wires":[["3692952b.862692"]]},{"id":"1db58289.eb25fd","type":"comment","z":"38f5b6db.4b422a","name":"Відправка ваги по команді #вес","info":"","x":1450,"y":1400,"wires":[]},{"id":"443996f5.9198a8","type":"comment","z":"38f5b6db.4b422a","name":"Ваги дальні","info":"","x":1949.9999465942383,"y":1068.3332920074463,"wires":[]},{"id":"147bce04.e7e682","type":"comment","z":"38f5b6db.4b422a","name":"Ваги ближні","info":"","x":2166,"y":1470,"wires":[]},{"id":"3b0528e2.5d0908","type":"comment","z":"38f5b6db.4b422a","name":"Текст з 1С","info":"","x":1440,"y":1120,"wires":[]},{"id":"1eba1da9.3f4be2","type":"comment","z":"38f5b6db.4b422a","name":"Текст з 1С","info":"","x":1420,"y":1540,"wires":[]},{"id":"3e5529f1.6a9e06","type":"function","z":"38f5b6db.4b422a","name":"triger logic","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nvar findVesSt_1 = string_1.indexOf('#вес');\nvar findVesSt_2 = string_2.indexOf('#вес');\n\nif(findVesSt_1 > -1 || findVesSt_2 > -1){\n    flow.set('trigerWeight_7', true);\n}else if(findVesSt_1 == -1 && findVesSt_2 == -1){\n    flow.set('trigerWeight_7', false);\n    return msg;\n}\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":1110,"y":2000,"wires":[["199a4b37.12ec95","9bf1cb78.e182e8","4a77fb75.b2ca24"]]},{"id":"199a4b37.12ec95","type":"debug","z":"38f5b6db.4b422a","name":"праві ваги","active":true,"console":"false","complete":"true","x":1320,"y":2060,"wires":[]},{"id":"9bf1cb78.e182e8","type":"function","z":"38f5b6db.4b422a","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":1350,"y":2000,"wires":[["9080f432.7e4058","d750c050.1e429"]]},{"id":"a73b164a.fa7308","type":"function","z":"38f5b6db.4b422a","name":"1р","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_2');\nif(weight || weight === 0){\n    var sendStr = `<s1>  ${weight}`;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1570,"y":1880,"wires":[["4e968636.505218","4a77fb75.b2ca24"]]},{"id":"8d48d363.76d76","type":"function","z":"38f5b6db.4b422a","name":"2р","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_2');\nif(weight || weight === 0){\n    var sendStr = `<s2> `;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1570,"y":1920,"wires":[["7ce76923.df1c18"]]},{"id":"e3758192.292dc","type":"switch","z":"38f5b6db.4b422a","name":"trigerWeight_7","property":"trigerWeight_7","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1260,"y":1880,"wires":[["a73b164a.fa7308","ae7d6180.d18b4"]]},{"id":"ae7d6180.d18b4","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1430,"y":1920,"wires":[["8d48d363.76d76"]]},{"id":"5ed71028.60d62","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"2","crontab":"","once":false,"x":1070,"y":1880,"wires":[["e3758192.292dc"]]},{"id":"d750c050.1e429","type":"function","z":"38f5b6db.4b422a","name":"2р 1","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":2020,"wires":[["a3df9862.ea5b08"]]},{"id":"9080f432.7e4058","type":"function","z":"38f5b6db.4b422a","name":"1р 1","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":1980,"wires":[["f7864004.38ff"]]},{"id":"f7864004.38ff","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1700,"y":1980,"wires":[["128bfbb4.4d9c6c"]]},{"id":"a3df9862.ea5b08","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1700,"y":2020,"wires":[[]]},{"id":"4e968636.505218","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1700,"y":1880,"wires":[["128bfbb4.4d9c6c"]]},{"id":"7ce76923.df1c18","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1700,"y":1920,"wires":[["8d410bd7.0b2ad8"]]},{"id":"52f8e2c1.bf30fc","type":"comment","z":"38f5b6db.4b422a","name":"Відправка ваги по команді #вес","info":"","x":1450,"y":1840,"wires":[]},{"id":"c0fbebde.07f258","type":"comment","z":"38f5b6db.4b422a","name":"Ваги ближні","info":"","x":2198,"y":1904,"wires":[]},{"id":"7b8ad5d3.97a11c","type":"comment","z":"38f5b6db.4b422a","name":"Текст з 1С","info":"","x":1420,"y":1960,"wires":[]},{"id":"6523c4a2.6dd10c","type":"comment","z":"38f5b6db.4b422a","name":"Вагова 2(праві ваги 80т)","info":"","x":1450,"y":1800,"wires":[]},{"id":"335ed36f.62785c","type":"function","z":"38f5b6db.4b422a","name":"triger logic","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nvar findVesSt_1 = string_1.indexOf('#вес');\nvar findVesSt_2 = string_2.indexOf('#вес');\n\nif(findVesSt_1 > -1 || findVesSt_2 > -1){\n    flow.set('trigerWeight_8', true);\n}else if(findVesSt_1 == -1 && findVesSt_2 == -1){\n    flow.set('trigerWeight_8', false);\n    return msg;\n}\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":1110,"y":2340,"wires":[["fd3e933b.c4b4","7ae9b169.9842b"]]},{"id":"fd3e933b.c4b4","type":"debug","z":"38f5b6db.4b422a","name":"праві ваги 2","active":true,"console":"false","complete":"payload","x":1320,"y":2400,"wires":[]},{"id":"7ae9b169.9842b","type":"function","z":"38f5b6db.4b422a","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":1350,"y":2340,"wires":[["7a55067c.1cff58","8304459c.524568"]]},{"id":"6a15103.e5bfef","type":"function","z":"38f5b6db.4b422a","name":"1р","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_2');\nif(weight || weight === 0){\n    var sendStr = `<s1>  ${weight}`;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1570,"y":2220,"wires":[["3ce8dd2c.7ac3f2"]]},{"id":"c76a4176.7dd43","type":"function","z":"38f5b6db.4b422a","name":"2р","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_2');\nif(weight || weight === 0){\n    var sendStr = `<s2> `;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1570,"y":2260,"wires":[["a172fc32.e6c39"]]},{"id":"511dbf22.5c814","type":"switch","z":"38f5b6db.4b422a","name":"trigerWeight_8","property":"trigerWeight_8","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1260,"y":2220,"wires":[["6a15103.e5bfef","8a740c38.7cfe7"]]},{"id":"8a740c38.7cfe7","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1430,"y":2260,"wires":[["c76a4176.7dd43"]]},{"id":"c49aca40.218e98","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"2","crontab":"","once":false,"x":1070,"y":2220,"wires":[["511dbf22.5c814"]]},{"id":"8304459c.524568","type":"function","z":"38f5b6db.4b422a","name":"2р 1","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":2360,"wires":[["84de6642.0db3c8"]]},{"id":"7a55067c.1cff58","type":"function","z":"38f5b6db.4b422a","name":"1р 1","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":2320,"wires":[["2ded39bd.561866"]]},{"id":"89fa44e1.ccfd18","type":"tcp out","z":"38f5b6db.4b422a","host":"10.107.21.29","port":"5011","beserver":"client","base64":false,"end":true,"name":"","x":2371.66650390625,"y":2256.6666412353516,"wires":[]},{"id":"2ded39bd.561866","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1700,"y":2320,"wires":[["89fa44e1.ccfd18"]]},{"id":"84de6642.0db3c8","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1700,"y":2360,"wires":[["32247c49.3b1f34"]]},{"id":"3ce8dd2c.7ac3f2","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1700,"y":2220,"wires":[["89fa44e1.ccfd18"]]},{"id":"a172fc32.e6c39","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1700,"y":2260,"wires":[["89fa44e1.ccfd18"]]},{"id":"bb78024e.09636","type":"comment","z":"38f5b6db.4b422a","name":"Відправка ваги по команді #вес","info":"","x":1450,"y":2180,"wires":[]},{"id":"e41cd561.c6eea8","type":"comment","z":"38f5b6db.4b422a","name":"Ваги дальні","info":"","x":1950,"y":2220,"wires":[]},{"id":"8cb37b48.d91c68","type":"comment","z":"38f5b6db.4b422a","name":"Текст з 1С","info":"","x":1420,"y":2300,"wires":[]},{"id":"2f66ba31.583876","type":"function","z":"38f5b6db.4b422a","name":"triger logic","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nvar findVesSt_1 = string_1.indexOf('#вес');\nvar findVesSt_2 = string_2.indexOf('#вес');\n\nif(findVesSt_1 > -1 || findVesSt_2 > -1){\n    flow.set('trigerWeight_9', true);\n}else if(findVesSt_1 == -1 && findVesSt_2 == -1){\n    flow.set('trigerWeight_9', false);\n    return msg;\n}\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":1116,"y":2780,"wires":[["d71d0a42.1495e8","38956582.a4be8a"]]},{"id":"d71d0a42.1495e8","type":"debug","z":"38f5b6db.4b422a","name":"jd","active":false,"console":"false","complete":"payload","x":1306,"y":2840,"wires":[]},{"id":"38956582.a4be8a","type":"function","z":"38f5b6db.4b422a","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":1356,"y":2780,"wires":[["64c025a6.0f14fc","82881b60.8b0948"]]},{"id":"b05986bf.f2e3d8","type":"function","z":"38f5b6db.4b422a","name":"1р","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_2');\nif(weight || weight === 0){\n    var sendStr = `<s1>  ${weight}`;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1576,"y":2660,"wires":[["26db611.bcb939e"]]},{"id":"78cbbde0.956964","type":"function","z":"38f5b6db.4b422a","name":"2р","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_2');\nif(weight || weight === 0){\n    var sendStr = `<s2> `;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1576,"y":2700,"wires":[["26682b0.f1b32d6"]]},{"id":"94026eb9.8c60f","type":"switch","z":"38f5b6db.4b422a","name":"trigerWeight_9","property":"trigerWeight_9","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1266,"y":2660,"wires":[["b05986bf.f2e3d8","67f45d6.67424a4"]]},{"id":"67f45d6.67424a4","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1436,"y":2700,"wires":[["78cbbde0.956964"]]},{"id":"34f18f4d.e4e8a","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"3","crontab":"","once":false,"x":1076,"y":2660,"wires":[["94026eb9.8c60f"]]},{"id":"82881b60.8b0948","type":"function","z":"38f5b6db.4b422a","name":"2р 1","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1576,"y":2800,"wires":[["57f112a8.b878dc"]]},{"id":"64c025a6.0f14fc","type":"function","z":"38f5b6db.4b422a","name":"1р 1","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":1576,"y":2760,"wires":[["5dc332cf.147bac"]]},{"id":"5dc332cf.147bac","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1706,"y":2760,"wires":[["e283f04f.eb73c"]]},{"id":"57f112a8.b878dc","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1706,"y":2800,"wires":[["73f6a5d0.cbd99c"]]},{"id":"26db611.bcb939e","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1706,"y":2660,"wires":[["e283f04f.eb73c"]]},{"id":"26682b0.f1b32d6","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1706,"y":2700,"wires":[["1e2345.ec0ce4bb"]]},{"id":"ef1215de.4330a8","type":"comment","z":"38f5b6db.4b422a","name":"Відправка ваги по команді #вес","info":"","x":1456,"y":2620,"wires":[]},{"id":"9814f2eb.28114","type":"comment","z":"38f5b6db.4b422a","name":"Ваги дальні","info":"","x":1956,"y":2660,"wires":[]},{"id":"1d2014d5.30706b","type":"comment","z":"38f5b6db.4b422a","name":"Текст з 1С","info":"","x":1426,"y":2740,"wires":[]},{"id":"4ca4ae1b.64515","type":"comment","z":"38f5b6db.4b422a","name":"ЖД ваги","info":"","x":1446,"y":2580,"wires":[]},{"id":"ea933432.53b748","type":"link in","z":"38f5b6db.4b422a","name":"","links":["2b0126bb.3d6a7a"],"x":1035,"y":980,"wires":[["abade6f8.674a38"]]},{"id":"abade6f8.674a38","type":"function","z":"38f5b6db.4b422a","name":"triger logic","func":"flow.set('trigerWeight_5', true);\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":1170,"y":980,"wires":[[]]},{"id":"ec1e5519.02ea98","type":"comment","z":"38f5b6db.4b422a","name":"Зїзд вагів","info":"","x":1080,"y":940,"wires":[]},{"id":"51ec5d93.0bb344","type":"link in","z":"38f5b6db.4b422a","name":"","links":["2b0126bb.3d6a7a"],"x":1035,"y":1400,"wires":[["cd385a67.0cbe18"]]},{"id":"cd385a67.0cbe18","type":"function","z":"38f5b6db.4b422a","name":"triger logic","func":"flow.set('trigerWeight_6', true);\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":1170,"y":1400,"wires":[[]]},{"id":"27b41d77.98f592","type":"comment","z":"38f5b6db.4b422a","name":"Зїзд вагів","info":"","x":1080,"y":1360,"wires":[]},{"id":"f018a68c.de9788","type":"link in","z":"38f5b6db.4b422a","name":"","links":["343baab6.f16f96"],"x":1035,"y":1840,"wires":[["662f99d2.60b5c8"]]},{"id":"662f99d2.60b5c8","type":"function","z":"38f5b6db.4b422a","name":"triger logic","func":"flow.set('trigerWeight_7', true);\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":1170,"y":1840,"wires":[[]]},{"id":"96c77a02.495538","type":"comment","z":"38f5b6db.4b422a","name":"Зїзд вагів","info":"","x":1080,"y":1800,"wires":[]},{"id":"cf4a7654.c95488","type":"link in","z":"38f5b6db.4b422a","name":"","links":["343baab6.f16f96"],"x":1035,"y":2180,"wires":[["45192900.572968"]]},{"id":"45192900.572968","type":"function","z":"38f5b6db.4b422a","name":"triger logic","func":"flow.set('trigerWeight_8', true);\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":1170,"y":2180,"wires":[[]]},{"id":"d085f4b5.dd5848","type":"comment","z":"38f5b6db.4b422a","name":"Зїзд вагів","info":"","x":1080,"y":2140,"wires":[]},{"id":"b3ed8543.9c9198","type":"function","z":"38f5b6db.4b422a","name":"","func":"msg.payload = {\n    \"Строка1\": \"<s1> 1.Очікуємо:\",\n    \"Строка2\": \"<s2> \",\n    \"АдресУстройства\": 5\n}\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":460,"wires":[["1b63ccc9.ebf613"]]},{"id":"160becd1.481003","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":460,"wires":[["b3ed8543.9c9198"]]},{"id":"f33670bf.06569","type":"debug","z":"55db58b3.1c1c98","name":"","active":true,"console":"false","complete":"true","x":1740,"y":620,"wires":[]},{"id":"56b490ed.652f6","type":"file in","z":"415d6a1.76aa494","name":"deivce_config_infratec.json","filename":"deivce_config_infratec.json","format":"utf8","x":1660,"y":180,"wires":[["a8ef1973.7ec988"]]},{"id":"e082d3e1.7ca96","type":"http request","z":"415d6a1.76aa494","name":"EVENTS","method":"POST","ret":"txt","url":"","tls":"1447043e.dce9ec","x":2102,"y":319,"wires":[["74326598.a77e6c"]]},{"id":"b859e23c.cf261","type":"function","z":"415d6a1.76aa494","name":"events payload","func":"var event_id = msg.event_id;\nvar device_id = global.get('device_id_infratec');\n\n\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'devices':[{'id':device_id}],\n    'data':msg.metadata,\n    'description':msg.description\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('event_url');\nmsg.main_host = flow.get('main_host');\nmsg.event_url = flow.get('event_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":1920,"y":320,"wires":[["e082d3e1.7ca96","df35d13c.69e22"]]},{"id":"8d35afac.502eb","type":"inject","z":"415d6a1.76aa494","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1260,"y":520,"wires":[["ef856fb5.e2ebf"]]},{"id":"ef856fb5.e2ebf","type":"function","z":"415d6a1.76aa494","name":"check scale health","func":"var lastcheckHealth = flow.get('checkHealth');\nvar checkHealth = null;\nvar lasttimedata = flow.get('lasttimedata');\n\nvar currenttimedata = new Date();\n\nif ((currenttimedata - lasttimedata) > 3000){\n    checkHealth = false;\n} else {\n    checkHealth = true;\n}\n\nflow.set(\"checkHealth\",checkHealth);\n\nif (lastcheckHealth != checkHealth){\n    msg.checkHealth = checkHealth;\n}else{\n    msg.checkHealth = null;\n}\nmsg.payload = checkHealth;\n\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":520,"wires":[["1a42353f.270a4b"]]},{"id":"d4c0096d.0d3018","type":"function","z":"415d6a1.76aa494","name":"main config","func":"flow.set('checkHealth',null);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1890,"y":220,"wires":[[]]},{"id":"8e5c296a.a44818","type":"inject","z":"415d6a1.76aa494","name":"","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":1250,"y":180,"wires":[["bfd0d55a.114238","a059984.c493968"]]},{"id":"b3ef8a4.3aac978","type":"http request","z":"415d6a1.76aa494","name":"STATE","method":"POST","ret":"txt","url":"","tls":"64b3a67f.195858","x":1750,"y":520,"wires":[["c43e002f.8d2c7"]]},{"id":"1a42353f.270a4b","type":"function","z":"415d6a1.76aa494","name":"device state","func":"msg.payload = {\n    \"state\":msg.payload\n}\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\nmsg.url = flow.get('main_host')+flow.get('state_url')+\"?id=\"+global.get(\"device_id_infratec\");\nreturn msg;","outputs":1,"noerr":0,"x":1610,"y":520,"wires":[["b3ef8a4.3aac978"]]},{"id":"a8ef1973.7ec988","type":"function","z":"415d6a1.76aa494","name":"device config","func":"var device_config = JSON.parse(msg.payload);\n\nflow.set('event_make_quality_id',device_config.event_make_quality_id);\nflow.set('event_read_barcode_id',device_config.event_read_barcode_id);\nflow.set('event_send_to_accsystem_id',device_config.event_send_to_accsystem_id);\nflow.set('event_no_conditional',device_config.event_no_conditional);\nflow.set('main_host',device_config.main_host);\nflow.set('event_url',device_config.event_url);\nflow.set('state_url',device_config.state_url);\nflow.set('snapshot_url',device_config.snapshot_url);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1890,"y":180,"wires":[["8a5f53b9.ad3a9"]]},{"id":"88a92074.80016","type":"http in","z":"415d6a1.76aa494","name":"","url":"/firmware","method":"post","swaggerDoc":"","x":1300,"y":140,"wires":[["efaa459f.e92ee8"]]},{"id":"efaa459f.e92ee8","type":"file","z":"415d6a1.76aa494","name":"deivce_config_infratec.json","filename":"deivce_config_infratec.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":1640,"y":140,"wires":[]},{"id":"ca1c735a.742da","type":"inject","z":"415d6a1.76aa494","name":"DEMO","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":1260,"y":80,"wires":[["416c68ca.732d58"]]},{"id":"416c68ca.732d58","type":"function","z":"415d6a1.76aa494","name":"DEMO Data","func":"var device_config = {\n    'event_make_quality_id':'8B9482814EDB2FC9E055000000000001',\n    'event_read_barcode_id':'8B9482814EDC2FC9E055000000000001',\n    'event_send_to_accsystem_id':'8B9482814EDD2FC9E055000000000001',\n    'event_no_conditional':'8C4D78A0466C7B36E055000000000001',\n    'main_host':'https://10.107.21.150:8443/ords/ettn',\n    'event_url':'/iot_cli/events/log',\n    'state_url':'/iot_cli/device',\n    'snapshot_url':'/iot_cli/events/snapshot'\n}\nmsg.payload = device_config;\n// flow.set('scale_id','80096CB0EFD83B63E0533300000A4334');\n// flow.set('event_move_in_id','80096D9ABE7F68F3E0533300000A6C0D');\n// flow.set('event_move_out_id','80096D9ABE8068F3E0533300000A6C0D');\n// flow.set('event_max_weight_id','85A255F950F9BEF4E0533300000AC45D');\n// flow.set('event_off_id','85A2CC4570292DD1E0533300000A0C94');\n// flow.set('event_on_id', '85A2CC45702A2DD1E0533300000A0C94');\n// flow.set('event_max_duration','8642EE858DE89BAAE0533300000AFCC7');\n// flow.set('main_host','http://prod.apex.rest/ords/ettn');\n// flow.set('event_url','/iot_cli/events/log');\n// flow.set('state_url','/v1/device');\n// flow.set('maxWeight',40000);\n// flow.set('maxDuration',20000);\n// flow.set('checkHealthTimeout',3000);\nreturn msg;\n//http://156.67.53.93:8888/ords/ettn\n//http://skelya.prncp.org/ords/ettn","outputs":1,"noerr":0,"x":1430,"y":80,"wires":[["efaa459f.e92ee8"]]},{"id":"92fab433.82d958","type":"function","z":"415d6a1.76aa494","name":"send quality","func":"msg.event_id = flow.get('event_make_quality_id');\nmsg.description = 'Отримали якість із аналізатору. Номер аналізу: ' + msg.payload.analysisCounter+\". Культура: \" + msg.payload.cultura + \". Якість: \"+msg.payload.quelity;\nmsg.metadata = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":1510,"y":320,"wires":[["b859e23c.cf261"]]},{"id":"c43e002f.8d2c7","type":"debug","z":"415d6a1.76aa494","name":"","active":true,"console":"false","complete":"false","x":1890,"y":520,"wires":[]},{"id":"8a5f53b9.ad3a9","type":"debug","z":"415d6a1.76aa494","name":"","active":false,"console":"false","complete":"payload","x":2050,"y":180,"wires":[]},{"id":"58a8862e.3b3cc8","type":"function","z":"415d6a1.76aa494","name":"read barcode","func":"msg.event_id = flow.get('event_read_barcode_id');\nmsg.description = 'Зчитування штрих-коду: ' + msg.payload.barcode;\nmsg.metadata = msg.payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":1310,"y":360,"wires":[["b859e23c.cf261"]]},{"id":"c9776c37.382a2","type":"function","z":"415d6a1.76aa494","name":"send to 1c","func":"msg.event_id = flow.get('event_send_to_accsystem_id');\nmsg.description = 'Отримання аналізу в 1С: ' + msg.payload.barcode;\nmsg.metadata = {\n    'barcode':msg.payload.barcode\n}\nreturn msg;","outputs":1,"noerr":0,"x":1310,"y":400,"wires":[["b859e23c.cf261"]]},{"id":"e13bdce1.e7c06","type":"switch","z":"415d6a1.76aa494","name":"","property":"isNotConditional","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1570,"y":420,"wires":[["ecc0c389.2c0dc"]]},{"id":"ecc0c389.2c0dc","type":"function","z":"415d6a1.76aa494","name":"send quality","func":"msg.event_id = flow.get('event_no_conditional');\nmsg.description = 'Некодинційня якість. Номер аналізу ' + msg.payload.analysisCounter;\n\nvar payload = {};\nfor (var i = 0; i < msg.notcondition.length; i++){\n    payload = msg.notcondition[i];  \n}\nmsg.metadata = payload;\nreturn msg;","outputs":1,"noerr":0,"x":1710,"y":420,"wires":[["b859e23c.cf261","9c4bf323.c5892"]]},{"id":"9c4bf323.c5892","type":"debug","z":"415d6a1.76aa494","name":"","active":false,"console":"false","complete":"true","x":1890,"y":423,"wires":[]},{"id":"dd5a895b.c5a898","type":"function","z":"415d6a1.76aa494","name":"parse result","func":"// var p = msg.payload;\n\n// var result = {\n//     \"ambietTemperature\":p.ambietTemperature,\n//     \"analysisCounter\":p.analysisCounter,\n//     \"subsample_id\":p.subsample.id,\n//     \"subsample_NrOFSubSamples\":p.subsample.NrOFSubSamples,\n//     \"sampleHash\":p.sampleHash\n// };\n// var notcondition = [];\n// var isNotConditional = false;\n\n// for (var i = 0; i < p.qualities.length; i++){\n    \n//     var valueid = p.qualities[i].id.replace(\" \",\"\"); \n//     var temp_value_name = p.qualities[i].value[0].match(/[a-zA-Z]+/g)[0];\n//     var temp_value = parseFloat(p.qualities[i].value[0].match(/\\d+.\\d+/g));\n//     result[temp_value_name] = temp_value;\n    \n//     var temp_value_min_name = p.qualities[i].minmax[0].match(/[a-zA-Z]+/g)[0];\n//     var temp_value_min = parseFloat(p.qualities[i].minmax[0].match(/\\d+.\\d+/g)[0]);\n//     // result[temp_value_name+\"_\"+temp_value_min_name] = temp_value_min;\n    \n//     var temp_value_max_name = p.qualities[i].minmax[0].match(/[a-zA-Z]+/g)[1];\n//     var temp_value_max = parseFloat(p.qualities[i].minmax[0].match(/\\d+.\\d+/g)[1]);\n//     // result[temp_value_name+\"_\"+temp_value_max_name] = temp_value_max;\n    \n//     if ((temp_value>temp_value_max) || (temp_value<temp_value_min)){\n//         notcondition.push({\n//             [temp_value_name]:temp_value,\n//             [temp_value_min_name]:temp_value_min,\n//             [temp_value_max_name]:temp_value_max\n//         });\n//         isNotConditional = true;\n//     }\n// }\n// msg.payload = result;\n// msg.notcondition = notcondition;\n// msg.isNotConditional = isNotConditional;\n\nreturn msg;","outputs":1,"noerr":0,"x":1310,"y":320,"wires":[["92fab433.82d958","e13bdce1.e7c06"]]},{"id":"df35d13c.69e22","type":"json","z":"415d6a1.76aa494","name":"","x":2090,"y":280,"wires":[["670a30cb.63c92"]]},{"id":"670a30cb.63c92","type":"debug","z":"415d6a1.76aa494","name":"event","active":true,"console":"true","complete":"payload","x":2220,"y":280,"wires":[]},{"id":"74326598.a77e6c","type":"debug","z":"415d6a1.76aa494","name":"event","active":true,"console":"true","complete":"payload","x":2251,"y":321,"wires":[]},{"id":"bfd0d55a.114238","type":"trigger","z":"415d6a1.76aa494","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","name":"","x":1620,"y":220,"wires":[["d4c0096d.0d3018"]]},{"id":"a059984.c493968","type":"delay","z":"415d6a1.76aa494","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1460,"y":180,"wires":[["56b490ed.652f6"]]},{"id":"fd01ac91.ac739","type":"link in","z":"415d6a1.76aa494","name":"send 1C Infratec","links":["6de16d65.1d1a94"],"x":1195,"y":400,"wires":[["c9776c37.382a2"]]},{"id":"cac5c947.aa4f58","type":"inject","z":"55db58b3.1c1c98","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"x":310,"y":260,"wires":[["bdc08755.d16cf8"]]},{"id":"355192c.321786e","type":"inject","z":"55db58b3.1c1c98","name":"","topic":"","payload":"1000","payloadType":"num","repeat":"","crontab":"","once":false,"x":310,"y":300,"wires":[["bdc08755.d16cf8"]]},{"id":"ce075b22.e27a78","type":"inject","z":"55db58b3.1c1c98","name":"","topic":"","payload":"5000","payloadType":"num","repeat":"","crontab":"","once":false,"x":310,"y":340,"wires":[["bdc08755.d16cf8"]]},{"id":"6ecce6ce.688928","type":"inject","z":"55db58b3.1c1c98","name":"","topic":"","payload":"500","payloadType":"num","repeat":"","crontab":"","once":false,"x":310,"y":380,"wires":[["bdc08755.d16cf8"]]},{"id":"c3e43514.fb5608","type":"inject","z":"73798026.159ca","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"x":350,"y":300,"wires":[["cbf16f42.f910b"]]},{"id":"9198f324.cd03e","type":"inject","z":"73798026.159ca","name":"","topic":"","payload":"1000","payloadType":"num","repeat":"","crontab":"","once":false,"x":350,"y":340,"wires":[["cbf16f42.f910b"]]},{"id":"f7628bb.0618f78","type":"inject","z":"73798026.159ca","name":"","topic":"","payload":"5000","payloadType":"num","repeat":"","crontab":"","once":false,"x":350,"y":380,"wires":[["cbf16f42.f910b"]]},{"id":"c7f322b2.73799","type":"inject","z":"73798026.159ca","name":"","topic":"","payload":"500","payloadType":"num","repeat":"","crontab":"","once":false,"x":350,"y":420,"wires":[["cbf16f42.f910b"]]},{"id":"a829ecd.284181","type":"inject","z":"73798026.159ca","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":160,"y":2460,"wires":[["88f4db0.cec7028"]]},{"id":"d5e617cb.20f148","type":"http request","z":"73798026.159ca","name":"","method":"POST","ret":"txt","url":"","tls":"4f13272d.e94778","x":450,"y":2460,"wires":[["c84f6b26.50f4d8"]]},{"id":"88f4db0.cec7028","type":"function","z":"73798026.159ca","name":"send 1C","func":"\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id  = 1234; \nmsg.payload.device_id = 1234;\n\n\n\n\n//адреса для відправки  \nmsg.url = global.get(\"send_1c_url_GetWeight\");  \nreturn msg;","outputs":1,"noerr":0,"x":300,"y":2460,"wires":[["d5e617cb.20f148"]]},{"id":"c84f6b26.50f4d8","type":"debug","z":"73798026.159ca","name":"false","active":true,"console":false,"complete":"true","x":610,"y":2460,"wires":[]},{"id":"a51839d2.635968","type":"inject","z":"73798026.159ca","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":2580,"wires":[["1953662e.4f547a"]]},{"id":"aaff0bd4.8a7c28","type":"http request","z":"73798026.159ca","name":"","method":"POST","ret":"txt","url":"","tls":"1de7a4ba.95520b","x":430,"y":2580,"wires":[["d1f2bcc4.eb1f1"]]},{"id":"1953662e.4f547a","type":"function","z":"73798026.159ca","name":"send 1C","func":"\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id  = 1234; \nmsg.payload.device_id = 1234;\n\n\nmsg.httpRequestTimeout = 5000;\n\n//адреса для відправки  \nmsg.url = 'https://10.101.71.7/ONC_ELC_SCAT_TST/hs/PerimeterControl/api/ERFID/RFIDCommandWriteListTags';  \nreturn msg;","outputs":1,"noerr":0,"x":280,"y":2580,"wires":[["aaff0bd4.8a7c28"]]},{"id":"d1f2bcc4.eb1f1","type":"debug","z":"73798026.159ca","name":"false","active":true,"console":false,"complete":"true","x":590,"y":2580,"wires":[]},{"id":"d81ee6ab.fab9b8","type":"function","z":"fdab393b.c717e8","name":"Для поосевого","func":"flow.set('cmd',String.fromCharCode(0)); //текущая команда\n/*\nmsg.payload = \"VER\"  + String.fromCharCode(13)\nmsg.payload = \"VER\"  + String.fromCharCode(10)\nmsg.payload = \"ALL\"  + String.fromCharCode(10)\nmsg.payload = \"ALL\"  + String.fromCharCode(13)\n*/\n\n\nglobal.set('scale_id_jd_1','a828e5d8-0d12-d1bc-dc60-926a1f019000');\nglobal.set('ip','10.107.21.150');\nglobal.set('video_camera_url','');\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":100,"wires":[["9d6a42e7.cbb56"]]},{"id":"629dd218.273fbc","type":"inject","z":"fdab393b.c717e8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":130,"y":100,"wires":[["d81ee6ab.fab9b8"]]},{"id":"8c43686d.f3bfa8","type":"debug","z":"fdab393b.c717e8","name":"","active":false,"console":"false","complete":"false","x":630,"y":100,"wires":[]},{"id":"9d6a42e7.cbb56","type":"function","z":"fdab393b.c717e8","name":"Общий","func":"var p = {\n    'smartScaleURL':'',\n    'smartScaleMethod':'POST',\n    'organizationName':'Сердюковка',\n    'organizationID':'04',\n    'typeOfScale':'IoT',\n    'source':'atom',\n    'scale':'jd1',\n    'dblogin':'atom2',\n    'dbpassword':'123',\n    'log':1,\n    'socketport':'4004',\n    'ip':'10.107.21.150',\n    'inject':String.fromCharCode(0),\n    'parser':function(v){\n           var k1 = v.readInt16LE(1,2)*10;\n           var k2 = v.readInt16LE(3,2)*10;\n           var k3 = v.readInt16LE(5,2)*10;\n           var k4 = v.readInt16LE(7,2)*10;\n           \n          flow.set('w',k1+k2+k3+k4);\n          flow.set('a1',k1+k2);\n          flow.set('a2',k3+k4);\n          flow.set('c', (k1+k2)-(k3+k4));\n           \n          return k1+k2+k3+k4;\n        }\n};\nflow.set('p',p);","outputs":1,"noerr":0,"x":460,"y":100,"wires":[["8c43686d.f3bfa8"]]},{"id":"2b73ea75.8a1ca6","type":"debug","z":"fdab393b.c717e8","name":"","active":true,"console":"false","complete":"true","x":950,"y":280,"wires":[]},{"id":"aad96c39.d665e","type":"function","z":"fdab393b.c717e8","name":"Общий","func":"msg.payload = flow.get('w');\nmsg.weight1 = flow.get('a1');\nmsg.weight2 = flow.get('a2');\nmsg.weight_center = msg.weight1 - msg.weight2;\nmsg.connect = \"is\";\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":240,"wires":[["b780506c.9dad6","2b73ea75.8a1ca6"]]},{"id":"b780506c.9dad6","type":"link out","z":"fdab393b.c717e8","name":"","links":["cf80b956.c3a748","5ca23eea.04903"],"x":915,"y":240,"wires":[]},{"id":"5d014481.53eb5c","type":"function","z":"fdab393b.c717e8","name":"","func":"var payload = msg.payload;\nvar parser = flow.get(\"p\").parser;\nvar currentWeight = parser(payload);\n\nflow.set(\"currentWeight\",parser(payload));\n\nreturn msg;\n","outputs":1,"noerr":0,"x":590,"y":240,"wires":[["aad96c39.d665e"]]},{"id":"58fdc765.a04fe8","type":"tcp request","z":"fdab393b.c717e8","server":"10.107.21.45","port":"9761","out":"count","splitc":"10","name":"","x":380,"y":240,"wires":[["e2af266b.503e58","5d014481.53eb5c"]]},{"id":"834e9dda.cf412","type":"inject","z":"fdab393b.c717e8","name":"cmd step-by-step","topic":"","payload":"cmd","payloadType":"flow","repeat":"","crontab":"","once":false,"x":140,"y":240,"wires":[["58fdc765.a04fe8"]]},{"id":"e30edc64.5b3ef","type":"comment","z":"fdab393b.c717e8","name":"Відправка запиту і приклад відповіді","info":"0: 170\n1: 0x0\n2: 0x0\n3: 0x0\n4: 0x0\n5: 255\n6: 255\n7: 0x0\n8: 0x0\n9: 0xa","x":190,"y":200,"wires":[]},{"id":"5167e025.345a1","type":"function","z":"fdab393b.c717e8","name":"time_rasp","func":"var time = new Date();\nflow.set(\"time_rasp\", time);\n\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":540,"wires":[["4550bb4.a086344"]]},{"id":"8ce0e8d6.14c768","type":"inject","z":"fdab393b.c717e8","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":190,"y":540,"wires":[["5167e025.345a1"]]},{"id":"4550bb4.a086344","type":"function","z":"fdab393b.c717e8","name":"sub time","func":"var weigth_time = flow.get(\"weigth_time\");\nvar time_rasp = flow.get(\"time_rasp\");\nvar timeWait = global.get(\"timeWaitWeight\")\nvar sub = time_rasp - weigth_time;\n//msg.payload = {\n//    sub: time_rasp - weigth_time,\n//    weigth_time: weigth_time,\n//    time_rasp: time_rasp\n//}\n\n    if(sub > timeWait){\n    msg.connect = \"not\";\n    \n    msg.payload = 0;\n    msg.weight1 = 0;\n    msg.weight2 = 0;\n    msg.weight_center = 0;\n    \n    \n    return msg;\n    }\n","outputs":1,"noerr":0,"x":480,"y":540,"wires":[["d36330b7.d9cbe"]]},{"id":"d36330b7.d9cbe","type":"debug","z":"fdab393b.c717e8","name":"","active":false,"console":"false","complete":"false","x":650,"y":540,"wires":[]},{"id":"e2af266b.503e58","type":"function","z":"fdab393b.c717e8","name":"weigth_time","func":"flow.set('weigth_time',new Date());\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":500,"wires":[[]]},{"id":"b5554b09.7d34c8","type":"inject","z":"fdab393b.c717e8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":190,"y":500,"wires":[["e2af266b.503e58"]]},{"id":"d52e55dd.541d58","type":"function","z":"104f345f.4f25ac","name":"move out","func":"msg.event_id = flow.get('event_move_out_id');\nmsg.description = 'Зїзд з ваг. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":460,"wires":[["f160edb4.add99"]]},{"id":"cf80b956.c3a748","type":"link in","z":"104f345f.4f25ac","name":"weight","links":["c0377ed3.f7381","b780506c.9dad6"],"x":35,"y":480,"wires":[["3da41c1a.fde504","ebb0ea7c.668948","739cfcd2.f09d74"]]},{"id":"739cfcd2.f09d74","type":"function","z":"104f345f.4f25ac","name":"main module","func":"var prevWeight = flow.get('prevWeight');\nvar transaction = flow.get('transaction');\nvar transactionData = flow.get('transactionData');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar transactionHasMaxWeight = flow.get('transactionHasMaxWeight');\nvar transactionHasMinWeight = flow.get('transactionHasMinWeight');\nvar transactionHasMaxDuration = flow.get('transactionHasMaxDuration');\nvar waybill = flow.get('transactionWaybill');\nvar weight = msg.payload;\nvar stableSize = 5;\nvar duration = 0;\nvar maxWeight = flow.get('maxWeight');\nvar maxDuration = flow.get('maxDuration');\nvar prevTransaction = transaction;\nvar minWeight = flow.get('minWeight');\nvar minTriggerWeight = flow.get('minTriggerWeight');\n\n//transaction\nif (prevWeight === null){\n    prevWeight = msg.payload;    \n}else{\n    if((prevWeight <= 0) && (weight > 0) && (weight > minTriggerWeight)){\n        //start of transaction\n        transaction = Date.now();\n        msg.on = true;\n        flow.set('transaction',transaction);\n    }else if((prevWeight > 0) && (weight <=0) && (transaction)){\n        //transaction = 0;\n        msg.on = false;\n        transactionData = [];\n        flow.set('transaction',0);\n        flow.set('transactionMaxWeight',null);\n        flow.set('transactionHasMaxWeight',null);\n        flow.set('transactionHasMinWeight',null);\n        flow.set('transactionHasMaxDuration',null);\n        flow.set('transactionWaybill',null);\n        flow.set('transactionMetadata',null);\n    }else if((transaction === null) && (weight>0) && (weight > minTriggerWeight)){\n        transaction = Date.now();\n        flow.set('transaction',transaction);\n    }\n}\n\nmsg.stable = true;\n\nif (transaction > 0){\n    transactionData.push(weight);    \n\n    //stable\n    if(transactionData.length > stableSize+1){\n        var stabletmp = true;\n        for (var i = transactionData.length-1; i > transactionData.length-1-stableSize; i--){\n            if (transactionData[i] !== transactionData[i-1]){\n                stabletmp = false;\n                msg.stable = stabletmp;\n                break;\n            }\n            msg.stable = stabletmp;\n        }\n    }else{\n        msg.stable = false;\n    }\n\n    //duration & transactionMaxWeight\n    duration = (Number(Date.now()) - Number(transaction));\n    if( (weight>transactionMaxWeight) || (transactionMaxWeight === null)){\n        transactionMaxWeight = weight;\n        flow.set(\"transactionMaxWeight\",transactionMaxWeight);\n    }\n    \n    if(!transactionHasMaxWeight && weight > maxWeight){\n        msg.transactionHasMaxWeight = true;\n        flow.set('transactionHasMaxWeight',true);\n    }\n    \n    if(!transactionHasMinWeight && weight < minWeight){\n        msg.transactionHasMinWeight = true;\n        flow.set('transactionHasMinWeight',true);\n    }\n    \n    //max duartion\n    if(!transactionHasMaxDuration && duration > maxDuration){\n        msg.transactionHasMaxDuration = true;\n        flow.set('transactionHasMaxDuration',true);\n    }\n}\n\n//result\nmsg.metadata = {\n    'weight':weight,\n    'prevWeight':prevWeight,\n    'prevTransaction':prevTransaction,\n    'transaction':transaction,\n    'on':msg.on,\n    'transactionDataCount':transactionData.length,\n    'stable':msg.stable,\n    'duration':Math.round(duration/1000),\n    'transactionMaxWeight':transactionMaxWeight,\n    'waybill':waybill,\n    'perimetr':true,\n    'weight1':msg.weight1,\n    'weight2':msg.weight2,\n    'weight_center':msg.weight_center\n}\nflow.set('transactionData',transactionData);\nflow.set('prevWeight',weight);\nflow.set('transactionMetadata',msg.metadata);\nflow.set('lasttimedata', new Date());\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":480,"wires":[["a6367a65.c71278","9bdc0c5.d31c4f","947a2dcc.608f5","1471f197.b1050e","370c271.7db6ad8"]]},{"id":"e71c68b6.19c9d8","type":"function","z":"104f345f.4f25ac","name":"get weight from accounting system","func":"var transactionMetadata = flow.get('transactionMetadata');\nvar buisness_data = msg.req.query;\nmsg.metadata = Object.assign(transactionMetadata,buisness_data);\nmsg.event_id = flow.get('event_get_weight_acc');\ntransactionWaybill = flow.get('transactionWaybill');\nif (!transactionWaybill){\n    flow.set('transactionWaybill',msg.req.query.reader);\n}\nmsg.description = buisness_data.operation_name+'. Зважили в 1С. Поточна вага: ' + msg.metadata.weight+\" Номер вагону: \"+buisness_data.truck1+\" \"+buisness_data.item_name;\nmsg.transactionMetadata = transactionMetadata;\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":960,"wires":[["f160edb4.add99"]]},{"id":"a6367a65.c71278","type":"switch","z":"104f345f.4f25ac","name":"switch move","property":"on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":370,"y":460,"wires":[["e82d699b.e3b408"],["d52e55dd.541d58","f750aca7.88fe5"]]},{"id":"83fef186.2588e","type":"http request","z":"104f345f.4f25ac","name":"EVENTS","method":"POST","ret":"txt","url":"","tls":"a2010731.069d98","x":1200,"y":420,"wires":[["8bf8108f.d9dd3"]]},{"id":"e82d699b.e3b408","type":"function","z":"104f345f.4f25ac","name":"move in","func":"msg.event_id = flow.get('event_move_in_id');\nmsg.description = 'Заїзд на ваги. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":420,"wires":[["f160edb4.add99"]]},{"id":"9bdc0c5.d31c4f","type":"switch","z":"104f345f.4f25ac","name":"switch max weight","property":"transactionHasMaxWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":390,"y":500,"wires":[["5ea8d97f.1158f8"]]},{"id":"5ea8d97f.1158f8","type":"function","z":"104f345f.4f25ac","name":"transactionHasMaxWeight","func":"msg.event_id = flow.get('event_max_weight_id');\nmsg.description = 'Перевищена максимально-допустима вага: ' + msg.metadata.weight;\nmsg.needSnapshot = true;\n\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":500,"wires":[["f160edb4.add99"]]},{"id":"d1c1cd0d.d83c8","type":"inject","z":"104f345f.4f25ac","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":150,"y":740,"wires":[["26942954.d46116"]]},{"id":"26942954.d46116","type":"function","z":"104f345f.4f25ac","name":"check scale health","func":"var lastcheckHealth = flow.get('checkHealth');\nvar checkHealth = null;\nvar lasttimedata = flow.get('lasttimedata');\n\nvar currenttimedata = new Date();\n\nif ((currenttimedata - lasttimedata) > 20000){\n    checkHealth = false;\n} else {\n    checkHealth = true;\n}\n\nflow.set(\"checkHealth\",checkHealth);\n\nif (lastcheckHealth != checkHealth){\n    msg.checkHealth = checkHealth;\n}else{\n    msg.checkHealth = null;\n}\nmsg.payload = checkHealth;\n\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":740,"wires":[["feaf6013.f7507"]]},{"id":"feaf6013.f7507","type":"switch","z":"104f345f.4f25ac","name":"","property":"checkHealth","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":510,"y":740,"wires":[["86f743e3.99a24"],["89c854a4.5d1b28"]]},{"id":"89c854a4.5d1b28","type":"function","z":"104f345f.4f25ac","name":"off","func":"msg.event_id = flow.get('event_off_id');\nmsg.description = 'Прилад відключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":740,"wires":[["f160edb4.add99"]]},{"id":"86f743e3.99a24","type":"function","z":"104f345f.4f25ac","name":"on","func":"msg.event_id = flow.get('event_on_id');\nmsg.description = 'Прилад підключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":700,"wires":[["f160edb4.add99"]]},{"id":"11853a3e.62d046","type":"function","z":"104f345f.4f25ac","name":"main config","func":"flow.set('prevWeight',null);\nflow.set('transaction',null);\nflow.set('transactionData',[]);\nflow.set('transactionMaxWeight',null);\nflow.set('transactionHasMinWeight',null);\nflow.set('transactionHasMaxWeight',null);\nflow.set('transactionHasMaxDuration',null);\nflow.set('lasttimedata', new Date());\nflow.set('checkHealth',null);\nflow.set('transactionWaybill',null);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":530,"y":200,"wires":[[]]},{"id":"6005abef.8f2d64","type":"inject","z":"104f345f.4f25ac","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":110,"y":160,"wires":[["35ed3a75.cdea06","f59d747d.0282b8"]]},{"id":"947a2dcc.608f5","type":"switch","z":"104f345f.4f25ac","name":"max duration","property":"transactionHasMaxDuration","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":370,"y":540,"wires":[["6e942b36.6919e4"]]},{"id":"6e942b36.6919e4","type":"function","z":"104f345f.4f25ac","name":"transaction has max duration","func":"msg.event_id = flow.get('event_max_duration');\nmsg.description = 'Перевищено максимальний час находження на вагах: ' + msg.metadata.duration/1000;\n\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":540,"wires":[["f160edb4.add99"]]},{"id":"d72632cb.dffb7","type":"file","z":"104f345f.4f25ac","name":"deivce_config_jd_1.json","filename":"deivce_config_jd_1.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":570,"y":120,"wires":[]},{"id":"22555fba.a8769","type":"file in","z":"104f345f.4f25ac","name":"deivce_config_jd_1.json","filename":"deivce_config_jd_1.json","format":"utf8","x":570,"y":160,"wires":[["fe0c3bec.9eff88"]]},{"id":"a98d058c.2e2258","type":"inject","z":"104f345f.4f25ac","name":"DEMO","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":120,"y":120,"wires":[["9934c580.0a9ba8"]]},{"id":"9934c580.0a9ba8","type":"function","z":"104f345f.4f25ac","name":"DEMO Data","func":"var device_config = {\n    'event_move_in_id':'80096D9ABE7F68F3E0533300000A6C0D',\n    'event_move_out_id':'80096D9ABE8068F3E0533300000A6C0D',\n    'event_max_weight_id':'85A255F950F9BEF4E0533300000AC45D',\n    'event_off_id':'85A2CC4570292DD1E0533300000A0C94',\n    'event_on_id': '85A2CC45702A2DD1E0533300000A0C94',\n    'event_max_duration':'8642EE858DE89BAAE0533300000AFCC7',\n    'event_fake_traffic':'80096EF60C186574E0533300000ADBA5',\n    'event_get_weight_acc':'800970AC1FDC683CE0533300000AF1B0',\n    'event_min_weight':'875C3EB5C9DD092DE055000000000001',\n    'event_test_connection':'925791CDC4E619BDE055000000000001',\n    'main_host':'https://10.107.21.150:8443/ords/ettn',\n    'camera_url':'',\n    'event_url':'/iot_cli/events/log',\n    'snapshot_events':['80096D9ABE7F68F3E0533300000A6C0D','85A255F950F9BEF4E0533300000AC45D','8642EE858DE89BAAE0533300000AFCC7','800970AC1FDC683CE0533300000AF1B0'],\n    'state_url':'/iot_cli/device',\n    'snapshot_url':'/iot_cli/events/snapshot',\n    'maxWeight':90000,\n    'maxDuration':1200000,\n    'minWeight':0,\n    'checkHealthTimeout':3000,\n    'minTriggerWeight':200\n}\nmsg.payload = device_config;\n// flow.set('scale_id','80096CB0EFD83B63E0533300000A4334');\n// flow.set('event_move_in_id','80096D9ABE7F68F3E0533300000A6C0D');\n// flow.set('event_move_out_id','80096D9ABE8068F3E0533300000A6C0D');\n// flow.set('event_max_weight_id','85A255F950F9BEF4E0533300000AC45D');\n// flow.set('event_off_id','85A2CC4570292DD1E0533300000A0C94');\n// flow.set('event_on_id', '85A2CC45702A2DD1E0533300000A0C94');\n// flow.set('event_max_duration','8642EE858DE89BAAE0533300000AFCC7');\n// flow.set('main_host','http://prod.apex.rest/ords/ettn');\n// flow.set('event_url','/iot_cli/events/log');\n// flow.set('state_url','/v1/device');\n// flow.set('maxWeight',40000);\n// flow.set('maxDuration',20000);\n// flow.set('checkHealthTimeout',3000);\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":120,"wires":[["d72632cb.dffb7"]]},{"id":"3da41c1a.fde504","type":"debug","z":"104f345f.4f25ac","name":"JD 1","active":false,"console":"false","complete":"true","x":150,"y":440,"wires":[]},{"id":"f750aca7.88fe5","type":"switch","z":"104f345f.4f25ac","name":"waybill","property":"metadata.waybill","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","outputs":1,"x":570,"y":380,"wires":[["35c15dff.354ea2"]]},{"id":"35c15dff.354ea2","type":"function","z":"104f345f.4f25ac","name":"move in","func":"msg.event_id = flow.get('event_fake_traffic');\nmsg.description = 'Холостий проїзд по вагам. Тривалість проїзду ' + msg.metadata.duration;\n\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":380,"wires":[[]]},{"id":"55606c73.0ec894","type":"http in","z":"104f345f.4f25ac","name":"","url":"/getWeightjd1","method":"get","swaggerDoc":"","x":170,"y":960,"wires":[["e71c68b6.19c9d8","54eb3533.00421c","cead381d.eb7ee8","4fe7c559.3599cc"]]},{"id":"98a1a929.0cfe58","type":"http response","z":"104f345f.4f25ac","name":"","x":670,"y":1000,"wires":[]},{"id":"54eb3533.00421c","type":"function","z":"104f345f.4f25ac","name":"response","func":"msg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nif(transactionWaybill && transactionWaybill !== msg.req.query.waybill){\n    msg.payload.status = false;    \n}else {\n    msg.payload.status = true;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":1000,"wires":[["98a1a929.0cfe58"]]},{"id":"8bf8108f.d9dd3","type":"debug","z":"104f345f.4f25ac","name":"","active":true,"console":"false","complete":"true","x":1330,"y":420,"wires":[]},{"id":"1471f197.b1050e","type":"switch","z":"104f345f.4f25ac","name":"switch min weight","property":"transactionHasMinWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":390,"y":580,"wires":[["751877d5.ae9998"]]},{"id":"751877d5.ae9998","type":"function","z":"104f345f.4f25ac","name":"transactionHasMinWeight","func":"msg.event_id = flow.get('event_min_weight');\nmsg.description = 'Перевищена мінімально-допустима вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":580,"wires":[["f160edb4.add99"]]},{"id":"6080a004.71ad3","type":"socket-io-out","z":"104f345f.4f25ac","name":"socket 4004","event":"495927f6.e541f8","server":"56ba6d7c.6db594","x":330,"y":620,"wires":[]},{"id":"316c464a.b7ca4a","type":"http in","z":"104f345f.4f25ac","name":"","url":"/getSimpleWeightjd1","method":"get","swaggerDoc":"","x":190,"y":1080,"wires":[["bce467da.546e68"]]},{"id":"bce467da.546e68","type":"function","z":"104f345f.4f25ac","name":"response","func":"msg.payload = flow.get('transactionMetadata').weight;\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":1080,"wires":[["42a8079e.fe19b8"]]},{"id":"42a8079e.fe19b8","type":"http response","z":"104f345f.4f25ac","name":"","x":670,"y":1080,"wires":[]},{"id":"a6054ab0.eca638","type":"http in","z":"104f345f.4f25ac","name":"","url":"/socket_jd_1","method":"get","swaggerDoc":"","x":160,"y":1200,"wires":[["7f216532.c8922c"]]},{"id":"4cba3750.e155c8","type":"template","z":"104f345f.4f25ac","name":"socket page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n     \n  <body>\n    <h1><p id='weight'></p></h1>\n    \n     <script>\n    setTimeout(function() {\n       ;(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.io=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_(\"./lib/\")},{\"./lib/\":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_(\"./socket\");module.exports.parser=_dereq_(\"engine.io-parser\")},{\"./socket\":3,\"engine.io-parser\":19}],3:[function(_dereq_,module,exports){(function(global){var transports=_dereq_(\"./transports\");var Emitter=_dereq_(\"component-emitter\");var debug=_dereq_(\"debug\")(\"engine.io-client:socket\");var index=_dereq_(\"indexof\");var parser=_dereq_(\"engine.io-parser\");var parseuri=_dereq_(\"parseuri\");var parsejson=_dereq_(\"parsejson\");var parseqs=_dereq_(\"parseqs\");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&\"object\"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==\"https\"||uri.protocol==\"wss\";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&\"https:\"==location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?\"443\":\"80\"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:\"localhost\");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if(\"string\"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||\"t\";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||[\"polling\",\"websocket\"];this.readyState=\"\";this.writeBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?null:opts.rejectUnauthorized;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}}this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_(\"./transport\");Socket.transports=_dereq_(\"./transports\");Socket.parser=_dereq_(\"engine.io-parser\");Socket.prototype.createTransport=function(name){debug('creating transport \"%s\"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf(\"websocket\")!=-1){transport=\"websocket\"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit(\"error\",\"No transports available\")},0);return}else{transport=this.transports[0]}this.readyState=\"opening\";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug(\"setting transport %s\",transport.name);var self=this;if(this.transport){debug(\"clearing existing transport %s\",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on(\"drain\",function(){self.onDrain()}).on(\"packet\",function(packet){self.onPacket(packet)}).on(\"error\",function(e){self.onError(e)}).on(\"close\",function(){self.onClose(\"transport close\")})};Socket.prototype.probe=function(name){debug('probing transport \"%s\"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport \"%s\" opened',name);transport.send([{type:\"ping\",data:\"probe\"}]);transport.once(\"packet\",function(msg){if(failed)return;if(\"pong\"==msg.type&&\"probe\"==msg.data){debug('probe transport \"%s\" pong',name);self.upgrading=true;self.emit(\"upgrading\",transport);if(!transport)return;Socket.priorWebsocketSuccess=\"websocket\"==transport.name;debug('pausing current transport \"%s\"',self.transport.name);self.transport.pause(function(){if(failed)return;if(\"closed\"==self.readyState)return;debug(\"changing transport and sending upgrade packet\");cleanup();self.setTransport(transport);transport.send([{type:\"upgrade\"}]);self.emit(\"upgrade\",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport \"%s\" failed',name);var err=new Error(\"probe error\");err.transport=transport.name;self.emit(\"upgradeError\",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error(\"probe error: \"+err);error.transport=transport.name;freezeTransport();debug('probe transport \"%s\" failed because of error: %s',name,err);self.emit(\"upgradeError\",error)}function onTransportClose(){onerror(\"transport closed\")}function onclose(){onerror(\"socket closed\")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('\"%s\" works - aborting \"%s\"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener(\"open\",onTransportOpen);transport.removeListener(\"error\",onerror);transport.removeListener(\"close\",onTransportClose);self.removeListener(\"close\",onclose);self.removeListener(\"upgrading\",onupgrade)}transport.once(\"open\",onTransportOpen);transport.once(\"error\",onerror);transport.once(\"close\",onTransportClose);this.once(\"close\",onclose);this.once(\"upgrading\",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug(\"socket open\");this.readyState=\"open\";Socket.priorWebsocketSuccess=\"websocket\"==this.transport.name;this.emit(\"open\");this.flush();if(\"open\"==this.readyState&&this.upgrade&&this.transport.pause){debug(\"starting upgrade probes\");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if(\"opening\"==this.readyState||\"open\"==this.readyState){debug('socket receive: type \"%s\", data \"%s\"',packet.type,packet.data);this.emit(\"packet\",packet);this.emit(\"heartbeat\");switch(packet.type){case\"open\":this.onHandshake(parsejson(packet.data));break;case\"pong\":this.setPing();this.emit(\"pong\");break;case\"error\":var err=new Error(\"server error\");err.code=packet.data;this.onError(err);break;case\"message\":this.emit(\"data\",packet.data);this.emit(\"message\",packet.data);break}}else{debug('packet received with socket readyState \"%s\"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit(\"handshake\",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if(\"closed\"==this.readyState)return;this.setPing();this.removeListener(\"heartbeat\",this.onHeartbeat);this.on(\"heartbeat\",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if(\"closed\"==self.readyState)return;self.onClose(\"ping timeout\")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug(\"writing ping packet - expecting pong within %sms\",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket(\"ping\",function(){self.emit(\"ping\")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit(\"drain\")}else{this.flush()}};Socket.prototype.flush=function(){if(\"closed\"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug(\"flushing %d packets in socket\",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit(\"flush\")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket(\"message\",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if(\"function\"==typeof data){fn=data;data=undefined}if(\"function\"==typeof options){fn=options;options=null}if(\"closing\"==this.readyState||\"closed\"==this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit(\"packetCreate\",packet);this.writeBuffer.push(packet);if(fn)this.once(\"flush\",fn);this.flush()};Socket.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.readyState=\"closing\";var self=this;if(this.writeBuffer.length){this.once(\"drain\",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose(\"forced close\");debug(\"socket closing - telling transport to close\");self.transport.close()}function cleanupAndClose(){self.removeListener(\"upgrade\",cleanupAndClose);self.removeListener(\"upgradeError\",cleanupAndClose);close()}function waitForUpgrade(){self.once(\"upgrade\",cleanupAndClose);self.once(\"upgradeError\",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug(\"socket error %j\",err);Socket.priorWebsocketSuccess=false;this.emit(\"error\",err);this.onClose(\"transport error\",err)};Socket.prototype.onClose=function(reason,desc){if(\"opening\"==this.readyState||\"open\"==this.readyState||\"closing\"==this.readyState){debug('socket close with reason: \"%s\"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners(\"close\");this.transport.close();this.transport.removeAllListeners();this.readyState=\"closed\";this.id=null;this.emit(\"close\",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./transport\":4,\"./transports\":5,\"component-emitter\":15,debug:17,\"engine.io-parser\":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(_dereq_,module,exports){var parser=_dereq_(\"engine.io-parser\");var Emitter=_dereq_(\"component-emitter\");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState=\"\";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type=\"TransportError\";err.description=desc;this.emit(\"error\",err);return this};Transport.prototype.open=function(){if(\"closed\"==this.readyState||\"\"==this.readyState){this.readyState=\"opening\";this.doOpen()}return this};Transport.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if(\"open\"==this.readyState){this.write(packets)}else{throw new Error(\"Transport not open\")}};Transport.prototype.onOpen=function(){this.readyState=\"open\";this.writable=true;this.emit(\"open\")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit(\"packet\",packet)};Transport.prototype.onClose=function(){this.readyState=\"closed\";this.emit(\"close\")}},{\"component-emitter\":15,\"engine.io-parser\":19}],5:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var XHR=_dereq_(\"./polling-xhr\");var JSONP=_dereq_(\"./polling-jsonp\");var websocket=_dereq_(\"./websocket\");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if(\"open\"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error(\"JSONP disabled\");return new JSONP(opts)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling-jsonp\":6,\"./polling-xhr\":7,\"./websocket\":9,\"xmlhttprequest-ssl\":10}],6:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_(\"./polling\");var inherit=_dereq_(\"component-inherit\");module.exports=JSONPPolling;var rNewline=/\\n/g;var rEscapedNewline=/\\\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener(\"beforeunload\",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement(\"script\");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError(\"jsonp poll error\",e)};var insertAt=document.getElementsByTagName(\"script\")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko=\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement(\"iframe\");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement(\"form\");var area=document.createElement(\"textarea\");var id=this.iframeId=\"eio_iframe_\"+this.index;var iframe;form.className=\"socketio\";form.style.position=\"absolute\";form.style.top=\"-1000px\";form.style.left=\"-1000px\";form.target=id;form.method=\"POST\";form.setAttribute(\"accept-charset\",\"utf-8\");area.name=\"d\";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError(\"jsonp polling iframe removal error\",e)}}try{var html='<iframe src=\"javascript:0\" name=\"'+self.iframeId+'\">';iframe=document.createElement(html)}catch(e){iframe=document.createElement(\"iframe\");iframe.name=self.iframeId;iframe.src=\"javascript:0\"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,\"\\\\\\n\");this.area.value=data.replace(rNewline,\"\\\\n\");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==\"complete\"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-inherit\":16}],7:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var Polling=_dereq_(\"./polling\");var Emitter=_dereq_(\"component-emitter\");var inherit=_dereq_(\"component-inherit\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling-xhr\");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}else{this.extraHeaders=opts.extraHeaders}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!==\"string\"&&data!==undefined;var req=this.request({method:\"POST\",data:data,isBinary:isBinary});var self=this;req.on(\"success\",fn);req.on(\"error\",function(err){self.onError(\"xhr post error\",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug(\"xhr poll\");var req=this.request();var self=this;req.on(\"data\",function(data){self.onData(data)});req.on(\"error\",function(err){self.onError(\"xhr poll error\",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||\"GET\";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug(\"xhr open %s: %s\",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){xhr.responseType=\"arraybuffer\"}if(\"POST\"==this.method){try{if(this.isBinary){xhr.setRequestHeader(\"Content-type\",\"application/octet-stream\")}else{xhr.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}}catch(e){}}if(\"withCredentials\"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug(\"xhr data %s\",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit(\"success\");this.cleanup()};Request.prototype.onData=function(data){this.emit(\"data\",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit(\"error\",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if(\"undefined\"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader(\"Content-Type\").split(\";\")[0]}catch(e){}if(contentType===\"application/octet-stream\"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var ui8Arr=new Uint8Array(this.xhr.response);var dataArray=[];for(var idx=0,length=ui8Arr.length;idx<length;idx++){dataArray.push(ui8Arr[idx])}data=String.fromCharCode.apply(null,dataArray)}}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return\"undefined\"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent(\"onunload\",unloadHandler)}else if(global.addEventListener){global.addEventListener(\"beforeunload\",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-emitter\":15,\"component-inherit\":16,debug:17,\"xmlhttprequest-ssl\":10}],8:[function(_dereq_,module,exports){var Transport=_dereq_(\"../transport\");var parseqs=_dereq_(\"parseqs\");var parser=_dereq_(\"engine.io-parser\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling\");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name=\"polling\";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState=\"pausing\";function pause(){debug(\"paused\");self.readyState=\"paused\";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug(\"we are currently polling - waiting to pause\");total++;this.once(\"pollComplete\",function(){debug(\"pre-pause polling complete\");--total||pause()})}if(!this.writable){debug(\"we are currently writing - waiting to pause\");total++;this.once(\"drain\",function(){debug(\"pre-pause writing complete\");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug(\"polling\");this.polling=true;this.doPoll();this.emit(\"poll\")};Polling.prototype.onData=function(data){var self=this;debug(\"polling got data %s\",data);var callback=function(packet,index,total){if(\"opening\"==self.readyState){self.onOpen()}if(\"close\"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if(\"closed\"!=this.readyState){this.polling=false;this.emit(\"pollComplete\");if(\"open\"==this.readyState){this.poll()}else{debug('ignoring poll - transport state \"%s\"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug(\"writing close packet\");self.write([{type:\"close\"}])}if(\"open\"==this.readyState){debug(\"transport open - closing\");close()}else{debug(\"transport not open - deferring close\");this.once(\"open\",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit(\"drain\")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"https\":\"http\";var port=\"\";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&(\"https\"==schema&&this.port!=443||\"http\"==schema&&this.port!=80)){port=\":\"+this.port}if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query}},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,\"xmlhttprequest-ssl\":10,yeast:30}],9:[function(_dereq_,module,exports){(function(global){var Transport=_dereq_(\"../transport\");var parser=_dereq_(\"engine.io-parser\");var parseqs=_dereq_(\"parseqs\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:websocket\");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window===\"undefined\"){try{WebSocket=_dereq_(\"ws\")}catch(e){}}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name=\"websocket\";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}this.ws=BrowserWebSocket?new WebSocket(uri):new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType=\"buffer\"}else{this.ws.binaryType=\"arraybuffer\"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError(\"websocket error\",e)}};if(\"undefined\"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!BrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len=\"string\"==typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(BrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug(\"websocket closed before onclose event\")}--total||done()})})(packets[i])}function done(){self.emit(\"flush\");setTimeout(function(){self.writable=true;self.emit(\"drain\")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!==\"undefined\"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"wss\":\"ws\";var port=\"\";if(this.port&&(\"wss\"==schema&&this.port!=443||\"ws\"==schema&&this.port!=80)){port=\":\"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!(\"__initialize\"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,ws:undefined,yeast:30}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_(\"has-cors\");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if(\"undefined\"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(e){}}}},{\"has-cors\":22}],11:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error(\"after called too many times\")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],12:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],13:[function(_dereq_,module,exports){(function(chars){\"use strict\";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64=\"\";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];\nbase64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+\"=\"}else if(len%3===1){base64=base64.substring(0,base64.length-2)+\"==\"}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]===\"=\"){bufferLength--;if(base64[base64.length-2]===\"=\"){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\")},{}],14:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob([\"hi\"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],15:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],16:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],17:[function(_dereq_,module,exports){exports=module.exports=_dereq_(\"./debug\");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=\"undefined\"!=typeof chrome&&\"undefined\"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"];function useColors(){return\"WebkitAppearance\"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?\"%c\":\"\")+this.namespace+(useColors?\" %c\":\" \")+args[0]+(useColors?\"%c \":\" \")+\"+\"+exports.humanize(this.diff);if(!useColors)return args;var c=\"color: \"+this.color;args=[args[0],c,\"color: inherit\"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if(\"%%\"===match)return;index++;if(\"%c\"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return\"object\"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem(\"debug\")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{\"./debug\":18}],18:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_(\"ms\");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if(\"string\"!==typeof args[0]){args=[\"%o\"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match===\"%%\")return match;index++;var formatter=exports.formatters[format];if(\"function\"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if(\"function\"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||\"\").split(/[\\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\\*/g,\".*?\");if(namespaces[0]===\"-\"){exports.skips.push(new RegExp(\"^\"+namespaces.substr(1)+\"$\"))}else{exports.names.push(new RegExp(\"^\"+namespaces+\"$\"))}}}function disable(){exports.enable(\"\")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:25}],19:[function(_dereq_,module,exports){(function(global){var keys=_dereq_(\"./keys\");var hasBinary=_dereq_(\"has-binary\");var sliceBuffer=_dereq_(\"arraybuffer.slice\");var base64encoder=_dereq_(\"base64-arraybuffer\");var after=_dereq_(\"after\");var utf8=_dereq_(\"utf8\");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:\"error\",data:\"parser error\"};var Blob=_dereq_(\"blob\");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if(\"function\"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if(\"function\"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(\"\"+encoded)};function encodeBase64Object(packet,callback){var message=\"b\"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message=\"b\"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(\",\")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data==\"string\"||data===undefined){if(data.charAt(0)==\"b\"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType===\"blob\"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType===\"blob\"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary==\"function\"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback(\"0:\")}function setLengthHeader(message){return message.length+\":\"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(\"\"))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!=\"string\"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var packet;if(data==\"\"){return callback(err,0,1)}var length=\"\",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(\":\"!=chr){length+=chr}else{if(\"\"==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=\"\"}}if(length!=\"\"){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p===\"string\"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p===\"string\";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded===\"string\"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength=\"\";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg=\"\";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./keys\":20,after:11,\"arraybuffer.slice\":12,\"base64-arraybuffer\":13,blob:14,\"has-binary\":21,utf8:29}],20:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],21:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:24}],22:[function(_dereq_,module,exports){try{module.exports=typeof XMLHttpRequest!==\"undefined\"&&\"withCredentials\"in new XMLHttpRequest}catch(err){module.exports=false}},{}],23:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],24:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)==\"[object Array]\"}},{}],25:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if(\"string\"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=\"\"+str;if(str.length>1e4)return;var match=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||\"ms\").toLowerCase();switch(type){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return n*y;case\"days\":case\"day\":case\"d\":return n*d;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return n*h;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return n*m;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return n*s;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+\"d\";if(ms>=h)return Math.round(ms/h)+\"h\";if(ms>=m)return Math.round(ms/m)+\"m\";if(ms>=s)return Math.round(ms/s)+\"s\";return ms+\"ms\"}function long(ms){return plural(ms,d,\"day\")||plural(ms,h,\"hour\")||plural(ms,m,\"minute\")||plural(ms,s,\"second\")||ms+\" ms\"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+\" \"+name;return Math.ceil(ms/n)+\" \"+name+\"s\"}},{}],26:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\\],:{}\\s]*$/;var rvalidescape=/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\\s*\\[)+/g;var rtrimLeft=/^\\s+/;var rtrimRight=/\\s+$/;module.exports=function parsejson(data){if(\"string\"!=typeof data||!data){return null}data=data.replace(rtrimLeft,\"\").replace(rtrimRight,\"\");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,\"@\").replace(rvalidtokens,\"]\").replace(rvalidbraces,\"\"))){return new Function(\"return \"+data)()}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],27:[function(_dereq_,module,exports){exports.encode=function(obj){var str=\"\";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+=\"&\";str+=encodeURIComponent(i)+\"=\"+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split(\"&\");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split(\"=\");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],28:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;var parts=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];module.exports=function parseuri(str){var src=str,b=str.indexOf(\"[\"),e=str.indexOf(\"]\");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,\";\")+str.substring(e,str.length)}var m=re.exec(str||\"\"),uri={},i=14;while(i--){uri[parts[i]]=m[i]||\"\"}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,\":\");uri.authority=uri.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\");uri.ipv6uri=true}return uri}},{}],29:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports==\"object\"&&exports;var freeModule=typeof module==\"object\"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output=\"\";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error(\"Lone surrogate U+\"+codePoint.toString(16).toUpperCase()+\" is not a scalar value\")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol=\"\";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString=\"\";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error(\"Invalid byte index\")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error(\"Invalid continuation byte\")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error(\"Invalid byte index\")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error(\"Invalid UTF-8 detected\")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:\"2.0.0\",encode:utf8encode,decode:utf8decode};if(typeof define==\"function\"&&typeof define.amd==\"object\"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],30:[function(_dereq_,module,exports){\"use strict\";var alphabet=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded=\"\";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+\".\"+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],31:[function(_dereq_,module,exports){var url=_dereq_(\"./url\");var parser=_dereq_(\"socket.io-parser\");var Manager=_dereq_(\"./manager\");var debug=_dereq_(\"debug\")(\"socket.io-client\");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==\"object\"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts[\"force new connection\"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug(\"ignoring socket cache for %s\",source);io=Manager(source,opts)}else{if(!cache[id]){debug(\"new io instance for %s\",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_(\"./manager\");exports.Socket=_dereq_(\"./socket\")},{\"./manager\":32,\"./socket\":34,\"./url\":35,debug:39,\"socket.io-parser\":47}],32:[function(_dereq_,module,exports){var eio=_dereq_(\"engine.io-client\");var Socket=_dereq_(\"./socket\");var Emitter=_dereq_(\"component-emitter\");var parser=_dereq_(\"socket.io-parser\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:manager\");var indexOf=_dereq_(\"indexof\");var Backoff=_dereq_(\"backo2\");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&\"object\"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||\"/socket.io\";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState=\"closed\";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.engine.id}}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug(\"readyState %s\",this.readyState);if(~this.readyState.indexOf(\"open\"))return this;debug(\"opening %s\",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState=\"opening\";this.skipReconnect=false;var openSub=on(socket,\"open\",function(){self.onopen();fn&&fn()});var errorSub=on(socket,\"error\",function(data){debug(\"connect_error\");self.cleanup();self.readyState=\"closed\";self.emitAll(\"connect_error\",data);if(fn){var err=new Error(\"Connection error\");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug(\"connect attempt will timeout after %d\",timeout);var timer=setTimeout(function(){debug(\"connect attempt timed out after %d\",timeout);openSub.destroy();socket.close();socket.emit(\"error\",\"timeout\");self.emitAll(\"connect_timeout\",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug(\"open\");this.cleanup();this.readyState=\"open\";this.emit(\"open\");var socket=this.engine;this.subs.push(on(socket,\"data\",bind(this,\"ondata\")));this.subs.push(on(socket,\"ping\",bind(this,\"onping\")));this.subs.push(on(socket,\"pong\",bind(this,\"onpong\")));this.subs.push(on(socket,\"error\",bind(this,\"onerror\")));this.subs.push(on(socket,\"close\",bind(this,\"onclose\")));this.subs.push(on(this.decoder,\"decoded\",bind(this,\"ondecoded\")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll(\"ping\")};Manager.prototype.onpong=function(){this.emitAll(\"pong\",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit(\"packet\",packet)};Manager.prototype.onerror=function(err){debug(\"error\",err);this.emitAll(\"error\",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on(\"connecting\",onConnecting);\nsocket.on(\"connect\",function(){socket.id=self.engine.id});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug(\"writing packet %j\",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug(\"cleanup\");var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug(\"disconnect\");this.skipReconnect=true;this.reconnecting=false;if(\"opening\"==this.readyState){this.cleanup()}this.backoff.reset();this.readyState=\"closed\";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug(\"onclose\");this.cleanup();this.backoff.reset();this.readyState=\"closed\";this.emit(\"close\",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug(\"reconnect failed\");this.backoff.reset();this.emitAll(\"reconnect_failed\");this.reconnecting=false}else{var delay=this.backoff.duration();debug(\"will wait %dms before reconnect attempt\",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug(\"attempting reconnect\");self.emitAll(\"reconnect_attempt\",self.backoff.attempts);self.emitAll(\"reconnecting\",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug(\"reconnect attempt error\");self.reconnecting=false;self.reconnect();self.emitAll(\"reconnect_error\",err.data)}else{debug(\"reconnect success\");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll(\"reconnect\",attempt)}},{\"./on\":33,\"./socket\":34,backo2:36,\"component-bind\":37,\"component-emitter\":38,debug:39,\"engine.io-client\":1,indexof:42,\"socket.io-parser\":47}],33:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],34:[function(_dereq_,module,exports){var parser=_dereq_(\"socket.io-parser\");var Emitter=_dereq_(\"component-emitter\");var toArray=_dereq_(\"to-array\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:socket\");var hasBin=_dereq_(\"has-binary\");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,\"open\",bind(this,\"onopen\")),on(io,\"packet\",bind(this,\"onpacket\")),on(io,\"close\",bind(this,\"onclose\"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if(\"open\"==this.io.readyState)this.onopen();this.emit(\"connecting\");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift(\"message\");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if(\"function\"==typeof args[args.length-1]){debug(\"emitting packet with ack id %d\",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug(\"transport is open - connecting\");if(\"/\"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug(\"close (%s)\",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit(\"disconnect\",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit(\"error\",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug(\"emitting event %j\",args);if(null!=packet.id){debug(\"attaching ack callback to event\");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug(\"sending ack %j\",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if(\"function\"==typeof ack){debug(\"calling ack %s with %j\",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug(\"bad ack %s\",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit(\"connect\");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug(\"server disconnect (%s)\",this.nsp);this.destroy();this.onclose(\"io server disconnect\")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug(\"performing disconnect (%s)\",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose(\"io client disconnect\")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{\"./on\":33,\"component-bind\":37,\"component-emitter\":38,debug:39,\"has-binary\":41,\"socket.io-parser\":47,\"to-array\":51}],35:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_(\"parseuri\");var debug=_dereq_(\"debug\")(\"socket.io-client:url\");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+\"//\"+loc.host;if(\"string\"==typeof uri){if(\"/\"==uri.charAt(0)){if(\"/\"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\\/\\//.test(uri)){debug(\"protocol-less url %s\",uri);if(\"undefined\"!=typeof loc){uri=loc.protocol+\"//\"+uri}else{uri=\"https://\"+uri}}debug(\"parse %s\",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port=\"80\"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port=\"443\"}}obj.path=obj.path||\"/\";var ipv6=obj.host.indexOf(\":\")!==-1;var host=ipv6?\"[\"+obj.host+\"]\":obj.host;obj.id=obj.protocol+\"://\"+host+\":\"+obj.port;obj.href=obj.protocol+\"://\"+host+(loc&&loc.port==obj.port?\"\":\":\"+obj.port);return obj}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{debug:39,parseuri:45}],36:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],37:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if(\"string\"==typeof fn)fn=obj[fn];if(\"function\"!=typeof fn)throw new Error(\"bind() requires a function\");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],38:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[\"$\"+event]=this._callbacks[\"$\"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[\"$\"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[\"$\"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[\"$\"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[\"$\"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],39:[function(_dereq_,module,exports){arguments[4][17][0].apply(exports,arguments)},{\"./debug\":40,dup:17}],40:[function(_dereq_,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:44}],41:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON&&\"function\"==typeof obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:43}],42:[function(_dereq_,module,exports){arguments[4][23][0].apply(exports,arguments)},{dup:23}],43:[function(_dereq_,module,exports){arguments[4][24][0].apply(exports,arguments)},{dup:24}],44:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],45:[function(_dereq_,module,exports){arguments[4][28][0].apply(exports,arguments)},{dup:28}],46:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");var isBuf=_dereq_(\"./is-buffer\");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if(\"object\"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&\"object\"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&\"object\"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./is-buffer\":48,isarray:43}],47:[function(_dereq_,module,exports){var debug=_dereq_(\"debug\")(\"socket.io-parser\");var json=_dereq_(\"json3\");var isArray=_dereq_(\"isarray\");var Emitter=_dereq_(\"component-emitter\");var binary=_dereq_(\"./binary\");var isBuf=_dereq_(\"./is-buffer\");exports.protocol=4;exports.types=[\"CONNECT\",\"DISCONNECT\",\"EVENT\",\"BINARY_EVENT\",\"ACK\",\"BINARY_ACK\",\"ERROR\"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug(\"encoding packet %j\",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str=\"\";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+=\"-\"}if(obj.nsp&&\"/\"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=\",\";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=\",\";str+=json.stringify(obj.data)}debug(\"encoded %j as %s\",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if(\"string\"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit(\"decoded\",packet)}}else{this.emit(\"decoded\",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error(\"got binary data when not reconstructing a packet\")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit(\"decoded\",packet)}}}else{throw new Error(\"Unknown type: \"+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf=\"\";while(str.charAt(++i)!=\"-\"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!=\"-\"){throw new Error(\"Illegal attachments\")}p.attachments=Number(buf)}if(\"/\"==str.charAt(i+1)){p.nsp=\"\";while(++i){var c=str.charAt(i);if(\",\"==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp=\"/\"}var next=str.charAt(i+1);if(\"\"!==next&&Number(next)==next){p.id=\"\";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug(\"decoded %s as %j\",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:\"parser error\"}}},{\"./binary\":46,\"./is-buffer\":48,\"component-emitter\":49,debug:39,isarray:43,json3:50}],48:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],49:[function(_dereq_,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],50:[function(_dereq_,module,exports){(function(global){(function(){var isLoader=typeof define===\"function\"&&define.amd;var objectTypes={\"function\":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global==\"object\"&&global;if(freeGlobal&&(freeGlobal[\"global\"]===freeGlobal||freeGlobal[\"window\"]===freeGlobal||freeGlobal[\"self\"]===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root[\"Object\"]());exports||(exports=root[\"Object\"]());var Number=context[\"Number\"]||root[\"Number\"],String=context[\"String\"]||root[\"String\"],Object=context[\"Object\"]||root[\"Object\"],Date=context[\"Date\"]||root[\"Date\"],SyntaxError=context[\"SyntaxError\"]||root[\"SyntaxError\"],TypeError=context[\"TypeError\"]||root[\"TypeError\"],Math=context[\"Math\"]||root[\"Math\"],nativeJSON=context[\"JSON\"]||root[\"JSON\"];if(typeof nativeJSON==\"object\"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name==\"bug-string-char-index\"){isSupported=\"a\"[0]!=\"a\"}else if(name==\"json\"){isSupported=has(\"json-stringify\")&&has(\"json-parse\")}else{var value,serialized='{\"a\":[1,true,false,null,\"\\\\u0000\\\\b\\\\n\\\\f\\\\r\\\\t\"]}';if(name==\"json-stringify\"){var stringify=exports.stringify,stringifySupported=typeof stringify==\"function\"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)===\"0\"&&stringify(new Number)===\"0\"&&stringify(new String)=='\"\"'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)===\"1\"&&stringify([value])==\"[1]\"&&stringify([undef])==\"[null]\"&&stringify(null)==\"null\"&&stringify([undef,getClass,null])==\"[null,null,null]\"&&stringify({a:[value,true,false,null,\"\\x00\\b\\n\\f\\r\t\"]})==serialized&&stringify(null,value)===\"1\"&&stringify([1,2],null,1)==\"[\\n 1,\\n 2\\n]\"&&stringify(new Date(-864e13))=='\"-271821-04-20T00:00:00.000Z\"'&&stringify(new Date(864e13))=='\"+275760-09-13T00:00:00.000Z\"'&&stringify(new Date(-621987552e5))=='\"-000001-01-01T00:00:00.000Z\"'&&stringify(new Date(-1))=='\"1969-12-31T23:59:59.999Z\"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name==\"json-parse\"){var parse=exports.parse;if(typeof parse==\"function\"){try{if(parse(\"0\")===0&&!parse(false)){value=parse(serialized);var parseSupported=value[\"a\"].length==5&&value[\"a\"][0]===1;if(parseSupported){try{parseSupported=!parse('\"\t\"')}catch(exception){}if(parseSupported){try{parseSupported=parse(\"01\")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse(\"1.\")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has(\"json\")){var functionClass=\"[object Function]\",dateClass=\"[object Date]\",numberClass=\"[object Number]\",stringClass=\"[object String]\",arrayClass=\"[object Array]\",booleanClass=\"[object Boolean]\";var charIndexBuggy=has(\"bug-string-char-index\");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=[\"valueOf\",\"toString\",\"toLocaleString\",\"propertyIsEnumerable\",\"isPrototypeOf\",\"hasOwnProperty\",\"constructor\"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!=\"function\"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property==\"prototype\")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property==\"prototype\")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property==\"prototype\")&&isProperty.call(object,property)&&!(isConstructor=property===\"constructor\")){callback(property)}}if(isConstructor||isProperty.call(object,property=\"constructor\")){callback(property)}}}return forEach(object,callback)};if(!has(\"json-stringify\")){var Escapes={92:\"\\\\\\\\\",34:'\\\\\"',8:\"\\\\b\",12:\"\\\\f\",10:\"\\\\n\",13:\"\\\\r\",9:\"\\\\t\"};var leadingZeroes=\"000000\";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix=\"\\\\u00\";var quote=function(value){var result='\"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(\"\"):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'\"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value==\"object\"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,\"toJSON\")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?\"-\":\"+\")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+\"-\"+toPaddedString(2,month+1)+\"-\"+toPaddedString(2,date)+\"T\"+toPaddedString(2,hours)+\":\"+toPaddedString(2,minutes)+\":\"+toPaddedString(2,seconds)+\".\"+toPaddedString(3,milliseconds)+\"Z\"}else{value=null}}else if(typeof value.toJSON==\"function\"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,\"toJSON\"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return\"null\"}className=getClass.call(value);if(className==booleanClass){return\"\"+value}else if(className==numberClass){return value>-1/0&&value<1/0?\"\"+value:\"null\"}else if(className==stringClass){return quote(\"\"+value)}if(typeof value==\"object\"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?\"null\":element)}result=results.length?whitespace?\"[\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"]\":\"[\"+results.join(\",\")+\"]\":\"[]\"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+\":\"+(whitespace?\" \":\"\")+element)}});result=results.length?whitespace?\"{\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"}\":\"{\"+results.join(\",\")+\"}\":\"{}\"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace=\"\",width>10&&(width=10);whitespace.length<width;whitespace+=\" \");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize(\"\",(value={},value[\"\"]=source,value),callback,properties,whitespace,\"\",[])}}if(!has(\"json-parse\")){var fromCharCode=String.fromCharCode;var Unescapes={92:\"\\\\\",34:'\"',47:\"/\",98:\"\\b\",116:\"\t\",110:\"\\n\",102:\"\\f\",114:\"\\r\"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value=\"@\",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode(\"0x\"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)==\"true\"){Index+=4;return true}else if(source.slice(Index,Index+5)==\"false\"){Index+=5;return false}else if(source.slice(Index,Index+4)==\"null\"){Index+=4;return null}abort()}}return\"$\"};var get=function(value){var results,hasMembers;if(value==\"$\"){abort()}if(typeof value==\"string\"){if((charIndexBuggy?value.charAt(0):value[0])==\"@\"){return value.slice(1)}if(value==\"[\"){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"]\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"]\"){abort()}}else{abort()}}if(value==\",\"){abort()}results.push(get(value))}return results}else if(value==\"{\"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"}\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"}\"){abort()}}else{abort()}}if(value==\",\"||typeof value!=\"string\"||(charIndexBuggy?value.charAt(0):value[0])!=\"@\"||lex()!=\":\"){abort()}results[value.slice(1)]=get(lex())\n}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value==\"object\"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=\"\"+source;result=get(lex());if(lex()!=\"$\"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[\"\"]=result,value),\"\",callback):result}}}exports[\"runInContext\"]=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root[\"JSON3\"],isRestored=false;var JSON3=runInContext(root,root[\"JSON3\"]={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root[\"JSON3\"]=previousJSON;nativeJSON=previousJSON=null}return JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],51:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[31])(31)});\n\n    \n      ;var weight = document.getElementById('weight');\n      var socket = io('http://{{ip}}:1884');\n      socket.on('getWeight', function(msg) {\n        weight.innerHTML = msg;\n    \n      }); \n    }, 1000);\n    </script>\n\n  </body>\n</html>\n","x":490,"y":1200,"wires":[["aab8f880.652758"]]},{"id":"aab8f880.652758","type":"http response","z":"104f345f.4f25ac","name":"","x":630,"y":1200,"wires":[]},{"id":"7f216532.c8922c","type":"function","z":"104f345f.4f25ac","name":"set ip","func":"msg.ip = global.get('ip');\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":1200,"wires":[["4cba3750.e155c8"]]},{"id":"ebb0ea7c.668948","type":"function","z":"104f345f.4f25ac","name":"Вес по осям","func":"msg.payload = \"\"+msg.payload+\"<br/>\"+msg.weight1+\"<br/>\"+msg.weight2+\"\";\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":620,"wires":[["6080a004.71ad3"]]},{"id":"446313a2.a14a1c","type":"json","z":"104f345f.4f25ac","name":"","x":1190,"y":360,"wires":[["e8124e8f.9baf"]]},{"id":"e8124e8f.9baf","type":"debug","z":"104f345f.4f25ac","name":"GD event","active":false,"console":"true","complete":"payload","x":1330,"y":360,"wires":[]},{"id":"d20d32fb.94cb9","type":"debug","z":"104f345f.4f25ac","name":"GD device config","active":false,"console":"true","complete":"payload","x":1070,"y":160,"wires":[]},{"id":"f92257a2.0f6d88","type":"json","z":"104f345f.4f25ac","name":"","x":910,"y":160,"wires":[["d20d32fb.94cb9"]]},{"id":"f160edb4.add99","type":"function","z":"104f345f.4f25ac","name":"events payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_1');\nvar snapshot_events = flow.get('snapshot_events');\nvar snapshot = false;\n\nif (snapshot_events.indexOf(event_id)>=0){\n    snapshot = true;\n}\n\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'devices':[{'id':scale_id}],\n    'data':msg.metadata,\n    'description':msg.description\n};\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n};\n\nmsg.url = flow.get('main_host')+flow.get('event_url');\nmsg.main_host = flow.get('main_host');\nmsg.event_url = flow.get('event_url');\nmsg.snapshot = snapshot;\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":420,"wires":[["446313a2.a14a1c","83fef186.2588e","c954f498.9f3b08","44df4d48.8f1354"]]},{"id":"fe0c3bec.9eff88","type":"function","z":"104f345f.4f25ac","name":"device config","func":"var device_config = JSON.parse(msg.payload);\n\nflow.set('scale_id',device_config.scale_id);\nflow.set('event_move_in_id',device_config.event_move_in_id);\nflow.set('event_move_in_minus_id',device_config.event_move_in_minus_id);\nflow.set('event_move_out_id',device_config.event_move_out_id);\nflow.set('event_max_weight_id',device_config.event_max_weight_id);\nflow.set('event_off_id',device_config.event_off_id);\nflow.set('event_on_id', device_config.event_on_id);\nflow.set('event_max_duration',device_config.event_max_duration);\nflow.set('event_fake_traffic',device_config.event_fake_traffic);\nflow.set('event_driver_in', device_config.event_driver_in);\nflow.set('main_host',device_config.main_host);\nflow.set('event_url',device_config.event_url);\nflow.set('state_url',device_config.state_url);\nflow.set('maxWeight',device_config.maxWeight);\nflow.set('minWeight',device_config.minWeight);\nflow.set('maxDuration',device_config.maxDuration);\nflow.set('checkHealthTimeout',device_config.checkHealthTimeout);\nflow.set('event_get_weight_acc',device_config.event_get_weight_acc);\nflow.set('event_min_weight',device_config.event_min_weight);\nflow.set('minTriggerWeight',device_config.minTriggerWeight);\nflow.set('snapshot_url',device_config.snapshot_url);\nflow.set('snapshot_events',device_config.snapshot_events);\nflow.set('driverWeight',device_config.driverWeight)\n\nmsg.payload = {\n\tscale_id: flow.get('scale_id'),\n\tevent_move_in_id: flow.get('event_move_in_id'),\n\tevent_move_in_minus_id: flow.get('event_move_in_minus_id'),\n\tevent_move_out_id: flow.get('event_move_out_id'),\n\tevent_max_weight_id: flow.get('event_max_weight_id'),\n\tevent_off_id: flow.get('event_off_id'),\n\tevent_on_id: flow.get('event_on_id'),\n\tevent_max_duration: flow.get('event_max_duration'),\n\tevent_fake_traffic: flow.get('event_fake_traffic'),\n\tevent_driver_in: flow.get('event_driver_in'),\n\tmain_host: flow.get('main_host'),\n\tevent_url: flow.get('event_url'),\n\tstate_url: flow.get('state_url'),\n\tmaxWeight: flow.get('maxWeight'),\n\tminWeight: flow.get('minWeight'),\n\tmaxDuration: flow.get('maxDuration'),\n\tcheckHealthTimeout: flow.get('checkHealthTimeout'),\n\tevent_get_weight_acc: flow.get('event_get_weight_acc'),\n\tevent_min_weight: flow.get('event_min_weight'),\n\tminTriggerWeight: flow.get('minTriggerWeight'),\n\tsnapshot_url: flow.get('snapshot_url'),\n\tsnapshot_events: flow.get('snapshot_events'),\n\tdriverWeight: flow.get('driverWeight')\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":770,"y":160,"wires":[["f92257a2.0f6d88"]]},{"id":"35ed3a75.cdea06","type":"delay","z":"104f345f.4f25ac","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":160,"wires":[["22555fba.a8769"]]},{"id":"f59d747d.0282b8","type":"trigger","z":"104f345f.4f25ac","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","name":"","x":340,"y":200,"wires":[["11853a3e.62d046"]]},{"id":"cead381d.eb7ee8","type":"debug","z":"104f345f.4f25ac","name":"","active":false,"console":"false","complete":"false","x":400,"y":920,"wires":[]},{"id":"370c271.7db6ad8","type":"debug","z":"104f345f.4f25ac","name":"stable","active":false,"console":"false","complete":"stable","x":170,"y":560,"wires":[]},{"id":"4fe7c559.3599cc","type":"function","z":"104f345f.4f25ac","name":"","func":"var weight = msg.payload;\n\nmsg.payload = {\n    info: weight,\n    date: global.get('date_log'),\n};\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":860,"wires":[["b55ddbbc.e7cb08"]]},{"id":"b55ddbbc.e7cb08","type":"file","z":"104f345f.4f25ac","name":"","filename":"/distr/data/JD/log_jd_1c_GET_weight.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":760,"y":860,"wires":[]},{"id":"758d4609.ef3818","type":"comment","z":"fdab393b.c717e8","name":"Ініціалізація","info":"\"ALL 100 0 100 0 0 0 10000 0 1 0 65 \"//1\n\"ALL 50 0 50 0 0 0 10000 0 1 0 65 \"\n\"ALL 100 100 0 0 0 0 10000 0 1 0 65 \"//2\n","x":110,"y":40,"wires":[]},{"id":"afec6f3b.992e5","type":"function","z":"104f345f.4f25ac","name":"sid","func":"//let sid = msg.payload.sid;\n//msg.sid = sid;\n\n//let sid = msg.payload.sid;\nlet sid = global.get('sidG');\nmsg.sid = sid;\n\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":640,"wires":[["4447d480.179fbc"]]},{"id":"d89aaf12.302ab","type":"function","z":"104f345f.4f25ac","name":"screenshot","func":"let guidChannel = \"oBj18C1F\";// guid channal\n\nlet url = `https://10.107.25.137:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\n//msg.res = flow.get('res');\n//msg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":1890,"y":640,"wires":[["3fac6892.7579f8"]]},{"id":"3fac6892.7579f8","type":"http request","z":"104f345f.4f25ac","name":"","method":"GET","ret":"bin","url":"","tls":"7eb4a526.3db92c","x":2050,"y":640,"wires":[["797fc404.a0392c"]]},{"id":"44df4d48.8f1354","type":"switch","z":"104f345f.4f25ac","name":"take snapshot","property":"snapshot","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1080,"y":640,"wires":[["da612a8f.cb3c68"]]},{"id":"797fc404.a0392c","type":"function","z":"104f345f.4f25ac","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_1');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2230,"y":640,"wires":[["95cc6951.443148"]]},{"id":"95cc6951.443148","type":"http request","z":"104f345f.4f25ac","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"5bd22a1d.f94584","x":2440,"y":640,"wires":[["91f7f1f3.00d68","50534993.f42878"]]},{"id":"b5a9feb2.7ea13","type":"function","z":"104f345f.4f25ac","name":"screenshot","func":"let guidChannel = \"qzuXJCUt\";// guid channal\n\nlet url = `https://10.107.25.137:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\n//msg.res = flow.get('res');\n//msg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":1890,"y":700,"wires":[["c80e8985.271d58"]]},{"id":"3ed49c3e.2362e4","type":"function","z":"104f345f.4f25ac","name":"screenshot","func":"let guidChannel = \"U9wnGJdQ\";// guid channal\n\nlet url = `https://10.107.25.137:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\n//msg.res = flow.get('res');\n//msg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":1890,"y":760,"wires":[["2fcb5042.658d5"]]},{"id":"34ad8580.6c96fa","type":"function","z":"104f345f.4f25ac","name":"delete","func":"\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\nflow.set('msg_photo', msg);\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":640,"wires":[["afec6f3b.992e5"]]},{"id":"c80e8985.271d58","type":"http request","z":"104f345f.4f25ac","name":"","method":"GET","ret":"bin","url":"","tls":"7eb4a526.3db92c","x":2050,"y":700,"wires":[["ed2bb223.2455c"]]},{"id":"ed2bb223.2455c","type":"function","z":"104f345f.4f25ac","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_1');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2230,"y":700,"wires":[["e22a498e.3c96b8"]]},{"id":"e22a498e.3c96b8","type":"http request","z":"104f345f.4f25ac","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"5bd22a1d.f94584","x":2440,"y":700,"wires":[["91f7f1f3.00d68"]]},{"id":"2fcb5042.658d5","type":"http request","z":"104f345f.4f25ac","name":"","method":"GET","ret":"bin","url":"","tls":"7eb4a526.3db92c","x":2050,"y":760,"wires":[["a129d4d9.f02df8"]]},{"id":"a129d4d9.f02df8","type":"function","z":"104f345f.4f25ac","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_1');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2230,"y":760,"wires":[["dac3cea8.6757"]]},{"id":"dac3cea8.6757","type":"http request","z":"104f345f.4f25ac","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"5bd22a1d.f94584","x":2440,"y":760,"wires":[["91f7f1f3.00d68"]]},{"id":"4447d480.179fbc","type":"delay","z":"104f345f.4f25ac","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1720,"y":640,"wires":[["d89aaf12.302ab"]]},{"id":"cd1af0a7.702f5","type":"delay","z":"104f345f.4f25ac","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1720,"y":700,"wires":[["b5a9feb2.7ea13"]]},{"id":"64faf9db.ea3838","type":"delay","z":"104f345f.4f25ac","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1710,"y":760,"wires":[["3ed49c3e.2362e4"]]},{"id":"c445b4c.3bc9548","type":"comment","z":"104f345f.4f25ac","name":"Зробити фото","info":"","x":1080,"y":600,"wires":[]},{"id":"91f7f1f3.00d68","type":"debug","z":"104f345f.4f25ac","name":"","active":true,"console":"false","complete":"false","x":2630,"y":640,"wires":[]},{"id":"da612a8f.cb3c68","type":"delay","z":"104f345f.4f25ac","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1260,"y":640,"wires":[["34ad8580.6c96fa"]]},{"id":"43901210.ca490c","type":"function","z":"104f345f.4f25ac","name":"sid","func":"//let sid = msg.payload.sid;\n//msg.sid = sid;\nmsg = flow.get('msg_photo');\n//let sid = msg.payload.sid;\nlet sid = global.get('sidG');\nmsg.sid = sid;\n\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":700,"wires":[["cd1af0a7.702f5"]]},{"id":"50534993.f42878","type":"function","z":"104f345f.4f25ac","name":"sid","func":"//let sid = msg.payload.sid;\n//msg.sid = sid;\nmsg = flow.get('msg_photo');\n//let sid = msg.payload.sid;\nlet sid = global.get('sidG');\nmsg.sid = sid;\n\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":760,"wires":[["64faf9db.ea3838"]]},{"id":"c954f498.9f3b08","type":"debug","z":"104f345f.4f25ac","name":"","active":false,"console":"false","complete":"true","x":1190,"y":320,"wires":[]},{"id":"907f6832.cc27f8","type":"comment","z":"104f345f.4f25ac","name":"Ініціалізація налаштувань","info":"","x":170,"y":60,"wires":[]},{"id":"ca4945f9.2e5db8","type":"file","z":"104f345f.4f25ac","name":"","filename":"/distr/data/JD/weight_log.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1400,"y":1060,"wires":[]},{"id":"e25bf619.5124f8","type":"function","z":"104f345f.4f25ac","name":"msg","func":"var weight = msg.payload;\nvar a1 = msg.weight1;\nvar a2 = msg.weight2;\n\n\n\nmsg.payload = {\n    weight: {weight,a1,a2},\n    date: global.get('date_log'),\n    connect: msg.connect\n};\nreturn msg;","outputs":1,"noerr":0,"x":1190,"y":1060,"wires":[["ca4945f9.2e5db8"]]},{"id":"5ca23eea.04903","type":"link in","z":"104f345f.4f25ac","name":"get msg log weight 2 out","links":["b780506c.9dad6"],"x":1075,"y":1060,"wires":[["e25bf619.5124f8"]]},{"id":"4a80afe9.a7f03","type":"comment","z":"104f345f.4f25ac","name":"Логування ваги від вагопроцесора","info":"","x":1180,"y":1020,"wires":[]},{"id":"eb3b18ce.fda5b8","type":"comment","z":"104f345f.4f25ac","name":"Подія на підключений/відключений прилад","info":"","x":250,"y":700,"wires":[]},{"id":"b692d332.efcff","type":"comment","z":"104f345f.4f25ac","name":"Відправка події в Скелю","info":"","x":930,"y":380,"wires":[]},{"id":"66a2c567.42e77c","type":"comment","z":"fdab393b.c717e8","name":"Коли довго немає ваги генерую 0 кг.","info":"","x":250,"y":460,"wires":[]},{"id":"55eddae.b2b7724","type":"inject","z":"fdab393b.c717e8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":320,"wires":[["6f140687.7219d8"]]},{"id":"6f140687.7219d8","type":"function","z":"fdab393b.c717e8","name":"0","func":"let arr8 = [170,0,0,0,0,0,0,0,0,0xa];\nconst buffer = Buffer.from(arr8);\n\nmsg.payload = buffer\nreturn msg;\n","outputs":1,"noerr":0,"x":270,"y":320,"wires":[["5d014481.53eb5c","e0d7f8cb.42e1e8"]]},{"id":"e0d7f8cb.42e1e8","type":"debug","z":"fdab393b.c717e8","name":"","active":true,"console":"false","complete":"false","x":490,"y":320,"wires":[]},{"id":"2b1a15ad.4da17a","type":"inject","z":"725358f3.31ba08","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":150,"y":440,"wires":[["6a9ddc4f.082c04"]]},{"id":"6a9ddc4f.082c04","type":"function","z":"725358f3.31ba08","name":"","func":"var d = new Date();\n\nvar utc = d.getTime() + (d.getTimezoneOffset() * 60000);\n\nvar offset = 3; // This is the offset for UTC+3, in your case (UTC+1) should be 1\n\nnewDate = new Date(utc + (3600000*offset));\n\nmsg.payload = newDate;\n//msg.payload = newDate.toLocaleString();\nglobal.set('date_log',newDate);\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":440,"wires":[["f2f8a6c4.eb9618"]]},{"id":"f2f8a6c4.eb9618","type":"debug","z":"725358f3.31ba08","name":"","active":false,"console":"false","complete":"false","x":430,"y":440,"wires":[]},{"id":"4efe4e95.2cdbf","type":"comment","z":"725358f3.31ba08","name":"Дата для лог запитів","info":"","x":160,"y":400,"wires":[]},{"id":"e5e913fc.f4333","type":"function","z":"415d6a1.76aa494","name":"log","func":"\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":100,"wires":[["4d6e2f02.16a5f"]]},{"id":"8fea4b58.f25f08","type":"comment","z":"415d6a1.76aa494","name":"Логування аналізу","info":"","x":360,"y":60,"wires":[]},{"id":"4d6e2f02.16a5f","type":"file","z":"415d6a1.76aa494","name":"","filename":"/distr/data/Infratec/lastAnalys.txt","appendNewline":true,"createDir":true,"overwriteFile":"true","x":570,"y":100,"wires":[]},{"id":"1b423bca.a0dcd4","type":"inject","z":"415d6a1.76aa494","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":100,"y":100,"wires":[["e5e913fc.f4333"]]},{"id":"68e1149f.b9e54c","type":"http in","z":"3d95eac6.3e2b96","name":"","url":"/send/1c","method":"post","swaggerDoc":"","x":190,"y":240,"wires":[["acd5c6a0.4342b8","357ccfbf.4174a"]]},{"id":"8bccaff4.044c9","type":"http response","z":"3d95eac6.3e2b96","name":"","x":930,"y":240,"wires":[]},{"id":"acd5c6a0.4342b8","type":"function","z":"3d95eac6.3e2b96","name":"","func":"//msg.url = \"https://10.101.1.17/ELC_SCAT/hs/PerimeterControl/api/Granary/RaiseBarrier\";\n\nmsg.url = global.get(\"send_1c_url_RaiseBarrier\");\n\n\n\n//msg.payload = JSON.parse(msg.payload);\nflow.set(\"resApex\", msg.res);\nflow.set(\"reqApex\", msg.req);\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":240,"wires":[["51cf05d7.32544c","27813002.09146"]]},{"id":"27813002.09146","type":"http request","z":"3d95eac6.3e2b96","name":"","method":"POST","ret":"txt","url":"","tls":"1ae58ed1.914c61","x":590,"y":240,"wires":[["7a7bf944.5e74b8","3b706f7a.fea38"]]},{"id":"fc16dcee.88c8c","type":"comment","z":"3d95eac6.3e2b96","name":"Відправка з Апекса на 1С","info":"apiuser\napiuser","x":190,"y":100,"wires":[]},{"id":"7a7bf944.5e74b8","type":"debug","z":"3d95eac6.3e2b96","name":"res 1c","active":true,"console":"false","complete":"true","x":750,"y":200,"wires":[]},{"id":"3b706f7a.fea38","type":"function","z":"3d95eac6.3e2b96","name":"","func":" let statusCode = msg.statusCode;\n \n if(statusCode === \"HPE_INVALID_CONSTANT\"){\n    msg.payload = {statusCode: 204}; \n    msg.statusCode = 200;\n } else {\n     msg.payload = {statusCode: statusCode};    \n }\n\n// delete msg.headers;\n//delete msg.responseUrl;\n//delete msg.url;\n\n//msg.headers = {};\n//msg.headers[\"content-type\"] = \"application/json\";\n\n// msg.res = flow.get(\"resApex\");\n //msg.req = flow.get(\"reqApex\");\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":240,"wires":[["8bccaff4.044c9"]]},{"id":"f09f4aa.bd96fb8","type":"inject","z":"3d95eac6.3e2b96","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":160,"y":160,"wires":[["acd5c6a0.4342b8"]]},{"id":"357ccfbf.4174a","type":"debug","z":"3d95eac6.3e2b96","name":"send 1c","active":true,"console":"false","complete":"true","x":420,"y":200,"wires":[]},{"id":"51cf05d7.32544c","type":"debug","z":"3d95eac6.3e2b96","name":"","active":true,"console":"false","complete":"true","x":570,"y":200,"wires":[]},{"id":"ac3913ad.eedca","type":"inject","z":"fdab393b.c717e8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":360,"wires":[["2ce2daf.84fea26"]]},{"id":"2ce2daf.84fea26","type":"function","z":"fdab393b.c717e8","name":"5000","func":"let arr8 = [170,0,5,0,5,255,255,0,0,0xa];\nconst buffer = Buffer.from(arr8);\n\nmsg.payload = buffer\nreturn msg;\n","outputs":1,"noerr":0,"x":270,"y":360,"wires":[["5d014481.53eb5c"]]},{"id":"a99e3e03.8d75e","type":"file","z":"38f5b6db.4b422a","name":"","filename":"/distr/data/tablo/info_log.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":640,"y":140,"wires":[]},{"id":"22140892.6597f8","type":"function","z":"38f5b6db.4b422a","name":"msg","func":"var info = msg.payload;\n\n\n\n\nmsg.payload = {\n    info: info,\n    date: global.get('date_log'),\n};\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":140,"wires":[["a99e3e03.8d75e"]]},{"id":"462b799b.fbea08","type":"comment","z":"38f5b6db.4b422a","name":"Логування інформації на табло","info":"","x":410,"y":100,"wires":[]},{"id":"51d50fdd.47f66","type":"function","z":"415d6a1.76aa494","name":"parse quality","func":"var result = {\n    localdate:new Date()\n};\n\nvar sdata = msg.payload;\nvar arr_sdata = sdata.split('\\n');\n\nresult.length = arr_sdata.length;\n\n//Ambient Temperature\nvar ambietTemperature = arr_sdata[7];\nvar arr_ambietTemperature = ambietTemperature.split(\":\");\nresult.ambietTemperature = arr_ambietTemperature[1];\n\n//Analysis Counter\nvar analysisCounter = arr_sdata[8];\nvar arr_analysisCounter = analysisCounter.split(\":\");\nresult.analysisCounter = arr_analysisCounter[1];\n\n//Sub sample\nvar subSample = arr_sdata[11];\nvar arr_subSample = subSample.split(\":\");\nvar arr_subSample_1 = arr_subSample[0].split(\"     \");\n\nresult.subsample = {\n   id : arr_subSample[0].replace(\"NrOFSubSamples\",\"\"),\n   NrOFSubSamples : arr_subSample[1]\n}\n\n//Sample hash\nvar sampleHash = arr_sdata[13];\nresult.sampleHash = sampleHash;\n\n//read quailities \nvar startQ  = 14;\nvar qLength = 7;\nvar endStr  = \"#\";\n\nvar qualities = [];\n\nfor( var i = startQ; i <= arr_sdata.length-qLength; ){\n    \n    var q = {\n        id:arr_sdata[i],\n        value:arr_sdata[i+1].split(String.fromCharCode(20)),\n        minmax:arr_sdata[i+4].split(String.fromCharCode(20))\n    }\n    qualities.push(q);   \n    i = i+qLength;\n    \n}\n\nresult.qualities = qualities;\nresult.datahash  = JSON.stringify(result);\n// msg.payload = arr_sdata;\nmsg.payload = result;\nflow.set('parseQA',result);\n\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":80,"wires":[[]]},{"id":"cf3d14d5.31d968","type":"inject","z":"415d6a1.76aa494","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":880,"wires":[["ec19e797.005bb8"]]},{"id":"ce67a472.14ac08","type":"debug","z":"415d6a1.76aa494","name":"","active":true,"console":"false","complete":"false","x":440,"y":880,"wires":[]},{"id":"ec19e797.005bb8","type":"file in","z":"415d6a1.76aa494","name":"analis","filename":"/distr/data/Infratec/analis.txt","format":"utf8","x":260,"y":880,"wires":[["ce67a472.14ac08","8681b9f3.fef1e8"]]},{"id":"8681b9f3.fef1e8","type":"function","z":"415d6a1.76aa494","name":"","func":"var info = msg.payload;\n\nvar result = info.split(\"\\n\");\n\n\nvar cultura = result[1];\nvar ID = result[3].split(\"~\");\nconst quelity = [...result];\nquelity.splice(0, 7); \nvar filterQuelity = quelity.filter(item => item.length > 6);\n\n\nvar res = {\n    cultura,\n    analysisCounter:ID[4],\n    quelity: filterQuelity.join(',')\n};\n\nmsg.payload = res;\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":940,"wires":[["e3323c52.8bcb5","6dce8421.8279fc"]]},{"id":"e3323c52.8bcb5","type":"debug","z":"415d6a1.76aa494","name":"","active":true,"console":"false","complete":"false","x":470,"y":940,"wires":[]},{"id":"6dce8421.8279fc","type":"function","z":"415d6a1.76aa494","name":"send quality","func":"msg.event_id = flow.get('event_make_quality_id');\nmsg.description = 'Отримали якість із аналізатору. Номер аналізу: ' + msg.payload.analysisCounter+\". Культура: \" + msg.payload.cultura + \". Якість: \"+msg.payload.quelity;\nmsg.metadata = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":980,"wires":[["23f94b17.203d34"]]},{"id":"23f94b17.203d34","type":"debug","z":"415d6a1.76aa494","name":"","active":true,"console":"false","complete":"true","x":590,"y":980,"wires":[]},{"id":"c8651979.9d8048","type":"function","z":"415d6a1.76aa494","name":"parse quality old","func":"var result = {\n    localdate:new Date()\n};\n\nvar sdata = msg.payload;\nvar arr_sdata = sdata.split('\\n');\n\nresult.length = arr_sdata.length;\n\n//Ambient Temperature\nvar ambietTemperature = arr_sdata[7];\nvar arr_ambietTemperature = ambietTemperature.split(\":\");\nresult.ambietTemperature = arr_ambietTemperature[1];\n\n//Analysis Counter\nvar analysisCounter = arr_sdata[8];\nvar arr_analysisCounter = analysisCounter.split(\":\");\nresult.analysisCounter = arr_analysisCounter[1];\n\n//Sub sample\nvar subSample = arr_sdata[11];\nvar arr_subSample = subSample.split(\":\");\nvar arr_subSample_1 = arr_subSample[0].split(\"     \");\n\nresult.subsample = {\n   id : arr_subSample[0].replace(\"NrOFSubSamples\",\"\"),\n   NrOFSubSamples : arr_subSample[1]\n}\n\n//Sample hash\nvar sampleHash = arr_sdata[13];\nresult.sampleHash = sampleHash;\n\n//read quailities \nvar startQ  = 14;\nvar qLength = 7;\nvar endStr  = \"#\";\n\nvar qualities = [];\n\nfor( var i = startQ; i <= arr_sdata.length-qLength; ){\n    \n    var q = {\n        id:arr_sdata[i],\n        value:arr_sdata[i+1].split(String.fromCharCode(20)),\n        minmax:arr_sdata[i+4].split(String.fromCharCode(20))\n    }\n    qualities.push(q);   \n    i = i+qLength;\n    \n}\n\nresult.qualities = qualities;\nresult.datahash  = JSON.stringify(result);\n// msg.payload = arr_sdata;\nmsg.payload = result;\nflow.set('parseQA',result);\n\nreturn msg;","outputs":1,"noerr":0,"x":1320,"y":280,"wires":[["a6a59d08.2eeeb"]]},{"id":"5aa9a212.541c0c","type":"function","z":"415d6a1.76aa494","name":"parse result","func":"var p = msg.payload;\n\nvar result = {\n    \"ambietTemperature\":p.ambietTemperature,\n    \"analysisCounter\":p.analysisCounter,\n    \"subsample_id\":p.subsample.id,\n    \"subsample_NrOFSubSamples\":p.subsample.NrOFSubSamples,\n    \"sampleHash\":p.sampleHash\n};\nvar notcondition = [];\nvar isNotConditional = false;\n\nfor (var i = 0; i < p.qualities.length; i++){\n    \n    var valueid = p.qualities[i].id.replace(\" \",\"\"); \n    var temp_value_name = p.qualities[i].value[0].match(/[a-zA-Z]+/g)[0];\n    var temp_value = parseFloat(p.qualities[i].value[0].match(/\\d+.\\d+/g));\n    result[temp_value_name] = temp_value;\n    \n    var temp_value_min_name = p.qualities[i].minmax[0].match(/[a-zA-Z]+/g)[0];\n    var temp_value_min = parseFloat(p.qualities[i].minmax[0].match(/\\d+.\\d+/g)[0]);\n    // result[temp_value_name+\"_\"+temp_value_min_name] = temp_value_min;\n    \n    var temp_value_max_name = p.qualities[i].minmax[0].match(/[a-zA-Z]+/g)[1];\n    var temp_value_max = parseFloat(p.qualities[i].minmax[0].match(/\\d+.\\d+/g)[1]);\n    // result[temp_value_name+\"_\"+temp_value_max_name] = temp_value_max;\n    \n    if ((temp_value>temp_value_max) || (temp_value<temp_value_min)){\n        notcondition.push({\n            [temp_value_name]:temp_value,\n            [temp_value_min_name]:temp_value_min,\n            [temp_value_max_name]:temp_value_max\n        });\n        isNotConditional = true;\n    }\n}\nmsg.payload = result;\nmsg.notcondition = notcondition;\nmsg.isNotConditional = isNotConditional;\n\nreturn msg;","outputs":1,"noerr":0,"x":2090,"y":400,"wires":[[]]},{"id":"89f75036.ed4d","type":"function","z":"415d6a1.76aa494","name":"parse quality old","func":"var result = {\n    localdate:new Date()\n};\n\nvar sdata = msg.payload;\nvar arr_sdata = sdata.split('\\n');\n\nresult.length = arr_sdata.length;\n\n//Ambient Temperature\nvar ambietTemperature = arr_sdata[7];\nvar arr_ambietTemperature = ambietTemperature.split(\":\");\nresult.ambietTemperature = arr_ambietTemperature[1];\n\n//Analysis Counter\nvar analysisCounter = arr_sdata[8];\nvar arr_analysisCounter = analysisCounter.split(\":\");\nresult.analysisCounter = arr_analysisCounter[1];\n\n//Sub sample\nvar subSample = arr_sdata[11];\nvar arr_subSample = subSample.split(\":\");\nvar arr_subSample_1 = arr_subSample[0].split(\"     \");\n\nresult.subsample = {\n   id : arr_subSample[0].replace(\"NrOFSubSamples\",\"\"),\n   NrOFSubSamples : arr_subSample[1]\n}\n\n//Sample hash\nvar sampleHash = arr_sdata[13];\nresult.sampleHash = sampleHash;\n\n//read quailities \nvar startQ  = 14;\nvar qLength = 7;\nvar endStr  = \"#\";\n\nvar qualities = [];\n\nfor( var i = startQ; i <= arr_sdata.length-qLength; ){\n    \n    var q = {\n        id:arr_sdata[i],\n        value:arr_sdata[i+1].split(String.fromCharCode(20)),\n        minmax:arr_sdata[i+4].split(String.fromCharCode(20))\n    }\n    qualities.push(q);   \n    i = i+qLength;\n    \n}\n\nresult.qualities = qualities;\nresult.datahash  = JSON.stringify(result);\n// msg.payload = arr_sdata;\nmsg.payload = result;\nflow.set('parseQA',result);\n\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":160,"wires":[[]]},{"id":"a6a59d08.2eeeb","type":"function","z":"415d6a1.76aa494","name":"send quality old","func":"msg.event_id = flow.get('event_make_quality_id');\nmsg.description = 'Отримали якість із аналізатору. Номер аналізу: ' + msg.payload.analysisCounter+\". Калібровка \"+msg.payload.subsample_id;\nmsg.metadata = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":1520,"y":280,"wires":[[]]},{"id":"d7d90450.d28138","type":"comment","z":"415d6a1.76aa494","name":"Тестував парсинг від аналізатора","info":"apiuser\napiuser","x":220,"y":840,"wires":[]},{"id":"5c5ba1b9.56dda","type":"xml","z":"ddef2aec.70f948","name":"","attr":"","chr":"","x":710,"y":120,"wires":[["d0f4b1b8.5e8c7","3c4a844.00c0e7c"]]},{"id":"ae9dea72.8528c8","type":"xml","z":"ddef2aec.70f948","name":"","attr":"","chr":"","x":710,"y":180,"wires":[["f633512.323ceb","37a85adf.80ba96"]]},{"id":"f633512.323ceb","type":"debug","z":"ddef2aec.70f948","name":"","active":true,"console":"false","complete":"true","x":850,"y":220,"wires":[]},{"id":"d0f4b1b8.5e8c7","type":"debug","z":"ddef2aec.70f948","name":"","active":true,"console":"false","complete":"true","x":850,"y":80,"wires":[]},{"id":"3c4a844.00c0e7c","type":"function","z":"ddef2aec.70f948","name":"","func":"var btn0 = msg.payload.response.btn0.join();\nvar btn1 = msg.payload.response.btn1.join();\nvar btn2 = msg.payload.response.btn2.join();\nvar btn3 = msg.payload.response.btn3.join();\n\n\nmsg.payload = {\n    response:[{btn0},{btn1},{btn2},{btn3}]\n        \n    \n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":120,"wires":[["375daac8.ecefb6","50030a8d.1c2f54"]]},{"id":"50030a8d.1c2f54","type":"debug","z":"ddef2aec.70f948","name":"","active":true,"console":"false","complete":"true","x":1050,"y":80,"wires":[]},{"id":"37a85adf.80ba96","type":"function","z":"ddef2aec.70f948","name":"","func":"var btn0 = msg.payload.response.btn0.join();\nvar btn1 = msg.payload.response.btn1.join();\nvar btn2 = msg.payload.response.btn2.join();\nvar btn3 = msg.payload.response.btn3.join();\n\n\nmsg.payload = {\n    response: {\n        btn0,btn1,btn2,btn3\n    }\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":180,"wires":[["9fbd0fe4.eb3f2","a646f7e7.6f3698"]]},{"id":"a646f7e7.6f3698","type":"debug","z":"ddef2aec.70f948","name":"","active":true,"console":"false","complete":"true","x":1050,"y":220,"wires":[]},{"id":"cd90c4.150e1f4","type":"inject","z":"25dc673e.e08538","name":"","topic":"","payload":"1000","payloadType":"num","repeat":"","crontab":"","once":false,"x":450,"y":260,"wires":[["1ee14ec0.c90901"]]},{"id":"8e9faff3.b2f78","type":"function","z":"25dc673e.e08538","name":"toString","func":"msg.payload = msg.payload.toString()\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":440,"wires":[["592af8f2.528368","9d7076be.dc4058","bd459d3f.4e2cd"]]},{"id":"1e2d0a8f.adf215","type":"inject","z":"25dc673e.e08538","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":260,"y":660,"wires":[["c9b264bd.35a4a8"]]},{"id":"c9b264bd.35a4a8","type":"function","z":"25dc673e.e08538","name":"0","func":"let arr8 = [2,43,48,48,49,55,50,48,48,49,70,3,];\nconst buffer = Buffer.from(arr8);\n\nmsg.payload = buffer\nreturn msg;\n","outputs":1,"noerr":0,"x":390,"y":660,"wires":[["700f96a5.636a18"]]},{"id":"adf425d7.fb05a8","type":"debug","z":"25dc673e.e08538","name":"","active":false,"console":"false","complete":"false","x":730,"y":660,"wires":[]},{"id":"700f96a5.636a18","type":"function","z":"25dc673e.e08538","name":"","func":"msg.payload = msg.payload.toString()\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":660,"wires":[["adf425d7.fb05a8"]]},{"id":"feda161f.365258","type":"inject","z":"415d6a1.76aa494","name":"","topic":"","payload":"22-02-16     15:30 WH256733     Wheat 3 param  ~04180414~ ~043E043104400430043704460430~           2 ~04180414~ ~043A043B04380435043D04420430~                                              ProtDM  13.2             Moisture  12.3            Klekovina  22.1          Test Weight  71.1        ","payloadType":"str","repeat":"","crontab":"","once":false,"x":130,"y":500,"wires":[["84a671e1.a3fe1"]]},{"id":"2dea6afa.f940c6","type":"http request","z":"ead0a2e8.f93de","name":"","method":"GET","ret":"txt","url":"","tls":"12802375.3fc33d","x":790,"y":320,"wires":[["934d9d87.14327"]]},{"id":"9b06e349.3e641","type":"comment","z":"ead0a2e8.f93de","name":"фото по каналу","info":"Трассир SDK.\nАдрес сервера 10.107.25.137   SDK port 8080\nПользователь SDK:\nLogin:  Axioma_XSS\nPass:  1234AaA_#\n// user:  Axioma_XSS  password: 1234AaA_#\nhttps://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir\n\n\n\n\n","x":100,"y":280,"wires":[]},{"id":"cb1896fc.1d6f98","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":100,"y":320,"wires":[["726b75fa.c2280c"]]},{"id":"934d9d87.14327","type":"debug","z":"ead0a2e8.f93de","name":"","active":false,"console":"false","complete":"false","x":950,"y":320,"wires":[]},{"id":"50a20c12.9db4b4","type":"http request","z":"ead0a2e8.f93de","name":"","method":"GET","ret":"txt","url":"","tls":"12802375.3fc33d","x":453.75,"y":395,"wires":[["73406c7b.07c164"]]},{"id":"1edfc7bb.418fc8","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":80,"y":400,"wires":[["8dc9eac6.c3549"]]},{"id":"73406c7b.07c164","type":"debug","z":"ead0a2e8.f93de","name":"","active":true,"console":"false","complete":"false","x":726.25,"y":408.75,"wires":[]},{"id":"d023a37b.a8593","type":"comment","z":"ead0a2e8.f93de","name":"Запрос списка каналов","info":"https://10.107.9.100:8080/channels?sid=asblE5uL\n","x":130,"y":360,"wires":[]},{"id":"e48355b.490f7a8","type":"http request","z":"ead0a2e8.f93de","name":"","method":"GET","ret":"txt","url":"https://10.107.9.100:8080/screenshot/B7KQRyWz?timestamp=0&sid=TruckScales-R2A08-V6","tls":"12802375.3fc33d","x":250,"y":480,"wires":[["9851eb4a.d20cf8"]]},{"id":"332cefdb.5b00a","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":80,"y":480,"wires":[["e48355b.490f7a8"]]},{"id":"9851eb4a.d20cf8","type":"debug","z":"ead0a2e8.f93de","name":"","active":true,"console":"false","complete":"false","x":450,"y":480,"wires":[]},{"id":"4c0cd7cf.9700a8","type":"comment","z":"ead0a2e8.f93de","name":"Запрос скриншота","info":"\n\n\nhttps://10.107.9.100:8080/screenshot/B7KQRyWz?timestamp=0&sid=YSC15Slf","x":770,"y":280,"wires":[]},{"id":"2e295ad7.b59eb6","type":"http in","z":"ead0a2e8.f93de","name":"","url":"/getChannel","method":"get","swaggerDoc":"","x":120,"y":180,"wires":[["63276ae5.69f1d4","bb154fd3.ebfb6"]]},{"id":"5e22a6f3.6125a8","type":"http response","z":"ead0a2e8.f93de","name":"","x":1490,"y":180,"wires":[]},{"id":"d153dd42.dedf","type":"json","z":"ead0a2e8.f93de","name":"","x":1130,"y":180,"wires":[["5e22a6f3.6125a8","29e8e25f.b86a5e","1174f16.bfe990f","dd06736a.a70e9"]]},{"id":"726b75fa.c2280c","type":"function","z":"ead0a2e8.f93de","name":"sid","func":"let sid = flow.get('sid');\nmsg.sid = sid;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":320,"wires":[["35cd492e.b592d6"]]},{"id":"35cd492e.b592d6","type":"function","z":"ead0a2e8.f93de","name":"screenshot","func":"//let guidChannel = \"G52s7jnk\";  ezoJU3It\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\n//let guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\n//let guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n//let guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\n//let guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\nvar ipTrasir = flow.get(\"ipTrasir\");\n\nlet url = `https://${ipTrasir}/screenshot/${guidChannel}?timestamp=0&sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":320,"wires":[["2dea6afa.f940c6"]]},{"id":"8c71cd98.23336","type":"comment","z":"ead0a2e8.f93de","name":"Запрос скриншота","info":"\n\n\nhttps://10.107.9.100:8080/screenshot/B7KQRyWz?timestamp=0&sid=YSC15Slf","x":110,"y":440,"wires":[]},{"id":"e00c52b3.81099","type":"comment","z":"ead0a2e8.f93de","name":"Запрос списка каналов","info":"https://10.107.9.100:8080/channels?sid=asblE5uL\n","x":130,"y":140,"wires":[]},{"id":"a04d3398.c0e84","type":"http in","z":"ead0a2e8.f93de","name":"","url":"/getScreenshot","method":"get","swaggerDoc":"","x":174,"y":662,"wires":[["a2b6f9fa.ff7c58","9cae5862.11d538"]]},{"id":"b977fff2.b405a","type":"function","z":"ead0a2e8.f93de","name":"sid","func":"// let sid = msg.payload.sid;\n// msg.sid = sid;\n\n\nmsg.sid =  flow.get('sid');\nreturn msg;","outputs":1,"noerr":0,"x":542,"y":660,"wires":[["996ced01.12eec","e1363e9e.84d7d"]]},{"id":"996ced01.12eec","type":"function","z":"ead0a2e8.f93de","name":"screenshot","func":"let guidChannel = flow.get(\"idChannel\");\nvar ipTrasir = flow.get(\"ipTrasir\");\n\nlet url = `https://${ipTrasir}/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":660,"wires":[["3bd3fa38.561dd6","857d5bf2.448a98"]]},{"id":"3bd3fa38.561dd6","type":"http request","z":"ead0a2e8.f93de","name":"","method":"GET","ret":"bin","url":"","tls":"12802375.3fc33d","x":890,"y":660,"wires":[["6434358d.b2b39c","7c112231.38d98c","d642fe95.854148"]]},{"id":"6434358d.b2b39c","type":"http response","z":"ead0a2e8.f93de","name":"","x":1130,"y":660,"wires":[]},{"id":"a2b6f9fa.ff7c58","type":"function","z":"ead0a2e8.f93de","name":"","func":"flow.set('idChannel', msg.payload.idChannel);\n\nflow.set('res', msg.res);\nflow.set('req', msg.req);\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":664,"wires":[["b977fff2.b405a"]]},{"id":"3f011df3.c864b2","type":"function","z":"ead0a2e8.f93de","name":"","func":"//'Синий кит'.indexOf('кит', 0);\nlet findComment = msg.payload.indexOf('/*',0);\nlet subString =  msg.payload.substring(\"0\", findComment);\nmsg.payload = subString;\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":180,"wires":[["9ed27948.7a7928","41d17f59.20527","494565cb.423d9c","d153dd42.dedf"]]},{"id":"3998d549.25664a","type":"comment","z":"ead0a2e8.f93de","name":"Отримання фото","info":"","x":90,"y":620,"wires":[]},{"id":"29e8e25f.b86a5e","type":"debug","z":"ead0a2e8.f93de","name":"","active":true,"console":"false","complete":"true","x":1290,"y":120,"wires":[]},{"id":"2aea504e.4c266","type":"function","z":"ead0a2e8.f93de","name":"sid","func":"// let sid = msg.payload.sid;\n// msg.sid = sid;\n\n\nmsg.sid =  flow.get('sid');\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":180,"wires":[["ff5e0be0.1b62b8"]]},{"id":"ff5e0be0.1b62b8","type":"function","z":"ead0a2e8.f93de","name":"","func":"var ipTrasir = flow.get(\"ipTrasir\");\n\nmsg.url =`https://${ipTrasir}/channels?sid=` + msg.sid;\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":180,"wires":[["c580ca20.a47608"]]},{"id":"c580ca20.a47608","type":"http request","z":"ead0a2e8.f93de","name":"","method":"GET","ret":"txt","url":"","tls":"12802375.3fc33d","x":790,"y":180,"wires":[["3f011df3.c864b2","9ed27948.7a7928","720bc4da.c4e0bc"]]},{"id":"9ed27948.7a7928","type":"debug","z":"ead0a2e8.f93de","name":"","active":true,"console":"false","complete":"false","x":1050,"y":120,"wires":[]},{"id":"32ab36d4.c0a52a","type":"file","z":"ead0a2e8.f93de","name":"","filename":"/distr/data/trasir/chanell.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1530,"y":460,"wires":[[]]},{"id":"9cae5862.11d538","type":"debug","z":"ead0a2e8.f93de","name":"","active":true,"console":"true","complete":"payload","x":400,"y":620,"wires":[]},{"id":"e1363e9e.84d7d","type":"debug","z":"ead0a2e8.f93de","name":"","active":false,"console":"false","complete":"false","x":710,"y":620,"wires":[]},{"id":"857d5bf2.448a98","type":"debug","z":"ead0a2e8.f93de","name":"","active":true,"console":"false","complete":"false","x":868,"y":720,"wires":[]},{"id":"7c112231.38d98c","type":"debug","z":"ead0a2e8.f93de","name":"","active":true,"console":"false","complete":"true","x":1130,"y":620,"wires":[]},{"id":"319ecd92.b3f322","type":"file","z":"ead0a2e8.f93de","name":"","filename":"/distr/data/trasir/origin_chanell.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1560,"y":500,"wires":[[]]},{"id":"720bc4da.c4e0bc","type":"function","z":"ead0a2e8.f93de","name":"","func":"msg.payload = {\n    date: new Date(),\n    string:msg.payload\n};\nreturn msg;\n","outputs":1,"noerr":0,"x":1310,"y":500,"wires":[["319ecd92.b3f322"]]},{"id":"41d17f59.20527","type":"function","z":"ead0a2e8.f93de","name":"","func":"msg.payload = {\n    date: new Date(),\n    string:msg.payload\n};\nreturn msg;","outputs":1,"noerr":0,"x":1310,"y":460,"wires":[["32ab36d4.c0a52a"]]},{"id":"ca26f5f4.2e8818","type":"file","z":"ead0a2e8.f93de","name":"","filename":"/distr/data/trasir/origin_chanell_json.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1570,"y":540,"wires":[[]]},{"id":"1174f16.bfe990f","type":"function","z":"ead0a2e8.f93de","name":"","func":"msg.payload = {\n    date: new Date(),\n    string:msg.payload\n};\nreturn msg;\n","outputs":1,"noerr":0,"x":1310,"y":540,"wires":[["ca26f5f4.2e8818"]]},{"id":"aa823ec3.bd413","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"","payloadType":"date","repeat":"2","crontab":"","once":false,"x":130,"y":880,"wires":[["a3b68a04.a6e688"]]},{"id":"6b034f81.c1d41","type":"http request","z":"ead0a2e8.f93de","name":"","method":"GET","ret":"obj","url":"","tls":"12802375.3fc33d","x":626,"y":886,"wires":[["f0d55462.b7b698","727a1fd3.e619a"]]},{"id":"f0d55462.b7b698","type":"function","z":"ead0a2e8.f93de","name":"sid","func":"let sid = msg.payload.sid;\nflow.set('sid', sid);\nglobal.set('sidG', sid);\nflow.set('date_Sid', new Date());\nglobal.set('sid', sid);\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":888,"wires":[[]]},{"id":"727a1fd3.e619a","type":"debug","z":"ead0a2e8.f93de","name":"","active":true,"console":"false","complete":"false","x":830,"y":840,"wires":[]},{"id":"5127bba7.c03af4","type":"comment","z":"ead0a2e8.f93de","name":"Получение sid","info":"Трассир SDK.\nАдрес сервера 10.107.25.137   SDK port 8080\nПользователь SDK:\nLogin:  Axioma_XSS\nPass:  1234AaA_#\n\nhttps://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir\n\n\n\n\n","x":100,"y":840,"wires":[]},{"id":"f802c9b6.c6f628","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":130,"y":1040,"wires":[["59915de2.0f6554"]]},{"id":"59915de2.0f6554","type":"function","z":"ead0a2e8.f93de","name":"date_now","func":"flow.set('date_now', new Date());\n\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":1040,"wires":[[]]},{"id":"a3b68a04.a6e688","type":"function","z":"ead0a2e8.f93de","name":"","func":"var sid_date = flow.get('date_Sid');\nvar date_Now = flow.get('date_now');\nvar sub_Date = date_Now - sid_date;\n\nif(sub_Date >= 60000){\n    return msg;    \n}\n\n","outputs":1,"noerr":0,"x":320,"y":880,"wires":[["e2d2fc99.a484b"]]},{"id":"1e1db9c9.560866","type":"debug","z":"ead0a2e8.f93de","name":"","active":true,"console":"false","complete":"false","x":370,"y":1120,"wires":[]},{"id":"a2fac03f.005f8","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"date_now","payloadType":"flow","repeat":"","crontab":"","once":false,"x":130,"y":1120,"wires":[["1e1db9c9.560866"]]},{"id":"cdd22ae2.9c4868","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":920,"wires":[["e2d2fc99.a484b"]]},{"id":"311726bd.4ee05a","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"date_Sid","payloadType":"flow","repeat":"","crontab":"","once":false,"x":130,"y":1160,"wires":[["1e1db9c9.560866"]]},{"id":"d64fec55.3eecd","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"sid","payloadType":"flow","repeat":"","crontab":"","once":false,"x":110,"y":1200,"wires":[["1e1db9c9.560866"]]},{"id":"5fc27d71.d5c584","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":1260,"wires":[["316ffd72.92e102"]]},{"id":"316ffd72.92e102","type":"function","z":"ead0a2e8.f93de","name":"","func":"var sid_date = flow.get('date_Sid');\nvar date_Now = flow.get('date_now');\nvar sub_Date = date_Now - sid_date;\nmsg.payload = sub_Date;\nreturn msg;    \n\n\n","outputs":1,"noerr":0,"x":280,"y":1260,"wires":[["1e1db9c9.560866"]]},{"id":"180f32ee.2cfc2d","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":100,"y":220,"wires":[["2aea504e.4c266"]]},{"id":"56c65aff.f63d44","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":1400,"wires":[["23c189a.e873d76"]]},{"id":"23c189a.e873d76","type":"function","z":"ead0a2e8.f93de","name":"screenshot","func":"var ipTrasir = flow.get(\"ipTrasir\");\nlet url = `https://${ipTrasir}/health?&sid=`;\nlet sid = flow.get('sid');\n\nmsg.url = url + sid;\n\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":1400,"wires":[["a4d53be0.b9d2b8","af2067d9.b90768"]]},{"id":"a4d53be0.b9d2b8","type":"http request","z":"ead0a2e8.f93de","name":"","method":"GET","ret":"obj","url":"","tls":"12802375.3fc33d","x":530,"y":1400,"wires":[["8d01da58.445308"]]},{"id":"8d01da58.445308","type":"debug","z":"ead0a2e8.f93de","name":"","active":true,"console":"false","complete":"false","x":710,"y":1400,"wires":[]},{"id":"21012812.8ab9a8","type":"comment","z":"ead0a2e8.f93de","name":"LOG","info":"\n\n\nhttps://10.107.9.100:8080/screenshot/B7KQRyWz?timestamp=0&sid=YSC15Slf","x":1350,"y":420,"wires":[]},{"id":"494565cb.423d9c","type":"trigger","z":"ead0a2e8.f93de","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"3","extend":false,"units":"s","reset":"","name":"","x":1450,"y":236,"wires":[["1ea0504c.602c4"]]},{"id":"dd06736a.a70e9","type":"function","z":"ead0a2e8.f93de","name":"reset","func":"msg.reset = true\nreturn msg;","outputs":1,"noerr":0,"x":1270,"y":240,"wires":[["494565cb.423d9c"]]},{"id":"a7047466.e74d28","type":"http response","z":"ead0a2e8.f93de","name":"","x":1746,"y":234,"wires":[]},{"id":"9c1b5fcc.96b07","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1440,"y":340,"wires":[["494565cb.423d9c"]]},{"id":"1ea0504c.602c4","type":"function","z":"ead0a2e8.f93de","name":"","func":"msg.payload = {\"error\": \"error parse\"};\nreturn msg;","outputs":1,"noerr":0,"x":1588,"y":232,"wires":[["a7047466.e74d28"]]},{"id":"901f3025.b8dec","type":"comment","z":"ead0a2e8.f93de","name":"Тест запиту","info":"Трассир SDK.\nАдрес сервера 10.107.9.200    SDK port 8080\nПользователь SDK:\nLogin:  Admin\nPass:  Admin@RHN_Trassir\n\nhttps://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir\n\n\n\n\n","x":110,"y":1360,"wires":[]},{"id":"eade5cc8.d8195","type":"function","z":"ead0a2e8.f93de","name":"","func":"flow.set(\"ipTrasir\", \"10.107.25.137:8080\")\n//flow.set(\"login\", \"Axioma_XSS\");\n//flow.set(\"pas\", \"1234AaA_#\");\n\nflow.set(\"login\", \"axioma23xss\");\nflow.set(\"pas\", \"1234aa023\");\n//user:operator, password: 12345\n// user:  Axioma_XSS  password: 1234AaA_#\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":100,"wires":[[]]},{"id":"d9ab2ef.aa2bfd","type":"inject","z":"ead0a2e8.f93de","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":100,"y":100,"wires":[["eade5cc8.d8195"]]},{"id":"a38bb289.fad26","type":"comment","z":"ead0a2e8.f93de","name":"Ініціалізація сервер Трасір","info":"https://10.107.9.100:8080/channels?sid=asblE5uL\n\nТрассир SDK.\nАдрес сервера 10.107.25.137   SDK port 8080\nПользователь SDK:\nLogin:  operator\nPass:  12345\n\n","x":220,"y":60,"wires":[]},{"id":"e2d2fc99.a484b","type":"function","z":"ead0a2e8.f93de","name":"url trasir","func":"var ipTrasir = flow.get(\"ipTrasir\");\n//user:operator, password: 12345\n// user:  Axioma_XSS  password: 1234AaA_#\n\nflow.get(\"login\")\nflow.get(\"pas\")\n\nvar url = `https://${ipTrasir}/login?username=${flow.get(\"login\")}&password=${flow.get(\"pas\")}`;\n//https://10.107.25.137:8080/login?username=Axioma_XSS&password=1234AaA_#\nmsg.url = url;\ndelete msg.payload;\nreturn msg;\n\n//username=Admin&password=Admin@RHN_Trassir","outputs":1,"noerr":0,"x":460,"y":880,"wires":[["6b034f81.c1d41","5a534f67.bda3c"]]},{"id":"af2067d9.b90768","type":"debug","z":"ead0a2e8.f93de","name":"","active":true,"console":"false","complete":"true","x":610,"y":1340,"wires":[]},{"id":"5a534f67.bda3c","type":"debug","z":"ead0a2e8.f93de","name":"","active":true,"console":"false","complete":"true","x":610,"y":840,"wires":[]},{"id":"8dc9eac6.c3549","type":"function","z":"ead0a2e8.f93de","name":"","func":"\nvar ipTrasir = flow.get(\"ipTrasir\");\n\nmsg.url =`https://${ipTrasir}/channels?sid=` + flow.get('sid');\n\nreturn msg;","outputs":1,"noerr":0,"x":256.25,"y":397.5,"wires":[["50a20c12.9db4b4"]]},{"id":"1be45c.445c3ba5","type":"debug","z":"ead0a2e8.f93de","name":"","active":false,"console":"false","complete":"false","x":1238,"y":722,"wires":[]},{"id":"d642fe95.854148","type":"converter","z":"ead0a2e8.f93de","name":"","from":"1251","x":1080,"y":720,"wires":[["1be45c.445c3ba5"]]},{"id":"a3bbbafe.83e4d8","type":"inject","z":"55db58b3.1c1c98","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1843.75,"y":791.25,"wires":[["2793fc63.b48bf4"]]},{"id":"64ee4b0.f09ea34","type":"debug","z":"55db58b3.1c1c98","name":"","active":false,"console":"false","complete":"false","x":3106.25,"y":581.25,"wires":[]},{"id":"678a450a.d793e4","type":"converter","z":"55db58b3.1c1c98","name":"","from":"1251","x":2872.5,"y":568.75,"wires":[["64ee4b0.f09ea34"]]},{"id":"f1d77115.63c648","type":"function","z":"73798026.159ca","name":"screenshot","func":"let guidChannel = \"J4tGVBrG\";// guid channal\n\nlet url = `https://10.107.25.137:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\n//msg.res = flow.get('res');\n//msg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":2597.143112182617,"y":715.7142143249512,"wires":[["316c874b.cbe758"]]},{"id":"52e009cd.f72a98","type":"function","z":"73798026.159ca","name":"screenshot","func":"let guidChannel = \"WSEnsnv7\";// guid channal\n\nlet url = `https://10.107.25.137:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\n//msg.res = flow.get('res');\n//msg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":2598.142993927002,"y":780.8572425842285,"wires":[["cc53f832.41b7f8"]]},{"id":"dd5951a5.3f2e8","type":"function","z":"73798026.159ca","name":"screenshot","func":"let guidChannel = \"yP3HG413\";// guid channal\n\nlet url = `https://10.107.25.137:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\n//msg.res = flow.get('res');\n//msg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":2598.5716514587402,"y":840.5713748931885,"wires":[["be5a43b0.470d"]]},{"id":"93eee308.ccad78","type":"function","z":"55db58b3.1c1c98","name":"screenshot","func":"let guidChannel = \"dvUIp9PM\";// guid channal\n\nlet url = `https://10.107.25.137:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\n//msg.res = flow.get('res');\n//msg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":2558.571590423584,"y":704.2857074737549,"wires":[["453c3a37.450144"]]},{"id":"44b4b609.928a8","type":"function","z":"55db58b3.1c1c98","name":"screenshot","func":"let guidChannel = \"Nkus0GqG\";// guid channal\n\nlet url = `https://10.107.25.137:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\n//msg.res = flow.get('res');\n//msg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":2567.142807006836,"y":799.9999694824219,"wires":[["e2440857.72d068"]]},{"id":"35aaa73d.b0e1e8","type":"function","z":"55db58b3.1c1c98","name":"screenshot","func":"let guidChannel = \"XRYYoTYw\";// guid channal\n\nlet url = `https://10.107.25.137:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\n//msg.res = flow.get('res');\n//msg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":2555.7143783569336,"y":908.5714149475098,"wires":[["65b4fdd3.f46c54"]]},{"id":"9f04edef.9a1458","type":"inject","z":"b744ff99.c78b6","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"x":708,"y":152,"wires":[["23a52e15.7a8272"]]},{"id":"868b0ba.a6d62f8","type":"inject","z":"b744ff99.c78b6","name":"","topic":"","payload":"1000","payloadType":"num","repeat":"","crontab":"","once":false,"x":704,"y":193,"wires":[["23a52e15.7a8272"]]},{"id":"ea66a5ae.49e9b","type":"inject","z":"25dc673e.e08538","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"x":690,"y":180,"wires":[["1ee14ec0.c90901"]]},{"id":"bc3d198f.269a88","type":"inject","z":"25dc673e.e08538","name":"","topic":"","payload":"2000","payloadType":"num","repeat":"","crontab":"","once":false,"x":686,"y":221,"wires":[["1ee14ec0.c90901"]]},{"id":"d77dad40.096528","type":"inject","z":"104f345f.4f25ac","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1095.0000228881836,"y":688.3333702087402,"wires":[["da612a8f.cb3c68"]]},{"id":"35072815.af8b18","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1618.333375295003,"y":1230.0000268618264,"wires":[["ac2b80ed.95e578"]]},{"id":"ac2b80ed.95e578","type":"function","z":"38f5b6db.4b422a","name":"<s1> 12345","func":"msg.payload = \"<s1>12345\"\nreturn msg;","outputs":1,"noerr":0,"x":1786.666648864746,"y":1226.6666059494019,"wires":[["198c93f1.2fc364"]]},{"id":"198c93f1.2fc364","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1986.666618347168,"y":1221.6666021347046,"wires":[["876e5bb6.c96718","b10be59e.084758"]]},{"id":"48458999.509eb8","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1623.333293914795,"y":1274.9999861717224,"wires":[["876b9d17.798d78"]]},{"id":"876b9d17.798d78","type":"function","z":"38f5b6db.4b422a","name":"<s1> Очікуйте ","func":"msg.payload = \"<s1> Очікуйте\"\nreturn msg;","outputs":1,"noerr":0,"x":1801.666567484538,"y":1271.6665652592978,"wires":[["198c93f1.2fc364"]]},{"id":"26247422.3ef3bc","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1606.6666259765625,"y":1654.9998779296875,"wires":[["7ce03371.7959ec"]]},{"id":"7ce03371.7959ec","type":"function","z":"38f5b6db.4b422a","name":"<s1> 12345","func":"msg.payload = \"<s1> 12345\"\nreturn msg;","outputs":1,"noerr":0,"x":1774.9998995463056,"y":1651.666457017263,"wires":[["44e79020.140ac8"]]},{"id":"44e79020.140ac8","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1981.6666145324707,"y":1658.3332471847534,"wires":[["2508a58c.9154ca"]]},{"id":"804b0c96.1053d","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1611.6665445963545,"y":1699.9998372395835,"wires":[["2d4907ad.8706b8"]]},{"id":"2d4907ad.8706b8","type":"function","z":"38f5b6db.4b422a","name":"<s1> Очікуйте ","func":"msg.payload = \"<s1> Очікуйте\"\nreturn msg;","outputs":1,"noerr":0,"x":1789.9998181660976,"y":1696.666416327159,"wires":[["44e79020.140ac8"]]},{"id":"b5d3237.edd8ce","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1668.333251953125,"y":2073.333251953125,"wires":[["c09dec0f.aac6f"]]},{"id":"c09dec0f.aac6f","type":"function","z":"38f5b6db.4b422a","name":"<s1> 12345","func":"msg.payload = \"<s1> 12345\"\nreturn msg;","outputs":1,"noerr":0,"x":1836.6665255228681,"y":2069.9998310407004,"wires":[["16965c0b.9aee1c"]]},{"id":"16965c0b.9aee1c","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":2008.333170572917,"y":2063.333211263021,"wires":[["b388898d.d95568","128bfbb4.4d9c6c"]]},{"id":"60b60f93.292028","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1673.333170572917,"y":2118.333211263021,"wires":[["467368d5.8d394"]]},{"id":"467368d5.8d394","type":"function","z":"38f5b6db.4b422a","name":"<s1> Очікуйте ","func":"msg.payload = \"<s1> Очікуйте\"\nreturn msg;","outputs":1,"noerr":0,"x":1851.66644414266,"y":2114.9997903505964,"wires":[["16965c0b.9aee1c"]]},{"id":"c19aa54f.7b2e78","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1693.333251953125,"y":2405,"wires":[["52bf4951.f1566"]]},{"id":"52bf4951.f1566","type":"function","z":"38f5b6db.4b422a","name":"<s1> 12345","func":"msg.payload = \"<s1> 12345\"\nreturn msg;","outputs":1,"noerr":0,"x":1861.6665255228681,"y":2401.6665790875754,"wires":[["e70899e1.1538f"]]},{"id":"e70899e1.1538f","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":2033.333170572917,"y":2394.999959309896,"wires":[["89fa44e1.ccfd18"]]},{"id":"3cd834a7.e4e5f4","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1676.3331298828125,"y":2452,"wires":[["655bfc8b.cd20e4"]]},{"id":"655bfc8b.cd20e4","type":"function","z":"38f5b6db.4b422a","name":"<s1> Очікуйте ","func":"msg.payload = \"<s1> Очікуйте\"\nreturn msg;","outputs":1,"noerr":0,"x":1854.6664034525556,"y":2448.6665790875754,"wires":[["e70899e1.1538f"]]},{"id":"93d3c182.eaf5b8","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1694.666585286458,"y":2493.666544596354,"wires":[["f267f997.fbabc8"]]},{"id":"f267f997.fbabc8","type":"function","z":"38f5b6db.4b422a","name":"<s2> тест","func":"msg.payload = \"<s2> тест\"\nreturn msg;","outputs":1,"noerr":0,"x":1862.9998588562012,"y":2490.3331236839294,"wires":[["e70899e1.1538f"]]},{"id":"81ff6cd7.de0ae8","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1623.333251953125,"y":1318.333251953125,"wires":[["d065070b.e72b58"]]},{"id":"d065070b.e72b58","type":"function","z":"38f5b6db.4b422a","name":"<s2> тест","func":"msg.payload = \"<s2> тест\"\nreturn msg;","outputs":1,"noerr":0,"x":1791.6665255228681,"y":1314.9998310407004,"wires":[["198c93f1.2fc364"]]},{"id":"7590508a.a4aad","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1616.6666259765625,"y":1741.6666259765625,"wires":[["9a66b80.dda6f48"]]},{"id":"9a66b80.dda6f48","type":"function","z":"38f5b6db.4b422a","name":"<s2> тест","func":"msg.payload = \"<s2> тест\"\nreturn msg;","outputs":1,"noerr":0,"x":1784.9998995463056,"y":1738.333205064138,"wires":[["44e79020.140ac8"]]},{"id":"9eb0e29a.8540a","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1678.333251953125,"y":2158.333251953125,"wires":[["1e06df4.c0b15a1"]]},{"id":"1e06df4.c0b15a1","type":"function","z":"38f5b6db.4b422a","name":"<s2> тест","func":"msg.payload = \"<s2> тест\"\nreturn msg;","outputs":1,"noerr":0,"x":1846.6665255228681,"y":2154.9998310407004,"wires":[["16965c0b.9aee1c"]]},{"id":"16124182.44585e","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1616,"y":2875,"wires":[["d572a72a.57abd"]]},{"id":"d572a72a.57abd","type":"function","z":"38f5b6db.4b422a","name":"<s1> 12345","func":"msg.payload = \"<s1> 12345\"\nreturn msg;","outputs":1,"noerr":0,"x":1784.3332735697431,"y":2871.6665790875754,"wires":[["fe11f681.e3ef7"]]},{"id":"fe11f681.e3ef7","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1955.999918619792,"y":2864.999959309896,"wires":[["e283f04f.eb73c"]]},{"id":"9532781b.ff2298","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1620.999918619792,"y":2919.999959309896,"wires":[["5772de55.339b7"]]},{"id":"5772de55.339b7","type":"function","z":"38f5b6db.4b422a","name":"<s1> Очікуйте ","func":"msg.payload = \"<s1> Очікуйте\"\nreturn msg;","outputs":1,"noerr":0,"x":1799.333192189535,"y":2916.6665383974714,"wires":[["fe11f681.e3ef7"]]},{"id":"ef2e1b03.8dc0c","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1639.3333740234375,"y":2961.66650390625,"wires":[["cc0b66c4.188c98"]]},{"id":"cc0b66c4.188c98","type":"function","z":"38f5b6db.4b422a","name":"<s2> тест","func":"msg.payload = \"<s2> тест\"\nreturn msg;","outputs":1,"noerr":0,"x":1807.6666475931806,"y":2958.3330829938254,"wires":[["fe11f681.e3ef7"]]},{"id":"928ef496.aea4b8","type":"debug","z":"38f5b6db.4b422a","name":"Автовигрузка 2","active":true,"console":"false","complete":"true","x":1683.3332824707031,"y":138.3333225250244,"wires":[]},{"id":"2bf3033a.753664","type":"debug","z":"38f5b6db.4b422a","name":"Автовигрузка 3","active":true,"console":"false","complete":"true","x":1678.333251953125,"y":275,"wires":[]},{"id":"dcd07e2c.70645","type":"debug","z":"38f5b6db.4b422a","name":"Автовигрузка 4","active":true,"console":"false","complete":"true","x":1685,"y":420,"wires":[]},{"id":"f340794d.1cc65","type":"debug","z":"38f5b6db.4b422a","name":"KPP","active":true,"console":"false","complete":"true","x":1690,"y":560,"wires":[]},{"id":"876e5bb6.c96718","type":"debug","z":"38f5b6db.4b422a","name":"KPP","active":true,"console":"false","complete":"true","x":2333.333236694336,"y":1234.99995470047,"wires":[]},{"id":"e7b314da.51e79","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1127.0833053588867,"y":706.25,"wires":[["5afa5124.70d478"]]},{"id":"5afa5124.70d478","type":"function","z":"38f5b6db.4b422a","name":"<s1>12345","func":"msg.payload = \"<s1>12345\"\nreturn msg;","outputs":1,"noerr":0,"x":1270.4165878295898,"y":706.6665649414062,"wires":[["fd030eab.b2eba8"]]},{"id":"fd030eab.b2eba8","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":1678.333170572917,"y":709.999959309896,"wires":[["76f14798.231828"]]},{"id":"12fd59ee.1c21c6","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1338.3331298828125,"y":743.7499084472656,"wires":[["aa6f41d4.986508"]]},{"id":"aa6f41d4.986508","type":"function","z":"38f5b6db.4b422a","name":"<s1> Очікуйте ","func":"msg.payload = \"<s1> Очікуйте\"\nreturn msg;","outputs":1,"noerr":0,"x":1490.4165649414062,"y":745.4165649414062,"wires":[["fd030eab.b2eba8"]]},{"id":"a30e6eda.3f1788","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1337.0831298828125,"y":784.583251953125,"wires":[["128d922b.e90b06"]]},{"id":"128d922b.e90b06","type":"function","z":"38f5b6db.4b422a","name":"<s2> тест","func":"msg.payload = \"<s2> тест\"\nreturn msg;","outputs":1,"noerr":0,"x":1481.6663818359375,"y":787.4998168945312,"wires":[["fd030eab.b2eba8"]]},{"id":"9ff9c56f.7d2808","type":"inject","z":"e6ad0c7b.94dac","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":163.3333282470703,"y":3481.66650390625,"wires":[["1b9fc65e.f1089a","17646cad.3f186b"]]},{"id":"1b9fc65e.f1089a","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = '<s1>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":313.3333282470703,"y":3481.66650390625,"wires":[["359615b.ad4d76a"]]},{"id":"359615b.ad4d76a","type":"converter","z":"e6ad0c7b.94dac","name":"","from":"win1251","x":463.3333282470703,"y":3501.66650390625,"wires":[[]]},{"id":"17646cad.3f186b","type":"function","z":"e6ad0c7b.94dac","name":"","func":"msg.payload = '<s2>діма Липа'\nreturn msg;","outputs":1,"noerr":0,"x":313.3333282470703,"y":3521.66650390625,"wires":[["359615b.ad4d76a"]]},{"id":"b388898d.d95568","type":"debug","z":"38f5b6db.4b422a","name":"","active":true,"console":"false","complete":"false","x":2181.6667404174805,"y":2035.833293914795,"wires":[]},{"id":"ee355eb0.1acfe","type":"debug","z":"38f5b6db.4b422a","name":"","active":true,"console":"false","complete":"false","x":2078.333333333333,"y":2166.6666666666665,"wires":[]},{"id":"7bc157d7.9bff68","type":"tcp request","z":"38f5b6db.4b422a","server":"10.107.21.31","port":"49004","out":"time","splitc":"100","name":"","x":1743.75,"y":615,"wires":[["f340794d.1cc65"]]},{"id":"7ec9307f.a07018","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1330,"y":822.5,"wires":[["84ad80c6.10cf08"]]},{"id":"84ad80c6.10cf08","type":"function","z":"38f5b6db.4b422a","name":"<s3> тест","func":"msg.payload = \"<s3> тест\"\nreturn msg;","outputs":1,"noerr":0,"x":1482.083251953125,"y":826.6665649414062,"wires":[["fd030eab.b2eba8"]]},{"id":"f1865c11.69ccf","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1582.5,"y":878.75,"wires":[["b3c37754.3fe6d8","58756dc1.bfbc54","5fefa0db.ce7e68"]]},{"id":"b3c37754.3fe6d8","type":"function","z":"38f5b6db.4b422a","name":"<s1> ","func":"msg.payload = \"<s1> \"\nreturn msg;","outputs":1,"noerr":0,"x":1746.25,"y":838.75,"wires":[["fd030eab.b2eba8"]]},{"id":"58756dc1.bfbc54","type":"function","z":"38f5b6db.4b422a","name":"<s2> ","func":"msg.payload = \"<s2> \"\nreturn msg;","outputs":1,"noerr":0,"x":1753.75,"y":881.25,"wires":[["fd030eab.b2eba8"]]},{"id":"5fefa0db.ce7e68","type":"function","z":"38f5b6db.4b422a","name":"<s3> ","func":"msg.payload = \"<s3> \"\nreturn msg;","outputs":1,"noerr":0,"x":1745,"y":922.5,"wires":[["fd030eab.b2eba8"]]},{"id":"b10be59e.084758","type":"tcp request","z":"38f5b6db.4b422a","server":"10.107.21.30","port":"49005","out":"time","splitc":"100","name":"","x":2371.6666717529297,"y":1086.2499771118164,"wires":[[]]},{"id":"9cffc8d9.8fac48","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1800,"y":1358.75,"wires":[["5f3a1fb5.536358","55c0d45f.413294"]]},{"id":"5f3a1fb5.536358","type":"function","z":"38f5b6db.4b422a","name":"<s1> ","func":"msg.payload = \"<s1> \"\nreturn msg;","outputs":1,"noerr":0,"x":1963.75,"y":1318.75,"wires":[["198c93f1.2fc364"]]},{"id":"55c0d45f.413294","type":"function","z":"38f5b6db.4b422a","name":"<s2> ","func":"msg.payload = \"<s2> \"\nreturn msg;","outputs":1,"noerr":0,"x":1971.25,"y":1361.25,"wires":[["198c93f1.2fc364"]]},{"id":"2508a58c.9154ca","type":"tcp request","z":"38f5b6db.4b422a","server":"10.107.21.27","port":"49003","out":"time","splitc":"100","name":"","x":2373.3331756591797,"y":1512.9166831970215,"wires":[[]]},{"id":"7f8699f8.e0a2f","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1810,"y":1785,"wires":[["7a171bfe.48730c","7c408c8.4d445f4"]]},{"id":"7a171bfe.48730c","type":"function","z":"38f5b6db.4b422a","name":"<s1> ","func":"msg.payload = \"<s1> \"\nreturn msg;","outputs":1,"noerr":0,"x":1973.75,"y":1745,"wires":[["2508a58c.9154ca"]]},{"id":"7c408c8.4d445f4","type":"function","z":"38f5b6db.4b422a","name":"<s2> ","func":"msg.payload = \"<s2> \"\nreturn msg;","outputs":1,"noerr":0,"x":1981.25,"y":1787.5,"wires":[["2508a58c.9154ca"]]},{"id":"128bfbb4.4d9c6c","type":"tcp request","z":"38f5b6db.4b422a","server":"10.107.21.28","port":"49002","out":"time","splitc":"100","name":"","x":2370,"y":1940,"wires":[[]]},{"id":"831f19ca.76973","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":2043.75,"y":2120,"wires":[["158aef79.20b331","b97f3a1c.246f38"]]},{"id":"158aef79.20b331","type":"function","z":"38f5b6db.4b422a","name":"<s1> ","func":"msg.payload = \"<s1> \"\nreturn msg;","outputs":1,"noerr":0,"x":2207.5,"y":2080,"wires":[["16965c0b.9aee1c"]]},{"id":"b97f3a1c.246f38","type":"function","z":"38f5b6db.4b422a","name":"<s2> ","func":"msg.payload = \"<s2> \"\nreturn msg;","outputs":1,"noerr":0,"x":2215,"y":2122.5,"wires":[["16965c0b.9aee1c"]]},{"id":"225eb1a2.a2199e","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":2093.75,"y":2481.25,"wires":[["5a3a2bcf.c76cec"]]},{"id":"ad05a8b5.fca4d","type":"function","z":"38f5b6db.4b422a","name":"<s1> ","func":"msg.payload = \"<s1> \"\nreturn msg;","outputs":1,"noerr":0,"x":2257.5,"y":2441.25,"wires":[["e70899e1.1538f"]]},{"id":"5a3a2bcf.c76cec","type":"function","z":"38f5b6db.4b422a","name":"<s2> ","func":"msg.payload = \"<s2> \"\nreturn msg;","outputs":1,"noerr":0,"x":2265,"y":2483.75,"wires":[["e70899e1.1538f"]]},{"id":"76f14798.231828","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1861.25,"y":725,"wires":[["7bc157d7.9bff68","f340794d.1cc65"]]},{"id":"36196884.67258","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":2095,"y":2438.333251953125,"wires":[["ad05a8b5.fca4d"]]},{"id":"560a0af7.23d80c","type":"comment","z":"38f5b6db.4b422a","name":"2 string","info":"","x":2543.3331565856934,"y":2254.9998931884766,"wires":[]},{"id":"fd2a2661.87f288","type":"comment","z":"38f5b6db.4b422a","name":"1 string","info":"","x":2553.333282470703,"y":1956.6666069030762,"wires":[]},{"id":"bacd635f.71d6d","type":"comment","z":"38f5b6db.4b422a","name":"1 string","info":"","x":2601.666530609131,"y":1081.6666040420532,"wires":[]},{"id":"b9d154a5.e2cf08","type":"debug","z":"628e4e9b.6792d","name":"","active":true,"console":"false","complete":"true","x":590,"y":240,"wires":[]},{"id":"5e7a25ec.ee425c","type":"json","z":"628e4e9b.6792d","name":"","x":301.25,"y":242.5,"wires":[["b9d154a5.e2cf08"]]},{"id":"571df7f5.0a173","type":"converter","z":"628e4e9b.6792d","name":"","from":"win1251","x":163.75,"y":238.75,"wires":[["5e7a25ec.ee425c"]]},{"id":"38afe6.9e92181a","type":"comment","z":"38f5b6db.4b422a","name":"1 string","info":"","x":2594.999786376953,"y":1503.9999961853027,"wires":[]},{"id":"d377c68.259de38","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1964.9999237060547,"y":518.3333072662354,"wires":[["132581b6.da061e"]]},{"id":"132581b6.da061e","type":"function","z":"38f5b6db.4b422a","name":"<s1> 12345","func":"msg.payload = \"<s1> 12345\"\nreturn msg;","outputs":1,"noerr":0,"x":2133.333197275798,"y":514.9998863538108,"wires":[["39fe2de3.710b02"]]},{"id":"39fe2de3.710b02","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":2304.9998423258467,"y":508.33326657613134,"wires":[["b14734b1.6bf608"]]},{"id":"e130c1d7.f71cb8","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1958.3332061767578,"y":564.9999475479126,"wires":[["753f3cb0.5b1454"]]},{"id":"753f3cb0.5b1454","type":"function","z":"38f5b6db.4b422a","name":"<s1> Очікуйте ","func":"msg.payload = \"<s1> Очікуйте\"\nreturn msg;","outputs":1,"noerr":0,"x":2148.33311589559,"y":559.9998456637068,"wires":[["39fe2de3.710b02"]]},{"id":"bdf8d7e4.82c2b8","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1988.3332977294922,"y":604.9998111724854,"wires":[["f3024609.5797e"]]},{"id":"f3024609.5797e","type":"function","z":"38f5b6db.4b422a","name":"<s2> тест","func":"msg.payload = \"<s2> тест\"\nreturn msg;","outputs":1,"noerr":0,"x":2156.6665712992353,"y":601.6663902600608,"wires":[["39fe2de3.710b02"]]},{"id":"8720dfca.dfa4f8","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1928.333251953125,"y":356.6666564941406,"wires":[["3381616f.e10256"]]},{"id":"3381616f.e10256","type":"function","z":"38f5b6db.4b422a","name":"<s1> 12345","func":"msg.payload = \"<s1> 12345\"\nreturn msg;","outputs":1,"noerr":0,"x":2096.666525522868,"y":353.33323558171605,"wires":[["cfa40e04.a3184"]]},{"id":"cfa40e04.a3184","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":2268.333170572917,"y":346.6666158040366,"wires":[["5bedab30.6cd194"]]},{"id":"466c7884.69022","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1933.333170572917,"y":401.6666158040366,"wires":[["6879c414.e3428c"]]},{"id":"6879c414.e3428c","type":"function","z":"38f5b6db.4b422a","name":"<s1> Очікуйте ","func":"msg.payload = \"<s1> Очікуйте\"\nreturn msg;","outputs":1,"noerr":0,"x":2111.66644414266,"y":398.33319489161204,"wires":[["cfa40e04.a3184"]]},{"id":"ef332fb0.ae02f8","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1951.6666259765625,"y":443.3331604003906,"wires":[["5de5d500.d7a10c"]]},{"id":"5de5d500.d7a10c","type":"function","z":"38f5b6db.4b422a","name":"<s2> тест","func":"msg.payload = \"<s2> тест\"\nreturn msg;","outputs":1,"noerr":0,"x":2119.9998995463056,"y":439.99973948796605,"wires":[["cfa40e04.a3184"]]},{"id":"c555d57a.faff6","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1941.6666259765625,"y":176.66665649414062,"wires":[["e6eb3c95.ce9438"]]},{"id":"e6eb3c95.ce9438","type":"function","z":"38f5b6db.4b422a","name":"<s1> 12345","func":"msg.payload = \"<s1> 12345\"\nreturn msg;","outputs":1,"noerr":0,"x":2109.9998995463056,"y":173.33323558171605,"wires":[["e2f20f78.4013d8"]]},{"id":"e2f20f78.4013d8","type":"converter","z":"38f5b6db.4b422a","name":"","from":"win1251","x":2281.6665445963545,"y":166.6666158040366,"wires":[["397de245.416f0e"]]},{"id":"488d304b.ea1258","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1946.6665445963545,"y":221.6666158040366,"wires":[["17836614.890a92"]]},{"id":"17836614.890a92","type":"function","z":"38f5b6db.4b422a","name":"<s1> Очікуйте ","func":"msg.payload = \"<s1> Очікуйте\"\nreturn msg;","outputs":1,"noerr":0,"x":2124.9998181660976,"y":218.33319489161204,"wires":[["e2f20f78.4013d8"]]},{"id":"15ff6326.b70e6d","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1965,"y":263.3331604003906,"wires":[["31b81d85.59b282"]]},{"id":"31b81d85.59b282","type":"function","z":"38f5b6db.4b422a","name":"<s2> тест","func":"msg.payload = \"<s2> тест\"\nreturn msg;","outputs":1,"noerr":0,"x":2133.333273569743,"y":259.99973948796605,"wires":[["e2f20f78.4013d8"]]},{"id":"e283f04f.eb73c","type":"tcp request","z":"38f5b6db.4b422a","server":"10.107.21.37","port":"49001","out":"time","splitc":"100","name":"","x":2419.9998168945312,"y":2741.666576385498,"wires":[[]]},{"id":"5bed908b.aa3d","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1776.6666259765625,"y":3055,"wires":[["e4649f17.be69c8"]]},{"id":"79bcb7a1.7b1568","type":"function","z":"38f5b6db.4b422a","name":"<s1> ","func":"msg.payload = \"<s1> \"\nreturn msg;","outputs":1,"noerr":0,"x":1940.4166259765625,"y":3015,"wires":[["e283f04f.eb73c"]]},{"id":"e4649f17.be69c8","type":"function","z":"38f5b6db.4b422a","name":"<s2> ","func":"msg.payload = \"<s2> \"\nreturn msg;","outputs":1,"noerr":0,"x":1947.9166259765625,"y":3057.5,"wires":[["e283f04f.eb73c"]]},{"id":"5bbe48f8.ddf1e","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1777.9166259765625,"y":3012.083251953125,"wires":[["79bcb7a1.7b1568"]]},{"id":"f89bf83.d622408","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":143.33333333333331,"y":373.33333333333326,"wires":[["84cbe3fd.a7dee"]]},{"id":"b59899c2.29d91","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1444.9999999999998,"y":206.66666666666663,"wires":[["397de245.416f0e"]]},{"id":"3d99f49a.6d733c","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1466.6666259765625,"y":333.33331298828125,"wires":[["5bedab30.6cd194"]]},{"id":"bae2ff0e.fe789","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1464.9999237060547,"y":481.6666202545166,"wires":[["b14734b1.6bf608"]]},{"id":"80ea258c.7869b8","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1445,"y":616.6666259765625,"wires":[["7bc157d7.9bff68"]]},{"id":"c1ccfd5c.d0dad8","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1456.6666259765625,"y":658.3333129882812,"wires":[["7bc157d7.9bff68"]]},{"id":"f4258f54.e9be4","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1959.9998779296875,"y":1016.6666011810303,"wires":[["b10be59e.084758"]]},{"id":"9a3ab742.65c718","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1949.9998779296875,"y":1153.333251953125,"wires":[["b10be59e.084758"]]},{"id":"9e742f25.8056e","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1891.6666259765625,"y":1590,"wires":[["2508a58c.9154ca"]]},{"id":"3692952b.862692","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1861.6666259765625,"y":1485,"wires":[["2508a58c.9154ca"]]},{"id":"e1321565.574fe","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1891.6666259765625,"y":2011.6666259765625,"wires":[["128bfbb4.4d9c6c"]]},{"id":"8d410bd7.0b2ad8","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1875,"y":1928.333251953125,"wires":[["128bfbb4.4d9c6c"]]},{"id":"32247c49.3b1f34","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1880,"y":2341.66650390625,"wires":[["89fa44e1.ccfd18"]]},{"id":"cd302b3a.e274d","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1890,"y":2256.66650390625,"wires":[[]]},{"id":"73f6a5d0.cbd99c","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1886.6666259765625,"y":2800,"wires":[["e283f04f.eb73c"]]},{"id":"1e2345.ec0ce4bb","type":"delay","z":"38f5b6db.4b422a","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1873.333251953125,"y":2710,"wires":[["e283f04f.eb73c"]]},{"id":"f2b354f7.3a88a8","type":"xml","z":"e6ad0c7b.94dac","name":"","attr":"","chr":"","x":697.142879486084,"y":1121.4285879135132,"wires":[["b2daf5ad.82a848"]]},{"id":"b2daf5ad.82a848","type":"function","z":"e6ad0c7b.94dac","name":"","func":"var btn0 = msg.payload.response.btn0.join();\nvar btn1 = msg.payload.response.btn1.join();\nvar btn2 = msg.payload.response.btn2.join();\nvar btn3 = msg.payload.response.btn3.join();\n\n\nmsg.payload = {\n    response:[{btn0},{btn1},{btn2},{btn3}]\n        \n    \n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":828.5715084075928,"y":1124.2857656478882,"wires":[["3fee9522.e61b42"]]},{"id":"3fee9522.e61b42","type":"debug","z":"e6ad0c7b.94dac","name":"","active":true,"console":"false","complete":"true","x":964.2858695983887,"y":1122.8571071624756,"wires":[]},{"id":"4a77fb75.b2ca24","type":"debug","z":"38f5b6db.4b422a","name":"праві ваги","active":true,"console":"false","complete":"true","x":1670,"y":1820,"wires":[]},{"id":"16f9e330.55e9cd","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":"false","complete":"true","x":410,"y":140,"wires":[]},{"id":"7060908e.32214","type":"xml","z":"d3d5daa0.5f1058","name":"","attr":"","chr":"","x":750,"y":340,"wires":[["670ae3f2.f98e6c"]]},{"id":"2528ab0.1e1f556","type":"comment","z":"e6ad0c7b.94dac","name":"","info":"0 - праві на ваги\n1 - праві від вагів\n2 - ліві на ваги\n3 - ліві від вагів","x":1120,"y":120,"wires":[]},{"id":"48833271.d5c3dc","type":"comment","z":"c94645b6.8b6ca8","name":"ближче до воріт","info":"0 - праві на ваги\n1 - праві від вагів\n2 - ліві на ваги\n3 - ліві від вагів","x":1260,"y":2480,"wires":[]},{"id":"d4867d1.405438","type":"comment","z":"e6ad0c7b.94dac","name":"Дальні","info":"0 - праві на ваги\n1 - праві від вагів\n4 - ліві від ваги\n5 - ліві на  вагів","x":1230,"y":1460,"wires":[]},{"id":"477d47b1.43c058","type":"comment","z":"c94645b6.8b6ca8","name":"Дальні","info":"0 - праві на ваги\n1 - праві від вагів\n4 - ліві від ваги\n5 - ліві на  вагів","x":1270,"y":2560,"wires":[]},{"id":"1b14bc80.e0c964","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":"false","complete":"true","x":830,"y":60,"wires":[]},{"id":"7225fecb.435fa","type":"inject","z":"c94645b6.8b6ca8","name":"","topic":"","payload":"{ \"ip\": \"10.107.21.44\", \"login\": \"admin\", \"password\": \"admin\", \"led\": 0, \"status\": false, \"url\": \"http://admin:admin@10.107.21.44/protect/leds.cgi?led=0&timeout=0\" }","payloadType":"json","repeat":"","crontab":"","once":false,"x":150,"y":160,"wires":[["506eaae1.e32b14","16f9e330.55e9cd"]]},{"id":"33b7fe92.185f52","type":"comment","z":"f4c119b9.194fb8","name":"","info":"0 - на дорогу\n1 - на елеватор\n2 - на дорогу\n3 - на елеватор","x":900,"y":220,"wires":[]},{"id":"146c88ff.09bed7","type":"comment","z":"c94645b6.8b6ca8","name":"кпп","info":"0 - на дорогу\n1 - на елеватор\n2 - на дорогу\n3 - на елеватор","x":1210,"y":2380,"wires":[]},{"id":"d7d51073.5570a","type":"http response","z":"c94645b6.8b6ca8","name":"","x":890,"y":380,"wires":[]},{"id":"4f520b02.9ceb14","type":"switch","z":"c94645b6.8b6ca8","name":"","property":"restore","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":730,"y":380,"wires":[[],["d7d51073.5570a"]]},{"id":"8d21fc4a.8cbc4","type":"http response","z":"c94645b6.8b6ca8","name":"","x":870,"y":520,"wires":[]},{"id":"a8383dfa.c5962","type":"http response","z":"c94645b6.8b6ca8","name":"","x":870,"y":660,"wires":[]},{"id":"dade6e0e.72271","type":"http response","z":"c94645b6.8b6ca8","name":"","x":810,"y":860,"wires":[]},{"id":"822fb117.832e7","type":"comment","z":"c94645b6.8b6ca8","name":"Нові","info":"виключений - червоний\nвключене - зелене\nled=0\n\n\n","x":360,"y":960,"wires":[]},{"id":"3a176a2f.6c1566","type":"inject","z":"73798026.159ca","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1740,"y":840,"wires":[["84afd09c.f2c9a"]]},{"id":"f6523ce6.c8aa3","type":"debug","z":"73798026.159ca","name":"","active":true,"console":"false","complete":"false","x":3050,"y":620,"wires":[]},{"id":"6062d0b0.739fa","type":"inject","z":"73798026.159ca","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":580,"y":1520,"wires":[["f8018911.30ff48"]]},{"id":"f8018911.30ff48","type":"function","z":"73798026.159ca","name":"init conf  send 1C","func":" msg.payload = {\n     truck_id: \"e200001d17190086170034e3\" ,\n     reader: \"786db0fc-d507-11ec-b828-0050569a4283\"\n }\n    return msg; \n","outputs":1,"noerr":0,"x":750,"y":1520,"wires":[["ee7f0ce2.614f2"]]},{"id":"e0c58eef.028c1","type":"tcp request","z":"25dc673e.e08538","server":"10.107.21.22","port":"9765","out":"char","splitc":"0x03","name":"","x":320,"y":320,"wires":[["8da36bed.1cdd78","8e9faff3.b2f78","ddede03c.0ad16"]]},{"id":"9c2d6a11.940eb8","type":"debug","z":"73798026.159ca","name":"","active":true,"console":"false","complete":"true","x":1890,"y":260,"wires":[]},{"id":"c5bcfee8.6426f","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":"false","complete":"true","x":490,"y":860,"wires":[]},{"id":"5bdb1eaa.15057","type":"inject","z":"c94645b6.8b6ca8","name":"","topic":"","payload":"{\"ip\":\"10.107.21.11\",\"login\":\"admin\",\"password\":\"admin\",\"led\":0,\"status\":false,\"url\":\"http://admin:admin@10.107.21.11/protect/leds.cgi?led=0&timeout=0\"}","payloadType":"json","repeat":"","crontab":"","once":false,"x":350,"y":1100,"wires":[["d6e0a231.193c7"]]},{"id":"9543d57a.299058","type":"debug","z":"c94645b6.8b6ca8","name":"","active":false,"console":false,"complete":"true","x":650,"y":1100,"wires":[]},{"id":"d6e0a231.193c7","type":"function","z":"c94645b6.8b6ca8","name":"","func":"//msg.url = 'http://admin:admin@10.107.21.44/protect/status.xml'\nlet urlStatus = `http://${msg.payload.login}:${msg.payload.password}@${msg.payload.ip}/protect/status.xml`\n\nmsg.payload.status = (msg.payload.status === true) ? \"0\" : \"1\";\n\nmsg.message1C = msg.payload;\nmsg.url = urlStatus;\nreturn msg;\n\n\n/*\n{\n\"ip\": \"10.107.21.11\",\n\"login\": \"admin\",\n\"password\": \"admin\",\n\"led\": 0,\n\"status\": false,\n\"url\": \"http://admin:admin@10.107.21.11/protect/leds.cgi?led=0&timeout=0\"\n}\n*/","outputs":1,"noerr":0,"x":500,"y":1140,"wires":[["9543d57a.299058","d6780d2b.e03ef"]]},{"id":"d6780d2b.e03ef","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","x":670,"y":1140,"wires":[["a895a597.5ddf38"]]},{"id":"a895a597.5ddf38","type":"xml","z":"c94645b6.8b6ca8","name":"","attr":"","chr":"","x":810,"y":1140,"wires":[["4590034.3fb72fc","1f751168.54502f"]]},{"id":"4590034.3fb72fc","type":"debug","z":"c94645b6.8b6ca8","name":"","active":false,"console":false,"complete":"true","x":950,"y":1180,"wires":[]},{"id":"1f751168.54502f","type":"function","z":"c94645b6.8b6ca8","name":"logic","func":"var message1C = msg.message1C;\nvar statusLed = msg.payload.response[`led${message1C.led}`][0];\n\nmsg.payload = statusLed;\n\nif(message1C.status !== statusLed){\n    msg.swith = true;\n    msg.url = message1C.url;\n}else{\n    msg.payload = true\n    msg.swith = false\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":1140,"wires":[["8d1fa52c.da5428","6d6a85fe.9386bc"]]},{"id":"8d1fa52c.da5428","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1090,"y":1180,"wires":[]},{"id":"6d6a85fe.9386bc","type":"switch","z":"c94645b6.8b6ca8","name":"","property":"swith","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":1090,"y":1140,"wires":[["11a3fde4.9bb622","ba8539d7.df98a8"],["e907732b.b3633","b84f6c82.1eecd"]]},{"id":"11a3fde4.9bb622","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1230,"y":1100,"wires":[]},{"id":"e907732b.b3633","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1250,"y":1180,"wires":[]},{"id":"b84f6c82.1eecd","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1250,"y":1220,"wires":[]},{"id":"ba8539d7.df98a8","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1270,"y":1140,"wires":[["eb5147ce.d07aa8"]]},{"id":"eb5147ce.d07aa8","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1430,"y":1140,"wires":[]},{"id":"7de978c.1145e88","type":"http in","z":"c94645b6.8b6ca8","name":"","url":"/unloading2","method":"post","swaggerDoc":"","x":260,"y":1140,"wires":[["d6e0a231.193c7"]]},{"id":"bacef6ab.0f56f8","type":"debug","z":"c94645b6.8b6ca8","name":"","active":false,"console":false,"complete":"true","x":670,"y":1340,"wires":[]},{"id":"15402e8d.7cde11","type":"function","z":"c94645b6.8b6ca8","name":"","func":"//msg.url = 'http://admin:admin@10.107.21.44/protect/status.xml'\nlet urlStatus = `http://${msg.payload.login}:${msg.payload.password}@${msg.payload.ip}/protect/status.xml`\n\nmsg.payload.status = (msg.payload.status === true) ? \"0\" : \"1\";\n\nmsg.message1C = msg.payload;\nmsg.url = urlStatus;\nreturn msg;\n\n\n/*\n{\n\"ip\": \"10.107.21.11\",\n\"login\": \"admin\",\n\"password\": \"admin\",\n\"led\": 0,\n\"status\": false,\n\"url\": \"http://admin:admin@10.107.21.11/protect/leds.cgi?led=0&timeout=0\"\n}\n*/","outputs":1,"noerr":0,"x":520,"y":1380,"wires":[["bacef6ab.0f56f8","d0d7eefe.e1ea4"]]},{"id":"d0d7eefe.e1ea4","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","x":690,"y":1380,"wires":[["c870921c.05f09"]]},{"id":"c870921c.05f09","type":"xml","z":"c94645b6.8b6ca8","name":"","attr":"","chr":"","x":830,"y":1380,"wires":[["2614d27e.41311e","f604a830.cb3a28"]]},{"id":"2614d27e.41311e","type":"debug","z":"c94645b6.8b6ca8","name":"","active":false,"console":false,"complete":"true","x":970,"y":1420,"wires":[]},{"id":"f604a830.cb3a28","type":"function","z":"c94645b6.8b6ca8","name":"logic","func":"var message1C = msg.message1C;\nvar statusLed = msg.payload.response[`led${message1C.led}`][0];\n\nmsg.payload = statusLed;\n\nif(message1C.status !== statusLed){\n    msg.swith = true;\n    msg.url = message1C.url;\n}else{\n    msg.payload = true\n    msg.swith = false\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":970,"y":1380,"wires":[["a0e224e2.438b08","6e026872.5b9d88"]]},{"id":"a0e224e2.438b08","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1110,"y":1420,"wires":[]},{"id":"6e026872.5b9d88","type":"switch","z":"c94645b6.8b6ca8","name":"","property":"swith","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":1110,"y":1380,"wires":[["7214a17a.77006","ca76b6c9.b91c58"],["c045d1b8.e5e77","6ef2f9b9.d8adc8"]]},{"id":"7214a17a.77006","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1250,"y":1340,"wires":[]},{"id":"c045d1b8.e5e77","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1270,"y":1420,"wires":[]},{"id":"6ef2f9b9.d8adc8","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1270,"y":1460,"wires":[]},{"id":"ca76b6c9.b91c58","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1290,"y":1380,"wires":[["b6a25224.95fbf"]]},{"id":"b6a25224.95fbf","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1450,"y":1380,"wires":[]},{"id":"1cf1bcc1.2ddb13","type":"debug","z":"c94645b6.8b6ca8","name":"","active":false,"console":false,"complete":"true","x":630,"y":1520,"wires":[]},{"id":"78f217a5.ca66b8","type":"function","z":"c94645b6.8b6ca8","name":"","func":"//msg.url = 'http://admin:admin@10.107.21.44/protect/status.xml'\nlet urlStatus = `http://${msg.payload.login}:${msg.payload.password}@${msg.payload.ip}/protect/status.xml`\n\nmsg.payload.status = (msg.payload.status === true) ? \"0\" : \"1\";\n\nmsg.message1C = msg.payload;\nmsg.url = urlStatus;\nreturn msg;\n\n\n/*\n{\n\"ip\": \"10.107.21.11\",\n\"login\": \"admin\",\n\"password\": \"admin\",\n\"led\": 0,\n\"status\": false,\n\"url\": \"http://admin:admin@10.107.21.11/protect/leds.cgi?led=0&timeout=0\"\n}\n*/","outputs":1,"noerr":0,"x":480,"y":1560,"wires":[["1cf1bcc1.2ddb13","feec8f35.df4"]]},{"id":"feec8f35.df4","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","x":650,"y":1560,"wires":[["bc579874.d63008"]]},{"id":"bc579874.d63008","type":"xml","z":"c94645b6.8b6ca8","name":"","attr":"","chr":"","x":790,"y":1560,"wires":[["69a6dc56.d22de4","a2d9acee.ae2aa"]]},{"id":"69a6dc56.d22de4","type":"debug","z":"c94645b6.8b6ca8","name":"","active":false,"console":false,"complete":"true","x":930,"y":1600,"wires":[]},{"id":"a2d9acee.ae2aa","type":"function","z":"c94645b6.8b6ca8","name":"logic","func":"var message1C = msg.message1C;\nvar statusLed = msg.payload.response[`led${message1C.led}`][0];\n\nmsg.payload = statusLed;\n\nif(message1C.status !== statusLed){\n    msg.swith = true;\n    msg.url = message1C.url;\n}else{\n    msg.payload = true\n    msg.swith = false\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":930,"y":1560,"wires":[["5d0b032d.8b20fc","57f72b50.f3ffa4"]]},{"id":"5d0b032d.8b20fc","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1070,"y":1600,"wires":[]},{"id":"57f72b50.f3ffa4","type":"switch","z":"c94645b6.8b6ca8","name":"","property":"swith","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":1070,"y":1560,"wires":[["6afca0c0.961f","4cff40ef.ffabd"],["cb4b464.718e1b8","37edbca4.134884"]]},{"id":"6afca0c0.961f","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1210,"y":1520,"wires":[]},{"id":"cb4b464.718e1b8","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1230,"y":1600,"wires":[]},{"id":"37edbca4.134884","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1230,"y":1640,"wires":[]},{"id":"4cff40ef.ffabd","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1250,"y":1560,"wires":[["15fd2f5.98c66d1"]]},{"id":"15fd2f5.98c66d1","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1410,"y":1560,"wires":[]},{"id":"2b7a4801.2470e8","type":"debug","z":"c94645b6.8b6ca8","name":"","active":false,"console":false,"complete":"true","x":690,"y":2020,"wires":[]},{"id":"e93f6ff1.80181","type":"function","z":"c94645b6.8b6ca8","name":"","func":"//msg.url = 'http://admin:admin@10.107.21.44/protect/status.xml'\nlet urlStatus = `http://${msg.payload.login}:${msg.payload.password}@${msg.payload.ip}/protect/status.xml`\n\nmsg.payload.status = (msg.payload.status === true) ? \"0\" : \"1\";\n\nmsg.message1C = msg.payload;\nmsg.url = urlStatus;\nreturn msg;\n\n\n/*\n{\n\"ip\": \"10.107.21.11\",\n\"login\": \"admin\",\n\"password\": \"admin\",\n\"led\": 0,\n\"status\": false,\n\"url\": \"http://admin:admin@10.107.21.11/protect/leds.cgi?led=0&timeout=0\"\n}\n*/","outputs":1,"noerr":0,"x":540,"y":2060,"wires":[["2b7a4801.2470e8","8adda25e.c660b"]]},{"id":"8adda25e.c660b","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","x":710,"y":2060,"wires":[["939223e1.4e2d1"]]},{"id":"939223e1.4e2d1","type":"xml","z":"c94645b6.8b6ca8","name":"","attr":"","chr":"","x":850,"y":2060,"wires":[["53d54695.e1c208","4665690c.fe7328"]]},{"id":"53d54695.e1c208","type":"debug","z":"c94645b6.8b6ca8","name":"","active":false,"console":false,"complete":"true","x":990,"y":2100,"wires":[]},{"id":"4665690c.fe7328","type":"function","z":"c94645b6.8b6ca8","name":"logic","func":"var message1C = msg.message1C;\nvar statusLed = msg.payload.response[`led${message1C.led}`][0];\n\nmsg.payload = statusLed;\n\nif(message1C.status !== statusLed){\n    msg.swith = true;\n    msg.url = message1C.url;\n}else{\n    msg.payload = true\n    msg.swith = false\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":2060,"wires":[["c17ebba9.dbbf38","e3bdb2c9.6889f"]]},{"id":"c17ebba9.dbbf38","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1130,"y":2100,"wires":[]},{"id":"e3bdb2c9.6889f","type":"switch","z":"c94645b6.8b6ca8","name":"","property":"swith","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":1130,"y":2060,"wires":[["b0fd1d24.cb0d1","ec79053c.f02c88"],["fe405b5a.037a18","8c573586.4851f8"]]},{"id":"b0fd1d24.cb0d1","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1270,"y":2020,"wires":[]},{"id":"fe405b5a.037a18","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1290,"y":2100,"wires":[]},{"id":"8c573586.4851f8","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1290,"y":2140,"wires":[]},{"id":"ec79053c.f02c88","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1310,"y":2060,"wires":[["f3370326.3ed06"]]},{"id":"f3370326.3ed06","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1470,"y":2060,"wires":[]},{"id":"750358d5.259f48","type":"http in","z":"c94645b6.8b6ca8","name":"","url":"/unloading3","method":"post","swaggerDoc":"","x":260,"y":1380,"wires":[["15402e8d.7cde11"]]},{"id":"be421c71.2dc6e","type":"http in","z":"c94645b6.8b6ca8","name":"","url":"/unloading4","method":"post","swaggerDoc":"","x":230,"y":1560,"wires":[["78f217a5.ca66b8"]]},{"id":"1f793da9.50bfc2","type":"http in","z":"c94645b6.8b6ca8","name":"","url":"/kpp","method":"post","swaggerDoc":"","x":220,"y":1780,"wires":[["a3846aac.b42218"]]},{"id":"869d9e4f.c7407","type":"http in","z":"c94645b6.8b6ca8","name":"","url":"/LightsWeight","method":"post","swaggerDoc":"","x":250,"y":2060,"wires":[["e93f6ff1.80181"]]},{"id":"72e68627.80a2e8","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":630,"y":1740,"wires":[]},{"id":"a3846aac.b42218","type":"function","z":"c94645b6.8b6ca8","name":"","func":"//msg.url = 'http://admin:admin@10.107.21.44/protect/status.xml'\nlet urlStatus = `http://${msg.payload.login}:${msg.payload.password}@${msg.payload.ip}/protect/status.xml`\n\nmsg.payload.status = (msg.payload.status === true) ? \"0\" : \"1\";\n\nmsg.message1C = msg.payload;\nmsg.url = urlStatus;\nreturn msg;\n\n\n/*\n{\n\"ip\": \"10.107.21.11\",\n\"login\": \"admin\",\n\"password\": \"admin\",\n\"led\": 0,\n\"status\": false,\n\"url\": \"http://admin:admin@10.107.21.11/protect/leds.cgi?led=0&timeout=0\"\n}\n*/","outputs":1,"noerr":0,"x":480,"y":1780,"wires":[["72e68627.80a2e8","ef0c9a7c.ed3038"]]},{"id":"ef0c9a7c.ed3038","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","x":650,"y":1780,"wires":[["cc1f6301.634bf"]]},{"id":"cc1f6301.634bf","type":"xml","z":"c94645b6.8b6ca8","name":"","attr":"","chr":"","x":790,"y":1780,"wires":[["70771ea7.5975a","8b43e06e.cc43e"]]},{"id":"70771ea7.5975a","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":930,"y":1820,"wires":[]},{"id":"8b43e06e.cc43e","type":"function","z":"c94645b6.8b6ca8","name":"logic","func":"var message1C = msg.message1C;\nvar statusLed = msg.payload.response[`led${message1C.led}`][0];\n\nmsg.payload = statusLed;\n\nif(message1C.status !== statusLed){\n    msg.swith = true;\n    msg.url = message1C.url;\n}else{\n    msg.payload = true\n    msg.swith = false\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":930,"y":1780,"wires":[["840916fe.f721f8","57ae80b2.7134c"]]},{"id":"840916fe.f721f8","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1070,"y":1820,"wires":[]},{"id":"57ae80b2.7134c","type":"switch","z":"c94645b6.8b6ca8","name":"","property":"swith","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":1070,"y":1780,"wires":[["3d6869de.61c436","d29d39e4.a68968"],["38776d3.7fce292","2326cc3c.7071b4"]]},{"id":"3d6869de.61c436","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1210,"y":1740,"wires":[]},{"id":"38776d3.7fce292","type":"debug","z":"c94645b6.8b6ca8","name":"","active":true,"console":false,"complete":"true","x":1230,"y":1820,"wires":[]},{"id":"2326cc3c.7071b4","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1230,"y":1860,"wires":[]},{"id":"d29d39e4.a68968","type":"http request","z":"c94645b6.8b6ca8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1250,"y":1780,"wires":[["ae9978be.975198"]]},{"id":"ae9978be.975198","type":"http response","z":"c94645b6.8b6ca8","name":"","x":1410,"y":1780,"wires":[]},{"id":"af74b41f.8e0c18","type":"link in","z":"ead0a2e8.f93de","name":"trasir photo sid","links":["eaa9f1f3.418a1","bb154fd3.ebfb6"],"x":240,"y":800,"wires":[["e2d2fc99.a484b"]]},{"id":"eaa9f1f3.418a1","type":"link out","z":"73798026.159ca","name":"","links":["af74b41f.8e0c18"],"x":1915,"y":760,"wires":[]},{"id":"4ce59971.f885f8","type":"delay","z":"73798026.159ca","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2080,"y":680,"wires":[["8260bdee.54eb7"]]},{"id":"63276ae5.69f1d4","type":"delay","z":"ead0a2e8.f93de","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":340,"y":180,"wires":[["2aea504e.4c266"]]},{"id":"bb154fd3.ebfb6","type":"link out","z":"ead0a2e8.f93de","name":"","links":["af74b41f.8e0c18"],"x":355,"y":220,"wires":[]},{"id":"ea70f36.275cf1","type":"inject","z":"38f5b6db.4b422a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1100,"y":1760,"wires":[["662f99d2.60b5c8"]]},{"id":"9d7076be.dc4058","type":"function","z":"25dc673e.e08538","name":"filter","func":"var subolA = msg.payload.indexOf(\"A\");\nvar subolB = msg.payload.indexOf(\"B\");\nvar instr = msg.payload;\nvar weight ;\n\nif(subolA > 0){\n    weight = msg.payload.substring(subolA-8,subolA -2)\n    \n    msg.payload = weight\n} else if(subolB > 0){\n    weight = msg.payload.substring(subolB-8,subolB -2)\n    msg.payload = weight\n}\nif(msg.payload.length>5){\n     return msg;\n}\n\n//return msg;\n// if(weight.length == 6){\n    /*\n\n    */\n// }\n\n","outputs":1,"noerr":0,"x":730,"y":380,"wires":[["139790fc.d8e4af"]]},{"id":"139790fc.d8e4af","type":"debug","z":"25dc673e.e08538","name":"","active":false,"console":"false","complete":"false","x":910,"y":380,"wires":[]},{"id":"65dfe1c0.50cf8","type":"inject","z":"73798026.159ca","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":220,"y":2040,"wires":[["41d590b2.87947"]]},{"id":"a6305336.9981","type":"file","z":"25dc673e.e08538","name":"","filename":"/distr/data/111123.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":720,"y":880,"wires":[]},{"id":"ca281ca4.6f443","type":"inject","z":"25dc673e.e08538","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":280,"y":920,"wires":[["c33b366e.6c8f48"]]},{"id":"c33b366e.6c8f48","type":"file in","z":"25dc673e.e08538","name":"","filename":"123.txt","format":"utf8","x":500,"y":920,"wires":[["8b2fc704.eea318","a6305336.9981"]]},{"id":"8b2fc704.eea318","type":"debug","z":"25dc673e.e08538","name":"","active":true,"console":"false","complete":"false","x":690,"y":920,"wires":[]},{"id":"bd459d3f.4e2cd","type":"function","z":"25dc673e.e08538","name":"filter","func":"var subolpl = msg.payload.indexOf(\"+\");\nvar instr = msg.payload;\nvar weight ;\nvar triger;\nif(subolpl > 0){\n    weight = msg.payload.substring(subolpl+1,subolpl+7);\n    triger = true;\n    msg.payload = weight;\n} \nif(msg.payload.length>5 && triger){\n     return msg;\n}\n\n//return msg;\n// if(weight.length == 6){\n    /*\n\n    */\n// }\n\n","outputs":1,"noerr":0,"x":730,"y":480,"wires":[["12f04f4f.e920c1","e6c863c5.5586f"]]},{"id":"12f04f4f.e920c1","type":"debug","z":"25dc673e.e08538","name":"","active":true,"console":"false","complete":"false","x":890,"y":480,"wires":[]}]
