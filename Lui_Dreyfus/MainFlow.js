[{"id":"dbb5a15f.df08b","type":"tab","label":"All variable"},{"id":"de930ae4.560b48","type":"tab","label":"Avto_1 Ліві Тара"},{"id":"f93250c7.39091","type":"tab","label":"Avto_1 processing_scale1 Ліві"},{"id":"3de7a235.4ff04e","type":"tab","label":"Send 1C"},{"id":"d7f6f063.4555c","type":"tab","label":"Avto_2 Праві Брутто"},{"id":"1124af78.b62db1","type":"tab","label":"Avto_2 processing_scale1"},{"id":"bd4c94f4.ece8e8","type":"tab","label":"Avto_3 Дільниця 2"},{"id":"2b507412.efc2cc","type":"tab","label":"Avto 3 processing_scale1"},{"id":"48413719.e10dd8","type":"tab","label":"Send on boards"},{"id":"5503fe41.f59f5","type":"tab","label":"Send Serial and IP"},{"id":"962df517.4837f8","type":"tab","label":"Camers"},{"id":"ee144e5a.86352","type":"tab","label":"Infratek Lab outside"},{"id":"7719c21e.c9711c","type":"tab","label":"Infrateck-Seting Lab outside"},{"id":"87b488d6.5b73f8","type":"tab","label":"Счетчик"},{"id":"6754df2.8b2bd2","type":"tab","label":"Infratek Lab inside"},{"id":"90f9c352.b35d1","type":"tab","label":"Infrateck-Seting Lab inside"},{"id":"71f38711.545228","type":"tab","label":"JD 1 ВП-01"},{"id":"40a858ce.eb2118","type":"tab","label":"JD 1 processing_scale1"},{"id":"d6bade09.4de0d","type":"tab","label":"JD 2 WE2108"},{"id":"cbb45903.f34358","type":"tab","label":"JD 2 processing_scale1"},{"id":"4a4a57b9.eaf268","type":"tab","label":"Rfid"},{"id":"675bdafc.795f64","type":"subflow","name":"ETTN","info":"","in":[],"out":[]},{"id":"c5d3c3f1.51d71","type":"subflow","name":"Subflow 1","info":"","in":[],"out":[]},{"id":"d0426e92.cf1a2","type":"socket-io-event","z":"","addr":"getWeight"},{"id":"fee25cb3.7464e","type":"socket-io-server","z":"","port":"4001"},{"id":"7f9670a2.ed156","type":"ui_group","z":"","name":"Поточна вага","tab":"d645f588.d7a5c8","order":1,"disp":true,"width":"6"},{"id":"6d8579da.74a558","type":"ui_group","z":"","name":"Графік ваги","tab":"d645f588.d7a5c8","order":2,"disp":true,"width":"6"},{"id":"d645f588.d7a5c8","type":"ui_tab","z":"","name":"Smart Scales","icon":"dashboard"},{"id":"f436a52.4d81958","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"3dcd6787.0f6af8","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"b1522108.07191","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"7f5f15e8.00caec","type":"ui_group","z":"","name":"Errors","tab":"aa1ef8a.4ed6f08","order":2,"disp":true,"width":"6"},{"id":"aa1ef8a.4ed6f08","type":"ui_tab","z":"","name":"Dev","icon":"dashboard"},{"id":"80207470.ec8f48","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"79a8e2bb.a2ee4c","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"d049c21b.cdc58","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"e03e62d3.458ec","type":"MySQLdatabase","z":"","host":"10.107.5.202","port":"3306","db":"astue","tz":""},{"id":"e06043a7.1d685","type":"socket-io-server","z":"","port":"5001"},{"id":"c1ce8631.e64978","type":"socket-io-server","z":"","port":"5002"},{"id":"aa8da8ba.d261c8","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}}},{"id":"d8337a69.ecb378","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"b6be36f1.7b0ae8","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"faa64350.c8cc7","type":"socket-io-server","z":"","port":"5003"},{"id":"5ed08ea6.37a87","type":"socket-io-server","z":"","port":"5004"},{"id":"866842db.e6f02","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"c8a0d2b5.daf2c","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"95695c19.1ce96","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"c79d0006.26eda","type":"ui_group","z":"","name":"Стабільність","tab":"aa1ef8a.4ed6f08","order":1,"disp":true,"width":"6"},{"id":"810ad095.03ee3","type":"ui_group","z":"","name":"Графіки стаільності","tab":"d645f588.d7a5c8","order":3,"disp":true,"width":"6"},{"id":"a5e83575.29de38","type":"ui_group","z":"","name":"info 1c ліві","tab":"d645f588.d7a5c8","disp":true,"width":"6"},{"id":"c3e11efc.bb5a3","type":"ui_group","z":"","name":"1с info праві","tab":"d645f588.d7a5c8","disp":true,"width":"6"},{"id":"4edd37d9.5690d8","type":"ui_group","z":"","name":"Зважування","tab":"d645f588.d7a5c8","disp":true,"width":"6"},{"id":"cba9ee64.765ef","type":"function","z":"de930ae4.560b48","name":"GET WEIGHT","func":"var payload = msg.payload;\nvar parser = flow.get('parser');\nvar currentWeight = parser(payload);\n\nif(currentWeight > -80){\n    flow.set('currentWeight',currentWeight);\n    msg.connect = \"yes\"\n    msg.payload = currentWeight;\n    global.set('weight_1', currentWeight);\n    return msg;\n}\n","outputs":1,"noerr":0,"x":660,"y":280,"wires":[["ed88618.97b63a","b367e701.d54aa8","33869d1b.64cea2"]]},{"id":"f53f5c8e.86d36","type":"inject","z":"de930ae4.560b48","name":"init","topic":"","payload":"init","payloadType":"str","repeat":"","crontab":"","once":true,"x":127.99999618530273,"y":100.99999809265137,"wires":[["4068b8e.352e148"]]},{"id":"37a52c13.2f5de4","type":"comment","z":"de930ae4.560b48","name":"INITIALIZING ТАРА","info":"","x":130,"y":60,"wires":[]},{"id":"4068b8e.352e148","type":"function","z":"de930ae4.560b48","name":"Модель весов","func":"flow.set('inputString',\"CMD\");\nflow.set('parser',function(v){\n        \n        var weight = v.split(\"\").reverse().join(\"\");\n        weight = weight.replace(\"=\",\"\")\n        weight = Number(weight)\n        //v = v.substring(0,6);\n        //v = v.replace('S','');\n        //v = v.replace('D','');\n        //v = v.replace('kg','');\n        //return Number(v);\n        v = weight;\n        return v;\n        }\n    );\nglobal.set('scale_id_in','1ceface0-038d-4de1-8cc0-a1d93217b198');\nglobal.set('ip','10.107.5.200');\nglobal.set('video_camera_url_1','');\n   \nreturn msg;","outputs":1,"noerr":0,"x":338,"y":100.4285659790039,"wires":[[]]},{"id":"b367e701.d54aa8","type":"link out","z":"de930ae4.560b48","name":"s3 Авто 1","links":["a16fbf7a.acd8e"],"x":815,"y":280,"wires":[]},{"id":"f1f1109b.333ed","type":"file","z":"f93250c7.39091","name":"deivce_config_1.json","filename":"deivce_config_1.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":500,"y":160,"wires":[]},{"id":"562af18.1a8c61","type":"exec","z":"f93250c7.39091","command":"cat /proc/cpuinfo","addpay":true,"append":"| grep Serial","useSpawn":"","timer":"5","name":"","x":367.0000228881836,"y":38,"wires":[["e1d078b0.a22838","5acf00d.a5689"],[],[]]},{"id":"4abf017d.0eca7","type":"function","z":"f93250c7.39091","name":"main config","func":"flow.set('prevWeight',null);\nflow.set('transaction',null);\nflow.set('transactionData',[]);\nflow.set('transactionMaxWeight',null);\nflow.set('transactionHasMinWeight',null);\nflow.set('transactionHasMaxWeight',null);\nflow.set('transactionHasMaxDuration',null);\nflow.set('lasttimedata', new Date());\nflow.set('checkHealth',null);\nflow.set('transactionWaybill',null);\nflow.set('transactionAccWeight', null);\nflow.set('transactionHasOverLoad', null);\nflow.set('transactionOperationName', null);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":470,"y":260,"wires":[[]]},{"id":"ec547f47.27992","type":"inject","z":"f93250c7.39091","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":96.85713958740234,"y":220.28570556640625,"wires":[["b5bfdc07.5a178","72dcf20d.05525c"]]},{"id":"65350d88.570cd4","type":"http in","z":"f93250c7.39091","name":"","url":"/firmware","method":"post","swaggerDoc":"","x":160,"y":160,"wires":[["f1f1109b.333ed"]]},{"id":"5bb8dba6.5822b4","type":"file in","z":"f93250c7.39091","name":"deivce_config_1.json","filename":"deivce_config_1.json","format":"utf8","x":499,"y":217,"wires":[["4abca4c1.0f2dac"]]},{"id":"e22903b9.676c9","type":"http in","z":"f93250c7.39091","name":"","url":"/serial","method":"get","swaggerDoc":"","x":136,"y":34.000000953674316,"wires":[["562af18.1a8c61"]]},{"id":"e1d078b0.a22838","type":"http response","z":"f93250c7.39091","name":"","x":595,"y":20,"wires":[]},{"id":"5acf00d.a5689","type":"function","z":"f93250c7.39091","name":"","func":"msg.payload = msg.payload.split(':')[1].replace('\\n','').replace(' ','');\nreturn msg;","outputs":1,"noerr":0,"x":601,"y":56,"wires":[[]]},{"id":"8c37f2d1.09d8b","type":"inject","z":"f93250c7.39091","name":"DEMO","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":116,"y":112.57142639160156,"wires":[["a6a7b65e.d33918"]]},{"id":"a6a7b65e.d33918","type":"function","z":"f93250c7.39091","name":"DEMO Data","func":"var device_config = {\n    'event_move_in_id':'80096D9ABE7F68F3E0533300000A6C0D',\n    'event_move_in_minus_id':'8DB9B239DF5252F0E055000000000001',\n    'event_move_out_id':'80096D9ABE8068F3E0533300000A6C0D',\n    'event_max_weight_id':'85A255F950F9BEF4E0533300000AC45D',\n    'event_on_id': '85A2CC45702A2DD1E0533300000A0C94',\n    'event_off_id':'85A2CC4570292DD1E0533300000A0C94',\n    'event_max_duration':'8642EE858DE89BAAE0533300000AFCC7',\n    'event_fake_traffic':'80096EF60C186574E0533300000ADBA5',\n    'event_get_weight_acc':'800970AC1FDC683CE0533300000AF1B0',\n    'event_min_weight':'875C3EB5C9DD092DE055000000000001',\n    'event_driver_in':'8E68D8D8B2977181E055000000000001',\n    'event_over_load':'B3EB5F800EFD2620E0530101007F8A05',\n    'snapshot_events':['80096D9ABE7F68F3E0533300000A6C0D','85A255F950F9BEF4E0533300000AC45D','8642EE858DE89BAAE0533300000AFCC7','800970AC1FDC683CE0533300000AF1B0', \"B3EB5F800EFD2620E0530101007F8A05\"],\n    'main_host':'https://10.107.5.200:8443/ords/ettn',\n    'event_url':'/iot_cli/events/log',\n    'state_url':'/iot_cli/device',\n    'snapshot_url':'/iot_cli/events/snapshot',\n    'maxWeight':60000,\n    'maxDuration':600000,\n    'minWeight':-40,\n    'checkHealthTimeout':3000,\n    'minTriggerWeight':20,//bylo 20\n    'driverWeight':80,\n    'overLoadWeight': 200,\n    'stableDiff': 60\n}\nmsg.payload = device_config;\n// flow.set('scale_id','80096CB0EFD83B63E0533300000A4334');\n// flow.set('event_move_in_id','80096D9ABE7F68F3E0533300000A6C0D');\n// flow.set('event_move_out_id','80096D9ABE8068F3E0533300000A6C0D');\n// flow.set('event_max_weight_id','85A255F950F9BEF4E0533300000AC45D');\n// flow.set('event_off_id','85A2CC4570292DD1E0533300000A0C94');\n// flow.set('event_on_id', '85A2CC45702A2DD1E0533300000A0C94');\n// flow.set('event_max_duration','8642EE858DE89BAAE0533300000AFCC7');\n// flow.set('main_host','http://prod.apex.rest/ords/ettn');\n// flow.set('event_url','/iot_cli/events/log');\n// flow.set('state_url','/v1/device');\n// flow.set('maxWeight',40000);\n// flow.set('maxDuration',20000);\n// flow.set('checkHealthTimeout',3000);\nreturn msg;","outputs":1,"noerr":0,"x":295.0000228881836,"y":113.00000190734863,"wires":[["f1f1109b.333ed"]]},{"id":"4abca4c1.0f2dac","type":"function","z":"f93250c7.39091","name":"device config","func":"var device_config = JSON.parse(msg.payload);\n\nflow.set('scale_id',device_config.scale_id);\nflow.set('event_move_in_id',device_config.event_move_in_id);\nflow.set('event_move_in_minus_id',device_config.event_move_in_minus_id);\nflow.set('event_move_out_id',device_config.event_move_out_id);\nflow.set('event_max_weight_id',device_config.event_max_weight_id);\nflow.set('event_off_id',device_config.event_off_id);\nflow.set('event_on_id', device_config.event_on_id);\nflow.set('event_max_duration',device_config.event_max_duration);\nflow.set('event_fake_traffic',device_config.event_fake_traffic);\nflow.set('event_driver_in', device_config.event_driver_in);\nflow.set('event_over_load',device_config.event_over_load);\nflow.set('main_host',device_config.main_host);\nflow.set('event_url',device_config.event_url);\nflow.set('state_url',device_config.state_url);\nflow.set('maxWeight',device_config.maxWeight);\nflow.set('minWeight',device_config.minWeight);\nflow.set('maxDuration',device_config.maxDuration);\nflow.set('checkHealthTimeout',device_config.checkHealthTimeout);\nflow.set('event_get_weight_acc',device_config.event_get_weight_acc);\nflow.set('event_min_weight',device_config.event_min_weight);\nflow.set('minTriggerWeight',device_config.minTriggerWeight);\nflow.set('snapshot_url',device_config.snapshot_url);\nflow.set('snapshot_events',device_config.snapshot_events);\nflow.set('driverWeight',device_config.driverWeight);\nflow.set('overLoadWeight', device_config.overLoadWeight);\nflow.set('stableDiff', device_config.stableDiff);\n\n\nmsg.payload = {\n\tscale_id: flow.get('scale_id'),\n\tevent_move_in_id: flow.get('event_move_in_id'),\n\tevent_move_in_minus_id: flow.get('event_move_in_minus_id'),\n\tevent_move_out_id: flow.get('event_move_out_id'),\n\tevent_max_weight_id: flow.get('event_max_weight_id'),\n\tevent_off_id: flow.get('event_off_id'),\n\tevent_on_id: flow.get('event_on_id'),\n\tevent_max_duration: flow.get('event_max_duration'),\n\tevent_fake_traffic: flow.get('event_fake_traffic'),\n\tevent_driver_in: flow.get('event_driver_in'),\n\tevent_over_load: flow.get('event_over_load'),\n\tmain_host: flow.get('main_host'),\n\tevent_url: flow.get('event_url'),\n\tstate_url: flow.get('state_url'),\n\tmaxWeight: flow.get('maxWeight'),\n\tminWeight: flow.get('minWeight'),\n\tmaxDuration: flow.get('maxDuration'),\n\tcheckHealthTimeout: flow.get('checkHealthTimeout'),\n\tevent_get_weight_acc: flow.get('event_get_weight_acc'),\n\tevent_min_weight: flow.get('event_min_weight'),\n\tminTriggerWeight: flow.get('minTriggerWeight'),\n\tsnapshot_url: flow.get('snapshot_url'),\n\tsnapshot_events: flow.get('snapshot_events'),\n\tdriverWeight: flow.get('driverWeight'),\n\toverLoadWeight: flow.get('overLoadWeight'),\n\tstableDiff: flow.get('stableDiff')\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":730,"y":220,"wires":[["66c29516.4d208c","ba72f4e1.530968"]]},{"id":"66c29516.4d208c","type":"json","z":"f93250c7.39091","name":"","x":890,"y":220,"wires":[["b077cd38.635dc"]]},{"id":"b077cd38.635dc","type":"debug","z":"f93250c7.39091","name":"IN device config","active":false,"console":"false","complete":"true","x":1060,"y":220,"wires":[]},{"id":"63c1076b.84a758","type":"function","z":"f93250c7.39091","name":"transactionHasMaxWeight","func":"msg.event_id = flow.get('event_max_weight_id');\nmsg.description = 'Перевищена максимально-допустима вага, кг: ' + msg.metadata.weight;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":560,"wires":[["a73041fe.ebf6a"]]},{"id":"3bb8f9d0.e0fb86","type":"switch","z":"f93250c7.39091","name":"switch max weight","property":"transactionHasMaxWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":422.6666259765625,"y":564.6666374206543,"wires":[["63c1076b.84a758"]]},{"id":"a73041fe.ebf6a","type":"function","z":"f93250c7.39091","name":"events payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in');\nvar snapshot_events = flow.get('snapshot_events');\nvar snapshot = false;\n\nif (snapshot_events.indexOf(event_id)>=0){\n    snapshot = true;\n}\n\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'devices':[{'id':scale_id}],\n    'data':msg.metadata,\n    'description':msg.description\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('event_url');\nmsg.main_host = flow.get('main_host');\nmsg.event_url = flow.get('event_url');\nmsg.snapshot = snapshot;\nreturn msg;","outputs":1,"noerr":0,"x":989.6666870117188,"y":528.0951538085938,"wires":[["669f456c.85dbdc","64818b16.9efd34"]]},{"id":"5e7ae786.85a898","type":"function","z":"f93250c7.39091","name":"main module","func":"var prevWeight = flow.get('prevWeight');\nvar transaction = flow.get('transaction');\nvar transactionData = flow.get('transactionData');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar transactionHasMaxWeight = flow.get('transactionHasMaxWeight');\nvar transactionHasMinWeight = flow.get('transactionHasMinWeight');\nvar transactionHasMaxDuration = flow.get('transactionHasMaxDuration');\nvar transactionOperationName = flow.get('transactionOperationName');\nvar stableDiff = flow.get('stableDiff');//дельта стабільності\nvar waybill = flow.get('transactionWaybill');\nvar weight = msg.payload;\nvar stableSize = 20;\nvar duration = 0;\nvar operation_name_income = \"Приход (авто)\";\nvar maxWeight = flow.get('maxWeight');\nvar maxDuration = flow.get('maxDuration');\nvar prevTransaction = transaction;\nvar minWeight = flow.get('minWeight');\nvar minTriggerWeight = flow.get('minTriggerWeight');\nvar is_minus = false;\nvar transactionAccWeight = flow.get('transactionAccWeight');//облікова вага\nvar overLoadWeight = flow.get('overLoadWeight');\n\n//transaction\nif (prevWeight === null){\n    prevWeight = msg.payload;    \n}else{\n    if((prevWeight <= 40) && (weight > 0) && (weight >= minTriggerWeight)){\n        //start of transaction\n        transaction = Date.now();\n        msg.on = true;\n        flow.set('transaction',transaction);\n    }else if((prevWeight > 0) && (Math.abs(weight) <= 80) && (transaction)){\n        //transaction = 0;\n        msg.on = false;\n        transactionData = [];\n        flow.set('transaction',0);\n        flow.set('transactionMaxWeight',null);\n        flow.set('transactionHasMaxWeight',null);\n        flow.set('transactionHasMinWeight',null);\n        flow.set('transactionHasMaxDuration',null);\n        flow.set('transactionHasOverLoad',null);\n        flow.set('transactionOperationName',null);\n        flow.set('transactionWaybill',null);\n        flow.set('transactionMetadata',null);\n        flow.set('transactionAccWeight', null);//облікова вага\n    }else if((transaction === null) && (weight>0) && (weight > minTriggerWeight)){\n        transaction = Date.now();\n        flow.set('transaction',transaction);\n    }\n    if((prevWeight < 0) && ((weight-prevWeight) > minTriggerWeight)){\n        //start of transaction\n        is_minus = true;\n        msg.prevWeight = prevWeight;\n    }\n}\nmsg.stable = true;\nif (transaction > 0){\n    transactionData.push(weight);    \n\n    //stable\n    if(transactionData.length > stableSize+1){\n        var stabletmp = true;\n        for (var i = transactionData.length-1; i > transactionData.length-1-stableSize; i--){\n            if ((transactionData[i] - transactionData[i-1]) > stableDiff || (transactionData[i] - transactionData[i-1]) < -stableDiff){\n                stabletmp  = false;\n                msg.stable = stabletmp;\n                break;\n            }\n            msg.stable = stabletmp;\n        }\n    }else{\n        msg.stable = false;\n    }\n\n    //duration & transactionMaxWeight\n    duration = (Number(Date.now()) - Number(transaction));\n    if( (weight>transactionMaxWeight) || (transactionMaxWeight === null)){\n        transactionMaxWeight = weight;\n        flow.set(\"transactionMaxWeight\",transactionMaxWeight);\n    }\n    \n    if(!transactionHasMaxWeight && weight > maxWeight){\n        msg.transactionHasMaxWeight = true;\n        flow.set('transactionHasMaxWeight',true);\n    }\n    \n    if(!transactionHasMinWeight && weight < minWeight){\n        msg.transactionHasMinWeight = true;\n        flow.set('transactionHasMinWeight',true);\n    }\n    \n    //max duartion\n    if(!transactionHasMaxDuration && duration > maxDuration){\n        msg.transactionHasMaxDuration = true;\n        flow.set('transactionHasMaxDuration',true);\n    }\n}\n\nmsg.transaction = transaction;\n//msg.stable = true; // add 17.07 10.54\n//result\nmsg.metadata = {\n    'weight':weight,\n    'prevWeight':prevWeight,\n    'prevTransaction':prevTransaction,\n    'transaction':transaction,\n    'on':msg.on,\n    'transactionDataCount':transactionData.length,\n    'stable':msg.stable,\n    'duration':Math.round(duration/1000),\n    'transactionMaxWeight':transactionMaxWeight,\n    'transactionAccWeight':transactionAccWeight,\n    'waybill':waybill,\n    'perimetr':true,\n    'weight1':msg.weight1,\n    'weight2':msg.weight2,\n    'weight_center':msg.weight_center,\n    'driverInCar':false,\n    'transactionOperationName':transactionOperationName\n}\nflow.set('transactionData',transactionData);\nflow.set('prevWeight',weight);\nflow.set('transactionMetadata',msg.metadata);\nflow.set('lasttimedata', new Date());\nmsg.is_minus = is_minus;\n\nif(transactionAccWeight && transactionOperationName!==operation_name_income){\n    \n   flow.set('transactionHasOverLoad',(weight-transactionAccWeight)>overLoadWeight);\n   \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":540,"wires":[["83e8d75e.1ef228","3bb8f9d0.e0fb86","895e3b58.2925e8","aa90dd40.a1d78","4ecfacda.b3e654","512882d0.fb849c","9aa8d5c3.85e918","9c25b1d4.3320c","89631331.255b5","58febdbb.838aa4","1d1a0b2.0a5c3f5","4f88ea85.8b3fc4"]]},{"id":"8d13f6e9.254448","type":"function","z":"f93250c7.39091","name":"get weight from accounting system","func":"var transactionMetadata = flow.get('transactionMetadata');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar driverWeight = flow.get('driverWeight');\nvar buisness_data = msg.req.query;\n\nmsg.metadata = Object.assign(transactionMetadata,buisness_data);\n\n//check driver in a car\nvar driver_in = false;\nmsg.driverWeight = driverWeight;\nif((transactionMaxWeight - msg.metadata.weight) < driverWeight){\n    driver_in = true;\n}\n\nmsg.event_id = flow.get('event_get_weight_acc');\ntransactionWaybill = flow.get('transactionWaybill');\nif (!transactionWaybill){\n    flow.set('transactionWaybill',msg.req.query.waybill);\n}\nmsg.description = ' '+buisness_data.operation_name+'. '+buisness_data.operation_type+'. Зважили в 1С. Поточна вага: ' + msg.metadata.weight+\" Номер авто: \"+buisness_data.truck1+\" \"+buisness_data.truck2+\" \"+buisness_data.item_name + \", ТТН: \" + buisness_data.waybill;\nmsg.transactionMetadata = transactionMetadata;\nmsg.driver_in = driver_in;\n\nflow.set('transactionAccWeight',  msg.metadata.weight);//облікова вага\nflow.set('transactionOperationName',  msg.metadata.operation_name);//вид операції\n\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":900,"wires":[["acf3f091.acf27","a73041fe.ebf6a"]]},{"id":"669f456c.85dbdc","type":"http request","z":"f93250c7.39091","name":"EVENTS","method":"POST","ret":"txt","url":"","tls":"f436a52.4d81958","x":1200,"y":520,"wires":[["8f99ba86.7c8208"]]},{"id":"10ba01c0.344eae","type":"function","z":"f93250c7.39091","name":"move in","func":"msg.event_id = flow.get('event_move_in_id');\nmsg.description = 'Заїзд на ваги. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":480,"wires":[["a73041fe.ebf6a"]]},{"id":"23ad5544.6c21ca","type":"function","z":"f93250c7.39091","name":"off","func":"msg.event_id = flow.get('event_off_id');\nmsg.description = 'Прилад відключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":820,"wires":[["8dc5cb2.384a338"]]},{"id":"aa42788d.d8d178","type":"function","z":"f93250c7.39091","name":"on","func":"msg.event_id = flow.get('event_on_id');\nmsg.description = 'Прилад підключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":708,"y":779,"wires":[["5fdb0c87.7cd264"]]},{"id":"daa20ca6.c0295","type":"function","z":"f93250c7.39091","name":"move out","func":"msg.event_id = flow.get('event_move_out_id');\nmsg.description = 'Зїзд з ваг. Максимальна вага: ' + msg.metadata.transactionMaxWeight;\nmsg.transactionMaxWeight = msg.metadata.transactionMaxWeight;\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":520,"wires":[["a73041fe.ebf6a","6a9463df.10b05c","adc7a496.374418"]]},{"id":"18ee7ad1.037ef5","type":"function","z":"f93250c7.39091","name":"transaction has max duration","func":"msg.event_id = flow.get('event_max_duration');\nmsg.description = 'Перевищено максимальний час находження на вагах, сек: ' + msg.metadata.duration;\n\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":600,"wires":[["a73041fe.ebf6a"]]},{"id":"96d85ea9.91bb9","type":"function","z":"f93250c7.39091","name":"empty waybill","func":"msg.event_id = flow.get('event_fake_traffic');\nmsg.description = 'Холостий проїзд по вагам. Тривалість проїзду ' + Math.round(msg.metadata.duration/60)+ 'хв.' + \" Максимальна вага: \" + msg.metadata.transactionMaxWeight + \" кг.\";\n\nreturn msg;","outputs":1,"noerr":0,"x":772.6666259765625,"y":444.6666374206543,"wires":[["a73041fe.ebf6a"]]},{"id":"901e863c.c1ac68","type":"function","z":"f93250c7.39091","name":"transactionHasMinWeight","func":"msg.event_id = flow.get('event_min_weight');\nmsg.description = 'Перевищена мінімально-допустима вага, кг: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":640,"wires":[["a73041fe.ebf6a"]]},{"id":"8c561315.953b7","type":"function","z":"f93250c7.39091","name":"move in minus","func":"msg.event_id = flow.get('event_move_in_minus_id');\nmsg.description = 'Заїзд із мінусом. ' + msg.prevWeight +' кг.';\n\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":400,"wires":[["a73041fe.ebf6a"]]},{"id":"a16fbf7a.acd8e","type":"link in","z":"f93250c7.39091","name":"s4 Авто 1","links":["b367e701.d54aa8"],"x":37.6666259765625,"y":544.6666259765625,"wires":[["9acbaa52.939318","aef6f685.5a70c8","28957c3a.27e034","bfc9a4e.e0ee158","5e7ae786.85a898","eb4ecd2a.5eccb"]]},{"id":"83e8d75e.1ef228","type":"switch","z":"f93250c7.39091","name":"switch move","property":"on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":390,"y":520,"wires":[["10ba01c0.344eae"],["daa20ca6.c0295","76b99930.78a918","1312bf38.be6cc1"]]},{"id":"895e3b58.2925e8","type":"switch","z":"f93250c7.39091","name":"max duration","property":"transactionHasMaxDuration","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":402.6666259765625,"y":604.6666374206543,"wires":[["18ee7ad1.037ef5"]]},{"id":"aa90dd40.a1d78","type":"switch","z":"f93250c7.39091","name":"switch min weight","property":"transactionHasMinWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":422.6666259765625,"y":644.6666374206543,"wires":[["901e863c.c1ac68"]]},{"id":"4ecfacda.b3e654","type":"switch","z":"f93250c7.39091","name":"switch minus in","property":"is_minus","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":400,"y":400,"wires":[["8c561315.953b7"]]},{"id":"acf3f091.acf27","type":"switch","z":"f93250c7.39091","name":"","property":"driver_in","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":850,"y":900,"wires":[["172e6046.e6008"]]},{"id":"81b024c7.966348","type":"http in","z":"f93250c7.39091","name":"","url":"/getWeight1","method":"get","swaggerDoc":"","x":160,"y":920,"wires":[["eb338eda.b55b2","6fe046ed.96e378","8d13f6e9.254448"]]},{"id":"172e6046.e6008","type":"function","z":"f93250c7.39091","name":"driver_in event","func":"msg.event_id = flow.get('event_driver_in');\nmsg.description = 'При зважуванні водій в кабіні. Вага: ' + msg.metadata.weight+\"кг. Номер авто: \"+msg.metadata.truck1+\" \"+msg.metadata.truck2+\" \"+msg.metadata.item_name;\n\nreturn msg;","outputs":1,"noerr":0,"x":1040,"y":900,"wires":[["a73041fe.ebf6a"]]},{"id":"c56545ec.fadd08","type":"switch","z":"f93250c7.39091","name":"","property":"checkHealth","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":430,"y":820,"wires":[["aa42788d.d8d178"],["23ad5544.6c21ca"]]},{"id":"76b99930.78a918","type":"switch","z":"f93250c7.39091","name":"waybill","property":"metadata.waybill","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","outputs":1,"x":590,"y":440,"wires":[["96d85ea9.91bb9"]]},{"id":"9acbaa52.939318","type":"socket-io-out","z":"f93250c7.39091","name":"socket 4001","event":"d0426e92.cf1a2","server":"fee25cb3.7464e","x":170,"y":620,"wires":[]},{"id":"aef6f685.5a70c8","type":"debug","z":"f93250c7.39091","name":"Avto 1 weight","active":false,"console":"true","complete":"payload","x":180,"y":500,"wires":[]},{"id":"28957c3a.27e034","type":"ui_text","z":"f93250c7.39091","group":"7f9670a2.ed156","order":0,"width":0,"height":0,"name":"","label":"Поточна вага ліві:","format":"{{msg.payload}}","layout":"row-spread","x":189,"y":654.0000114440918,"wires":[]},{"id":"eb338eda.b55b2","type":"function","z":"f93250c7.39091","name":"response","func":"msg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nif(transactionWaybill && transactionWaybill !== msg.req.query.waybill){\n    msg.payload.status = false;    \n}else {\n    msg.payload.status = true;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":1000,"wires":[["f1cdf25e.1b875","d7bb8423.309218"]]},{"id":"f8662a6b.f95948","type":"function","z":"f93250c7.39091","name":"check scale health","func":"var lastcheckHealth = flow.get('checkHealth');\nvar checkHealth = null;\nvar lasttimedata = flow.get('lasttimedata');\n\nvar currenttimedata = new Date();\n\nif ((currenttimedata - lasttimedata) > 20000){\n    checkHealth = false;\n} else {\n    checkHealth = true;\n}\n\nflow.set(\"checkHealth\",checkHealth);\n\nif (lastcheckHealth != checkHealth){\n    msg.checkHealth = checkHealth;\n}else{\n    msg.checkHealth = null;\n}\nmsg.payload = checkHealth;\n\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":820,"wires":[["c56545ec.fadd08"]]},{"id":"f1cdf25e.1b875","type":"http response","z":"f93250c7.39091","name":"","x":630,"y":1000,"wires":[]},{"id":"42a02096.d5587","type":"inject","z":"f93250c7.39091","name":"","topic":"","payload":"","payloadType":"date","repeat":"6","crontab":"","once":false,"x":110,"y":760,"wires":[["f8662a6b.f95948"]]},{"id":"b4c1020f.a451c","type":"http in","z":"f93250c7.39091","name":"","url":"/getSimpleWeight","method":"get","swaggerDoc":"","x":180,"y":1180,"wires":[["1b1ceddb.e04bc2"]]},{"id":"1b1ceddb.e04bc2","type":"function","z":"f93250c7.39091","name":"response","func":"msg.payload = flow.get('transactionMetadata').weight;\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":1180,"wires":[["4406d7d8.72d8f8"]]},{"id":"4406d7d8.72d8f8","type":"http response","z":"f93250c7.39091","name":"","x":590,"y":1180,"wires":[]},{"id":"1808308f.0c41ff","type":"http in","z":"f93250c7.39091","name":"","url":"/socket","method":"get","swaggerDoc":"","x":150,"y":1260,"wires":[["f9627cc0.72ff5"]]},{"id":"9ca69381.b40f2","type":"template","z":"f93250c7.39091","name":"socket page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n     \n  <body>\n    <h1><p id='weight'></p></h1>\n    \n     <script>\n    setTimeout(function() {\n       ;(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.io=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_(\"./lib/\")},{\"./lib/\":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_(\"./socket\");module.exports.parser=_dereq_(\"engine.io-parser\")},{\"./socket\":3,\"engine.io-parser\":19}],3:[function(_dereq_,module,exports){(function(global){var transports=_dereq_(\"./transports\");var Emitter=_dereq_(\"component-emitter\");var debug=_dereq_(\"debug\")(\"engine.io-client:socket\");var index=_dereq_(\"indexof\");var parser=_dereq_(\"engine.io-parser\");var parseuri=_dereq_(\"parseuri\");var parsejson=_dereq_(\"parsejson\");var parseqs=_dereq_(\"parseqs\");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&\"object\"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==\"https\"||uri.protocol==\"wss\";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&\"https:\"==location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?\"443\":\"80\"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:\"localhost\");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if(\"string\"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||\"t\";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||[\"polling\",\"websocket\"];this.readyState=\"\";this.writeBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?null:opts.rejectUnauthorized;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}}this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_(\"./transport\");Socket.transports=_dereq_(\"./transports\");Socket.parser=_dereq_(\"engine.io-parser\");Socket.prototype.createTransport=function(name){debug('creating transport \"%s\"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf(\"websocket\")!=-1){transport=\"websocket\"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit(\"error\",\"No transports available\")},0);return}else{transport=this.transports[0]}this.readyState=\"opening\";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug(\"setting transport %s\",transport.name);var self=this;if(this.transport){debug(\"clearing existing transport %s\",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on(\"drain\",function(){self.onDrain()}).on(\"packet\",function(packet){self.onPacket(packet)}).on(\"error\",function(e){self.onError(e)}).on(\"close\",function(){self.onClose(\"transport close\")})};Socket.prototype.probe=function(name){debug('probing transport \"%s\"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport \"%s\" opened',name);transport.send([{type:\"ping\",data:\"probe\"}]);transport.once(\"packet\",function(msg){if(failed)return;if(\"pong\"==msg.type&&\"probe\"==msg.data){debug('probe transport \"%s\" pong',name);self.upgrading=true;self.emit(\"upgrading\",transport);if(!transport)return;Socket.priorWebsocketSuccess=\"websocket\"==transport.name;debug('pausing current transport \"%s\"',self.transport.name);self.transport.pause(function(){if(failed)return;if(\"closed\"==self.readyState)return;debug(\"changing transport and sending upgrade packet\");cleanup();self.setTransport(transport);transport.send([{type:\"upgrade\"}]);self.emit(\"upgrade\",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport \"%s\" failed',name);var err=new Error(\"probe error\");err.transport=transport.name;self.emit(\"upgradeError\",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error(\"probe error: \"+err);error.transport=transport.name;freezeTransport();debug('probe transport \"%s\" failed because of error: %s',name,err);self.emit(\"upgradeError\",error)}function onTransportClose(){onerror(\"transport closed\")}function onclose(){onerror(\"socket closed\")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('\"%s\" works - aborting \"%s\"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener(\"open\",onTransportOpen);transport.removeListener(\"error\",onerror);transport.removeListener(\"close\",onTransportClose);self.removeListener(\"close\",onclose);self.removeListener(\"upgrading\",onupgrade)}transport.once(\"open\",onTransportOpen);transport.once(\"error\",onerror);transport.once(\"close\",onTransportClose);this.once(\"close\",onclose);this.once(\"upgrading\",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug(\"socket open\");this.readyState=\"open\";Socket.priorWebsocketSuccess=\"websocket\"==this.transport.name;this.emit(\"open\");this.flush();if(\"open\"==this.readyState&&this.upgrade&&this.transport.pause){debug(\"starting upgrade probes\");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if(\"opening\"==this.readyState||\"open\"==this.readyState){debug('socket receive: type \"%s\", data \"%s\"',packet.type,packet.data);this.emit(\"packet\",packet);this.emit(\"heartbeat\");switch(packet.type){case\"open\":this.onHandshake(parsejson(packet.data));break;case\"pong\":this.setPing();this.emit(\"pong\");break;case\"error\":var err=new Error(\"server error\");err.code=packet.data;this.onError(err);break;case\"message\":this.emit(\"data\",packet.data);this.emit(\"message\",packet.data);break}}else{debug('packet received with socket readyState \"%s\"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit(\"handshake\",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if(\"closed\"==this.readyState)return;this.setPing();this.removeListener(\"heartbeat\",this.onHeartbeat);this.on(\"heartbeat\",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if(\"closed\"==self.readyState)return;self.onClose(\"ping timeout\")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug(\"writing ping packet - expecting pong within %sms\",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket(\"ping\",function(){self.emit(\"ping\")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit(\"drain\")}else{this.flush()}};Socket.prototype.flush=function(){if(\"closed\"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug(\"flushing %d packets in socket\",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit(\"flush\")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket(\"message\",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if(\"function\"==typeof data){fn=data;data=undefined}if(\"function\"==typeof options){fn=options;options=null}if(\"closing\"==this.readyState||\"closed\"==this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit(\"packetCreate\",packet);this.writeBuffer.push(packet);if(fn)this.once(\"flush\",fn);this.flush()};Socket.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.readyState=\"closing\";var self=this;if(this.writeBuffer.length){this.once(\"drain\",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose(\"forced close\");debug(\"socket closing - telling transport to close\");self.transport.close()}function cleanupAndClose(){self.removeListener(\"upgrade\",cleanupAndClose);self.removeListener(\"upgradeError\",cleanupAndClose);close()}function waitForUpgrade(){self.once(\"upgrade\",cleanupAndClose);self.once(\"upgradeError\",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug(\"socket error %j\",err);Socket.priorWebsocketSuccess=false;this.emit(\"error\",err);this.onClose(\"transport error\",err)};Socket.prototype.onClose=function(reason,desc){if(\"opening\"==this.readyState||\"open\"==this.readyState||\"closing\"==this.readyState){debug('socket close with reason: \"%s\"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners(\"close\");this.transport.close();this.transport.removeAllListeners();this.readyState=\"closed\";this.id=null;this.emit(\"close\",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./transport\":4,\"./transports\":5,\"component-emitter\":15,debug:17,\"engine.io-parser\":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(_dereq_,module,exports){var parser=_dereq_(\"engine.io-parser\");var Emitter=_dereq_(\"component-emitter\");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState=\"\";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type=\"TransportError\";err.description=desc;this.emit(\"error\",err);return this};Transport.prototype.open=function(){if(\"closed\"==this.readyState||\"\"==this.readyState){this.readyState=\"opening\";this.doOpen()}return this};Transport.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if(\"open\"==this.readyState){this.write(packets)}else{throw new Error(\"Transport not open\")}};Transport.prototype.onOpen=function(){this.readyState=\"open\";this.writable=true;this.emit(\"open\")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit(\"packet\",packet)};Transport.prototype.onClose=function(){this.readyState=\"closed\";this.emit(\"close\")}},{\"component-emitter\":15,\"engine.io-parser\":19}],5:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var XHR=_dereq_(\"./polling-xhr\");var JSONP=_dereq_(\"./polling-jsonp\");var websocket=_dereq_(\"./websocket\");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if(\"open\"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error(\"JSONP disabled\");return new JSONP(opts)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling-jsonp\":6,\"./polling-xhr\":7,\"./websocket\":9,\"xmlhttprequest-ssl\":10}],6:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_(\"./polling\");var inherit=_dereq_(\"component-inherit\");module.exports=JSONPPolling;var rNewline=/\\n/g;var rEscapedNewline=/\\\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener(\"beforeunload\",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement(\"script\");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError(\"jsonp poll error\",e)};var insertAt=document.getElementsByTagName(\"script\")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko=\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement(\"iframe\");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement(\"form\");var area=document.createElement(\"textarea\");var id=this.iframeId=\"eio_iframe_\"+this.index;var iframe;form.className=\"socketio\";form.style.position=\"absolute\";form.style.top=\"-1000px\";form.style.left=\"-1000px\";form.target=id;form.method=\"POST\";form.setAttribute(\"accept-charset\",\"utf-8\");area.name=\"d\";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError(\"jsonp polling iframe removal error\",e)}}try{var html='<iframe src=\"javascript:0\" name=\"'+self.iframeId+'\">';iframe=document.createElement(html)}catch(e){iframe=document.createElement(\"iframe\");iframe.name=self.iframeId;iframe.src=\"javascript:0\"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,\"\\\\\\n\");this.area.value=data.replace(rNewline,\"\\\\n\");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==\"complete\"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-inherit\":16}],7:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var Polling=_dereq_(\"./polling\");var Emitter=_dereq_(\"component-emitter\");var inherit=_dereq_(\"component-inherit\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling-xhr\");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}else{this.extraHeaders=opts.extraHeaders}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!==\"string\"&&data!==undefined;var req=this.request({method:\"POST\",data:data,isBinary:isBinary});var self=this;req.on(\"success\",fn);req.on(\"error\",function(err){self.onError(\"xhr post error\",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug(\"xhr poll\");var req=this.request();var self=this;req.on(\"data\",function(data){self.onData(data)});req.on(\"error\",function(err){self.onError(\"xhr poll error\",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||\"GET\";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug(\"xhr open %s: %s\",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){xhr.responseType=\"arraybuffer\"}if(\"POST\"==this.method){try{if(this.isBinary){xhr.setRequestHeader(\"Content-type\",\"application/octet-stream\")}else{xhr.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}}catch(e){}}if(\"withCredentials\"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug(\"xhr data %s\",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit(\"success\");this.cleanup()};Request.prototype.onData=function(data){this.emit(\"data\",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit(\"error\",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if(\"undefined\"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader(\"Content-Type\").split(\";\")[0]}catch(e){}if(contentType===\"application/octet-stream\"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var ui8Arr=new Uint8Array(this.xhr.response);var dataArray=[];for(var idx=0,length=ui8Arr.length;idx<length;idx++){dataArray.push(ui8Arr[idx])}data=String.fromCharCode.apply(null,dataArray)}}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return\"undefined\"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent(\"onunload\",unloadHandler)}else if(global.addEventListener){global.addEventListener(\"beforeunload\",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-emitter\":15,\"component-inherit\":16,debug:17,\"xmlhttprequest-ssl\":10}],8:[function(_dereq_,module,exports){var Transport=_dereq_(\"../transport\");var parseqs=_dereq_(\"parseqs\");var parser=_dereq_(\"engine.io-parser\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling\");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name=\"polling\";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState=\"pausing\";function pause(){debug(\"paused\");self.readyState=\"paused\";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug(\"we are currently polling - waiting to pause\");total++;this.once(\"pollComplete\",function(){debug(\"pre-pause polling complete\");--total||pause()})}if(!this.writable){debug(\"we are currently writing - waiting to pause\");total++;this.once(\"drain\",function(){debug(\"pre-pause writing complete\");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug(\"polling\");this.polling=true;this.doPoll();this.emit(\"poll\")};Polling.prototype.onData=function(data){var self=this;debug(\"polling got data %s\",data);var callback=function(packet,index,total){if(\"opening\"==self.readyState){self.onOpen()}if(\"close\"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if(\"closed\"!=this.readyState){this.polling=false;this.emit(\"pollComplete\");if(\"open\"==this.readyState){this.poll()}else{debug('ignoring poll - transport state \"%s\"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug(\"writing close packet\");self.write([{type:\"close\"}])}if(\"open\"==this.readyState){debug(\"transport open - closing\");close()}else{debug(\"transport not open - deferring close\");this.once(\"open\",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit(\"drain\")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"https\":\"http\";var port=\"\";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&(\"https\"==schema&&this.port!=443||\"http\"==schema&&this.port!=80)){port=\":\"+this.port}if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query}},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,\"xmlhttprequest-ssl\":10,yeast:30}],9:[function(_dereq_,module,exports){(function(global){var Transport=_dereq_(\"../transport\");var parser=_dereq_(\"engine.io-parser\");var parseqs=_dereq_(\"parseqs\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:websocket\");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window===\"undefined\"){try{WebSocket=_dereq_(\"ws\")}catch(e){}}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name=\"websocket\";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}this.ws=BrowserWebSocket?new WebSocket(uri):new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType=\"buffer\"}else{this.ws.binaryType=\"arraybuffer\"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError(\"websocket error\",e)}};if(\"undefined\"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!BrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len=\"string\"==typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(BrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug(\"websocket closed before onclose event\")}--total||done()})})(packets[i])}function done(){self.emit(\"flush\");setTimeout(function(){self.writable=true;self.emit(\"drain\")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!==\"undefined\"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"wss\":\"ws\";var port=\"\";if(this.port&&(\"wss\"==schema&&this.port!=443||\"ws\"==schema&&this.port!=80)){port=\":\"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!(\"__initialize\"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,ws:undefined,yeast:30}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_(\"has-cors\");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if(\"undefined\"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(e){}}}},{\"has-cors\":22}],11:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error(\"after called too many times\")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],12:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],13:[function(_dereq_,module,exports){(function(chars){\"use strict\";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64=\"\";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];\nbase64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+\"=\"}else if(len%3===1){base64=base64.substring(0,base64.length-2)+\"==\"}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]===\"=\"){bufferLength--;if(base64[base64.length-2]===\"=\"){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\")},{}],14:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob([\"hi\"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],15:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],16:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],17:[function(_dereq_,module,exports){exports=module.exports=_dereq_(\"./debug\");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=\"undefined\"!=typeof chrome&&\"undefined\"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"];function useColors(){return\"WebkitAppearance\"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?\"%c\":\"\")+this.namespace+(useColors?\" %c\":\" \")+args[0]+(useColors?\"%c \":\" \")+\"+\"+exports.humanize(this.diff);if(!useColors)return args;var c=\"color: \"+this.color;args=[args[0],c,\"color: inherit\"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if(\"%%\"===match)return;index++;if(\"%c\"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return\"object\"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem(\"debug\")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{\"./debug\":18}],18:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_(\"ms\");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if(\"string\"!==typeof args[0]){args=[\"%o\"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match===\"%%\")return match;index++;var formatter=exports.formatters[format];if(\"function\"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if(\"function\"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||\"\").split(/[\\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\\*/g,\".*?\");if(namespaces[0]===\"-\"){exports.skips.push(new RegExp(\"^\"+namespaces.substr(1)+\"$\"))}else{exports.names.push(new RegExp(\"^\"+namespaces+\"$\"))}}}function disable(){exports.enable(\"\")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:25}],19:[function(_dereq_,module,exports){(function(global){var keys=_dereq_(\"./keys\");var hasBinary=_dereq_(\"has-binary\");var sliceBuffer=_dereq_(\"arraybuffer.slice\");var base64encoder=_dereq_(\"base64-arraybuffer\");var after=_dereq_(\"after\");var utf8=_dereq_(\"utf8\");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:\"error\",data:\"parser error\"};var Blob=_dereq_(\"blob\");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if(\"function\"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if(\"function\"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(\"\"+encoded)};function encodeBase64Object(packet,callback){var message=\"b\"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message=\"b\"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(\",\")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data==\"string\"||data===undefined){if(data.charAt(0)==\"b\"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType===\"blob\"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType===\"blob\"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary==\"function\"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback(\"0:\")}function setLengthHeader(message){return message.length+\":\"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(\"\"))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!=\"string\"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var packet;if(data==\"\"){return callback(err,0,1)}var length=\"\",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(\":\"!=chr){length+=chr}else{if(\"\"==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=\"\"}}if(length!=\"\"){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p===\"string\"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p===\"string\";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded===\"string\"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength=\"\";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg=\"\";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./keys\":20,after:11,\"arraybuffer.slice\":12,\"base64-arraybuffer\":13,blob:14,\"has-binary\":21,utf8:29}],20:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],21:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:24}],22:[function(_dereq_,module,exports){try{module.exports=typeof XMLHttpRequest!==\"undefined\"&&\"withCredentials\"in new XMLHttpRequest}catch(err){module.exports=false}},{}],23:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],24:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)==\"[object Array]\"}},{}],25:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if(\"string\"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=\"\"+str;if(str.length>1e4)return;var match=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||\"ms\").toLowerCase();switch(type){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return n*y;case\"days\":case\"day\":case\"d\":return n*d;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return n*h;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return n*m;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return n*s;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+\"d\";if(ms>=h)return Math.round(ms/h)+\"h\";if(ms>=m)return Math.round(ms/m)+\"m\";if(ms>=s)return Math.round(ms/s)+\"s\";return ms+\"ms\"}function long(ms){return plural(ms,d,\"day\")||plural(ms,h,\"hour\")||plural(ms,m,\"minute\")||plural(ms,s,\"second\")||ms+\" ms\"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+\" \"+name;return Math.ceil(ms/n)+\" \"+name+\"s\"}},{}],26:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\\],:{}\\s]*$/;var rvalidescape=/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\\s*\\[)+/g;var rtrimLeft=/^\\s+/;var rtrimRight=/\\s+$/;module.exports=function parsejson(data){if(\"string\"!=typeof data||!data){return null}data=data.replace(rtrimLeft,\"\").replace(rtrimRight,\"\");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,\"@\").replace(rvalidtokens,\"]\").replace(rvalidbraces,\"\"))){return new Function(\"return \"+data)()}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],27:[function(_dereq_,module,exports){exports.encode=function(obj){var str=\"\";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+=\"&\";str+=encodeURIComponent(i)+\"=\"+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split(\"&\");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split(\"=\");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],28:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;var parts=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];module.exports=function parseuri(str){var src=str,b=str.indexOf(\"[\"),e=str.indexOf(\"]\");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,\";\")+str.substring(e,str.length)}var m=re.exec(str||\"\"),uri={},i=14;while(i--){uri[parts[i]]=m[i]||\"\"}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,\":\");uri.authority=uri.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\");uri.ipv6uri=true}return uri}},{}],29:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports==\"object\"&&exports;var freeModule=typeof module==\"object\"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output=\"\";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error(\"Lone surrogate U+\"+codePoint.toString(16).toUpperCase()+\" is not a scalar value\")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol=\"\";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString=\"\";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error(\"Invalid byte index\")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error(\"Invalid continuation byte\")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error(\"Invalid byte index\")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error(\"Invalid UTF-8 detected\")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:\"2.0.0\",encode:utf8encode,decode:utf8decode};if(typeof define==\"function\"&&typeof define.amd==\"object\"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],30:[function(_dereq_,module,exports){\"use strict\";var alphabet=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded=\"\";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+\".\"+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],31:[function(_dereq_,module,exports){var url=_dereq_(\"./url\");var parser=_dereq_(\"socket.io-parser\");var Manager=_dereq_(\"./manager\");var debug=_dereq_(\"debug\")(\"socket.io-client\");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==\"object\"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts[\"force new connection\"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug(\"ignoring socket cache for %s\",source);io=Manager(source,opts)}else{if(!cache[id]){debug(\"new io instance for %s\",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_(\"./manager\");exports.Socket=_dereq_(\"./socket\")},{\"./manager\":32,\"./socket\":34,\"./url\":35,debug:39,\"socket.io-parser\":47}],32:[function(_dereq_,module,exports){var eio=_dereq_(\"engine.io-client\");var Socket=_dereq_(\"./socket\");var Emitter=_dereq_(\"component-emitter\");var parser=_dereq_(\"socket.io-parser\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:manager\");var indexOf=_dereq_(\"indexof\");var Backoff=_dereq_(\"backo2\");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&\"object\"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||\"/socket.io\";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState=\"closed\";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.engine.id}}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug(\"readyState %s\",this.readyState);if(~this.readyState.indexOf(\"open\"))return this;debug(\"opening %s\",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState=\"opening\";this.skipReconnect=false;var openSub=on(socket,\"open\",function(){self.onopen();fn&&fn()});var errorSub=on(socket,\"error\",function(data){debug(\"connect_error\");self.cleanup();self.readyState=\"closed\";self.emitAll(\"connect_error\",data);if(fn){var err=new Error(\"Connection error\");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug(\"connect attempt will timeout after %d\",timeout);var timer=setTimeout(function(){debug(\"connect attempt timed out after %d\",timeout);openSub.destroy();socket.close();socket.emit(\"error\",\"timeout\");self.emitAll(\"connect_timeout\",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug(\"open\");this.cleanup();this.readyState=\"open\";this.emit(\"open\");var socket=this.engine;this.subs.push(on(socket,\"data\",bind(this,\"ondata\")));this.subs.push(on(socket,\"ping\",bind(this,\"onping\")));this.subs.push(on(socket,\"pong\",bind(this,\"onpong\")));this.subs.push(on(socket,\"error\",bind(this,\"onerror\")));this.subs.push(on(socket,\"close\",bind(this,\"onclose\")));this.subs.push(on(this.decoder,\"decoded\",bind(this,\"ondecoded\")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll(\"ping\")};Manager.prototype.onpong=function(){this.emitAll(\"pong\",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit(\"packet\",packet)};Manager.prototype.onerror=function(err){debug(\"error\",err);this.emitAll(\"error\",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on(\"connecting\",onConnecting);\nsocket.on(\"connect\",function(){socket.id=self.engine.id});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug(\"writing packet %j\",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug(\"cleanup\");var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug(\"disconnect\");this.skipReconnect=true;this.reconnecting=false;if(\"opening\"==this.readyState){this.cleanup()}this.backoff.reset();this.readyState=\"closed\";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug(\"onclose\");this.cleanup();this.backoff.reset();this.readyState=\"closed\";this.emit(\"close\",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug(\"reconnect failed\");this.backoff.reset();this.emitAll(\"reconnect_failed\");this.reconnecting=false}else{var delay=this.backoff.duration();debug(\"will wait %dms before reconnect attempt\",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug(\"attempting reconnect\");self.emitAll(\"reconnect_attempt\",self.backoff.attempts);self.emitAll(\"reconnecting\",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug(\"reconnect attempt error\");self.reconnecting=false;self.reconnect();self.emitAll(\"reconnect_error\",err.data)}else{debug(\"reconnect success\");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll(\"reconnect\",attempt)}},{\"./on\":33,\"./socket\":34,backo2:36,\"component-bind\":37,\"component-emitter\":38,debug:39,\"engine.io-client\":1,indexof:42,\"socket.io-parser\":47}],33:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],34:[function(_dereq_,module,exports){var parser=_dereq_(\"socket.io-parser\");var Emitter=_dereq_(\"component-emitter\");var toArray=_dereq_(\"to-array\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:socket\");var hasBin=_dereq_(\"has-binary\");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,\"open\",bind(this,\"onopen\")),on(io,\"packet\",bind(this,\"onpacket\")),on(io,\"close\",bind(this,\"onclose\"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if(\"open\"==this.io.readyState)this.onopen();this.emit(\"connecting\");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift(\"message\");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if(\"function\"==typeof args[args.length-1]){debug(\"emitting packet with ack id %d\",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug(\"transport is open - connecting\");if(\"/\"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug(\"close (%s)\",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit(\"disconnect\",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit(\"error\",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug(\"emitting event %j\",args);if(null!=packet.id){debug(\"attaching ack callback to event\");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug(\"sending ack %j\",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if(\"function\"==typeof ack){debug(\"calling ack %s with %j\",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug(\"bad ack %s\",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit(\"connect\");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug(\"server disconnect (%s)\",this.nsp);this.destroy();this.onclose(\"io server disconnect\")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug(\"performing disconnect (%s)\",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose(\"io client disconnect\")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{\"./on\":33,\"component-bind\":37,\"component-emitter\":38,debug:39,\"has-binary\":41,\"socket.io-parser\":47,\"to-array\":51}],35:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_(\"parseuri\");var debug=_dereq_(\"debug\")(\"socket.io-client:url\");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+\"//\"+loc.host;if(\"string\"==typeof uri){if(\"/\"==uri.charAt(0)){if(\"/\"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\\/\\//.test(uri)){debug(\"protocol-less url %s\",uri);if(\"undefined\"!=typeof loc){uri=loc.protocol+\"//\"+uri}else{uri=\"https://\"+uri}}debug(\"parse %s\",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port=\"80\"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port=\"443\"}}obj.path=obj.path||\"/\";var ipv6=obj.host.indexOf(\":\")!==-1;var host=ipv6?\"[\"+obj.host+\"]\":obj.host;obj.id=obj.protocol+\"://\"+host+\":\"+obj.port;obj.href=obj.protocol+\"://\"+host+(loc&&loc.port==obj.port?\"\":\":\"+obj.port);return obj}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{debug:39,parseuri:45}],36:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],37:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if(\"string\"==typeof fn)fn=obj[fn];if(\"function\"!=typeof fn)throw new Error(\"bind() requires a function\");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],38:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[\"$\"+event]=this._callbacks[\"$\"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[\"$\"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[\"$\"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[\"$\"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[\"$\"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],39:[function(_dereq_,module,exports){arguments[4][17][0].apply(exports,arguments)},{\"./debug\":40,dup:17}],40:[function(_dereq_,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:44}],41:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON&&\"function\"==typeof obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:43}],42:[function(_dereq_,module,exports){arguments[4][23][0].apply(exports,arguments)},{dup:23}],43:[function(_dereq_,module,exports){arguments[4][24][0].apply(exports,arguments)},{dup:24}],44:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],45:[function(_dereq_,module,exports){arguments[4][28][0].apply(exports,arguments)},{dup:28}],46:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");var isBuf=_dereq_(\"./is-buffer\");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if(\"object\"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&\"object\"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&\"object\"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./is-buffer\":48,isarray:43}],47:[function(_dereq_,module,exports){var debug=_dereq_(\"debug\")(\"socket.io-parser\");var json=_dereq_(\"json3\");var isArray=_dereq_(\"isarray\");var Emitter=_dereq_(\"component-emitter\");var binary=_dereq_(\"./binary\");var isBuf=_dereq_(\"./is-buffer\");exports.protocol=4;exports.types=[\"CONNECT\",\"DISCONNECT\",\"EVENT\",\"BINARY_EVENT\",\"ACK\",\"BINARY_ACK\",\"ERROR\"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug(\"encoding packet %j\",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str=\"\";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+=\"-\"}if(obj.nsp&&\"/\"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=\",\";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=\",\";str+=json.stringify(obj.data)}debug(\"encoded %j as %s\",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if(\"string\"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit(\"decoded\",packet)}}else{this.emit(\"decoded\",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error(\"got binary data when not reconstructing a packet\")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit(\"decoded\",packet)}}}else{throw new Error(\"Unknown type: \"+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf=\"\";while(str.charAt(++i)!=\"-\"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!=\"-\"){throw new Error(\"Illegal attachments\")}p.attachments=Number(buf)}if(\"/\"==str.charAt(i+1)){p.nsp=\"\";while(++i){var c=str.charAt(i);if(\",\"==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp=\"/\"}var next=str.charAt(i+1);if(\"\"!==next&&Number(next)==next){p.id=\"\";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug(\"decoded %s as %j\",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:\"parser error\"}}},{\"./binary\":46,\"./is-buffer\":48,\"component-emitter\":49,debug:39,isarray:43,json3:50}],48:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],49:[function(_dereq_,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],50:[function(_dereq_,module,exports){(function(global){(function(){var isLoader=typeof define===\"function\"&&define.amd;var objectTypes={\"function\":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global==\"object\"&&global;if(freeGlobal&&(freeGlobal[\"global\"]===freeGlobal||freeGlobal[\"window\"]===freeGlobal||freeGlobal[\"self\"]===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root[\"Object\"]());exports||(exports=root[\"Object\"]());var Number=context[\"Number\"]||root[\"Number\"],String=context[\"String\"]||root[\"String\"],Object=context[\"Object\"]||root[\"Object\"],Date=context[\"Date\"]||root[\"Date\"],SyntaxError=context[\"SyntaxError\"]||root[\"SyntaxError\"],TypeError=context[\"TypeError\"]||root[\"TypeError\"],Math=context[\"Math\"]||root[\"Math\"],nativeJSON=context[\"JSON\"]||root[\"JSON\"];if(typeof nativeJSON==\"object\"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name==\"bug-string-char-index\"){isSupported=\"a\"[0]!=\"a\"}else if(name==\"json\"){isSupported=has(\"json-stringify\")&&has(\"json-parse\")}else{var value,serialized='{\"a\":[1,true,false,null,\"\\\\u0000\\\\b\\\\n\\\\f\\\\r\\\\t\"]}';if(name==\"json-stringify\"){var stringify=exports.stringify,stringifySupported=typeof stringify==\"function\"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)===\"0\"&&stringify(new Number)===\"0\"&&stringify(new String)=='\"\"'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)===\"1\"&&stringify([value])==\"[1]\"&&stringify([undef])==\"[null]\"&&stringify(null)==\"null\"&&stringify([undef,getClass,null])==\"[null,null,null]\"&&stringify({a:[value,true,false,null,\"\\x00\\b\\n\\f\\r\t\"]})==serialized&&stringify(null,value)===\"1\"&&stringify([1,2],null,1)==\"[\\n 1,\\n 2\\n]\"&&stringify(new Date(-864e13))=='\"-271821-04-20T00:00:00.000Z\"'&&stringify(new Date(864e13))=='\"+275760-09-13T00:00:00.000Z\"'&&stringify(new Date(-621987552e5))=='\"-000001-01-01T00:00:00.000Z\"'&&stringify(new Date(-1))=='\"1969-12-31T23:59:59.999Z\"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name==\"json-parse\"){var parse=exports.parse;if(typeof parse==\"function\"){try{if(parse(\"0\")===0&&!parse(false)){value=parse(serialized);var parseSupported=value[\"a\"].length==5&&value[\"a\"][0]===1;if(parseSupported){try{parseSupported=!parse('\"\t\"')}catch(exception){}if(parseSupported){try{parseSupported=parse(\"01\")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse(\"1.\")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has(\"json\")){var functionClass=\"[object Function]\",dateClass=\"[object Date]\",numberClass=\"[object Number]\",stringClass=\"[object String]\",arrayClass=\"[object Array]\",booleanClass=\"[object Boolean]\";var charIndexBuggy=has(\"bug-string-char-index\");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=[\"valueOf\",\"toString\",\"toLocaleString\",\"propertyIsEnumerable\",\"isPrototypeOf\",\"hasOwnProperty\",\"constructor\"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!=\"function\"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property==\"prototype\")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property==\"prototype\")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property==\"prototype\")&&isProperty.call(object,property)&&!(isConstructor=property===\"constructor\")){callback(property)}}if(isConstructor||isProperty.call(object,property=\"constructor\")){callback(property)}}}return forEach(object,callback)};if(!has(\"json-stringify\")){var Escapes={92:\"\\\\\\\\\",34:'\\\\\"',8:\"\\\\b\",12:\"\\\\f\",10:\"\\\\n\",13:\"\\\\r\",9:\"\\\\t\"};var leadingZeroes=\"000000\";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix=\"\\\\u00\";var quote=function(value){var result='\"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(\"\"):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'\"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value==\"object\"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,\"toJSON\")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?\"-\":\"+\")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+\"-\"+toPaddedString(2,month+1)+\"-\"+toPaddedString(2,date)+\"T\"+toPaddedString(2,hours)+\":\"+toPaddedString(2,minutes)+\":\"+toPaddedString(2,seconds)+\".\"+toPaddedString(3,milliseconds)+\"Z\"}else{value=null}}else if(typeof value.toJSON==\"function\"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,\"toJSON\"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return\"null\"}className=getClass.call(value);if(className==booleanClass){return\"\"+value}else if(className==numberClass){return value>-1/0&&value<1/0?\"\"+value:\"null\"}else if(className==stringClass){return quote(\"\"+value)}if(typeof value==\"object\"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?\"null\":element)}result=results.length?whitespace?\"[\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"]\":\"[\"+results.join(\",\")+\"]\":\"[]\"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+\":\"+(whitespace?\" \":\"\")+element)}});result=results.length?whitespace?\"{\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"}\":\"{\"+results.join(\",\")+\"}\":\"{}\"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace=\"\",width>10&&(width=10);whitespace.length<width;whitespace+=\" \");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize(\"\",(value={},value[\"\"]=source,value),callback,properties,whitespace,\"\",[])}}if(!has(\"json-parse\")){var fromCharCode=String.fromCharCode;var Unescapes={92:\"\\\\\",34:'\"',47:\"/\",98:\"\\b\",116:\"\t\",110:\"\\n\",102:\"\\f\",114:\"\\r\"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value=\"@\",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode(\"0x\"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)==\"true\"){Index+=4;return true}else if(source.slice(Index,Index+5)==\"false\"){Index+=5;return false}else if(source.slice(Index,Index+4)==\"null\"){Index+=4;return null}abort()}}return\"$\"};var get=function(value){var results,hasMembers;if(value==\"$\"){abort()}if(typeof value==\"string\"){if((charIndexBuggy?value.charAt(0):value[0])==\"@\"){return value.slice(1)}if(value==\"[\"){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"]\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"]\"){abort()}}else{abort()}}if(value==\",\"){abort()}results.push(get(value))}return results}else if(value==\"{\"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"}\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"}\"){abort()}}else{abort()}}if(value==\",\"||typeof value!=\"string\"||(charIndexBuggy?value.charAt(0):value[0])!=\"@\"||lex()!=\":\"){abort()}results[value.slice(1)]=get(lex())\n}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value==\"object\"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=\"\"+source;result=get(lex());if(lex()!=\"$\"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[\"\"]=result,value),\"\",callback):result}}}exports[\"runInContext\"]=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root[\"JSON3\"],isRestored=false;var JSON3=runInContext(root,root[\"JSON3\"]={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root[\"JSON3\"]=previousJSON;nativeJSON=previousJSON=null}return JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],51:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[31])(31)});\n\n    \n      ;var weight = document.getElementById('weight');\n      var socket = io('https://{{ip}}:1881');\n      socket.on('getWeight', function(msg) {\n        weight.innerHTML = msg;\n    \n      }); \n    }, 1000);\n    </script>\n\n  </body>\n</html>\n","x":470,"y":1260,"wires":[["5f29303.b2f25d"]]},{"id":"5f29303.b2f25d","type":"http response","z":"f93250c7.39091","name":"","x":610,"y":1260,"wires":[]},{"id":"f9627cc0.72ff5","type":"function","z":"f93250c7.39091","name":"set ip","func":"msg.ip = global.get('ip');\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":1260,"wires":[["9ca69381.b40f2"]]},{"id":"ffdfa3d2.10a1","type":"inject","z":"5503fe41.f59f5","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":89,"wires":[["fafcb70f.9420b8"]]},{"id":"fafcb70f.9420b8","type":"function","z":"5503fe41.f59f5","name":"","func":"msg.payload = {\n    \"login\":\"user\",\n    \"password\":\"user\",\n    \"name\":\"smartscale\",\n    \"serial\": \"ldu_apex_skale_01\",\n    \"ip\":\"10.107.5.200\",\n    \"port\": \"1880\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBwb3J0IiwiaWF0IjoxNjIwMjgyMDMxfQ.yQii6kPT9eoN4HPPOMvN2g2OZaZ7s7NYGZhNQCsOY-0\"\n}\n\nflow.set(\"serial\",msg.payload.serial);\nflow.set(\"ip\",msg.payload.ip);\nreturn msg;","outputs":1,"noerr":0,"x":293,"y":82,"wires":[["6e0ed2d6.ed7a6c"]]},{"id":"6e0ed2d6.ed7a6c","type":"debug","z":"5503fe41.f59f5","name":"","active":false,"console":"false","complete":"false","x":441,"y":131,"wires":[]},{"id":"22b912e.b1518ee","type":"http request","z":"5503fe41.f59f5","name":"","method":"POST","ret":"txt","url":"http://10.1.0.141:8080/ords/ettn/v1/auth_dev","tls":"","x":618,"y":87,"wires":[["703c4cbb.22f284"]]},{"id":"a80f4788.ac5578","type":"debug","z":"5503fe41.f59f5","name":"","active":true,"console":"false","complete":"false","x":944.142822265625,"y":85,"wires":[]},{"id":"d36c00f2.bd9ad","type":"http in","z":"5503fe41.f59f5","name":"","url":"/post/serial","method":"post","swaggerDoc":"","x":211,"y":249,"wires":[["78a43408.15f9bc","477d69da.229438"]]},{"id":"78a43408.15f9bc","type":"debug","z":"5503fe41.f59f5","name":"","active":true,"console":"false","complete":"true","x":426,"y":205,"wires":[]},{"id":"477d69da.229438","type":"function","z":"5503fe41.f59f5","name":"","func":"var serial_post = msg.payload.serial;\nvar serial_flow = flow.get(\"serial\");\n\n\n\nif(serial_post === serial_flow){\n\n\n\n    msg.payload = {\"status\":\"1\"};\n\n} else {\n    msg.payload = {\"status\":\"0\"};\n}\n\n\nmsg.serial_post = serial_post;\n\n\nflow.set(\"autentification_block\", 1);\nreturn msg;","outputs":1,"noerr":0,"x":444,"y":252,"wires":[["d7faa1d0.6fcd4","c2bae0a4.b806d"]]},{"id":"d7faa1d0.6fcd4","type":"http response","z":"5503fe41.f59f5","name":"","x":600,"y":248,"wires":[]},{"id":"c2bae0a4.b806d","type":"debug","z":"5503fe41.f59f5","name":"","active":true,"console":"false","complete":"true","x":599,"y":207,"wires":[]},{"id":"efcf2df5.2efcf","type":"switch","z":"5503fe41.f59f5","name":"","property":"autentification_block","propertyType":"flow","rules":[{"t":"neq","v":"1","vt":"num"}],"checkall":"true","outputs":1,"x":450,"y":91,"wires":[["22b912e.b1518ee"]]},{"id":"703c4cbb.22f284","type":"function","z":"5503fe41.f59f5","name":"","func":"flow.set(\"autentification_block\", 0);\nreturn msg;","outputs":1,"noerr":0,"x":792.5714111328125,"y":84.71427917480469,"wires":[["a80f4788.ac5578"]]},{"id":"fe44bcc3.70e01","type":"inject","z":"5503fe41.f59f5","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":663,"y":137,"wires":[["703c4cbb.22f284"]]},{"id":"384ffb6d.364824","type":"http in","z":"5503fe41.f59f5","name":"","url":"/get/device","method":"get","swaggerDoc":"","x":228.75,"y":381.25,"wires":[["8d1eac96.9df1b"]]},{"id":"8d1eac96.9df1b","type":"function","z":"5503fe41.f59f5","name":"","func":"msg.payload = {\n  \"getawey_serial\": flow.get(\"serial\"),\n  \"devices\": [\n    {\n      \"name\": \"Автоваги №1\",\n      \"type\": \"scale\",\n      \"sybtype\": \"avto\",\n      \"guid\": \"1ceface0-038d-4de1-8cc0-a1d93217b198\"\n    },\n    {\n      \"name\": \"Автоваги №2\",\n      \"type\": \"scale\",\n      \"sybtype\": \"avto\",\n      \"guid\": \"f74f723a-8dd9-4e24-b200-be101fcd4875\"\n    },\n    {\n      \"name\": \"Автоваги №3\",\n      \"type\": \"scale\",\n      \"sybtype\": \"avto\",\n      \"guid\": \"2700ad23-4d08-467e-9c27-03579e63d7b5\"\n    },\n    {\n      \"name\": \"Залізничні №1\",\n      \"type\": \"scale\",\n      \"sybtype\": \"rail\",\n      \"guid\": \"5088d2f7-709e-4b85-bf23-97b7bbfbd560\"\n    },\n    {\n      \"name\": \"Залізничні №2\",\n      \"type\": \"scale\",\n      \"sybtype\": \"rail\",\n      \"guid\": \"ffab9c54-7df9-4ff3-a447-2731c8fece27\"\n    }\n    \n    \n  ]\n}\nreturn msg;\n\n//f87cdac6-d79a-418b-8930-1714cfe5de84","outputs":1,"noerr":0,"x":440.75,"y":379.25,"wires":[["e61b00a6.ae00a"]]},{"id":"e61b00a6.ae00a","type":"http response","z":"5503fe41.f59f5","name":"","x":633.75,"y":380.25,"wires":[]},{"id":"23d27f87.7e7b9","type":"comment","z":"de930ae4.560b48","name":"Отимання ваги","info":"","x":120,"y":240,"wires":[]},{"id":"ed88618.97b63a","type":"debug","z":"de930ae4.560b48","name":"","active":false,"console":"false","complete":"payload","x":830,"y":320,"wires":[]},{"id":"bfc9a4e.e0ee158","type":"ui_chart","z":"f93250c7.39091","name":"","group":"6d8579da.74a558","order":1,"width":"6","height":"6","label":"Ліві","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-20","ymax":"70000","removeOlder":"10","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"x":149.3333740234375,"y":690.3333740234375,"wires":[[],[]]},{"id":"6c561fd8.2d40a","type":"comment","z":"f93250c7.39091","name":"Зважити у Апекс","info":"","x":120,"y":880,"wires":[]},{"id":"e621880c.3db408","type":"comment","z":"5503fe41.f59f5","name":"Відправка даних на Апекс","info":"","x":174,"y":35,"wires":[]},{"id":"8b7df402.88cfb8","type":"comment","z":"5503fe41.f59f5","name":"Підтвердження авторизації","info":"","x":236,"y":198,"wires":[]},{"id":"3d4598a0.f65ea8","type":"comment","z":"5503fe41.f59f5","name":"Список девайсів","info":"","x":186,"y":335,"wires":[]},{"id":"b5bfdc07.5a178","type":"trigger","z":"f93250c7.39091","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","name":"","x":280,"y":260,"wires":[["4abf017d.0eca7"]]},{"id":"1312bf38.be6cc1","type":"switch","z":"f93250c7.39091","name":"","property":"transactionHasOverLoad","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":590,"y":340,"wires":[["fa7eb53.060e748"]]},{"id":"fa7eb53.060e748","type":"function","z":"f93250c7.39091","name":"over_load","func":"msg.event_id = flow.get('event_over_load');\nmsg.description = 'Можливий досип після зважування. Максимальная вага: ' + msg.metadata.transactionMaxWeight + \"кг. Облікова вага: \" + msg.metadata.transactionAccWeight + \"кг.\";\n\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":340,"wires":[["a73041fe.ebf6a"]]},{"id":"5fdb0c87.7cd264","type":"delay","z":"f93250c7.39091","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":900,"y":780,"wires":[["a73041fe.ebf6a"]]},{"id":"8dc5cb2.384a338","type":"delay","z":"f93250c7.39091","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":900,"y":820,"wires":[["a73041fe.ebf6a"]]},{"id":"27ded44.9cb402c","type":"inject","z":"3de7a235.4ff04e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":395.7142906188965,"y":174.28570747375488,"wires":[["922e11a.6d96df"]]},{"id":"26018b01.bb2984","type":"http request","z":"3de7a235.4ff04e","name":"","method":"GET","ret":"txt","url":"http://gdc1toncapp001/ONC_ELC_SCAT_TST/hs/PerimeterControl/api/SmartScales/GetWeight","tls":"","x":587.1428604125977,"y":118.5714282989502,"wires":[["8f0bd557.603668"]]},{"id":"8f0bd557.603668","type":"debug","z":"3de7a235.4ff04e","name":"","active":true,"console":"false","complete":"true","x":787.1428604125977,"y":158.5714282989502,"wires":[]},{"id":"c90138c0.4d6328","type":"http in","z":"48413719.e10dd8","name":"","url":"/sendOnBoard","method":"post","swaggerDoc":"","x":170,"y":360,"wires":[["ea5a2016.1b1b3","efe1c6a4.136998","ef2f4971.08d518","ce6058c7.8cca18"]]},{"id":"ea5a2016.1b1b3","type":"http response","z":"48413719.e10dd8","name":"","x":430,"y":260,"wires":[]},{"id":"922e11a.6d96df","type":"http request","z":"3de7a235.4ff04e","name":"","method":"POST","ret":"txt","url":"https://10.101.71.7/ONC_ELC_SCAT_TST/hs/PerimeterControl/api/SmartScales/GetWeight","tls":"b1522108.07191","x":587.1428604125977,"y":178.5714282989502,"wires":[["8f0bd557.603668"]]},{"id":"5fe76055.ea5d1","type":"switch","z":"48413719.e10dd8","name":"","property":"payload['АдресУстройства']","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"},{"t":"eq","v":"5","vt":"num"},{"t":"eq","v":"6","vt":"num"},{"t":"eq","v":"7","vt":"num"},{"t":"eq","v":"8","vt":"num"},{"t":"eq","v":"9","vt":"num"},{"t":"eq","v":"10","vt":"num"}],"checkall":"true","outputs":10,"x":3790,"y":400,"wires":[["8db44c1d.48197","2ba7a9f0.9f8426"],["c31a8cca.4f59e","1db47dea.f4a4c2"],["71925b5f.07f7f4","235e5c9f.cd39e4"],["80eb87a4.ce6688","2620af0c.042ae"],["bc7a9cd0.2acb9","78175e92.d28e9"],["3ef8e41e.9d122c","bd287b97.e4df48"],["80acc407.7787c8","754f3c92.21ec84"],["aa317cbf.fbcc","2f0f0de1.b335a2"],["a14bae5.e3aaa5","ad59e9a6.35d578"],["3340129d.ea1bde","748d35fd.87718c"]]},{"id":"4f9f7337.4c156c","type":"comment","z":"3de7a235.4ff04e","name":"Інфо","info":"/ONC_ELC_SCAT_TST/hs/PerimeterControl/api/SmartScales/GetWeight","x":607.1428604125977,"y":58.571428298950195,"wires":[]},{"id":"9fa8b878.0bb8f8","type":"http request","z":"3de7a235.4ff04e","name":"","method":"POST","ret":"txt","url":"https://10.101.71.7/ONC_ELC_SCAT_TST/hs/PerimeterControl/api/SmartScales/GetWeight","tls":"b1522108.07191","x":510,"y":340,"wires":[["45dcdd89.1d6c44"]]},{"id":"1e45819d.c6003e","type":"debug","z":"3de7a235.4ff04e","name":"","active":false,"console":"false","complete":"false","x":910,"y":300,"wires":[]},{"id":"45dcdd89.1d6c44","type":"function","z":"3de7a235.4ff04e","name":"","func":"flow.set(\"pl\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":340,"wires":[["b38d0bd.190fdf8","1e45819d.c6003e"]]},{"id":"77579e5a.26878","type":"inject","z":"3de7a235.4ff04e","name":"","topic":"","payload":"pl","payloadType":"flow","repeat":"","crontab":"","once":false,"x":110,"y":380,"wires":[["227d4022.c9b81"]]},{"id":"227d4022.c9b81","type":"debug","z":"3de7a235.4ff04e","name":"","active":false,"console":"false","complete":"false","x":290,"y":380,"wires":[]},{"id":"b38d0bd.190fdf8","type":"ui_template","z":"3de7a235.4ff04e","group":"7f5f15e8.00caec","name":"","order":0,"width":"6","height":"7","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"x":900,"y":340,"wires":[[]]},{"id":"8cefbeed.cd68d","type":"comment","z":"48413719.e10dd8","name":"Лабораторія","info":"Лабораторія","x":4430,"y":180,"wires":[]},{"id":"d228f51a.7897b8","type":"function","z":"3de7a235.4ff04e","name":"test","func":"msg.payload = {\n    truck_id:123,\n    device_id:123,\n};\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":340,"wires":[["9fa8b878.0bb8f8"]]},{"id":"51f61e1f.10ff5","type":"inject","z":"3de7a235.4ff04e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":340,"wires":[["d228f51a.7897b8"]]},{"id":"8db44c1d.48197","type":"function","z":"48413719.e10dd8","name":"1р 1","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4453.895896911621,"y":232.8888816833496,"wires":[[]]},{"id":"2ba7a9f0.9f8426","type":"function","z":"48413719.e10dd8","name":"2р 1","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4454.965190887451,"y":270.8055610656738,"wires":[["128f568a.25a6b9"]]},{"id":"c31a8cca.4f59e","type":"function","z":"48413719.e10dd8","name":"1р 2","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4452.895843505859,"y":315.8888931274414,"wires":[[]]},{"id":"1db47dea.f4a4c2","type":"function","z":"48413719.e10dd8","name":"2р 2","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4453.9651222229,"y":353.8055477142334,"wires":[["8d40183a.2bac68"]]},{"id":"71925b5f.07f7f4","type":"function","z":"48413719.e10dd8","name":"1р 3","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4451.8957862854,"y":413.88887786865234,"wires":[[]]},{"id":"235e5c9f.cd39e4","type":"function","z":"48413719.e10dd8","name":"2р 3","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4451.965148925781,"y":448.80554008483887,"wires":[["ff32c1f1.951db"]]},{"id":"80eb87a4.ce6688","type":"function","z":"48413719.e10dd8","name":"1р 4","func":"msg.payload =  msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4447.895801544189,"y":504.8888897895813,"wires":[[]]},{"id":"2620af0c.042ae","type":"function","z":"48413719.e10dd8","name":"2р 4","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4448.965084075928,"y":541.8055438995361,"wires":[["7d6b4212.452b1c"]]},{"id":"eb79f5c7.da6668","type":"comment","z":"3de7a235.4ff04e","name":"https://10.101.71.7/ONC_ELC_SCAT_TST/hs/PerimeterControl/api/SmartScales/GetWeight","info":"apiuser\napiuser","x":370,"y":240,"wires":[]},{"id":"fdbcd4a3.8aa5f8","type":"comment","z":"3de7a235.4ff04e","name":"тест відправки в 1С","info":"","x":160,"y":300,"wires":[]},{"id":"d9e0ff9e.71ca4","type":"comment","z":"48413719.e10dd8","name":"інформація на табло","info":"","x":140,"y":320,"wires":[]},{"id":"9ed34b75.801158","type":"comment","z":"962df517.4837f8","name":"Получение id сессии","info":"Трассир SDK.\nАдрес сервера 10.107.9.200    SDK port 8080\nПользователь SDK:\nLogin:  Admin\nPass:  Admin@RHN_Trassir\n\nhttps://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir\n\n\n\n\n","x":160,"y":220,"wires":[]},{"id":"95ab2e1f.411de","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":260,"wires":[["c3d262f6.b58e4"]]},{"id":"d2506887.fe3558","type":"debug","z":"962df517.4837f8","name":"","active":false,"console":"false","complete":"false","x":990,"y":260,"wires":[]},{"id":"bc7a9cd0.2acb9","type":"function","z":"48413719.e10dd8","name":"1р 5","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4447.895801544189,"y":644.8888897895813,"wires":[[]]},{"id":"78175e92.d28e9","type":"function","z":"48413719.e10dd8","name":"2р 5","func":"msg.payload =  msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4450,"y":680,"wires":[["3128fd67.b15662"]]},{"id":"3ef8e41e.9d122c","type":"function","z":"48413719.e10dd8","name":"1р 6","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4450,"y":740,"wires":[[]]},{"id":"bd287b97.e4df48","type":"function","z":"48413719.e10dd8","name":"2р 6","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4450,"y":780,"wires":[["72f266c6.35fc58"]]},{"id":"80acc407.7787c8","type":"function","z":"48413719.e10dd8","name":"1р 7","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4450,"y":840,"wires":[[]]},{"id":"754f3c92.21ec84","type":"function","z":"48413719.e10dd8","name":"2р 7","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4450,"y":880,"wires":[["5bac4dc1.c8c864"]]},{"id":"aa317cbf.fbcc","type":"function","z":"48413719.e10dd8","name":"1р 8","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":4447.895801544189,"y":924.8888897895813,"wires":[[]]},{"id":"2f0f0de1.b335a2","type":"function","z":"48413719.e10dd8","name":"2р 8","func":"msg.payload =  msg.payload.Строка2;\n//максимально 12 символів у рядку\nflow.set('2r8', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":4450,"y":960,"wires":[["f8451583.2cc888"]]},{"id":"82c4bc10.725ac","type":"comment","z":"48413719.e10dd8","name":"Вагова","info":"","x":4410,"y":600,"wires":[]},{"id":"5b18cb4a.842534","type":"tcp in","z":"ee144e5a.86352","name":"","server":"server","host":"","port":"4009","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":80,"y":60,"wires":[["ca9e03d9.9ffa6","7c2693ac.f0d2dc","32e768ae.cef938","2c252cd6.fef5a4"]]},{"id":"ca9e03d9.9ffa6","type":"function","z":"ee144e5a.86352","name":"set last Analys","func":"flow.set('lastAnalys',msg.payload);\nflow.set('barcode',\"\");\nglobal.set('device_id_infratec','9ba5d151-ada3-a2e7-7050-ec451f019000');\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":60,"wires":[["f7efc642.2a74a8"]]},{"id":"2e778b80.b39ea4","type":"http in","z":"ee144e5a.86352","name":"","url":"/getQuality","method":"get","swaggerDoc":"","x":160,"y":360,"wires":[["425725f1.d03b1c"]]},{"id":"94a9bae0.ebd6b8","type":"http response","z":"ee144e5a.86352","name":"","x":630,"y":360,"wires":[]},{"id":"425725f1.d03b1c","type":"function","z":"ee144e5a.86352","name":"create response","func":"var load = flow.get('load');\nif (load){\n    msg.payload = flow.get('parseQA');    \n    msg.load = true;\n}else{\n    msg.payload = {};\n    msg.load = false;\n}\nmsg.payload.barcode = flow.get('barcode');\nflow.set(\"load\",false);\n\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":360,"wires":[["94a9bae0.ebd6b8","84e0c27a.0fb5c","ee03bc76.fb8c2"]]},{"id":"f7efc642.2a74a8","type":"function","z":"ee144e5a.86352","name":"parse quality","func":"var result = {\n    localdate:new Date()\n};\n\nvar sdata = msg.payload;\nvar arr_sdata = sdata.split('\\n');\n\nresult.length = arr_sdata.length;\n\n//Ambient Temperature\nvar ambietTemperature = arr_sdata[7];\nvar arr_ambietTemperature = ambietTemperature.split(\":\");\nresult.ambietTemperature = arr_ambietTemperature[1];\n\n//Analysis Counter\nvar analysisCounter = arr_sdata[8];\nvar arr_analysisCounter = analysisCounter.split(\":\");\nresult.analysisCounter = arr_analysisCounter[1];\n\n//Sub sample\nvar subSample = arr_sdata[11];\nvar arr_subSample = subSample.split(\":\");\nvar arr_subSample_1 = arr_subSample[0].split(\"     \");\n\nresult.subsample = {\n   id : arr_subSample[0].replace(\"NrOFSubSamples\",\"\"),\n   NrOFSubSamples : arr_subSample[1]\n}\n\n//Sample hash\nvar sampleHash = arr_sdata[13];\nresult.sampleHash = sampleHash;\n\n//read quailities \nvar startQ  = 14;\nvar qLength = 7;\nvar endStr  = \"#\";\n\nvar qualities = [];\n\nfor( var i = startQ; i <= arr_sdata.length-qLength; ){\n    \n    var q = {\n        id:arr_sdata[i],\n        value:arr_sdata[i+1].split(String.fromCharCode(20)),\n        minmax:arr_sdata[i+4].split(String.fromCharCode(20))\n    }\n    qualities.push(q);   \n    i = i+qLength;\n    \n}\n\nresult.qualities = qualities;\nresult.datahash  = JSON.stringify(result);\n// msg.payload = arr_sdata;\nmsg.payload = result;\nflow.set('parseQA',result);\n\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":60,"wires":[["dcb96e2c.e44e1","f44bbca3.3ab77","2f2559d9.9cdc86"]]},{"id":"f968e151.7b5b","type":"inject","z":"ee144e5a.86352","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":110,"y":500,"wires":[["251bf2f5.77882e"]]},{"id":"251bf2f5.77882e","type":"function","z":"ee144e5a.86352","name":"init config","func":"flow.set('load',false);\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":500,"wires":[[]]},{"id":"6ac5556e.018c9c","type":"function","z":"ee144e5a.86352","name":"read barcode","func":"flow.set(\"barcode\",msg.payload.replace(\"\\r\",\"\"));\nflow.set('load',true);\nmsg.payload = {\n    \"barcode\":msg.payload.replace(\"\\r\",\"\")\n}\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":560,"wires":[["6ea8a03e.35775","9738e37f.34459"]]},{"id":"d8308b30.03e5f8","type":"link in","z":"7719c21e.c9711c","name":"quality Lab in","links":["dcb96e2c.e44e1"],"x":35,"y":300,"wires":[["77ae47fa.7bd7f8"]]},{"id":"951b3650.484748","type":"http request","z":"7719c21e.c9711c","name":"EVENTS","method":"POST","ret":"txt","url":"","tls":"80207470.ec8f48","x":942,"y":299,"wires":[["f619da9c.125e98"]]},{"id":"d1e6f339.c8eae","type":"function","z":"7719c21e.c9711c","name":"events payload","func":"var event_id = msg.event_id;\nvar device_id = global.get('device_id_infratec');\n\n\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'devices':[{'id':device_id}],\n    'data':msg.metadata,\n    'description':msg.description\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('event_url');\nmsg.main_host = flow.get('main_host');\nmsg.event_url = flow.get('event_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":300,"wires":[["951b3650.484748","3409105.5aafaf"]]},{"id":"a4e9afc0.83a84","type":"inject","z":"7719c21e.c9711c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":100,"y":500,"wires":[["4f0aa674.bc7598"]]},{"id":"4f0aa674.bc7598","type":"function","z":"7719c21e.c9711c","name":"check scale health","func":"var lastcheckHealth = flow.get('checkHealth');\nvar checkHealth = null;\nvar lasttimedata = flow.get('lasttimedata');\n\nvar currenttimedata = new Date();\n\nif ((currenttimedata - lasttimedata) > 3000){\n    checkHealth = false;\n} else {\n    checkHealth = true;\n}\n\nflow.set(\"checkHealth\",checkHealth);\n\nif (lastcheckHealth != checkHealth){\n    msg.checkHealth = checkHealth;\n}else{\n    msg.checkHealth = null;\n}\nmsg.payload = checkHealth;\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":500,"wires":[["cc61ccc4.d7bf4"]]},{"id":"394b5d1.ebfe4a2","type":"function","z":"7719c21e.c9711c","name":"main config","func":"flow.set('checkHealth',null);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":730,"y":200,"wires":[[]]},{"id":"55a41033.1ea7a","type":"inject","z":"7719c21e.c9711c","name":"","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":90,"y":160,"wires":[["3da14fe5.71fbe","9e1fdd73.679d8"]]},{"id":"fb979b5b.5293c8","type":"http request","z":"7719c21e.c9711c","name":"STATE","method":"POST","ret":"txt","url":"","tls":"79a8e2bb.a2ee4c","x":590,"y":500,"wires":[["fead9b2c.b6b198"]]},{"id":"cc61ccc4.d7bf4","type":"function","z":"7719c21e.c9711c","name":"device state","func":"msg.payload = {\n    \"state\":msg.payload\n}\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\nmsg.url = flow.get('main_host')+flow.get('state_url')+\"?id=\"+global.get(\"device_id_infratec\");\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":500,"wires":[["fb979b5b.5293c8"]]},{"id":"b5eb6504.846738","type":"function","z":"7719c21e.c9711c","name":"device config","func":"var device_config = JSON.parse(msg.payload);\n\nflow.set('event_make_quality_id',device_config.event_make_quality_id);\nflow.set('event_read_barcode_id',device_config.event_read_barcode_id);\nflow.set('event_send_to_accsystem_id',device_config.event_send_to_accsystem_id);\nflow.set('event_no_conditional',device_config.event_no_conditional);\nflow.set('main_host',device_config.main_host);\nflow.set('event_url',device_config.event_url);\nflow.set('state_url',device_config.state_url);\nflow.set('snapshot_url',device_config.snapshot_url);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":730,"y":160,"wires":[["5e732b1e.4e8934"]]},{"id":"44e40a7b.985a94","type":"http in","z":"7719c21e.c9711c","name":"","url":"/firmware","method":"post","swaggerDoc":"","x":140,"y":120,"wires":[["a8f5dab4.4ca4d8"]]},{"id":"a8f5dab4.4ca4d8","type":"file","z":"7719c21e.c9711c","name":"deivce_config_infratec.json","filename":"deivce_config_infratec.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":480,"y":120,"wires":[]},{"id":"4ef0f546.73b65c","type":"file in","z":"7719c21e.c9711c","name":"deivce_config_infratec.json","filename":"deivce_config_infratec.json","format":"utf8","x":500,"y":160,"wires":[["b5eb6504.846738"]]},{"id":"5fb7a574.063b7c","type":"inject","z":"7719c21e.c9711c","name":"DEMO","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":100,"y":60,"wires":[["46ffa6b0.2afca8"]]},{"id":"46ffa6b0.2afca8","type":"function","z":"7719c21e.c9711c","name":"DEMO Data","func":"var device_config = {\n    'event_make_quality_id':'8B9482814EDB2FC9E055000000000001',\n    'event_read_barcode_id':'8B9482814EDC2FC9E055000000000001',\n    'event_send_to_accsystem_id':'8B9482814EDD2FC9E055000000000001',\n    'event_no_conditional':'8C4D78A0466C7B36E055000000000001',\n    'main_host':'https://10.107.5.200:8443/ords/ettn',\n    'event_url':'/iot_cli/events/log',\n    'state_url':'/iot_cli/device',\n    'snapshot_url':'/iot_cli/events/snapshot'\n}\nmsg.payload = device_config;\n// flow.set('scale_id','80096CB0EFD83B63E0533300000A4334');\n// flow.set('event_move_in_id','80096D9ABE7F68F3E0533300000A6C0D');\n// flow.set('event_move_out_id','80096D9ABE8068F3E0533300000A6C0D');\n// flow.set('event_max_weight_id','85A255F950F9BEF4E0533300000AC45D');\n// flow.set('event_off_id','85A2CC4570292DD1E0533300000A0C94');\n// flow.set('event_on_id', '85A2CC45702A2DD1E0533300000A0C94');\n// flow.set('event_max_duration','8642EE858DE89BAAE0533300000AFCC7');\n// flow.set('main_host','http://prod.apex.rest/ords/ettn');\n// flow.set('event_url','/iot_cli/events/log');\n// flow.set('state_url','/v1/device');\n// flow.set('maxWeight',40000);\n// flow.set('maxDuration',20000);\n// flow.set('checkHealthTimeout',3000);\nreturn msg;\n//http://156.67.53.93:8888/ords/ettn\n//http://skelya.prncp.org/ords/ettn","outputs":1,"noerr":0,"x":270,"y":60,"wires":[["a8f5dab4.4ca4d8"]]},{"id":"2e08a66f.53495a","type":"function","z":"7719c21e.c9711c","name":"send quality","func":"msg.event_id = flow.get('event_make_quality_id');\nmsg.description = 'Отримали якість із аналізатору. Номер аналізу: ' + msg.payload.analysisCounter+\". Калібровка \"+msg.payload.subsample_id;\nmsg.metadata = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":300,"wires":[["d1e6f339.c8eae"]]},{"id":"fead9b2c.b6b198","type":"debug","z":"7719c21e.c9711c","name":"","active":true,"console":"false","complete":"false","x":730,"y":500,"wires":[]},{"id":"5e732b1e.4e8934","type":"debug","z":"7719c21e.c9711c","name":"","active":false,"console":"false","complete":"payload","x":890,"y":160,"wires":[]},{"id":"dcb546f8.fa9818","type":"link in","z":"7719c21e.c9711c","name":"barcode Lab in","links":["6ea8a03e.35775"],"x":35,"y":340,"wires":[["dc21b0bd.f3166"]]},{"id":"dc21b0bd.f3166","type":"function","z":"7719c21e.c9711c","name":"read barcode","func":"msg.event_id = flow.get('event_read_barcode_id');\nmsg.description = 'Зчитування штрих-коду: ' + msg.payload.barcode;\nmsg.metadata = msg.payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":340,"wires":[["d1e6f339.c8eae"]]},{"id":"44cbf489.79396c","type":"function","z":"7719c21e.c9711c","name":"send to 1c","func":"msg.event_id = flow.get('event_send_to_accsystem_id');\nmsg.description = 'Отримання аналізу в 1С: ' + msg.payload.barcode;\nmsg.metadata = {\n    'barcode':msg.payload.barcode\n}\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":380,"wires":[["d1e6f339.c8eae"]]},{"id":"8e127c2e.62d67","type":"link in","z":"7719c21e.c9711c","name":"1c Lab in","links":["acc3f9fd.24c138"],"x":35,"y":380,"wires":[["44cbf489.79396c"]]},{"id":"dcb96e2c.e44e1","type":"link out","z":"ee144e5a.86352","name":"get quality throw tcp Lab in","links":["d8308b30.03e5f8"],"x":775,"y":60,"wires":[]},{"id":"acc3f9fd.24c138","type":"link out","z":"ee144e5a.86352","name":"1c request Lab in","links":["8e127c2e.62d67"],"x":735,"y":400,"wires":[]},{"id":"6ea8a03e.35775","type":"link out","z":"ee144e5a.86352","name":"read barcode Lab in","links":["dcb546f8.fa9818"],"x":495,"y":560,"wires":[]},{"id":"ec281a5c.9a1d48","type":"switch","z":"7719c21e.c9711c","name":"","property":"isNotConditional","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":410,"y":400,"wires":[["44d3538d.627dcc"]]},{"id":"44d3538d.627dcc","type":"function","z":"7719c21e.c9711c","name":"send quality","func":"msg.event_id = flow.get('event_no_conditional');\nmsg.description = 'Некодинційня якість. Номер аналізу ' + msg.payload.analysisCounter;\n\nvar payload = {};\nfor (var i = 0; i < msg.notcondition.length; i++){\n    payload = msg.notcondition[i];  \n}\nmsg.metadata = payload;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":400,"wires":[["d1e6f339.c8eae","cf8492cf.2f9a5"]]},{"id":"cf8492cf.2f9a5","type":"debug","z":"7719c21e.c9711c","name":"","active":false,"console":"false","complete":"true","x":730,"y":403,"wires":[]},{"id":"77ae47fa.7bd7f8","type":"function","z":"7719c21e.c9711c","name":"parse result","func":"var p = msg.payload;\n\nvar result = {\n    \"ambietTemperature\":p.ambietTemperature,\n    \"analysisCounter\":p.analysisCounter,\n    \"subsample_id\":p.subsample.id,\n    \"subsample_NrOFSubSamples\":p.subsample.NrOFSubSamples,\n    \"sampleHash\":p.sampleHash\n};\nvar notcondition = [];\nvar isNotConditional = false;\n\nfor (var i = 0; i < p.qualities.length; i++){\n    \n    var valueid = p.qualities[i].id.replace(\" \",\"\"); \n    var temp_value_name = p.qualities[i].value[0].match(/[a-zA-Z]+/g)[0];\n    var temp_value = parseFloat(p.qualities[i].value[0].match(/\\d+.\\d+/g));\n    result[temp_value_name] = temp_value;\n    \n    var temp_value_min_name = p.qualities[i].minmax[0].match(/[a-zA-Z]+/g)[0];\n    var temp_value_min = parseFloat(p.qualities[i].minmax[0].match(/\\d+.\\d+/g)[0]);\n    // result[temp_value_name+\"_\"+temp_value_min_name] = temp_value_min;\n    \n    var temp_value_max_name = p.qualities[i].minmax[0].match(/[a-zA-Z]+/g)[1];\n    var temp_value_max = parseFloat(p.qualities[i].minmax[0].match(/\\d+.\\d+/g)[1]);\n    // result[temp_value_name+\"_\"+temp_value_max_name] = temp_value_max;\n    \n    if ((temp_value>temp_value_max) || (temp_value<temp_value_min)){\n        notcondition.push({\n            [temp_value_name]:temp_value,\n            [temp_value_min_name]:temp_value_min,\n            [temp_value_max_name]:temp_value_max\n        });\n        isNotConditional = true;\n    }\n}\nmsg.payload = result;\nmsg.notcondition = notcondition;\nmsg.isNotConditional = isNotConditional;\n\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":300,"wires":[["2e08a66f.53495a","ec281a5c.9a1d48"]]},{"id":"84e0c27a.0fb5c","type":"switch","z":"ee144e5a.86352","name":"","property":"load","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":630,"y":400,"wires":[["acc3f9fd.24c138"]]},{"id":"213cada5.c36692","type":"debug","z":"ee144e5a.86352","name":"Analysis","active":false,"console":"true","complete":"payload","x":830,"y":100,"wires":[]},{"id":"f44bbca3.3ab77","type":"json","z":"ee144e5a.86352","name":"","x":630,"y":80,"wires":[["213cada5.c36692"]]},{"id":"ee03bc76.fb8c2","type":"json","z":"ee144e5a.86352","name":"","x":610,"y":440,"wires":[["d73ac71d.7c7a08"]]},{"id":"d73ac71d.7c7a08","type":"debug","z":"ee144e5a.86352","name":"getQuality","active":false,"console":"true","complete":"payload","x":770,"y":440,"wires":[]},{"id":"3409105.5aafaf","type":"json","z":"7719c21e.c9711c","name":"","x":930,"y":260,"wires":[["6b36457f.2dbc6c"]]},{"id":"6b36457f.2dbc6c","type":"debug","z":"7719c21e.c9711c","name":"event","active":false,"console":"true","complete":"payload","x":1060,"y":260,"wires":[]},{"id":"c126ff52.df171","type":"debug","z":"ee144e5a.86352","name":"Analysis wihout parse","active":false,"console":"true","complete":"payload","x":530,"y":140,"wires":[]},{"id":"7c2693ac.f0d2dc","type":"function","z":"ee144e5a.86352","name":"","func":"msg.payload = {\n    msg:\"\" + msg.payload\n};\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":140,"wires":[["547bdbd3.a35784"]]},{"id":"547bdbd3.a35784","type":"json","z":"ee144e5a.86352","name":"","x":330,"y":140,"wires":[["c126ff52.df171"]]},{"id":"9738e37f.34459","type":"debug","z":"ee144e5a.86352","name":"","active":true,"console":"false","complete":"false","x":530,"y":600,"wires":[]},{"id":"2f2559d9.9cdc86","type":"debug","z":"ee144e5a.86352","name":"","active":false,"console":"false","complete":"false","x":810,"y":20,"wires":[]},{"id":"f619da9c.125e98","type":"debug","z":"7719c21e.c9711c","name":"event","active":false,"console":"true","complete":"payload","x":1091,"y":301,"wires":[]},{"id":"20a91b7.6af20e4","type":"inject","z":"ee144e5a.86352","name":"","topic":"","payload":"parseQA","payloadType":"flow","repeat":"","crontab":"","once":false,"x":150,"y":640,"wires":[["262aa9a5.4d0656","a0811b09.a1e0e8"]]},{"id":"262aa9a5.4d0656","type":"debug","z":"ee144e5a.86352","name":"","active":true,"console":"false","complete":"false","x":530,"y":640,"wires":[]},{"id":"a0811b09.a1e0e8","type":"json","z":"ee144e5a.86352","name":"","x":330,"y":680,"wires":[["262aa9a5.4d0656"]]},{"id":"1934f0f.6fea60f","type":"http in","z":"ee144e5a.86352","name":"","url":"/gettest","method":"get","swaggerDoc":"","x":170,"y":780,"wires":[["fdb5279c.cdab78"]]},{"id":"3243c127.71478e","type":"http response","z":"ee144e5a.86352","name":"","x":570,"y":780,"wires":[]},{"id":"fdb5279c.cdab78","type":"function","z":"ee144e5a.86352","name":"create response","func":"msg.payload = flow.get('parseQA');    \n  \nreturn msg;","outputs":1,"noerr":0,"x":400,"y":780,"wires":[["3243c127.71478e"]]},{"id":"3da14fe5.71fbe","type":"trigger","z":"7719c21e.c9711c","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","name":"","x":460,"y":200,"wires":[["394b5d1.ebfe4a2"]]},{"id":"90029434.295be8","type":"tcp in","z":"de930ae4.560b48","name":"","server":"client","host":"10.107.5.102","port":"1887","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":140,"y":280,"wires":[["4e573b97.907144","bf7ee5bf.f0c5c8","2c1a7620.bdc4aa"]]},{"id":"4e573b97.907144","type":"debug","z":"de930ae4.560b48","name":"","active":false,"console":"false","complete":"false","x":450,"y":320,"wires":[]},{"id":"f5c098d1.b16498","type":"http in","z":"f93250c7.39091","name":"","url":"/get2","method":"get","swaggerDoc":"","x":140,"y":1100,"wires":[["e14d4816.e60718","8d13f6e9.254448"]]},{"id":"e14d4816.e60718","type":"function","z":"f93250c7.39091","name":"response","func":"msg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nif(transactionWaybill && transactionWaybill !== msg.req.query.reader){\n    msg.payload.status = false;    \n}else {\n    msg.payload.status = true;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":1100,"wires":[["a7c32566.f63c88"]]},{"id":"a7c32566.f63c88","type":"http response","z":"f93250c7.39091","name":"","x":590,"y":1100,"wires":[]},{"id":"63bc1312.555a1c","type":"inject","z":"3de7a235.4ff04e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":420,"wires":[["60eb255c.5d283c"]]},{"id":"60eb255c.5d283c","type":"http request","z":"3de7a235.4ff04e","name":"","method":"POST","ret":"txt","url":"https://10.107.5.201/ONC_ELC_SCAT_TST/hs/PerimeterControl/api/ERFID/RFIDCommandWriteListTags","tls":"f436a52.4d81958","x":340,"y":420,"wires":[["b6062840.22e638"]]},{"id":"b6062840.22e638","type":"debug","z":"3de7a235.4ff04e","name":"","active":false,"console":"false","complete":"false","x":530,"y":420,"wires":[]},{"id":"860b998f.36d108","type":"debug","z":"d7f6f063.4555c","name":"","active":false,"console":"false","complete":"payload","x":290,"y":200,"wires":[]},{"id":"1f71c256.bff13e","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"obj","url":"https://10.107.9.100:8080/channels?sid=QMg3e8aF","tls":"d049c21b.cdc58","x":290,"y":340,"wires":[["3c35f74f.3ba198","f80bbe2d.6ceb8"]]},{"id":"847f9378.2192e","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":340,"wires":[["1f71c256.bff13e"]]},{"id":"3c35f74f.3ba198","type":"debug","z":"962df517.4837f8","name":"","active":true,"console":"false","complete":"false","x":490,"y":340,"wires":[]},{"id":"b16a528.d7d33b","type":"comment","z":"962df517.4837f8","name":"Запрос списка каналов","info":"https://10.107.9.100:8080/channels?sid=asblE5uL\n","x":170,"y":300,"wires":[]},{"id":"eb72f57a.276128","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"txt","url":"https://10.107.9.100:8080/screenshot/B7KQRyWz?timestamp=0&sid=TruckScales-R2A08-V6","tls":"d049c21b.cdc58","x":290,"y":420,"wires":[["b0dc3412.e69c08"]]},{"id":"52e52193.ba1a1","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":420,"wires":[["eb72f57a.276128"]]},{"id":"b0dc3412.e69c08","type":"debug","z":"962df517.4837f8","name":"","active":true,"console":"false","complete":"false","x":490,"y":420,"wires":[]},{"id":"4dc8dce.c6f6624","type":"comment","z":"962df517.4837f8","name":"Запрос скриншота","info":"\n\n\nhttps://10.107.9.100:8080/screenshot/B7KQRyWz?timestamp=0&sid=YSC15Slf","x":810,"y":220,"wires":[]},{"id":"4e9e8e0c.33227","type":"comment","z":"87b488d6.5b73f8","name":"Запит останніх показників всіх електро лічильників","info":"MySQL:\nUser: root;\nPassword: Zz_875_gw.\nZz_875_gw\n\nelecMeter_MeterSerialNumber_type1","x":210,"y":860,"wires":[]},{"id":"bd4ef8a1.ad9468","type":"inject","z":"d7f6f063.4555c","name":"","topic":"","payload":"inputString","payloadType":"flow","repeat":"1","crontab":"","once":false,"x":100,"y":260,"wires":[["860b998f.36d108","a8368915.7afa68"]]},{"id":"4e592a5.2fc77d4","type":"mysql","z":"87b488d6.5b73f8","mydb":"e03e62d3.458ec","name":"","x":490,"y":520,"wires":[["dc7f0408.dbcce8","290b708d.b68b9"]]},{"id":"44427e91.95194","type":"inject","z":"87b488d6.5b73f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":100,"y":520,"wires":[["f27d8de6.246cd"]]},{"id":"dc7f0408.dbcce8","type":"debug","z":"87b488d6.5b73f8","name":"","active":true,"console":"false","complete":"true","x":850,"y":520,"wires":[]},{"id":"f27d8de6.246cd","type":"template","z":"87b488d6.5b73f8","name":"всі таблиці","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SHOW TABLES;","x":290,"y":520,"wires":[["4e592a5.2fc77d4"]]},{"id":"d94f9e5.b4e786","type":"template","z":"87b488d6.5b73f8","name":"elecMeter_0000000000000001_type1","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM elecMeter_0000000000000001_type1 ORDER BY id DESC LIMIT 1) t ORDER BY id;","x":690,"y":740,"wires":[["b9863b3b.714fe8"]]},{"id":"937183d8.c348c","type":"template","z":"87b488d6.5b73f8","name":"elecMeter_0000000000000002_type1","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM elecMeter_0000000000000002_type1 ORDER BY id DESC LIMIT 1) t ORDER BY id;","x":690,"y":800,"wires":[["b3cd7f86.4a53f"]]},{"id":"477a65bb.761afc","type":"template","z":"87b488d6.5b73f8","name":"elecMeter_0000000000000003_type1","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM elecMeter_0000000000000003_type1 ORDER BY id DESC LIMIT 1) t ORDER BY id;","x":690,"y":860,"wires":[["ec0380a.083338"]]},{"id":"9067ae0b.0a15e","type":"template","z":"87b488d6.5b73f8","name":"elecMeter_0000000000000004_type1","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM elecMeter_0000000000000004_type1 ORDER BY id DESC LIMIT 1) t ORDER BY id;","x":690,"y":920,"wires":[["229f57f.47aeea8"]]},{"id":"b69e51ac.56fc6","type":"template","z":"87b488d6.5b73f8","name":"elecMeter_0000000000000005_type1","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM elecMeter_0000000000000005_type1 ORDER BY id DESC LIMIT 1) t ORDER BY id;","x":690,"y":980,"wires":[["5809e0aa.684d7"]]},{"id":"47843d01.37adc4","type":"template","z":"87b488d6.5b73f8","name":"elecMeter_0000000000000006_type1","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM elecMeter_0000000000000006_type1 ORDER BY id DESC LIMIT 1) t ORDER BY id;","x":690,"y":1040,"wires":[["e432b77c.40ec98"]]},{"id":"439f3c8.1d422c4","type":"template","z":"87b488d6.5b73f8","name":"elecMeter_0000000000000007_type1","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM elecMeter_0000000000000007_type1 ORDER BY id DESC LIMIT 1) t ORDER BY id;","x":690,"y":1100,"wires":[["1d4d4743.cf5019"]]},{"id":"db09b522.580a98","type":"template","z":"87b488d6.5b73f8","name":"elecMeter_0000000000000008_type1","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM elecMeter_0000000000000008_type1 ORDER BY id DESC LIMIT 1) t ORDER BY id;","x":690,"y":1160,"wires":[["ed1c88f5.5ce4c8"]]},{"id":"3d338b2d.e60884","type":"template","z":"87b488d6.5b73f8","name":"elecMeter_0000000000000009_type1","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM elecMeter_0000000000000009_type1 ORDER BY id DESC LIMIT 1) t ORDER BY id;","x":690,"y":1220,"wires":[["c164d14d.58785"]]},{"id":"92a12d66.2616f","type":"inject","z":"87b488d6.5b73f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":100,"y":560,"wires":[["9044c963.bc9ea8"]]},{"id":"9044c963.bc9ea8","type":"template","z":"87b488d6.5b73f8","name":"id","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM elecMeter_0000000000000001_type1 WHERE id = 100 ORDER BY id LIMIT 1","x":270,"y":560,"wires":[["4e592a5.2fc77d4"]]},{"id":"b9863b3b.714fe8","type":"function","z":"87b488d6.5b73f8","name":"id","func":"msg.id = 1;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":740,"wires":[["4f21cd0b.a1a794"]]},{"id":"b3cd7f86.4a53f","type":"function","z":"87b488d6.5b73f8","name":"","func":"msg.id = 2;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":800,"wires":[["4f21cd0b.a1a794"]]},{"id":"ec0380a.083338","type":"function","z":"87b488d6.5b73f8","name":"","func":"msg.id = 3;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":860,"wires":[["4f21cd0b.a1a794"]]},{"id":"229f57f.47aeea8","type":"function","z":"87b488d6.5b73f8","name":"","func":"msg.id = 4;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":920,"wires":[["4f21cd0b.a1a794"]]},{"id":"5809e0aa.684d7","type":"function","z":"87b488d6.5b73f8","name":"","func":"msg.id = 5;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":980,"wires":[["4f21cd0b.a1a794"]]},{"id":"e432b77c.40ec98","type":"function","z":"87b488d6.5b73f8","name":"","func":"msg.id = 6;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":1040,"wires":[["4f21cd0b.a1a794"]]},{"id":"1d4d4743.cf5019","type":"function","z":"87b488d6.5b73f8","name":"","func":"msg.id = 7;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":1100,"wires":[["4f21cd0b.a1a794"]]},{"id":"ed1c88f5.5ce4c8","type":"function","z":"87b488d6.5b73f8","name":"","func":"msg.id = 8;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":1160,"wires":[["4f21cd0b.a1a794"]]},{"id":"c164d14d.58785","type":"function","z":"87b488d6.5b73f8","name":"","func":"msg.id = 9;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":1220,"wires":[["4f21cd0b.a1a794"]]},{"id":"4f21cd0b.a1a794","type":"function","z":"87b488d6.5b73f8","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":940,"wires":[["4e592a5.2fc77d4"]]},{"id":"62731a6.4c1cce4","type":"function","z":"87b488d6.5b73f8","name":"","func":"flow.set('res', msg.res);\nflow.set('req', msg.req);\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":960,"wires":[["d94f9e5.b4e786","937183d8.c348c","477a65bb.761afc","9067ae0b.0a15e","b69e51ac.56fc6","47843d01.37adc4","439f3c8.1d422c4","db09b522.580a98","3d338b2d.e60884"]]},{"id":"b6cdfe71.2099b","type":"inject","z":"87b488d6.5b73f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":960,"wires":[["62731a6.4c1cce4"]]},{"id":"290b708d.b68b9","type":"function","z":"87b488d6.5b73f8","name":"","func":"let id = msg.id;\n\n\nif(id == 1)flow.set(\"eM_1\", msg.payload);\nif(id == 2)flow.set(\"eM_2\", msg.payload);\nif(id == 3)flow.set(\"eM_3\", msg.payload);\nif(id == 4)flow.set(\"eM_4\", msg.payload);\nif(id == 5)flow.set(\"eM_5\", msg.payload);\nif(id == 6)flow.set(\"eM_6\", msg.payload);\nif(id == 7)flow.set(\"eM_7\", msg.payload);\nif(id == 8)flow.set(\"eM_8\", msg.payload);\nif(id == 9)flow.set(\"eM_9\", msg.payload);\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":600,"wires":[["554802f9.52562c"]]},{"id":"720da75b.3dddc8","type":"delay","z":"87b488d6.5b73f8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":930,"y":600,"wires":[["886b64b7.b8b1c8"]]},{"id":"554802f9.52562c","type":"delay","z":"87b488d6.5b73f8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":760,"y":600,"wires":[["720da75b.3dddc8"]]},{"id":"886b64b7.b8b1c8","type":"function","z":"87b488d6.5b73f8","name":"","func":"let id = msg.id;\n\nconst dataEm = {\n    eM_1: flow.get(\"eM_1\"),\n    eM_2: flow.get(\"eM_2\"),\n    eM_3: flow.get(\"eM_3\"),\n    eM_4: flow.get(\"eM_4\"),\n    eM_5: flow.get(\"eM_5\"),\n    eM_6: flow.get(\"eM_6\"),\n    eM_7: flow.get(\"eM_7\"),\n    eM_8: flow.get(\"eM_8\"),\n    eM_9: flow.get(\"eM_9\")\n};\n\ndataEm.eM_1[0].device_id = 1;\ndataEm.eM_2[0].device_id = 2;\ndataEm.eM_3[0].device_id = 3;\ndataEm.eM_4[0].device_id = 4;\ndataEm.eM_5[0].device_id = 5;\ndataEm.eM_6[0].device_id = 6;\ndataEm.eM_7[0].device_id = 7;\ndataEm.eM_8[0].device_id = 8;\ndataEm.eM_9[0].device_id = 9;\n\n\nmsg.payload = {\n    data:[dataEm.eM_1[0], dataEm.eM_2[0], dataEm.eM_3[0], dataEm.eM_4[0], dataEm.eM_5[0], dataEm.eM_6[0], dataEm.eM_7[0], dataEm.eM_8[0], dataEm.eM_9[0]]\n};\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":600,"wires":[["ef5902d7.d8dc3","b62671ad.94bfc"]]},{"id":"ef5902d7.d8dc3","type":"debug","z":"87b488d6.5b73f8","name":"","active":false,"console":"false","complete":"true","x":1230,"y":560,"wires":[]},{"id":"68e860ad.41456","type":"http in","z":"87b488d6.5b73f8","name":"","url":"/getAllElecMeter","method":"get","swaggerDoc":"","x":170,"y":900,"wires":[["62731a6.4c1cce4"]]},{"id":"b62671ad.94bfc","type":"http response","z":"87b488d6.5b73f8","name":"","x":1230,"y":600,"wires":[]},{"id":"9c6e6818.d6e528","type":"mysql","z":"87b488d6.5b73f8","mydb":"e03e62d3.458ec","name":"","x":1010,"y":1520,"wires":[["e748ebf7.401128","b47b729b.019d1"]]},{"id":"e748ebf7.401128","type":"debug","z":"87b488d6.5b73f8","name":"","active":true,"console":"false","complete":"false","x":1170,"y":1520,"wires":[]},{"id":"25ecf464.09407c","type":"comment","z":"87b488d6.5b73f8","name":"Газові лічильники","info":"Tables_in_astue: \"p22lr_70B3D53990003588_cfg\"\n29: object\nTables_in_astue: \"p22lr_70B3D53990003588_pulseV2\" -\n[30 … 37]\n30: object\nTables_in_astue: \"p22lr_70B3D53990003589_cfg\"\n31: object\nTables_in_astue: \"p22lr_70B3D53990003589_pulseV2\" -\n32: object\nTables_in_astue: \"p22lr_events\" -\n33: object\nTables_in_astue: \"p22lr_meter_0000000000000001\"\n34: object\nTables_in_astue: \"p22lr_meter_0000000000000002\"\n35: object\nTables_in_astue: \"p22lr_meter_0000000000072833\"\n36: object\nTables_in_astue: \"p22lr_meter_0000000000072835\"\n37: object\nTables_in_astue: \"rs485_events\"","x":130,"y":1480,"wires":[]},{"id":"d4517de0.38e1d","type":"template","z":"87b488d6.5b73f8","name":"p22lr_meter_0000000000072833","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM p22lr_meter_0000000000072833 ORDER BY id DESC LIMIT 1) t ORDER BY id;","x":640,"y":1520,"wires":[["b40dadb8.88981"]]},{"id":"62b719a9.832df8","type":"template","z":"87b488d6.5b73f8","name":"p22lr_meter_0000000000072835","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM p22lr_meter_0000000000072835 ORDER BY id DESC LIMIT 1) t ORDER BY id;","x":640,"y":1560,"wires":[["8ea31e15.2dbc7"]]},{"id":"4c6bb9a9.044c78","type":"http in","z":"87b488d6.5b73f8","name":"","url":"/getAllGasMeter","method":"get","swaggerDoc":"","x":170,"y":1520,"wires":[["9d466260.b471b"]]},{"id":"9d466260.b471b","type":"function","z":"87b488d6.5b73f8","name":"","func":"flow.set('res_g', msg.res);\nflow.set('req_g', msg.req);\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":1520,"wires":[["d4517de0.38e1d","62b719a9.832df8"]]},{"id":"b40dadb8.88981","type":"function","z":"87b488d6.5b73f8","name":"","func":"msg.id = 12;\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":1520,"wires":[["9c6e6818.d6e528"]]},{"id":"8ea31e15.2dbc7","type":"function","z":"87b488d6.5b73f8","name":"","func":"msg.id = 13;\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":1560,"wires":[["9c6e6818.d6e528"]]},{"id":"b47b729b.019d1","type":"function","z":"87b488d6.5b73f8","name":"","func":"let id = msg.id;\n\n//if(id == 10)flow.set(\"p22_1\", msg.payload);\n//if(id == 11)flow.set(\"p22_2\", msg.payload);\nif(id == 12)flow.set(\"p22_72833\", msg.payload);\nif(id == 13)flow.set(\"p22_72835\", msg.payload);\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":1600,"wires":[["acd07fcc.46969"]]},{"id":"fd529a75.1ca868","type":"delay","z":"87b488d6.5b73f8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1410,"y":1600,"wires":[["9702998d.69a718"]]},{"id":"acd07fcc.46969","type":"delay","z":"87b488d6.5b73f8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1240,"y":1600,"wires":[["fd529a75.1ca868"]]},{"id":"9702998d.69a718","type":"function","z":"87b488d6.5b73f8","name":"","func":"let id = msg.id;\n\nconst dataEm = {\n   // p22_1: flow.get(\"p22_1\"),\n   // p22_2: flow.get(\"p22_2\"),\n    p22_72833: flow.get(\"p22_72833\"),\n    p22_72835: flow.get(\"p22_72835\"),\n};\n\n //dataEm.p22_1[0]device_id = 10;\n //dataEm.p22_2[0].device_id =11;\n dataEm.p22_72833[0].device_id = 12;\n dataEm.p22_72835[0].device_id = 13;\n\nmsg.payload = {\n    data:[\n        //dataEm.p22_1[0], \n        //dataEm.p22_2[0], \n        dataEm.p22_72833[0], \n        dataEm.p22_72835[0]\n        ]\n};\n\nmsg.res = flow.get('res_g');\nmsg.req = flow.get('req_g');\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":1600,"wires":[["84db6d7e.8e527","96df9d0a.75e0c"]]},{"id":"84db6d7e.8e527","type":"debug","z":"87b488d6.5b73f8","name":"","active":false,"console":"false","complete":"true","x":1690,"y":1560,"wires":[]},{"id":"96df9d0a.75e0c","type":"http response","z":"87b488d6.5b73f8","name":"","x":1690,"y":1600,"wires":[]},{"id":"efe1c6a4.136998","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"true","x":430,"y":320,"wires":[]},{"id":"5f59ac9a.1bdd84","type":"template","z":"87b488d6.5b73f8","name":"elecMeter_0000000000000003_type1","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM elecMeter_0000000000000003_type1 ORDER BY id DESC LIMIT 5) t ORDER BY id;","x":970,"y":280,"wires":[["4e592a5.2fc77d4"]]},{"id":"a0656dfb.ec7a1","type":"template","z":"87b488d6.5b73f8","name":"elecMeter_0000000000000004_type1","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM elecMeter_0000000000000004_type1 ORDER BY id DESC LIMIT 5) t ORDER BY id;","x":970,"y":320,"wires":[["4e592a5.2fc77d4"]]},{"id":"99a278e9.a575d8","type":"template","z":"87b488d6.5b73f8","name":"elecMeter_0000000000000007_type1","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM elecMeter_0000000000000007_type1 ORDER BY id DESC LIMIT 5) t ORDER BY id;","x":970,"y":360,"wires":[["4e592a5.2fc77d4"]]},{"id":"6f3e6efd.c5dd9","type":"template","z":"87b488d6.5b73f8","name":"p22lr_meter_0000000000000001","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM p22lr_meter_0000000000072833 ORDER BY id DESC LIMIT 5) t ORDER BY id;","x":960,"y":140,"wires":[["4e592a5.2fc77d4"]]},{"id":"4967a732.eb7758","type":"template","z":"87b488d6.5b73f8","name":"p22lr_meter_0000000000000002","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM (SELECT * FROM p22lr_meter_0000000000000002 ORDER BY id DESC LIMIT 5) t ORDER BY id;","x":960,"y":180,"wires":[["4e592a5.2fc77d4"]]},{"id":"b644904b.f0566","type":"inject","z":"87b488d6.5b73f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":740,"y":140,"wires":[["6f3e6efd.c5dd9"]]},{"id":"15f292f3.761bcd","type":"inject","z":"87b488d6.5b73f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":740,"y":180,"wires":[["4967a732.eb7758"]]},{"id":"f5c9d2ad.0939c","type":"inject","z":"87b488d6.5b73f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":740,"y":280,"wires":[["5f59ac9a.1bdd84"]]},{"id":"58819372.1cc47c","type":"inject","z":"87b488d6.5b73f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":740,"y":320,"wires":[["a0656dfb.ec7a1"]]},{"id":"bb8b1c2d.ca8b6","type":"inject","z":"87b488d6.5b73f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":740,"y":360,"wires":[["99a278e9.a575d8"]]},{"id":"f80bbe2d.6ceb8","type":"file","z":"962df517.4837f8","name":"","filename":" info.txt","appendNewline":true,"createDir":true,"overwriteFile":"true","x":490,"y":300,"wires":[]},{"id":"f7b1e5a4.a42548","type":"http in","z":"962df517.4837f8","name":"","url":"/getChannel","method":"get","swaggerDoc":"","x":160,"y":120,"wires":[["756e5a64.d33c54"]]},{"id":"767eb8b9.e67188","type":"http response","z":"962df517.4837f8","name":"","x":1530,"y":120,"wires":[]},{"id":"5d7590cb.6411c","type":"json","z":"962df517.4837f8","name":"","x":1170,"y":120,"wires":[["767eb8b9.e67188","30b0c211.8cb41e","a9bab078.fe8ea","a89a97ac.36c1f8"]]},{"id":"c3d262f6.b58e4","type":"function","z":"962df517.4837f8","name":"sid","func":"let sid = flow.get('sid');\nmsg.sid = sid;\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":260,"wires":[["59615c81.8e94e4"]]},{"id":"59615c81.8e94e4","type":"function","z":"962df517.4837f8","name":"screenshot","func":"//let guidChannel = \"G52s7jnk\";  ezoJU3It\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\n//let guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\n//let guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n//let guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\n//let guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?timestamp=0&sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":260,"wires":[["19145c03.fb44d4"]]},{"id":"19145c03.fb44d4","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"txt","url":"","tls":"d049c21b.cdc58","x":830,"y":260,"wires":[["d2506887.fe3558"]]},{"id":"87915da.d0bb2a","type":"comment","z":"962df517.4837f8","name":"Запрос скриншота","info":"\n\n\nhttps://10.107.9.100:8080/screenshot/B7KQRyWz?timestamp=0&sid=YSC15Slf","x":150,"y":380,"wires":[]},{"id":"383a9a98.f2ce96","type":"comment","z":"962df517.4837f8","name":"Запрос списка каналов","info":"https://10.107.9.100:8080/channels?sid=asblE5uL\n","x":170,"y":80,"wires":[]},{"id":"49efe627.e2c268","type":"http in","z":"962df517.4837f8","name":"","url":"/getScreenshot","method":"get","swaggerDoc":"","x":170,"y":600,"wires":[["214a8f5a.f9fb9","25f84909.a4d8e6"]]},{"id":"db94136a.30444","type":"function","z":"962df517.4837f8","name":"sid","func":"// let sid = msg.payload.sid;\n// msg.sid = sid;\n\n\nmsg.sid =  flow.get('sid');\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":600,"wires":[["b50dd451.148818","6e90b4a7.3c343c"]]},{"id":"b50dd451.148818","type":"function","z":"962df517.4837f8","name":"screenshot","func":"let guidChannel = flow.get(\"idChannel\");\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":600,"wires":[["27afada.c39a052","bb878efb.9e68"]]},{"id":"27afada.c39a052","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":930,"y":600,"wires":[["ac7d9b0.726c368","ba5ee7ca.b22468"]]},{"id":"ac7d9b0.726c368","type":"http response","z":"962df517.4837f8","name":"","x":1170,"y":600,"wires":[]},{"id":"446296a8.ab0c78","type":"comment","z":"48413719.e10dd8","name":"Конвертація в кодування 1251","info":"","x":1210,"y":2060,"wires":[]},{"id":"97461724.51a2f8","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_1.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":3890,"y":1260,"wires":[["bf8465c7.e26798"]]},{"id":"26b87589.e8de6a","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_1.txt -o /distr/iconv_t/outfile_1.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":4060,"y":1360,"wires":[["ac3cce72.b12a3"],[],[]]},{"id":"ac3cce72.b12a3","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_1.txt","format":"","x":4270,"y":1360,"wires":[["95df5d3d.0974","856318b7.2e19f8"]]},{"id":"95df5d3d.0974","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":4490,"y":1360,"wires":[["eaae9e3b.613a2"]]},{"id":"eaae9e3b.613a2","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":4680,"y":1360,"wires":[["63c773f9.6f7a3c","5fe76055.ea5d1"]]},{"id":"214a8f5a.f9fb9","type":"function","z":"962df517.4837f8","name":"","func":"flow.set('idChannel', msg.payload.idChannel);\n\nflow.set('res', msg.res);\nflow.set('req', msg.req);\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":600,"wires":[["db94136a.30444"]]},{"id":"63c773f9.6f7a3c","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"true","x":4930,"y":1320,"wires":[]},{"id":"39dfe714.955648","type":"comment","z":"d7f6f063.4555c","name":"info","info":"Avto 2 10.107.5.101 1884 Moxa\n\n\n80 kg\n\n0: 240\n1: 13\n2: 80\n3: 0\n4: 0\n5: 0\n6: 1\n7: 0\n8: 0\n9: 240\n\n\n0 kg\n//\n0: 240\n1: 13\n2: 0\n3: 0\n4: 0\n5: 0\n6: 1\n7: 0\n8: 0\n9: 240\n\n\n8660 kg\n0: 240\n1: 13\n2: 212\n3: 33\n4: 0\n5: 0\n6: 1\n7: 0\n8: 0\n9: 240","x":70,"y":220,"wires":[]},{"id":"637d5c2b.d821c4","type":"function","z":"962df517.4837f8","name":"","func":"//'Синий кит'.indexOf('кит', 0);\nlet findComment = msg.payload.indexOf('/*',0);\nlet subString =  msg.payload.substring(\"0\", findComment);\nmsg.payload = subString;\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":120,"wires":[["d52eb8d7.ca0318","ee48b9df.02ff88","fc78c600.94ced8","5d7590cb.6411c"]]},{"id":"718b8e5f.aa0e7","type":"comment","z":"962df517.4837f8","name":"Отримання фото","info":"","x":130,"y":560,"wires":[]},{"id":"deae5a0f.76b048","type":"tcp in","z":"6754df2.8b2bd2","name":"","server":"server","host":"","port":"4003","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":100,"y":80,"wires":[["dfeb2bf6.7c4268","bc1fa565.efbd78","8e2616c6.2be0c8","ffb4774e.d3bf38"]]},{"id":"dfeb2bf6.7c4268","type":"function","z":"6754df2.8b2bd2","name":"set last Analys","func":"flow.set('lastAnalys',msg.payload);\nflow.set('barcode',\"\");\nglobal.set('device_id_infratec_2',\"2286efc3-5417-f735-7050-384c1f019000\");\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":80,"wires":[["96ebdc5a.a9085"]]},{"id":"4e8c36a0.4403a8","type":"http in","z":"6754df2.8b2bd2","name":"","url":"/getQuality","method":"get","swaggerDoc":"","x":140,"y":380,"wires":[["3afcbeb.ecbcf42"]]},{"id":"b85bb052.c16f8","type":"http response","z":"6754df2.8b2bd2","name":"","x":610,"y":380,"wires":[]},{"id":"3afcbeb.ecbcf42","type":"function","z":"6754df2.8b2bd2","name":"create response","func":"var load = flow.get('load');\nif (load){\n    msg.payload = flow.get('parseQA');    \n    msg.load = true;\n}else{\n    msg.payload = {};\n    msg.load = false;\n}\nmsg.payload.barcode = flow.get('barcode');\nflow.set(\"load\",false);\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":380,"wires":[["b85bb052.c16f8","9d37e774.6be218","ee492291.2df8"]]},{"id":"96ebdc5a.a9085","type":"function","z":"6754df2.8b2bd2","name":"parse quality","func":"var result = {\n    localdate:new Date()\n};\n\nvar sdata = msg.payload;\nvar arr_sdata = sdata.split('\\n');\n\nresult.length = arr_sdata.length;\n\n//Ambient Temperature\nvar ambietTemperature = arr_sdata[7];\nvar arr_ambietTemperature = ambietTemperature.split(\":\");\nresult.ambietTemperature = arr_ambietTemperature[1];\n\n//Analysis Counter\nvar analysisCounter = arr_sdata[8];\nvar arr_analysisCounter = analysisCounter.split(\":\");\nresult.analysisCounter = arr_analysisCounter[1];\n\n//Sub sample\nvar subSample = arr_sdata[11];\nvar arr_subSample = subSample.split(\":\");\nvar arr_subSample_1 = arr_subSample[0].split(\"     \");\n\nresult.subsample = {\n   id : arr_subSample[0].replace(\"NrOFSubSamples\",\"\"),\n   NrOFSubSamples : arr_subSample[1]\n}\n\n//Sample hash\nvar sampleHash = arr_sdata[13];\nresult.sampleHash = sampleHash;\n\n//read quailities \nvar startQ  = 14;\nvar qLength = 7;\nvar endStr  = \"#\";\n\nvar qualities = [];\n\nfor( var i = startQ; i <= arr_sdata.length-qLength; ){\n    \n    var q = {\n        id:arr_sdata[i],\n        value:arr_sdata[i+1].split(String.fromCharCode(20)),\n        minmax:arr_sdata[i+4].split(String.fromCharCode(20))\n    }\n    qualities.push(q);   \n    i = i+qLength;\n    \n}\n\nresult.qualities = qualities;\nresult.datahash  = JSON.stringify(result);\n// msg.payload = arr_sdata;\nmsg.payload = result;\nflow.set('parseQA',result);\n\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":80,"wires":[["65d4b2fd.2b336c","575ef478.89a1dc","ec2a4e39.82309"]]},{"id":"1d6a2711.3f8a19","type":"inject","z":"6754df2.8b2bd2","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":90,"y":540,"wires":[["1f0a1929.f84527"]]},{"id":"1f0a1929.f84527","type":"function","z":"6754df2.8b2bd2","name":"init config","func":"flow.set('load',false);\nreturn msg;","outputs":1,"noerr":0,"x":220,"y":540,"wires":[[]]},{"id":"496220e.e7a3de","type":"function","z":"6754df2.8b2bd2","name":"read barcode","func":"flow.set(\"barcode\",msg.payload.replace(\"\\r\",\"\"));\nflow.set('load',true);\nmsg.payload = {\n    \"barcode\":msg.payload.replace(\"\\r\",\"\")\n}\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":640,"wires":[["ec048485.e33448","8e9a8899.772418"]]},{"id":"65d4b2fd.2b336c","type":"link out","z":"6754df2.8b2bd2","name":"get quality throw tcp Lab inside","links":["b62567f3.246808"],"x":735,"y":80,"wires":[]},{"id":"cb37fd55.1f823","type":"link out","z":"6754df2.8b2bd2","name":"1c request Lab inside","links":["50621407.1ba6ac"],"x":715,"y":420,"wires":[]},{"id":"ec048485.e33448","type":"link out","z":"6754df2.8b2bd2","name":"read barcode Lab inside","links":["36eb63cd.84468c"],"x":475,"y":600,"wires":[]},{"id":"9d37e774.6be218","type":"switch","z":"6754df2.8b2bd2","name":"","property":"load","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":610,"y":420,"wires":[["cb37fd55.1f823"]]},{"id":"f199a501.6462e8","type":"debug","z":"6754df2.8b2bd2","name":"Analysis","active":false,"console":"true","complete":"payload","x":810,"y":40,"wires":[]},{"id":"575ef478.89a1dc","type":"json","z":"6754df2.8b2bd2","name":"","x":590,"y":80,"wires":[["f199a501.6462e8"]]},{"id":"ee492291.2df8","type":"json","z":"6754df2.8b2bd2","name":"","x":610,"y":460,"wires":[["1218db57.0c8925"]]},{"id":"1218db57.0c8925","type":"debug","z":"6754df2.8b2bd2","name":"getQuality","active":false,"console":"true","complete":"payload","x":750,"y":460,"wires":[]},{"id":"1cd297c1.e94db8","type":"debug","z":"6754df2.8b2bd2","name":"Analysis wihout parse","active":false,"console":"true","complete":"payload","x":550,"y":120,"wires":[]},{"id":"bc1fa565.efbd78","type":"function","z":"6754df2.8b2bd2","name":"","func":"msg.payload = {\n    msg:\"\" + msg.payload\n};\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":120,"wires":[["7e0793be.17db0c"]]},{"id":"7e0793be.17db0c","type":"json","z":"6754df2.8b2bd2","name":"","x":370,"y":120,"wires":[["1cd297c1.e94db8"]]},{"id":"8e9a8899.772418","type":"debug","z":"6754df2.8b2bd2","name":"","active":true,"console":"false","complete":"false","x":530,"y":640,"wires":[]},{"id":"ec2a4e39.82309","type":"debug","z":"6754df2.8b2bd2","name":"","active":false,"console":"false","complete":"false","x":610,"y":40,"wires":[]},{"id":"12c5fce1.d75043","type":"inject","z":"6754df2.8b2bd2","name":"","topic":"","payload":"parseQA","payloadType":"flow","repeat":"","crontab":"","once":false,"x":150,"y":680,"wires":[["9678bed1.986e3","3b9b3d7f.10df22"]]},{"id":"9678bed1.986e3","type":"debug","z":"6754df2.8b2bd2","name":"","active":true,"console":"false","complete":"false","x":530,"y":680,"wires":[]},{"id":"3b9b3d7f.10df22","type":"json","z":"6754df2.8b2bd2","name":"","x":330,"y":720,"wires":[["9678bed1.986e3"]]},{"id":"f85ae8ab.7a2108","type":"http in","z":"6754df2.8b2bd2","name":"","url":"/gettest","method":"get","swaggerDoc":"","x":170,"y":780,"wires":[["e1c61e99.21513"]]},{"id":"551d2b2e.642114","type":"http response","z":"6754df2.8b2bd2","name":"","x":570,"y":780,"wires":[]},{"id":"e1c61e99.21513","type":"function","z":"6754df2.8b2bd2","name":"create response","func":"msg.payload = flow.get('parseQA');    \n  \nreturn msg;","outputs":1,"noerr":0,"x":400,"y":780,"wires":[["551d2b2e.642114"]]},{"id":"9253fe7f.17ea3","type":"function","z":"90f9c352.b35d1","name":"device config","func":"var device_config = JSON.parse(msg.payload);\n\nflow.set('event_make_quality_id',device_config.event_make_quality_id);\nflow.set('event_read_barcode_id',device_config.event_read_barcode_id);\nflow.set('event_send_to_accsystem_id',device_config.event_send_to_accsystem_id);\nflow.set('event_no_conditional',device_config.event_no_conditional);\nflow.set('main_host',device_config.main_host);\nflow.set('event_url',device_config.event_url);\nflow.set('state_url',device_config.state_url);\nflow.set('snapshot_url',device_config.snapshot_url);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":750,"y":140,"wires":[["d4c7efd.a3c131"]]},{"id":"b62567f3.246808","type":"link in","z":"90f9c352.b35d1","name":"quality Lab inside","links":["65d4b2fd.2b336c"],"x":55,"y":280,"wires":[["91c94c04.d1eaf"]]},{"id":"13aed870.9cf908","type":"http request","z":"90f9c352.b35d1","name":"EVENTS","method":"POST","ret":"txt","url":"","tls":"80207470.ec8f48","x":962,"y":279,"wires":[["58deffdc.93f63"]]},{"id":"a6b7b406.d1faf8","type":"function","z":"90f9c352.b35d1","name":"events payload","func":"var event_id = msg.event_id;\nvar device_id = global.get('device_id_infratec_2');\n\n\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'devices':[{'id':device_id}],\n    'data':msg.metadata,\n    'description':msg.description\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('event_url');\nmsg.main_host = flow.get('main_host');\nmsg.event_url = flow.get('event_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":280,"wires":[["13aed870.9cf908","ff6a258d.443da8"]]},{"id":"5b53b9dd.39ca68","type":"inject","z":"90f9c352.b35d1","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":480,"wires":[["1a04ddd0.a75902"]]},{"id":"1a04ddd0.a75902","type":"function","z":"90f9c352.b35d1","name":"check scale health","func":"var lastcheckHealth = flow.get('checkHealth');\nvar checkHealth = null;\nvar lasttimedata = flow.get('lasttimedata');\n\nvar currenttimedata = new Date();\n\nif ((currenttimedata - lasttimedata) > 3000){\n    checkHealth = false;\n} else {\n    checkHealth = true;\n}\n\nflow.set(\"checkHealth\",checkHealth);\n\nif (lastcheckHealth != checkHealth){\n    msg.checkHealth = checkHealth;\n}else{\n    msg.checkHealth = null;\n}\nmsg.payload = checkHealth;\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":480,"wires":[["768dfe49.e6df7"]]},{"id":"fca0917b.f30af","type":"function","z":"90f9c352.b35d1","name":"main config","func":"flow.set('checkHealth',null);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":750,"y":180,"wires":[[]]},{"id":"a49d2084.cda19","type":"inject","z":"90f9c352.b35d1","name":"","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":110,"y":140,"wires":[["d3756f83.ff712","982c376e.7a01b8"]]},{"id":"f6be415d.10fae","type":"http request","z":"90f9c352.b35d1","name":"STATE","method":"POST","ret":"txt","url":"","tls":"79a8e2bb.a2ee4c","x":610,"y":480,"wires":[["ddfaed98.02bf5"]]},{"id":"768dfe49.e6df7","type":"function","z":"90f9c352.b35d1","name":"device state","func":"msg.payload = {\n    \"state\":msg.payload\n}\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\nmsg.url = flow.get('main_host')+flow.get('state_url')+\"?id=\"+global.get(\"device_id_infratec_2\");\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":480,"wires":[["f6be415d.10fae"]]},{"id":"17e6cee5.a2efa1","type":"http in","z":"90f9c352.b35d1","name":"","url":"/firmware","method":"post","swaggerDoc":"","x":160,"y":100,"wires":[["6b693596.ba85ac"]]},{"id":"6b693596.ba85ac","type":"file","z":"90f9c352.b35d1","name":"deivce_config_infratec_2.json","filename":"deivce_config_infratec_2.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":510,"y":100,"wires":[]},{"id":"63607440.7c01ac","type":"file in","z":"90f9c352.b35d1","name":"deivce_config_infratec_2.json","filename":"deivce_config_infratec_2.json","format":"utf8","x":530,"y":140,"wires":[["9253fe7f.17ea3"]]},{"id":"13e3e038.c1672","type":"inject","z":"90f9c352.b35d1","name":"DEMO","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":120,"y":40,"wires":[["b8e49791.159318"]]},{"id":"b8e49791.159318","type":"function","z":"90f9c352.b35d1","name":"DEMO Data","func":"var device_config = {\n    'event_make_quality_id':'8B9482814EDB2FC9E055000000000001',\n    'event_read_barcode_id':'8B9482814EDC2FC9E055000000000001',\n    'event_send_to_accsystem_id':'8B9482814EDD2FC9E055000000000001',\n    'event_no_conditional':'8C4D78A0466C7B36E055000000000001',\n    'main_host':'https://10.107.5.200:8443/ords/ettn',\n    'event_url':'/iot_cli/events/log',\n    'state_url':'/iot_cli/device',\n    'snapshot_url':'/iot_cli/events/snapshot'\n}\nmsg.payload = device_config;\n// flow.set('scale_id','80096CB0EFD83B63E0533300000A4334');\n// flow.set('event_move_in_id','80096D9ABE7F68F3E0533300000A6C0D');\n// flow.set('event_move_out_id','80096D9ABE8068F3E0533300000A6C0D');\n// flow.set('event_max_weight_id','85A255F950F9BEF4E0533300000AC45D');\n// flow.set('event_off_id','85A2CC4570292DD1E0533300000A0C94');\n// flow.set('event_on_id', '85A2CC45702A2DD1E0533300000A0C94');\n// flow.set('event_max_duration','8642EE858DE89BAAE0533300000AFCC7');\n// flow.set('main_host','http://prod.apex.rest/ords/ettn');\n// flow.set('event_url','/iot_cli/events/log');\n// flow.set('state_url','/v1/device');\n// flow.set('maxWeight',40000);\n// flow.set('maxDuration',20000);\n// flow.set('checkHealthTimeout',3000);\nreturn msg;\n//http://156.67.53.93:8888/ords/ettn\n//http://skelya.prncp.org/ords/ettn","outputs":1,"noerr":0,"x":290,"y":40,"wires":[["6b693596.ba85ac"]]},{"id":"aeee2c0c.232dd","type":"function","z":"90f9c352.b35d1","name":"send quality","func":"msg.event_id = flow.get('event_make_quality_id');\nmsg.description = 'Отримали якість із аналізатору. Номер аналізу: ' + msg.payload.analysisCounter+\". Калібровка \"+msg.payload.subsample_id;\nmsg.metadata = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":280,"wires":[["a6b7b406.d1faf8"]]},{"id":"ddfaed98.02bf5","type":"debug","z":"90f9c352.b35d1","name":"","active":true,"console":"false","complete":"false","x":750,"y":480,"wires":[]},{"id":"d4c7efd.a3c131","type":"debug","z":"90f9c352.b35d1","name":"","active":true,"console":"false","complete":"payload","x":910,"y":140,"wires":[]},{"id":"36eb63cd.84468c","type":"link in","z":"90f9c352.b35d1","name":"barcode Lab inside","links":["ec048485.e33448"],"x":55,"y":320,"wires":[["a744093a.1ecf98"]]},{"id":"a744093a.1ecf98","type":"function","z":"90f9c352.b35d1","name":"read barcode","func":"msg.event_id = flow.get('event_read_barcode_id');\nmsg.description = 'Зчитування штрих-коду: ' + msg.payload.barcode;\nmsg.metadata = msg.payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":320,"wires":[["a6b7b406.d1faf8"]]},{"id":"f41030cb.8a155","type":"function","z":"90f9c352.b35d1","name":"send to 1c","func":"msg.event_id = flow.get('event_send_to_accsystem_id');\nmsg.description = 'Отримання аналізу в 1С: ' + msg.payload.barcode;\nmsg.metadata = {\n    'barcode':msg.payload.barcode\n}\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":360,"wires":[["a6b7b406.d1faf8"]]},{"id":"50621407.1ba6ac","type":"link in","z":"90f9c352.b35d1","name":"1c Lab inside","links":["cb37fd55.1f823"],"x":55,"y":360,"wires":[["f41030cb.8a155"]]},{"id":"c3fadacf.4d5d78","type":"switch","z":"90f9c352.b35d1","name":"","property":"isNotConditional","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":430,"y":380,"wires":[["3bfa7951.8a0246"]]},{"id":"3bfa7951.8a0246","type":"function","z":"90f9c352.b35d1","name":"send quality","func":"msg.event_id = flow.get('event_no_conditional');\nmsg.description = 'Некодинційня якість. Номер аналізу ' + msg.payload.analysisCounter;\n\nvar payload = {};\nfor (var i = 0; i < msg.notcondition.length; i++){\n    payload = msg.notcondition[i];  \n}\nmsg.metadata = payload;\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":380,"wires":[["a6b7b406.d1faf8","a802a6a0.5cefb8"]]},{"id":"a802a6a0.5cefb8","type":"debug","z":"90f9c352.b35d1","name":"","active":false,"console":"false","complete":"true","x":750,"y":383,"wires":[]},{"id":"91c94c04.d1eaf","type":"function","z":"90f9c352.b35d1","name":"parse result","func":"var p = msg.payload;\n\nvar result = {\n    \"ambietTemperature\":p.ambietTemperature,\n    \"analysisCounter\":p.analysisCounter,\n    \"subsample_id\":p.subsample.id,\n    \"subsample_NrOFSubSamples\":p.subsample.NrOFSubSamples,\n    \"sampleHash\":p.sampleHash\n};\nvar notcondition = [];\nvar isNotConditional = false;\n\nfor (var i = 0; i < p.qualities.length; i++){\n    \n    var valueid = p.qualities[i].id.replace(\" \",\"\"); \n    var temp_value_name = p.qualities[i].value[0].match(/[a-zA-Z]+/g)[0];\n    var temp_value = parseFloat(p.qualities[i].value[0].match(/\\d+.\\d+/g));\n    result[temp_value_name] = temp_value;\n    \n    var temp_value_min_name = p.qualities[i].minmax[0].match(/[a-zA-Z]+/g)[0];\n    var temp_value_min = parseFloat(p.qualities[i].minmax[0].match(/\\d+.\\d+/g)[0]);\n    // result[temp_value_name+\"_\"+temp_value_min_name] = temp_value_min;\n    \n    var temp_value_max_name = p.qualities[i].minmax[0].match(/[a-zA-Z]+/g)[1];\n    var temp_value_max = parseFloat(p.qualities[i].minmax[0].match(/\\d+.\\d+/g)[1]);\n    // result[temp_value_name+\"_\"+temp_value_max_name] = temp_value_max;\n    \n    if ((temp_value>temp_value_max) || (temp_value<temp_value_min)){\n        notcondition.push({\n            [temp_value_name]:temp_value,\n            [temp_value_min_name]:temp_value_min,\n            [temp_value_max_name]:temp_value_max\n        });\n        isNotConditional = true;\n    }\n}\nmsg.payload = result;\nmsg.notcondition = notcondition;\nmsg.isNotConditional = isNotConditional;\n\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":280,"wires":[["aeee2c0c.232dd","c3fadacf.4d5d78"]]},{"id":"ff6a258d.443da8","type":"json","z":"90f9c352.b35d1","name":"","x":950,"y":240,"wires":[["4a42ea4a.792664"]]},{"id":"4a42ea4a.792664","type":"debug","z":"90f9c352.b35d1","name":"event","active":true,"console":"true","complete":"payload","x":1080,"y":240,"wires":[]},{"id":"58deffdc.93f63","type":"debug","z":"90f9c352.b35d1","name":"event","active":true,"console":"true","complete":"payload","x":1111,"y":281,"wires":[]},{"id":"d3756f83.ff712","type":"trigger","z":"90f9c352.b35d1","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","name":"","x":480,"y":180,"wires":[["fca0917b.f30af"]]},{"id":"d3cf3ab7.44bff8","type":"function","z":"d7f6f063.4555c","name":"GET WEIGHT","func":"var payload = msg.payload;\nvar parser = flow.get('parser');\nvar currentWeight = parser(payload);\nif(currentWeight > -80){\n    flow.set('currentWeight',currentWeight);\n    msg.connect = \"yes\";\n    msg.payload = currentWeight;\n    global.set('weight_2', currentWeight);\n    return msg;\n}\n","outputs":1,"noerr":0,"x":740,"y":280,"wires":[["5129e493.e2032c","9a16aa02.d5fb88"]]},{"id":"8899a647.fe8408","type":"inject","z":"d7f6f063.4555c","name":"init","topic":"","payload":"init","payloadType":"str","repeat":"","crontab":"","once":true,"x":90,"y":80,"wires":[["86c57c27.e73f2"]]},{"id":"1deb928e.5c5c4d","type":"comment","z":"d7f6f063.4555c","name":"INITIALIZING БРУТТО","info":"","x":140,"y":40,"wires":[]},{"id":"86c57c27.e73f2","type":"function","z":"d7f6f063.4555c","name":"Модель весов","func":"flow.set('inputString',\"G01W\"  + String.fromCharCode(0x0d)  + String.fromCharCode(0x0a));\nflow.set('parser',function(v){\n        var minus = v.indexOf('N');\n        var index_minus = 1;\n        //перевірка на мінус\n        if(minus > -1){\n            index_minus = -1;\n        }\n        v = v.substring(4,11);\n        //Math.round(20.49)\n\n        var weight = Math.round(Number(v) * 1000 * index_minus); \n        return weight;\n        } \n        );\nglobal.set('scale_id_in_2','f74f723a-8dd9-4e24-b200-be101fcd4875');\nglobal.set('ip','10.107.5.200');\nglobal.set('video_camera_url_1','');\n   \nreturn msg;\n/*\n\"G02W\"  + String.fromCharCode(0x0d)  + String.fromCharCode(0x0a)\nv = v.substring(3,11);\n\nflow.set('inputString', Buffer.from(\"0B0F010100000000\", \"hex\"));\nflow.set('inputString',\"G02W\"  + String.fromCharCode(0x0d)  + String.fromCharCode(0x0a));\n*/","outputs":1,"noerr":0,"x":300.00000381469727,"y":79.42856788635254,"wires":[[]]},{"id":"9a16aa02.d5fb88","type":"link out","z":"d7f6f063.4555c","name":"s3 Авто 2 ","links":["46d8b468.e68cac"],"x":1015,"y":240,"wires":[]},{"id":"c592f4cb.531d68","type":"comment","z":"f93250c7.39091","name":"Сокет","info":"","x":100,"y":1220,"wires":[]},{"id":"3bbf521b.a4f61e","type":"file","z":"1124af78.b62db1","name":"deivce_config_2.json","filename":"deivce_config_2.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":500,"y":180,"wires":[]},{"id":"1d463a70.9e5e46","type":"exec","z":"1124af78.b62db1","command":"cat /proc/cpuinfo","addpay":true,"append":"| grep Serial","useSpawn":"","timer":"5","name":"","x":360,"y":60,"wires":[["879d473.f0988b8","1d446e5.65d4592"],[],[]]},{"id":"adbc3716.dcdbf8","type":"function","z":"1124af78.b62db1","name":"main config","func":"flow.set('prevWeight',null);\nflow.set('transaction',null);\nflow.set('transactionData',[]);\nflow.set('transactionMaxWeight',null);\nflow.set('transactionHasMinWeight',null);\nflow.set('transactionHasMaxWeight',null);\nflow.set('transactionHasMaxDuration',null);\nflow.set('lasttimedata', new Date());\nflow.set('checkHealth',null);\nflow.set('transactionWaybill',null);\nflow.set('transactionAccWeight', null);\nflow.set('transactionHasOverLoad', null);\nflow.set('transactionOperationName', null);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":430,"y":280,"wires":[[]]},{"id":"94614649.a1c578","type":"inject","z":"1124af78.b62db1","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":90,"y":240,"wires":[["d19fbca4.6f28d","38fe892.7f7fc76"]]},{"id":"aa3c3f28.18692","type":"http in","z":"1124af78.b62db1","name":"","url":"/firmware","method":"post","swaggerDoc":"","x":160,"y":180,"wires":[["3bbf521b.a4f61e"]]},{"id":"4a9b3aea.421dc4","type":"file in","z":"1124af78.b62db1","name":"deivce_config_2.json","filename":"deivce_config_2.json","format":"utf8","x":460,"y":240,"wires":[["77c8e30.f15671c"]]},{"id":"7b9e7f36.f676f","type":"http in","z":"1124af78.b62db1","name":"","url":"/serial","method":"get","swaggerDoc":"","x":140,"y":60,"wires":[["1d463a70.9e5e46"]]},{"id":"879d473.f0988b8","type":"http response","z":"1124af78.b62db1","name":"","x":590,"y":40,"wires":[]},{"id":"1d446e5.65d4592","type":"function","z":"1124af78.b62db1","name":"","func":"msg.payload = msg.payload.split(':')[1].replace('\\n','').replace(' ','');\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":80,"wires":[[]]},{"id":"f3d053f5.07bb1","type":"inject","z":"1124af78.b62db1","name":"DEMO","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":116,"y":132.57142639160156,"wires":[["e350bc22.c64f5"]]},{"id":"e350bc22.c64f5","type":"function","z":"1124af78.b62db1","name":"DEMO Data","func":"var device_config = {\n    'event_move_in_id':'80096D9ABE7F68F3E0533300000A6C0D',\n    'event_move_in_minus_id':'8DB9B239DF5252F0E055000000000001',\n    'event_move_out_id':'80096D9ABE8068F3E0533300000A6C0D',\n    'event_max_weight_id':'85A255F950F9BEF4E0533300000AC45D',\n    'event_on_id': '85A2CC45702A2DD1E0533300000A0C94',\n    'event_off_id':'85A2CC4570292DD1E0533300000A0C94',\n    'event_max_duration':'8642EE858DE89BAAE0533300000AFCC7',\n    'event_fake_traffic':'80096EF60C186574E0533300000ADBA5',\n    'event_get_weight_acc':'800970AC1FDC683CE0533300000AF1B0',\n    'event_min_weight':'875C3EB5C9DD092DE055000000000001',\n    'event_driver_in':'8E68D8D8B2977181E055000000000001',\n    'event_over_load':'B3EB5F800EFD2620E0530101007F8A05',\n    'snapshot_events':['80096D9ABE7F68F3E0533300000A6C0D', '85A255F950F9BEF4E0533300000AC45D','8642EE858DE89BAAE0533300000AFCC7','800970AC1FDC683CE0533300000AF1B0', \"B3EB5F800EFD2620E0530101007F8A05\"],\n    'main_host':'https://10.107.5.200:8443/ords/ettn',\n    'event_url':'/iot_cli/events/log',\n    'state_url':'/iot_cli/device',\n    'snapshot_url':'/iot_cli/events/snapshot',\n    'maxWeight':60000,\n    'maxDuration':600000,\n    'minWeight':-40,\n    'checkHealthTimeout':3000,\n    'minTriggerWeight':40,\n    'driverWeight':80,\n    'overLoadWeight': 200,\n    'stableDiff': 60\n}\nmsg.payload = device_config;\n// flow.set('scale_id','80096CB0EFD83B63E0533300000A4334');\n// flow.set('event_move_in_id','80096D9ABE7F68F3E0533300000A6C0D');\n// flow.set('event_move_out_id','80096D9ABE8068F3E0533300000A6C0D');\n// flow.set('event_max_weight_id','85A255F950F9BEF4E0533300000AC45D');\n// flow.set('event_off_id','85A2CC4570292DD1E0533300000A0C94');\n// flow.set('event_on_id', '85A2CC45702A2DD1E0533300000A0C94');\n// flow.set('event_max_duration','8642EE858DE89BAAE0533300000AFCC7');\n// flow.set('main_host','http://prod.apex.rest/ords/ettn');\n// flow.set('event_url','/iot_cli/events/log');\n// flow.set('state_url','/v1/device');\n// flow.set('maxWeight',40000);\n// flow.set('maxDuration',20000);\n// flow.set('checkHealthTimeout',3000);\nreturn msg;","outputs":1,"noerr":0,"x":295.0000228881836,"y":133.00000190734863,"wires":[["3bbf521b.a4f61e"]]},{"id":"77c8e30.f15671c","type":"function","z":"1124af78.b62db1","name":"device config","func":"var device_config = JSON.parse(msg.payload);\n\nflow.set('scale_id',device_config.scale_id);\nflow.set('event_move_in_id',device_config.event_move_in_id);\nflow.set('event_move_in_minus_id',device_config.event_move_in_minus_id);\nflow.set('event_move_out_id',device_config.event_move_out_id);\nflow.set('event_max_weight_id',device_config.event_max_weight_id);\nflow.set('event_off_id',device_config.event_off_id);\nflow.set('event_on_id', device_config.event_on_id);\nflow.set('event_max_duration',device_config.event_max_duration);\nflow.set('event_fake_traffic',device_config.event_fake_traffic);\nflow.set('event_driver_in', device_config.event_driver_in);\nflow.set('event_over_load',device_config.event_over_load);\nflow.set('main_host',device_config.main_host);\nflow.set('event_url',device_config.event_url);\nflow.set('state_url',device_config.state_url);\nflow.set('maxWeight',device_config.maxWeight);\nflow.set('minWeight',device_config.minWeight);\nflow.set('maxDuration',device_config.maxDuration);\nflow.set('checkHealthTimeout',device_config.checkHealthTimeout);\nflow.set('event_get_weight_acc',device_config.event_get_weight_acc);\nflow.set('event_min_weight',device_config.event_min_weight);\nflow.set('minTriggerWeight',device_config.minTriggerWeight);\nflow.set('snapshot_url',device_config.snapshot_url);\nflow.set('snapshot_events',device_config.snapshot_events);\nflow.set('driverWeight',device_config.driverWeight);\nflow.set('overLoadWeight', device_config.overLoadWeight);\nflow.set('stableDiff', device_config.stableDiff);\n\nmsg.payload = {\n\tscale_id: flow.get('scale_id'),\n\tevent_move_in_id: flow.get('event_move_in_id'),\n\tevent_move_in_minus_id: flow.get('event_move_in_minus_id'),\n\tevent_move_out_id: flow.get('event_move_out_id'),\n\tevent_max_weight_id: flow.get('event_max_weight_id'),\n\tevent_off_id: flow.get('event_off_id'),\n\tevent_on_id: flow.get('event_on_id'),\n\tevent_max_duration: flow.get('event_max_duration'),\n\tevent_fake_traffic: flow.get('event_fake_traffic'),\n\tevent_driver_in: flow.get('event_driver_in'),\n\tevent_over_load: flow.get('event_over_load'),\n\tmain_host: flow.get('main_host'),\n\tevent_url: flow.get('event_url'),\n\tstate_url: flow.get('state_url'),\n\tmaxWeight: flow.get('maxWeight'),\n\tminWeight: flow.get('minWeight'),\n\tmaxDuration: flow.get('maxDuration'),\n\tcheckHealthTimeout: flow.get('checkHealthTimeout'),\n\tevent_get_weight_acc: flow.get('event_get_weight_acc'),\n\tevent_min_weight: flow.get('event_min_weight'),\n\tminTriggerWeight: flow.get('minTriggerWeight'),\n\tsnapshot_url: flow.get('snapshot_url'),\n\tsnapshot_events: flow.get('snapshot_events'),\n\tdriverWeight: flow.get('driverWeight'),\n\toverLoadWeight: flow.get('overLoadWeight'),\n\tstableDiff: flow.get('stableDiff')\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":670,"y":240,"wires":[["98b22ef9.a42b9","3a67b893.6d0158"]]},{"id":"98b22ef9.a42b9","type":"json","z":"1124af78.b62db1","name":"","x":810,"y":240,"wires":[["b93ca84e.2b5208"]]},{"id":"b93ca84e.2b5208","type":"debug","z":"1124af78.b62db1","name":"IN device config","active":false,"console":"false","complete":"true","x":1000,"y":240,"wires":[]},{"id":"ecc0bd9a.af96c","type":"function","z":"1124af78.b62db1","name":"transactionHasMaxWeight","func":"msg.event_id = flow.get('event_max_weight_id');\nmsg.description = 'Перевищена максимально-допустима вага, кг: ' + msg.metadata.weight;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":580,"wires":[["9cde22e2.88744"]]},{"id":"10c40aa.dff32f5","type":"switch","z":"1124af78.b62db1","name":"switch max weight","property":"transactionHasMaxWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":422.6666259765625,"y":584.6666374206543,"wires":[["ecc0bd9a.af96c"]]},{"id":"9cde22e2.88744","type":"function","z":"1124af78.b62db1","name":"events payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in_2');\nvar snapshot_events = flow.get('snapshot_events');\nvar snapshot = false;\n\nif (snapshot_events.indexOf(event_id)>=0){\n    snapshot = true;\n}\n\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'devices':[{'id':scale_id}],\n    'data':msg.metadata,\n    'description':msg.description\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('event_url');\nmsg.main_host = flow.get('main_host');\nmsg.event_url = flow.get('event_url');\nmsg.snapshot = snapshot;\nreturn msg;","outputs":1,"noerr":0,"x":980,"y":560,"wires":[["dd77ea12.cc0728","c4b6afa.dae075"]]},{"id":"bfadf2d.45ec71","type":"function","z":"1124af78.b62db1","name":"main module","func":"var prevWeight = flow.get('prevWeight');\nvar transaction = flow.get('transaction');\nvar transactionData = flow.get('transactionData');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar transactionHasMaxWeight = flow.get('transactionHasMaxWeight');\nvar transactionHasMinWeight = flow.get('transactionHasMinWeight');\nvar transactionHasMaxDuration = flow.get('transactionHasMaxDuration');\nvar transactionOperationName = flow.get('transactionOperationName');\nvar stableDiff = flow.get('stableDiff');//дельта стабільності\nvar waybill = flow.get('transactionWaybill');\nvar weight = msg.payload;\nvar stableSize = 5;\nvar duration = 0;\nvar operation_name_income = \"Приход (авто)\";\nvar maxWeight = flow.get('maxWeight');\nvar maxDuration = flow.get('maxDuration');\nvar prevTransaction = transaction;\nvar minWeight = flow.get('minWeight');\nvar minTriggerWeight = flow.get('minTriggerWeight');\nvar is_minus = false;\nvar transactionAccWeight = flow.get('transactionAccWeight');//облікова вага\nvar overLoadWeight = flow.get('overLoadWeight');\n\n//transaction\nif (prevWeight === null){\n    prevWeight = msg.payload;    \n}else{\n    if((prevWeight <= 40) && (weight > 0) && (weight > minTriggerWeight)){\n        //start of transaction\n        transaction = Date.now();\n        msg.on = true;\n        flow.set('transaction',transaction);\n    }else if((prevWeight > 0) && (Math.abs(weight) <= 80) && (transaction)){\n        //transaction = 0;\n        msg.on = false;\n        transactionData = [];\n        flow.set('transaction',0);\n        flow.set('transactionMaxWeight',null);\n        flow.set('transactionHasMaxWeight',null);\n        flow.set('transactionHasMinWeight',null);\n        flow.set('transactionHasMaxDuration',null);\n        flow.set('transactionHasOverLoad',null);\n        flow.set('transactionOperationName',null);\n        flow.set('transactionWaybill',null);\n        flow.set('transactionMetadata',null);\n        flow.set('transactionAccWeight', null);//облікова вага\n    }else if((transaction === null) && (weight>0) && (weight > minTriggerWeight)){\n        transaction = Date.now();\n        flow.set('transaction',transaction);\n    }\n    if((prevWeight < 0) && ((weight-prevWeight) > minTriggerWeight)){\n        //start of transaction\n        is_minus = true;\n        msg.prevWeight = prevWeight;\n    }\n}\n\nmsg.stable = true;\n\nif (transaction > 0){\n    transactionData.push(weight);    \n\n    //stable\n    if(transactionData.length > stableSize+1){\n        var stabletmp = true;\n        for (var i = transactionData.length-1; i > transactionData.length-1-stableSize; i--){\n            if ((transactionData[i] - transactionData[i-1]) > stableDiff || (transactionData[i] - transactionData[i-1]) < -stableDiff){\n                stabletmp = false;\n                msg.stable = stabletmp;\n                break;\n            }\n            msg.stable = stabletmp;\n        }\n    }else{\n        msg.stable = false;\n    }\n\n    //duration & transactionMaxWeight\n    duration = (Number(Date.now()) - Number(transaction));\n    if( (weight>transactionMaxWeight) || (transactionMaxWeight === null)){\n        transactionMaxWeight = weight;\n        flow.set(\"transactionMaxWeight\",transactionMaxWeight);\n    }\n    \n    if(!transactionHasMaxWeight && weight > maxWeight){\n        msg.transactionHasMaxWeight = true;\n        flow.set('transactionHasMaxWeight',true);\n    }\n    \n    if(!transactionHasMinWeight && weight < minWeight){\n        msg.transactionHasMinWeight = true;\n        flow.set('transactionHasMinWeight',true);\n    }\n    \n    //max duartion\n    if(!transactionHasMaxDuration && duration > maxDuration){\n        msg.transactionHasMaxDuration = true;\n        flow.set('transactionHasMaxDuration',true);\n    }\n}\n\n\n//msg.stable = true;\n//result\nmsg.transaction = transaction; \nmsg.metadata = {\n    'weight':weight,\n    'prevWeight':prevWeight,\n    'prevTransaction':prevTransaction,\n    'transaction':transaction,\n    'on':msg.on,\n    'transactionDataCount':transactionData.length,\n    'stable':msg.stable,\n    'duration':Math.round(duration/1000),\n    'transactionMaxWeight':transactionMaxWeight,\n    'transactionAccWeight':transactionAccWeight,\n    'waybill':waybill,\n    'perimetr':true,\n    'weight1':msg.weight1,\n    'weight2':msg.weight2,\n    'weight_center':msg.weight_center,\n    'driverInCar':false,\n    'transactionOperationName':transactionOperationName\n}\nflow.set('transactionData',transactionData);\nflow.set('prevWeight',weight);\nflow.set('transactionMetadata',msg.metadata);\nflow.set('lasttimedata', new Date());\nmsg.is_minus = is_minus;\n\nif(transactionAccWeight && transactionOperationName!==operation_name_income){\n    \n   flow.set('transactionHasOverLoad',(weight-transactionAccWeight)>overLoadWeight);\n   \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":560,"wires":[["5d24f1d4.285fb","10c40aa.dff32f5","4cc323f.5c289dc","fd385749.a43848","1a947dc7.a63462","aa6ef7fb.e69fd8","ac9bf693.2938a8","622e7e32.0bb76","44f1f220.69ef0c","3c8b56f8.a18f2a"]]},{"id":"dfd9e092.1ad3b","type":"function","z":"1124af78.b62db1","name":"get weight from accounting system","func":"var transactionMetadata = flow.get('transactionMetadata');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar driverWeight = flow.get('driverWeight');\nvar buisness_data = msg.req.query;\n\nmsg.metadata = Object.assign(transactionMetadata,buisness_data);\n\n//check driver in a car\nvar driver_in = false;\nmsg.driverWeight = driverWeight;\nif((transactionMaxWeight - msg.metadata.weight) < driverWeight){\n    driver_in = true;\n}\n\nmsg.event_id = flow.get('event_get_weight_acc');\ntransactionWaybill = flow.get('transactionWaybill');\nif (!transactionWaybill){\n    flow.set('transactionWaybill',msg.req.query.waybill);\n}\nmsg.description = ' '+buisness_data.operation_name+'. '+buisness_data.operation_type+'. Зважили в 1С. Поточна вага: ' + msg.metadata.weight+\" Номер авто: \"+buisness_data.truck1+\" \"+buisness_data.truck2+\" \"+buisness_data.item_name + \", ТТН: \" + buisness_data.waybill;\nmsg.transactionMetadata = transactionMetadata;\nmsg.driver_in = driver_in;\n\nflow.set('transactionAccWeight',  msg.metadata.weight);//облікова вага\nflow.set('transactionOperationName',  msg.metadata.operation_name);//вид операції\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":940,"wires":[["7b94dd38.f573e4","9cde22e2.88744"]]},{"id":"dd77ea12.cc0728","type":"http request","z":"1124af78.b62db1","name":"EVENTS","method":"POST","ret":"txt","url":"","tls":"f436a52.4d81958","x":1220,"y":560,"wires":[["3103f5e8.8a15da"]]},{"id":"7dc92d3a.5d05c4","type":"function","z":"1124af78.b62db1","name":"move in","func":"msg.event_id = flow.get('event_move_in_id');\nmsg.description = 'Заїзд на ваги. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":500,"wires":[["9cde22e2.88744"]]},{"id":"10243b9d.57e664","type":"function","z":"1124af78.b62db1","name":"off","func":"msg.event_id = flow.get('event_off_id');\nmsg.description = 'Прилад відключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":860,"wires":[["fd8b707d.77c33"]]},{"id":"de310c1.0e7e0f","type":"function","z":"1124af78.b62db1","name":"on","func":"msg.event_id = flow.get('event_on_id');\nmsg.description = 'Прилад підключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":548,"y":819,"wires":[["99fc5e2d.4852"]]},{"id":"bfd75d44.611a9","type":"function","z":"1124af78.b62db1","name":"move out","func":"msg.event_id = flow.get('event_move_out_id');\nmsg.description = 'Зїзд з ваг. Максимальна вага: ' + msg.metadata.transactionMaxWeight;\nmsg.transactionMaxWeight = msg.metadata.transactionMaxWeight;\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":540,"wires":[["9cde22e2.88744","590f0d9f.562a44","f4ae6ebe.b8985"]]},{"id":"3130db06.d86e84","type":"function","z":"1124af78.b62db1","name":"transaction has max duration","func":"msg.event_id = flow.get('event_max_duration');\nmsg.description = 'Перевищено максимальний час находження на вагах, сек: ' + msg.metadata.duration;\n\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":620,"wires":[["9cde22e2.88744"]]},{"id":"b7476273.89ff3","type":"function","z":"1124af78.b62db1","name":"empty waybill","func":"msg.event_id = flow.get('event_fake_traffic');\nmsg.description = 'Холостий проїзд по вагам. Тривалість проїзду ' + Math.round(msg.metadata.duration/60)+ 'хв.' + \" Максимальна вага: \" + msg.metadata.transactionMaxWeight + \" кг.\";\n\nreturn msg;","outputs":1,"noerr":0,"x":772.6666259765625,"y":464.6666374206543,"wires":[["9cde22e2.88744"]]},{"id":"80f0e20d.8d3ff","type":"function","z":"1124af78.b62db1","name":"transactionHasMinWeight","func":"msg.event_id = flow.get('event_min_weight');\nmsg.description = 'Перевищена мінімально-допустима вага, кг: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":660,"wires":[["9cde22e2.88744"]]},{"id":"f23edd8b.204d3","type":"function","z":"1124af78.b62db1","name":"move in minus","func":"msg.event_id = flow.get('event_move_in_minus_id');\nmsg.description = 'Заїзд із мінусом. ' + msg.prevWeight +' кг.';\n\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":420,"wires":[["9cde22e2.88744"]]},{"id":"46d8b468.e68cac","type":"link in","z":"1124af78.b62db1","name":"s4 Авто 2","links":["9a16aa02.d5fb88"],"x":37.6666259765625,"y":564.6666259765625,"wires":[["52ab18c5.33ef18","f2457964.927f48","f430b60.4b32548","2f5b2af8.777af6","bfadf2d.45ec71","bec1cf5c.6d566"]]},{"id":"5d24f1d4.285fb","type":"switch","z":"1124af78.b62db1","name":"switch move","property":"on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":404.6666259765625,"y":547.6666259765625,"wires":[["7dc92d3a.5d05c4"],["bfd75d44.611a9","12ac23d3.33ec0c","d540d677.207868"]]},{"id":"4cc323f.5c289dc","type":"switch","z":"1124af78.b62db1","name":"max duration","property":"transactionHasMaxDuration","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":402.6666259765625,"y":624.6666374206543,"wires":[["3130db06.d86e84"]]},{"id":"fd385749.a43848","type":"switch","z":"1124af78.b62db1","name":"switch min weight","property":"transactionHasMinWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":422.6666259765625,"y":664.6666374206543,"wires":[["80f0e20d.8d3ff"]]},{"id":"1a947dc7.a63462","type":"switch","z":"1124af78.b62db1","name":"switch minus in","property":"is_minus","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":400,"y":440,"wires":[["f23edd8b.204d3"]]},{"id":"7b94dd38.f573e4","type":"switch","z":"1124af78.b62db1","name":"","property":"driver_in","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":730,"y":940,"wires":[["c7402edd.a6908"]]},{"id":"88fc73d4.70caf","type":"http in","z":"1124af78.b62db1","name":"","url":"/getWeight2","method":"get","swaggerDoc":"","x":160,"y":940,"wires":[["1cab5bc4.3e0394","dfd9e092.1ad3b"]]},{"id":"c7402edd.a6908","type":"function","z":"1124af78.b62db1","name":"driver_in event","func":"msg.event_id = flow.get('event_driver_in');\nmsg.description = 'При зважуванні водій в кабіні. Вага: ' + msg.metadata.weight+\"кг. Номер авто: \"+msg.metadata.truck1+\" \"+msg.metadata.truck2+\" \"+msg.metadata.item_name;\n\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":940,"wires":[["b4797310.6a2e3","9cde22e2.88744"]]},{"id":"22446e7a.7c22e2","type":"switch","z":"1124af78.b62db1","name":"","property":"checkHealth","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":410,"y":840,"wires":[["de310c1.0e7e0f"],["10243b9d.57e664"]]},{"id":"12ac23d3.33ec0c","type":"switch","z":"1124af78.b62db1","name":"waybill","property":"metadata.waybill","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","outputs":1,"x":590,"y":460,"wires":[["b7476273.89ff3"]]},{"id":"52ab18c5.33ef18","type":"socket-io-out","z":"1124af78.b62db1","name":"socket 5001","event":"d0426e92.cf1a2","server":"e06043a7.1d685","x":170,"y":640,"wires":[]},{"id":"f2457964.927f48","type":"debug","z":"1124af78.b62db1","name":"Avto 2 weight","active":false,"console":"true","complete":"payload","x":200,"y":520,"wires":[]},{"id":"f430b60.4b32548","type":"ui_text","z":"1124af78.b62db1","group":"7f9670a2.ed156","order":0,"width":0,"height":0,"name":"","label":"Поточна вага праві:","format":"{{msg.payload}}","layout":"row-spread","x":199,"y":674.0000114440918,"wires":[]},{"id":"1cab5bc4.3e0394","type":"function","z":"1124af78.b62db1","name":"response","func":"msg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nif(transactionWaybill && transactionWaybill !== msg.req.query.waybill){\n    msg.payload.status = false;    \n}else {\n    msg.payload.status = true;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":1020,"wires":[["33068bf8.a91174"]]},{"id":"d620a7a8.b151d8","type":"function","z":"1124af78.b62db1","name":"check scale health","func":"var lastcheckHealth = flow.get('checkHealth');\nvar checkHealth = null;\nvar lasttimedata = flow.get('lasttimedata');\n\nvar currenttimedata = new Date();\n\nif ((currenttimedata - lasttimedata) > 20000){\n    checkHealth = false;\n} else {\n    checkHealth = true;\n}\n\nflow.set(\"checkHealth\",checkHealth);\n\nif (lastcheckHealth != checkHealth){\n    msg.checkHealth = checkHealth;\n}else{\n    msg.checkHealth = null;\n}\nmsg.payload = checkHealth;\n\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":840,"wires":[["22446e7a.7c22e2"]]},{"id":"33068bf8.a91174","type":"http response","z":"1124af78.b62db1","name":"","x":630,"y":1020,"wires":[]},{"id":"8d0c4ad0.c71bd8","type":"inject","z":"1124af78.b62db1","name":"","topic":"","payload":"","payloadType":"date","repeat":"6","crontab":"","once":false,"x":110,"y":800,"wires":[["d620a7a8.b151d8"]]},{"id":"29510f2f.8dd14","type":"http in","z":"1124af78.b62db1","name":"","url":"/getSimpleWeight_2","method":"get","swaggerDoc":"","x":190,"y":1180,"wires":[["c21127b4.9c50d8"]]},{"id":"c21127b4.9c50d8","type":"function","z":"1124af78.b62db1","name":"response","func":"msg.payload = flow.get('transactionMetadata').weight;\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":1180,"wires":[["5b58e9da.f58f68"]]},{"id":"5b58e9da.f58f68","type":"http response","z":"1124af78.b62db1","name":"","x":590,"y":1180,"wires":[]},{"id":"7ef7edcf.fde634","type":"http in","z":"1124af78.b62db1","name":"","url":"/socket_2","method":"get","swaggerDoc":"","x":150,"y":1280,"wires":[["bb2d3e17.52544"]]},{"id":"aa7b871f.fea7f8","type":"template","z":"1124af78.b62db1","name":"socket page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n     \n  <body>\n    <h1><p id='weight'></p></h1>\n    \n     <script>\n    setTimeout(function() {\n       ;(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.io=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_(\"./lib/\")},{\"./lib/\":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_(\"./socket\");module.exports.parser=_dereq_(\"engine.io-parser\")},{\"./socket\":3,\"engine.io-parser\":19}],3:[function(_dereq_,module,exports){(function(global){var transports=_dereq_(\"./transports\");var Emitter=_dereq_(\"component-emitter\");var debug=_dereq_(\"debug\")(\"engine.io-client:socket\");var index=_dereq_(\"indexof\");var parser=_dereq_(\"engine.io-parser\");var parseuri=_dereq_(\"parseuri\");var parsejson=_dereq_(\"parsejson\");var parseqs=_dereq_(\"parseqs\");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&\"object\"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==\"https\"||uri.protocol==\"wss\";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&\"https:\"==location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?\"443\":\"80\"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:\"localhost\");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if(\"string\"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||\"t\";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||[\"polling\",\"websocket\"];this.readyState=\"\";this.writeBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?null:opts.rejectUnauthorized;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}}this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_(\"./transport\");Socket.transports=_dereq_(\"./transports\");Socket.parser=_dereq_(\"engine.io-parser\");Socket.prototype.createTransport=function(name){debug('creating transport \"%s\"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf(\"websocket\")!=-1){transport=\"websocket\"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit(\"error\",\"No transports available\")},0);return}else{transport=this.transports[0]}this.readyState=\"opening\";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug(\"setting transport %s\",transport.name);var self=this;if(this.transport){debug(\"clearing existing transport %s\",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on(\"drain\",function(){self.onDrain()}).on(\"packet\",function(packet){self.onPacket(packet)}).on(\"error\",function(e){self.onError(e)}).on(\"close\",function(){self.onClose(\"transport close\")})};Socket.prototype.probe=function(name){debug('probing transport \"%s\"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport \"%s\" opened',name);transport.send([{type:\"ping\",data:\"probe\"}]);transport.once(\"packet\",function(msg){if(failed)return;if(\"pong\"==msg.type&&\"probe\"==msg.data){debug('probe transport \"%s\" pong',name);self.upgrading=true;self.emit(\"upgrading\",transport);if(!transport)return;Socket.priorWebsocketSuccess=\"websocket\"==transport.name;debug('pausing current transport \"%s\"',self.transport.name);self.transport.pause(function(){if(failed)return;if(\"closed\"==self.readyState)return;debug(\"changing transport and sending upgrade packet\");cleanup();self.setTransport(transport);transport.send([{type:\"upgrade\"}]);self.emit(\"upgrade\",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport \"%s\" failed',name);var err=new Error(\"probe error\");err.transport=transport.name;self.emit(\"upgradeError\",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error(\"probe error: \"+err);error.transport=transport.name;freezeTransport();debug('probe transport \"%s\" failed because of error: %s',name,err);self.emit(\"upgradeError\",error)}function onTransportClose(){onerror(\"transport closed\")}function onclose(){onerror(\"socket closed\")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('\"%s\" works - aborting \"%s\"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener(\"open\",onTransportOpen);transport.removeListener(\"error\",onerror);transport.removeListener(\"close\",onTransportClose);self.removeListener(\"close\",onclose);self.removeListener(\"upgrading\",onupgrade)}transport.once(\"open\",onTransportOpen);transport.once(\"error\",onerror);transport.once(\"close\",onTransportClose);this.once(\"close\",onclose);this.once(\"upgrading\",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug(\"socket open\");this.readyState=\"open\";Socket.priorWebsocketSuccess=\"websocket\"==this.transport.name;this.emit(\"open\");this.flush();if(\"open\"==this.readyState&&this.upgrade&&this.transport.pause){debug(\"starting upgrade probes\");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if(\"opening\"==this.readyState||\"open\"==this.readyState){debug('socket receive: type \"%s\", data \"%s\"',packet.type,packet.data);this.emit(\"packet\",packet);this.emit(\"heartbeat\");switch(packet.type){case\"open\":this.onHandshake(parsejson(packet.data));break;case\"pong\":this.setPing();this.emit(\"pong\");break;case\"error\":var err=new Error(\"server error\");err.code=packet.data;this.onError(err);break;case\"message\":this.emit(\"data\",packet.data);this.emit(\"message\",packet.data);break}}else{debug('packet received with socket readyState \"%s\"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit(\"handshake\",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if(\"closed\"==this.readyState)return;this.setPing();this.removeListener(\"heartbeat\",this.onHeartbeat);this.on(\"heartbeat\",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if(\"closed\"==self.readyState)return;self.onClose(\"ping timeout\")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug(\"writing ping packet - expecting pong within %sms\",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket(\"ping\",function(){self.emit(\"ping\")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit(\"drain\")}else{this.flush()}};Socket.prototype.flush=function(){if(\"closed\"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug(\"flushing %d packets in socket\",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit(\"flush\")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket(\"message\",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if(\"function\"==typeof data){fn=data;data=undefined}if(\"function\"==typeof options){fn=options;options=null}if(\"closing\"==this.readyState||\"closed\"==this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit(\"packetCreate\",packet);this.writeBuffer.push(packet);if(fn)this.once(\"flush\",fn);this.flush()};Socket.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.readyState=\"closing\";var self=this;if(this.writeBuffer.length){this.once(\"drain\",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose(\"forced close\");debug(\"socket closing - telling transport to close\");self.transport.close()}function cleanupAndClose(){self.removeListener(\"upgrade\",cleanupAndClose);self.removeListener(\"upgradeError\",cleanupAndClose);close()}function waitForUpgrade(){self.once(\"upgrade\",cleanupAndClose);self.once(\"upgradeError\",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug(\"socket error %j\",err);Socket.priorWebsocketSuccess=false;this.emit(\"error\",err);this.onClose(\"transport error\",err)};Socket.prototype.onClose=function(reason,desc){if(\"opening\"==this.readyState||\"open\"==this.readyState||\"closing\"==this.readyState){debug('socket close with reason: \"%s\"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners(\"close\");this.transport.close();this.transport.removeAllListeners();this.readyState=\"closed\";this.id=null;this.emit(\"close\",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./transport\":4,\"./transports\":5,\"component-emitter\":15,debug:17,\"engine.io-parser\":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(_dereq_,module,exports){var parser=_dereq_(\"engine.io-parser\");var Emitter=_dereq_(\"component-emitter\");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState=\"\";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type=\"TransportError\";err.description=desc;this.emit(\"error\",err);return this};Transport.prototype.open=function(){if(\"closed\"==this.readyState||\"\"==this.readyState){this.readyState=\"opening\";this.doOpen()}return this};Transport.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if(\"open\"==this.readyState){this.write(packets)}else{throw new Error(\"Transport not open\")}};Transport.prototype.onOpen=function(){this.readyState=\"open\";this.writable=true;this.emit(\"open\")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit(\"packet\",packet)};Transport.prototype.onClose=function(){this.readyState=\"closed\";this.emit(\"close\")}},{\"component-emitter\":15,\"engine.io-parser\":19}],5:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var XHR=_dereq_(\"./polling-xhr\");var JSONP=_dereq_(\"./polling-jsonp\");var websocket=_dereq_(\"./websocket\");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if(\"open\"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error(\"JSONP disabled\");return new JSONP(opts)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling-jsonp\":6,\"./polling-xhr\":7,\"./websocket\":9,\"xmlhttprequest-ssl\":10}],6:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_(\"./polling\");var inherit=_dereq_(\"component-inherit\");module.exports=JSONPPolling;var rNewline=/\\n/g;var rEscapedNewline=/\\\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener(\"beforeunload\",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement(\"script\");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError(\"jsonp poll error\",e)};var insertAt=document.getElementsByTagName(\"script\")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko=\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement(\"iframe\");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement(\"form\");var area=document.createElement(\"textarea\");var id=this.iframeId=\"eio_iframe_\"+this.index;var iframe;form.className=\"socketio\";form.style.position=\"absolute\";form.style.top=\"-1000px\";form.style.left=\"-1000px\";form.target=id;form.method=\"POST\";form.setAttribute(\"accept-charset\",\"utf-8\");area.name=\"d\";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError(\"jsonp polling iframe removal error\",e)}}try{var html='<iframe src=\"javascript:0\" name=\"'+self.iframeId+'\">';iframe=document.createElement(html)}catch(e){iframe=document.createElement(\"iframe\");iframe.name=self.iframeId;iframe.src=\"javascript:0\"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,\"\\\\\\n\");this.area.value=data.replace(rNewline,\"\\\\n\");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==\"complete\"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-inherit\":16}],7:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var Polling=_dereq_(\"./polling\");var Emitter=_dereq_(\"component-emitter\");var inherit=_dereq_(\"component-inherit\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling-xhr\");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}else{this.extraHeaders=opts.extraHeaders}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!==\"string\"&&data!==undefined;var req=this.request({method:\"POST\",data:data,isBinary:isBinary});var self=this;req.on(\"success\",fn);req.on(\"error\",function(err){self.onError(\"xhr post error\",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug(\"xhr poll\");var req=this.request();var self=this;req.on(\"data\",function(data){self.onData(data)});req.on(\"error\",function(err){self.onError(\"xhr poll error\",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||\"GET\";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug(\"xhr open %s: %s\",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){xhr.responseType=\"arraybuffer\"}if(\"POST\"==this.method){try{if(this.isBinary){xhr.setRequestHeader(\"Content-type\",\"application/octet-stream\")}else{xhr.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}}catch(e){}}if(\"withCredentials\"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug(\"xhr data %s\",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit(\"success\");this.cleanup()};Request.prototype.onData=function(data){this.emit(\"data\",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit(\"error\",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if(\"undefined\"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader(\"Content-Type\").split(\";\")[0]}catch(e){}if(contentType===\"application/octet-stream\"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var ui8Arr=new Uint8Array(this.xhr.response);var dataArray=[];for(var idx=0,length=ui8Arr.length;idx<length;idx++){dataArray.push(ui8Arr[idx])}data=String.fromCharCode.apply(null,dataArray)}}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return\"undefined\"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent(\"onunload\",unloadHandler)}else if(global.addEventListener){global.addEventListener(\"beforeunload\",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-emitter\":15,\"component-inherit\":16,debug:17,\"xmlhttprequest-ssl\":10}],8:[function(_dereq_,module,exports){var Transport=_dereq_(\"../transport\");var parseqs=_dereq_(\"parseqs\");var parser=_dereq_(\"engine.io-parser\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling\");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name=\"polling\";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState=\"pausing\";function pause(){debug(\"paused\");self.readyState=\"paused\";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug(\"we are currently polling - waiting to pause\");total++;this.once(\"pollComplete\",function(){debug(\"pre-pause polling complete\");--total||pause()})}if(!this.writable){debug(\"we are currently writing - waiting to pause\");total++;this.once(\"drain\",function(){debug(\"pre-pause writing complete\");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug(\"polling\");this.polling=true;this.doPoll();this.emit(\"poll\")};Polling.prototype.onData=function(data){var self=this;debug(\"polling got data %s\",data);var callback=function(packet,index,total){if(\"opening\"==self.readyState){self.onOpen()}if(\"close\"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if(\"closed\"!=this.readyState){this.polling=false;this.emit(\"pollComplete\");if(\"open\"==this.readyState){this.poll()}else{debug('ignoring poll - transport state \"%s\"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug(\"writing close packet\");self.write([{type:\"close\"}])}if(\"open\"==this.readyState){debug(\"transport open - closing\");close()}else{debug(\"transport not open - deferring close\");this.once(\"open\",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit(\"drain\")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"https\":\"http\";var port=\"\";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&(\"https\"==schema&&this.port!=443||\"http\"==schema&&this.port!=80)){port=\":\"+this.port}if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query}},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,\"xmlhttprequest-ssl\":10,yeast:30}],9:[function(_dereq_,module,exports){(function(global){var Transport=_dereq_(\"../transport\");var parser=_dereq_(\"engine.io-parser\");var parseqs=_dereq_(\"parseqs\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:websocket\");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window===\"undefined\"){try{WebSocket=_dereq_(\"ws\")}catch(e){}}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name=\"websocket\";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}this.ws=BrowserWebSocket?new WebSocket(uri):new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType=\"buffer\"}else{this.ws.binaryType=\"arraybuffer\"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError(\"websocket error\",e)}};if(\"undefined\"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!BrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len=\"string\"==typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(BrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug(\"websocket closed before onclose event\")}--total||done()})})(packets[i])}function done(){self.emit(\"flush\");setTimeout(function(){self.writable=true;self.emit(\"drain\")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!==\"undefined\"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"wss\":\"ws\";var port=\"\";if(this.port&&(\"wss\"==schema&&this.port!=443||\"ws\"==schema&&this.port!=80)){port=\":\"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!(\"__initialize\"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,ws:undefined,yeast:30}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_(\"has-cors\");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if(\"undefined\"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(e){}}}},{\"has-cors\":22}],11:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error(\"after called too many times\")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],12:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],13:[function(_dereq_,module,exports){(function(chars){\"use strict\";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64=\"\";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];\nbase64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+\"=\"}else if(len%3===1){base64=base64.substring(0,base64.length-2)+\"==\"}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]===\"=\"){bufferLength--;if(base64[base64.length-2]===\"=\"){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\")},{}],14:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob([\"hi\"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],15:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],16:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],17:[function(_dereq_,module,exports){exports=module.exports=_dereq_(\"./debug\");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=\"undefined\"!=typeof chrome&&\"undefined\"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"];function useColors(){return\"WebkitAppearance\"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?\"%c\":\"\")+this.namespace+(useColors?\" %c\":\" \")+args[0]+(useColors?\"%c \":\" \")+\"+\"+exports.humanize(this.diff);if(!useColors)return args;var c=\"color: \"+this.color;args=[args[0],c,\"color: inherit\"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if(\"%%\"===match)return;index++;if(\"%c\"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return\"object\"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem(\"debug\")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{\"./debug\":18}],18:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_(\"ms\");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if(\"string\"!==typeof args[0]){args=[\"%o\"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match===\"%%\")return match;index++;var formatter=exports.formatters[format];if(\"function\"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if(\"function\"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||\"\").split(/[\\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\\*/g,\".*?\");if(namespaces[0]===\"-\"){exports.skips.push(new RegExp(\"^\"+namespaces.substr(1)+\"$\"))}else{exports.names.push(new RegExp(\"^\"+namespaces+\"$\"))}}}function disable(){exports.enable(\"\")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:25}],19:[function(_dereq_,module,exports){(function(global){var keys=_dereq_(\"./keys\");var hasBinary=_dereq_(\"has-binary\");var sliceBuffer=_dereq_(\"arraybuffer.slice\");var base64encoder=_dereq_(\"base64-arraybuffer\");var after=_dereq_(\"after\");var utf8=_dereq_(\"utf8\");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:\"error\",data:\"parser error\"};var Blob=_dereq_(\"blob\");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if(\"function\"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if(\"function\"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(\"\"+encoded)};function encodeBase64Object(packet,callback){var message=\"b\"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message=\"b\"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(\",\")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data==\"string\"||data===undefined){if(data.charAt(0)==\"b\"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType===\"blob\"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType===\"blob\"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary==\"function\"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback(\"0:\")}function setLengthHeader(message){return message.length+\":\"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(\"\"))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!=\"string\"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var packet;if(data==\"\"){return callback(err,0,1)}var length=\"\",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(\":\"!=chr){length+=chr}else{if(\"\"==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=\"\"}}if(length!=\"\"){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p===\"string\"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p===\"string\";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded===\"string\"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength=\"\";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg=\"\";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./keys\":20,after:11,\"arraybuffer.slice\":12,\"base64-arraybuffer\":13,blob:14,\"has-binary\":21,utf8:29}],20:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],21:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:24}],22:[function(_dereq_,module,exports){try{module.exports=typeof XMLHttpRequest!==\"undefined\"&&\"withCredentials\"in new XMLHttpRequest}catch(err){module.exports=false}},{}],23:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],24:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)==\"[object Array]\"}},{}],25:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if(\"string\"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=\"\"+str;if(str.length>1e4)return;var match=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||\"ms\").toLowerCase();switch(type){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return n*y;case\"days\":case\"day\":case\"d\":return n*d;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return n*h;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return n*m;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return n*s;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+\"d\";if(ms>=h)return Math.round(ms/h)+\"h\";if(ms>=m)return Math.round(ms/m)+\"m\";if(ms>=s)return Math.round(ms/s)+\"s\";return ms+\"ms\"}function long(ms){return plural(ms,d,\"day\")||plural(ms,h,\"hour\")||plural(ms,m,\"minute\")||plural(ms,s,\"second\")||ms+\" ms\"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+\" \"+name;return Math.ceil(ms/n)+\" \"+name+\"s\"}},{}],26:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\\],:{}\\s]*$/;var rvalidescape=/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\\s*\\[)+/g;var rtrimLeft=/^\\s+/;var rtrimRight=/\\s+$/;module.exports=function parsejson(data){if(\"string\"!=typeof data||!data){return null}data=data.replace(rtrimLeft,\"\").replace(rtrimRight,\"\");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,\"@\").replace(rvalidtokens,\"]\").replace(rvalidbraces,\"\"))){return new Function(\"return \"+data)()}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],27:[function(_dereq_,module,exports){exports.encode=function(obj){var str=\"\";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+=\"&\";str+=encodeURIComponent(i)+\"=\"+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split(\"&\");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split(\"=\");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],28:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;var parts=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];module.exports=function parseuri(str){var src=str,b=str.indexOf(\"[\"),e=str.indexOf(\"]\");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,\";\")+str.substring(e,str.length)}var m=re.exec(str||\"\"),uri={},i=14;while(i--){uri[parts[i]]=m[i]||\"\"}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,\":\");uri.authority=uri.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\");uri.ipv6uri=true}return uri}},{}],29:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports==\"object\"&&exports;var freeModule=typeof module==\"object\"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output=\"\";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error(\"Lone surrogate U+\"+codePoint.toString(16).toUpperCase()+\" is not a scalar value\")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol=\"\";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString=\"\";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error(\"Invalid byte index\")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error(\"Invalid continuation byte\")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error(\"Invalid byte index\")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error(\"Invalid UTF-8 detected\")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:\"2.0.0\",encode:utf8encode,decode:utf8decode};if(typeof define==\"function\"&&typeof define.amd==\"object\"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],30:[function(_dereq_,module,exports){\"use strict\";var alphabet=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded=\"\";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+\".\"+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],31:[function(_dereq_,module,exports){var url=_dereq_(\"./url\");var parser=_dereq_(\"socket.io-parser\");var Manager=_dereq_(\"./manager\");var debug=_dereq_(\"debug\")(\"socket.io-client\");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==\"object\"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts[\"force new connection\"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug(\"ignoring socket cache for %s\",source);io=Manager(source,opts)}else{if(!cache[id]){debug(\"new io instance for %s\",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_(\"./manager\");exports.Socket=_dereq_(\"./socket\")},{\"./manager\":32,\"./socket\":34,\"./url\":35,debug:39,\"socket.io-parser\":47}],32:[function(_dereq_,module,exports){var eio=_dereq_(\"engine.io-client\");var Socket=_dereq_(\"./socket\");var Emitter=_dereq_(\"component-emitter\");var parser=_dereq_(\"socket.io-parser\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:manager\");var indexOf=_dereq_(\"indexof\");var Backoff=_dereq_(\"backo2\");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&\"object\"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||\"/socket.io\";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState=\"closed\";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.engine.id}}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug(\"readyState %s\",this.readyState);if(~this.readyState.indexOf(\"open\"))return this;debug(\"opening %s\",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState=\"opening\";this.skipReconnect=false;var openSub=on(socket,\"open\",function(){self.onopen();fn&&fn()});var errorSub=on(socket,\"error\",function(data){debug(\"connect_error\");self.cleanup();self.readyState=\"closed\";self.emitAll(\"connect_error\",data);if(fn){var err=new Error(\"Connection error\");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug(\"connect attempt will timeout after %d\",timeout);var timer=setTimeout(function(){debug(\"connect attempt timed out after %d\",timeout);openSub.destroy();socket.close();socket.emit(\"error\",\"timeout\");self.emitAll(\"connect_timeout\",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug(\"open\");this.cleanup();this.readyState=\"open\";this.emit(\"open\");var socket=this.engine;this.subs.push(on(socket,\"data\",bind(this,\"ondata\")));this.subs.push(on(socket,\"ping\",bind(this,\"onping\")));this.subs.push(on(socket,\"pong\",bind(this,\"onpong\")));this.subs.push(on(socket,\"error\",bind(this,\"onerror\")));this.subs.push(on(socket,\"close\",bind(this,\"onclose\")));this.subs.push(on(this.decoder,\"decoded\",bind(this,\"ondecoded\")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll(\"ping\")};Manager.prototype.onpong=function(){this.emitAll(\"pong\",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit(\"packet\",packet)};Manager.prototype.onerror=function(err){debug(\"error\",err);this.emitAll(\"error\",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on(\"connecting\",onConnecting);\nsocket.on(\"connect\",function(){socket.id=self.engine.id});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug(\"writing packet %j\",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug(\"cleanup\");var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug(\"disconnect\");this.skipReconnect=true;this.reconnecting=false;if(\"opening\"==this.readyState){this.cleanup()}this.backoff.reset();this.readyState=\"closed\";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug(\"onclose\");this.cleanup();this.backoff.reset();this.readyState=\"closed\";this.emit(\"close\",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug(\"reconnect failed\");this.backoff.reset();this.emitAll(\"reconnect_failed\");this.reconnecting=false}else{var delay=this.backoff.duration();debug(\"will wait %dms before reconnect attempt\",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug(\"attempting reconnect\");self.emitAll(\"reconnect_attempt\",self.backoff.attempts);self.emitAll(\"reconnecting\",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug(\"reconnect attempt error\");self.reconnecting=false;self.reconnect();self.emitAll(\"reconnect_error\",err.data)}else{debug(\"reconnect success\");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll(\"reconnect\",attempt)}},{\"./on\":33,\"./socket\":34,backo2:36,\"component-bind\":37,\"component-emitter\":38,debug:39,\"engine.io-client\":1,indexof:42,\"socket.io-parser\":47}],33:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],34:[function(_dereq_,module,exports){var parser=_dereq_(\"socket.io-parser\");var Emitter=_dereq_(\"component-emitter\");var toArray=_dereq_(\"to-array\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:socket\");var hasBin=_dereq_(\"has-binary\");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,\"open\",bind(this,\"onopen\")),on(io,\"packet\",bind(this,\"onpacket\")),on(io,\"close\",bind(this,\"onclose\"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if(\"open\"==this.io.readyState)this.onopen();this.emit(\"connecting\");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift(\"message\");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if(\"function\"==typeof args[args.length-1]){debug(\"emitting packet with ack id %d\",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug(\"transport is open - connecting\");if(\"/\"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug(\"close (%s)\",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit(\"disconnect\",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit(\"error\",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug(\"emitting event %j\",args);if(null!=packet.id){debug(\"attaching ack callback to event\");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug(\"sending ack %j\",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if(\"function\"==typeof ack){debug(\"calling ack %s with %j\",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug(\"bad ack %s\",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit(\"connect\");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug(\"server disconnect (%s)\",this.nsp);this.destroy();this.onclose(\"io server disconnect\")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug(\"performing disconnect (%s)\",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose(\"io client disconnect\")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{\"./on\":33,\"component-bind\":37,\"component-emitter\":38,debug:39,\"has-binary\":41,\"socket.io-parser\":47,\"to-array\":51}],35:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_(\"parseuri\");var debug=_dereq_(\"debug\")(\"socket.io-client:url\");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+\"//\"+loc.host;if(\"string\"==typeof uri){if(\"/\"==uri.charAt(0)){if(\"/\"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\\/\\//.test(uri)){debug(\"protocol-less url %s\",uri);if(\"undefined\"!=typeof loc){uri=loc.protocol+\"//\"+uri}else{uri=\"https://\"+uri}}debug(\"parse %s\",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port=\"80\"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port=\"443\"}}obj.path=obj.path||\"/\";var ipv6=obj.host.indexOf(\":\")!==-1;var host=ipv6?\"[\"+obj.host+\"]\":obj.host;obj.id=obj.protocol+\"://\"+host+\":\"+obj.port;obj.href=obj.protocol+\"://\"+host+(loc&&loc.port==obj.port?\"\":\":\"+obj.port);return obj}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{debug:39,parseuri:45}],36:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],37:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if(\"string\"==typeof fn)fn=obj[fn];if(\"function\"!=typeof fn)throw new Error(\"bind() requires a function\");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],38:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[\"$\"+event]=this._callbacks[\"$\"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[\"$\"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[\"$\"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[\"$\"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[\"$\"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],39:[function(_dereq_,module,exports){arguments[4][17][0].apply(exports,arguments)},{\"./debug\":40,dup:17}],40:[function(_dereq_,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:44}],41:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON&&\"function\"==typeof obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:43}],42:[function(_dereq_,module,exports){arguments[4][23][0].apply(exports,arguments)},{dup:23}],43:[function(_dereq_,module,exports){arguments[4][24][0].apply(exports,arguments)},{dup:24}],44:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],45:[function(_dereq_,module,exports){arguments[4][28][0].apply(exports,arguments)},{dup:28}],46:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");var isBuf=_dereq_(\"./is-buffer\");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if(\"object\"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&\"object\"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&\"object\"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./is-buffer\":48,isarray:43}],47:[function(_dereq_,module,exports){var debug=_dereq_(\"debug\")(\"socket.io-parser\");var json=_dereq_(\"json3\");var isArray=_dereq_(\"isarray\");var Emitter=_dereq_(\"component-emitter\");var binary=_dereq_(\"./binary\");var isBuf=_dereq_(\"./is-buffer\");exports.protocol=4;exports.types=[\"CONNECT\",\"DISCONNECT\",\"EVENT\",\"BINARY_EVENT\",\"ACK\",\"BINARY_ACK\",\"ERROR\"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug(\"encoding packet %j\",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str=\"\";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+=\"-\"}if(obj.nsp&&\"/\"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=\",\";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=\",\";str+=json.stringify(obj.data)}debug(\"encoded %j as %s\",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if(\"string\"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit(\"decoded\",packet)}}else{this.emit(\"decoded\",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error(\"got binary data when not reconstructing a packet\")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit(\"decoded\",packet)}}}else{throw new Error(\"Unknown type: \"+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf=\"\";while(str.charAt(++i)!=\"-\"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!=\"-\"){throw new Error(\"Illegal attachments\")}p.attachments=Number(buf)}if(\"/\"==str.charAt(i+1)){p.nsp=\"\";while(++i){var c=str.charAt(i);if(\",\"==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp=\"/\"}var next=str.charAt(i+1);if(\"\"!==next&&Number(next)==next){p.id=\"\";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug(\"decoded %s as %j\",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:\"parser error\"}}},{\"./binary\":46,\"./is-buffer\":48,\"component-emitter\":49,debug:39,isarray:43,json3:50}],48:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],49:[function(_dereq_,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],50:[function(_dereq_,module,exports){(function(global){(function(){var isLoader=typeof define===\"function\"&&define.amd;var objectTypes={\"function\":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global==\"object\"&&global;if(freeGlobal&&(freeGlobal[\"global\"]===freeGlobal||freeGlobal[\"window\"]===freeGlobal||freeGlobal[\"self\"]===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root[\"Object\"]());exports||(exports=root[\"Object\"]());var Number=context[\"Number\"]||root[\"Number\"],String=context[\"String\"]||root[\"String\"],Object=context[\"Object\"]||root[\"Object\"],Date=context[\"Date\"]||root[\"Date\"],SyntaxError=context[\"SyntaxError\"]||root[\"SyntaxError\"],TypeError=context[\"TypeError\"]||root[\"TypeError\"],Math=context[\"Math\"]||root[\"Math\"],nativeJSON=context[\"JSON\"]||root[\"JSON\"];if(typeof nativeJSON==\"object\"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name==\"bug-string-char-index\"){isSupported=\"a\"[0]!=\"a\"}else if(name==\"json\"){isSupported=has(\"json-stringify\")&&has(\"json-parse\")}else{var value,serialized='{\"a\":[1,true,false,null,\"\\\\u0000\\\\b\\\\n\\\\f\\\\r\\\\t\"]}';if(name==\"json-stringify\"){var stringify=exports.stringify,stringifySupported=typeof stringify==\"function\"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)===\"0\"&&stringify(new Number)===\"0\"&&stringify(new String)=='\"\"'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)===\"1\"&&stringify([value])==\"[1]\"&&stringify([undef])==\"[null]\"&&stringify(null)==\"null\"&&stringify([undef,getClass,null])==\"[null,null,null]\"&&stringify({a:[value,true,false,null,\"\\x00\\b\\n\\f\\r\t\"]})==serialized&&stringify(null,value)===\"1\"&&stringify([1,2],null,1)==\"[\\n 1,\\n 2\\n]\"&&stringify(new Date(-864e13))=='\"-271821-04-20T00:00:00.000Z\"'&&stringify(new Date(864e13))=='\"+275760-09-13T00:00:00.000Z\"'&&stringify(new Date(-621987552e5))=='\"-000001-01-01T00:00:00.000Z\"'&&stringify(new Date(-1))=='\"1969-12-31T23:59:59.999Z\"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name==\"json-parse\"){var parse=exports.parse;if(typeof parse==\"function\"){try{if(parse(\"0\")===0&&!parse(false)){value=parse(serialized);var parseSupported=value[\"a\"].length==5&&value[\"a\"][0]===1;if(parseSupported){try{parseSupported=!parse('\"\t\"')}catch(exception){}if(parseSupported){try{parseSupported=parse(\"01\")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse(\"1.\")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has(\"json\")){var functionClass=\"[object Function]\",dateClass=\"[object Date]\",numberClass=\"[object Number]\",stringClass=\"[object String]\",arrayClass=\"[object Array]\",booleanClass=\"[object Boolean]\";var charIndexBuggy=has(\"bug-string-char-index\");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=[\"valueOf\",\"toString\",\"toLocaleString\",\"propertyIsEnumerable\",\"isPrototypeOf\",\"hasOwnProperty\",\"constructor\"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!=\"function\"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property==\"prototype\")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property==\"prototype\")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property==\"prototype\")&&isProperty.call(object,property)&&!(isConstructor=property===\"constructor\")){callback(property)}}if(isConstructor||isProperty.call(object,property=\"constructor\")){callback(property)}}}return forEach(object,callback)};if(!has(\"json-stringify\")){var Escapes={92:\"\\\\\\\\\",34:'\\\\\"',8:\"\\\\b\",12:\"\\\\f\",10:\"\\\\n\",13:\"\\\\r\",9:\"\\\\t\"};var leadingZeroes=\"000000\";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix=\"\\\\u00\";var quote=function(value){var result='\"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(\"\"):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'\"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value==\"object\"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,\"toJSON\")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?\"-\":\"+\")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+\"-\"+toPaddedString(2,month+1)+\"-\"+toPaddedString(2,date)+\"T\"+toPaddedString(2,hours)+\":\"+toPaddedString(2,minutes)+\":\"+toPaddedString(2,seconds)+\".\"+toPaddedString(3,milliseconds)+\"Z\"}else{value=null}}else if(typeof value.toJSON==\"function\"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,\"toJSON\"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return\"null\"}className=getClass.call(value);if(className==booleanClass){return\"\"+value}else if(className==numberClass){return value>-1/0&&value<1/0?\"\"+value:\"null\"}else if(className==stringClass){return quote(\"\"+value)}if(typeof value==\"object\"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?\"null\":element)}result=results.length?whitespace?\"[\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"]\":\"[\"+results.join(\",\")+\"]\":\"[]\"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+\":\"+(whitespace?\" \":\"\")+element)}});result=results.length?whitespace?\"{\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"}\":\"{\"+results.join(\",\")+\"}\":\"{}\"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace=\"\",width>10&&(width=10);whitespace.length<width;whitespace+=\" \");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize(\"\",(value={},value[\"\"]=source,value),callback,properties,whitespace,\"\",[])}}if(!has(\"json-parse\")){var fromCharCode=String.fromCharCode;var Unescapes={92:\"\\\\\",34:'\"',47:\"/\",98:\"\\b\",116:\"\t\",110:\"\\n\",102:\"\\f\",114:\"\\r\"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value=\"@\",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode(\"0x\"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)==\"true\"){Index+=4;return true}else if(source.slice(Index,Index+5)==\"false\"){Index+=5;return false}else if(source.slice(Index,Index+4)==\"null\"){Index+=4;return null}abort()}}return\"$\"};var get=function(value){var results,hasMembers;if(value==\"$\"){abort()}if(typeof value==\"string\"){if((charIndexBuggy?value.charAt(0):value[0])==\"@\"){return value.slice(1)}if(value==\"[\"){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"]\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"]\"){abort()}}else{abort()}}if(value==\",\"){abort()}results.push(get(value))}return results}else if(value==\"{\"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"}\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"}\"){abort()}}else{abort()}}if(value==\",\"||typeof value!=\"string\"||(charIndexBuggy?value.charAt(0):value[0])!=\"@\"||lex()!=\":\"){abort()}results[value.slice(1)]=get(lex())\n}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value==\"object\"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=\"\"+source;result=get(lex());if(lex()!=\"$\"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[\"\"]=result,value),\"\",callback):result}}}exports[\"runInContext\"]=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root[\"JSON3\"],isRestored=false;var JSON3=runInContext(root,root[\"JSON3\"]={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root[\"JSON3\"]=previousJSON;nativeJSON=previousJSON=null}return JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],51:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[31])(31)});\n\n    \n      ;var weight = document.getElementById('weight');\n      var socket = io('https://{{ip}}:5001');\n      socket.on('getWeight', function(msg) {\n        weight.innerHTML = msg;\n    \n      }); \n    }, 1000);\n    </script>\n\n  </body>\n</html>\n","x":470,"y":1280,"wires":[["1ad0219d.9d721e"]]},{"id":"1ad0219d.9d721e","type":"http response","z":"1124af78.b62db1","name":"","x":610,"y":1280,"wires":[]},{"id":"bb2d3e17.52544","type":"function","z":"1124af78.b62db1","name":"set ip","func":"msg.ip = global.get('ip');\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":1280,"wires":[["aa7b871f.fea7f8"]]},{"id":"a3fd68c4.b593a8","type":"http in","z":"1124af78.b62db1","name":"Serialgel_Weight","url":"/scale/f74f723a-8dd9-4e24-b200-be101fcd4875/getWeight","method":"get","swaggerDoc":"","x":120,"y":1020,"wires":[["1cab5bc4.3e0394","dfd9e092.1ad3b"]]},{"id":"2f5b2af8.777af6","type":"ui_chart","z":"1124af78.b62db1","name":"","group":"6d8579da.74a558","order":3,"width":"6","height":"6","label":"Праві","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-20","ymax":"70000","removeOlder":"10","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"x":149.3333740234375,"y":710.3333740234375,"wires":[[],[]]},{"id":"3fa5c15a.8a4ebe","type":"comment","z":"1124af78.b62db1","name":"Зважити у Апекс","info":"","x":120,"y":900,"wires":[]},{"id":"d19fbca4.6f28d","type":"trigger","z":"1124af78.b62db1","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","name":"","x":240,"y":280,"wires":[["adbc3716.dcdbf8"]]},{"id":"d540d677.207868","type":"switch","z":"1124af78.b62db1","name":"","property":"transactionHasOverLoad","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":590,"y":360,"wires":[["5acde8bc.ca3278"]]},{"id":"5acde8bc.ca3278","type":"function","z":"1124af78.b62db1","name":"over_load","func":"msg.event_id = flow.get('event_over_load');\nmsg.description = 'Можливий досип після зважування. Максимальная вага: ' + msg.metadata.transactionMaxWeight + \"кг. Облікова вага: \" + msg.metadata.transactionAccWeight + \"кг.\";\n\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":360,"wires":[["9cde22e2.88744"]]},{"id":"99fc5e2d.4852","type":"delay","z":"1124af78.b62db1","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":740,"y":820,"wires":[["9cde22e2.88744"]]},{"id":"fd8b707d.77c33","type":"delay","z":"1124af78.b62db1","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":740,"y":860,"wires":[["9cde22e2.88744"]]},{"id":"b2b501db.4ad23","type":"http in","z":"1124af78.b62db1","name":"","url":"/get2_2","method":"get","swaggerDoc":"","x":150,"y":1120,"wires":[["36723707.31f858"]]},{"id":"36723707.31f858","type":"function","z":"1124af78.b62db1","name":"response","func":"msg.payload = flow.get('transactionMetadata').weight;\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":1120,"wires":[["9321e830.3a1748"]]},{"id":"9321e830.3a1748","type":"http response","z":"1124af78.b62db1","name":"","x":590,"y":1120,"wires":[]},{"id":"8ae9f05f.ea12","type":"comment","z":"1124af78.b62db1","name":"Сокет","info":"","x":100,"y":1240,"wires":[]},{"id":"ff979dbc.851e4","type":"tcp out","z":"bd4c94f4.ece8e8","host":"10.107.5.177","port":"1886","beserver":"client","base64":false,"end":true,"name":"","x":380,"y":280,"wires":[]},{"id":"5a4deb27.6b4d44","type":"debug","z":"bd4c94f4.ece8e8","name":"","active":false,"console":"false","complete":"true","x":330,"y":240,"wires":[]},{"id":"abb5161d.32afd8","type":"inject","z":"bd4c94f4.ece8e8","name":"","topic":"","payload":"inputString","payloadType":"flow","repeat":"1","crontab":"","once":false,"x":120,"y":280,"wires":[["5a4deb27.6b4d44","ff979dbc.851e4"]]},{"id":"31586b32.4e3c04","type":"debug","z":"bd4c94f4.ece8e8","name":"","active":false,"console":"false","complete":"false","x":390,"y":480,"wires":[]},{"id":"d012e7c6.60da48","type":"tcp in","z":"bd4c94f4.ece8e8","name":"","server":"client","host":"10.107.5.177","port":"1886","datamode":"stream","datatype":"buffer","newline":"","topic":"","base64":false,"x":140,"y":440,"wires":[["31586b32.4e3c04","615bb570.072fdc"]]},{"id":"38d745b4.029c5a","type":"comment","z":"bd4c94f4.ece8e8","name":"info","info":"80 kg\n\n0: 240\n1: 13\n2: 80\n3: 0\n4: 0\n5: 0\n6: 1\n7: 0\n8: 0\n9: 240\n\n\n0 kg\n//\n0: 240\n1: 13\n2: 0\n3: 0\n4: 0\n5: 0\n6: 1\n7: 0\n8: 0\n9: 240","x":90,"y":200,"wires":[]},{"id":"23b17797.c59198","type":"function","z":"bd4c94f4.ece8e8","name":"GET WEIGHT","func":"var payload = msg.payload;\nvar parser = flow.get('parser');\nvar currentWeight = parser(payload);\n\nflow.set('currentWeight',currentWeight);\n\nmsg.payload = currentWeight;\nmsg.connect = 'yes'\nglobal.set('weight_3', currentWeight);\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":440,"wires":[["9b7d63c1.ba68f","1ab47ad5.2257e5","d617d387.efc1"]]},{"id":"44356ebf.626cd","type":"inject","z":"bd4c94f4.ece8e8","name":"init","topic":"","payload":"init","payloadType":"str","repeat":"","crontab":"","once":true,"x":90,"y":80,"wires":[["b7376480.0dd828"]]},{"id":"cce0c956.fce688","type":"comment","z":"bd4c94f4.ece8e8","name":"INITIALIZING","info":"","x":110,"y":40,"wires":[]},{"id":"b7376480.0dd828","type":"function","z":"bd4c94f4.ece8e8","name":"Модель весов","func":"flow.set('inputString', Buffer.from(\"0B0F010100000000\", \"hex\"));\nflow.set('parser',function(v){\n        \n        var lenV = v.length;\n        if(lenV == 10){\n            var weight = v.readInt32LE(2,5);\n            v = weight;\n            if(v < -80){\n                v = 0;\n            }   \n        } else {\n            v= 0;\n        }\n            return v; \n        }\n    );\nglobal.set('scale_id_in_3','2700ad23-4d08-467e-9c27-03579e63d7b5');\nglobal.set('ip','10.107.5.200');\nglobal.set('video_camera_url_1','');\n   \nreturn msg;","outputs":1,"noerr":0,"x":300.00000381469727,"y":79.42856788635254,"wires":[[]]},{"id":"9b7d63c1.ba68f","type":"link out","z":"bd4c94f4.ece8e8","name":"s3 Авто 3","links":["5148451b.ef15fc"],"x":715,"y":440,"wires":[]},{"id":"7b783a90.ae6df4","type":"comment","z":"bd4c94f4.ece8e8","name":"Отимання ваги","info":"","x":120,"y":400,"wires":[]},{"id":"1ab47ad5.2257e5","type":"debug","z":"bd4c94f4.ece8e8","name":"","active":false,"console":"false","complete":"payload","x":810,"y":480,"wires":[]},{"id":"da6a3f6d.e95b2","type":"file","z":"2b507412.efc2cc","name":"deivce_config_3.json","filename":"deivce_config_3.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":520,"y":180,"wires":[]},{"id":"71364748.a1ded8","type":"exec","z":"2b507412.efc2cc","command":"cat /proc/cpuinfo","addpay":true,"append":"| grep Serial","useSpawn":"","timer":"5","name":"","x":380,"y":60,"wires":[["d8d07777.1be888","adf7d830.96c878"],[],[]]},{"id":"f51168bc.a578e8","type":"function","z":"2b507412.efc2cc","name":"main config","func":"flow.set('prevWeight',null);\nflow.set('transaction',null);\nflow.set('transactionData',[]);\nflow.set('transactionMaxWeight',null);\nflow.set('transactionHasMinWeight',null);\nflow.set('transactionHasMaxWeight',null);\nflow.set('transactionHasMaxDuration',null);\nflow.set('lasttimedata', new Date());\nflow.set('checkHealth',null);\nflow.set('transactionWaybill',null);\nflow.set('transactionAccWeight', null);\nflow.set('transactionHasOverLoad', null);\nflow.set('transactionOperationName', null);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":450,"y":280,"wires":[[]]},{"id":"738db9ef.e21aa8","type":"inject","z":"2b507412.efc2cc","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":110,"y":240,"wires":[["573be997.db4f48","bc4bbae5.2e8f08"]]},{"id":"bb6d347c.27dfb8","type":"http in","z":"2b507412.efc2cc","name":"","url":"/firmware","method":"post","swaggerDoc":"","x":180,"y":180,"wires":[["da6a3f6d.e95b2"]]},{"id":"eaf8f8d.901cf08","type":"file in","z":"2b507412.efc2cc","name":"deivce_config_3.json","filename":"deivce_config_3.json","format":"utf8","x":480,"y":240,"wires":[["6fd58b38.68e314"]]},{"id":"6d0595b2.21e3ac","type":"http in","z":"2b507412.efc2cc","name":"","url":"/serial","method":"get","swaggerDoc":"","x":160,"y":60,"wires":[["71364748.a1ded8"]]},{"id":"d8d07777.1be888","type":"http response","z":"2b507412.efc2cc","name":"","x":610,"y":40,"wires":[]},{"id":"adf7d830.96c878","type":"function","z":"2b507412.efc2cc","name":"","func":"msg.payload = msg.payload.split(':')[1].replace('\\n','').replace(' ','');\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":80,"wires":[[]]},{"id":"9efd2dd8.16732","type":"inject","z":"2b507412.efc2cc","name":"DEMO","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":136,"y":132.57142639160156,"wires":[["6ac480b4.32156"]]},{"id":"6ac480b4.32156","type":"function","z":"2b507412.efc2cc","name":"DEMO Data","func":"var device_config = {\n    'event_move_in_id':'80096D9ABE7F68F3E0533300000A6C0D',\n    'event_move_in_minus_id':'8DB9B239DF5252F0E055000000000001',\n    'event_move_out_id':'80096D9ABE8068F3E0533300000A6C0D',\n    'event_max_weight_id':'85A255F950F9BEF4E0533300000AC45D',\n    'event_on_id': '85A2CC45702A2DD1E0533300000A0C94',\n    'event_off_id':'85A2CC4570292DD1E0533300000A0C94',\n    'event_max_duration':'8642EE858DE89BAAE0533300000AFCC7',\n    'event_fake_traffic':'80096EF60C186574E0533300000ADBA5',\n    'event_get_weight_acc':'800970AC1FDC683CE0533300000AF1B0',\n    'event_min_weight':'875C3EB5C9DD092DE055000000000001',\n    'event_driver_in':'8E68D8D8B2977181E055000000000001',\n    'event_over_load':'B3EB5F800EFD2620E0530101007F8A05',\n    'snapshot_events':['80096D9ABE7F68F3E0533300000A6C0D', '85A255F950F9BEF4E0533300000AC45D','8642EE858DE89BAAE0533300000AFCC7','800970AC1FDC683CE0533300000AF1B0', \"B3EB5F800EFD2620E0530101007F8A05\"],\n    'main_host':'https://10.107.5.200:8443/ords/ettn',\n    'event_url':'/iot_cli/events/log',\n    'state_url':'/iot_cli/device',\n    'snapshot_url':'/iot_cli/events/snapshot',\n    'maxWeight':60000,\n    'maxDuration':600000,\n    'minWeight':-40,\n    'checkHealthTimeout':3000,\n    'minTriggerWeight':40,\n    'driverWeight':80,\n    'overLoadWeight': 200,\n    'stableDiff': 60\n}\nmsg.payload = device_config;\n// flow.set('scale_id','80096CB0EFD83B63E0533300000A4334');\n// flow.set('event_move_in_id','80096D9ABE7F68F3E0533300000A6C0D');\n// flow.set('event_move_out_id','80096D9ABE8068F3E0533300000A6C0D');\n// flow.set('event_max_weight_id','85A255F950F9BEF4E0533300000AC45D');\n// flow.set('event_off_id','85A2CC4570292DD1E0533300000A0C94');\n// flow.set('event_on_id', '85A2CC45702A2DD1E0533300000A0C94');\n// flow.set('event_max_duration','8642EE858DE89BAAE0533300000AFCC7');\n// flow.set('main_host','http://prod.apex.rest/ords/ettn');\n// flow.set('event_url','/iot_cli/events/log');\n// flow.set('state_url','/v1/device');\n// flow.set('maxWeight',40000);\n// flow.set('maxDuration',20000);\n// flow.set('checkHealthTimeout',3000);\nreturn msg;","outputs":1,"noerr":0,"x":315.0000228881836,"y":133.00000190734863,"wires":[["da6a3f6d.e95b2"]]},{"id":"6fd58b38.68e314","type":"function","z":"2b507412.efc2cc","name":"device config","func":"var device_config = JSON.parse(msg.payload);\n\nflow.set('scale_id',device_config.scale_id);\nflow.set('event_move_in_id',device_config.event_move_in_id);\nflow.set('event_move_in_minus_id',device_config.event_move_in_minus_id);\nflow.set('event_move_out_id',device_config.event_move_out_id);\nflow.set('event_max_weight_id',device_config.event_max_weight_id);\nflow.set('event_off_id',device_config.event_off_id);\nflow.set('event_on_id', device_config.event_on_id);\nflow.set('event_max_duration',device_config.event_max_duration);\nflow.set('event_fake_traffic',device_config.event_fake_traffic);\nflow.set('event_driver_in', device_config.event_driver_in);\nflow.set('event_over_load',device_config.event_over_load);\nflow.set('main_host',device_config.main_host);\nflow.set('event_url',device_config.event_url);\nflow.set('state_url',device_config.state_url);\nflow.set('maxWeight',device_config.maxWeight);\nflow.set('minWeight',device_config.minWeight);\nflow.set('maxDuration',device_config.maxDuration);\nflow.set('checkHealthTimeout',device_config.checkHealthTimeout);\nflow.set('event_get_weight_acc',device_config.event_get_weight_acc);\nflow.set('event_min_weight',device_config.event_min_weight);\nflow.set('minTriggerWeight',device_config.minTriggerWeight);\nflow.set('snapshot_url',device_config.snapshot_url);\nflow.set('snapshot_events',device_config.snapshot_events);\nflow.set('driverWeight',device_config.driverWeight);\nflow.set('overLoadWeight', device_config.overLoadWeight);\nflow.set('stableDiff', device_config.stableDiff);\n\n\nmsg.payload = {\n\tscale_id: flow.get('scale_id'),\n\tevent_move_in_id: flow.get('event_move_in_id'),\n\tevent_move_in_minus_id: flow.get('event_move_in_minus_id'),\n\tevent_move_out_id: flow.get('event_move_out_id'),\n\tevent_max_weight_id: flow.get('event_max_weight_id'),\n\tevent_off_id: flow.get('event_off_id'),\n\tevent_on_id: flow.get('event_on_id'),\n\tevent_max_duration: flow.get('event_max_duration'),\n\tevent_fake_traffic: flow.get('event_fake_traffic'),\n\tevent_driver_in: flow.get('event_driver_in'),\n\tevent_over_load: flow.get('event_over_load'),\n\tmain_host: flow.get('main_host'),\n\tevent_url: flow.get('event_url'),\n\tstate_url: flow.get('state_url'),\n\tmaxWeight: flow.get('maxWeight'),\n\tminWeight: flow.get('minWeight'),\n\tmaxDuration: flow.get('maxDuration'),\n\tcheckHealthTimeout: flow.get('checkHealthTimeout'),\n\tevent_get_weight_acc: flow.get('event_get_weight_acc'),\n\tevent_min_weight: flow.get('event_min_weight'),\n\tminTriggerWeight: flow.get('minTriggerWeight'),\n\tsnapshot_url: flow.get('snapshot_url'),\n\tsnapshot_events: flow.get('snapshot_events'),\n\tdriverWeight: flow.get('driverWeight'),\n\toverLoadWeight: flow.get('overLoadWeight'),\n\tstableDiff: flow.get('stableDiff')\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":670,"y":240,"wires":[["8ac08d20.18478","a3aaa6c1.2eb108"]]},{"id":"8ac08d20.18478","type":"json","z":"2b507412.efc2cc","name":"","x":830,"y":240,"wires":[["54735d63.77e064"]]},{"id":"54735d63.77e064","type":"debug","z":"2b507412.efc2cc","name":"IN device config","active":false,"console":"false","complete":"true","x":980,"y":240,"wires":[]},{"id":"50de751d.8ab5dc","type":"function","z":"2b507412.efc2cc","name":"transactionHasMaxWeight","func":"msg.event_id = flow.get('event_max_weight_id');\nmsg.description = 'Перевищена максимально-допустима вага, кг: ' + msg.metadata.weight;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":580,"wires":[["a4271f9d.79882"]]},{"id":"3a77887e.7accf8","type":"switch","z":"2b507412.efc2cc","name":"switch max weight","property":"transactionHasMaxWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":442.6666259765625,"y":584.6666374206543,"wires":[["50de751d.8ab5dc"]]},{"id":"a4271f9d.79882","type":"function","z":"2b507412.efc2cc","name":"events payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in_3');\nvar snapshot_events = flow.get('snapshot_events');\nvar snapshot = false;\n\nif (snapshot_events.indexOf(event_id)>=0){\n    snapshot = true;\n}\n\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'devices':[{'id':scale_id}],\n    'data':msg.metadata,\n    'description':msg.description\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('event_url');\nmsg.main_host = flow.get('main_host');\nmsg.event_url = flow.get('event_url');\nmsg.snapshot = snapshot;\nreturn msg;","outputs":1,"noerr":0,"x":1009.6666870117188,"y":548.0951538085938,"wires":[["1385f94d.2d6d47","3e73f8f4.e831a8"]]},{"id":"dd497686.561348","type":"function","z":"2b507412.efc2cc","name":"main module","func":"var prevWeight = flow.get('prevWeight');\nvar transaction = flow.get('transaction');\nvar transactionData = flow.get('transactionData');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar transactionHasMaxWeight = flow.get('transactionHasMaxWeight');\nvar transactionHasMinWeight = flow.get('transactionHasMinWeight');\nvar transactionHasMaxDuration = flow.get('transactionHasMaxDuration');\nvar transactionOperationName = flow.get('transactionOperationName');\nvar stableDiff = flow.get('stableDiff');//дельта стабільності\nvar waybill = flow.get('transactionWaybill');\nvar weight = msg.payload;\nvar stableSize = 5;\nvar duration = 0;\nvar operation_name_income = \"Приход (авто)\";\nvar maxWeight = flow.get('maxWeight');\nvar maxDuration = flow.get('maxDuration');\nvar prevTransaction = transaction;\nvar minWeight = flow.get('minWeight');\nvar minTriggerWeight = flow.get('minTriggerWeight');\nvar is_minus = false;\nvar transactionAccWeight = flow.get('transactionAccWeight');//облікова вага\nvar overLoadWeight = flow.get('overLoadWeight');\n\n//transaction\nif (prevWeight === null){\n    prevWeight = msg.payload;    \n}else{\n    if((prevWeight <= 0) && (weight > 0) && (weight > minTriggerWeight)){\n        //start of transaction\n        transaction = Date.now();\n        msg.on = true;\n        flow.set('transaction',transaction);\n    }else if((prevWeight > 0) && (weight <=0) && (transaction)){\n        //transaction = 0;\n        msg.on = false;\n        transactionData = [];\n        flow.set('transaction',0);\n        flow.set('transactionMaxWeight',null);\n        flow.set('transactionHasMaxWeight',null);\n        flow.set('transactionHasMinWeight',null);\n        flow.set('transactionHasMaxDuration',null);\n        flow.set('transactionHasOverLoad',null);\n        flow.set('transactionOperationName',null);\n        flow.set('transactionWaybill',null);\n        flow.set('transactionMetadata',null);\n        flow.set('transactionAccWeight', null);//облікова вага\n    }else if((transaction === null) && (weight>0) && (weight > minTriggerWeight)){\n        transaction = Date.now();\n        flow.set('transaction',transaction);\n    }\n    if((prevWeight < 0) && ((weight-prevWeight) > minTriggerWeight)){\n        //start of transaction\n        is_minus = true;\n        msg.prevWeight = prevWeight;\n    }\n}\n\nmsg.stable = true;\n\nif (transaction > 0){\n    transactionData.push(weight);    \n\n    //stable\n    if(transactionData.length > stableSize+1){\n        var stabletmp = true;\n        for (var i = transactionData.length-1; i > transactionData.length-1-stableSize; i--){\n            if ((transactionData[i] - transactionData[i-1]) > stableDiff || (transactionData[i] - transactionData[i-1]) < -stableDiff){\n                stabletmp = false;\n                msg.stable = stabletmp;\n                break;\n            }\n            msg.stable = stabletmp;\n        }\n    }else{\n        msg.stable = false;\n    }\n\n    //duration & transactionMaxWeight\n    duration = (Number(Date.now()) - Number(transaction));\n    if( (weight>transactionMaxWeight) || (transactionMaxWeight === null)){\n        transactionMaxWeight = weight;\n        flow.set(\"transactionMaxWeight\",transactionMaxWeight);\n    }\n    \n    if(!transactionHasMaxWeight && weight > maxWeight){\n        msg.transactionHasMaxWeight = true;\n        flow.set('transactionHasMaxWeight',true);\n    }\n    \n    if(!transactionHasMinWeight && weight < minWeight){\n        msg.transactionHasMinWeight = true;\n        flow.set('transactionHasMinWeight',true);\n    }\n    \n    //max duartion\n    if(!transactionHasMaxDuration && duration > maxDuration){\n        msg.transactionHasMaxDuration = true;\n        flow.set('transactionHasMaxDuration',true);\n    }\n}\n\n//result\nmsg.metadata = {\n    'weight':weight,\n    'prevWeight':prevWeight,\n    'prevTransaction':prevTransaction,\n    'transaction':transaction,\n    'on':msg.on,\n    'transactionDataCount':transactionData.length,\n    'stable':msg.stable,\n    'duration':Math.round(duration/1000),\n    'transactionMaxWeight':transactionMaxWeight,\n    'transactionAccWeight':transactionAccWeight,\n    'waybill':waybill,\n    'perimetr':true,\n    'weight1':msg.weight1,\n    'weight2':msg.weight2,\n    'weight_center':msg.weight_center,\n    'driverInCar':false,\n    'transactionOperationName':transactionOperationName\n}\nflow.set('transactionData',transactionData);\nflow.set('prevWeight',weight);\nflow.set('transactionMetadata',msg.metadata);\nflow.set('lasttimedata', new Date());\nmsg.is_minus = is_minus;\n\nif(transactionAccWeight && transactionOperationName!==operation_name_income){\n    \n   flow.set('transactionHasOverLoad',(weight-transactionAccWeight)>overLoadWeight);\n   \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":560,"wires":[["318dd198.a2353e","3a77887e.7accf8","1840e8f1.f25737","63f07c95.16b1a4","5b831241.0bf4ac","cd47e21d.6b9c3"]]},{"id":"56906460.a5d31c","type":"function","z":"2b507412.efc2cc","name":"get weight from accounting system","func":"var transactionMetadata = flow.get('transactionMetadata');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar driverWeight = flow.get('driverWeight');\nvar buisness_data = msg.req.query;\n\nmsg.metadata = Object.assign(transactionMetadata,buisness_data);\n\n//check driver in a car\nvar driver_in = false;\nmsg.driverWeight = driverWeight;\nif((transactionMaxWeight - msg.metadata.weight) < driverWeight){\n    driver_in = true;\n}\n\nmsg.event_id = flow.get('event_get_weight_acc');\ntransactionWaybill = flow.get('transactionWaybill');\nif (!transactionWaybill){\n    flow.set('transactionWaybill',msg.req.query.waybill);\n}\nmsg.description = ' '+buisness_data.operation_name+'. '+buisness_data.operation_type+'. Зважили в 1С. Поточна вага: ' + msg.metadata.weight+\" Номер авто: \"+buisness_data.truck1+\" \"+buisness_data.truck2+\" \"+buisness_data.item_name + \", ТТН: \" + buisness_data.waybill;\nmsg.transactionMetadata = transactionMetadata;\nmsg.driver_in = driver_in;\n\nflow.set('transactionAccWeight',  msg.metadata.weight);//облікова вага\nflow.set('transactionOperationName',  msg.metadata.operation_name);//вид операції\n\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":940,"wires":[["7297c496.56d50c","a4271f9d.79882"]]},{"id":"1385f94d.2d6d47","type":"http request","z":"2b507412.efc2cc","name":"EVENTS","method":"POST","ret":"txt","url":"","tls":"f436a52.4d81958","x":1220,"y":540,"wires":[["8b96aa18.9a4488"]]},{"id":"f0ff8345.dd508","type":"function","z":"2b507412.efc2cc","name":"move in","func":"msg.event_id = flow.get('event_move_in_id');\nmsg.description = 'Заїзд на ваги. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":500,"wires":[["a4271f9d.79882"]]},{"id":"7c462b7e.043a44","type":"function","z":"2b507412.efc2cc","name":"off","func":"msg.event_id = flow.get('event_off_id');\nmsg.description = 'Прилад відключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\nreturn msg;","outputs":1,"noerr":0,"x":580.6666259765625,"y":797.6666259765625,"wires":[["52d042d6.8dcb0c"]]},{"id":"6f2cddc7.bb3a94","type":"function","z":"2b507412.efc2cc","name":"on","func":"msg.event_id = flow.get('event_on_id');\nmsg.description = 'Прилад підключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":578.6666259765625,"y":756.6666259765625,"wires":[["fdb4354d.715708"]]},{"id":"7765229.31e41dc","type":"function","z":"2b507412.efc2cc","name":"move out","func":"msg.event_id = flow.get('event_move_out_id');\nmsg.description = 'Зїзд з ваг. Максимальна вага: ' + msg.metadata.transactionMaxWeight;\nmsg.transactionMaxWeight = msg.metadata.transactionMaxWeight;\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":540,"wires":[["a4271f9d.79882","3b551ea4.e46842","661faf2a.d1eae"]]},{"id":"992b1fe3.4a1d2","type":"function","z":"2b507412.efc2cc","name":"transaction has max duration","func":"msg.event_id = flow.get('event_max_duration');\nmsg.description = 'Перевищено максимальний час находження на вагах, сек: ' + msg.metadata.duration;\n\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":620,"wires":[["a4271f9d.79882"]]},{"id":"cde6d8a7.a9cde8","type":"function","z":"2b507412.efc2cc","name":"empty waybill","func":"msg.event_id = flow.get('event_fake_traffic');\nmsg.description = 'Холостий проїзд по вагам. Тривалість проїзду ' + Math.round(msg.metadata.duration/60)+ 'хв.' + \" Максимальна вага: \" + msg.metadata.transactionMaxWeight + \" кг.\";\n\nreturn msg;","outputs":1,"noerr":0,"x":792.6666259765625,"y":464.6666374206543,"wires":[["a4271f9d.79882"]]},{"id":"77c40c46.9bfe94","type":"function","z":"2b507412.efc2cc","name":"transactionHasMinWeight","func":"msg.event_id = flow.get('event_min_weight');\nmsg.description = 'Перевищена мінімально-допустима вага, кг: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":660,"wires":[["a4271f9d.79882"]]},{"id":"ab2c0822.71d788","type":"function","z":"2b507412.efc2cc","name":"move in minus","func":"msg.event_id = flow.get('event_move_in_minus_id');\nmsg.description = 'Заїзд із мінусом. ' + msg.prevWeight +' кг.';\n\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":420,"wires":[["a4271f9d.79882"]]},{"id":"5148451b.ef15fc","type":"link in","z":"2b507412.efc2cc","name":"s4 Авто 3","links":["9b7d63c1.ba68f"],"x":57.6666259765625,"y":564.6666259765625,"wires":[["f0bf14b1.d43b78","3abf4945.fe4726","ee30071b.bc27f8","dd497686.561348","4ee89bcf.d942e4"]]},{"id":"318dd198.a2353e","type":"switch","z":"2b507412.efc2cc","name":"switch move","property":"on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":424.6666259765625,"y":547.6666259765625,"wires":[["f0ff8345.dd508"],["7765229.31e41dc","fa1eb0ab.b6c4e","9e97bb47.653d98"]]},{"id":"1840e8f1.f25737","type":"switch","z":"2b507412.efc2cc","name":"max duration","property":"transactionHasMaxDuration","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":422.6666259765625,"y":624.6666374206543,"wires":[["992b1fe3.4a1d2"]]},{"id":"63f07c95.16b1a4","type":"switch","z":"2b507412.efc2cc","name":"switch min weight","property":"transactionHasMinWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":442.6666259765625,"y":664.6666374206543,"wires":[["77c40c46.9bfe94"]]},{"id":"5b831241.0bf4ac","type":"switch","z":"2b507412.efc2cc","name":"switch minus in","property":"is_minus","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":420,"y":420,"wires":[["ab2c0822.71d788"]]},{"id":"7297c496.56d50c","type":"switch","z":"2b507412.efc2cc","name":"","property":"driver_in","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":844.6666259765625,"y":925.6666259765625,"wires":[["de84bfa.597f54"]]},{"id":"e93d2780.6a8e58","type":"http in","z":"2b507412.efc2cc","name":"","url":"/getWeight3","method":"get","swaggerDoc":"","x":180,"y":940,"wires":[["f1f4cbb.6a5cf38","56906460.a5d31c","bec97204.66147"]]},{"id":"de84bfa.597f54","type":"function","z":"2b507412.efc2cc","name":"driver_in event","func":"msg.event_id = flow.get('event_driver_in');\nmsg.description = 'При зважуванні водій в кабіні. Вага: ' + msg.metadata.weight+\"кг. Номер авто: \"+msg.metadata.truck1+\" \"+msg.metadata.truck2+\" \"+msg.metadata.item_name;\n\nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":920,"wires":[["a4271f9d.79882"]]},{"id":"52438d45.0b0734","type":"switch","z":"2b507412.efc2cc","name":"","property":"checkHealth","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":430,"y":780,"wires":[["6f2cddc7.bb3a94"],["7c462b7e.043a44"]]},{"id":"fa1eb0ab.b6c4e","type":"switch","z":"2b507412.efc2cc","name":"waybill","property":"metadata.waybill","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","outputs":1,"x":610,"y":460,"wires":[["cde6d8a7.a9cde8"]]},{"id":"f0bf14b1.d43b78","type":"socket-io-out","z":"2b507412.efc2cc","name":"socket 5002","event":"d0426e92.cf1a2","server":"c1ce8631.e64978","x":190,"y":640,"wires":[]},{"id":"3abf4945.fe4726","type":"ui_text","z":"2b507412.efc2cc","group":"7f9670a2.ed156","order":0,"width":0,"height":0,"name":"","label":"Поточна вага 2 склад:","format":"{{msg.payload}}","layout":"row-spread","x":219,"y":674.0000114440918,"wires":[]},{"id":"f1f4cbb.6a5cf38","type":"function","z":"2b507412.efc2cc","name":"response","func":"msg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nif(transactionWaybill && transactionWaybill !== msg.req.query.waybill){\n    msg.payload.status = false;    \n}else {\n    msg.payload.status = true;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":1020,"wires":[["fe495507.a75df8"]]},{"id":"b4b78e5.fe44c7","type":"function","z":"2b507412.efc2cc","name":"check scale health","func":"var lastcheckHealth = flow.get('checkHealth');\nvar checkHealth = null;\nvar lasttimedata = flow.get('lasttimedata');\n\nvar currenttimedata = new Date();\n\nif ((currenttimedata - lasttimedata) > 20000){\n    checkHealth = false;\n} else {\n    checkHealth = true;\n}\n\nflow.set(\"checkHealth\",checkHealth);\n\nif (lastcheckHealth != checkHealth){\n    msg.checkHealth = checkHealth;\n}else{\n    msg.checkHealth = null;\n}\nmsg.payload = checkHealth;\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":840,"wires":[["52438d45.0b0734"]]},{"id":"fe495507.a75df8","type":"http response","z":"2b507412.efc2cc","name":"","x":650,"y":1020,"wires":[]},{"id":"4d9bf171.e5b06","type":"inject","z":"2b507412.efc2cc","name":"","topic":"","payload":"","payloadType":"date","repeat":"6","crontab":"","once":false,"x":130,"y":780,"wires":[["b4b78e5.fe44c7"]]},{"id":"3061d508.35ef3a","type":"http in","z":"2b507412.efc2cc","name":"","url":"/getSimpleWeight_3","method":"get","swaggerDoc":"","x":210,"y":1180,"wires":[["d54e0f51.92dd9"]]},{"id":"d54e0f51.92dd9","type":"function","z":"2b507412.efc2cc","name":"response","func":"msg.payload = flow.get('transactionMetadata').weight;\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":1180,"wires":[["55ade961.aed538"]]},{"id":"55ade961.aed538","type":"http response","z":"2b507412.efc2cc","name":"","x":610,"y":1180,"wires":[]},{"id":"87d41a0e.e7a498","type":"http in","z":"2b507412.efc2cc","name":"","url":"/socket_3","method":"get","swaggerDoc":"","x":170,"y":1280,"wires":[["98b8742f.2a66c8"]]},{"id":"e6557868.736eb8","type":"template","z":"2b507412.efc2cc","name":"socket page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n     \n  <body>\n    <h1><p id='weight'></p></h1>\n    \n     <script>\n    setTimeout(function() {\n       ;(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.io=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_(\"./lib/\")},{\"./lib/\":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_(\"./socket\");module.exports.parser=_dereq_(\"engine.io-parser\")},{\"./socket\":3,\"engine.io-parser\":19}],3:[function(_dereq_,module,exports){(function(global){var transports=_dereq_(\"./transports\");var Emitter=_dereq_(\"component-emitter\");var debug=_dereq_(\"debug\")(\"engine.io-client:socket\");var index=_dereq_(\"indexof\");var parser=_dereq_(\"engine.io-parser\");var parseuri=_dereq_(\"parseuri\");var parsejson=_dereq_(\"parsejson\");var parseqs=_dereq_(\"parseqs\");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&\"object\"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==\"https\"||uri.protocol==\"wss\";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&\"https:\"==location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?\"443\":\"80\"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:\"localhost\");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if(\"string\"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||\"t\";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||[\"polling\",\"websocket\"];this.readyState=\"\";this.writeBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?null:opts.rejectUnauthorized;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}}this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_(\"./transport\");Socket.transports=_dereq_(\"./transports\");Socket.parser=_dereq_(\"engine.io-parser\");Socket.prototype.createTransport=function(name){debug('creating transport \"%s\"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf(\"websocket\")!=-1){transport=\"websocket\"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit(\"error\",\"No transports available\")},0);return}else{transport=this.transports[0]}this.readyState=\"opening\";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug(\"setting transport %s\",transport.name);var self=this;if(this.transport){debug(\"clearing existing transport %s\",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on(\"drain\",function(){self.onDrain()}).on(\"packet\",function(packet){self.onPacket(packet)}).on(\"error\",function(e){self.onError(e)}).on(\"close\",function(){self.onClose(\"transport close\")})};Socket.prototype.probe=function(name){debug('probing transport \"%s\"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport \"%s\" opened',name);transport.send([{type:\"ping\",data:\"probe\"}]);transport.once(\"packet\",function(msg){if(failed)return;if(\"pong\"==msg.type&&\"probe\"==msg.data){debug('probe transport \"%s\" pong',name);self.upgrading=true;self.emit(\"upgrading\",transport);if(!transport)return;Socket.priorWebsocketSuccess=\"websocket\"==transport.name;debug('pausing current transport \"%s\"',self.transport.name);self.transport.pause(function(){if(failed)return;if(\"closed\"==self.readyState)return;debug(\"changing transport and sending upgrade packet\");cleanup();self.setTransport(transport);transport.send([{type:\"upgrade\"}]);self.emit(\"upgrade\",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport \"%s\" failed',name);var err=new Error(\"probe error\");err.transport=transport.name;self.emit(\"upgradeError\",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error(\"probe error: \"+err);error.transport=transport.name;freezeTransport();debug('probe transport \"%s\" failed because of error: %s',name,err);self.emit(\"upgradeError\",error)}function onTransportClose(){onerror(\"transport closed\")}function onclose(){onerror(\"socket closed\")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('\"%s\" works - aborting \"%s\"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener(\"open\",onTransportOpen);transport.removeListener(\"error\",onerror);transport.removeListener(\"close\",onTransportClose);self.removeListener(\"close\",onclose);self.removeListener(\"upgrading\",onupgrade)}transport.once(\"open\",onTransportOpen);transport.once(\"error\",onerror);transport.once(\"close\",onTransportClose);this.once(\"close\",onclose);this.once(\"upgrading\",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug(\"socket open\");this.readyState=\"open\";Socket.priorWebsocketSuccess=\"websocket\"==this.transport.name;this.emit(\"open\");this.flush();if(\"open\"==this.readyState&&this.upgrade&&this.transport.pause){debug(\"starting upgrade probes\");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if(\"opening\"==this.readyState||\"open\"==this.readyState){debug('socket receive: type \"%s\", data \"%s\"',packet.type,packet.data);this.emit(\"packet\",packet);this.emit(\"heartbeat\");switch(packet.type){case\"open\":this.onHandshake(parsejson(packet.data));break;case\"pong\":this.setPing();this.emit(\"pong\");break;case\"error\":var err=new Error(\"server error\");err.code=packet.data;this.onError(err);break;case\"message\":this.emit(\"data\",packet.data);this.emit(\"message\",packet.data);break}}else{debug('packet received with socket readyState \"%s\"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit(\"handshake\",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if(\"closed\"==this.readyState)return;this.setPing();this.removeListener(\"heartbeat\",this.onHeartbeat);this.on(\"heartbeat\",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if(\"closed\"==self.readyState)return;self.onClose(\"ping timeout\")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug(\"writing ping packet - expecting pong within %sms\",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket(\"ping\",function(){self.emit(\"ping\")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit(\"drain\")}else{this.flush()}};Socket.prototype.flush=function(){if(\"closed\"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug(\"flushing %d packets in socket\",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit(\"flush\")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket(\"message\",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if(\"function\"==typeof data){fn=data;data=undefined}if(\"function\"==typeof options){fn=options;options=null}if(\"closing\"==this.readyState||\"closed\"==this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit(\"packetCreate\",packet);this.writeBuffer.push(packet);if(fn)this.once(\"flush\",fn);this.flush()};Socket.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.readyState=\"closing\";var self=this;if(this.writeBuffer.length){this.once(\"drain\",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose(\"forced close\");debug(\"socket closing - telling transport to close\");self.transport.close()}function cleanupAndClose(){self.removeListener(\"upgrade\",cleanupAndClose);self.removeListener(\"upgradeError\",cleanupAndClose);close()}function waitForUpgrade(){self.once(\"upgrade\",cleanupAndClose);self.once(\"upgradeError\",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug(\"socket error %j\",err);Socket.priorWebsocketSuccess=false;this.emit(\"error\",err);this.onClose(\"transport error\",err)};Socket.prototype.onClose=function(reason,desc){if(\"opening\"==this.readyState||\"open\"==this.readyState||\"closing\"==this.readyState){debug('socket close with reason: \"%s\"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners(\"close\");this.transport.close();this.transport.removeAllListeners();this.readyState=\"closed\";this.id=null;this.emit(\"close\",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./transport\":4,\"./transports\":5,\"component-emitter\":15,debug:17,\"engine.io-parser\":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(_dereq_,module,exports){var parser=_dereq_(\"engine.io-parser\");var Emitter=_dereq_(\"component-emitter\");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState=\"\";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type=\"TransportError\";err.description=desc;this.emit(\"error\",err);return this};Transport.prototype.open=function(){if(\"closed\"==this.readyState||\"\"==this.readyState){this.readyState=\"opening\";this.doOpen()}return this};Transport.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if(\"open\"==this.readyState){this.write(packets)}else{throw new Error(\"Transport not open\")}};Transport.prototype.onOpen=function(){this.readyState=\"open\";this.writable=true;this.emit(\"open\")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit(\"packet\",packet)};Transport.prototype.onClose=function(){this.readyState=\"closed\";this.emit(\"close\")}},{\"component-emitter\":15,\"engine.io-parser\":19}],5:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var XHR=_dereq_(\"./polling-xhr\");var JSONP=_dereq_(\"./polling-jsonp\");var websocket=_dereq_(\"./websocket\");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if(\"open\"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error(\"JSONP disabled\");return new JSONP(opts)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling-jsonp\":6,\"./polling-xhr\":7,\"./websocket\":9,\"xmlhttprequest-ssl\":10}],6:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_(\"./polling\");var inherit=_dereq_(\"component-inherit\");module.exports=JSONPPolling;var rNewline=/\\n/g;var rEscapedNewline=/\\\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener(\"beforeunload\",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement(\"script\");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError(\"jsonp poll error\",e)};var insertAt=document.getElementsByTagName(\"script\")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko=\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement(\"iframe\");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement(\"form\");var area=document.createElement(\"textarea\");var id=this.iframeId=\"eio_iframe_\"+this.index;var iframe;form.className=\"socketio\";form.style.position=\"absolute\";form.style.top=\"-1000px\";form.style.left=\"-1000px\";form.target=id;form.method=\"POST\";form.setAttribute(\"accept-charset\",\"utf-8\");area.name=\"d\";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError(\"jsonp polling iframe removal error\",e)}}try{var html='<iframe src=\"javascript:0\" name=\"'+self.iframeId+'\">';iframe=document.createElement(html)}catch(e){iframe=document.createElement(\"iframe\");iframe.name=self.iframeId;iframe.src=\"javascript:0\"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,\"\\\\\\n\");this.area.value=data.replace(rNewline,\"\\\\n\");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==\"complete\"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-inherit\":16}],7:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var Polling=_dereq_(\"./polling\");var Emitter=_dereq_(\"component-emitter\");var inherit=_dereq_(\"component-inherit\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling-xhr\");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}else{this.extraHeaders=opts.extraHeaders}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!==\"string\"&&data!==undefined;var req=this.request({method:\"POST\",data:data,isBinary:isBinary});var self=this;req.on(\"success\",fn);req.on(\"error\",function(err){self.onError(\"xhr post error\",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug(\"xhr poll\");var req=this.request();var self=this;req.on(\"data\",function(data){self.onData(data)});req.on(\"error\",function(err){self.onError(\"xhr poll error\",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||\"GET\";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug(\"xhr open %s: %s\",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){xhr.responseType=\"arraybuffer\"}if(\"POST\"==this.method){try{if(this.isBinary){xhr.setRequestHeader(\"Content-type\",\"application/octet-stream\")}else{xhr.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}}catch(e){}}if(\"withCredentials\"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug(\"xhr data %s\",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit(\"success\");this.cleanup()};Request.prototype.onData=function(data){this.emit(\"data\",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit(\"error\",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if(\"undefined\"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader(\"Content-Type\").split(\";\")[0]}catch(e){}if(contentType===\"application/octet-stream\"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var ui8Arr=new Uint8Array(this.xhr.response);var dataArray=[];for(var idx=0,length=ui8Arr.length;idx<length;idx++){dataArray.push(ui8Arr[idx])}data=String.fromCharCode.apply(null,dataArray)}}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return\"undefined\"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent(\"onunload\",unloadHandler)}else if(global.addEventListener){global.addEventListener(\"beforeunload\",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-emitter\":15,\"component-inherit\":16,debug:17,\"xmlhttprequest-ssl\":10}],8:[function(_dereq_,module,exports){var Transport=_dereq_(\"../transport\");var parseqs=_dereq_(\"parseqs\");var parser=_dereq_(\"engine.io-parser\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling\");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name=\"polling\";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState=\"pausing\";function pause(){debug(\"paused\");self.readyState=\"paused\";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug(\"we are currently polling - waiting to pause\");total++;this.once(\"pollComplete\",function(){debug(\"pre-pause polling complete\");--total||pause()})}if(!this.writable){debug(\"we are currently writing - waiting to pause\");total++;this.once(\"drain\",function(){debug(\"pre-pause writing complete\");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug(\"polling\");this.polling=true;this.doPoll();this.emit(\"poll\")};Polling.prototype.onData=function(data){var self=this;debug(\"polling got data %s\",data);var callback=function(packet,index,total){if(\"opening\"==self.readyState){self.onOpen()}if(\"close\"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if(\"closed\"!=this.readyState){this.polling=false;this.emit(\"pollComplete\");if(\"open\"==this.readyState){this.poll()}else{debug('ignoring poll - transport state \"%s\"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug(\"writing close packet\");self.write([{type:\"close\"}])}if(\"open\"==this.readyState){debug(\"transport open - closing\");close()}else{debug(\"transport not open - deferring close\");this.once(\"open\",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit(\"drain\")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"https\":\"http\";var port=\"\";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&(\"https\"==schema&&this.port!=443||\"http\"==schema&&this.port!=80)){port=\":\"+this.port}if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query}},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,\"xmlhttprequest-ssl\":10,yeast:30}],9:[function(_dereq_,module,exports){(function(global){var Transport=_dereq_(\"../transport\");var parser=_dereq_(\"engine.io-parser\");var parseqs=_dereq_(\"parseqs\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:websocket\");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window===\"undefined\"){try{WebSocket=_dereq_(\"ws\")}catch(e){}}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name=\"websocket\";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}this.ws=BrowserWebSocket?new WebSocket(uri):new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType=\"buffer\"}else{this.ws.binaryType=\"arraybuffer\"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError(\"websocket error\",e)}};if(\"undefined\"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!BrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len=\"string\"==typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(BrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug(\"websocket closed before onclose event\")}--total||done()})})(packets[i])}function done(){self.emit(\"flush\");setTimeout(function(){self.writable=true;self.emit(\"drain\")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!==\"undefined\"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"wss\":\"ws\";var port=\"\";if(this.port&&(\"wss\"==schema&&this.port!=443||\"ws\"==schema&&this.port!=80)){port=\":\"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!(\"__initialize\"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,ws:undefined,yeast:30}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_(\"has-cors\");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if(\"undefined\"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(e){}}}},{\"has-cors\":22}],11:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error(\"after called too many times\")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],12:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],13:[function(_dereq_,module,exports){(function(chars){\"use strict\";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64=\"\";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];\nbase64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+\"=\"}else if(len%3===1){base64=base64.substring(0,base64.length-2)+\"==\"}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]===\"=\"){bufferLength--;if(base64[base64.length-2]===\"=\"){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\")},{}],14:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob([\"hi\"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],15:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],16:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],17:[function(_dereq_,module,exports){exports=module.exports=_dereq_(\"./debug\");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=\"undefined\"!=typeof chrome&&\"undefined\"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"];function useColors(){return\"WebkitAppearance\"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?\"%c\":\"\")+this.namespace+(useColors?\" %c\":\" \")+args[0]+(useColors?\"%c \":\" \")+\"+\"+exports.humanize(this.diff);if(!useColors)return args;var c=\"color: \"+this.color;args=[args[0],c,\"color: inherit\"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if(\"%%\"===match)return;index++;if(\"%c\"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return\"object\"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem(\"debug\")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{\"./debug\":18}],18:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_(\"ms\");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if(\"string\"!==typeof args[0]){args=[\"%o\"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match===\"%%\")return match;index++;var formatter=exports.formatters[format];if(\"function\"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if(\"function\"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||\"\").split(/[\\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\\*/g,\".*?\");if(namespaces[0]===\"-\"){exports.skips.push(new RegExp(\"^\"+namespaces.substr(1)+\"$\"))}else{exports.names.push(new RegExp(\"^\"+namespaces+\"$\"))}}}function disable(){exports.enable(\"\")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:25}],19:[function(_dereq_,module,exports){(function(global){var keys=_dereq_(\"./keys\");var hasBinary=_dereq_(\"has-binary\");var sliceBuffer=_dereq_(\"arraybuffer.slice\");var base64encoder=_dereq_(\"base64-arraybuffer\");var after=_dereq_(\"after\");var utf8=_dereq_(\"utf8\");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:\"error\",data:\"parser error\"};var Blob=_dereq_(\"blob\");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if(\"function\"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if(\"function\"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(\"\"+encoded)};function encodeBase64Object(packet,callback){var message=\"b\"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message=\"b\"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(\",\")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data==\"string\"||data===undefined){if(data.charAt(0)==\"b\"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType===\"blob\"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType===\"blob\"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary==\"function\"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback(\"0:\")}function setLengthHeader(message){return message.length+\":\"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(\"\"))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!=\"string\"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var packet;if(data==\"\"){return callback(err,0,1)}var length=\"\",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(\":\"!=chr){length+=chr}else{if(\"\"==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=\"\"}}if(length!=\"\"){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p===\"string\"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p===\"string\";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded===\"string\"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength=\"\";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg=\"\";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./keys\":20,after:11,\"arraybuffer.slice\":12,\"base64-arraybuffer\":13,blob:14,\"has-binary\":21,utf8:29}],20:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],21:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:24}],22:[function(_dereq_,module,exports){try{module.exports=typeof XMLHttpRequest!==\"undefined\"&&\"withCredentials\"in new XMLHttpRequest}catch(err){module.exports=false}},{}],23:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],24:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)==\"[object Array]\"}},{}],25:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if(\"string\"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=\"\"+str;if(str.length>1e4)return;var match=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||\"ms\").toLowerCase();switch(type){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return n*y;case\"days\":case\"day\":case\"d\":return n*d;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return n*h;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return n*m;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return n*s;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+\"d\";if(ms>=h)return Math.round(ms/h)+\"h\";if(ms>=m)return Math.round(ms/m)+\"m\";if(ms>=s)return Math.round(ms/s)+\"s\";return ms+\"ms\"}function long(ms){return plural(ms,d,\"day\")||plural(ms,h,\"hour\")||plural(ms,m,\"minute\")||plural(ms,s,\"second\")||ms+\" ms\"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+\" \"+name;return Math.ceil(ms/n)+\" \"+name+\"s\"}},{}],26:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\\],:{}\\s]*$/;var rvalidescape=/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\\s*\\[)+/g;var rtrimLeft=/^\\s+/;var rtrimRight=/\\s+$/;module.exports=function parsejson(data){if(\"string\"!=typeof data||!data){return null}data=data.replace(rtrimLeft,\"\").replace(rtrimRight,\"\");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,\"@\").replace(rvalidtokens,\"]\").replace(rvalidbraces,\"\"))){return new Function(\"return \"+data)()}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],27:[function(_dereq_,module,exports){exports.encode=function(obj){var str=\"\";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+=\"&\";str+=encodeURIComponent(i)+\"=\"+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split(\"&\");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split(\"=\");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],28:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;var parts=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];module.exports=function parseuri(str){var src=str,b=str.indexOf(\"[\"),e=str.indexOf(\"]\");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,\";\")+str.substring(e,str.length)}var m=re.exec(str||\"\"),uri={},i=14;while(i--){uri[parts[i]]=m[i]||\"\"}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,\":\");uri.authority=uri.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\");uri.ipv6uri=true}return uri}},{}],29:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports==\"object\"&&exports;var freeModule=typeof module==\"object\"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output=\"\";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error(\"Lone surrogate U+\"+codePoint.toString(16).toUpperCase()+\" is not a scalar value\")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol=\"\";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString=\"\";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error(\"Invalid byte index\")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error(\"Invalid continuation byte\")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error(\"Invalid byte index\")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error(\"Invalid UTF-8 detected\")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:\"2.0.0\",encode:utf8encode,decode:utf8decode};if(typeof define==\"function\"&&typeof define.amd==\"object\"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],30:[function(_dereq_,module,exports){\"use strict\";var alphabet=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded=\"\";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+\".\"+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],31:[function(_dereq_,module,exports){var url=_dereq_(\"./url\");var parser=_dereq_(\"socket.io-parser\");var Manager=_dereq_(\"./manager\");var debug=_dereq_(\"debug\")(\"socket.io-client\");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==\"object\"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts[\"force new connection\"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug(\"ignoring socket cache for %s\",source);io=Manager(source,opts)}else{if(!cache[id]){debug(\"new io instance for %s\",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_(\"./manager\");exports.Socket=_dereq_(\"./socket\")},{\"./manager\":32,\"./socket\":34,\"./url\":35,debug:39,\"socket.io-parser\":47}],32:[function(_dereq_,module,exports){var eio=_dereq_(\"engine.io-client\");var Socket=_dereq_(\"./socket\");var Emitter=_dereq_(\"component-emitter\");var parser=_dereq_(\"socket.io-parser\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:manager\");var indexOf=_dereq_(\"indexof\");var Backoff=_dereq_(\"backo2\");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&\"object\"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||\"/socket.io\";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState=\"closed\";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.engine.id}}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug(\"readyState %s\",this.readyState);if(~this.readyState.indexOf(\"open\"))return this;debug(\"opening %s\",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState=\"opening\";this.skipReconnect=false;var openSub=on(socket,\"open\",function(){self.onopen();fn&&fn()});var errorSub=on(socket,\"error\",function(data){debug(\"connect_error\");self.cleanup();self.readyState=\"closed\";self.emitAll(\"connect_error\",data);if(fn){var err=new Error(\"Connection error\");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug(\"connect attempt will timeout after %d\",timeout);var timer=setTimeout(function(){debug(\"connect attempt timed out after %d\",timeout);openSub.destroy();socket.close();socket.emit(\"error\",\"timeout\");self.emitAll(\"connect_timeout\",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug(\"open\");this.cleanup();this.readyState=\"open\";this.emit(\"open\");var socket=this.engine;this.subs.push(on(socket,\"data\",bind(this,\"ondata\")));this.subs.push(on(socket,\"ping\",bind(this,\"onping\")));this.subs.push(on(socket,\"pong\",bind(this,\"onpong\")));this.subs.push(on(socket,\"error\",bind(this,\"onerror\")));this.subs.push(on(socket,\"close\",bind(this,\"onclose\")));this.subs.push(on(this.decoder,\"decoded\",bind(this,\"ondecoded\")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll(\"ping\")};Manager.prototype.onpong=function(){this.emitAll(\"pong\",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit(\"packet\",packet)};Manager.prototype.onerror=function(err){debug(\"error\",err);this.emitAll(\"error\",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on(\"connecting\",onConnecting);\nsocket.on(\"connect\",function(){socket.id=self.engine.id});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug(\"writing packet %j\",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug(\"cleanup\");var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug(\"disconnect\");this.skipReconnect=true;this.reconnecting=false;if(\"opening\"==this.readyState){this.cleanup()}this.backoff.reset();this.readyState=\"closed\";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug(\"onclose\");this.cleanup();this.backoff.reset();this.readyState=\"closed\";this.emit(\"close\",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug(\"reconnect failed\");this.backoff.reset();this.emitAll(\"reconnect_failed\");this.reconnecting=false}else{var delay=this.backoff.duration();debug(\"will wait %dms before reconnect attempt\",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug(\"attempting reconnect\");self.emitAll(\"reconnect_attempt\",self.backoff.attempts);self.emitAll(\"reconnecting\",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug(\"reconnect attempt error\");self.reconnecting=false;self.reconnect();self.emitAll(\"reconnect_error\",err.data)}else{debug(\"reconnect success\");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll(\"reconnect\",attempt)}},{\"./on\":33,\"./socket\":34,backo2:36,\"component-bind\":37,\"component-emitter\":38,debug:39,\"engine.io-client\":1,indexof:42,\"socket.io-parser\":47}],33:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],34:[function(_dereq_,module,exports){var parser=_dereq_(\"socket.io-parser\");var Emitter=_dereq_(\"component-emitter\");var toArray=_dereq_(\"to-array\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:socket\");var hasBin=_dereq_(\"has-binary\");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,\"open\",bind(this,\"onopen\")),on(io,\"packet\",bind(this,\"onpacket\")),on(io,\"close\",bind(this,\"onclose\"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if(\"open\"==this.io.readyState)this.onopen();this.emit(\"connecting\");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift(\"message\");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if(\"function\"==typeof args[args.length-1]){debug(\"emitting packet with ack id %d\",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug(\"transport is open - connecting\");if(\"/\"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug(\"close (%s)\",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit(\"disconnect\",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit(\"error\",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug(\"emitting event %j\",args);if(null!=packet.id){debug(\"attaching ack callback to event\");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug(\"sending ack %j\",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if(\"function\"==typeof ack){debug(\"calling ack %s with %j\",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug(\"bad ack %s\",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit(\"connect\");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug(\"server disconnect (%s)\",this.nsp);this.destroy();this.onclose(\"io server disconnect\")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug(\"performing disconnect (%s)\",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose(\"io client disconnect\")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{\"./on\":33,\"component-bind\":37,\"component-emitter\":38,debug:39,\"has-binary\":41,\"socket.io-parser\":47,\"to-array\":51}],35:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_(\"parseuri\");var debug=_dereq_(\"debug\")(\"socket.io-client:url\");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+\"//\"+loc.host;if(\"string\"==typeof uri){if(\"/\"==uri.charAt(0)){if(\"/\"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\\/\\//.test(uri)){debug(\"protocol-less url %s\",uri);if(\"undefined\"!=typeof loc){uri=loc.protocol+\"//\"+uri}else{uri=\"https://\"+uri}}debug(\"parse %s\",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port=\"80\"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port=\"443\"}}obj.path=obj.path||\"/\";var ipv6=obj.host.indexOf(\":\")!==-1;var host=ipv6?\"[\"+obj.host+\"]\":obj.host;obj.id=obj.protocol+\"://\"+host+\":\"+obj.port;obj.href=obj.protocol+\"://\"+host+(loc&&loc.port==obj.port?\"\":\":\"+obj.port);return obj}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{debug:39,parseuri:45}],36:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],37:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if(\"string\"==typeof fn)fn=obj[fn];if(\"function\"!=typeof fn)throw new Error(\"bind() requires a function\");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],38:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[\"$\"+event]=this._callbacks[\"$\"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[\"$\"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[\"$\"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[\"$\"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[\"$\"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],39:[function(_dereq_,module,exports){arguments[4][17][0].apply(exports,arguments)},{\"./debug\":40,dup:17}],40:[function(_dereq_,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:44}],41:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON&&\"function\"==typeof obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:43}],42:[function(_dereq_,module,exports){arguments[4][23][0].apply(exports,arguments)},{dup:23}],43:[function(_dereq_,module,exports){arguments[4][24][0].apply(exports,arguments)},{dup:24}],44:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],45:[function(_dereq_,module,exports){arguments[4][28][0].apply(exports,arguments)},{dup:28}],46:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");var isBuf=_dereq_(\"./is-buffer\");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if(\"object\"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&\"object\"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&\"object\"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./is-buffer\":48,isarray:43}],47:[function(_dereq_,module,exports){var debug=_dereq_(\"debug\")(\"socket.io-parser\");var json=_dereq_(\"json3\");var isArray=_dereq_(\"isarray\");var Emitter=_dereq_(\"component-emitter\");var binary=_dereq_(\"./binary\");var isBuf=_dereq_(\"./is-buffer\");exports.protocol=4;exports.types=[\"CONNECT\",\"DISCONNECT\",\"EVENT\",\"BINARY_EVENT\",\"ACK\",\"BINARY_ACK\",\"ERROR\"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug(\"encoding packet %j\",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str=\"\";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+=\"-\"}if(obj.nsp&&\"/\"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=\",\";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=\",\";str+=json.stringify(obj.data)}debug(\"encoded %j as %s\",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if(\"string\"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit(\"decoded\",packet)}}else{this.emit(\"decoded\",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error(\"got binary data when not reconstructing a packet\")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit(\"decoded\",packet)}}}else{throw new Error(\"Unknown type: \"+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf=\"\";while(str.charAt(++i)!=\"-\"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!=\"-\"){throw new Error(\"Illegal attachments\")}p.attachments=Number(buf)}if(\"/\"==str.charAt(i+1)){p.nsp=\"\";while(++i){var c=str.charAt(i);if(\",\"==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp=\"/\"}var next=str.charAt(i+1);if(\"\"!==next&&Number(next)==next){p.id=\"\";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug(\"decoded %s as %j\",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:\"parser error\"}}},{\"./binary\":46,\"./is-buffer\":48,\"component-emitter\":49,debug:39,isarray:43,json3:50}],48:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],49:[function(_dereq_,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],50:[function(_dereq_,module,exports){(function(global){(function(){var isLoader=typeof define===\"function\"&&define.amd;var objectTypes={\"function\":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global==\"object\"&&global;if(freeGlobal&&(freeGlobal[\"global\"]===freeGlobal||freeGlobal[\"window\"]===freeGlobal||freeGlobal[\"self\"]===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root[\"Object\"]());exports||(exports=root[\"Object\"]());var Number=context[\"Number\"]||root[\"Number\"],String=context[\"String\"]||root[\"String\"],Object=context[\"Object\"]||root[\"Object\"],Date=context[\"Date\"]||root[\"Date\"],SyntaxError=context[\"SyntaxError\"]||root[\"SyntaxError\"],TypeError=context[\"TypeError\"]||root[\"TypeError\"],Math=context[\"Math\"]||root[\"Math\"],nativeJSON=context[\"JSON\"]||root[\"JSON\"];if(typeof nativeJSON==\"object\"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name==\"bug-string-char-index\"){isSupported=\"a\"[0]!=\"a\"}else if(name==\"json\"){isSupported=has(\"json-stringify\")&&has(\"json-parse\")}else{var value,serialized='{\"a\":[1,true,false,null,\"\\\\u0000\\\\b\\\\n\\\\f\\\\r\\\\t\"]}';if(name==\"json-stringify\"){var stringify=exports.stringify,stringifySupported=typeof stringify==\"function\"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)===\"0\"&&stringify(new Number)===\"0\"&&stringify(new String)=='\"\"'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)===\"1\"&&stringify([value])==\"[1]\"&&stringify([undef])==\"[null]\"&&stringify(null)==\"null\"&&stringify([undef,getClass,null])==\"[null,null,null]\"&&stringify({a:[value,true,false,null,\"\\x00\\b\\n\\f\\r\t\"]})==serialized&&stringify(null,value)===\"1\"&&stringify([1,2],null,1)==\"[\\n 1,\\n 2\\n]\"&&stringify(new Date(-864e13))=='\"-271821-04-20T00:00:00.000Z\"'&&stringify(new Date(864e13))=='\"+275760-09-13T00:00:00.000Z\"'&&stringify(new Date(-621987552e5))=='\"-000001-01-01T00:00:00.000Z\"'&&stringify(new Date(-1))=='\"1969-12-31T23:59:59.999Z\"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name==\"json-parse\"){var parse=exports.parse;if(typeof parse==\"function\"){try{if(parse(\"0\")===0&&!parse(false)){value=parse(serialized);var parseSupported=value[\"a\"].length==5&&value[\"a\"][0]===1;if(parseSupported){try{parseSupported=!parse('\"\t\"')}catch(exception){}if(parseSupported){try{parseSupported=parse(\"01\")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse(\"1.\")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has(\"json\")){var functionClass=\"[object Function]\",dateClass=\"[object Date]\",numberClass=\"[object Number]\",stringClass=\"[object String]\",arrayClass=\"[object Array]\",booleanClass=\"[object Boolean]\";var charIndexBuggy=has(\"bug-string-char-index\");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=[\"valueOf\",\"toString\",\"toLocaleString\",\"propertyIsEnumerable\",\"isPrototypeOf\",\"hasOwnProperty\",\"constructor\"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!=\"function\"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property==\"prototype\")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property==\"prototype\")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property==\"prototype\")&&isProperty.call(object,property)&&!(isConstructor=property===\"constructor\")){callback(property)}}if(isConstructor||isProperty.call(object,property=\"constructor\")){callback(property)}}}return forEach(object,callback)};if(!has(\"json-stringify\")){var Escapes={92:\"\\\\\\\\\",34:'\\\\\"',8:\"\\\\b\",12:\"\\\\f\",10:\"\\\\n\",13:\"\\\\r\",9:\"\\\\t\"};var leadingZeroes=\"000000\";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix=\"\\\\u00\";var quote=function(value){var result='\"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(\"\"):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'\"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value==\"object\"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,\"toJSON\")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?\"-\":\"+\")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+\"-\"+toPaddedString(2,month+1)+\"-\"+toPaddedString(2,date)+\"T\"+toPaddedString(2,hours)+\":\"+toPaddedString(2,minutes)+\":\"+toPaddedString(2,seconds)+\".\"+toPaddedString(3,milliseconds)+\"Z\"}else{value=null}}else if(typeof value.toJSON==\"function\"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,\"toJSON\"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return\"null\"}className=getClass.call(value);if(className==booleanClass){return\"\"+value}else if(className==numberClass){return value>-1/0&&value<1/0?\"\"+value:\"null\"}else if(className==stringClass){return quote(\"\"+value)}if(typeof value==\"object\"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?\"null\":element)}result=results.length?whitespace?\"[\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"]\":\"[\"+results.join(\",\")+\"]\":\"[]\"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+\":\"+(whitespace?\" \":\"\")+element)}});result=results.length?whitespace?\"{\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"}\":\"{\"+results.join(\",\")+\"}\":\"{}\"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace=\"\",width>10&&(width=10);whitespace.length<width;whitespace+=\" \");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize(\"\",(value={},value[\"\"]=source,value),callback,properties,whitespace,\"\",[])}}if(!has(\"json-parse\")){var fromCharCode=String.fromCharCode;var Unescapes={92:\"\\\\\",34:'\"',47:\"/\",98:\"\\b\",116:\"\t\",110:\"\\n\",102:\"\\f\",114:\"\\r\"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value=\"@\",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode(\"0x\"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)==\"true\"){Index+=4;return true}else if(source.slice(Index,Index+5)==\"false\"){Index+=5;return false}else if(source.slice(Index,Index+4)==\"null\"){Index+=4;return null}abort()}}return\"$\"};var get=function(value){var results,hasMembers;if(value==\"$\"){abort()}if(typeof value==\"string\"){if((charIndexBuggy?value.charAt(0):value[0])==\"@\"){return value.slice(1)}if(value==\"[\"){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"]\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"]\"){abort()}}else{abort()}}if(value==\",\"){abort()}results.push(get(value))}return results}else if(value==\"{\"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"}\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"}\"){abort()}}else{abort()}}if(value==\",\"||typeof value!=\"string\"||(charIndexBuggy?value.charAt(0):value[0])!=\"@\"||lex()!=\":\"){abort()}results[value.slice(1)]=get(lex())\n}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value==\"object\"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=\"\"+source;result=get(lex());if(lex()!=\"$\"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[\"\"]=result,value),\"\",callback):result}}}exports[\"runInContext\"]=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root[\"JSON3\"],isRestored=false;var JSON3=runInContext(root,root[\"JSON3\"]={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root[\"JSON3\"]=previousJSON;nativeJSON=previousJSON=null}return JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],51:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[31])(31)});\n\n    \n      ;var weight = document.getElementById('weight');\n      var socket = io('https://{{ip}}:5003');\n      socket.on('getWeight', function(msg) {\n        weight.innerHTML = msg;\n    \n      }); \n    }, 1000);\n    </script>\n\n  </body>\n</html>\n","x":490,"y":1280,"wires":[["698cc410.b1a04c"]]},{"id":"698cc410.b1a04c","type":"http response","z":"2b507412.efc2cc","name":"","x":630,"y":1280,"wires":[]},{"id":"98b8742f.2a66c8","type":"function","z":"2b507412.efc2cc","name":"set ip","func":"msg.ip = global.get('ip');\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":1280,"wires":[["e6557868.736eb8"]]},{"id":"48d88b01.386bb4","type":"http in","z":"2b507412.efc2cc","name":"Serialgel_Weight","url":"/scale/2700ad23-4d08-467e-9c27-03579e63d7b5/getWeight","method":"get","swaggerDoc":"","x":140,"y":1020,"wires":[["f1f4cbb.6a5cf38","56906460.a5d31c"]]},{"id":"ee30071b.bc27f8","type":"ui_chart","z":"2b507412.efc2cc","name":"","group":"6d8579da.74a558","order":4,"width":"6","height":"6","label":"chart","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-20","ymax":"70000","removeOlder":"10","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"x":169.3333740234375,"y":710.3333740234375,"wires":[[],[]]},{"id":"6a2da6e5.bba4c8","type":"comment","z":"2b507412.efc2cc","name":"Зважити у Апекс","info":"","x":140,"y":900,"wires":[]},{"id":"573be997.db4f48","type":"trigger","z":"2b507412.efc2cc","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","name":"","x":260,"y":280,"wires":[["f51168bc.a578e8"]]},{"id":"9e97bb47.653d98","type":"switch","z":"2b507412.efc2cc","name":"","property":"transactionHasOverLoad","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":610,"y":360,"wires":[["c5942618.aa8c48"]]},{"id":"c5942618.aa8c48","type":"function","z":"2b507412.efc2cc","name":"over_load","func":"msg.event_id = flow.get('event_over_load');\nmsg.description = 'Можливий досип після зважування. Максимальная вага: ' + msg.metadata.transactionMaxWeight + \"кг. Облікова вага: \" + msg.metadata.transactionAccWeight + \"кг.\";\n\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":360,"wires":[["a4271f9d.79882"]]},{"id":"fdb4354d.715708","type":"delay","z":"2b507412.efc2cc","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":781,"y":757,"wires":[["a4271f9d.79882"]]},{"id":"52d042d6.8dcb0c","type":"delay","z":"2b507412.efc2cc","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":780,"y":799,"wires":[["a4271f9d.79882"]]},{"id":"871c327.630e4d","type":"http in","z":"2b507412.efc2cc","name":"","url":"/get2_3","method":"get","swaggerDoc":"","x":170,"y":1120,"wires":[["7c079ed9.40261"]]},{"id":"7c079ed9.40261","type":"function","z":"2b507412.efc2cc","name":"response","func":"msg.payload = flow.get('transactionMetadata').weight;\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":1120,"wires":[["42f8346d.d9af2c"]]},{"id":"42f8346d.d9af2c","type":"http response","z":"2b507412.efc2cc","name":"","x":610,"y":1120,"wires":[]},{"id":"7b20408c.44ca6","type":"comment","z":"2b507412.efc2cc","name":"Сокет","info":"","x":120,"y":1240,"wires":[]},{"id":"bc4bbae5.2e8f08","type":"delay","z":"2b507412.efc2cc","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":260,"y":240,"wires":[["eaf8f8d.901cf08"]]},{"id":"38fe892.7f7fc76","type":"delay","z":"1124af78.b62db1","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":260,"y":240,"wires":[["4a9b3aea.421dc4"]]},{"id":"72dcf20d.05525c","type":"delay","z":"f93250c7.39091","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":280,"y":220,"wires":[["5bb8dba6.5822b4"]]},{"id":"dbf49459.0c9648","type":"comment","z":"87b488d6.5b73f8","name":"Лічильники без даних(Поломка)","info":"","x":790,"y":100,"wires":[]},{"id":"982c376e.7a01b8","type":"delay","z":"90f9c352.b35d1","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":140,"wires":[["63607440.7c01ac"]]},{"id":"9e1fdd73.679d8","type":"delay","z":"7719c21e.c9711c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":160,"wires":[["4ef0f546.73b65c"]]},{"id":"3ff9f806.70e128","type":"function","z":"71f38711.545228","name":"Для поосевого","func":"flow.set('cmd',\"ALL\\r\"); //текущая команда\n/*\nmsg.payload = \"VER\"  + String.fromCharCode(13)\nmsg.payload = \"VER\"  + String.fromCharCode(10)\nmsg.payload = \"ALL\"  + String.fromCharCode(10)\nmsg.payload = \"ALL\"  + String.fromCharCode(13)\n*/\n\n\nglobal.set('scale_id_jd_1','5088d2f7-709e-4b85-bf23-97b7bbfbd560');\nglobal.set('ip','10.107.5.200');\nglobal.set('video_camera_url','');\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":40,"wires":[["ff7bbeec.34fe6"]]},{"id":"d4eb608.6b491a","type":"inject","z":"71f38711.545228","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":130,"y":40,"wires":[["3ff9f806.70e128"]]},{"id":"842f716d.ac1cf","type":"debug","z":"71f38711.545228","name":"","active":false,"console":"false","complete":"false","x":630,"y":40,"wires":[]},{"id":"ff7bbeec.34fe6","type":"function","z":"71f38711.545228","name":"Общий","func":"var p = {\n    'smartScaleURL':'http://10.1.132.171/preBI/hs/api/v1/weights?token=5af8e4eb-c54a-40ab-8755-b6e154d9a7d1&encoding=utf8',\n    'smartScaleMethod':'POST',\n    'organizationName':'Рахни',\n    'organizationID':'04',\n    'typeOfScale':'IoT',\n    'source':'atom',\n    'scale':'jd1',\n    'dblogin':'atom2',\n    'dbpassword':'123',\n    'log':1,\n    'socketport':'5003',\n    'ip':'10.107.5.200',\n    'inject':\"W\",\n    'parser':function(v){\n          let w = 0;\n          let a1 = 0;\n          let a2 = 0;\n\n          w = Number(v.substring(3,10));\n          a1 = Number(v.substring(10,17));\n          a2 = Number(v.substring(17,24));\n          let с1 = a1 - a2;\n           \n          flow.set('w',w);\n          flow.set('a1',a1);\n          flow.set('a2',a2);\n          flow.set('c', с1);\n           \n           return w;\n        }\n};\nflow.set('p',p);","outputs":1,"noerr":0,"x":460,"y":40,"wires":[["842f716d.ac1cf"]]},{"id":"ca448802.052b18","type":"link in","z":"40a858ce.eb2118","name":"weight","links":["c0377ed3.f7381"],"x":35,"y":380,"wires":[["f727e911.493658","d806849d.726d28","49549487.057a1c"]]},{"id":"49549487.057a1c","type":"function","z":"40a858ce.eb2118","name":"main module","func":"var prevWeight = flow.get('prevWeight');\nvar transaction = flow.get('transaction');\nvar transactionData = flow.get('transactionData');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar transactionHasMaxWeight = flow.get('transactionHasMaxWeight');\nvar transactionHasMinWeight = flow.get('transactionHasMinWeight');\nvar transactionHasMaxDuration = flow.get('transactionHasMaxDuration');\nvar waybill = flow.get('transactionWaybill');\nvar weight = msg.payload;\nvar stableSize = 5;\nvar duration = 0;\nvar maxWeight = flow.get('maxWeight');\nvar maxDuration = flow.get('maxDuration');\nvar prevTransaction = transaction;\nvar minWeight = flow.get('minWeight');\nvar minTriggerWeight = flow.get('minTriggerWeight');\n\n//transaction\nif (prevWeight === null){\n    prevWeight = msg.payload;    \n}else{\n    if((prevWeight <= 0) && (weight > 0) && (weight > minTriggerWeight)){\n        //start of transaction\n        transaction = Date.now();\n        msg.on = true;\n        flow.set('transaction',transaction);\n    }else if((prevWeight > 0) && (weight <=0) && (transaction)){\n        //transaction = 0;\n        msg.on = false;\n        transactionData = [];\n        flow.set('transaction',0);\n        flow.set('transactionMaxWeight',null);\n        flow.set('transactionHasMaxWeight',null);\n        flow.set('transactionHasMinWeight',null);\n        flow.set('transactionHasMaxDuration',null);\n        flow.set('transactionWaybill',null);\n        flow.set('transactionMetadata',null);\n    }else if((transaction === null) && (weight>0) && (weight > minTriggerWeight)){\n        transaction = Date.now();\n        flow.set('transaction',transaction);\n    }\n}\n\nmsg.stable = true;\n\nif (transaction > 0){\n    transactionData.push(weight);    \n\n    //stable\n    if(transactionData.length > stableSize+1){\n        var stabletmp = true;\n        for (var i = transactionData.length-1; i > transactionData.length-1-stableSize; i--){\n            if (transactionData[i] !== transactionData[i-1]){\n                stabletmp = false;\n                msg.stable = stabletmp;\n                break;\n            }\n            msg.stable = stabletmp;\n        }\n    }else{\n        msg.stable = false;\n    }\n\n    //duration & transactionMaxWeight\n    duration = (Number(Date.now()) - Number(transaction));\n    if( (weight>transactionMaxWeight) || (transactionMaxWeight === null)){\n        transactionMaxWeight = weight;\n        flow.set(\"transactionMaxWeight\",transactionMaxWeight);\n    }\n    \n    if(!transactionHasMaxWeight && weight > maxWeight){\n        msg.transactionHasMaxWeight = true;\n        flow.set('transactionHasMaxWeight',true);\n    }\n    \n    if(!transactionHasMinWeight && weight < minWeight){\n        msg.transactionHasMinWeight = true;\n        flow.set('transactionHasMinWeight',true);\n    }\n    \n    //max duartion\n    if(!transactionHasMaxDuration && duration > maxDuration){\n        msg.transactionHasMaxDuration = true;\n        flow.set('transactionHasMaxDuration',true);\n    }\n}\n\n//result\nmsg.metadata = {\n    'weight':weight,\n    'prevWeight':prevWeight,\n    'prevTransaction':prevTransaction,\n    'transaction':transaction,\n    'on':msg.on,\n    'transactionDataCount':transactionData.length,\n    'stable':msg.stable,\n    'duration':Math.round(duration/1000),\n    'transactionMaxWeight':transactionMaxWeight,\n    'waybill':waybill,\n    'perimetr':true,\n    'weight1':msg.weight1,\n    'weight2':msg.weight2,\n    'weight_center':msg.weight_center\n}\nflow.set('transactionData',transactionData);\nflow.set('prevWeight',weight);\nflow.set('transactionMetadata',msg.metadata);\nflow.set('lasttimedata', new Date());\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":380,"wires":[["76947b03.3c83e4","63c7c6dd.331a58","69d0e19c.70385","97e9056e.a27bb8","ca6d9134.09692"]]},{"id":"be99187b.53f1a8","type":"function","z":"40a858ce.eb2118","name":"get weight from accounting system","func":"var transactionMetadata = flow.get('transactionMetadata');\nvar buisness_data = msg.req.query;\nmsg.metadata = Object.assign(transactionMetadata,buisness_data);\nmsg.event_id = flow.get('event_get_weight_acc');\ntransactionWaybill = flow.get('transactionWaybill');\nif (!transactionWaybill){\n    flow.set('transactionWaybill',msg.req.query.reader);\n}\nmsg.description = buisness_data.operation_name+'. Зважили в 1С. Поточна вага: ' + msg.metadata.weight+\" Номер вагону: \"+buisness_data.truck1+\" \"+buisness_data.item_name;\nmsg.transactionMetadata = transactionMetadata;\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":720,"wires":[["bc009e.4b835f6"]]},{"id":"76947b03.3c83e4","type":"switch","z":"40a858ce.eb2118","name":"switch move","property":"on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":370,"y":360,"wires":[["3c23a8f6.f5af78"],["87f7ab3e.f633b8","80319a10.c1e7f8"]]},{"id":"31af19f4.128e06","type":"http request","z":"40a858ce.eb2118","name":"EVENTS","method":"POST","ret":"txt","url":"","tls":"d8337a69.ecb378","x":1151.25,"y":350,"wires":[["5f056af4.846244","726144a7.717ddc"]]},{"id":"3c23a8f6.f5af78","type":"function","z":"40a858ce.eb2118","name":"move in","func":"msg.event_id = flow.get('event_move_in_id');\nmsg.description = 'Заїзд на ваги. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":320,"wires":[["bc009e.4b835f6"]]},{"id":"63c7c6dd.331a58","type":"switch","z":"40a858ce.eb2118","name":"switch max weight","property":"transactionHasMaxWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":390,"y":400,"wires":[["9f8cd181.3193b"]]},{"id":"9f8cd181.3193b","type":"function","z":"40a858ce.eb2118","name":"transactionHasMaxWeight","func":"msg.event_id = flow.get('event_max_weight_id');\nmsg.description = 'Перевищена максимально-допустима вага: ' + msg.metadata.weight;\nmsg.needSnapshot = true;\n\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":400,"wires":[["bc009e.4b835f6"]]},{"id":"214ec5ba.ea0afa","type":"inject","z":"40a858ce.eb2118","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":110,"y":620,"wires":[["6b66fbab.ddfaf4"]]},{"id":"6b66fbab.ddfaf4","type":"function","z":"40a858ce.eb2118","name":"check scale health","func":"var lastcheckHealth = flow.get('checkHealth');\nvar checkHealth = null;\nvar lasttimedata = flow.get('lasttimedata');\n\nvar currenttimedata = new Date();\n\nif ((currenttimedata - lasttimedata) > 20000){\n    checkHealth = false;\n} else {\n    checkHealth = true;\n}\n\nflow.set(\"checkHealth\",checkHealth);\n\nif (lastcheckHealth != checkHealth){\n    msg.checkHealth = checkHealth;\n}else{\n    msg.checkHealth = null;\n}\nmsg.payload = checkHealth;\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":620,"wires":[["ed81740e.fdff88"]]},{"id":"ed81740e.fdff88","type":"switch","z":"40a858ce.eb2118","name":"","property":"checkHealth","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":470,"y":620,"wires":[["c539de0f.76d28"],["2f26cd6c.38fa12"]]},{"id":"2f26cd6c.38fa12","type":"function","z":"40a858ce.eb2118","name":"off","func":"msg.event_id = flow.get('event_off_id');\nmsg.description = 'Прилад відключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":620,"wires":[["bc009e.4b835f6"]]},{"id":"c539de0f.76d28","type":"function","z":"40a858ce.eb2118","name":"on","func":"msg.event_id = flow.get('event_on_id');\nmsg.description = 'Прилад підключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":580,"wires":[["bc009e.4b835f6"]]},{"id":"51e59d78.a410b4","type":"function","z":"40a858ce.eb2118","name":"main config","func":"flow.set('prevWeight',null);\nflow.set('transaction',null);\nflow.set('transactionData',[]);\nflow.set('transactionMaxWeight',null);\nflow.set('transactionHasMinWeight',null);\nflow.set('transactionHasMaxWeight',null);\nflow.set('transactionHasMaxDuration',null);\nflow.set('lasttimedata', new Date());\nflow.set('checkHealth',null);\nflow.set('transactionWaybill',null);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":510,"y":220,"wires":[[]]},{"id":"1b99871f.6f82a9","type":"inject","z":"40a858ce.eb2118","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":90,"y":180,"wires":[["2e113aba.7a39c6","5f3bbdf7.3eba64"]]},{"id":"87f7ab3e.f633b8","type":"function","z":"40a858ce.eb2118","name":"move out","func":"msg.event_id = flow.get('event_move_out_id');\nmsg.description = 'Зїзд з ваг. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":360,"wires":[[]]},{"id":"69d0e19c.70385","type":"switch","z":"40a858ce.eb2118","name":"max duration","property":"transactionHasMaxDuration","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":370,"y":440,"wires":[["3d269ba6.c62574"]]},{"id":"3d269ba6.c62574","type":"function","z":"40a858ce.eb2118","name":"transaction has max duration","func":"msg.event_id = flow.get('event_max_duration');\nmsg.description = 'Перевищено максимальний час находження на вагах: ' + msg.metadata.duration/1000;\n\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":440,"wires":[["bc009e.4b835f6"]]},{"id":"b670b3c5.57566","type":"http in","z":"40a858ce.eb2118","name":"","url":"/firmware","method":"post","swaggerDoc":"","x":140,"y":140,"wires":[["32224773.b632d8"]]},{"id":"32224773.b632d8","type":"file","z":"40a858ce.eb2118","name":"deivce_config_jd_1.json","filename":"deivce_config_jd_1.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":610,"y":100,"wires":[]},{"id":"7152d3ea.8f781c","type":"file in","z":"40a858ce.eb2118","name":"deivce_config_jd_1.json","filename":"deivce_config_jd_1.json","format":"utf8","x":550,"y":180,"wires":[["35de5b92.574694"]]},{"id":"88c82f97.e86d2","type":"http in","z":"40a858ce.eb2118","name":"","url":"/serial","method":"get","swaggerDoc":"","x":120,"y":40,"wires":[["e04b5e33.c371e"]]},{"id":"e04b5e33.c371e","type":"exec","z":"40a858ce.eb2118","command":"cat /proc/cpuinfo","addpay":true,"append":"| grep Serial","useSpawn":"","timer":"5","name":"","x":350,"y":40,"wires":[["cc45dd49.c0eb4","8ba0bb4f.d0bb48"],[],[]]},{"id":"cc45dd49.c0eb4","type":"http response","z":"40a858ce.eb2118","name":"","x":550,"y":20,"wires":[]},{"id":"8ba0bb4f.d0bb48","type":"function","z":"40a858ce.eb2118","name":"","func":"msg.payload = msg.payload.split(':')[1].replace('\\n','').replace(' ','');\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":60,"wires":[["81cb118c.dadda"]]},{"id":"81cb118c.dadda","type":"debug","z":"40a858ce.eb2118","name":"","active":false,"console":"false","complete":"false","x":690,"y":60,"wires":[]},{"id":"b0c216.b62abde8","type":"inject","z":"40a858ce.eb2118","name":"DEMO","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":100,"y":100,"wires":[["7f373bfd.1a1a74"]]},{"id":"7f373bfd.1a1a74","type":"function","z":"40a858ce.eb2118","name":"DEMO Data","func":"var device_config = {\n    'event_move_in_id':'80096D9ABE7F68F3E0533300000A6C0D',\n    'event_move_out_id':'80096D9ABE8068F3E0533300000A6C0D',\n    'event_max_weight_id':'85A255F950F9BEF4E0533300000AC45D',\n    'event_off_id':'85A2CC4570292DD1E0533300000A0C94',\n    'event_on_id': '85A2CC45702A2DD1E0533300000A0C94',\n    'event_max_duration':'8642EE858DE89BAAE0533300000AFCC7',\n    'event_fake_traffic':'80096EF60C186574E0533300000ADBA5',\n    'event_get_weight_acc':'800970AC1FDC683CE0533300000AF1B0',\n    'event_min_weight':'875C3EB5C9DD092DE055000000000001',\n    'event_test_connection':'925791CDC4E619BDE055000000000001',\n    'main_host':'https://10.107.5.200:8443/ords/ettn',\n    'camera_url':'',\n    'event_url':'/iot_cli/events/log',\n    'snapshot_events':['80096D9ABE7F68F3E0533300000A6C0D','85A255F950F9BEF4E0533300000AC45D','8642EE858DE89BAAE0533300000AFCC7','800970AC1FDC683CE0533300000AF1B0'],\n    'state_url':'/iot_cli/device',\n    'snapshot_url':'/iot_cli/events/snapshot',\n    'maxWeight':90000,\n    'maxDuration':1200000,\n    'minWeight':0,\n    'checkHealthTimeout':3000,\n    'minTriggerWeight':200\n}\nmsg.payload = device_config;\n// flow.set('scale_id','80096CB0EFD83B63E0533300000A4334');\n// flow.set('event_move_in_id','80096D9ABE7F68F3E0533300000A6C0D');\n// flow.set('event_move_out_id','80096D9ABE8068F3E0533300000A6C0D');\n// flow.set('event_max_weight_id','85A255F950F9BEF4E0533300000AC45D');\n// flow.set('event_off_id','85A2CC4570292DD1E0533300000A0C94');\n// flow.set('event_on_id', '85A2CC45702A2DD1E0533300000A0C94');\n// flow.set('event_max_duration','8642EE858DE89BAAE0533300000AFCC7');\n// flow.set('main_host','http://prod.apex.rest/ords/ettn');\n// flow.set('event_url','/iot_cli/events/log');\n// flow.set('state_url','/v1/device');\n// flow.set('maxWeight',40000);\n// flow.set('maxDuration',20000);\n// flow.set('checkHealthTimeout',3000);\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":100,"wires":[["32224773.b632d8"]]},{"id":"f727e911.493658","type":"debug","z":"40a858ce.eb2118","name":"JD 1","active":false,"console":"false","complete":"true","x":150,"y":340,"wires":[]},{"id":"80319a10.c1e7f8","type":"switch","z":"40a858ce.eb2118","name":"waybill","property":"metadata.waybill","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","outputs":1,"x":580,"y":280,"wires":[["3065b28f.b78e8e"]]},{"id":"3065b28f.b78e8e","type":"function","z":"40a858ce.eb2118","name":"move in","func":"msg.event_id = flow.get('event_fake_traffic');\nmsg.description = 'Холостий проїзд по вагам. Тривалість проїзду ' + msg.metadata.duration;\n\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":280,"wires":[["a209de25.19535"]]},{"id":"a209de25.19535","type":"debug","z":"40a858ce.eb2118","name":"","active":false,"console":"false","complete":"false","x":930,"y":280,"wires":[]},{"id":"6fb827fc.384c68","type":"http in","z":"40a858ce.eb2118","name":"","url":"/getWeightjd1","method":"get","swaggerDoc":"","x":170,"y":720,"wires":[["be99187b.53f1a8","59521dca.c2d604","d8be6f28.936b2","4432e0f3.3574e"]]},{"id":"d3e4703c.d7f9d","type":"http response","z":"40a858ce.eb2118","name":"","x":670,"y":760,"wires":[]},{"id":"59521dca.c2d604","type":"function","z":"40a858ce.eb2118","name":"response","func":"msg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nif(transactionWaybill && transactionWaybill !== msg.req.query.waybill){\n    msg.payload.status = false;    \n}else {\n    msg.payload.status = true;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":760,"wires":[["d3e4703c.d7f9d"]]},{"id":"5f056af4.846244","type":"debug","z":"40a858ce.eb2118","name":"","active":false,"console":"false","complete":"true","x":1330,"y":360,"wires":[]},{"id":"97e9056e.a27bb8","type":"switch","z":"40a858ce.eb2118","name":"switch min weight","property":"transactionHasMinWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":390,"y":480,"wires":[["6013d952.9f9158"]]},{"id":"6013d952.9f9158","type":"function","z":"40a858ce.eb2118","name":"transactionHasMinWeight","func":"msg.event_id = flow.get('event_min_weight');\nmsg.description = 'Перевищена мінімально-допустима вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":480,"wires":[["bc009e.4b835f6"]]},{"id":"50033f6a.84a87","type":"socket-io-out","z":"40a858ce.eb2118","name":"socket 5003","event":"d0426e92.cf1a2","server":"faa64350.c8cc7","x":330,"y":520,"wires":[]},{"id":"249f7441.776d0c","type":"http in","z":"40a858ce.eb2118","name":"","url":"/getSimpleWeightjd1","method":"get","swaggerDoc":"","x":190,"y":820,"wires":[["826257ee.79eaa8"]]},{"id":"826257ee.79eaa8","type":"function","z":"40a858ce.eb2118","name":"response","func":"msg.payload = flow.get('transactionMetadata').weight;\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":820,"wires":[["a9f2a61e.75bb28"]]},{"id":"a9f2a61e.75bb28","type":"http response","z":"40a858ce.eb2118","name":"","x":670,"y":820,"wires":[]},{"id":"4855c4c8.41ebdc","type":"http in","z":"40a858ce.eb2118","name":"","url":"/socket_jd_1","method":"get","swaggerDoc":"","x":160,"y":940,"wires":[["ec511ee9.a2ee4"]]},{"id":"bd755ab9.e71be8","type":"template","z":"40a858ce.eb2118","name":"socket page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n     \n  <body>\n    <h1><p id='weight'></p></h1>\n    \n     <script>\n    setTimeout(function() {\n       ;(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.io=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_(\"./lib/\")},{\"./lib/\":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_(\"./socket\");module.exports.parser=_dereq_(\"engine.io-parser\")},{\"./socket\":3,\"engine.io-parser\":19}],3:[function(_dereq_,module,exports){(function(global){var transports=_dereq_(\"./transports\");var Emitter=_dereq_(\"component-emitter\");var debug=_dereq_(\"debug\")(\"engine.io-client:socket\");var index=_dereq_(\"indexof\");var parser=_dereq_(\"engine.io-parser\");var parseuri=_dereq_(\"parseuri\");var parsejson=_dereq_(\"parsejson\");var parseqs=_dereq_(\"parseqs\");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&\"object\"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==\"https\"||uri.protocol==\"wss\";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&\"https:\"==location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?\"443\":\"80\"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:\"localhost\");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if(\"string\"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||\"t\";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||[\"polling\",\"websocket\"];this.readyState=\"\";this.writeBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?null:opts.rejectUnauthorized;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}}this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_(\"./transport\");Socket.transports=_dereq_(\"./transports\");Socket.parser=_dereq_(\"engine.io-parser\");Socket.prototype.createTransport=function(name){debug('creating transport \"%s\"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf(\"websocket\")!=-1){transport=\"websocket\"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit(\"error\",\"No transports available\")},0);return}else{transport=this.transports[0]}this.readyState=\"opening\";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug(\"setting transport %s\",transport.name);var self=this;if(this.transport){debug(\"clearing existing transport %s\",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on(\"drain\",function(){self.onDrain()}).on(\"packet\",function(packet){self.onPacket(packet)}).on(\"error\",function(e){self.onError(e)}).on(\"close\",function(){self.onClose(\"transport close\")})};Socket.prototype.probe=function(name){debug('probing transport \"%s\"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport \"%s\" opened',name);transport.send([{type:\"ping\",data:\"probe\"}]);transport.once(\"packet\",function(msg){if(failed)return;if(\"pong\"==msg.type&&\"probe\"==msg.data){debug('probe transport \"%s\" pong',name);self.upgrading=true;self.emit(\"upgrading\",transport);if(!transport)return;Socket.priorWebsocketSuccess=\"websocket\"==transport.name;debug('pausing current transport \"%s\"',self.transport.name);self.transport.pause(function(){if(failed)return;if(\"closed\"==self.readyState)return;debug(\"changing transport and sending upgrade packet\");cleanup();self.setTransport(transport);transport.send([{type:\"upgrade\"}]);self.emit(\"upgrade\",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport \"%s\" failed',name);var err=new Error(\"probe error\");err.transport=transport.name;self.emit(\"upgradeError\",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error(\"probe error: \"+err);error.transport=transport.name;freezeTransport();debug('probe transport \"%s\" failed because of error: %s',name,err);self.emit(\"upgradeError\",error)}function onTransportClose(){onerror(\"transport closed\")}function onclose(){onerror(\"socket closed\")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('\"%s\" works - aborting \"%s\"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener(\"open\",onTransportOpen);transport.removeListener(\"error\",onerror);transport.removeListener(\"close\",onTransportClose);self.removeListener(\"close\",onclose);self.removeListener(\"upgrading\",onupgrade)}transport.once(\"open\",onTransportOpen);transport.once(\"error\",onerror);transport.once(\"close\",onTransportClose);this.once(\"close\",onclose);this.once(\"upgrading\",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug(\"socket open\");this.readyState=\"open\";Socket.priorWebsocketSuccess=\"websocket\"==this.transport.name;this.emit(\"open\");this.flush();if(\"open\"==this.readyState&&this.upgrade&&this.transport.pause){debug(\"starting upgrade probes\");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if(\"opening\"==this.readyState||\"open\"==this.readyState){debug('socket receive: type \"%s\", data \"%s\"',packet.type,packet.data);this.emit(\"packet\",packet);this.emit(\"heartbeat\");switch(packet.type){case\"open\":this.onHandshake(parsejson(packet.data));break;case\"pong\":this.setPing();this.emit(\"pong\");break;case\"error\":var err=new Error(\"server error\");err.code=packet.data;this.onError(err);break;case\"message\":this.emit(\"data\",packet.data);this.emit(\"message\",packet.data);break}}else{debug('packet received with socket readyState \"%s\"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit(\"handshake\",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if(\"closed\"==this.readyState)return;this.setPing();this.removeListener(\"heartbeat\",this.onHeartbeat);this.on(\"heartbeat\",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if(\"closed\"==self.readyState)return;self.onClose(\"ping timeout\")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug(\"writing ping packet - expecting pong within %sms\",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket(\"ping\",function(){self.emit(\"ping\")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit(\"drain\")}else{this.flush()}};Socket.prototype.flush=function(){if(\"closed\"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug(\"flushing %d packets in socket\",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit(\"flush\")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket(\"message\",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if(\"function\"==typeof data){fn=data;data=undefined}if(\"function\"==typeof options){fn=options;options=null}if(\"closing\"==this.readyState||\"closed\"==this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit(\"packetCreate\",packet);this.writeBuffer.push(packet);if(fn)this.once(\"flush\",fn);this.flush()};Socket.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.readyState=\"closing\";var self=this;if(this.writeBuffer.length){this.once(\"drain\",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose(\"forced close\");debug(\"socket closing - telling transport to close\");self.transport.close()}function cleanupAndClose(){self.removeListener(\"upgrade\",cleanupAndClose);self.removeListener(\"upgradeError\",cleanupAndClose);close()}function waitForUpgrade(){self.once(\"upgrade\",cleanupAndClose);self.once(\"upgradeError\",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug(\"socket error %j\",err);Socket.priorWebsocketSuccess=false;this.emit(\"error\",err);this.onClose(\"transport error\",err)};Socket.prototype.onClose=function(reason,desc){if(\"opening\"==this.readyState||\"open\"==this.readyState||\"closing\"==this.readyState){debug('socket close with reason: \"%s\"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners(\"close\");this.transport.close();this.transport.removeAllListeners();this.readyState=\"closed\";this.id=null;this.emit(\"close\",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./transport\":4,\"./transports\":5,\"component-emitter\":15,debug:17,\"engine.io-parser\":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(_dereq_,module,exports){var parser=_dereq_(\"engine.io-parser\");var Emitter=_dereq_(\"component-emitter\");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState=\"\";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type=\"TransportError\";err.description=desc;this.emit(\"error\",err);return this};Transport.prototype.open=function(){if(\"closed\"==this.readyState||\"\"==this.readyState){this.readyState=\"opening\";this.doOpen()}return this};Transport.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if(\"open\"==this.readyState){this.write(packets)}else{throw new Error(\"Transport not open\")}};Transport.prototype.onOpen=function(){this.readyState=\"open\";this.writable=true;this.emit(\"open\")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit(\"packet\",packet)};Transport.prototype.onClose=function(){this.readyState=\"closed\";this.emit(\"close\")}},{\"component-emitter\":15,\"engine.io-parser\":19}],5:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var XHR=_dereq_(\"./polling-xhr\");var JSONP=_dereq_(\"./polling-jsonp\");var websocket=_dereq_(\"./websocket\");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if(\"open\"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error(\"JSONP disabled\");return new JSONP(opts)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling-jsonp\":6,\"./polling-xhr\":7,\"./websocket\":9,\"xmlhttprequest-ssl\":10}],6:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_(\"./polling\");var inherit=_dereq_(\"component-inherit\");module.exports=JSONPPolling;var rNewline=/\\n/g;var rEscapedNewline=/\\\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener(\"beforeunload\",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement(\"script\");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError(\"jsonp poll error\",e)};var insertAt=document.getElementsByTagName(\"script\")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko=\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement(\"iframe\");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement(\"form\");var area=document.createElement(\"textarea\");var id=this.iframeId=\"eio_iframe_\"+this.index;var iframe;form.className=\"socketio\";form.style.position=\"absolute\";form.style.top=\"-1000px\";form.style.left=\"-1000px\";form.target=id;form.method=\"POST\";form.setAttribute(\"accept-charset\",\"utf-8\");area.name=\"d\";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError(\"jsonp polling iframe removal error\",e)}}try{var html='<iframe src=\"javascript:0\" name=\"'+self.iframeId+'\">';iframe=document.createElement(html)}catch(e){iframe=document.createElement(\"iframe\");iframe.name=self.iframeId;iframe.src=\"javascript:0\"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,\"\\\\\\n\");this.area.value=data.replace(rNewline,\"\\\\n\");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==\"complete\"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-inherit\":16}],7:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var Polling=_dereq_(\"./polling\");var Emitter=_dereq_(\"component-emitter\");var inherit=_dereq_(\"component-inherit\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling-xhr\");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}else{this.extraHeaders=opts.extraHeaders}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!==\"string\"&&data!==undefined;var req=this.request({method:\"POST\",data:data,isBinary:isBinary});var self=this;req.on(\"success\",fn);req.on(\"error\",function(err){self.onError(\"xhr post error\",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug(\"xhr poll\");var req=this.request();var self=this;req.on(\"data\",function(data){self.onData(data)});req.on(\"error\",function(err){self.onError(\"xhr poll error\",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||\"GET\";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug(\"xhr open %s: %s\",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){xhr.responseType=\"arraybuffer\"}if(\"POST\"==this.method){try{if(this.isBinary){xhr.setRequestHeader(\"Content-type\",\"application/octet-stream\")}else{xhr.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}}catch(e){}}if(\"withCredentials\"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug(\"xhr data %s\",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit(\"success\");this.cleanup()};Request.prototype.onData=function(data){this.emit(\"data\",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit(\"error\",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if(\"undefined\"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader(\"Content-Type\").split(\";\")[0]}catch(e){}if(contentType===\"application/octet-stream\"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var ui8Arr=new Uint8Array(this.xhr.response);var dataArray=[];for(var idx=0,length=ui8Arr.length;idx<length;idx++){dataArray.push(ui8Arr[idx])}data=String.fromCharCode.apply(null,dataArray)}}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return\"undefined\"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent(\"onunload\",unloadHandler)}else if(global.addEventListener){global.addEventListener(\"beforeunload\",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-emitter\":15,\"component-inherit\":16,debug:17,\"xmlhttprequest-ssl\":10}],8:[function(_dereq_,module,exports){var Transport=_dereq_(\"../transport\");var parseqs=_dereq_(\"parseqs\");var parser=_dereq_(\"engine.io-parser\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling\");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name=\"polling\";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState=\"pausing\";function pause(){debug(\"paused\");self.readyState=\"paused\";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug(\"we are currently polling - waiting to pause\");total++;this.once(\"pollComplete\",function(){debug(\"pre-pause polling complete\");--total||pause()})}if(!this.writable){debug(\"we are currently writing - waiting to pause\");total++;this.once(\"drain\",function(){debug(\"pre-pause writing complete\");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug(\"polling\");this.polling=true;this.doPoll();this.emit(\"poll\")};Polling.prototype.onData=function(data){var self=this;debug(\"polling got data %s\",data);var callback=function(packet,index,total){if(\"opening\"==self.readyState){self.onOpen()}if(\"close\"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if(\"closed\"!=this.readyState){this.polling=false;this.emit(\"pollComplete\");if(\"open\"==this.readyState){this.poll()}else{debug('ignoring poll - transport state \"%s\"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug(\"writing close packet\");self.write([{type:\"close\"}])}if(\"open\"==this.readyState){debug(\"transport open - closing\");close()}else{debug(\"transport not open - deferring close\");this.once(\"open\",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit(\"drain\")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"https\":\"http\";var port=\"\";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&(\"https\"==schema&&this.port!=443||\"http\"==schema&&this.port!=80)){port=\":\"+this.port}if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query}},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,\"xmlhttprequest-ssl\":10,yeast:30}],9:[function(_dereq_,module,exports){(function(global){var Transport=_dereq_(\"../transport\");var parser=_dereq_(\"engine.io-parser\");var parseqs=_dereq_(\"parseqs\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:websocket\");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window===\"undefined\"){try{WebSocket=_dereq_(\"ws\")}catch(e){}}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name=\"websocket\";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}this.ws=BrowserWebSocket?new WebSocket(uri):new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType=\"buffer\"}else{this.ws.binaryType=\"arraybuffer\"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError(\"websocket error\",e)}};if(\"undefined\"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!BrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len=\"string\"==typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(BrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug(\"websocket closed before onclose event\")}--total||done()})})(packets[i])}function done(){self.emit(\"flush\");setTimeout(function(){self.writable=true;self.emit(\"drain\")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!==\"undefined\"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"wss\":\"ws\";var port=\"\";if(this.port&&(\"wss\"==schema&&this.port!=443||\"ws\"==schema&&this.port!=80)){port=\":\"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!(\"__initialize\"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,ws:undefined,yeast:30}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_(\"has-cors\");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if(\"undefined\"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(e){}}}},{\"has-cors\":22}],11:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error(\"after called too many times\")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],12:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],13:[function(_dereq_,module,exports){(function(chars){\"use strict\";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64=\"\";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];\nbase64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+\"=\"}else if(len%3===1){base64=base64.substring(0,base64.length-2)+\"==\"}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]===\"=\"){bufferLength--;if(base64[base64.length-2]===\"=\"){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\")},{}],14:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob([\"hi\"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],15:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],16:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],17:[function(_dereq_,module,exports){exports=module.exports=_dereq_(\"./debug\");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=\"undefined\"!=typeof chrome&&\"undefined\"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"];function useColors(){return\"WebkitAppearance\"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?\"%c\":\"\")+this.namespace+(useColors?\" %c\":\" \")+args[0]+(useColors?\"%c \":\" \")+\"+\"+exports.humanize(this.diff);if(!useColors)return args;var c=\"color: \"+this.color;args=[args[0],c,\"color: inherit\"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if(\"%%\"===match)return;index++;if(\"%c\"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return\"object\"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem(\"debug\")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{\"./debug\":18}],18:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_(\"ms\");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if(\"string\"!==typeof args[0]){args=[\"%o\"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match===\"%%\")return match;index++;var formatter=exports.formatters[format];if(\"function\"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if(\"function\"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||\"\").split(/[\\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\\*/g,\".*?\");if(namespaces[0]===\"-\"){exports.skips.push(new RegExp(\"^\"+namespaces.substr(1)+\"$\"))}else{exports.names.push(new RegExp(\"^\"+namespaces+\"$\"))}}}function disable(){exports.enable(\"\")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:25}],19:[function(_dereq_,module,exports){(function(global){var keys=_dereq_(\"./keys\");var hasBinary=_dereq_(\"has-binary\");var sliceBuffer=_dereq_(\"arraybuffer.slice\");var base64encoder=_dereq_(\"base64-arraybuffer\");var after=_dereq_(\"after\");var utf8=_dereq_(\"utf8\");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:\"error\",data:\"parser error\"};var Blob=_dereq_(\"blob\");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if(\"function\"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if(\"function\"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(\"\"+encoded)};function encodeBase64Object(packet,callback){var message=\"b\"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message=\"b\"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(\",\")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data==\"string\"||data===undefined){if(data.charAt(0)==\"b\"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType===\"blob\"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType===\"blob\"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary==\"function\"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback(\"0:\")}function setLengthHeader(message){return message.length+\":\"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(\"\"))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!=\"string\"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var packet;if(data==\"\"){return callback(err,0,1)}var length=\"\",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(\":\"!=chr){length+=chr}else{if(\"\"==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=\"\"}}if(length!=\"\"){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p===\"string\"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p===\"string\";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded===\"string\"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength=\"\";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg=\"\";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./keys\":20,after:11,\"arraybuffer.slice\":12,\"base64-arraybuffer\":13,blob:14,\"has-binary\":21,utf8:29}],20:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],21:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:24}],22:[function(_dereq_,module,exports){try{module.exports=typeof XMLHttpRequest!==\"undefined\"&&\"withCredentials\"in new XMLHttpRequest}catch(err){module.exports=false}},{}],23:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],24:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)==\"[object Array]\"}},{}],25:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if(\"string\"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=\"\"+str;if(str.length>1e4)return;var match=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||\"ms\").toLowerCase();switch(type){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return n*y;case\"days\":case\"day\":case\"d\":return n*d;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return n*h;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return n*m;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return n*s;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+\"d\";if(ms>=h)return Math.round(ms/h)+\"h\";if(ms>=m)return Math.round(ms/m)+\"m\";if(ms>=s)return Math.round(ms/s)+\"s\";return ms+\"ms\"}function long(ms){return plural(ms,d,\"day\")||plural(ms,h,\"hour\")||plural(ms,m,\"minute\")||plural(ms,s,\"second\")||ms+\" ms\"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+\" \"+name;return Math.ceil(ms/n)+\" \"+name+\"s\"}},{}],26:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\\],:{}\\s]*$/;var rvalidescape=/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\\s*\\[)+/g;var rtrimLeft=/^\\s+/;var rtrimRight=/\\s+$/;module.exports=function parsejson(data){if(\"string\"!=typeof data||!data){return null}data=data.replace(rtrimLeft,\"\").replace(rtrimRight,\"\");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,\"@\").replace(rvalidtokens,\"]\").replace(rvalidbraces,\"\"))){return new Function(\"return \"+data)()}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],27:[function(_dereq_,module,exports){exports.encode=function(obj){var str=\"\";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+=\"&\";str+=encodeURIComponent(i)+\"=\"+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split(\"&\");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split(\"=\");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],28:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;var parts=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];module.exports=function parseuri(str){var src=str,b=str.indexOf(\"[\"),e=str.indexOf(\"]\");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,\";\")+str.substring(e,str.length)}var m=re.exec(str||\"\"),uri={},i=14;while(i--){uri[parts[i]]=m[i]||\"\"}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,\":\");uri.authority=uri.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\");uri.ipv6uri=true}return uri}},{}],29:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports==\"object\"&&exports;var freeModule=typeof module==\"object\"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output=\"\";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error(\"Lone surrogate U+\"+codePoint.toString(16).toUpperCase()+\" is not a scalar value\")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol=\"\";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString=\"\";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error(\"Invalid byte index\")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error(\"Invalid continuation byte\")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error(\"Invalid byte index\")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error(\"Invalid UTF-8 detected\")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:\"2.0.0\",encode:utf8encode,decode:utf8decode};if(typeof define==\"function\"&&typeof define.amd==\"object\"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],30:[function(_dereq_,module,exports){\"use strict\";var alphabet=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded=\"\";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+\".\"+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],31:[function(_dereq_,module,exports){var url=_dereq_(\"./url\");var parser=_dereq_(\"socket.io-parser\");var Manager=_dereq_(\"./manager\");var debug=_dereq_(\"debug\")(\"socket.io-client\");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==\"object\"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts[\"force new connection\"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug(\"ignoring socket cache for %s\",source);io=Manager(source,opts)}else{if(!cache[id]){debug(\"new io instance for %s\",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_(\"./manager\");exports.Socket=_dereq_(\"./socket\")},{\"./manager\":32,\"./socket\":34,\"./url\":35,debug:39,\"socket.io-parser\":47}],32:[function(_dereq_,module,exports){var eio=_dereq_(\"engine.io-client\");var Socket=_dereq_(\"./socket\");var Emitter=_dereq_(\"component-emitter\");var parser=_dereq_(\"socket.io-parser\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:manager\");var indexOf=_dereq_(\"indexof\");var Backoff=_dereq_(\"backo2\");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&\"object\"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||\"/socket.io\";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState=\"closed\";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.engine.id}}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug(\"readyState %s\",this.readyState);if(~this.readyState.indexOf(\"open\"))return this;debug(\"opening %s\",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState=\"opening\";this.skipReconnect=false;var openSub=on(socket,\"open\",function(){self.onopen();fn&&fn()});var errorSub=on(socket,\"error\",function(data){debug(\"connect_error\");self.cleanup();self.readyState=\"closed\";self.emitAll(\"connect_error\",data);if(fn){var err=new Error(\"Connection error\");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug(\"connect attempt will timeout after %d\",timeout);var timer=setTimeout(function(){debug(\"connect attempt timed out after %d\",timeout);openSub.destroy();socket.close();socket.emit(\"error\",\"timeout\");self.emitAll(\"connect_timeout\",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug(\"open\");this.cleanup();this.readyState=\"open\";this.emit(\"open\");var socket=this.engine;this.subs.push(on(socket,\"data\",bind(this,\"ondata\")));this.subs.push(on(socket,\"ping\",bind(this,\"onping\")));this.subs.push(on(socket,\"pong\",bind(this,\"onpong\")));this.subs.push(on(socket,\"error\",bind(this,\"onerror\")));this.subs.push(on(socket,\"close\",bind(this,\"onclose\")));this.subs.push(on(this.decoder,\"decoded\",bind(this,\"ondecoded\")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll(\"ping\")};Manager.prototype.onpong=function(){this.emitAll(\"pong\",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit(\"packet\",packet)};Manager.prototype.onerror=function(err){debug(\"error\",err);this.emitAll(\"error\",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on(\"connecting\",onConnecting);\nsocket.on(\"connect\",function(){socket.id=self.engine.id});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug(\"writing packet %j\",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug(\"cleanup\");var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug(\"disconnect\");this.skipReconnect=true;this.reconnecting=false;if(\"opening\"==this.readyState){this.cleanup()}this.backoff.reset();this.readyState=\"closed\";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug(\"onclose\");this.cleanup();this.backoff.reset();this.readyState=\"closed\";this.emit(\"close\",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug(\"reconnect failed\");this.backoff.reset();this.emitAll(\"reconnect_failed\");this.reconnecting=false}else{var delay=this.backoff.duration();debug(\"will wait %dms before reconnect attempt\",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug(\"attempting reconnect\");self.emitAll(\"reconnect_attempt\",self.backoff.attempts);self.emitAll(\"reconnecting\",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug(\"reconnect attempt error\");self.reconnecting=false;self.reconnect();self.emitAll(\"reconnect_error\",err.data)}else{debug(\"reconnect success\");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll(\"reconnect\",attempt)}},{\"./on\":33,\"./socket\":34,backo2:36,\"component-bind\":37,\"component-emitter\":38,debug:39,\"engine.io-client\":1,indexof:42,\"socket.io-parser\":47}],33:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],34:[function(_dereq_,module,exports){var parser=_dereq_(\"socket.io-parser\");var Emitter=_dereq_(\"component-emitter\");var toArray=_dereq_(\"to-array\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:socket\");var hasBin=_dereq_(\"has-binary\");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,\"open\",bind(this,\"onopen\")),on(io,\"packet\",bind(this,\"onpacket\")),on(io,\"close\",bind(this,\"onclose\"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if(\"open\"==this.io.readyState)this.onopen();this.emit(\"connecting\");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift(\"message\");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if(\"function\"==typeof args[args.length-1]){debug(\"emitting packet with ack id %d\",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug(\"transport is open - connecting\");if(\"/\"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug(\"close (%s)\",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit(\"disconnect\",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit(\"error\",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug(\"emitting event %j\",args);if(null!=packet.id){debug(\"attaching ack callback to event\");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug(\"sending ack %j\",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if(\"function\"==typeof ack){debug(\"calling ack %s with %j\",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug(\"bad ack %s\",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit(\"connect\");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug(\"server disconnect (%s)\",this.nsp);this.destroy();this.onclose(\"io server disconnect\")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug(\"performing disconnect (%s)\",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose(\"io client disconnect\")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{\"./on\":33,\"component-bind\":37,\"component-emitter\":38,debug:39,\"has-binary\":41,\"socket.io-parser\":47,\"to-array\":51}],35:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_(\"parseuri\");var debug=_dereq_(\"debug\")(\"socket.io-client:url\");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+\"//\"+loc.host;if(\"string\"==typeof uri){if(\"/\"==uri.charAt(0)){if(\"/\"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\\/\\//.test(uri)){debug(\"protocol-less url %s\",uri);if(\"undefined\"!=typeof loc){uri=loc.protocol+\"//\"+uri}else{uri=\"https://\"+uri}}debug(\"parse %s\",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port=\"80\"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port=\"443\"}}obj.path=obj.path||\"/\";var ipv6=obj.host.indexOf(\":\")!==-1;var host=ipv6?\"[\"+obj.host+\"]\":obj.host;obj.id=obj.protocol+\"://\"+host+\":\"+obj.port;obj.href=obj.protocol+\"://\"+host+(loc&&loc.port==obj.port?\"\":\":\"+obj.port);return obj}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{debug:39,parseuri:45}],36:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],37:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if(\"string\"==typeof fn)fn=obj[fn];if(\"function\"!=typeof fn)throw new Error(\"bind() requires a function\");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],38:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[\"$\"+event]=this._callbacks[\"$\"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[\"$\"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[\"$\"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[\"$\"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[\"$\"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],39:[function(_dereq_,module,exports){arguments[4][17][0].apply(exports,arguments)},{\"./debug\":40,dup:17}],40:[function(_dereq_,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:44}],41:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON&&\"function\"==typeof obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:43}],42:[function(_dereq_,module,exports){arguments[4][23][0].apply(exports,arguments)},{dup:23}],43:[function(_dereq_,module,exports){arguments[4][24][0].apply(exports,arguments)},{dup:24}],44:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],45:[function(_dereq_,module,exports){arguments[4][28][0].apply(exports,arguments)},{dup:28}],46:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");var isBuf=_dereq_(\"./is-buffer\");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if(\"object\"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&\"object\"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&\"object\"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./is-buffer\":48,isarray:43}],47:[function(_dereq_,module,exports){var debug=_dereq_(\"debug\")(\"socket.io-parser\");var json=_dereq_(\"json3\");var isArray=_dereq_(\"isarray\");var Emitter=_dereq_(\"component-emitter\");var binary=_dereq_(\"./binary\");var isBuf=_dereq_(\"./is-buffer\");exports.protocol=4;exports.types=[\"CONNECT\",\"DISCONNECT\",\"EVENT\",\"BINARY_EVENT\",\"ACK\",\"BINARY_ACK\",\"ERROR\"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug(\"encoding packet %j\",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str=\"\";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+=\"-\"}if(obj.nsp&&\"/\"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=\",\";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=\",\";str+=json.stringify(obj.data)}debug(\"encoded %j as %s\",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if(\"string\"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit(\"decoded\",packet)}}else{this.emit(\"decoded\",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error(\"got binary data when not reconstructing a packet\")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit(\"decoded\",packet)}}}else{throw new Error(\"Unknown type: \"+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf=\"\";while(str.charAt(++i)!=\"-\"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!=\"-\"){throw new Error(\"Illegal attachments\")}p.attachments=Number(buf)}if(\"/\"==str.charAt(i+1)){p.nsp=\"\";while(++i){var c=str.charAt(i);if(\",\"==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp=\"/\"}var next=str.charAt(i+1);if(\"\"!==next&&Number(next)==next){p.id=\"\";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug(\"decoded %s as %j\",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:\"parser error\"}}},{\"./binary\":46,\"./is-buffer\":48,\"component-emitter\":49,debug:39,isarray:43,json3:50}],48:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],49:[function(_dereq_,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],50:[function(_dereq_,module,exports){(function(global){(function(){var isLoader=typeof define===\"function\"&&define.amd;var objectTypes={\"function\":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global==\"object\"&&global;if(freeGlobal&&(freeGlobal[\"global\"]===freeGlobal||freeGlobal[\"window\"]===freeGlobal||freeGlobal[\"self\"]===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root[\"Object\"]());exports||(exports=root[\"Object\"]());var Number=context[\"Number\"]||root[\"Number\"],String=context[\"String\"]||root[\"String\"],Object=context[\"Object\"]||root[\"Object\"],Date=context[\"Date\"]||root[\"Date\"],SyntaxError=context[\"SyntaxError\"]||root[\"SyntaxError\"],TypeError=context[\"TypeError\"]||root[\"TypeError\"],Math=context[\"Math\"]||root[\"Math\"],nativeJSON=context[\"JSON\"]||root[\"JSON\"];if(typeof nativeJSON==\"object\"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name==\"bug-string-char-index\"){isSupported=\"a\"[0]!=\"a\"}else if(name==\"json\"){isSupported=has(\"json-stringify\")&&has(\"json-parse\")}else{var value,serialized='{\"a\":[1,true,false,null,\"\\\\u0000\\\\b\\\\n\\\\f\\\\r\\\\t\"]}';if(name==\"json-stringify\"){var stringify=exports.stringify,stringifySupported=typeof stringify==\"function\"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)===\"0\"&&stringify(new Number)===\"0\"&&stringify(new String)=='\"\"'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)===\"1\"&&stringify([value])==\"[1]\"&&stringify([undef])==\"[null]\"&&stringify(null)==\"null\"&&stringify([undef,getClass,null])==\"[null,null,null]\"&&stringify({a:[value,true,false,null,\"\\x00\\b\\n\\f\\r\t\"]})==serialized&&stringify(null,value)===\"1\"&&stringify([1,2],null,1)==\"[\\n 1,\\n 2\\n]\"&&stringify(new Date(-864e13))=='\"-271821-04-20T00:00:00.000Z\"'&&stringify(new Date(864e13))=='\"+275760-09-13T00:00:00.000Z\"'&&stringify(new Date(-621987552e5))=='\"-000001-01-01T00:00:00.000Z\"'&&stringify(new Date(-1))=='\"1969-12-31T23:59:59.999Z\"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name==\"json-parse\"){var parse=exports.parse;if(typeof parse==\"function\"){try{if(parse(\"0\")===0&&!parse(false)){value=parse(serialized);var parseSupported=value[\"a\"].length==5&&value[\"a\"][0]===1;if(parseSupported){try{parseSupported=!parse('\"\t\"')}catch(exception){}if(parseSupported){try{parseSupported=parse(\"01\")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse(\"1.\")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has(\"json\")){var functionClass=\"[object Function]\",dateClass=\"[object Date]\",numberClass=\"[object Number]\",stringClass=\"[object String]\",arrayClass=\"[object Array]\",booleanClass=\"[object Boolean]\";var charIndexBuggy=has(\"bug-string-char-index\");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=[\"valueOf\",\"toString\",\"toLocaleString\",\"propertyIsEnumerable\",\"isPrototypeOf\",\"hasOwnProperty\",\"constructor\"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!=\"function\"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property==\"prototype\")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property==\"prototype\")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property==\"prototype\")&&isProperty.call(object,property)&&!(isConstructor=property===\"constructor\")){callback(property)}}if(isConstructor||isProperty.call(object,property=\"constructor\")){callback(property)}}}return forEach(object,callback)};if(!has(\"json-stringify\")){var Escapes={92:\"\\\\\\\\\",34:'\\\\\"',8:\"\\\\b\",12:\"\\\\f\",10:\"\\\\n\",13:\"\\\\r\",9:\"\\\\t\"};var leadingZeroes=\"000000\";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix=\"\\\\u00\";var quote=function(value){var result='\"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(\"\"):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'\"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value==\"object\"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,\"toJSON\")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?\"-\":\"+\")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+\"-\"+toPaddedString(2,month+1)+\"-\"+toPaddedString(2,date)+\"T\"+toPaddedString(2,hours)+\":\"+toPaddedString(2,minutes)+\":\"+toPaddedString(2,seconds)+\".\"+toPaddedString(3,milliseconds)+\"Z\"}else{value=null}}else if(typeof value.toJSON==\"function\"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,\"toJSON\"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return\"null\"}className=getClass.call(value);if(className==booleanClass){return\"\"+value}else if(className==numberClass){return value>-1/0&&value<1/0?\"\"+value:\"null\"}else if(className==stringClass){return quote(\"\"+value)}if(typeof value==\"object\"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?\"null\":element)}result=results.length?whitespace?\"[\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"]\":\"[\"+results.join(\",\")+\"]\":\"[]\"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+\":\"+(whitespace?\" \":\"\")+element)}});result=results.length?whitespace?\"{\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"}\":\"{\"+results.join(\",\")+\"}\":\"{}\"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace=\"\",width>10&&(width=10);whitespace.length<width;whitespace+=\" \");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize(\"\",(value={},value[\"\"]=source,value),callback,properties,whitespace,\"\",[])}}if(!has(\"json-parse\")){var fromCharCode=String.fromCharCode;var Unescapes={92:\"\\\\\",34:'\"',47:\"/\",98:\"\\b\",116:\"\t\",110:\"\\n\",102:\"\\f\",114:\"\\r\"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value=\"@\",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode(\"0x\"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)==\"true\"){Index+=4;return true}else if(source.slice(Index,Index+5)==\"false\"){Index+=5;return false}else if(source.slice(Index,Index+4)==\"null\"){Index+=4;return null}abort()}}return\"$\"};var get=function(value){var results,hasMembers;if(value==\"$\"){abort()}if(typeof value==\"string\"){if((charIndexBuggy?value.charAt(0):value[0])==\"@\"){return value.slice(1)}if(value==\"[\"){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"]\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"]\"){abort()}}else{abort()}}if(value==\",\"){abort()}results.push(get(value))}return results}else if(value==\"{\"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"}\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"}\"){abort()}}else{abort()}}if(value==\",\"||typeof value!=\"string\"||(charIndexBuggy?value.charAt(0):value[0])!=\"@\"||lex()!=\":\"){abort()}results[value.slice(1)]=get(lex())\n}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value==\"object\"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=\"\"+source;result=get(lex());if(lex()!=\"$\"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[\"\"]=result,value),\"\",callback):result}}}exports[\"runInContext\"]=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root[\"JSON3\"],isRestored=false;var JSON3=runInContext(root,root[\"JSON3\"]={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root[\"JSON3\"]=previousJSON;nativeJSON=previousJSON=null}return JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],51:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[31])(31)});\n\n    \n      ;var weight = document.getElementById('weight');\n      var socket = io('http://{{ip}}:5003');\n      socket.on('getWeight', function(msg) {\n        weight.innerHTML = msg;\n    \n      }); \n    }, 1000);\n    </script>\n\n  </body>\n</html>\n","x":490,"y":940,"wires":[["25e397a2.610328"]]},{"id":"25e397a2.610328","type":"http response","z":"40a858ce.eb2118","name":"","x":630,"y":940,"wires":[]},{"id":"ec511ee9.a2ee4","type":"function","z":"40a858ce.eb2118","name":"set ip","func":"msg.ip = global.get('ip');\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":940,"wires":[["bd755ab9.e71be8"]]},{"id":"c9f965e6.e56338","type":"debug","z":"71f38711.545228","name":"","active":false,"console":"false","complete":"true","x":730,"y":260,"wires":[]},{"id":"d806849d.726d28","type":"function","z":"40a858ce.eb2118","name":"Вес по осям","func":"msg.payload = \"\"+msg.payload+\"<br/>\"+msg.weight1+\"<br/>\"+msg.weight2+\"\";\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":520,"wires":[["50033f6a.84a87"]]},{"id":"7ea57ee2.1b751","type":"json","z":"40a858ce.eb2118","name":"","x":1144.285888671875,"y":311.4286193847656,"wires":[["5fb5c549.fc798c"]]},{"id":"5fb5c549.fc798c","type":"debug","z":"40a858ce.eb2118","name":"GD event","active":false,"console":"true","complete":"payload","x":1287.1429443359375,"y":312.8572082519531,"wires":[]},{"id":"726144a7.717ddc","type":"function","z":"40a858ce.eb2118","name":"parser","func":"var str = {\n    payload: msg.payload,\n    event_id: msg.event_id,\n    metadata: msg.metadata,\n    driverWeight: msg.driverWeight,\n    description: msg.description,\n    url: msg.url,\n    main_host: msg.main_host,\n    event_url: msg.event_url,\n    statusCode: msg.statusCode,\n    responseUrl: msg.responseUrl\n    \n};\nmsg.payload = JSON.stringify(str);\nreturn msg;","outputs":1,"noerr":0,"x":1330,"y":400,"wires":[["da1941ef.c194a"]]},{"id":"da1941ef.c194a","type":"debug","z":"40a858ce.eb2118","name":"GD response event","active":false,"console":"true","complete":"payload","x":1500,"y":400,"wires":[]},{"id":"de0f90ed.1173c","type":"debug","z":"40a858ce.eb2118","name":"GD device config","active":false,"console":"true","complete":"payload","x":1050,"y":180,"wires":[]},{"id":"ca3af99c.8e1a48","type":"json","z":"40a858ce.eb2118","name":"","x":890,"y":180,"wires":[["de0f90ed.1173c"]]},{"id":"bc009e.4b835f6","type":"function","z":"40a858ce.eb2118","name":"events payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_1');\nvar snapshot_events = flow.get('snapshot_events');\nvar snapshot = false;\n\nif (snapshot_events.indexOf(event_id)>=0){\n    snapshot = true;\n}\n\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'devices':[{'id':scale_id}],\n    'data':msg.metadata,\n    'description':msg.description\n};\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n};\n\nmsg.url = flow.get('main_host')+flow.get('event_url');\nmsg.main_host = flow.get('main_host');\nmsg.event_url = flow.get('event_url');\nmsg.snapshot = snapshot;\nreturn msg;","outputs":1,"noerr":0,"x":913.9046630859375,"y":337.2618408203125,"wires":[["7ea57ee2.1b751","31af19f4.128e06","7ce37804.a95828"]]},{"id":"35de5b92.574694","type":"function","z":"40a858ce.eb2118","name":"device config","func":"var device_config = JSON.parse(msg.payload);\n\nflow.set('scale_id',device_config.scale_id);\nflow.set('event_move_in_id',device_config.event_move_in_id);\nflow.set('event_move_in_minus_id',device_config.event_move_in_minus_id);\nflow.set('event_move_out_id',device_config.event_move_out_id);\nflow.set('event_max_weight_id',device_config.event_max_weight_id);\nflow.set('event_off_id',device_config.event_off_id);\nflow.set('event_on_id', device_config.event_on_id);\nflow.set('event_max_duration',device_config.event_max_duration);\nflow.set('event_fake_traffic',device_config.event_fake_traffic);\nflow.set('event_driver_in', device_config.event_driver_in);\nflow.set('main_host',device_config.main_host);\nflow.set('event_url',device_config.event_url);\nflow.set('state_url',device_config.state_url);\nflow.set('maxWeight',device_config.maxWeight);\nflow.set('minWeight',device_config.minWeight);\nflow.set('maxDuration',device_config.maxDuration);\nflow.set('checkHealthTimeout',device_config.checkHealthTimeout);\nflow.set('event_get_weight_acc',device_config.event_get_weight_acc);\nflow.set('event_min_weight',device_config.event_min_weight);\nflow.set('minTriggerWeight',device_config.minTriggerWeight);\nflow.set('snapshot_url',device_config.snapshot_url);\nflow.set('snapshot_events',device_config.snapshot_events);\nflow.set('driverWeight',device_config.driverWeight)\n\nmsg.payload = {\n\tscale_id: flow.get('scale_id'),\n\tevent_move_in_id: flow.get('event_move_in_id'),\n\tevent_move_in_minus_id: flow.get('event_move_in_minus_id'),\n\tevent_move_out_id: flow.get('event_move_out_id'),\n\tevent_max_weight_id: flow.get('event_max_weight_id'),\n\tevent_off_id: flow.get('event_off_id'),\n\tevent_on_id: flow.get('event_on_id'),\n\tevent_max_duration: flow.get('event_max_duration'),\n\tevent_fake_traffic: flow.get('event_fake_traffic'),\n\tevent_driver_in: flow.get('event_driver_in'),\n\tmain_host: flow.get('main_host'),\n\tevent_url: flow.get('event_url'),\n\tstate_url: flow.get('state_url'),\n\tmaxWeight: flow.get('maxWeight'),\n\tminWeight: flow.get('minWeight'),\n\tmaxDuration: flow.get('maxDuration'),\n\tcheckHealthTimeout: flow.get('checkHealthTimeout'),\n\tevent_get_weight_acc: flow.get('event_get_weight_acc'),\n\tevent_min_weight: flow.get('event_min_weight'),\n\tminTriggerWeight: flow.get('minTriggerWeight'),\n\tsnapshot_url: flow.get('snapshot_url'),\n\tsnapshot_events: flow.get('snapshot_events'),\n\tdriverWeight: flow.get('driverWeight')\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":750,"y":180,"wires":[["ca3af99c.8e1a48"]]},{"id":"a942465.0d206b8","type":"function","z":"71f38711.545228","name":"Общий","func":"msg.payload = flow.get('w');\nmsg.weight1 = flow.get('a1');\nmsg.weight2 = flow.get('a2');\nmsg.weight_center = msg.weight1 - msg.weight2;\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":220,"wires":[["c0377ed3.f7381","c9f965e6.e56338"]]},{"id":"c0377ed3.f7381","type":"link out","z":"71f38711.545228","name":"","links":["ca448802.052b18"],"x":695,"y":220,"wires":[]},{"id":"14ff4e7b.3395e2","type":"function","z":"71f38711.545228","name":"","func":"var payload = msg.payload;\nvar parser = flow.get(\"p\").parser;\nvar currentWeight = parser(payload);\n\nflow.set(\"currentWeight\",parser(payload));\n\nreturn msg;\n","outputs":1,"noerr":0,"x":450,"y":220,"wires":[["a942465.0d206b8","b7515c74.81015"]]},{"id":"2e113aba.7a39c6","type":"delay","z":"40a858ce.eb2118","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":340,"y":180,"wires":[["7152d3ea.8f781c"]]},{"id":"5f3bbdf7.3eba64","type":"trigger","z":"40a858ce.eb2118","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","name":"","x":320,"y":220,"wires":[["51e59d78.a410b4"]]},{"id":"93379033.7ad77","type":"function","z":"d6bade09.4de0d","name":"Для поосевого","func":"flow.set('cmd',\"MSV?;\"); //текущая команда\n\n\n\nglobal.set('scale_id_jd_2','ffab9c54-7df9-4ff3-a447-2731c8fece27');\nglobal.set('ip','10.107.5.200');\nglobal.set('video_camera_url','');\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":40,"wires":[["e5dea05f.b0c36"]]},{"id":"6365d4cf.3bff0c","type":"inject","z":"d6bade09.4de0d","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":130,"y":40,"wires":[["93379033.7ad77"]]},{"id":"a97040b2.9b88b","type":"debug","z":"d6bade09.4de0d","name":"","active":false,"console":"false","complete":"false","x":650,"y":40,"wires":[]},{"id":"e5dea05f.b0c36","type":"function","z":"d6bade09.4de0d","name":"Общий","func":"var p = {\n    'smartScaleURL':'http://10.1.132.171/preBI/hs/api/v1/weights?token=5af8e4eb-c54a-40ab-8755-b6e154d9a7d1&encoding=utf8',\n    'smartScaleMethod':'POST',\n    'organizationName':'Рахни',\n    'organizationID':'04',\n    'typeOfScale':'IoT',\n    'source':'atom',\n    'scale':'jd2',\n    'dblogin':'atom2',\n    'dbpassword':'123',\n    'log':1,\n    'socketport':'5003',\n    'ip':'10.107.5.200',\n    'inject':\"W\",\n    'parser':function(v){\n           let w = 0;\n        var minus = v.indexOf('-');\n        var index_minus = 1;\n        //перевірка на мінус\n        if(minus > -1){\n            index_minus = -1;\n        }\n\n\n\n          w = v.substring(1,8);\n          w = Number(w) * index_minus * 10;\n           \n           flow.set('weight',w);\n        //   flow.set('a2',a2);\n           \n           return v;\n        }\n};\nflow.set('p',p);","outputs":1,"noerr":0,"x":480,"y":40,"wires":[["a97040b2.9b88b"]]},{"id":"ce9f1f04.9513e","type":"debug","z":"d6bade09.4de0d","name":"","active":false,"console":"false","complete":"true","x":610,"y":240,"wires":[]},{"id":"ed94738d.be1e1","type":"function","z":"d6bade09.4de0d","name":"Общий","func":"msg.payload = flow.get('weight');\nmsg.weight1 = 0;\nmsg.weight2 = 0;\nmsg.weight_center = 0;\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":200,"wires":[["36c7e41.ca9a61c","ce9f1f04.9513e"]]},{"id":"36c7e41.ca9a61c","type":"link out","z":"d6bade09.4de0d","name":"","links":["ee7ab9a1.69fc98"],"x":575,"y":200,"wires":[]},{"id":"fc8c7f59.7a186","type":"function","z":"d6bade09.4de0d","name":"","func":"var payload = msg.payload;\nvar parser = flow.get(\"p\").parser;\nvar currentWeight = parser(payload);\n\nflow.set(\"currentWeight\",parser(payload));\n\nreturn msg;\n","outputs":1,"noerr":0,"x":310,"y":200,"wires":[["ed94738d.be1e1","b73842a.9f150c"]]},{"id":"ee7ab9a1.69fc98","type":"link in","z":"cbb45903.f34358","name":"weight","links":["36c7e41.ca9a61c"],"x":35,"y":380,"wires":[["740b5440.fc925c","2166e2e.dfd8d1e","78c93aba.96c844"]]},{"id":"78c93aba.96c844","type":"function","z":"cbb45903.f34358","name":"main module","func":"var prevWeight = flow.get('prevWeight');\nvar transaction = flow.get('transaction');\nvar transactionData = flow.get('transactionData');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar transactionHasMaxWeight = flow.get('transactionHasMaxWeight');\nvar transactionHasMinWeight = flow.get('transactionHasMinWeight');\nvar transactionHasMaxDuration = flow.get('transactionHasMaxDuration');\nvar waybill = flow.get('transactionWaybill');\nvar weight = msg.payload;\nvar stableSize = 5;\nvar duration = 0;\nvar maxWeight = flow.get('maxWeight');\nvar maxDuration = flow.get('maxDuration');\nvar prevTransaction = transaction;\nvar minWeight = flow.get('minWeight');\nvar minTriggerWeight = flow.get('minTriggerWeight');\n\n//transaction\nif (prevWeight === null){\n    prevWeight = msg.payload;    \n}else{\n    if((prevWeight <= 0) && (weight > 0) && (weight > minTriggerWeight)){\n        //start of transaction\n        transaction = Date.now();\n        msg.on = true;\n        flow.set('transaction',transaction);\n    }else if((prevWeight > 0) && (weight <=0) && (transaction)){\n        //transaction = 0;\n        msg.on = false;\n        transactionData = [];\n        flow.set('transaction',0);\n        flow.set('transactionMaxWeight',null);\n        flow.set('transactionHasMaxWeight',null);\n        flow.set('transactionHasMinWeight',null);\n        flow.set('transactionHasMaxDuration',null);\n        flow.set('transactionWaybill',null);\n        flow.set('transactionMetadata',null);\n    }else if((transaction === null) && (weight>0) && (weight > minTriggerWeight)){\n        transaction = Date.now();\n        flow.set('transaction',transaction);\n    }\n}\n\n msg.stable = true;\n\nif (transaction > 0){\n    transactionData.push(weight);    \n\n    //stable\n    if(transactionData.length > stableSize+1){\n        var stabletmp = true;\n        for (var i = transactionData.length-1; i > transactionData.length-1-stableSize; i--){\n            if (transactionData[i] !== transactionData[i-1]){\n                stabletmp = false;\n                msg.stable = stabletmp;\n                break;\n            }\n            msg.stable = stabletmp;\n        }\n    }else{\n        msg.stable = false;\n    }\n\n    //duration & transactionMaxWeight\n    duration = (Number(Date.now()) - Number(transaction));\n    if( (weight>transactionMaxWeight) || (transactionMaxWeight === null)){\n        transactionMaxWeight = weight;\n        flow.set(\"transactionMaxWeight\",transactionMaxWeight);\n    }\n    \n    if(!transactionHasMaxWeight && weight > maxWeight){\n        msg.transactionHasMaxWeight = true;\n        flow.set('transactionHasMaxWeight',true);\n    }\n    \n    if(!transactionHasMinWeight && weight < minWeight){\n        msg.transactionHasMinWeight = true;\n        flow.set('transactionHasMinWeight',true);\n    }\n    \n    //max duartion\n    if(!transactionHasMaxDuration && duration > maxDuration){\n        msg.transactionHasMaxDuration = true;\n        flow.set('transactionHasMaxDuration',true);\n    }\n}\n\n//result\nmsg.metadata = {\n    'weight':weight,\n    'prevWeight':prevWeight,\n    'prevTransaction':prevTransaction,\n    'transaction':transaction,\n    'on':msg.on,\n    'transactionDataCount':transactionData.length,\n    'stable':msg.stable,\n    'duration':Math.round(duration/1000),\n    'transactionMaxWeight':transactionMaxWeight,\n    'waybill':waybill,\n    'perimetr':true,\n    'weight1':msg.weight1,\n    'weight2':msg.weight2,\n    'weight_center':msg.weight_center\n}\nflow.set('transactionData',transactionData);\nflow.set('prevWeight',weight);\nflow.set('transactionMetadata',msg.metadata);\nflow.set('lasttimedata', new Date());\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":380,"wires":[["64f22c51.d584f4","a703a6a0.a60f98","2600ac90.04af84","80adf2c4.64c6b"]]},{"id":"34a60b44.f6e024","type":"function","z":"cbb45903.f34358","name":"get weight from accounting system","func":"var transactionMetadata = flow.get('transactionMetadata');\nvar buisness_data = msg.req.query;\nmsg.metadata = Object.assign(transactionMetadata,buisness_data);\nmsg.event_id = flow.get('event_get_weight_acc');\ntransactionWaybill = flow.get('transactionWaybill');\nif (!transactionWaybill){\n    flow.set('transactionWaybill',msg.req.query.reader);\n}\nmsg.description = buisness_data.operation_name+'. Зважили в 1С. Поточна вага: ' + msg.metadata.weight+\" Номер вагону: \"+buisness_data.truck1+\" \"+buisness_data.item_name;\nmsg.transactionMetadata = transactionMetadata;\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":720,"wires":[["a8a6473b.dbe1a8"]]},{"id":"64f22c51.d584f4","type":"switch","z":"cbb45903.f34358","name":"switch move","property":"on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":390,"y":360,"wires":[["72a1af28.3b6ed"],["4bee4a18.631c54","c41666dc.8c3d98"]]},{"id":"8584fbac.1c6418","type":"http request","z":"cbb45903.f34358","name":"EVENTS","method":"POST","ret":"txt","url":"","tls":"d8337a69.ecb378","x":1171.25,"y":350,"wires":[["b55c1859.180e08","9647b3b1.e0d47"]]},{"id":"72a1af28.3b6ed","type":"function","z":"cbb45903.f34358","name":"move in","func":"msg.event_id = flow.get('event_move_in_id');\nmsg.description = 'Заїзд на ваги. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":320,"wires":[["a8a6473b.dbe1a8"]]},{"id":"a703a6a0.a60f98","type":"switch","z":"cbb45903.f34358","name":"switch max weight","property":"transactionHasMaxWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":410,"y":400,"wires":[["10d8098b.e3fdd6"]]},{"id":"10d8098b.e3fdd6","type":"function","z":"cbb45903.f34358","name":"transactionHasMaxWeight","func":"msg.event_id = flow.get('event_max_weight_id');\nmsg.description = 'Перевищена максимально-допустима вага: ' + msg.metadata.weight;\nmsg.needSnapshot = true;\n\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":400,"wires":[["a8a6473b.dbe1a8"]]},{"id":"8bb72679.4dee48","type":"inject","z":"cbb45903.f34358","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":130,"y":620,"wires":[["64e273b.3c3c88c"]]},{"id":"64e273b.3c3c88c","type":"function","z":"cbb45903.f34358","name":"check scale health","func":"var lastcheckHealth = flow.get('checkHealth');\nvar checkHealth = null;\nvar lasttimedata = flow.get('lasttimedata');\n\nvar currenttimedata = new Date();\n\nif ((currenttimedata - lasttimedata) >20000){\n    checkHealth = false;\n} else {\n    checkHealth = true;\n}\n\nflow.set(\"checkHealth\",checkHealth);\n\nif (lastcheckHealth != checkHealth){\n    msg.checkHealth = checkHealth;\n}else{\n    msg.checkHealth = null;\n}\nmsg.payload = checkHealth;\n\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":620,"wires":[["27a87b55.7ad154"]]},{"id":"27a87b55.7ad154","type":"switch","z":"cbb45903.f34358","name":"","property":"checkHealth","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":490,"y":620,"wires":[["6f539d92.218134"],["8033df44.2af3c"]]},{"id":"8033df44.2af3c","type":"function","z":"cbb45903.f34358","name":"off","func":"msg.event_id = flow.get('event_off_id');\nmsg.description = 'Прилад відключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":620,"wires":[["a8a6473b.dbe1a8"]]},{"id":"6f539d92.218134","type":"function","z":"cbb45903.f34358","name":"on","func":"msg.event_id = flow.get('event_on_id');\nmsg.description = 'Прилад підключено';\nmsg.metadata = {\n    'state':msg.checkHealth\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":580,"wires":[["a8a6473b.dbe1a8"]]},{"id":"6a42610a.da668","type":"function","z":"cbb45903.f34358","name":"main config","func":"flow.set('prevWeight',null);\nflow.set('transaction',null);\nflow.set('transactionData',[]);\nflow.set('transactionMaxWeight',null);\nflow.set('transactionHasMinWeight',null);\nflow.set('transactionHasMaxWeight',null);\nflow.set('transactionHasMaxDuration',null);\nflow.set('lasttimedata', new Date());\nflow.set('checkHealth',null);\nflow.set('transactionWaybill',null);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":530,"y":220,"wires":[[]]},{"id":"2a7b8e5f.aa6512","type":"inject","z":"cbb45903.f34358","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":110,"y":180,"wires":[["de53fabd.baca28","46dd7d79.222584"]]},{"id":"4bee4a18.631c54","type":"function","z":"cbb45903.f34358","name":"move out","func":"msg.event_id = flow.get('event_move_out_id');\nmsg.description = 'Зїзд з ваг. Поточна вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":360,"wires":[[]]},{"id":"2600ac90.04af84","type":"switch","z":"cbb45903.f34358","name":"max duration","property":"transactionHasMaxDuration","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":390,"y":440,"wires":[["fe158127.f88d"]]},{"id":"fe158127.f88d","type":"function","z":"cbb45903.f34358","name":"transaction has max duration","func":"msg.event_id = flow.get('event_max_duration');\nmsg.description = 'Перевищено максимальний час находження на вагах: ' + msg.metadata.duration/1000;\n\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":440,"wires":[["a8a6473b.dbe1a8"]]},{"id":"14449f99.8f776","type":"http in","z":"cbb45903.f34358","name":"","url":"/firmware","method":"post","swaggerDoc":"","x":160,"y":140,"wires":[["26fd139a.31f2fc"]]},{"id":"26fd139a.31f2fc","type":"file","z":"cbb45903.f34358","name":"deivce_config_jd_1.json","filename":"deivce_config_jd_1.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":630,"y":100,"wires":[]},{"id":"37c6840b.c65c2c","type":"file in","z":"cbb45903.f34358","name":"deivce_config_jd_1.json","filename":"deivce_config_jd_1.json","format":"utf8","x":570,"y":180,"wires":[["24ba7b06.cde384"]]},{"id":"9aaa632.18c7ba","type":"http in","z":"cbb45903.f34358","name":"","url":"/serial","method":"get","swaggerDoc":"","x":140,"y":40,"wires":[["19c0c250.403dbe"]]},{"id":"19c0c250.403dbe","type":"exec","z":"cbb45903.f34358","command":"cat /proc/cpuinfo","addpay":true,"append":"| grep Serial","useSpawn":"","timer":"5","name":"","x":370,"y":40,"wires":[["8c97e13a.6e83","a5b6d862.1dac58"],[],[]]},{"id":"8c97e13a.6e83","type":"http response","z":"cbb45903.f34358","name":"","x":570,"y":20,"wires":[]},{"id":"a5b6d862.1dac58","type":"function","z":"cbb45903.f34358","name":"","func":"msg.payload = msg.payload.split(':')[1].replace('\\n','').replace(' ','');\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":60,"wires":[["12207276.f09eae"]]},{"id":"12207276.f09eae","type":"debug","z":"cbb45903.f34358","name":"","active":false,"console":"false","complete":"false","x":710,"y":60,"wires":[]},{"id":"7ed36793.0c5928","type":"inject","z":"cbb45903.f34358","name":"DEMO","topic":"","payload":"","payloadType":"str","repeat":"10800","crontab":"","once":true,"x":120,"y":100,"wires":[["6fa16607.34e998"]]},{"id":"6fa16607.34e998","type":"function","z":"cbb45903.f34358","name":"DEMO Data","func":"var device_config = {\n    'event_move_in_id':'80096D9ABE7F68F3E0533300000A6C0D',\n    'event_move_out_id':'80096D9ABE8068F3E0533300000A6C0D',\n    'event_max_weight_id':'85A255F950F9BEF4E0533300000AC45D',\n    'event_off_id':'85A2CC4570292DD1E0533300000A0C94',\n    'event_on_id': '85A2CC45702A2DD1E0533300000A0C94',\n    'event_max_duration':'8642EE858DE89BAAE0533300000AFCC7',\n    'event_fake_traffic':'80096EF60C186574E0533300000ADBA5',\n    'event_get_weight_acc':'800970AC1FDC683CE0533300000AF1B0',\n    'event_min_weight':'875C3EB5C9DD092DE055000000000001',\n    'event_test_connection':'925791CDC4E619BDE055000000000001',\n    'main_host':'https://10.107.5.200:8443/ords/ettn',\n    'camera_url':'',\n    'event_url':'/iot_cli/events/log',\n    'snapshot_events':['80096D9ABE7F68F3E0533300000A6C0D','85A255F950F9BEF4E0533300000AC45D','8642EE858DE89BAAE0533300000AFCC7','800970AC1FDC683CE0533300000AF1B0'],\n    'state_url':'/iot_cli/device',\n    'snapshot_url':'/iot_cli/events/snapshot',\n    'maxWeight':90000,\n    'maxDuration':1200000,\n    'minWeight':0,\n    'checkHealthTimeout':3000,\n    'minTriggerWeight':200\n}\nmsg.payload = device_config;\n// flow.set('scale_id','80096CB0EFD83B63E0533300000A4334');\n// flow.set('event_move_in_id','80096D9ABE7F68F3E0533300000A6C0D');\n// flow.set('event_move_out_id','80096D9ABE8068F3E0533300000A6C0D');\n// flow.set('event_max_weight_id','85A255F950F9BEF4E0533300000AC45D');\n// flow.set('event_off_id','85A2CC4570292DD1E0533300000A0C94');\n// flow.set('event_on_id', '85A2CC45702A2DD1E0533300000A0C94');\n// flow.set('event_max_duration','8642EE858DE89BAAE0533300000AFCC7');\n// flow.set('main_host','http://prod.apex.rest/ords/ettn');\n// flow.set('event_url','/iot_cli/events/log');\n// flow.set('state_url','/v1/device');\n// flow.set('maxWeight',40000);\n// flow.set('maxDuration',20000);\n// flow.set('checkHealthTimeout',3000);\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":100,"wires":[["26fd139a.31f2fc"]]},{"id":"740b5440.fc925c","type":"debug","z":"cbb45903.f34358","name":"JD 1","active":false,"console":"false","complete":"true","x":170,"y":340,"wires":[]},{"id":"c41666dc.8c3d98","type":"switch","z":"cbb45903.f34358","name":"waybill","property":"metadata.waybill","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","outputs":1,"x":600,"y":280,"wires":[["92d12a46.05b098"]]},{"id":"92d12a46.05b098","type":"function","z":"cbb45903.f34358","name":"move in","func":"msg.event_id = flow.get('event_fake_traffic');\nmsg.description = 'Холостий проїзд по вагам. Тривалість проїзду ' + msg.metadata.duration;\n\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":280,"wires":[["b46c9fc5.a3839"]]},{"id":"b46c9fc5.a3839","type":"debug","z":"cbb45903.f34358","name":"","active":false,"console":"false","complete":"false","x":950,"y":280,"wires":[]},{"id":"bd46b138.38e8d","type":"http in","z":"cbb45903.f34358","name":"","url":"/getWeightjd2","method":"get","swaggerDoc":"","x":190,"y":720,"wires":[["34a60b44.f6e024","54032049.a4ced","c3025f16.656e4","db4307e8.c4bed8"]]},{"id":"cd39c188.5a9dc","type":"http response","z":"cbb45903.f34358","name":"","x":690,"y":760,"wires":[]},{"id":"54032049.a4ced","type":"function","z":"cbb45903.f34358","name":"response","func":"msg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nif(transactionWaybill && transactionWaybill !== msg.req.query.waybill){\n    msg.payload.status = false;    \n}else {\n    msg.payload.status = true;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":760,"wires":[["cd39c188.5a9dc"]]},{"id":"b55c1859.180e08","type":"debug","z":"cbb45903.f34358","name":"","active":false,"console":"false","complete":"true","x":1350,"y":360,"wires":[]},{"id":"80adf2c4.64c6b","type":"switch","z":"cbb45903.f34358","name":"switch min weight","property":"transactionHasMinWeight","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":410,"y":480,"wires":[["e7e991a4.48da3"]]},{"id":"e7e991a4.48da3","type":"function","z":"cbb45903.f34358","name":"transactionHasMinWeight","func":"msg.event_id = flow.get('event_min_weight');\nmsg.description = 'Перевищена мінімально-допустима вага: ' + msg.metadata.weight;\n\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":480,"wires":[["a8a6473b.dbe1a8"]]},{"id":"58850680.2a27f8","type":"socket-io-out","z":"cbb45903.f34358","name":"socket 5004","event":"d0426e92.cf1a2","server":"5ed08ea6.37a87","x":350,"y":520,"wires":[]},{"id":"29aa412e.63685e","type":"http in","z":"cbb45903.f34358","name":"","url":"/getSimpleWeightjd2","method":"get","swaggerDoc":"","x":210,"y":820,"wires":[["95bc5bc9.908ba8"]]},{"id":"95bc5bc9.908ba8","type":"function","z":"cbb45903.f34358","name":"response","func":"msg.payload = flow.get('transactionMetadata').weight;\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":820,"wires":[["9171505b.3cb7d"]]},{"id":"9171505b.3cb7d","type":"http response","z":"cbb45903.f34358","name":"","x":690,"y":820,"wires":[]},{"id":"84886701.065538","type":"http in","z":"cbb45903.f34358","name":"","url":"/socket_jd_2","method":"get","swaggerDoc":"","x":180,"y":940,"wires":[["745b6cda.db8fc4"]]},{"id":"79c16ad8.f6ed44","type":"template","z":"cbb45903.f34358","name":"socket page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n     \n  <body>\n    <h1><p id='weight'></p></h1>\n    \n     <script>\n    setTimeout(function() {\n       ;(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.io=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_(\"./lib/\")},{\"./lib/\":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_(\"./socket\");module.exports.parser=_dereq_(\"engine.io-parser\")},{\"./socket\":3,\"engine.io-parser\":19}],3:[function(_dereq_,module,exports){(function(global){var transports=_dereq_(\"./transports\");var Emitter=_dereq_(\"component-emitter\");var debug=_dereq_(\"debug\")(\"engine.io-client:socket\");var index=_dereq_(\"indexof\");var parser=_dereq_(\"engine.io-parser\");var parseuri=_dereq_(\"parseuri\");var parsejson=_dereq_(\"parsejson\");var parseqs=_dereq_(\"parseqs\");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&\"object\"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==\"https\"||uri.protocol==\"wss\";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&\"https:\"==location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?\"443\":\"80\"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:\"localhost\");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if(\"string\"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||\"t\";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||[\"polling\",\"websocket\"];this.readyState=\"\";this.writeBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?null:opts.rejectUnauthorized;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}}this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_(\"./transport\");Socket.transports=_dereq_(\"./transports\");Socket.parser=_dereq_(\"engine.io-parser\");Socket.prototype.createTransport=function(name){debug('creating transport \"%s\"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf(\"websocket\")!=-1){transport=\"websocket\"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit(\"error\",\"No transports available\")},0);return}else{transport=this.transports[0]}this.readyState=\"opening\";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug(\"setting transport %s\",transport.name);var self=this;if(this.transport){debug(\"clearing existing transport %s\",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on(\"drain\",function(){self.onDrain()}).on(\"packet\",function(packet){self.onPacket(packet)}).on(\"error\",function(e){self.onError(e)}).on(\"close\",function(){self.onClose(\"transport close\")})};Socket.prototype.probe=function(name){debug('probing transport \"%s\"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport \"%s\" opened',name);transport.send([{type:\"ping\",data:\"probe\"}]);transport.once(\"packet\",function(msg){if(failed)return;if(\"pong\"==msg.type&&\"probe\"==msg.data){debug('probe transport \"%s\" pong',name);self.upgrading=true;self.emit(\"upgrading\",transport);if(!transport)return;Socket.priorWebsocketSuccess=\"websocket\"==transport.name;debug('pausing current transport \"%s\"',self.transport.name);self.transport.pause(function(){if(failed)return;if(\"closed\"==self.readyState)return;debug(\"changing transport and sending upgrade packet\");cleanup();self.setTransport(transport);transport.send([{type:\"upgrade\"}]);self.emit(\"upgrade\",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport \"%s\" failed',name);var err=new Error(\"probe error\");err.transport=transport.name;self.emit(\"upgradeError\",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error(\"probe error: \"+err);error.transport=transport.name;freezeTransport();debug('probe transport \"%s\" failed because of error: %s',name,err);self.emit(\"upgradeError\",error)}function onTransportClose(){onerror(\"transport closed\")}function onclose(){onerror(\"socket closed\")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('\"%s\" works - aborting \"%s\"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener(\"open\",onTransportOpen);transport.removeListener(\"error\",onerror);transport.removeListener(\"close\",onTransportClose);self.removeListener(\"close\",onclose);self.removeListener(\"upgrading\",onupgrade)}transport.once(\"open\",onTransportOpen);transport.once(\"error\",onerror);transport.once(\"close\",onTransportClose);this.once(\"close\",onclose);this.once(\"upgrading\",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug(\"socket open\");this.readyState=\"open\";Socket.priorWebsocketSuccess=\"websocket\"==this.transport.name;this.emit(\"open\");this.flush();if(\"open\"==this.readyState&&this.upgrade&&this.transport.pause){debug(\"starting upgrade probes\");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if(\"opening\"==this.readyState||\"open\"==this.readyState){debug('socket receive: type \"%s\", data \"%s\"',packet.type,packet.data);this.emit(\"packet\",packet);this.emit(\"heartbeat\");switch(packet.type){case\"open\":this.onHandshake(parsejson(packet.data));break;case\"pong\":this.setPing();this.emit(\"pong\");break;case\"error\":var err=new Error(\"server error\");err.code=packet.data;this.onError(err);break;case\"message\":this.emit(\"data\",packet.data);this.emit(\"message\",packet.data);break}}else{debug('packet received with socket readyState \"%s\"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit(\"handshake\",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if(\"closed\"==this.readyState)return;this.setPing();this.removeListener(\"heartbeat\",this.onHeartbeat);this.on(\"heartbeat\",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if(\"closed\"==self.readyState)return;self.onClose(\"ping timeout\")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug(\"writing ping packet - expecting pong within %sms\",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket(\"ping\",function(){self.emit(\"ping\")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit(\"drain\")}else{this.flush()}};Socket.prototype.flush=function(){if(\"closed\"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug(\"flushing %d packets in socket\",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit(\"flush\")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket(\"message\",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if(\"function\"==typeof data){fn=data;data=undefined}if(\"function\"==typeof options){fn=options;options=null}if(\"closing\"==this.readyState||\"closed\"==this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit(\"packetCreate\",packet);this.writeBuffer.push(packet);if(fn)this.once(\"flush\",fn);this.flush()};Socket.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.readyState=\"closing\";var self=this;if(this.writeBuffer.length){this.once(\"drain\",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose(\"forced close\");debug(\"socket closing - telling transport to close\");self.transport.close()}function cleanupAndClose(){self.removeListener(\"upgrade\",cleanupAndClose);self.removeListener(\"upgradeError\",cleanupAndClose);close()}function waitForUpgrade(){self.once(\"upgrade\",cleanupAndClose);self.once(\"upgradeError\",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug(\"socket error %j\",err);Socket.priorWebsocketSuccess=false;this.emit(\"error\",err);this.onClose(\"transport error\",err)};Socket.prototype.onClose=function(reason,desc){if(\"opening\"==this.readyState||\"open\"==this.readyState||\"closing\"==this.readyState){debug('socket close with reason: \"%s\"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners(\"close\");this.transport.close();this.transport.removeAllListeners();this.readyState=\"closed\";this.id=null;this.emit(\"close\",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./transport\":4,\"./transports\":5,\"component-emitter\":15,debug:17,\"engine.io-parser\":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(_dereq_,module,exports){var parser=_dereq_(\"engine.io-parser\");var Emitter=_dereq_(\"component-emitter\");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState=\"\";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type=\"TransportError\";err.description=desc;this.emit(\"error\",err);return this};Transport.prototype.open=function(){if(\"closed\"==this.readyState||\"\"==this.readyState){this.readyState=\"opening\";this.doOpen()}return this};Transport.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if(\"open\"==this.readyState){this.write(packets)}else{throw new Error(\"Transport not open\")}};Transport.prototype.onOpen=function(){this.readyState=\"open\";this.writable=true;this.emit(\"open\")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit(\"packet\",packet)};Transport.prototype.onClose=function(){this.readyState=\"closed\";this.emit(\"close\")}},{\"component-emitter\":15,\"engine.io-parser\":19}],5:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var XHR=_dereq_(\"./polling-xhr\");var JSONP=_dereq_(\"./polling-jsonp\");var websocket=_dereq_(\"./websocket\");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if(\"open\"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error(\"JSONP disabled\");return new JSONP(opts)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling-jsonp\":6,\"./polling-xhr\":7,\"./websocket\":9,\"xmlhttprequest-ssl\":10}],6:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_(\"./polling\");var inherit=_dereq_(\"component-inherit\");module.exports=JSONPPolling;var rNewline=/\\n/g;var rEscapedNewline=/\\\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener(\"beforeunload\",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement(\"script\");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError(\"jsonp poll error\",e)};var insertAt=document.getElementsByTagName(\"script\")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko=\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement(\"iframe\");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement(\"form\");var area=document.createElement(\"textarea\");var id=this.iframeId=\"eio_iframe_\"+this.index;var iframe;form.className=\"socketio\";form.style.position=\"absolute\";form.style.top=\"-1000px\";form.style.left=\"-1000px\";form.target=id;form.method=\"POST\";form.setAttribute(\"accept-charset\",\"utf-8\");area.name=\"d\";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError(\"jsonp polling iframe removal error\",e)}}try{var html='<iframe src=\"javascript:0\" name=\"'+self.iframeId+'\">';iframe=document.createElement(html)}catch(e){iframe=document.createElement(\"iframe\");iframe.name=self.iframeId;iframe.src=\"javascript:0\"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,\"\\\\\\n\");this.area.value=data.replace(rNewline,\"\\\\n\");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==\"complete\"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-inherit\":16}],7:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var Polling=_dereq_(\"./polling\");var Emitter=_dereq_(\"component-emitter\");var inherit=_dereq_(\"component-inherit\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling-xhr\");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}else{this.extraHeaders=opts.extraHeaders}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!==\"string\"&&data!==undefined;var req=this.request({method:\"POST\",data:data,isBinary:isBinary});var self=this;req.on(\"success\",fn);req.on(\"error\",function(err){self.onError(\"xhr post error\",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug(\"xhr poll\");var req=this.request();var self=this;req.on(\"data\",function(data){self.onData(data)});req.on(\"error\",function(err){self.onError(\"xhr poll error\",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||\"GET\";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug(\"xhr open %s: %s\",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){xhr.responseType=\"arraybuffer\"}if(\"POST\"==this.method){try{if(this.isBinary){xhr.setRequestHeader(\"Content-type\",\"application/octet-stream\")}else{xhr.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}}catch(e){}}if(\"withCredentials\"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug(\"xhr data %s\",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit(\"success\");this.cleanup()};Request.prototype.onData=function(data){this.emit(\"data\",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit(\"error\",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if(\"undefined\"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader(\"Content-Type\").split(\";\")[0]}catch(e){}if(contentType===\"application/octet-stream\"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var ui8Arr=new Uint8Array(this.xhr.response);var dataArray=[];for(var idx=0,length=ui8Arr.length;idx<length;idx++){dataArray.push(ui8Arr[idx])}data=String.fromCharCode.apply(null,dataArray)}}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return\"undefined\"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent(\"onunload\",unloadHandler)}else if(global.addEventListener){global.addEventListener(\"beforeunload\",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-emitter\":15,\"component-inherit\":16,debug:17,\"xmlhttprequest-ssl\":10}],8:[function(_dereq_,module,exports){var Transport=_dereq_(\"../transport\");var parseqs=_dereq_(\"parseqs\");var parser=_dereq_(\"engine.io-parser\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling\");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name=\"polling\";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState=\"pausing\";function pause(){debug(\"paused\");self.readyState=\"paused\";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug(\"we are currently polling - waiting to pause\");total++;this.once(\"pollComplete\",function(){debug(\"pre-pause polling complete\");--total||pause()})}if(!this.writable){debug(\"we are currently writing - waiting to pause\");total++;this.once(\"drain\",function(){debug(\"pre-pause writing complete\");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug(\"polling\");this.polling=true;this.doPoll();this.emit(\"poll\")};Polling.prototype.onData=function(data){var self=this;debug(\"polling got data %s\",data);var callback=function(packet,index,total){if(\"opening\"==self.readyState){self.onOpen()}if(\"close\"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if(\"closed\"!=this.readyState){this.polling=false;this.emit(\"pollComplete\");if(\"open\"==this.readyState){this.poll()}else{debug('ignoring poll - transport state \"%s\"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug(\"writing close packet\");self.write([{type:\"close\"}])}if(\"open\"==this.readyState){debug(\"transport open - closing\");close()}else{debug(\"transport not open - deferring close\");this.once(\"open\",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit(\"drain\")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"https\":\"http\";var port=\"\";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&(\"https\"==schema&&this.port!=443||\"http\"==schema&&this.port!=80)){port=\":\"+this.port}if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query}},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,\"xmlhttprequest-ssl\":10,yeast:30}],9:[function(_dereq_,module,exports){(function(global){var Transport=_dereq_(\"../transport\");var parser=_dereq_(\"engine.io-parser\");var parseqs=_dereq_(\"parseqs\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:websocket\");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window===\"undefined\"){try{WebSocket=_dereq_(\"ws\")}catch(e){}}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name=\"websocket\";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}this.ws=BrowserWebSocket?new WebSocket(uri):new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType=\"buffer\"}else{this.ws.binaryType=\"arraybuffer\"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError(\"websocket error\",e)}};if(\"undefined\"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!BrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len=\"string\"==typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(BrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug(\"websocket closed before onclose event\")}--total||done()})})(packets[i])}function done(){self.emit(\"flush\");setTimeout(function(){self.writable=true;self.emit(\"drain\")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!==\"undefined\"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"wss\":\"ws\";var port=\"\";if(this.port&&(\"wss\"==schema&&this.port!=443||\"ws\"==schema&&this.port!=80)){port=\":\"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!(\"__initialize\"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,ws:undefined,yeast:30}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_(\"has-cors\");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if(\"undefined\"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(e){}}}},{\"has-cors\":22}],11:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error(\"after called too many times\")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],12:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],13:[function(_dereq_,module,exports){(function(chars){\"use strict\";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64=\"\";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];\nbase64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+\"=\"}else if(len%3===1){base64=base64.substring(0,base64.length-2)+\"==\"}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]===\"=\"){bufferLength--;if(base64[base64.length-2]===\"=\"){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\")},{}],14:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob([\"hi\"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],15:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],16:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],17:[function(_dereq_,module,exports){exports=module.exports=_dereq_(\"./debug\");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=\"undefined\"!=typeof chrome&&\"undefined\"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"];function useColors(){return\"WebkitAppearance\"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?\"%c\":\"\")+this.namespace+(useColors?\" %c\":\" \")+args[0]+(useColors?\"%c \":\" \")+\"+\"+exports.humanize(this.diff);if(!useColors)return args;var c=\"color: \"+this.color;args=[args[0],c,\"color: inherit\"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if(\"%%\"===match)return;index++;if(\"%c\"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return\"object\"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem(\"debug\")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{\"./debug\":18}],18:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_(\"ms\");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if(\"string\"!==typeof args[0]){args=[\"%o\"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match===\"%%\")return match;index++;var formatter=exports.formatters[format];if(\"function\"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if(\"function\"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||\"\").split(/[\\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\\*/g,\".*?\");if(namespaces[0]===\"-\"){exports.skips.push(new RegExp(\"^\"+namespaces.substr(1)+\"$\"))}else{exports.names.push(new RegExp(\"^\"+namespaces+\"$\"))}}}function disable(){exports.enable(\"\")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:25}],19:[function(_dereq_,module,exports){(function(global){var keys=_dereq_(\"./keys\");var hasBinary=_dereq_(\"has-binary\");var sliceBuffer=_dereq_(\"arraybuffer.slice\");var base64encoder=_dereq_(\"base64-arraybuffer\");var after=_dereq_(\"after\");var utf8=_dereq_(\"utf8\");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:\"error\",data:\"parser error\"};var Blob=_dereq_(\"blob\");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if(\"function\"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if(\"function\"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(\"\"+encoded)};function encodeBase64Object(packet,callback){var message=\"b\"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message=\"b\"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(\",\")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data==\"string\"||data===undefined){if(data.charAt(0)==\"b\"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType===\"blob\"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType===\"blob\"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary==\"function\"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback(\"0:\")}function setLengthHeader(message){return message.length+\":\"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(\"\"))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!=\"string\"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var packet;if(data==\"\"){return callback(err,0,1)}var length=\"\",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(\":\"!=chr){length+=chr}else{if(\"\"==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=\"\"}}if(length!=\"\"){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p===\"string\"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p===\"string\";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded===\"string\"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength=\"\";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg=\"\";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./keys\":20,after:11,\"arraybuffer.slice\":12,\"base64-arraybuffer\":13,blob:14,\"has-binary\":21,utf8:29}],20:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],21:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:24}],22:[function(_dereq_,module,exports){try{module.exports=typeof XMLHttpRequest!==\"undefined\"&&\"withCredentials\"in new XMLHttpRequest}catch(err){module.exports=false}},{}],23:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],24:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)==\"[object Array]\"}},{}],25:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if(\"string\"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=\"\"+str;if(str.length>1e4)return;var match=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||\"ms\").toLowerCase();switch(type){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return n*y;case\"days\":case\"day\":case\"d\":return n*d;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return n*h;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return n*m;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return n*s;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+\"d\";if(ms>=h)return Math.round(ms/h)+\"h\";if(ms>=m)return Math.round(ms/m)+\"m\";if(ms>=s)return Math.round(ms/s)+\"s\";return ms+\"ms\"}function long(ms){return plural(ms,d,\"day\")||plural(ms,h,\"hour\")||plural(ms,m,\"minute\")||plural(ms,s,\"second\")||ms+\" ms\"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+\" \"+name;return Math.ceil(ms/n)+\" \"+name+\"s\"}},{}],26:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\\],:{}\\s]*$/;var rvalidescape=/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\\s*\\[)+/g;var rtrimLeft=/^\\s+/;var rtrimRight=/\\s+$/;module.exports=function parsejson(data){if(\"string\"!=typeof data||!data){return null}data=data.replace(rtrimLeft,\"\").replace(rtrimRight,\"\");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,\"@\").replace(rvalidtokens,\"]\").replace(rvalidbraces,\"\"))){return new Function(\"return \"+data)()}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],27:[function(_dereq_,module,exports){exports.encode=function(obj){var str=\"\";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+=\"&\";str+=encodeURIComponent(i)+\"=\"+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split(\"&\");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split(\"=\");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],28:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;var parts=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];module.exports=function parseuri(str){var src=str,b=str.indexOf(\"[\"),e=str.indexOf(\"]\");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,\";\")+str.substring(e,str.length)}var m=re.exec(str||\"\"),uri={},i=14;while(i--){uri[parts[i]]=m[i]||\"\"}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,\":\");uri.authority=uri.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\");uri.ipv6uri=true}return uri}},{}],29:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports==\"object\"&&exports;var freeModule=typeof module==\"object\"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output=\"\";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error(\"Lone surrogate U+\"+codePoint.toString(16).toUpperCase()+\" is not a scalar value\")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol=\"\";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString=\"\";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error(\"Invalid byte index\")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error(\"Invalid continuation byte\")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error(\"Invalid byte index\")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error(\"Invalid UTF-8 detected\")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:\"2.0.0\",encode:utf8encode,decode:utf8decode};if(typeof define==\"function\"&&typeof define.amd==\"object\"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],30:[function(_dereq_,module,exports){\"use strict\";var alphabet=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded=\"\";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+\".\"+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],31:[function(_dereq_,module,exports){var url=_dereq_(\"./url\");var parser=_dereq_(\"socket.io-parser\");var Manager=_dereq_(\"./manager\");var debug=_dereq_(\"debug\")(\"socket.io-client\");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==\"object\"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts[\"force new connection\"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug(\"ignoring socket cache for %s\",source);io=Manager(source,opts)}else{if(!cache[id]){debug(\"new io instance for %s\",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_(\"./manager\");exports.Socket=_dereq_(\"./socket\")},{\"./manager\":32,\"./socket\":34,\"./url\":35,debug:39,\"socket.io-parser\":47}],32:[function(_dereq_,module,exports){var eio=_dereq_(\"engine.io-client\");var Socket=_dereq_(\"./socket\");var Emitter=_dereq_(\"component-emitter\");var parser=_dereq_(\"socket.io-parser\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:manager\");var indexOf=_dereq_(\"indexof\");var Backoff=_dereq_(\"backo2\");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&\"object\"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||\"/socket.io\";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState=\"closed\";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.engine.id}}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug(\"readyState %s\",this.readyState);if(~this.readyState.indexOf(\"open\"))return this;debug(\"opening %s\",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState=\"opening\";this.skipReconnect=false;var openSub=on(socket,\"open\",function(){self.onopen();fn&&fn()});var errorSub=on(socket,\"error\",function(data){debug(\"connect_error\");self.cleanup();self.readyState=\"closed\";self.emitAll(\"connect_error\",data);if(fn){var err=new Error(\"Connection error\");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug(\"connect attempt will timeout after %d\",timeout);var timer=setTimeout(function(){debug(\"connect attempt timed out after %d\",timeout);openSub.destroy();socket.close();socket.emit(\"error\",\"timeout\");self.emitAll(\"connect_timeout\",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug(\"open\");this.cleanup();this.readyState=\"open\";this.emit(\"open\");var socket=this.engine;this.subs.push(on(socket,\"data\",bind(this,\"ondata\")));this.subs.push(on(socket,\"ping\",bind(this,\"onping\")));this.subs.push(on(socket,\"pong\",bind(this,\"onpong\")));this.subs.push(on(socket,\"error\",bind(this,\"onerror\")));this.subs.push(on(socket,\"close\",bind(this,\"onclose\")));this.subs.push(on(this.decoder,\"decoded\",bind(this,\"ondecoded\")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll(\"ping\")};Manager.prototype.onpong=function(){this.emitAll(\"pong\",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit(\"packet\",packet)};Manager.prototype.onerror=function(err){debug(\"error\",err);this.emitAll(\"error\",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on(\"connecting\",onConnecting);\nsocket.on(\"connect\",function(){socket.id=self.engine.id});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug(\"writing packet %j\",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug(\"cleanup\");var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug(\"disconnect\");this.skipReconnect=true;this.reconnecting=false;if(\"opening\"==this.readyState){this.cleanup()}this.backoff.reset();this.readyState=\"closed\";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug(\"onclose\");this.cleanup();this.backoff.reset();this.readyState=\"closed\";this.emit(\"close\",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug(\"reconnect failed\");this.backoff.reset();this.emitAll(\"reconnect_failed\");this.reconnecting=false}else{var delay=this.backoff.duration();debug(\"will wait %dms before reconnect attempt\",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug(\"attempting reconnect\");self.emitAll(\"reconnect_attempt\",self.backoff.attempts);self.emitAll(\"reconnecting\",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug(\"reconnect attempt error\");self.reconnecting=false;self.reconnect();self.emitAll(\"reconnect_error\",err.data)}else{debug(\"reconnect success\");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll(\"reconnect\",attempt)}},{\"./on\":33,\"./socket\":34,backo2:36,\"component-bind\":37,\"component-emitter\":38,debug:39,\"engine.io-client\":1,indexof:42,\"socket.io-parser\":47}],33:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],34:[function(_dereq_,module,exports){var parser=_dereq_(\"socket.io-parser\");var Emitter=_dereq_(\"component-emitter\");var toArray=_dereq_(\"to-array\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:socket\");var hasBin=_dereq_(\"has-binary\");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,\"open\",bind(this,\"onopen\")),on(io,\"packet\",bind(this,\"onpacket\")),on(io,\"close\",bind(this,\"onclose\"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if(\"open\"==this.io.readyState)this.onopen();this.emit(\"connecting\");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift(\"message\");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if(\"function\"==typeof args[args.length-1]){debug(\"emitting packet with ack id %d\",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug(\"transport is open - connecting\");if(\"/\"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug(\"close (%s)\",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit(\"disconnect\",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit(\"error\",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug(\"emitting event %j\",args);if(null!=packet.id){debug(\"attaching ack callback to event\");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug(\"sending ack %j\",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if(\"function\"==typeof ack){debug(\"calling ack %s with %j\",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug(\"bad ack %s\",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit(\"connect\");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug(\"server disconnect (%s)\",this.nsp);this.destroy();this.onclose(\"io server disconnect\")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug(\"performing disconnect (%s)\",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose(\"io client disconnect\")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{\"./on\":33,\"component-bind\":37,\"component-emitter\":38,debug:39,\"has-binary\":41,\"socket.io-parser\":47,\"to-array\":51}],35:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_(\"parseuri\");var debug=_dereq_(\"debug\")(\"socket.io-client:url\");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+\"//\"+loc.host;if(\"string\"==typeof uri){if(\"/\"==uri.charAt(0)){if(\"/\"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\\/\\//.test(uri)){debug(\"protocol-less url %s\",uri);if(\"undefined\"!=typeof loc){uri=loc.protocol+\"//\"+uri}else{uri=\"https://\"+uri}}debug(\"parse %s\",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port=\"80\"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port=\"443\"}}obj.path=obj.path||\"/\";var ipv6=obj.host.indexOf(\":\")!==-1;var host=ipv6?\"[\"+obj.host+\"]\":obj.host;obj.id=obj.protocol+\"://\"+host+\":\"+obj.port;obj.href=obj.protocol+\"://\"+host+(loc&&loc.port==obj.port?\"\":\":\"+obj.port);return obj}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{debug:39,parseuri:45}],36:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],37:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if(\"string\"==typeof fn)fn=obj[fn];if(\"function\"!=typeof fn)throw new Error(\"bind() requires a function\");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],38:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[\"$\"+event]=this._callbacks[\"$\"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[\"$\"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[\"$\"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[\"$\"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[\"$\"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],39:[function(_dereq_,module,exports){arguments[4][17][0].apply(exports,arguments)},{\"./debug\":40,dup:17}],40:[function(_dereq_,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:44}],41:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON&&\"function\"==typeof obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:43}],42:[function(_dereq_,module,exports){arguments[4][23][0].apply(exports,arguments)},{dup:23}],43:[function(_dereq_,module,exports){arguments[4][24][0].apply(exports,arguments)},{dup:24}],44:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],45:[function(_dereq_,module,exports){arguments[4][28][0].apply(exports,arguments)},{dup:28}],46:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");var isBuf=_dereq_(\"./is-buffer\");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if(\"object\"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&\"object\"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&\"object\"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./is-buffer\":48,isarray:43}],47:[function(_dereq_,module,exports){var debug=_dereq_(\"debug\")(\"socket.io-parser\");var json=_dereq_(\"json3\");var isArray=_dereq_(\"isarray\");var Emitter=_dereq_(\"component-emitter\");var binary=_dereq_(\"./binary\");var isBuf=_dereq_(\"./is-buffer\");exports.protocol=4;exports.types=[\"CONNECT\",\"DISCONNECT\",\"EVENT\",\"BINARY_EVENT\",\"ACK\",\"BINARY_ACK\",\"ERROR\"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug(\"encoding packet %j\",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str=\"\";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+=\"-\"}if(obj.nsp&&\"/\"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=\",\";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=\",\";str+=json.stringify(obj.data)}debug(\"encoded %j as %s\",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if(\"string\"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit(\"decoded\",packet)}}else{this.emit(\"decoded\",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error(\"got binary data when not reconstructing a packet\")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit(\"decoded\",packet)}}}else{throw new Error(\"Unknown type: \"+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf=\"\";while(str.charAt(++i)!=\"-\"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!=\"-\"){throw new Error(\"Illegal attachments\")}p.attachments=Number(buf)}if(\"/\"==str.charAt(i+1)){p.nsp=\"\";while(++i){var c=str.charAt(i);if(\",\"==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp=\"/\"}var next=str.charAt(i+1);if(\"\"!==next&&Number(next)==next){p.id=\"\";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug(\"decoded %s as %j\",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:\"parser error\"}}},{\"./binary\":46,\"./is-buffer\":48,\"component-emitter\":49,debug:39,isarray:43,json3:50}],48:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],49:[function(_dereq_,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],50:[function(_dereq_,module,exports){(function(global){(function(){var isLoader=typeof define===\"function\"&&define.amd;var objectTypes={\"function\":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global==\"object\"&&global;if(freeGlobal&&(freeGlobal[\"global\"]===freeGlobal||freeGlobal[\"window\"]===freeGlobal||freeGlobal[\"self\"]===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root[\"Object\"]());exports||(exports=root[\"Object\"]());var Number=context[\"Number\"]||root[\"Number\"],String=context[\"String\"]||root[\"String\"],Object=context[\"Object\"]||root[\"Object\"],Date=context[\"Date\"]||root[\"Date\"],SyntaxError=context[\"SyntaxError\"]||root[\"SyntaxError\"],TypeError=context[\"TypeError\"]||root[\"TypeError\"],Math=context[\"Math\"]||root[\"Math\"],nativeJSON=context[\"JSON\"]||root[\"JSON\"];if(typeof nativeJSON==\"object\"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name==\"bug-string-char-index\"){isSupported=\"a\"[0]!=\"a\"}else if(name==\"json\"){isSupported=has(\"json-stringify\")&&has(\"json-parse\")}else{var value,serialized='{\"a\":[1,true,false,null,\"\\\\u0000\\\\b\\\\n\\\\f\\\\r\\\\t\"]}';if(name==\"json-stringify\"){var stringify=exports.stringify,stringifySupported=typeof stringify==\"function\"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)===\"0\"&&stringify(new Number)===\"0\"&&stringify(new String)=='\"\"'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)===\"1\"&&stringify([value])==\"[1]\"&&stringify([undef])==\"[null]\"&&stringify(null)==\"null\"&&stringify([undef,getClass,null])==\"[null,null,null]\"&&stringify({a:[value,true,false,null,\"\\x00\\b\\n\\f\\r\t\"]})==serialized&&stringify(null,value)===\"1\"&&stringify([1,2],null,1)==\"[\\n 1,\\n 2\\n]\"&&stringify(new Date(-864e13))=='\"-271821-04-20T00:00:00.000Z\"'&&stringify(new Date(864e13))=='\"+275760-09-13T00:00:00.000Z\"'&&stringify(new Date(-621987552e5))=='\"-000001-01-01T00:00:00.000Z\"'&&stringify(new Date(-1))=='\"1969-12-31T23:59:59.999Z\"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name==\"json-parse\"){var parse=exports.parse;if(typeof parse==\"function\"){try{if(parse(\"0\")===0&&!parse(false)){value=parse(serialized);var parseSupported=value[\"a\"].length==5&&value[\"a\"][0]===1;if(parseSupported){try{parseSupported=!parse('\"\t\"')}catch(exception){}if(parseSupported){try{parseSupported=parse(\"01\")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse(\"1.\")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has(\"json\")){var functionClass=\"[object Function]\",dateClass=\"[object Date]\",numberClass=\"[object Number]\",stringClass=\"[object String]\",arrayClass=\"[object Array]\",booleanClass=\"[object Boolean]\";var charIndexBuggy=has(\"bug-string-char-index\");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=[\"valueOf\",\"toString\",\"toLocaleString\",\"propertyIsEnumerable\",\"isPrototypeOf\",\"hasOwnProperty\",\"constructor\"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!=\"function\"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property==\"prototype\")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property==\"prototype\")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property==\"prototype\")&&isProperty.call(object,property)&&!(isConstructor=property===\"constructor\")){callback(property)}}if(isConstructor||isProperty.call(object,property=\"constructor\")){callback(property)}}}return forEach(object,callback)};if(!has(\"json-stringify\")){var Escapes={92:\"\\\\\\\\\",34:'\\\\\"',8:\"\\\\b\",12:\"\\\\f\",10:\"\\\\n\",13:\"\\\\r\",9:\"\\\\t\"};var leadingZeroes=\"000000\";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix=\"\\\\u00\";var quote=function(value){var result='\"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(\"\"):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'\"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value==\"object\"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,\"toJSON\")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?\"-\":\"+\")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+\"-\"+toPaddedString(2,month+1)+\"-\"+toPaddedString(2,date)+\"T\"+toPaddedString(2,hours)+\":\"+toPaddedString(2,minutes)+\":\"+toPaddedString(2,seconds)+\".\"+toPaddedString(3,milliseconds)+\"Z\"}else{value=null}}else if(typeof value.toJSON==\"function\"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,\"toJSON\"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return\"null\"}className=getClass.call(value);if(className==booleanClass){return\"\"+value}else if(className==numberClass){return value>-1/0&&value<1/0?\"\"+value:\"null\"}else if(className==stringClass){return quote(\"\"+value)}if(typeof value==\"object\"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?\"null\":element)}result=results.length?whitespace?\"[\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"]\":\"[\"+results.join(\",\")+\"]\":\"[]\"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+\":\"+(whitespace?\" \":\"\")+element)}});result=results.length?whitespace?\"{\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"}\":\"{\"+results.join(\",\")+\"}\":\"{}\"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace=\"\",width>10&&(width=10);whitespace.length<width;whitespace+=\" \");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize(\"\",(value={},value[\"\"]=source,value),callback,properties,whitespace,\"\",[])}}if(!has(\"json-parse\")){var fromCharCode=String.fromCharCode;var Unescapes={92:\"\\\\\",34:'\"',47:\"/\",98:\"\\b\",116:\"\t\",110:\"\\n\",102:\"\\f\",114:\"\\r\"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value=\"@\",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode(\"0x\"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)==\"true\"){Index+=4;return true}else if(source.slice(Index,Index+5)==\"false\"){Index+=5;return false}else if(source.slice(Index,Index+4)==\"null\"){Index+=4;return null}abort()}}return\"$\"};var get=function(value){var results,hasMembers;if(value==\"$\"){abort()}if(typeof value==\"string\"){if((charIndexBuggy?value.charAt(0):value[0])==\"@\"){return value.slice(1)}if(value==\"[\"){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"]\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"]\"){abort()}}else{abort()}}if(value==\",\"){abort()}results.push(get(value))}return results}else if(value==\"{\"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"}\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"}\"){abort()}}else{abort()}}if(value==\",\"||typeof value!=\"string\"||(charIndexBuggy?value.charAt(0):value[0])!=\"@\"||lex()!=\":\"){abort()}results[value.slice(1)]=get(lex())\n}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value==\"object\"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=\"\"+source;result=get(lex());if(lex()!=\"$\"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[\"\"]=result,value),\"\",callback):result}}}exports[\"runInContext\"]=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root[\"JSON3\"],isRestored=false;var JSON3=runInContext(root,root[\"JSON3\"]={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root[\"JSON3\"]=previousJSON;nativeJSON=previousJSON=null}return JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],51:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[31])(31)});\n\n    \n      ;var weight = document.getElementById('weight');\n      var socket = io('http://{{ip}}:5004');\n      socket.on('getWeight', function(msg) {\n        weight.innerHTML = msg;\n    \n      }); \n    }, 1000);\n    </script>\n\n  </body>\n</html>\n","x":510,"y":940,"wires":[["60bdff3c.885ab"]]},{"id":"60bdff3c.885ab","type":"http response","z":"cbb45903.f34358","name":"","x":650,"y":940,"wires":[]},{"id":"745b6cda.db8fc4","type":"function","z":"cbb45903.f34358","name":"set ip","func":"msg.ip = global.get('ip');\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":940,"wires":[["79c16ad8.f6ed44"]]},{"id":"2166e2e.dfd8d1e","type":"function","z":"cbb45903.f34358","name":"Вес по осям","func":"msg.payload = \"\"+msg.payload+\"<br/>\"+msg.weight1+\"<br/>\"+msg.weight2+\"\";\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":520,"wires":[["58850680.2a27f8"]]},{"id":"54720245.2a051c","type":"json","z":"cbb45903.f34358","name":"","x":1164.285888671875,"y":311.4286193847656,"wires":[["1a8e189a.ba3187"]]},{"id":"1a8e189a.ba3187","type":"debug","z":"cbb45903.f34358","name":"GD event","active":false,"console":"true","complete":"payload","x":1307.1429443359375,"y":312.8572082519531,"wires":[]},{"id":"9647b3b1.e0d47","type":"function","z":"cbb45903.f34358","name":"parser","func":"var str = {\n    payload: msg.payload,\n    event_id: msg.event_id,\n    metadata: msg.metadata,\n    driverWeight: msg.driverWeight,\n    description: msg.description,\n    url: msg.url,\n    main_host: msg.main_host,\n    event_url: msg.event_url,\n    statusCode: msg.statusCode,\n    responseUrl: msg.responseUrl\n    \n};\nmsg.payload = JSON.stringify(str);\nreturn msg;","outputs":1,"noerr":0,"x":1350,"y":400,"wires":[["da29d0ad.e651b"]]},{"id":"da29d0ad.e651b","type":"debug","z":"cbb45903.f34358","name":"GD response event","active":false,"console":"true","complete":"payload","x":1520,"y":400,"wires":[]},{"id":"83fc0b9f.a0a0f8","type":"debug","z":"cbb45903.f34358","name":"GD device config","active":false,"console":"true","complete":"payload","x":1070,"y":180,"wires":[]},{"id":"a34b7bf5.99cc98","type":"json","z":"cbb45903.f34358","name":"","x":910,"y":180,"wires":[["83fc0b9f.a0a0f8"]]},{"id":"a8a6473b.dbe1a8","type":"function","z":"cbb45903.f34358","name":"events payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_2');\nvar snapshot_events = flow.get('snapshot_events');\nvar snapshot = false;\n\nif (snapshot_events.indexOf(event_id)>=0){\n    snapshot = true;\n}\n\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'devices':[{'id':scale_id}],\n    'data':msg.metadata,\n    'description':msg.description\n};\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n};\n\nmsg.url = flow.get('main_host')+flow.get('event_url');\nmsg.main_host = flow.get('main_host');\nmsg.event_url = flow.get('event_url');\nmsg.snapshot = snapshot;\nreturn msg;","outputs":1,"noerr":0,"x":933.9046630859375,"y":337.2618408203125,"wires":[["54720245.2a051c","8584fbac.1c6418","32ba32c.2bc7cce"]]},{"id":"24ba7b06.cde384","type":"function","z":"cbb45903.f34358","name":"device config","func":"var device_config = JSON.parse(msg.payload);\n\nflow.set('scale_id',device_config.scale_id);\nflow.set('event_move_in_id',device_config.event_move_in_id);\nflow.set('event_move_in_minus_id',device_config.event_move_in_minus_id);\nflow.set('event_move_out_id',device_config.event_move_out_id);\nflow.set('event_max_weight_id',device_config.event_max_weight_id);\nflow.set('event_off_id',device_config.event_off_id);\nflow.set('event_on_id', device_config.event_on_id);\nflow.set('event_max_duration',device_config.event_max_duration);\nflow.set('event_fake_traffic',device_config.event_fake_traffic);\nflow.set('event_driver_in', device_config.event_driver_in);\nflow.set('main_host',device_config.main_host);\nflow.set('event_url',device_config.event_url);\nflow.set('state_url',device_config.state_url);\nflow.set('maxWeight',device_config.maxWeight);\nflow.set('minWeight',device_config.minWeight);\nflow.set('maxDuration',device_config.maxDuration);\nflow.set('checkHealthTimeout',device_config.checkHealthTimeout);\nflow.set('event_get_weight_acc',device_config.event_get_weight_acc);\nflow.set('event_min_weight',device_config.event_min_weight);\nflow.set('minTriggerWeight',device_config.minTriggerWeight);\nflow.set('snapshot_url',device_config.snapshot_url);\nflow.set('snapshot_events',device_config.snapshot_events);\nflow.set('driverWeight',device_config.driverWeight)\n\nmsg.payload = {\n\tscale_id: flow.get('scale_id'),\n\tevent_move_in_id: flow.get('event_move_in_id'),\n\tevent_move_in_minus_id: flow.get('event_move_in_minus_id'),\n\tevent_move_out_id: flow.get('event_move_out_id'),\n\tevent_max_weight_id: flow.get('event_max_weight_id'),\n\tevent_off_id: flow.get('event_off_id'),\n\tevent_on_id: flow.get('event_on_id'),\n\tevent_max_duration: flow.get('event_max_duration'),\n\tevent_fake_traffic: flow.get('event_fake_traffic'),\n\tevent_driver_in: flow.get('event_driver_in'),\n\tmain_host: flow.get('main_host'),\n\tevent_url: flow.get('event_url'),\n\tstate_url: flow.get('state_url'),\n\tmaxWeight: flow.get('maxWeight'),\n\tminWeight: flow.get('minWeight'),\n\tmaxDuration: flow.get('maxDuration'),\n\tcheckHealthTimeout: flow.get('checkHealthTimeout'),\n\tevent_get_weight_acc: flow.get('event_get_weight_acc'),\n\tevent_min_weight: flow.get('event_min_weight'),\n\tminTriggerWeight: flow.get('minTriggerWeight'),\n\tsnapshot_url: flow.get('snapshot_url'),\n\tsnapshot_events: flow.get('snapshot_events'),\n\tdriverWeight: flow.get('driverWeight')\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":770,"y":180,"wires":[["a34b7bf5.99cc98"]]},{"id":"de53fabd.baca28","type":"delay","z":"cbb45903.f34358","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":180,"wires":[["37c6840b.c65c2c"]]},{"id":"46dd7d79.222584","type":"trigger","z":"cbb45903.f34358","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","name":"","x":340,"y":220,"wires":[["6a42610a.da668"]]},{"id":"8e2616c6.2be0c8","type":"debug","z":"6754df2.8b2bd2","name":"","active":true,"console":"false","complete":"false","x":270,"y":40,"wires":[]},{"id":"30b0c211.8cb41e","type":"debug","z":"962df517.4837f8","name":"","active":false,"console":"false","complete":"true","x":1330,"y":60,"wires":[]},{"id":"57849cc7.3b8674","type":"tcp request","z":"71f38711.545228","server":"10.107.5.104","port":"1888","out":"char","splitc":"0x0d","name":"","x":340,"y":160,"wires":[["e399887e.c71be8","93da2ab2.aa9ca8","7c80d97c.6b4418"]]},{"id":"e5cfaaa3.6295e8","type":"debug","z":"71f38711.545228","name":"","active":false,"console":"false","complete":"false","x":730,"y":160,"wires":[]},{"id":"cd9c01bb.c512e","type":"debug","z":"962df517.4837f8","name":"","active":true,"console":"false","complete":"false","x":530,"y":220,"wires":[]},{"id":"756e5a64.d33c54","type":"function","z":"962df517.4837f8","name":"sid","func":"// let sid = msg.payload.sid;\n// msg.sid = sid;\n\n\nmsg.sid =  flow.get('sid');\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":120,"wires":[["ff3c26ce.0fbfd8"]]},{"id":"ff3c26ce.0fbfd8","type":"function","z":"962df517.4837f8","name":"","func":"msg.url =\"https://10.107.9.100:8080/channels?sid=\" + msg.sid;\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":120,"wires":[["bcda6187.2e966"]]},{"id":"bcda6187.2e966","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"txt","url":"","tls":"d049c21b.cdc58","x":830,"y":120,"wires":[["637d5c2b.d821c4","d52eb8d7.ca0318","51ff3f60.fe0bd"]]},{"id":"545b0d24.3cd1e4","type":"inject","z":"d6bade09.4de0d","name":"cmd step-by-step","topic":"","payload":"cmd","payloadType":"flow","repeat":"2","crontab":"","once":false,"x":130,"y":120,"wires":[["dc05fccc.04577"]]},{"id":"dc05fccc.04577","type":"tcp request","z":"d6bade09.4de0d","server":"10.107.5.103","port":"1885","out":"char","splitc":"\\n","name":"","x":340,"y":120,"wires":[["22b514a2.4d02fc","209dc59d.32d45a"]]},{"id":"22b514a2.4d02fc","type":"function","z":"d6bade09.4de0d","name":"toString","func":"msg.payload = msg.payload.toString();\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":120,"wires":[["54e44b4.b1835b4","fc8c7f59.7a186","ed11b933.3cb568"]]},{"id":"f8017270.c5a04","type":"inject","z":"71f38711.545228","name":"cmd step-by-step","topic":"","payload":"cmd","payloadType":"flow","repeat":"1","crontab":"","once":false,"x":130,"y":160,"wires":[["57849cc7.3b8674","c44c6d3b.816eb"]]},{"id":"e399887e.c71be8","type":"function","z":"71f38711.545228","name":"toString","func":"msg.payload = msg.payload.toString();\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":160,"wires":[["e5cfaaa3.6295e8","14ff4e7b.3395e2","8fafc633.841de8"]]},{"id":"e5ba05aa.9c1de8","type":"comment","z":"71f38711.545228","name":"info","info":"\"ALL 100 0 100 0 0 0 10000 0 1 0 65 \"//1\n\"ALL 50 0 50 0 0 0 10000 0 1 0 65 \"\n\"ALL 100 100 0 0 0 0 10000 0 1 0 65 \"//2\n","x":70,"y":120,"wires":[]},{"id":"552a8b7b.66a554","type":"http in","z":"3de7a235.4ff04e","name":"","url":"/send/1c","method":"post","swaggerDoc":"","x":150,"y":680,"wires":[["de843f41.0e2a3","c0245cc6.36f4d"]]},{"id":"b28744f0.644c08","type":"http response","z":"3de7a235.4ff04e","name":"","x":870,"y":660,"wires":[]},{"id":"de843f41.0e2a3","type":"function","z":"3de7a235.4ff04e","name":"","func":"//msg.url = \"https://10.101.1.17/ELC_SCAT/hs/PerimeterControl/api/Granary/RaiseBarrier\";\n\nmsg.url = global.get(\"send_1c_url_RaiseBarrier\");\n\n\n\n//msg.payload = JSON.parse(msg.payload);\nflow.set(\"resApex\", msg.res);\nflow.set(\"reqApex\", msg.req);\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":660,"wires":[["55098490.9c38fc","3a373e01.28efa2"]]},{"id":"55098490.9c38fc","type":"http request","z":"3de7a235.4ff04e","name":"","method":"POST","ret":"txt","url":"","tls":"f436a52.4d81958","x":490,"y":660,"wires":[["83d6ba03.466198","94c8db47.76b2f8"]]},{"id":"bb2b676.e2f8798","type":"comment","z":"3de7a235.4ff04e","name":"Відправка з Апекса на 1С","info":"apiuser\napiuser","x":150,"y":600,"wires":[]},{"id":"83d6ba03.466198","type":"debug","z":"3de7a235.4ff04e","name":"res 1c","active":false,"console":"false","complete":"true","x":690,"y":620,"wires":[]},{"id":"54e44b4.b1835b4","type":"debug","z":"d6bade09.4de0d","name":"","active":false,"console":"false","complete":"false","x":670,"y":120,"wires":[]},{"id":"ffb4774e.d3bf38","type":"function","z":"6754df2.8b2bd2","name":"Body message","func":"let send1C = {\n    truck_id: \"\",\n    device_id: global.get('device_id_infratec_2'),\n    message: msg.payload\n};\n\n msg.payload = send1C;\n msg.url = global.get(\"send_1c_url_quality\");\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":260,"wires":[["8fb3460d.7dd668","16b1fb29.68b905","3d371068.ab45d"]]},{"id":"66332715.86b638","type":"inject","z":"6754df2.8b2bd2","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":260,"wires":[["ef06e167.6c2af"]]},{"id":"ef06e167.6c2af","type":"function","z":"6754df2.8b2bd2","name":"","func":"msg.payload = `21-06-01     16:17\nCO261107     Corn\n\n~04180414~ ~043E043104400430043704460430~           130C33EA130C33EA\n~04180414~ ~043A043B04380435043D04420430~           130C33EA\n\n                          \n    Oil (DM)   3.8        \nProtein (DM)   9.2        \n    Moisture  12.6        \n Starch (DM)  73.6        `;\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":260,"wires":[["ffb4774e.d3bf38"]]},{"id":"8fb3460d.7dd668","type":"debug","z":"6754df2.8b2bd2","name":"","active":true,"console":"true","complete":"true","x":770,"y":260,"wires":[]},{"id":"3d371068.ab45d","type":"http request","z":"6754df2.8b2bd2","name":"Send","method":"POST","ret":"txt","url":"","tls":"f436a52.4d81958","x":610,"y":240,"wires":[["8fb3460d.7dd668"]]},{"id":"16b1fb29.68b905","type":"json","z":"6754df2.8b2bd2","name":"","x":610,"y":280,"wires":[["8fb3460d.7dd668"]]},{"id":"d8711c9f.7ad2f","type":"comment","z":"6754df2.8b2bd2","name":"Відправка в 1С","info":"","x":100,"y":220,"wires":[]},{"id":"81776839.e21738","type":"comment","z":"6754df2.8b2bd2","name":"Відправка шрих коду","info":"","x":320,"y":600,"wires":[]},{"id":"d9505979.aed6b8","type":"comment","z":"6754df2.8b2bd2","name":"Ініціалізація","info":"","x":110,"y":500,"wires":[]},{"id":"94c8db47.76b2f8","type":"function","z":"3de7a235.4ff04e","name":"","func":" let statusCode = msg.statusCode;\n \n if(statusCode === \"HPE_INVALID_CONSTANT\"){\n    msg.payload = {statusCode: 204}; \n    msg.statusCode = 200;\n } else {\n     msg.payload = {statusCode: statusCode};    \n }\n\n// delete msg.headers;\n//delete msg.responseUrl;\n//delete msg.url;\n\n//msg.headers = {};\n//msg.headers[\"content-type\"] = \"application/json\";\n\n// msg.res = flow.get(\"resApex\");\n //msg.req = flow.get(\"reqApex\");\n\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":660,"wires":[["bb63cc31.633dd","b28744f0.644c08"]]},{"id":"bb63cc31.633dd","type":"debug","z":"3de7a235.4ff04e","name":"","active":false,"console":"true","complete":"true","x":910,"y":580,"wires":[]},{"id":"3c368ed7.e22212","type":"inject","z":"3de7a235.4ff04e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":640,"wires":[["de843f41.0e2a3"]]},{"id":"b67483b6.e4a5d","type":"comment","z":"962df517.4837f8","name":"Запис і зчитуання події у файлі","info":"Трассир SDK.\nАдрес сервера 10.107.9.200    SDK port 8080\nПользователь SDK:\nLogin:  Admin\nPass:  Admin@RHN_Trassir\n\nhttps://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir\n\n\n\n\n","x":210,"y":760,"wires":[]},{"id":"ccce9feb.a4972","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":800,"wires":[["a4ba12e7.f1642"]]},{"id":"a4ba12e7.f1642","type":"function","z":"962df517.4837f8","name":"","func":"\nvar url = \"https://10.107.9.100:8080/lpr_events??username=Admin&password=Admin@RHN_Trassir\";\n\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":800,"wires":[["c711415f.04df4"]]},{"id":"c711415f.04df4","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"obj","url":"https://10.107.9.100:8080/lpr_events??username=Admin&password=Admin@RHN_Trassir","tls":"d049c21b.cdc58","x":410,"y":800,"wires":[["8a9a0b29.272b18"]]},{"id":"5d70c396.d9564c","type":"debug","z":"962df517.4837f8","name":"","active":false,"console":"false","complete":"true","x":830,"y":840,"wires":[]},{"id":"c6a52e02.aa411","type":"file","z":"962df517.4837f8","name":"","filename":"infoEvent.txt","appendNewline":true,"createDir":true,"overwriteFile":"true","x":850,"y":800,"wires":[]},{"id":"daacd6f0.4e5288","type":"file in","z":"962df517.4837f8","name":"","filename":"infoEvent.txt","format":"utf8","x":290,"y":940,"wires":[["8f8daca5.c135"]]},{"id":"d559978.64c6968","type":"debug","z":"962df517.4837f8","name":"","active":false,"console":"false","complete":"true","x":690,"y":940,"wires":[]},{"id":"8a9a0b29.272b18","type":"function","z":"962df517.4837f8","name":"","func":"let findComment = msg.payload.indexOf('*');\nlet subString =  msg.payload.substring(\"0\", findComment - 1);\nmsg.payload = subString;\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":800,"wires":[["6f8b0856.047378"]]},{"id":"6f8b0856.047378","type":"json","z":"962df517.4837f8","name":"","x":690,"y":800,"wires":[["c6a52e02.aa411","5d70c396.d9564c"]]},{"id":"52e786bb.7382f8","type":"http in","z":"962df517.4837f8","name":"","url":"/getScreenshot/number","method":"get","swaggerDoc":"","x":200,"y":1140,"wires":[["5b2ef484.1ca5fc"]]},{"id":"5b2ef484.1ca5fc","type":"function","z":"962df517.4837f8","name":"","func":"flow.set('idChannel2', msg.payload.idChannel);\n\nflow.set('res2', msg.res);\nflow.set('req2', msg.req);\n\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":1220,"wires":[["8dd44e2e.8c907"]]},{"id":"8dd44e2e.8c907","type":"function","z":"962df517.4837f8","name":"sid","func":"//let sid = msg.payload.sid;\nmsg.sid =  flow.get('sid');\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":1300,"wires":[["fc354ad9.fb5508"]]},{"id":"6d0d0642.f04a88","type":"function","z":"962df517.4837f8","name":"screenshot","func":"let guidChannel = flow.get(\"idChannel2\");\nlet timestamp = flow.get(\"timestamp\");\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?timestamp=${timestamp}&sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res2');\nmsg.req = flow.get('req2');\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":1460,"wires":[["2d9a479b.5964b8"]]},{"id":"2d9a479b.5964b8","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":370,"y":1500,"wires":[["f953edc5.cbe9b"]]},{"id":"d344db27.d43098","type":"http response","z":"962df517.4837f8","name":"","x":410,"y":1580,"wires":[]},{"id":"f097c41c.a1b828","type":"comment","z":"962df517.4837f8","name":"Отримання фото з номером авто","info":"","x":180,"y":1080,"wires":[]},{"id":"ad748d5b.2a67","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":100,"y":940,"wires":[["daacd6f0.4e5288"]]},{"id":"8f8daca5.c135","type":"json","z":"962df517.4837f8","name":"","x":430,"y":940,"wires":[["12f4b1d6.e4390e"]]},{"id":"12f4b1d6.e4390e","type":"function","z":"962df517.4837f8","name":"","func":"let guidChannel = flow.get('idChannel3');\nconst arrayEvent = msg.payload;\n\nlet newArrayChannel = arrayEvent.filter(function findChannel(el){\n    if(el.channel === guidChannel) return true;\n});\n\nlet lastId = newArrayChannel.length;\n\n\nlet best_guess = newArrayChannel[lastId -1].best_guess;\nlet channel = newArrayChannel[lastId -1].channel;\nlet id = newArrayChannel[lastId -1].id;\nlet time_bestview = newArrayChannel[lastId -1].time_bestview;\n\n//flow.set('timestamp', time_bestview);\n//msg.payload = {best_guess, channel, id, time_bestview};\n\nmsg.payload = arrayEvent;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":940,"wires":[["d559978.64c6968","24c1d2eb.e58cee"]]},{"id":"f953edc5.cbe9b","type":"function","z":"962df517.4837f8","name":"","func":"// msg.payload = {\n//     photo: msg.payload,\n//     best_guess: flow.get('best_guess'),\n//     timestamp: flow.get('timestamp')\n// };\n\nmsg.payload = {\n    photo: msg.payload.toString('base64'),\n    best_guess: flow.get('best_guess'),\n    timestamp: flow.get('timestamp')\n};\n\n\n\nmsg.headers = {};\nmsg.headers[\"content-type\"] = \"application/json\";\nmsg.res = flow.get('res2');\nmsg.req = flow.get('req2');\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":1540,"wires":[["d344db27.d43098","941ad46a.709cf8"]]},{"id":"32b137a2.370568","type":"file in","z":"962df517.4837f8","name":"","filename":"infoEvent.txt","format":"utf8","x":250,"y":1340,"wires":[["a4cf6a30.2f55f8"]]},{"id":"a4cf6a30.2f55f8","type":"json","z":"962df517.4837f8","name":"","x":270,"y":1380,"wires":[["9a175419.386da8"]]},{"id":"9a175419.386da8","type":"function","z":"962df517.4837f8","name":"","func":"//channel\nlet guidChannel = flow.get(\"idChannel2\");\nconst arrayEvent = msg.payload;\n\nlet newArrayChannel = arrayEvent.filter(function findChannel(el){\n    if(el.channel === guidChannel) return true;\n});\n\nlet lastId = newArrayChannel.length;\n\n\nlet best_guess = newArrayChannel[lastId -1].best_guess;\nlet channel = newArrayChannel[lastId -1].channel;\nlet id = newArrayChannel[lastId -1].id;\nlet time_bestview = newArrayChannel[lastId -1].time_bestview;\n\nflow.set('timestamp', time_bestview);\nflow.set('best_guess', best_guess);\nmsg.payload = {best_guess, channel, id, time_bestview};\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":1420,"wires":[["6d0d0642.f04a88"]]},{"id":"fc354ad9.fb5508","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"txt","url":"https://10.107.9.100:8080/lpr_events??username=Admin&password=Admin@RHN_Trassir","tls":"d049c21b.cdc58","x":490,"y":1180,"wires":[["78f3efb7.1d241","92d1a55a.61d2a8"]]},{"id":"78f3efb7.1d241","type":"function","z":"962df517.4837f8","name":"","func":"let findComment = msg.payload.indexOf('*');\nlet subString =  msg.payload.substring(\"0\", findComment - 1);\nmsg.payload = subString;\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":1180,"wires":[["4c447fcb.c2b97"]]},{"id":"4c447fcb.c2b97","type":"json","z":"962df517.4837f8","name":"","x":750,"y":1180,"wires":[["560fa64.a97fa58","df6ee005.69aa6"]]},{"id":"560fa64.a97fa58","type":"file","z":"962df517.4837f8","name":"","filename":"infoEvent.txt","appendNewline":true,"createDir":true,"overwriteFile":"true","x":890,"y":1180,"wires":[]},{"id":"df6ee005.69aa6","type":"delay","z":"962df517.4837f8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":790,"y":1260,"wires":[["32b137a2.370568"]]},{"id":"941ad46a.709cf8","type":"debug","z":"962df517.4837f8","name":"","active":false,"console":"false","complete":"false","x":530,"y":1540,"wires":[]},{"id":"92d1a55a.61d2a8","type":"debug","z":"962df517.4837f8","name":"","active":false,"console":"false","complete":"false","x":650,"y":1140,"wires":[]},{"id":"86d071f3.037a4","type":"http in","z":"962df517.4837f8","name":"","url":"/events/number","method":"get","swaggerDoc":"","x":170,"y":880,"wires":[["4349473f.661fd8"]]},{"id":"24c1d2eb.e58cee","type":"http response","z":"962df517.4837f8","name":"","x":690,"y":980,"wires":[]},{"id":"4349473f.661fd8","type":"function","z":"962df517.4837f8","name":"","func":"flow.set('idChannel3', msg.payload.idChannel);\n\nflow.set('res3', msg.res);\nflow.set('req3', msg.req);\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":880,"wires":[["daacd6f0.4e5288"]]},{"id":"6c5fb7d4.1c0e68","type":"http in","z":"962df517.4837f8","name":"","url":"/getScreenshot/static","method":"get","swaggerDoc":"","x":170,"y":1760,"wires":[["48f03d21.e3d4d4"]]},{"id":"48f03d21.e3d4d4","type":"function","z":"962df517.4837f8","name":"","func":"flow.set('idChannel', msg.payload.idChannel);\n\nflow.set('res', msg.res);\nflow.set('req', msg.req);\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":1760,"wires":[["8b8de75e.b971e8"]]},{"id":"8b8de75e.b971e8","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"obj","url":"https://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir","tls":"d049c21b.cdc58","x":550,"y":1760,"wires":[["9eac62bc.05065"]]},{"id":"9eac62bc.05065","type":"function","z":"962df517.4837f8","name":"sid","func":"let sid = msg.payload.sid;\nmsg.sid = sid;\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":1760,"wires":[["9e537117.47a91"]]},{"id":"9e537117.47a91","type":"function","z":"962df517.4837f8","name":"screenshot","func":"let guidChannel = \"TpXhOD0i\";\nlet timestamp = \"1622472150857210\";\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?timestamp=${timestamp}&sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":1760,"wires":[["ce1c679d.f8cc68"]]},{"id":"ce1c679d.f8cc68","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":990,"y":1760,"wires":[["971f5f8f.09a2c"]]},{"id":"971f5f8f.09a2c","type":"http response","z":"962df517.4837f8","name":"","x":1150,"y":1760,"wires":[]},{"id":"a38b07f5.6c9b78","type":"comment","z":"962df517.4837f8","name":"Отримання фото статичні параметри","info":"","x":180,"y":1720,"wires":[]},{"id":"c549de5b.15392","type":"comment","z":"962df517.4837f8","name":"Получение events","info":"Трассир SDK.\nАдрес сервера 10.107.9.200    SDK port 8080\nПользователь SDK:\nLogin:  Admin\nPass:  Admin@RHN_Trassir\n\nhttps://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir\n\n\n\n\n","x":130,"y":1960,"wires":[]},{"id":"c3f3313e.156eb","type":"function","z":"962df517.4837f8","name":"","func":"\nvar url = \"https://10.107.9.100:8080/lpr_events??username=Admin&password=Admin@RHN_Trassir\";\n\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":2000,"wires":[["f9080f45.61bd3"]]},{"id":"f9080f45.61bd3","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"obj","url":"https://10.107.9.100:8080/lpr_events??username=Admin&password=Admin@RHN_Trassir","tls":"d049c21b.cdc58","x":450,"y":2000,"wires":[["13a9f91b.5f8277"]]},{"id":"13a9f91b.5f8277","type":"function","z":"962df517.4837f8","name":"","func":"let findComment = msg.payload.indexOf('*');\nlet subString =  msg.payload.substring(\"0\", findComment - 1);\nmsg.payload = subString;\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":2000,"wires":[["6c104352.d113ec"]]},{"id":"6c104352.d113ec","type":"json","z":"962df517.4837f8","name":"","x":710,"y":2000,"wires":[["459ee0fb.eadbf","52612eb1.7cc2"]]},{"id":"dd42b9ce.b02518","type":"http in","z":"962df517.4837f8","name":"","url":"/get/event","method":"get","swaggerDoc":"","x":130,"y":2000,"wires":[["c3f3313e.156eb"]]},{"id":"459ee0fb.eadbf","type":"debug","z":"962df517.4837f8","name":"","active":false,"console":"false","complete":"true","x":850,"y":2040,"wires":[]},{"id":"52612eb1.7cc2","type":"http response","z":"962df517.4837f8","name":"","x":850,"y":2000,"wires":[]},{"id":"32e768ae.cef938","type":"function","z":"ee144e5a.86352","name":"Body message","func":"let send1C = {\n    truck_id: \"\",\n    device_id: global.get('device_id_infratec'),\n    message: msg.payload\n};\n\n msg.payload = send1C;\n msg.url = global.get(\"send_1c_url_quality\");\nreturn msg;","outputs":1,"noerr":0,"x":220,"y":260,"wires":[["8563ec70.b7206","dbb8c51f.59ac18","66c535cc.553a6c"]]},{"id":"66c535cc.553a6c","type":"http request","z":"ee144e5a.86352","name":"Send","method":"POST","ret":"txt","url":"","tls":"f436a52.4d81958","x":510,"y":240,"wires":[["8563ec70.b7206"]]},{"id":"dbb8c51f.59ac18","type":"json","z":"ee144e5a.86352","name":"","x":510,"y":280,"wires":[["8563ec70.b7206"]]},{"id":"8563ec70.b7206","type":"debug","z":"ee144e5a.86352","name":"","active":false,"console":"false","complete":"false","x":710,"y":260,"wires":[]},{"id":"2c252cd6.fef5a4","type":"debug","z":"ee144e5a.86352","name":"","active":true,"console":"false","complete":"false","x":250,"y":100,"wires":[]},{"id":"c0245cc6.36f4d","type":"debug","z":"3de7a235.4ff04e","name":"send 1c","active":false,"console":"false","complete":"true","x":340,"y":600,"wires":[]},{"id":"3a373e01.28efa2","type":"debug","z":"3de7a235.4ff04e","name":"","active":false,"console":"false","complete":"true","x":490,"y":620,"wires":[]},{"id":"512882d0.fb849c","type":"switch","z":"f93250c7.39091","name":"","property":"start_timer","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":110,"y":1820,"wires":[["d4d5df7f.4797b"]]},{"id":"d4d5df7f.4797b","type":"function","z":"f93250c7.39091","name":"logic","func":"var arrayCompare = flow.get(\"arrayCompare\");\nvar count = flow.get(\"count_1\");\nconst delta = global.get('stableDiff');//змінна порівння для стабільності 80 -60 = 20, якщо більше за дельту тоді false\nvar weight = msg.metadata.weight;\nvar prevWeight = msg.metadata.prevWeight;\nvar subWePr = weight - prevWeight;\n//\nvar send1C = true;\n\n//ітерації для перевірки\nvar iteration = global.get('iteration');\n\n\nif(arrayCompare.length == iteration){\n    arrayCompare.forEach((element) => {\n        if(element === false){\n            send1C = false  \n        }        \n    })\n    msg.send1C = send1C;\n    \n    \n    //flow.set(\"arrayCompare\", []);\n    //flow.set(\"start_timer\", false);\n}else {\n    if(subWePr >= 0 && weight > 0){\n        if(subWePr <= delta){\n            arrayCompare.push(true);    \n        }else {\n            arrayCompare.push(false);       \n        }\n    }else if(subWePr < 0 && weight > 0){\n        if(subWePr >= -delta){\n            arrayCompare.push(true);    \n        }else {\n            arrayCompare.push(false);       \n        }    \n    }\n}\n\n\nmsg.subWePr = subWePr;\nflow.set(\"arrayCompare\", arrayCompare);\nmsg.payload = arrayCompare; \nreturn msg;","outputs":1,"noerr":0,"x":250,"y":1820,"wires":[["7226ddf0.455e34","897651d4.0b87c","129ac369.c08a6d"]]},{"id":"7226ddf0.455e34","type":"debug","z":"f93250c7.39091","name":"false","active":false,"console":false,"complete":"true","x":410,"y":1780,"wires":[]},{"id":"129ac369.c08a6d","type":"function","z":"f93250c7.39091","name":"repeat cycle","func":"var array = msg.payload\n//ітерації\nvar iteration = global.get('iteration');\n\n//повторення циклу якщо принаймні один елемент false\nif(array.length == iteration){\n    array.forEach((element) => {\n        if(element === false){\n            flow.set(\"arrayCompare\",[])\n            flow.set(\"start_timer\", true);\n            return true;\n        }        \n    })\n    return msg;\n}\n","outputs":1,"noerr":0,"x":430,"y":1820,"wires":[["165c631c.4b1c7d"]]},{"id":"897651d4.0b87c","type":"switch","z":"f93250c7.39091","name":"","property":"send1C","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":410,"y":1900,"wires":[["521ef7e1.66a448","b41ea456.b59368"]]},{"id":"165c631c.4b1c7d","type":"debug","z":"f93250c7.39091","name":"false","active":false,"console":false,"complete":"true","x":590,"y":1820,"wires":[]},{"id":"b41ea456.b59368","type":"function","z":"f93250c7.39091","name":"send 1C","func":"//формування відповіді\n\nmsg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nmsg.payload.status = true;    \n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id = flow.get('truck_id');\nmsg.payload.device_id = global.get('scale_id_in');\nmsg.payload.reader = flow.get('reader');\n\n//встановлення стабільності\nmsg.payload.stable = true;\n//видалення зайвого\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\n\n    //оновлення змінних для початку нового циклу перевірки\nflow.set(\"arrayCompare\", []);\nflow.set(\"start_timer\", false);\n    \n   //адреса для відправки \nmsg.url = global.get(\"send_1c_url_GetWeight\");   \n\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":1900,"wires":[["174e9952.488447","e94292b5.8c68f","20e3a7ae.5b3cf8","d61fee60.697d9","fbe222.132b8de","53e4b8bd.741ce8"]]},{"id":"521ef7e1.66a448","type":"debug","z":"f93250c7.39091","name":"true","active":false,"console":false,"complete":"true","x":550,"y":1960,"wires":[]},{"id":"d61fee60.697d9","type":"debug","z":"f93250c7.39091","name":"true","active":false,"console":false,"complete":"true","x":850,"y":1980,"wires":[]},{"id":"bcb92471.b44658","type":"function","z":"f93250c7.39091","name":"init conf  send 1C","func":"var transactionMetadata = flow.get(\"transactionMetadata\");\nvar currentWeight = transactionMetadata.weight;\nvar filterSend1C  = global.get(\"filterSend1C\"); // омеження ваги для відправки\n\n//if(currentWeight >= filterSend1C){\n\n    flow.set(\"count_1\", 0);\n    flow.set(\"start_timer\", true);\n    flow.set(\"arrayCompare\",[]);\n\n\n    var reader = msg.payload.reader;\n    var truck_id = msg.payload.truck_id;\n    flow.set('transactionWaybill',reader);\n    flow.set('reader', reader);\n    flow.set('truck_id', truck_id);\n    \n    //JSON.parse(msg.payload); \n    return msg; \n\n//}","outputs":1,"noerr":0,"x":930,"y":1420,"wires":[["30e2682d.ec1dd8","30981c22.3526f4","48c65041.7b44"]]},{"id":"30e2682d.ec1dd8","type":"debug","z":"f93250c7.39091","name":"1c send Avto 1","active":true,"console":"false","complete":"payload","x":1160,"y":1420,"wires":[]},{"id":"9ad57249.ad7fb","type":"comment","z":"f93250c7.39091","name":"Відправка в 1С","info":"","x":120,"y":1620,"wires":[]},{"id":"174e9952.488447","type":"http request","z":"f93250c7.39091","name":"","method":"POST","ret":"txt","url":"","tls":"f436a52.4d81958","x":910,"y":1900,"wires":[["e02a99a4.c05e18","5793a262.8bd36c"]]},{"id":"e02a99a4.c05e18","type":"debug","z":"f93250c7.39091","name":"true","active":false,"console":false,"complete":"true","x":1070,"y":1900,"wires":[]},{"id":"4b529c2.594fc64","type":"inject","z":"f93250c7.39091","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":180,"y":1480,"wires":[["7de44e06.a2f28"]]},{"id":"8c59b9c3.e55fa8","type":"trigger","z":"f93250c7.39091","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"120","extend":true,"units":"s","reset":"","name":"","x":790,"y":1700,"wires":[["fac2d01c.19ebd"]]},{"id":"fac2d01c.19ebd","type":"function","z":"f93250c7.39091","name":"send 1C","func":"//формування відповіді\nmsg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nmsg.payload.status = true;    \n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id = flow.get('truck_id');\nmsg.payload.device_id = global.get('scale_id_in');\nmsg.payload.reader = flow.get('reader');\n\n\n\n//видалення завих параметрів\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\n\n//присвоєння стабільності\nmsg.payload.stable = false;\n  \n//оновлення змінних для початку нового циклу перевірки    \nflow.set(\"arrayCompare\", []);\nflow.set(\"start_timer\", false);\n  \n  \n//адреса для відправки  \nmsg.url = global.get(\"send_1c_url_GetWeight\");  \nreturn msg;","outputs":1,"noerr":0,"x":940,"y":1700,"wires":[["be2a0065.e5223","174e9952.488447","fbe222.132b8de","53e4b8bd.741ce8"]]},{"id":"be2a0065.e5223","type":"debug","z":"f93250c7.39091","name":"","active":false,"console":"false","complete":"false","x":1110,"y":1700,"wires":[]},{"id":"42a02a3d.5272f4","type":"function","z":"f93250c7.39091","name":"скидання тригера","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":1700,"wires":[["8c59b9c3.e55fa8"]]},{"id":"30981c22.3526f4","type":"link out","z":"f93250c7.39091","name":"triger 1.1","links":["382f906a.9f59a"],"x":1095,"y":1460,"wires":[]},{"id":"382f906a.9f59a","type":"link in","z":"f93250c7.39091","name":"triger 1.1","links":["30981c22.3526f4","6c0b4fac.5491d"],"x":675,"y":1660,"wires":[["8c59b9c3.e55fa8"]]},{"id":"e94292b5.8c68f","type":"link out","z":"f93250c7.39091","name":"triger 1.2","links":["a006edb1.2ea2e"],"x":675,"y":1860,"wires":[]},{"id":"a006edb1.2ea2e","type":"link in","z":"f93250c7.39091","name":"triger 1.2","links":["e94292b5.8c68f"],"x":395,"y":1700,"wires":[["42a02a3d.5272f4"]]},{"id":"3c1f49a8.8afad6","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":3890,"y":1200,"wires":[]},{"id":"a88f79fd.730728","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3660,"y":1280,"wires":[["3c1f49a8.8afad6","97461724.51a2f8"]]},{"id":"75bcfb22.d879b4","type":"comment","z":"48413719.e10dd8","name":"2 ділянка","info":"","x":4420,"y":1000,"wires":[]},{"id":"a14bae5.e3aaa5","type":"function","z":"48413719.e10dd8","name":"1р 9","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4450,"y":1040,"wires":[[]]},{"id":"ad59e9a6.35d578","type":"function","z":"48413719.e10dd8","name":"2р 9","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4451.069282531738,"y":1076.9166541099548,"wires":[["acf38f23.a5f89"]]},{"id":"3340129d.ea1bde","type":"function","z":"48413719.e10dd8","name":"1р 10","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4450,"y":1120,"wires":[[]]},{"id":"748d35fd.87718c","type":"function","z":"48413719.e10dd8","name":"2р 10","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":4451.069282531738,"y":1156.9166541099548,"wires":[["27a5b043.0abf4"]]},{"id":"c1eda8ee.ed06b8","type":"function","z":"3de7a235.4ff04e","name":"","func":"msg.url = global.get(\"send_1c_url_RaiseBarrier\");\n//msg.url = \"https://10.101.1.17/ELC_SCAT/hs/PerimeterControl/api/Granary/RaiseBarrier\";\n\nmsg.payload = {\n    \"truck_id\":4444,\n    \"device_id\":4444,\n};\n\n\n//msg.payload = JSON.stringify(msg.payload);\n\nflow.set(\"resApex\", msg.res);\nflow.set(\"reqApex\", msg.req);\nreturn msg;","outputs":1,"noerr":0,"x":311,"y":781,"wires":[["2786def6.77f3b2","36058075.daa2"]]},{"id":"2786def6.77f3b2","type":"http request","z":"3de7a235.4ff04e","name":"тест 1","method":"POST","ret":"txt","url":"","tls":"c8a0d2b5.daf2c","x":450,"y":780,"wires":[["cf8ad053.f4201","cb4aac46.c262f"]]},{"id":"cf8ad053.f4201","type":"debug","z":"3de7a235.4ff04e","name":"","active":false,"console":"false","complete":"true","x":690,"y":720,"wires":[]},{"id":"cb4aac46.c262f","type":"function","z":"3de7a235.4ff04e","name":"","func":" let statusCode = msg.statusCode;\n \n if(statusCode === \"HPE_INVALID_CONSTANT\"){\n    msg.payload = {statusCode: 204}; \n    msg.statusCode = 200;\n } else {\n     msg.payload = {statusCode: statusCode};    \n }\n\n// delete msg.headers;\n//delete msg.responseUrl;\n//delete msg.url;\n\n//msg.headers = {};\n//msg.headers[\"content-type\"] = \"application/json\";\n\n// msg.res = flow.get(\"resApex\");\n //msg.req = flow.get(\"reqApex\");\n\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":780,"wires":[[]]},{"id":"36058075.daa2","type":"debug","z":"3de7a235.4ff04e","name":"","active":false,"console":"false","complete":"true","x":470,"y":740,"wires":[]},{"id":"510745.37dd28bc","type":"inject","z":"3de7a235.4ff04e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":146.25,"y":778.7500114440918,"wires":[["c1eda8ee.ed06b8"]]},{"id":"aa6ef7fb.e69fd8","type":"switch","z":"1124af78.b62db1","name":"","property":"start_timer","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":90,"y":1880,"wires":[["fb04dc10.a63d5"]]},{"id":"fb04dc10.a63d5","type":"function","z":"1124af78.b62db1","name":"logic","func":"var arrayCompare = flow.get(\"arrayCompare\");\nvar count = flow.get(\"count_1\");\nconst delta = global.get('stableDiff');//змінна порівння для стабільності 80 -60 = 20, якщо більше за дельту тоді false\nvar weight = msg.metadata.weight;\nvar prevWeight = msg.metadata.prevWeight;\nvar subWePr = weight - prevWeight;\n//\nvar send1C = true;\n\n//ітерації для перевірки\nvar iteration = global.get('iteration');\n\n\nif(arrayCompare.length == iteration){\n    arrayCompare.forEach((element) => {\n        if(element === false){\n            send1C = false  \n        }        \n    })\n    msg.send1C = send1C;\n    \n    \n    //flow.set(\"arrayCompare\", []);\n    //flow.set(\"start_timer\", false);\n}else {\n    if(subWePr >= 0 && weight > 0){\n        if(subWePr <= delta){\n            arrayCompare.push(true);    \n        }else {\n            arrayCompare.push(false);       \n        }\n    }else if(subWePr < 0 && weight > 0){\n        if(subWePr >= -delta){\n            arrayCompare.push(true);    \n        }else {\n            arrayCompare.push(false);       \n        }    \n    }\n}\n\n\nmsg.subWePr = subWePr;\nflow.set(\"arrayCompare\", arrayCompare);\nmsg.payload = arrayCompare; \nreturn msg;","outputs":1,"noerr":0,"x":230,"y":1880,"wires":[["76e66ad.015d294","9ec1dc46.95536","bab5ee8e.039e1"]]},{"id":"76e66ad.015d294","type":"debug","z":"1124af78.b62db1","name":"false","active":false,"console":false,"complete":"true","x":390,"y":1840,"wires":[]},{"id":"bab5ee8e.039e1","type":"function","z":"1124af78.b62db1","name":"repeat cycle","func":"var array = msg.payload\n//ітерації\nvar iteration = global.get('iteration');\n\n//повторення циклу якщо принаймні один елемент false\nif(array.length == iteration){\n    array.forEach((element) => {\n        if(element === false){\n            flow.set(\"arrayCompare\",[])\n            flow.set(\"start_timer\", true);\n            return true;\n        }        \n    })\n    return msg;\n}\n","outputs":1,"noerr":0,"x":410,"y":1880,"wires":[["1efc8e75.f260b2"]]},{"id":"9ec1dc46.95536","type":"switch","z":"1124af78.b62db1","name":"","property":"send1C","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":390,"y":1960,"wires":[["9daff761.afd5f8","33f5ad68.5d88e2"]]},{"id":"1efc8e75.f260b2","type":"debug","z":"1124af78.b62db1","name":"false","active":false,"console":false,"complete":"true","x":570,"y":1880,"wires":[]},{"id":"33f5ad68.5d88e2","type":"function","z":"1124af78.b62db1","name":"send 1C","func":"//формування відповіді\n\nmsg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nmsg.payload.status = true;    \n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id = flow.get('truck_id');\nmsg.payload.device_id = global.get('scale_id_in_2');\nmsg.payload.reader = flow.get('reader');\n\n//встановлення стабільності\nmsg.payload.stable = true;\n//видалення зайвого\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\n\n    //оновлення змінних для початку нового циклу перевірки\nflow.set(\"arrayCompare\", []);\nflow.set(\"start_timer\", false);\n    \n   //адреса для відправки \nmsg.url = global.get(\"send_1c_url_GetWeight\");   \n\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":1960,"wires":[["5e867f97.481de","1a9ebdc9.ca4472","13320d7b.bcced3","2898708b.a1ecd","3106fd9b.1d1312"]]},{"id":"9daff761.afd5f8","type":"debug","z":"1124af78.b62db1","name":"true","active":false,"console":false,"complete":"true","x":530,"y":2000,"wires":[]},{"id":"13320d7b.bcced3","type":"debug","z":"1124af78.b62db1","name":"true","active":true,"console":false,"complete":"true","x":870,"y":2020,"wires":[]},{"id":"86e76a11.6ec718","type":"comment","z":"1124af78.b62db1","name":"Відправка в 1С","info":"","x":120,"y":1400,"wires":[]},{"id":"5e867f97.481de","type":"http request","z":"1124af78.b62db1","name":"","method":"POST","ret":"txt","url":"","tls":"f436a52.4d81958","x":870,"y":1960,"wires":[["630f9b77.7ab604","32bddad7.d1bbc6"]]},{"id":"630f9b77.7ab604","type":"debug","z":"1124af78.b62db1","name":"true","active":true,"console":false,"complete":"payload","x":1070,"y":1960,"wires":[]},{"id":"3986b961.9c26f6","type":"trigger","z":"1124af78.b62db1","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"120","extend":true,"units":"s","reset":"","name":"","x":830,"y":1760,"wires":[["cd085222.4428e"]]},{"id":"cd085222.4428e","type":"function","z":"1124af78.b62db1","name":"send 1C","func":"//формування відповіді\nmsg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nmsg.payload.status = true;    \n\n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id = flow.get('truck_id');\nmsg.payload.device_id = global.get('scale_id_in_2');\nmsg.payload.reader = flow.get('reader');\n\n\n\n//видалення завих параметрів\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\n\n//присвоєння стабільності\nmsg.payload.stable = false;\n  \n//оновлення змінних для початку нового циклу перевірки    \nflow.set(\"arrayCompare\", []);\nflow.set(\"start_timer\", false);\n  \n  \n//адреса для відправки  \nmsg.url = global.get(\"send_1c_url_GetWeight\");  \nreturn msg;","outputs":1,"noerr":0,"x":980,"y":1760,"wires":[["b448d881.d84a88","5e867f97.481de","2898708b.a1ecd","7779f928.906188"]]},{"id":"b448d881.d84a88","type":"debug","z":"1124af78.b62db1","name":"","active":true,"console":"false","complete":"false","x":1170,"y":1760,"wires":[]},{"id":"ab80b7a5.d48258","type":"function","z":"1124af78.b62db1","name":"скидання тригера","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":1760,"wires":[["3986b961.9c26f6"]]},{"id":"556c0495.f35cec","type":"link in","z":"1124af78.b62db1","name":"triger 2.1","links":["a09564a7.8ba628"],"x":595,"y":1720,"wires":[["3986b961.9c26f6"]]},{"id":"1a9ebdc9.ca4472","type":"link out","z":"1124af78.b62db1","name":"triger 2.2","links":["7886b46f.6fcedc"],"x":655,"y":1940,"wires":[]},{"id":"7886b46f.6fcedc","type":"link in","z":"1124af78.b62db1","name":"triger 2.2","links":["1a9ebdc9.ca4472"],"x":435,"y":1760,"wires":[["ab80b7a5.d48258"]]},{"id":"a09564a7.8ba628","type":"link out","z":"1124af78.b62db1","name":"triger 2.1","links":["556c0495.f35cec"],"x":1015,"y":1500,"wires":[]},{"id":"cd47e21d.6b9c3","type":"switch","z":"2b507412.efc2cc","name":"","property":"start_timer","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":130,"y":1800,"wires":[["c81a9f3f.6d468"]]},{"id":"c81a9f3f.6d468","type":"function","z":"2b507412.efc2cc","name":"logic","func":"var arrayCompare = flow.get(\"arrayCompare\");\nvar count = flow.get(\"count_1\");\nconst delta = global.get('stableDiff');//змінна порівння для стабільності 80 -60 = 20, якщо більше за дельту тоді false\nvar weight = msg.metadata.weight;\nvar prevWeight = msg.metadata.prevWeight;\nvar subWePr = weight - prevWeight;\n//\nvar send1C = true;\n\n//ітерації для перевірки\nvar iteration = global.get('iteration');\n\n\nif(arrayCompare.length == iteration){\n    arrayCompare.forEach((element) => {\n        if(element === false){\n            send1C = false  \n        }        \n    })\n    msg.send1C = send1C;\n    \n    \n    //flow.set(\"arrayCompare\", []);\n    //flow.set(\"start_timer\", false);\n}else {\n    if(subWePr >= 0 && weight > 0){\n        if(subWePr <= delta){\n            arrayCompare.push(true);    \n        }else {\n            arrayCompare.push(false);       \n        }\n    }else if(subWePr < 0 && weight > 0){\n        if(subWePr >= -delta){\n            arrayCompare.push(true);    \n        }else {\n            arrayCompare.push(false);       \n        }    \n    }\n}\n\n\nmsg.subWePr = subWePr;\nflow.set(\"arrayCompare\", arrayCompare);\nmsg.payload = arrayCompare; \nreturn msg;","outputs":1,"noerr":0,"x":270,"y":1800,"wires":[["e36b3a58.2015e8","7f039c0f.6178f4"]]},{"id":"7f039c0f.6178f4","type":"function","z":"2b507412.efc2cc","name":"repeat cycle","func":"var array = msg.payload\n//ітерації\nvar iteration = global.get('iteration') - 70;\n\n//повторення циклу якщо принаймні один елемент false\nif(array.length == iteration){\n    array.forEach((element) => {\n        if(element === false){\n            flow.set(\"arrayCompare\",[])\n            flow.set(\"start_timer\", true);\n            return true;\n        }        \n    })\n    return msg;\n}\n","outputs":1,"noerr":0,"x":450,"y":1800,"wires":[[]]},{"id":"e36b3a58.2015e8","type":"switch","z":"2b507412.efc2cc","name":"","property":"send1C","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":430,"y":1880,"wires":[["ce25c838.385278"]]},{"id":"ce25c838.385278","type":"function","z":"2b507412.efc2cc","name":"send 1C","func":"//формування відповіді\n\nmsg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nmsg.payload.status = true;    \n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id = flow.get('truck_id');\nmsg.payload.device_id = global.get('scale_id_in_3');\nmsg.payload.reader = flow.get('reader');\n\n//встановлення стабільності\nmsg.payload.stable = true;\n//видалення зайвого\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\n\n    //оновлення змінних для початку нового циклу перевірки\nflow.set(\"arrayCompare\", []);\nflow.set(\"start_timer\", false);\n    \n   //адреса для відправки \nmsg.url = global.get(\"send_1c_url_GetWeight\");   \n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":1880,"wires":[["67ccbb84.8b4154","4e130a89.a4c5f4"]]},{"id":"4f9af07.6a2621","type":"comment","z":"2b507412.efc2cc","name":"Відправка в 1С","info":"","x":160,"y":1640,"wires":[]},{"id":"67ccbb84.8b4154","type":"http request","z":"2b507412.efc2cc","name":"","method":"POST","ret":"txt","url":"","tls":"f436a52.4d81958","x":910,"y":1880,"wires":[[]]},{"id":"e8995672.f9e758","type":"trigger","z":"2b507412.efc2cc","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"120","extend":true,"units":"s","reset":"","name":"","x":870,"y":1680,"wires":[["12fa85e1.26ce9a"]]},{"id":"12fa85e1.26ce9a","type":"function","z":"2b507412.efc2cc","name":"send 1C","func":"//формування відповіді\nmsg.payload = flow.get('transactionMetadata');\nmsg.payload.driverInCar = false;\ntransactionWaybill = flow.get('transactionWaybill');\nmsg.payload.transactionWaybill = transactionWaybill;\nmsg.payload.status = true;    \n\n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id = flow.get('truck_id');\nmsg.payload.device_id = global.get('scale_id_in_3');\nmsg.payload.reader = flow.get('reader');\n\n\n\n//видалення завих параметрів\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\n\n//присвоєння стабільності\nmsg.payload.stable = false;\n  \n//оновлення змінних для початку нового циклу перевірки    \nflow.set(\"arrayCompare\", []);\nflow.set(\"start_timer\", false);\n  \n  \n//адреса для відправки  \nmsg.url = global.get(\"send_1c_url_GetWeight\");  \nreturn msg;","outputs":1,"noerr":0,"x":1020,"y":1680,"wires":[["67ccbb84.8b4154"]]},{"id":"947d23c5.e85fa","type":"function","z":"2b507412.efc2cc","name":"скидання тригера","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":1680,"wires":[["e8995672.f9e758"]]},{"id":"9e1740dd.09b9","type":"link in","z":"2b507412.efc2cc","name":"triger 3.1","links":["ca38adb.d34b25"],"x":635,"y":1640,"wires":[["e8995672.f9e758"]]},{"id":"4e130a89.a4c5f4","type":"link out","z":"2b507412.efc2cc","name":"triger 3.2","links":["b2ab96c5.acbd68"],"x":695,"y":1860,"wires":[]},{"id":"b2ab96c5.acbd68","type":"link in","z":"2b507412.efc2cc","name":"triger 3.2","links":["4e130a89.a4c5f4"],"x":475,"y":1680,"wires":[["947d23c5.e85fa"]]},{"id":"c483a4f.cea2e58","type":"function","z":"2b507412.efc2cc","name":"init conf  send 1C","func":"var transactionMetadata = flow.get(\"transactionMetadata\");\nvar currentWeight = transactionMetadata.weight;\nvar filterSend1C  = global.get(\"filterSend1C\"); // омеження ваги для відправки\n\n//if(currentWeight >= filterSend1C){\n\n    flow.set(\"count_1\", 0);\n    flow.set(\"start_timer\", true);\n    flow.set(\"arrayCompare\",[]);\n\n\n    var reader = msg.payload.reader;\n    var truck_id = msg.payload.truck_id;\n    flow.set('transactionWaybill',reader);\n    flow.set('reader', reader);\n    flow.set('truck_id', truck_id);\n    \n    //JSON.parse(msg.payload); \n    return msg; \n\n//}","outputs":1,"noerr":0,"x":470,"y":1480,"wires":[["d0c46192.ea522","ca38adb.d34b25"]]},{"id":"d0c46192.ea522","type":"debug","z":"2b507412.efc2cc","name":"","active":false,"console":"false","complete":"false","x":670,"y":1480,"wires":[]},{"id":"ca38adb.d34b25","type":"link out","z":"2b507412.efc2cc","name":"triger 3.1","links":["9e1740dd.09b9"],"x":615,"y":1520,"wires":[]},{"id":"93da2ab2.aa9ca8","type":"debug","z":"71f38711.545228","name":"","active":false,"console":"false","complete":"false","x":570,"y":100,"wires":[]},{"id":"94872ad2.5c2ea8","type":"http request","z":"3de7a235.4ff04e","name":"тест 2","method":"POST","ret":"txt","url":"https://10.101.1.17/ELC_SCAT/hs/PerimeterControl/api/Granary/RaiseBarrier","tls":"c8a0d2b5.daf2c","x":450,"y":820,"wires":[[]]},{"id":"363079af.121236","type":"inject","z":"dbb5a15f.df08b","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":130,"y":80,"wires":[["f2b09bfc.5029d8"]]},{"id":"f2b09bfc.5029d8","type":"function","z":"dbb5a15f.df08b","name":"INIt","func":"//З Апекса в 1С\nglobal.set(\"send_1c_url_RaiseBarrier\", \"https://10.101.1.17/ELC_SCAT/hs/PerimeterControl/api/Granary/RaiseBarrier\");\n//Аналізатор -  відправка з Атома на 1С\nglobal.set(\"send_1c_url_quality\", \"https://10.101.1.17/ELC_SCAT/hs/PerimeterControl/api/SmartScales/quality\");\n//Зважування - відправка з Атома на 1С\nglobal.set(\"send_1c_url_GetWeight\", \"https://10.101.1.17/ELC_SCAT/hs/PerimeterControl/api/Granary/GetWeight\");\n//Обмження для відправки зважування в 1С\nglobal.set(\"filterSend1C\", 10);\n//Ітерації для перевірки на стабільність, базове величина, для деяких вагів редактувати\nglobal.set('iteration', 10);\n//дельта для стабільності\nglobal.set('stableDiff', 20);\n","outputs":1,"noerr":0,"x":290,"y":80,"wires":[[]]},{"id":"5dd70386.178f4c","type":"comment","z":"dbb5a15f.df08b","name":"","info":"","x":100,"y":40,"wires":[]},{"id":"ccd0f629.e92898","type":"http in","z":"f93250c7.39091","name":"","url":"/getWeightStart1","method":"post","swaggerDoc":"","x":180,"y":1420,"wires":[["7d5cb532.5c4f3c","8777d0a.c04123","3259c204.6f26fe","b20348e6.b52b78","83352a89.495548","1e3b5db8.c6c392"]]},{"id":"7d5cb532.5c4f3c","type":"http response","z":"f93250c7.39091","name":"","x":890,"y":1380,"wires":[]},{"id":"ca224dd2.30c6a","type":"comment","z":"f93250c7.39091","name":"Успішно","info":"","x":420,"y":1860,"wires":[]},{"id":"11a30782.1262e8","type":"comment","z":"f93250c7.39091","name":"Не стабільна вага","info":"","x":450,"y":1660,"wires":[]},{"id":"94ee97c6.acbde8","type":"function","z":"1124af78.b62db1","name":"init conf  send 1C","func":"var transactionMetadata = flow.get(\"transactionMetadata\");\nvar currentWeight = transactionMetadata.weight;\nvar filterSend1C  = global.get(\"filterSend1C\"); // омеження ваги для відправки\n\n//if(currentWeight >= filterSend1C){\n\n    flow.set(\"count_1\", 0);\n    flow.set(\"start_timer\", true);\n    flow.set(\"arrayCompare\",[]);\n\n\n    var reader = msg.payload.reader;\n    var truck_id = msg.payload.truck_id;\n    flow.set('transactionWaybill',reader);\n    flow.set('reader', reader);\n    flow.set('truck_id', truck_id);\n\n    //JSON.parse(msg.payload); \n    return msg; \n\n//}","outputs":1,"noerr":0,"x":790,"y":1460,"wires":[["17fac5b9.bef73a","a09564a7.8ba628","9614dbbc.9603c8"]]},{"id":"17fac5b9.bef73a","type":"debug","z":"1124af78.b62db1","name":"1C send Avto 2","active":false,"console":"false","complete":"payload","x":1080,"y":1460,"wires":[]},{"id":"2713a3ca.eb16ac","type":"http in","z":"1124af78.b62db1","name":"","url":"/getWeightStart2","method":"post","swaggerDoc":"","x":180,"y":1460,"wires":[["d699df3b.2b93d","195e1507.fe0e5b","94ee97c6.acbde8","ea72742e.18cc38","967e297a.941c38","d1e01a0.01ef1e8","9418b991.1b2a18"]]},{"id":"d699df3b.2b93d","type":"http response","z":"1124af78.b62db1","name":"","x":750,"y":1420,"wires":[]},{"id":"f5cf699.e02c798","type":"comment","z":"1124af78.b62db1","name":"Не стабільна вага","info":"","x":430,"y":1720,"wires":[]},{"id":"bb18157a.0690f8","type":"comment","z":"1124af78.b62db1","name":"Успішно","info":"","x":400,"y":1920,"wires":[]},{"id":"4f4e9920.09ccd8","type":"http in","z":"2b507412.efc2cc","name":"","url":"/getWeightStart3","method":"post","swaggerDoc":"","x":180,"y":1480,"wires":[["7f0ceac2.ee8594","c483a4f.cea2e58","691c35b4.504b4c"]]},{"id":"7f0ceac2.ee8594","type":"http response","z":"2b507412.efc2cc","name":"","x":430,"y":1440,"wires":[]},{"id":"16642a7d.e09a56","type":"comment","z":"2b507412.efc2cc","name":"Не стабільна вага","info":"","x":490,"y":1640,"wires":[]},{"id":"94155584.6fccb8","type":"comment","z":"2b507412.efc2cc","name":"Успішно","info":"","x":440,"y":1840,"wires":[]},{"id":"8777d0a.c04123","type":"debug","z":"f93250c7.39091","name":"","active":false,"console":"false","complete":"true","x":890,"y":1460,"wires":[]},{"id":"195e1507.fe0e5b","type":"debug","z":"1124af78.b62db1","name":"","active":false,"console":"false","complete":"false","x":770,"y":1500,"wires":[]},{"id":"691c35b4.504b4c","type":"debug","z":"2b507412.efc2cc","name":"","active":false,"console":"false","complete":"false","x":450,"y":1520,"wires":[]},{"id":"7de44e06.a2f28","type":"function","z":"f93250c7.39091","name":"test","func":"msg.payload = {\n    \"truck_id\": \"E20000199909017813209C3D\",\n    \"reader\": \"2342341234324\"\n};\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":1480,"wires":[["b20348e6.b52b78"]]},{"id":"37e3a19.7db225e","type":"inject","z":"f93250c7.39091","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":180,"y":1520,"wires":[["8777d0a.c04123"]]},{"id":"b58e059.94247f8","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_1.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":3710,"y":1400,"wires":[["bf8465c7.e26798"]]},{"id":"15b4449f.efac8b","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":3590,"y":1400,"wires":[["b58e059.94247f8"]]},{"id":"85007e6f.ca1da","type":"comment","z":"ee144e5a.86352","name":"send 1c","info":"apiuser\napiuser","x":220,"y":220,"wires":[]},{"id":"f8451583.2cc888","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4590,"y":960,"wires":[[]]},{"id":"128f568a.25a6b9","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4590,"y":280,"wires":[[]]},{"id":"8d40183a.2bac68","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4590,"y":360,"wires":[[]]},{"id":"ff32c1f1.951db","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4590,"y":460,"wires":[[]]},{"id":"7d6b4212.452b1c","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4590,"y":540,"wires":[[]]},{"id":"3128fd67.b15662","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4590,"y":680,"wires":[[]]},{"id":"72f266c6.35fc58","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4590,"y":780,"wires":[[]]},{"id":"acf38f23.a5f89","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4590,"y":1080,"wires":[[]]},{"id":"27a5b043.0abf4","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4590,"y":1160,"wires":[[]]},{"id":"c5ad17c9.046328","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":3590,"y":1360,"wires":[["1b6d58cf.548f87"]]},{"id":"1b6d58cf.548f87","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ123\");\narr.push(\"<s2>2_ТЕСТ456\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_1.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":3710,"y":1360,"wires":[["bf8465c7.e26798"]]},{"id":"bf8465c7.e26798","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":3890,"y":1360,"wires":[["26b87589.e8de6a"],[],[]]},{"id":"6968f1b3.e273d","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nmsg.payload  = arr.join('\\n');\n\n\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":3890,"y":1140,"wires":[[]]},{"id":"d16885d6.32db38","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar i = buf.indexOf(10);\n\nmsg.str1 = buf.slice(0, i);\nmsg.str2 = buf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":4470,"y":1280,"wires":[[]]},{"id":"e4e6aacd.3366c8","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\nreturn msg;","outputs":1,"noerr":0,"x":4640,"y":1280,"wires":[[]]},{"id":"856318b7.2e19f8","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":4200,"y":1460,"wires":[]},{"id":"5bac4dc1.c8c864","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4590,"y":880,"wires":[[]]},{"id":"56d95d8c.337514","type":"comment","z":"48413719.e10dd8","name":"7","info":"","x":950,"y":2080,"wires":[]},{"id":"ab125662.4cf4e8","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_7.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":2120,"wires":[["2285ee40.1800d2"]]},{"id":"e60c5237.a841d","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_7.txt -o /distr/iconv_t/outfile_7.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1260,"y":2120,"wires":[["5bfff42e.67ad9c"],[],[]]},{"id":"5bfff42e.67ad9c","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_7.txt","format":"","x":1450,"y":2120,"wires":[["c3968afd.074d88"]]},{"id":"c3968afd.074d88","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1650,"y":2120,"wires":[["91fef213.9d829"]]},{"id":"91fef213.9d829","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1820,"y":2120,"wires":[["9071b59c.3782a8","49dde662.70ac68","bef6892f.19ae38","3901878b.214f68"]]},{"id":"319f1d7b.61b812","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_7.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":970,"y":2240,"wires":[["2285ee40.1800d2"]]},{"id":"21f47e1b.64fad2","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":850,"y":2240,"wires":[["319f1d7b.61b812"]]},{"id":"fda12fdb.96e7d","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":850,"y":2200,"wires":[["c0b99c3a.188e3"]]},{"id":"c0b99c3a.188e3","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ123\");\narr.push(\"<s2>2_ТЕСТ456\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_7.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":970,"y":2200,"wires":[["2285ee40.1800d2"]]},{"id":"2285ee40.1800d2","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1130,"y":2120,"wires":[["e60c5237.a841d"],[],[]]},{"id":"dda1abbc.9c7588","type":"comment","z":"48413719.e10dd8","name":"8","info":"","x":950,"y":2340,"wires":[]},{"id":"b0432743.d79fd8","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_8.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":970,"y":2380,"wires":[["ce6bebb8.a591e8"]]},{"id":"50c0ac7a.f36c04","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_8.txt -o /distr/iconv_t/outfile_8.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1320,"y":2380,"wires":[["fce2d238.c56fd"],[],[]]},{"id":"fce2d238.c56fd","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_8.txt","format":"","x":1510,"y":2380,"wires":[["aab8d60d.8b43e8"]]},{"id":"aab8d60d.8b43e8","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1710,"y":2380,"wires":[["7cc7ae55.be3b1"]]},{"id":"7cc7ae55.be3b1","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1880,"y":2380,"wires":[["84e43fd1.f8b09","fcfa20bf.25277","c95c9080.2f3c3","1b549d6f.36d913"]]},{"id":"e3f2070b.e0c988","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_8.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":990,"y":2520,"wires":[["ce6bebb8.a591e8"]]},{"id":"175b3bdd.e5b484","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":870,"y":2520,"wires":[["e3f2070b.e0c988"]]},{"id":"d5799a43.cc3fe8","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":870,"y":2480,"wires":[["c72b860a.4b61d8"]]},{"id":"c72b860a.4b61d8","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ123\");\narr.push(\"<s2>2_ТЕСТ456\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_8.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":990,"y":2480,"wires":[["ce6bebb8.a591e8"]]},{"id":"ce6bebb8.a591e8","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1190,"y":2380,"wires":[["50c0ac7a.f36c04"],[],[]]},{"id":"ef2f4971.08d518","type":"switch","z":"48413719.e10dd8","name":"","property":"msg.payload.АдресУстройства","propertyType":"jsonata","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"cont","v":"7","vt":"str"},{"t":"cont","v":"8","vt":"str"},{"t":"cont","v":"9","vt":"str"},{"t":"cont","v":"10","vt":"str"},{"t":"cont","v":"11","vt":"str"},{"t":"cont","v":"12","vt":"str"},{"t":"cont","v":"13","vt":"str"},{"t":"cont","v":"14","vt":"str"},{"t":"cont","v":"15","vt":"str"}],"checkall":"true","outputs":15,"x":250,"y":1320,"wires":[["14ae62d1.760c4d","1c7b1150.a7878f"],["4e4bfa13.bf8674"],["b13f5f9a.636a"],["99fca5.c1ff1358"],["a9834e8d.ff0c9","f0cea0ec.73fd9","e199eebd.b1fe"],["d9475276.2e18b","e199eebd.b1fe"],["fd5c58e1.d48b48","7018b2a4.cb6d3c","be29ba6a.5c29e8"],["d86ca67e.d15018","be29ba6a.5c29e8"],["1ee83ab.25136c5","dc4cc180.7b2cb"],["c55dae8e.8aed6"],["89f2a0c3.c1c38"],["1d665d63.bf4eb3"],["4784027e.7c1d9c"],["b7d9973b.20fc08"],["a3adee19.947a3"]]},{"id":"9071b59c.3782a8","type":"function","z":"48413719.e10dd8","name":"1р 7","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":2100,"wires":[["48926dd.696ab94","2ac8a4ab.c216ac"]]},{"id":"3d2ef2fe.a1737e","type":"function","z":"48413719.e10dd8","name":"2р 7","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":2180,"wires":[["48926dd.696ab94"]]},{"id":"84e43fd1.f8b09","type":"function","z":"48413719.e10dd8","name":"1р 8","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2210,"y":2360,"wires":[["c7e88d7c.dee9a"]]},{"id":"f5504b1e.6fd158","type":"function","z":"48413719.e10dd8","name":"2р 8","func":"msg.payload =  msg.payload.Строка2;\n//максимально 12 символів у рядку\nflow.set('2r8', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":2210,"y":2440,"wires":[["c7e88d7c.dee9a"]]},{"id":"49dde662.70ac68","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":2180,"wires":[["3d2ef2fe.a1737e"]]},{"id":"1ff9a505.9cbd5b","type":"function","z":"48413719.e10dd8","name":"1р 7","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":2140,"wires":[["48926dd.696ab94"]]},{"id":"bef6892f.19ae38","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":2140,"wires":[["1ff9a505.9cbd5b"]]},{"id":"fcfa20bf.25277","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2070,"y":2400,"wires":[["8525ff91.2dc7a"]]},{"id":"8525ff91.2dc7a","type":"function","z":"48413719.e10dd8","name":"1р 8","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2210,"y":2400,"wires":[["c7e88d7c.dee9a"]]},{"id":"c95c9080.2f3c3","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2070,"y":2440,"wires":[["f5504b1e.6fd158"]]},{"id":"f8746a29.277258","type":"comment","z":"48413719.e10dd8","name":"Конвертація в кодування 1251","info":"","x":1230,"y":360,"wires":[]},{"id":"43ed27e9.25b5e8","type":"comment","z":"48413719.e10dd8","name":"1","info":"","x":950,"y":380,"wires":[]},{"id":"1c7b1150.a7878f","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_1.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":970,"y":420,"wires":[["9e0a4433.c046e8"]]},{"id":"e63fb173.6d108","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_1.txt -o /distr/iconv_t/outfile_1.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1300,"y":420,"wires":[["35198b9f.8593e4"],[],[]]},{"id":"35198b9f.8593e4","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_1.txt","format":"","x":1490,"y":420,"wires":[["f35a0041.054c6"]]},{"id":"f35a0041.054c6","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1690,"y":420,"wires":[["ab85d9a.ecb2528"]]},{"id":"ab85d9a.ecb2528","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1860,"y":420,"wires":[["c4c17ccc.55bab","98b72527.faaa48","ce54cf96.7de41"]]},{"id":"d7f8865c.5d5658","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_1.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":1010,"y":520,"wires":[["9e0a4433.c046e8"]]},{"id":"a6ce3af.4e410c8","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":890,"y":520,"wires":[["d7f8865c.5d5658"]]},{"id":"e03de87b.738898","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":890,"y":480,"wires":[["6798c71c.2bdae8"]]},{"id":"6798c71c.2bdae8","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ123\");\narr.push(\"<s2>2_ТЕСТ456\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_1.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":1010,"y":480,"wires":[["9e0a4433.c046e8"]]},{"id":"9e0a4433.c046e8","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1150,"y":420,"wires":[["e63fb173.6d108"],[],[]]},{"id":"c4c17ccc.55bab","type":"function","z":"48413719.e10dd8","name":"1р 1","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2210,"y":400,"wires":[["6b3c35b2.00656c"]]},{"id":"23f9f3b8.d94f8c","type":"function","z":"48413719.e10dd8","name":"2р 1","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2210,"y":480,"wires":[["6b3c35b2.00656c"]]},{"id":"98b72527.faaa48","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2050,"y":480,"wires":[["23f9f3b8.d94f8c"]]},{"id":"9dc5f45c.4e0fb8","type":"function","z":"48413719.e10dd8","name":"1р 1","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2210,"y":440,"wires":[["6b3c35b2.00656c"]]},{"id":"ce54cf96.7de41","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2050,"y":440,"wires":[["9dc5f45c.4e0fb8"]]},{"id":"8a2775a1.2fd518","type":"comment","z":"48413719.e10dd8","name":"Конвертація в кодування 1251","info":"","x":1210,"y":620,"wires":[]},{"id":"23e67c79.b59664","type":"comment","z":"48413719.e10dd8","name":"2","info":"","x":930,"y":640,"wires":[]},{"id":"4e4bfa13.bf8674","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_2.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":680,"wires":[["1cb0dff3.83d81"]]},{"id":"7c019738.f412f8","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_2.txt -o /distr/iconv_t/outfile_2.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1280,"y":680,"wires":[["d9ab61d7.e8802"],[],[]]},{"id":"d9ab61d7.e8802","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_2.txt","format":"","x":1470,"y":680,"wires":[["e99d1498.85c408"]]},{"id":"e99d1498.85c408","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":680,"wires":[["b869f111.06cf"]]},{"id":"b869f111.06cf","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1840,"y":680,"wires":[["f5986699.3df808","ce2ff390.bc117","dd4d7de1.28283"]]},{"id":"e6b08c0.3120b78","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_1.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":780,"wires":[["1cb0dff3.83d81"]]},{"id":"cd87176.a8cf3e8","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":830,"y":780,"wires":[["e6b08c0.3120b78"]]},{"id":"4051c486.85265c","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":830,"y":740,"wires":[["a5b12dd2.cbcbb"]]},{"id":"a5b12dd2.cbcbb","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ123\");\narr.push(\"<s2>2_ТЕСТ456\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_1.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":740,"wires":[["1cb0dff3.83d81"]]},{"id":"1cb0dff3.83d81","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1130,"y":680,"wires":[["7c019738.f412f8"],[],[]]},{"id":"f5986699.3df808","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":660,"wires":[["ca292340.169ab"]]},{"id":"12983df8.4f4822","type":"function","z":"48413719.e10dd8","name":"2р ","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":740,"wires":[["ca292340.169ab"]]},{"id":"ce2ff390.bc117","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":740,"wires":[["12983df8.4f4822"]]},{"id":"e3e02272.96c29","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":700,"wires":[["ca292340.169ab"]]},{"id":"dd4d7de1.28283","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":700,"wires":[["e3e02272.96c29"]]},{"id":"6305ec09.342fa4","type":"comment","z":"48413719.e10dd8","name":"Конвертація в кодування 1251","info":"","x":1210,"y":840,"wires":[]},{"id":"1f30d940.8d0ea7","type":"comment","z":"48413719.e10dd8","name":"3","info":"","x":930,"y":860,"wires":[]},{"id":"b13f5f9a.636a","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_3.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":900,"wires":[["808d7b1e.e28158"]]},{"id":"ea1e5288.38e7b","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_3.txt -o /distr/iconv_t/outfile_3.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1280,"y":900,"wires":[["f0929357.76d54"],[],[]]},{"id":"f0929357.76d54","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_3.txt","format":"","x":1470,"y":900,"wires":[["a916c767.8b00b8"]]},{"id":"a916c767.8b00b8","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":900,"wires":[["500d2e13.c2a06"]]},{"id":"500d2e13.c2a06","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1840,"y":900,"wires":[["ed37acdf.99f7e","62d114d1.6791fc","15b5dca3.d27583"]]},{"id":"d7b8965d.6e4ec8","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_3.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":1000,"wires":[["808d7b1e.e28158"]]},{"id":"a7e15441.017e68","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":830,"y":1000,"wires":[["d7b8965d.6e4ec8"]]},{"id":"dc5fafc.2a3bc5","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":830,"y":960,"wires":[["2790151.b97ceea"]]},{"id":"2790151.b97ceea","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ123\");\narr.push(\"<s2>2_ТЕСТ456\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_3.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":960,"wires":[["808d7b1e.e28158"]]},{"id":"808d7b1e.e28158","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1130,"y":900,"wires":[["ea1e5288.38e7b"],[],[]]},{"id":"ed37acdf.99f7e","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":880,"wires":[["3b5b7815.1da648"]]},{"id":"98b5cdea.85a3c","type":"function","z":"48413719.e10dd8","name":"2р ","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":960,"wires":[["3b5b7815.1da648"]]},{"id":"62d114d1.6791fc","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":960,"wires":[["98b5cdea.85a3c"]]},{"id":"2610ffae.5aec8","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":920,"wires":[["3b5b7815.1da648"]]},{"id":"15b5dca3.d27583","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":920,"wires":[["2610ffae.5aec8"]]},{"id":"43068a8c.4345e4","type":"comment","z":"48413719.e10dd8","name":"Конвертація в кодування 1251","info":"","x":1210,"y":1060,"wires":[]},{"id":"11fe13df.7d48ec","type":"comment","z":"48413719.e10dd8","name":"4","info":"","x":930,"y":1080,"wires":[]},{"id":"99fca5.c1ff1358","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_4.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":1120,"wires":[["57ac9c3.7339c64"]]},{"id":"89f8c531.b44d28","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_4.txt -o /distr/iconv_t/outfile_4.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1280,"y":1120,"wires":[["86c44a1f.c3a9e8"],[],[]]},{"id":"86c44a1f.c3a9e8","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_4.txt","format":"","x":1470,"y":1120,"wires":[["264eb053.be22d"]]},{"id":"264eb053.be22d","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":1120,"wires":[["658f738a.a6239c"]]},{"id":"658f738a.a6239c","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1840,"y":1120,"wires":[["4ff6ebdb.277f94","9df1cf2e.918f4","52208ded.2a6e04"]]},{"id":"e07d2547.991198","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_4.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":1220,"wires":[["57ac9c3.7339c64"]]},{"id":"2debad51.058702","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":830,"y":1220,"wires":[["e07d2547.991198"]]},{"id":"86f19097.480af","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":830,"y":1180,"wires":[["a7b7c83c.a484b8"]]},{"id":"a7b7c83c.a484b8","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ123\");\narr.push(\"<s2>2_ТЕСТ456\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_4.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":1180,"wires":[["57ac9c3.7339c64"]]},{"id":"57ac9c3.7339c64","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1130,"y":1120,"wires":[["89f8c531.b44d28"],[],[]]},{"id":"4ff6ebdb.277f94","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":1100,"wires":[["5b796b0f.ac1cc4"]]},{"id":"6861a846.72fc68","type":"function","z":"48413719.e10dd8","name":"2р ","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":1180,"wires":[["5b796b0f.ac1cc4"]]},{"id":"9df1cf2e.918f4","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":1180,"wires":[["6861a846.72fc68"]]},{"id":"39ef578d.f89c08","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":1140,"wires":[["5b796b0f.ac1cc4"]]},{"id":"52208ded.2a6e04","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":1140,"wires":[["39ef578d.f89c08"]]},{"id":"ea1d42cc.708d3","type":"comment","z":"48413719.e10dd8","name":"Конвертація в кодування 1251","info":"","x":1210,"y":1580,"wires":[]},{"id":"6dc1a962.7bce98","type":"comment","z":"48413719.e10dd8","name":"5","info":"","x":930,"y":1600,"wires":[]},{"id":"a094d64e.f06748","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_5.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":1640,"wires":[["583b02c5.8101cc"]]},{"id":"dc0d1e22.d401f","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_5.txt -o /distr/iconv_t/outfile_5.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1280,"y":1640,"wires":[["a2fae9bd.234468"],[],[]]},{"id":"a2fae9bd.234468","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_5.txt","format":"","x":1470,"y":1640,"wires":[["340f7e96.bd5d32"]]},{"id":"340f7e96.bd5d32","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":1640,"wires":[["72724dc9.9cb0d4"]]},{"id":"72724dc9.9cb0d4","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1840,"y":1640,"wires":[["2a67da49.a387f6","a48f297.8fca7d8","40e1e293.5d020c","fb38ae51.5251d"]]},{"id":"9f40e1b2.dca2b","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_5.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":1820,"wires":[["583b02c5.8101cc"]]},{"id":"6097db.a4399824","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":830,"y":1820,"wires":[["9f40e1b2.dca2b"]]},{"id":"6c6da9e7.2eb288","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":830,"y":1780,"wires":[["563a2875.180678"]]},{"id":"563a2875.180678","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ123\");\narr.push(\"<s2>2_ТЕСТ456\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_5.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":1780,"wires":[["583b02c5.8101cc"]]},{"id":"583b02c5.8101cc","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1130,"y":1640,"wires":[["dc0d1e22.d401f"],[],[]]},{"id":"2a67da49.a387f6","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":1620,"wires":[["8c905c13.80283"]]},{"id":"de57d958.381a08","type":"function","z":"48413719.e10dd8","name":"2р ","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":1700,"wires":[["8c905c13.80283"]]},{"id":"a48f297.8fca7d8","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":1700,"wires":[["de57d958.381a08"]]},{"id":"3e7e52e.f6d7dae","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":1660,"wires":[["8c905c13.80283"]]},{"id":"40e1e293.5d020c","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":1660,"wires":[["3e7e52e.f6d7dae"]]},{"id":"4dbf912.ee8457","type":"comment","z":"48413719.e10dd8","name":"Конвертація в кодування 1251","info":"","x":1210,"y":1840,"wires":[]},{"id":"176fd765.7950a9","type":"comment","z":"48413719.e10dd8","name":"6","info":"","x":930,"y":1860,"wires":[]},{"id":"d1076785.9578e8","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_6.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":1900,"wires":[["4c3f6faf.08496"]]},{"id":"4397a70c.bb5228","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_6.txt -o /distr/iconv_t/outfile_6.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1280,"y":1900,"wires":[["ace87c7d.4502d"],[],[]]},{"id":"ace87c7d.4502d","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_6.txt","format":"","x":1470,"y":1900,"wires":[["85589ad4.c913c8"]]},{"id":"85589ad4.c913c8","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":1900,"wires":[["509fb6f3.0de988"]]},{"id":"509fb6f3.0de988","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1840,"y":1900,"wires":[["dc5eec1c.23a8f","ae72176e.530f28","35025aec.f763c6","b96822ed.24e05"]]},{"id":"aa9536fe.fa4b18","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_6.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":2020,"wires":[["4c3f6faf.08496"]]},{"id":"2639a7b9.407b88","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":830,"y":2020,"wires":[["aa9536fe.fa4b18"]]},{"id":"5748f14.ab3b81","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":830,"y":1980,"wires":[["9e61e97a.bb3ef8"]]},{"id":"9e61e97a.bb3ef8","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ123\");\narr.push(\"<s2>2_ТЕСТ456\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_6.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":1980,"wires":[["4c3f6faf.08496"]]},{"id":"4c3f6faf.08496","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1130,"y":1900,"wires":[["4397a70c.bb5228"],[],[]]},{"id":"dc5eec1c.23a8f","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":1880,"wires":[["ce83e5bf.b00158"]]},{"id":"f0cdfcc1.67a0e","type":"function","z":"48413719.e10dd8","name":"2р ","func":"msg.payload = msg.payload.Строка2;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":1960,"wires":[["ce83e5bf.b00158"]]},{"id":"ae72176e.530f28","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":1960,"wires":[["f0cdfcc1.67a0e"]]},{"id":"5e6581b6.d35c1","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":1920,"wires":[["ce83e5bf.b00158"]]},{"id":"35025aec.f763c6","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":1920,"wires":[["5e6581b6.d35c1"]]},{"id":"e0d78d97.33df6","type":"comment","z":"48413719.e10dd8","name":"9","info":"","x":930,"y":2600,"wires":[]},{"id":"f65b6849.be0a68","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_9.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":2640,"wires":[["ef94b6a0.aa4408"]]},{"id":"a223c369.bc37d","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_9.txt -o /distr/iconv_t/outfile_9.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1300,"y":2640,"wires":[["edd46b73.6c0018"],[],[]]},{"id":"edd46b73.6c0018","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_9.txt","format":"","x":1490,"y":2640,"wires":[["8685f393.5e72a"]]},{"id":"8685f393.5e72a","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1690,"y":2640,"wires":[["f8d31f27.0c917"]]},{"id":"f8d31f27.0c917","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1860,"y":2640,"wires":[["51b196f1.fc9708","f5d6804f.f8896","b2eeb939.6bcf98"]]},{"id":"4826966d.9864f8","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_9.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":970,"y":2780,"wires":[["ef94b6a0.aa4408"]]},{"id":"e6eb3cac.56efd","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":850,"y":2780,"wires":[["4826966d.9864f8"]]},{"id":"795a15af.b6764c","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":850,"y":2740,"wires":[["c68210b2.a06ad"]]},{"id":"c68210b2.a06ad","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ123\");\narr.push(\"<s2>2_ТЕСТ456\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_9.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":970,"y":2740,"wires":[["ef94b6a0.aa4408"]]},{"id":"ef94b6a0.aa4408","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1170,"y":2640,"wires":[["a223c369.bc37d"],[],[]]},{"id":"51b196f1.fc9708","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":2620,"wires":[["d7dd6617.502088"]]},{"id":"8390507b.e6ce","type":"function","z":"48413719.e10dd8","name":"2р","func":"msg.payload =  msg.payload.Строка2;\n//максимально 12 символів у рядку\nflow.set('2r8', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":2700,"wires":[["d7dd6617.502088"]]},{"id":"f5d6804f.f8896","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2050,"y":2660,"wires":[["dbb7715c.077d7"]]},{"id":"dbb7715c.077d7","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":2660,"wires":[["d7dd6617.502088"]]},{"id":"b2eeb939.6bcf98","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2050,"y":2700,"wires":[["8390507b.e6ce"]]},{"id":"fa6c016f.9c071","type":"comment","z":"48413719.e10dd8","name":"10","info":"","x":910,"y":2900,"wires":[]},{"id":"c117ef42.7859","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_10.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":930,"y":2940,"wires":[["66f547ce.dafa18"]]},{"id":"e4ede7bf.473a48","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_10.txt -o /distr/iconv_t/outfile_10.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1280,"y":2940,"wires":[["547d04e3.b9c0ac"],[],[]]},{"id":"547d04e3.b9c0ac","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_10.txt","format":"","x":1470,"y":2940,"wires":[["30839100.f5d06e"]]},{"id":"30839100.f5d06e","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":2940,"wires":[["da0c057e.0b39c8"]]},{"id":"da0c057e.0b39c8","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1840,"y":2940,"wires":[["9d3e30f2.6c624","123c7823.017ec8","fa60a31b.b215b"]]},{"id":"db676a63.f5af68","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_10.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":3060,"wires":[["66f547ce.dafa18"]]},{"id":"3dc4c06.6a6ae4","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":830,"y":3060,"wires":[["db676a63.f5af68"]]},{"id":"31a25b8.3fc4ea4","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":830,"y":3020,"wires":[["82cfd504.90a9c8"]]},{"id":"82cfd504.90a9c8","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ123\");\narr.push(\"<s2>2_ТЕСТ456\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_10.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":3020,"wires":[["66f547ce.dafa18"]]},{"id":"66f547ce.dafa18","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1150,"y":2940,"wires":[["e4ede7bf.473a48"],[],[]]},{"id":"9d3e30f2.6c624","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2170,"y":2920,"wires":[["cf2350ce.1a682"]]},{"id":"9e0b94cb.e330c8","type":"function","z":"48413719.e10dd8","name":"2р","func":"msg.payload =  msg.payload.Строка2;\n//максимально 12 символів у рядку\nflow.set('2r8', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":2170,"y":3000,"wires":[["cf2350ce.1a682"]]},{"id":"123c7823.017ec8","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":2960,"wires":[["658adbd4.155764"]]},{"id":"658adbd4.155764","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2170,"y":2960,"wires":[["cf2350ce.1a682"]]},{"id":"fa60a31b.b215b","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":3000,"wires":[["9e0b94cb.e330c8"]]},{"id":"c7e88d7c.dee9a","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.40","port":"5018","beserver":"client","base64":false,"end":true,"name":"","x":2400,"y":2400,"wires":[]},{"id":"2ccd6aea.42fbe6","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_8.txt","format":"","x":2950,"y":2400,"wires":[["3b8a4818.db10b8"]]},{"id":"39197a31.6df7a6","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/text_8.txt","format":"utf8","x":2930,"y":2460,"wires":[["57ecfef2.95926"]]},{"id":"3b8a4818.db10b8","type":"debug","z":"48413719.e10dd8","name":"","active":true,"console":"false","complete":"false","x":3210,"y":2400,"wires":[]},{"id":"57ecfef2.95926","type":"debug","z":"48413719.e10dd8","name":"","active":true,"console":"false","complete":"false","x":3200,"y":2460,"wires":[]},{"id":"178c5ef8.be3011","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":2730,"y":2400,"wires":[["2ccd6aea.42fbe6"]]},{"id":"1f1a684.205bb98","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":2730,"y":2460,"wires":[["39197a31.6df7a6"]]},{"id":"ce83e5bf.b00158","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.36","port":"5016","beserver":"client","base64":false,"end":true,"name":"","x":2380,"y":1900,"wires":[]},{"id":"8c905c13.80283","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.37","port":"5015","beserver":"client","base64":false,"end":true,"name":"","x":2400,"y":1660,"wires":[]},{"id":"d7dd6617.502088","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.47","port":"5019","beserver":"client","base64":false,"end":true,"name":"","x":2380,"y":2660,"wires":[]},{"id":"cf2350ce.1a682","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.48","port":"5020","beserver":"client","base64":false,"end":true,"name":"","x":2360,"y":2960,"wires":[]},{"id":"5b796b0f.ac1cc4","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.31","port":"5014","beserver":"client","base64":false,"end":true,"name":"","x":2400,"y":1140,"wires":[]},{"id":"3b5b7815.1da648","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.33","port":"5013","beserver":"client","base64":false,"end":true,"name":"","x":2380,"y":920,"wires":[]},{"id":"ca292340.169ab","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.32","port":"5012","beserver":"client","base64":false,"end":true,"name":"","x":2380,"y":700,"wires":[]},{"id":"6b3c35b2.00656c","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.34","port":"5011","beserver":"client","base64":false,"end":true,"name":"","x":2400,"y":440,"wires":[]},{"id":"48926dd.696ab94","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.35","port":"5017","beserver":"client","base64":false,"end":true,"name":"","x":2380,"y":2140,"wires":[]},{"id":"33f70801.94d168","type":"delay","z":"f93250c7.39091","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1130,"y":340,"wires":[["bb9e6db8.45a36"]]},{"id":"6a9463df.10b05c","type":"switch","z":"f93250c7.39091","name":"","property":"transactionMaxWeight","propertyType":"msg","rules":[{"t":"gt","v":"filterSend1C","vt":"global"}],"checkall":"true","outputs":1,"x":990,"y":340,"wires":[["33f70801.94d168"]]},{"id":"bb9e6db8.45a36","type":"function","z":"f93250c7.39091","name":"send 1C","func":"//формування відповіді\nmsg.payload = msg.metadata;\n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id  = flow.get('truck_id'); \nmsg.payload.device_id = global.get('scale_id_in');\n\n\n//видалення завих параметрів\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\ndelete msg.payload.transactionAccWeight;\ndelete msg.payload.waybill;\ndelete msg.payload.driverInCar;\ndelete msg.payload.transactionOperationName;\n\n\n\n\n//адреса для відправки  \nmsg.url = global.get(\"send_1c_url_GetWeight\");  \nreturn msg;","outputs":1,"noerr":0,"x":1300,"y":340,"wires":[["7983aa11.de3a54","9d57e126.aa706"]]},{"id":"7983aa11.de3a54","type":"http request","z":"f93250c7.39091","name":"","method":"POST","ret":"txt","url":"","tls":"f436a52.4d81958","x":1490,"y":340,"wires":[["761b0b0d.0792f4","912fd53c.0f1cd8"]]},{"id":"9f142b96.1fe8d8","type":"delay","z":"1124af78.b62db1","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1130,"y":360,"wires":[["9f47c2b3.19c78"]]},{"id":"590f0d9f.562a44","type":"switch","z":"1124af78.b62db1","name":"","property":"transactionMaxWeight","propertyType":"msg","rules":[{"t":"gt","v":"filterSend1C","vt":"global"}],"checkall":"true","outputs":1,"x":990,"y":360,"wires":[["9f142b96.1fe8d8"]]},{"id":"9f47c2b3.19c78","type":"function","z":"1124af78.b62db1","name":"send 1C","func":"//формування відповіді\nmsg.payload = msg.metadata;\n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id  = flow.get('truck_id');\nmsg.payload.device_id = global.get('scale_id_in_2');\n\n\n//видалення завих параметрів\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\ndelete msg.payload.transactionAccWeight;\ndelete msg.payload.waybill;\ndelete msg.payload.driverInCar;\ndelete msg.payload.transactionOperationName;\n\n\n//адреса для відправки  \nmsg.url = global.get(\"send_1c_url_GetWeight\");  \nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":360,"wires":[["8cce0495.808368","de1ab173.ab81c"]]},{"id":"8cce0495.808368","type":"http request","z":"1124af78.b62db1","name":"","method":"POST","ret":"txt","url":"","tls":"f436a52.4d81958","x":1490,"y":360,"wires":[["a3ab4abb.73ad38","4de97d28.b7e8c4"]]},{"id":"8f99ba86.7c8208","type":"debug","z":"f93250c7.39091","name":"","active":true,"console":"false","complete":"true","x":1370,"y":520,"wires":[]},{"id":"3103f5e8.8a15da","type":"debug","z":"1124af78.b62db1","name":"Avto 2 IN event","active":false,"console":"true","complete":"true","x":1410,"y":560,"wires":[]},{"id":"a06e97ed.15ea68","type":"comment","z":"f93250c7.39091","name":"Відправка в 1С після зїзду","info":"","x":1090,"y":300,"wires":[]},{"id":"fbdd303b.a9126","type":"comment","z":"1124af78.b62db1","name":"Відправка в 1С після зїзду","info":"","x":1060,"y":320,"wires":[]},{"id":"b828decc.ec331","type":"comment","z":"2b507412.efc2cc","name":"Відправка в 1С після зїзду","info":"","x":1180,"y":300,"wires":[]},{"id":"bcd8af80.fe4ff","type":"comment","z":"2b507412.efc2cc","name":"Зробити фото","info":"","x":1180,"y":660,"wires":[]},{"id":"797d58d9.504468","type":"comment","z":"1124af78.b62db1","name":"Зробити фото","info":"","x":1080,"y":640,"wires":[]},{"id":"409db26f.71d3ec","type":"http request","z":"f93250c7.39091","name":"get id sesion","method":"GET","ret":"obj","url":"https://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir","tls":"d049c21b.cdc58","x":1350,"y":720,"wires":[[]]},{"id":"209bd7d1.6d91d8","type":"function","z":"f93250c7.39091","name":"sid","func":"//let sid = msg.payload.sid;\n//msg.sid = sid;\n\n//let sid = msg.payload.sid;\nlet sid =global.get('sid');\nmsg.sid = sid;\n\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1390,"y":760,"wires":[["da9b0cb3.2b43c","36f47433.d3467c","da43d352.7267c"]]},{"id":"64ff2c0a.8df444","type":"function","z":"f93250c7.39091","name":"screenshot","func":"let guidChannel = \"ezoJU3It\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":1710,"y":760,"wires":[["8b7f6f9e.abed6"]]},{"id":"8b7f6f9e.abed6","type":"http request","z":"f93250c7.39091","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":1870,"y":760,"wires":[["a5857095.52428"]]},{"id":"64818b16.9efd34","type":"switch","z":"f93250c7.39091","name":"take snapshot","property":"snapshot","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1100,"y":660,"wires":[["764c1774.554388"]]},{"id":"a5857095.52428","type":"function","z":"f93250c7.39091","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2050,"y":760,"wires":[["2b7d63d5.c8748c"]]},{"id":"2b7d63d5.c8748c","type":"http request","z":"f93250c7.39091","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2260,"y":760,"wires":[["51d0b8ec.a36248"]]},{"id":"a3ab4abb.73ad38","type":"function","z":"1124af78.b62db1","name":"clear truck_id","func":" flow.set('truck_id', \"\");\n flow.set('reader', \"\");\nreturn msg;","outputs":1,"noerr":0,"x":1690,"y":320,"wires":[[]]},{"id":"761b0b0d.0792f4","type":"function","z":"f93250c7.39091","name":"clear truck_id","func":" flow.set('truck_id', \"\");\n flow.set('reader', \"\");\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":300,"wires":[[]]},{"id":"c4a0eaf8.535c68","type":"function","z":"f93250c7.39091","name":"screenshot","func":"let guidChannel = \"vav9ADtx\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":1710,"y":800,"wires":[["b66335e1.018028"]]},{"id":"7f749460.ef80cc","type":"function","z":"f93250c7.39091","name":"screenshot","func":"let guidChannel = \"DYL0mD4k\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":1710,"y":840,"wires":[["dbb14e01.b9ce9"]]},{"id":"c567b364.f14a2","type":"function","z":"f93250c7.39091","name":"delete","func":"\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1250,"y":760,"wires":[["209bd7d1.6d91d8"]]},{"id":"e0a540fb.2ed98","type":"http request","z":"1124af78.b62db1","name":"get id sesion","method":"GET","ret":"obj","url":"https://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir","tls":"d049c21b.cdc58","x":1430,"y":660,"wires":[[]]},{"id":"320efe31.b215a2","type":"function","z":"1124af78.b62db1","name":"sid","func":"//let sid = msg.payload.sid;\nlet sid =global.get('sid');\nmsg.sid = sid;\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":720,"wires":[["5779ba34.471214","2d40942d.dcb3cc","7ab3bc01.9aaa54"]]},{"id":"311f01c8.388d9e","type":"function","z":"1124af78.b62db1","name":"screenshot","func":"let guidChannel = \"oVG1YLM8\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":1910,"y":720,"wires":[["41a7c686.2aca18"]]},{"id":"41a7c686.2aca18","type":"http request","z":"1124af78.b62db1","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2110,"y":720,"wires":[["1dd2e8a1.5ef167"]]},{"id":"c4b6afa.dae075","type":"switch","z":"1124af78.b62db1","name":"take snapshot","property":"snapshot","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1080,"y":680,"wires":[["195dd5b0.f4a7fa"]]},{"id":"1dd2e8a1.5ef167","type":"function","z":"1124af78.b62db1","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in_2');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":720,"wires":[["78e284d3.7d39fc"]]},{"id":"78e284d3.7d39fc","type":"http request","z":"1124af78.b62db1","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2500,"y":720,"wires":[[]]},{"id":"bbdb347d.8fd6f8","type":"function","z":"1124af78.b62db1","name":"screenshot","func":"let guidChannel = \"u7c7YCVj\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":1910,"y":760,"wires":[["33a1431e.6362ac"]]},{"id":"ad0c9520.b7f178","type":"function","z":"1124af78.b62db1","name":"screenshot","func":"let guidChannel = \"R2e0sWLr\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":1910,"y":800,"wires":[["24599980.18d396"]]},{"id":"d2dc013d.861c2","type":"function","z":"1124af78.b62db1","name":"delete","func":"\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":720,"wires":[["320efe31.b215a2"]]},{"id":"715825da.39704c","type":"http request","z":"2b507412.efc2cc","name":"get id sesion","method":"GET","ret":"obj","url":"https://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir","tls":"d049c21b.cdc58","x":1450,"y":700,"wires":[[]]},{"id":"3f4c872f.7b5658","type":"function","z":"2b507412.efc2cc","name":"sid","func":"//let sid = msg.payload.sid;\nlet sid =global.get('sid');\nmsg.sid = sid;\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1510,"y":780,"wires":[["c29d50c0.d272a","99dbb39b.bb02d","881aa7a7.30b848"]]},{"id":"302adcfd.4c8734","type":"function","z":"2b507412.efc2cc","name":"screenshot","func":"let guidChannel = \"g0tN14Mn\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n\nlet guidChannel = \"g0tN14Mn\"; //SecondSite-R6A23-V7-LPR\nlet guidChannel = \"RYkh10M2\"; //SecondSite-R6A06-V9\n//let guidChannel = \"eKPm5PtF\"; //SecondSite-R6A18-V6-LPR\n\n\n\n*/","outputs":1,"noerr":0,"x":1890,"y":740,"wires":[["744a54f6.e3c6dc"]]},{"id":"744a54f6.e3c6dc","type":"http request","z":"2b507412.efc2cc","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2050,"y":740,"wires":[["4d4f680f.a072c8"]]},{"id":"3e73f8f4.e831a8","type":"switch","z":"2b507412.efc2cc","name":"take snapshot","property":"snapshot","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1120,"y":620,"wires":[["7aad1878.3b6858"]]},{"id":"4d4f680f.a072c8","type":"function","z":"2b507412.efc2cc","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in_3');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n};\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n};\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2230,"y":740,"wires":[["57f3ea4a.469284"]]},{"id":"57f3ea4a.469284","type":"http request","z":"2b507412.efc2cc","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2440,"y":740,"wires":[["bc0fd4c9.c22268"]]},{"id":"efce07c1.8831b8","type":"function","z":"2b507412.efc2cc","name":"screenshot","func":"let guidChannel = \"RYkh10M2\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n\nlet guidChannel = \"g0tN14Mn\"; //SecondSite-R6A23-V7-LPR\nlet guidChannel = \"RYkh10M2\"; //SecondSite-R6A06-V9\n//let guidChannel = \"eKPm5PtF\"; //SecondSite-R6A18-V6-LPR\n\n\n*/","outputs":1,"noerr":0,"x":1890,"y":780,"wires":[["202b5746.a14ca8"]]},{"id":"bac78df.a8bfc7","type":"function","z":"2b507412.efc2cc","name":"screenshot","func":"let guidChannel = \"eKPm5PtF\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n\nlet guidChannel = \"g0tN14Mn\"; //SecondSite-R6A23-V7-LPR\nlet guidChannel = \"RYkh10M2\"; //SecondSite-R6A06-V9\n//let guidChannel = \"eKPm5PtF\"; //SecondSite-R6A18-V6-LPR\n\n\n\n*/","outputs":1,"noerr":0,"x":1890,"y":820,"wires":[["af2cb7f7.1c7608"]]},{"id":"61b8a10a.e29f9","type":"function","z":"2b507412.efc2cc","name":"delete","func":"\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1310,"y":780,"wires":[["3f4c872f.7b5658"]]},{"id":"d79438fc.578dd8","type":"delay","z":"2b507412.efc2cc","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1230,"y":360,"wires":[["a5771ce.21ec7e"]]},{"id":"3b551ea4.e46842","type":"switch","z":"2b507412.efc2cc","name":"","property":"transactionMaxWeight","propertyType":"msg","rules":[{"t":"gt","v":"filterSend1C","vt":"global"}],"checkall":"true","outputs":1,"x":1090,"y":360,"wires":[["d79438fc.578dd8"]]},{"id":"a5771ce.21ec7e","type":"function","z":"2b507412.efc2cc","name":"send 1C","func":"//формування відповіді\nmsg.payload = msg.metadata;\n\n//ідентифікація девайсів і ТЗ\nmsg.payload.truck_id  = flow.get('truck_id');\nmsg.payload.device_id = global.get('scale_id_in_3');\n\n\n//видалення завих параметрів\ndelete msg.metadata;\ndelete msg.is_minus;\ndelete msg.send1C;\ndelete msg.subWePr;\ndelete msg.payload.perimetr;\ndelete msg.payload.transactionAccWeight;\ndelete msg.payload.waybill;\ndelete msg.payload.driverInCar;\ndelete msg.payload.transactionOperationName;\n\n\n//адреса для відправки  \nmsg.url = global.get(\"send_1c_url_GetWeight\");  \nreturn msg;","outputs":1,"noerr":0,"x":1400,"y":360,"wires":[["2e2fdc3f.2d27c4","3de9272c.353788"]]},{"id":"2e2fdc3f.2d27c4","type":"http request","z":"2b507412.efc2cc","name":"","method":"POST","ret":"txt","url":"","tls":"f436a52.4d81958","x":1590,"y":360,"wires":[["867f3f44.8881c","1eba451.012dfbb"]]},{"id":"867f3f44.8881c","type":"debug","z":"2b507412.efc2cc","name":"3 out res 1c","active":false,"console":false,"complete":"true","x":1790,"y":360,"wires":[]},{"id":"3de9272c.353788","type":"debug","z":"2b507412.efc2cc","name":"3 out send 1c","active":false,"console":"true","complete":"true","x":1560,"y":300,"wires":[]},{"id":"1eba451.012dfbb","type":"function","z":"2b507412.efc2cc","name":"clear truck_id","func":" flow.set('truck_id', \"\");\n flow.set('reader', \"\");\nreturn msg;","outputs":1,"noerr":0,"x":1790,"y":320,"wires":[[]]},{"id":"9aa8d5c3.85e918","type":"debug","z":"f93250c7.39091","name":"","active":false,"console":"false","complete":"on","x":400,"y":680,"wires":[]},{"id":"33869d1b.64cea2","type":"link out","z":"de930ae4.560b48","name":"send on tablo","links":["2798cbda.2a26b4"],"x":815,"y":400,"wires":[]},{"id":"d617d387.efc1","type":"link out","z":"bd4c94f4.ece8e8","name":"send tablo 3","links":["c27287d.e7b2878"],"x":715,"y":520,"wires":[]},{"id":"bf7ee5bf.f0c5c8","type":"delay","z":"de930ae4.560b48","name":"","pauseType":"rate","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":450,"y":280,"wires":[["cba9ee64.765ef","5520ae29.c8d2f"]]},{"id":"6fe046ed.96e378","type":"debug","z":"f93250c7.39091","name":"req","active":false,"console":"false","complete":"true","x":570,"y":940,"wires":[]},{"id":"d7bb8423.309218","type":"debug","z":"f93250c7.39091","name":"res","active":false,"console":"false","complete":"true","x":630,"y":1040,"wires":[]},{"id":"b66335e1.018028","type":"http request","z":"f93250c7.39091","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":1870,"y":800,"wires":[["273bb465.4e265c"]]},{"id":"273bb465.4e265c","type":"function","z":"f93250c7.39091","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2050,"y":800,"wires":[["3761774d.3c1b58"]]},{"id":"3761774d.3c1b58","type":"http request","z":"f93250c7.39091","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2260,"y":800,"wires":[["51d0b8ec.a36248"]]},{"id":"dbb14e01.b9ce9","type":"http request","z":"f93250c7.39091","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":1870,"y":840,"wires":[["8bb5be80.f1f6d"]]},{"id":"8bb5be80.f1f6d","type":"function","z":"f93250c7.39091","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2050,"y":840,"wires":[["18c6ae92.6c25b1"]]},{"id":"18c6ae92.6c25b1","type":"http request","z":"f93250c7.39091","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2260,"y":840,"wires":[["51d0b8ec.a36248"]]},{"id":"da9b0cb3.2b43c","type":"delay","z":"f93250c7.39091","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1540,"y":760,"wires":[["64ff2c0a.8df444"]]},{"id":"36f47433.d3467c","type":"delay","z":"f93250c7.39091","name":"","pauseType":"delay","timeout":"6","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1540,"y":800,"wires":[["c4a0eaf8.535c68"]]},{"id":"da43d352.7267c","type":"delay","z":"f93250c7.39091","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1540,"y":840,"wires":[["7f749460.ef80cc"]]},{"id":"33a1431e.6362ac","type":"http request","z":"1124af78.b62db1","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2110,"y":760,"wires":[["38f95b05.0563b4"]]},{"id":"38f95b05.0563b4","type":"function","z":"1124af78.b62db1","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in_2');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":760,"wires":[["af75f748.ac5fe8"]]},{"id":"af75f748.ac5fe8","type":"http request","z":"1124af78.b62db1","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2500,"y":760,"wires":[[]]},{"id":"24599980.18d396","type":"http request","z":"1124af78.b62db1","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2110,"y":800,"wires":[["2140c264.368b7e"]]},{"id":"2140c264.368b7e","type":"function","z":"1124af78.b62db1","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in_2');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":800,"wires":[["a1351748.b76888"]]},{"id":"a1351748.b76888","type":"http request","z":"1124af78.b62db1","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2500,"y":800,"wires":[[]]},{"id":"5779ba34.471214","type":"delay","z":"1124af78.b62db1","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1720,"y":720,"wires":[["311f01c8.388d9e"]]},{"id":"2d40942d.dcb3cc","type":"delay","z":"1124af78.b62db1","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1720,"y":760,"wires":[["bbdb347d.8fd6f8"]]},{"id":"7ab3bc01.9aaa54","type":"delay","z":"1124af78.b62db1","name":"","pauseType":"delay","timeout":"7","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1720,"y":800,"wires":[["ad0c9520.b7f178"]]},{"id":"202b5746.a14ca8","type":"http request","z":"2b507412.efc2cc","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2050,"y":780,"wires":[["9d35f06e.92193"]]},{"id":"9d35f06e.92193","type":"function","z":"2b507412.efc2cc","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in_3');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n};\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n};\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2230,"y":780,"wires":[["c97cbce8.fb0e1"]]},{"id":"c97cbce8.fb0e1","type":"http request","z":"2b507412.efc2cc","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2440,"y":780,"wires":[[]]},{"id":"af2cb7f7.1c7608","type":"http request","z":"2b507412.efc2cc","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2050,"y":820,"wires":[["aa3a7d99.2a508"]]},{"id":"aa3a7d99.2a508","type":"function","z":"2b507412.efc2cc","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_in_3');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n};\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n};\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2230,"y":820,"wires":[["343b2063.27963"]]},{"id":"343b2063.27963","type":"http request","z":"2b507412.efc2cc","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2440,"y":820,"wires":[[]]},{"id":"c29d50c0.d272a","type":"delay","z":"2b507412.efc2cc","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1740,"y":740,"wires":[["302adcfd.4c8734"]]},{"id":"99dbb39b.bb02d","type":"delay","z":"2b507412.efc2cc","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1740,"y":780,"wires":[["efce07c1.8831b8"]]},{"id":"881aa7a7.30b848","type":"delay","z":"2b507412.efc2cc","name":"","pauseType":"delay","timeout":"6","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1740,"y":820,"wires":[["bac78df.a8bfc7"]]},{"id":"e2fb7c6d.e9213","type":"inject","z":"4a4a57b9.eaf268","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":160,"y":200,"wires":[["7aa81f8c.9d025"]]},{"id":"7aa81f8c.9d025","type":"http request","z":"4a4a57b9.eaf268","name":"","method":"POST","ret":"txt","url":"http://10.101.1.17/ELC_SCAT/hs/PerimeterControl/api/ERFID/RFIDCommandWriteListTags","tls":"","x":380,"y":200,"wires":[["c424721.db6699"]]},{"id":"c424721.db6699","type":"debug","z":"4a4a57b9.eaf268","name":"","active":true,"console":"false","complete":"false","x":690,"y":200,"wires":[]},{"id":"432ae964.8ea3f8","type":"comment","z":"87b488d6.5b73f8","name":"info","info":"MySQL:\nUser: root;\nPassword: Zz_875_gw.\nZz_875_gw\n\nelecMeter_MeterSerialNumber_type1\n<\n\n\nDB - astue\n10.107.5.202\nastue\nZz_875_gw","x":90,"y":440,"wires":[]},{"id":"b4797310.6a2e3","type":"debug","z":"1124af78.b62db1","name":"","active":true,"console":"false","complete":"true","x":1090,"y":880,"wires":[]},{"id":"7aad1878.3b6858","type":"delay","z":"2b507412.efc2cc","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"15","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1120,"y":700,"wires":[["61b8a10a.e29f9"]]},{"id":"1a3558b7.66dfc7","type":"comment","z":"f93250c7.39091","name":"Зробити фото","info":"","x":1080,"y":580,"wires":[]},{"id":"615bb570.072fdc","type":"function","z":"bd4c94f4.ece8e8","name":"","func":"var inString = msg.payload;\n\n\nif(inString.length == 10){\n  return msg;  \n}\n","outputs":1,"noerr":0,"x":370,"y":440,"wires":[["23b17797.c59198","952f2815.f7ba78"]]},{"id":"195dd5b0.f4a7fa","type":"delay","z":"1124af78.b62db1","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1080,"y":720,"wires":[["d2dc013d.861c2"]]},{"id":"9c25b1d4.3320c","type":"ui_text","z":"f93250c7.39091","group":"c79d0006.26eda","order":0,"width":0,"height":0,"name":"","label":"Стабільність ліві:","format":"{{msg.stable}}","layout":"row-spread","x":410,"y":720,"wires":[]},{"id":"ac9bf693.2938a8","type":"ui_text","z":"1124af78.b62db1","group":"c79d0006.26eda","order":0,"width":0,"height":0,"name":"","label":"Стабільність праві:","format":"{{msg.stable}}","layout":"row-spread","x":430,"y":700,"wires":[]},{"id":"3a67b893.6d0158","type":"debug","z":"1124af78.b62db1","name":"IN device config","active":false,"console":"false","complete":"true","x":840,"y":200,"wires":[]},{"id":"e33d3f31.c81a5","type":"inject","z":"1124af78.b62db1","name":"","topic":"","payload":"transaction","payloadType":"flow","repeat":"","crontab":"","once":false,"x":160,"y":360,"wires":[["38ab48f4.67d978"]]},{"id":"38ab48f4.67d978","type":"debug","z":"1124af78.b62db1","name":"","active":true,"console":"false","complete":"false","x":340,"y":360,"wires":[]},{"id":"96d54232.f88b9","type":"comment","z":"48413719.e10dd8","name":"11","info":"","x":910,"y":3140,"wires":[]},{"id":"89f2a0c3.c1c38","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_11.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":930,"y":3180,"wires":[["91c433c4.1ff02","1037e0f3.49367f"]]},{"id":"53d8235.2fa15dc","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_11.txt -o /distr/iconv_t/outfile_11.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1280,"y":3180,"wires":[["e476c4d1.8ec9b8"],[],[]]},{"id":"e476c4d1.8ec9b8","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_11.txt","format":"","x":1470,"y":3180,"wires":[["32db7fa7.edb83"]]},{"id":"32db7fa7.edb83","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":3180,"wires":[["74725d46.4aa874"]]},{"id":"74725d46.4aa874","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1840,"y":3180,"wires":[["daf5e08.366682","9271f86c.d32e18","fa35ea90.25fdb8","f3eea38b.06653"]]},{"id":"7ca3a474.98a80c","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_10.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":3280,"wires":[["91c433c4.1ff02"]]},{"id":"787fb0e1.e41b9","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":830,"y":3280,"wires":[["7ca3a474.98a80c"]]},{"id":"efd5b1d6.2378b","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":830,"y":3240,"wires":[["9fc96011.268c3"]]},{"id":"9fc96011.268c3","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ11\");\narr.push(\"<s2>2_ТЕСТ11\");\nvar AllString = arr.join('+');\nmsg.table_id = 11;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_11.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":3240,"wires":[["91c433c4.1ff02"]]},{"id":"91c433c4.1ff02","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1150,"y":3180,"wires":[["53d8235.2fa15dc"],[],[]]},{"id":"daf5e08.366682","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2170,"y":3160,"wires":[["98c1c885.a77888","2421a450.0a87ec"]]},{"id":"a9ec246b.642308","type":"function","z":"48413719.e10dd8","name":"2р","func":"msg.payload =  msg.payload.Строка2;\n//максимально 12 символів у рядку\nflow.set('2r8', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":2170,"y":3240,"wires":[["98c1c885.a77888","2421a450.0a87ec"]]},{"id":"9271f86c.d32e18","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":3200,"wires":[["20545238.72d35e"]]},{"id":"20545238.72d35e","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2170,"y":3200,"wires":[["98c1c885.a77888"]]},{"id":"fa35ea90.25fdb8","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":3240,"wires":[["a9ec246b.642308"]]},{"id":"98c1c885.a77888","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.42","port":"5021","beserver":"client","base64":false,"end":true,"name":"","x":2360,"y":3200,"wires":[]},{"id":"758e3a8c.cbd234","type":"comment","z":"48413719.e10dd8","name":"12","info":"","x":930,"y":3360,"wires":[]},{"id":"1d665d63.bf4eb3","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_12.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":3400,"wires":[["36227956.3a6716","ba1a881b.77fa88"]]},{"id":"96afd5fc.f85ce8","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_12.txt -o /distr/iconv_t/outfile_12.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1300,"y":3400,"wires":[["ec3efcd0.02242"],[],[]]},{"id":"ec3efcd0.02242","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_12.txt","format":"","x":1490,"y":3400,"wires":[["724aac12.4525f4"]]},{"id":"724aac12.4525f4","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1690,"y":3400,"wires":[["5b547d8a.e57064"]]},{"id":"5b547d8a.e57064","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1860,"y":3400,"wires":[["a9709889.28da18","9063a43b.0bff08","cc17bba3.779a68","41599b9b.4d3ec4"]]},{"id":"29741001.ac35f","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_10.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":970,"y":3500,"wires":[["36227956.3a6716"]]},{"id":"9e10c5d8.c311c8","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":850,"y":3500,"wires":[["29741001.ac35f"]]},{"id":"47a1c1e2.42fd9","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":850,"y":3460,"wires":[["db3bb205.3a7a3"]]},{"id":"db3bb205.3a7a3","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ12\");\narr.push(\"<s2>2_ТЕСТ12\");\nvar AllString = arr.join('+');\nmsg.table_id = 12;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_12.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":970,"y":3460,"wires":[["36227956.3a6716"]]},{"id":"36227956.3a6716","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1170,"y":3400,"wires":[["96afd5fc.f85ce8"],[],[]]},{"id":"a9709889.28da18","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":3380,"wires":[["26a300cf.9c049"]]},{"id":"245d4b76.fb6d04","type":"function","z":"48413719.e10dd8","name":"2р","func":"msg.payload =  msg.payload.Строка2;\n//максимально 12 символів у рядку\nflow.set('2r8', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":3460,"wires":[["26a300cf.9c049"]]},{"id":"9063a43b.0bff08","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2050,"y":3420,"wires":[["8dd5c874.492438"]]},{"id":"8dd5c874.492438","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":3420,"wires":[["26a300cf.9c049"]]},{"id":"cc17bba3.779a68","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2050,"y":3460,"wires":[["245d4b76.fb6d04"]]},{"id":"26a300cf.9c049","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.43","port":"5022","beserver":"client","base64":false,"end":true,"name":"","x":2380,"y":3420,"wires":[]},{"id":"e8d78bf7.fd8e48","type":"comment","z":"48413719.e10dd8","name":"13","info":"","x":930,"y":3600,"wires":[]},{"id":"4784027e.7c1d9c","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_13.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":3640,"wires":[["68b2a5bb.2ac9ec","329ba532.3a961a"]]},{"id":"cad270cb.388b8","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_13.txt -o /distr/iconv_t/outfile_13.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1300,"y":3640,"wires":[["6e4c0fc6.c62bc"],[],[]]},{"id":"6e4c0fc6.c62bc","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_13.txt","format":"","x":1490,"y":3640,"wires":[["4a4defde.5d371"]]},{"id":"4a4defde.5d371","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1690,"y":3640,"wires":[["54b174e2.0c5c5c"]]},{"id":"54b174e2.0c5c5c","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1860,"y":3640,"wires":[["145db089.e3fa8f","992f4ce7.327d9","185e7265.ff4e5e","39446118.acbc2e"]]},{"id":"b963eb4f.859a48","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_10.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":970,"y":3740,"wires":[["68b2a5bb.2ac9ec"]]},{"id":"3bec37ad.41d148","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":850,"y":3740,"wires":[["b963eb4f.859a48"]]},{"id":"8d685020.42331","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":850,"y":3700,"wires":[["3893111c.f5c87e"]]},{"id":"3893111c.f5c87e","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ13\");\narr.push(\"<s2>2_ТЕСТ13\");\nvar AllString = arr.join('+');\nmsg.table_id = 13;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_13.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":970,"y":3700,"wires":[["68b2a5bb.2ac9ec"]]},{"id":"68b2a5bb.2ac9ec","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1170,"y":3640,"wires":[["cad270cb.388b8"],[],[]]},{"id":"145db089.e3fa8f","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":3620,"wires":[["52d919f3.a8aeb8"]]},{"id":"fe175f05.f2d12","type":"function","z":"48413719.e10dd8","name":"2р","func":"msg.payload =  msg.payload.Строка2;\n//максимально 12 символів у рядку\nflow.set('2r8', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":3700,"wires":[["52d919f3.a8aeb8"]]},{"id":"992f4ce7.327d9","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2050,"y":3660,"wires":[["b3fafda9.d1c0e"]]},{"id":"b3fafda9.d1c0e","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":3660,"wires":[["52d919f3.a8aeb8"]]},{"id":"185e7265.ff4e5e","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2050,"y":3700,"wires":[["fe175f05.f2d12"]]},{"id":"52d919f3.a8aeb8","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.44","port":"5023","beserver":"client","base64":false,"end":true,"name":"","x":2380,"y":3660,"wires":[]},{"id":"36147153.8b5d9e","type":"comment","z":"48413719.e10dd8","name":"14","info":"","x":930,"y":3860,"wires":[]},{"id":"b7d9973b.20fc08","type":"function","z":"48413719.e10dd8","name":"Send string","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(msg.payload.Строка1);\narr.push(msg.payload.Строка2);\n\nmsg.table_id = Number(msg.payload.АдресУстройства);\n\nvar AllString = arr.join('+');\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_14.txt`;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":950,"y":3900,"wires":[["1e75e425.ddd2cc","942cd639.c751d8"]]},{"id":"28c5ef52.e7cdf","type":"exec","z":"48413719.e10dd8","command":"iconv -f UTF-8 -t CP1251 /distr/iconv_t/text_14.txt -o /distr/iconv_t/outfile_14.txt","addpay":false,"append":"","useSpawn":"","timer":"","name":"decode","x":1300,"y":3900,"wires":[["92e8d21c.56e31"],[],[]]},{"id":"92e8d21c.56e31","type":"file in","z":"48413719.e10dd8","name":"","filename":"/distr/iconv_t/outfile_14.txt","format":"","x":1490,"y":3900,"wires":[["db13c8c2.a23da8"]]},{"id":"db13c8c2.a23da8","type":"function","z":"48413719.e10dd8","name":"get from file","func":"var buf = msg.payload;\nvar bufLength = buf.length;\n\nvar newBuf = buf.slice(0, bufLength - 1);\nvar i = buf.indexOf(43);\n\n\n\nmsg.str1 = newBuf.slice(0, i);\nmsg.str2 = newBuf.slice(i+1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1690,"y":3900,"wires":[["3215cef8.abcbf2"]]},{"id":"3215cef8.abcbf2","type":"function","z":"48413719.e10dd8","name":"set msg payload","func":"msg.payload = {\n    'АдресУстройства': Number(msg.table_id),\n    'Строка1': msg.str1,\n    'Строка2': msg.str2\n};\n\ndelete msg.str1;\ndelete msg.str2;\ndelete msg.req;\ndelete msg.res;\ndelete msg.payload.table_id;\ndelete msg.table_id;\ndelete msg.filename;\nreturn msg;","outputs":1,"noerr":0,"x":1860,"y":3900,"wires":[["f1d9d9c8.667b88","cbe00bc0.d112f8","fb63dd04.d23a7","aa1365a4.7332e8"]]},{"id":"36a87dc0.257582","type":"function","z":"48413719.e10dd8","name":"Clear","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>\");\narr.push(\"<s2>\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_10.txt`;\n\nreturn msg;\n","outputs":"1","noerr":0,"x":970,"y":4000,"wires":[["1e75e425.ddd2cc"]]},{"id":"dcf547b0.b4f808","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":850,"y":4000,"wires":[["36a87dc0.257582"]]},{"id":"78bdbdc.a59db44","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":850,"y":3960,"wires":[["b801da2.f258c28"]]},{"id":"b801da2.f258c28","type":"function","z":"48413719.e10dd8","name":"Test","func":"//  msg.payload = {\n//      'АдресУстройства': 1,\n//      'Строка1': \"<s1>\",\n//      'Строка2': \"<s2>\",\n//  };\n\nvar arr = [];\narr.push(\"<s1>1_ТЕСТ14\");\narr.push(\"<s2>2_ТЕСТ14\");\nvar AllString = arr.join('+');\nmsg.table_id = 7;\n//msg.table_id = msg.payload.АдресУстройства;\n\n//msg.payload.Строка1 = \"<s1> \" + msg.payload.Строка1;\n//msg.payload.Строка2 = \"<s2> \" + msg.payload.Строка2;\n\n\nmsg.payload = ` \"${AllString}\" > /distr/iconv_t/text_14.txt`;\n\n\nreturn msg;\n","outputs":"1","noerr":0,"x":970,"y":3960,"wires":[["1e75e425.ddd2cc"]]},{"id":"1e75e425.ddd2cc","type":"exec","z":"48413719.e10dd8","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1170,"y":3900,"wires":[["28c5ef52.e7cdf"],[],[]]},{"id":"f1d9d9c8.667b88","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":3880,"wires":[["a9f39fc1.40935"]]},{"id":"da77be6b.dd711","type":"function","z":"48413719.e10dd8","name":"2р","func":"msg.payload =  msg.payload.Строка2;\n//максимально 12 символів у рядку\nflow.set('2r8', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":3960,"wires":[["a9f39fc1.40935"]]},{"id":"cbe00bc0.d112f8","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2050,"y":3920,"wires":[["b2e52547.324af8"]]},{"id":"b2e52547.324af8","type":"function","z":"48413719.e10dd8","name":"1р","func":"msg.payload = msg.payload.Строка1;\n//максимально 12 символів у рядку\nflow.set('1r8', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":3920,"wires":[["a9f39fc1.40935"]]},{"id":"fb63dd04.d23a7","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2050,"y":3960,"wires":[["da77be6b.dd711"]]},{"id":"a9f39fc1.40935","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.45","port":"5024","beserver":"client","base64":false,"end":true,"name":"","x":2380,"y":3920,"wires":[]},{"id":"2421a450.0a87ec","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":2370,"y":3160,"wires":[]},{"id":"259f738f.e11d6c","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":870,"y":60,"wires":[["d4801986.ac3058"]]},{"id":"d4801986.ac3058","type":"function","z":"48413719.e10dd8","name":"init triger logic","func":"\nflow.set('trigerWeight_5', true);\nflow.set('trigerWeight_6', true);\nflow.set('trigerWeight_7', true);\nflow.set('trigerWeight_8', true);\nflow.set('trigerWeight_9', true);\nflow.set('trigerWeight_10', true);\nflow.set('trigerWeight_11', true);\nflow.set('trigerWeight_12', true);\nflow.set('trigerWeight_13', true);\nflow.set('trigerWeight_14', true);\n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":60,"wires":[[]]},{"id":"a9834e8d.ff0c9","type":"function","z":"48413719.e10dd8","name":"triger logic","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nvar findVesSt_1 = string_1.indexOf('#вес');\nvar findVesSt_2 = string_2.indexOf('#вес');\n\nif(findVesSt_1 > -1 || findVesSt_2 > -1){\n    flow.set('trigerWeight_5', true);\n}else if(findVesSt_1 == -1 && findVesSt_2 == -1){\n    flow.set('trigerWeight_5', false);\n    return msg;\n}\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":710,"y":1660,"wires":[["da6d2c19.75135","a094d64e.f06748"]]},{"id":"d9475276.2e18b","type":"function","z":"48413719.e10dd8","name":"triger logic","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nvar findVesSt_1 = string_1.indexOf('#вес');\nvar findVesSt_2 = string_2.indexOf('#вес');\n\nif(findVesSt_1 > -1 || findVesSt_2 > -1){\n    flow.set('trigerWeight_6', true);\n}else if(findVesSt_1 == -1 && findVesSt_2 == -1){\n    flow.set('trigerWeight_6', false);\n    return msg;\n}\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":730,"y":1880,"wires":[["d1076785.9578e8"]]},{"id":"fd5c58e1.d48b48","type":"function","z":"48413719.e10dd8","name":"triger logic","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nvar findVesSt_1 = string_1.indexOf('#вес');\nvar findVesSt_2 = string_2.indexOf('#вес');\n\nif(findVesSt_1 > -1 || findVesSt_2 > -1){\n    flow.set('trigerWeight_7', true);\n}else if(findVesSt_1 == -1 && findVesSt_2 == -1){\n    flow.set('trigerWeight_7', false);\n    return msg;\n}\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":750,"y":2120,"wires":[["ab125662.4cf4e8"]]},{"id":"d86ca67e.d15018","type":"function","z":"48413719.e10dd8","name":"triger logic","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nvar findVesSt_1 = string_1.indexOf('#вес');\nvar findVesSt_2 = string_2.indexOf('#вес');\n\nif(findVesSt_1 > -1 || findVesSt_2 > -1){\n    flow.set('trigerWeight_8', true);\n}else if(findVesSt_1 == -1 && findVesSt_2 == -1){\n    flow.set('trigerWeight_8', false);\n    return msg;\n}\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":770,"y":2360,"wires":[["b0432743.d79fd8"]]},{"id":"1ee83ab.25136c5","type":"function","z":"48413719.e10dd8","name":"triger logic","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nvar findVesSt_1 = string_1.indexOf('#вес');\nvar findVesSt_2 = string_2.indexOf('#вес');\n\nif(findVesSt_1 > -1 || findVesSt_2 > -1){\n    flow.set('trigerWeight_9', true);\n}else if(findVesSt_1 == -1 && findVesSt_2 == -1){\n    flow.set('trigerWeight_9', false);\n    return msg;\n}\n\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":770,"y":2640,"wires":[["f65b6849.be0a68"]]},{"id":"c55dae8e.8aed6","type":"function","z":"48413719.e10dd8","name":"triger logic","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nvar findVesSt_1 = string_1.indexOf('#вес');\nvar findVesSt_2 = string_2.indexOf('#вес');\n\nif(findVesSt_1 > -1 || findVesSt_2 > -1){\n    flow.set('trigerWeight_10', true);\n}else if(findVesSt_1 == -1 && findVesSt_2 == -1){\n    flow.set('trigerWeight_10', false);\n    return msg;\n}\n\n\n/*\n'АдресУстройства': 1,\n     'Строка1': \"<s1> Очікуйте \",\n     'Строка2': \"<s2> Зважування\",\n*/","outputs":1,"noerr":0,"x":770,"y":2900,"wires":[["c117ef42.7859"]]},{"id":"764beffa.f624","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"3","crontab":"","once":false,"x":1810,"y":1520,"wires":[["2f35681b.8e48a8"]]},{"id":"2f35681b.8e48a8","type":"switch","z":"48413719.e10dd8","name":"","property":"trigerWeight_5","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1950,"y":1520,"wires":[["83ff5bb5.7fe268","f8ceb653.eed6f8"]]},{"id":"83ff5bb5.7fe268","type":"function","z":"48413719.e10dd8","name":"5","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_2');\nif(weight || weight === 0){\n    var sendStr = `<s1>  ${weight}`;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":2190,"y":1520,"wires":[["8c905c13.80283","8593939c.9f62d","936d80c4.a14e1"]]},{"id":"a6c810aa.886f3","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"3","crontab":"","once":false,"x":1590,"y":1800,"wires":[["5bf8eef.0ff251"]]},{"id":"5bf8eef.0ff251","type":"switch","z":"48413719.e10dd8","name":"","property":"trigerWeight_6","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1750,"y":1800,"wires":[["95903119.f686a","cd2042dc.e1fa"]]},{"id":"cd2042dc.e1fa","type":"function","z":"48413719.e10dd8","name":"6","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_2');\nif(weight || weight === 0){\n    var sendStr = `<s1>  ${weight}`;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":2010,"y":1800,"wires":[["ce83e5bf.b00158"]]},{"id":"d3f8debf.136f7","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"3","crontab":"","once":false,"x":1690,"y":2020,"wires":[["b82f0612.1ce5e8"]]},{"id":"b82f0612.1ce5e8","type":"switch","z":"48413719.e10dd8","name":"","property":"trigerWeight_7","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1830,"y":2020,"wires":[["cc2e2950.275a18","d32de84d.bf3138"]]},{"id":"cc2e2950.275a18","type":"function","z":"48413719.e10dd8","name":"7","func":"// var weight = global.get('weight_1');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\n\nvar weight = global.get('weight_1');\nif(weight || weight === 0){\n    var sendStr = `<s1>  ${weight}`;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":2190,"y":2020,"wires":[["48926dd.696ab94","e68f188.fabb7e8","1211e374.2805bd"]]},{"id":"f51c612b.25653","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"3","crontab":"","once":false,"x":1590,"y":2260,"wires":[["e77fdf41.53b97"]]},{"id":"e77fdf41.53b97","type":"switch","z":"48413719.e10dd8","name":"","property":"trigerWeight_8","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1730,"y":2260,"wires":[["1095fdc7.a5db52","20de0866.5a9ff8"]]},{"id":"20de0866.5a9ff8","type":"function","z":"48413719.e10dd8","name":"8","func":"// var weight = global.get('weight_1');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_1');\nif(weight || weight === 0){\n    var sendStr = `<s1>  ${weight}`;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":2050,"y":2260,"wires":[["c7e88d7c.dee9a","25c6c5e5.0fe38a"]]},{"id":"14ea0894.cf2417","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"5","crontab":"","once":false,"x":1590,"y":2540,"wires":[["95dc13fa.4a31"]]},{"id":"95dc13fa.4a31","type":"switch","z":"48413719.e10dd8","name":"","property":"trigerWeight_9","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1750,"y":2540,"wires":[["11342d20.f3b9b3","5f8e37df.9b5448"]]},{"id":"11342d20.f3b9b3","type":"function","z":"48413719.e10dd8","name":"9","func":"var weight = global.get('weight_3');\nif(weight || weight === 0){\n    var sendStr = `<s1>  ${weight}`;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1990,"y":2540,"wires":[["d7dd6617.502088","bb551758.eaed98"]]},{"id":"8cecd724.2bc238","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"5","crontab":"","once":false,"x":1590,"y":2840,"wires":[["70c43fe0.e752c"]]},{"id":"70c43fe0.e752c","type":"switch","z":"48413719.e10dd8","name":"","property":"trigerWeight_10","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1750,"y":2840,"wires":[["12a47fde.072da","7345d179.af21e"]]},{"id":"12a47fde.072da","type":"function","z":"48413719.e10dd8","name":"10","func":"var weight = global.get('weight_3');\nif(weight || weight === 0){\n    var sendStr = `<s1>  ${weight}`;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1970,"y":2840,"wires":[["cf2350ce.1a682","2972d4c9.f59fbc"]]},{"id":"da6d2c19.75135","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":920,"y":1700,"wires":[]},{"id":"c2f0bb9e.a664f8","type":"link in","z":"48413719.e10dd8","name":"send weight info 2","links":["f4ae6ebe.b8985"],"x":1115,"y":1740,"wires":[["c81e8073.bc64"]]},{"id":"271b0fc.cfa49f","type":"link in","z":"48413719.e10dd8","name":"send weight info 1","links":["adc7a496.374418"],"x":1135,"y":2220,"wires":[["b2bc5d14.3586"]]},{"id":"f356e1c7.791ab","type":"link in","z":"48413719.e10dd8","name":"send weight info 3","links":["661faf2a.d1eae"],"x":1135,"y":2760,"wires":[["2a1d8ca2.54bbe4"]]},{"id":"c81e8073.bc64","type":"function","z":"48413719.e10dd8","name":"send weight 2","func":"flow.set('trigerWeight_5', true);\nflow.set('trigerWeight_6', true);\nreturn msg;","outputs":1,"noerr":0,"x":1240,"y":1740,"wires":[[]]},{"id":"b2bc5d14.3586","type":"function","z":"48413719.e10dd8","name":"send weight 1","func":"flow.set('trigerWeight_7', true);\nflow.set('trigerWeight_8', true);\nreturn msg;","outputs":1,"noerr":0,"x":1260,"y":2220,"wires":[[]]},{"id":"2a1d8ca2.54bbe4","type":"function","z":"48413719.e10dd8","name":"send weight 3","func":"flow.set('trigerWeight_9', true);\nflow.set('trigerWeight_10', true);\nreturn msg;","outputs":1,"noerr":0,"x":1260,"y":2760,"wires":[[]]},{"id":"adc7a496.374418","type":"link out","z":"f93250c7.39091","name":"","links":["271b0fc.cfa49f"],"x":955,"y":380,"wires":[]},{"id":"f4ae6ebe.b8985","type":"link out","z":"1124af78.b62db1","name":"","links":["c2f0bb9e.a664f8"],"x":1035,"y":520,"wires":[]},{"id":"661faf2a.d1eae","type":"link out","z":"2b507412.efc2cc","name":"","links":["f356e1c7.791ab"],"x":955,"y":500,"wires":[]},{"id":"e68f188.fabb7e8","type":"debug","z":"48413719.e10dd8","name":"weight 7","active":false,"console":"false","complete":"payload","x":2400,"y":2020,"wires":[]},{"id":"2972d4c9.f59fbc","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":2350,"y":2880,"wires":[]},{"id":"cae6448a.1a9dc8","type":"function","z":"48413719.e10dd8","name":"5","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_2');\nif(weight || weight === 0){\n    var sendStr = `<s2> `;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":2190,"y":1560,"wires":[["8c905c13.80283","8593939c.9f62d"]]},{"id":"f889c88a.8d63a8","type":"function","z":"48413719.e10dd8","name":"6","func":"// var weight = global.get('weight_2');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\n\nvar weight = global.get('weight_2');\nif(weight || weight === 0){\n    var sendStr = `<s2>`;\n    msg.payload = sendStr;\n    return msg;  \n}","outputs":1,"noerr":0,"x":2010,"y":1840,"wires":[["ce83e5bf.b00158"]]},{"id":"f8ceb653.eed6f8","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2050,"y":1560,"wires":[["cae6448a.1a9dc8"]]},{"id":"95903119.f686a","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1870,"y":1840,"wires":[["f889c88a.8d63a8"]]},{"id":"219102a1.64fbae","type":"function","z":"48413719.e10dd8","name":"7","func":"// var weight = global.get('weight_1');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\n\nvar weight = global.get('weight_1');\nif(weight || weight === 0){\n    var sendStr = `<s2> `;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":2190,"y":2060,"wires":[["48926dd.696ab94","e68f188.fabb7e8"]]},{"id":"d32de84d.bf3138","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2050,"y":2060,"wires":[["219102a1.64fbae"]]},{"id":"3a697ab7.9947a6","type":"function","z":"48413719.e10dd8","name":"8","func":"// var weight = global.get('weight_1');\n// var sendStr = `<s1>  ${weight}`;\n// msg.payload = sendStr;\n// return msg;\n\nvar weight = global.get('weight_1');\nif(weight || weight === 0){\n    var sendStr = `<s2> `;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":2050,"y":2300,"wires":[["c7e88d7c.dee9a","25c6c5e5.0fe38a"]]},{"id":"1095fdc7.a5db52","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1890,"y":2300,"wires":[["3a697ab7.9947a6"]]},{"id":"5f8e37df.9b5448","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1850,"y":2580,"wires":[["6c424538.9a572c"]]},{"id":"6c424538.9a572c","type":"function","z":"48413719.e10dd8","name":"9","func":"var weight = global.get('weight_3');\nif(weight || weight === 0){\n    var sendStr = `<s2> `;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1990,"y":2580,"wires":[["d7dd6617.502088","bb551758.eaed98"]]},{"id":"71a517c8.cc7568","type":"function","z":"48413719.e10dd8","name":"10","func":"var weight = global.get('weight_3');\nif(weight || weight === 0){\n    var sendStr = `<s2> `;\n    msg.payload = sendStr;\n    return msg;  \n}\n","outputs":1,"noerr":0,"x":1970,"y":2880,"wires":[["cf2350ce.1a682","2972d4c9.f59fbc"]]},{"id":"7345d179.af21e","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1830,"y":2880,"wires":[["71a517c8.cc7568"]]},{"id":"8593939c.9f62d","type":"debug","z":"48413719.e10dd8","name":"weight 5","active":false,"console":"false","complete":"payload","x":2400,"y":1520,"wires":[]},{"id":"25c6c5e5.0fe38a","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":2400,"y":2300,"wires":[]},{"id":"bb551758.eaed98","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":2350,"y":2540,"wires":[]},{"id":"1037e0f3.49367f","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":1170,"y":3240,"wires":[]},{"id":"ba1a881b.77fa88","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":1190,"y":3460,"wires":[]},{"id":"329ba532.3a961a","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":1190,"y":3700,"wires":[]},{"id":"942cd639.c751d8","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":1190,"y":3960,"wires":[]},{"id":"f3eea38b.06653","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":2010,"y":3140,"wires":[]},{"id":"41599b9b.4d3ec4","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":2010,"y":3340,"wires":[]},{"id":"39446118.acbc2e","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":2010,"y":3580,"wires":[]},{"id":"aa1365a4.7332e8","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":2030,"y":3840,"wires":[]},{"id":"45f6a754.b77148","type":"inject","z":"d7f6f063.4555c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":180,"y":660,"wires":[["bf1d9196.598e9"]]},{"id":"31e75ad3.e0f7f6","type":"debug","z":"d7f6f063.4555c","name":"","active":false,"console":"false","complete":"false","x":570,"y":660,"wires":[]},{"id":"bf1d9196.598e9","type":"function","z":"d7f6f063.4555c","name":"","func":"msg.payload = \"G02W\"  + String.fromCharCode(0x0d)  + String.fromCharCode(0x0a);\nreturn msg;\n//R02W234.580D0A","outputs":1,"noerr":0,"x":420,"y":660,"wires":[["31e75ad3.e0f7f6"]]},{"id":"be73f78e.e9eb38","type":"function","z":"d7f6f063.4555c","name":"toString","func":"msg.payload = msg.payload.toString();\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":280,"wires":[["d3cf3ab7.44bff8","8d869ed4.14594"]]},{"id":"ceed666a.63c968","type":"inject","z":"dbb5a15f.df08b","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":240,"wires":[["673833ae.5707bc"]]},{"id":"673833ae.5707bc","type":"exec","z":"dbb5a15f.df08b","command":"ls /distr","addpay":false,"append":"","useSpawn":"","timer":"","name":"","x":300,"y":240,"wires":[["dbd9cee4.3dc5d"],[],[]]},{"id":"dbd9cee4.3dc5d","type":"debug","z":"dbb5a15f.df08b","name":"","active":true,"console":"false","complete":"false","x":490,"y":220,"wires":[]},{"id":"c94f31b1.a6346","type":"comment","z":"dbb5a15f.df08b","name":"","info":"rm -rf core.2006 core.29023 core.29840","x":90,"y":180,"wires":[]},{"id":"8132487b.872718","type":"inject","z":"dbb5a15f.df08b","name":"","topic":"","payload":"","payloadType":"date","repeat":"3600","crontab":"","once":false,"x":130,"y":380,"wires":[["99f922da.ca3e9"]]},{"id":"99f922da.ca3e9","type":"exec","z":"dbb5a15f.df08b","command":"rm -rf /distr/core.*","addpay":false,"append":"","useSpawn":"","timer":"","name":"","x":370,"y":380,"wires":[["a45c8d79.8b7aa"],[],[]]},{"id":"a45c8d79.8b7aa","type":"debug","z":"dbb5a15f.df08b","name":"","active":true,"console":"false","complete":"false","x":630,"y":360,"wires":[]},{"id":"8d869ed4.14594","type":"debug","z":"d7f6f063.4555c","name":"","active":false,"console":"false","complete":"payload","x":610,"y":220,"wires":[]},{"id":"5129e493.e2032c","type":"debug","z":"d7f6f063.4555c","name":"","active":false,"console":"false","complete":"false","x":920,"y":200,"wires":[]},{"id":"a8368915.7afa68","type":"tcp request","z":"d7f6f063.4555c","server":"10.107.5.101","port":"1884","out":"sit","splitc":"0","name":"","x":320,"y":260,"wires":[["be73f78e.e9eb38","2174b150.4bfc9e"]]},{"id":"89631331.255b5","type":"function","z":"f93250c7.39091","name":"","func":"if(msg.stable === true){\n    msg.payload = 1;\n}else if(msg.stable === false){\n    msg.payload = 0;\n}else{\n    msg.payload = -1;\n}\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":760,"wires":[["6227dc78.c5a074"]]},{"id":"6227dc78.c5a074","type":"ui_chart","z":"f93250c7.39091","name":"","group":"810ad095.03ee3","order":1,"width":0,"height":0,"label":"Стабільність ліві","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-1","ymax":"2","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"x":490,"y":760,"wires":[[],[]]},{"id":"622e7e32.0bb76","type":"function","z":"1124af78.b62db1","name":"","func":"if(msg.stable === true){\n    msg.payload = 1;\n}else if(msg.stable === false){\n    msg.payload = 0;\n}else{\n    msg.payload = -1;\n}\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":780,"wires":[["3c83b1a5.9a8fbe"]]},{"id":"3c83b1a5.9a8fbe","type":"ui_chart","z":"1124af78.b62db1","name":"","group":"810ad095.03ee3","order":2,"width":0,"height":0,"label":"Стабільність праві","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-1","ymax":"2","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"x":490,"y":780,"wires":[[],[]]},{"id":"207daa16.a7a676","type":"function","z":"2b507412.efc2cc","name":"main module","func":"var prevWeight = flow.get('prevWeight');\nvar transaction = flow.get('transaction');\nvar transactionData = flow.get('transactionData');\nvar transactionMaxWeight = flow.get('transactionMaxWeight');\nvar transactionHasMaxWeight = flow.get('transactionHasMaxWeight');\nvar transactionHasMinWeight = flow.get('transactionHasMinWeight');\nvar transactionHasMaxDuration = flow.get('transactionHasMaxDuration');\nvar transactionOperationName = flow.get('transactionOperationName');\nvar stableDiff = flow.get('stableDiff');//дельта стабільності\nvar waybill = flow.get('transactionWaybill');\nvar weight = msg.payload;\nvar stableSize = 5;\nvar duration = 0;\nvar operation_name_income = \"Приход (авто)\";\nvar maxWeight = flow.get('maxWeight');\nvar maxDuration = flow.get('maxDuration');\nvar prevTransaction = transaction;\nvar minWeight = flow.get('minWeight');\nvar minTriggerWeight = flow.get('minTriggerWeight');\nvar is_minus = false;\nvar transactionAccWeight = flow.get('transactionAccWeight');//облікова вага\nvar overLoadWeight = flow.get('overLoadWeight');\n\n//transaction\nif (prevWeight === null){\n    prevWeight = msg.payload;    \n}else{\n    if((prevWeight <= 0) && (weight > 0) && (weight > minTriggerWeight)){\n        //start of transaction\n        transaction = Date.now();\n        msg.on = true;\n        flow.set('transaction',transaction);\n    }else if((prevWeight > 0) && (weight <=0) && (transaction)){\n        //transaction = 0;\n        msg.on = false;\n        transactionData = [];\n        flow.set('transaction',0);\n        flow.set('transactionMaxWeight',null);\n        flow.set('transactionHasMaxWeight',null);\n        flow.set('transactionHasMinWeight',null);\n        flow.set('transactionHasMaxDuration',null);\n        flow.set('transactionHasOverLoad',null);\n        flow.set('transactionOperationName',null);\n        flow.set('transactionWaybill',null);\n        flow.set('transactionMetadata',null);\n        flow.set('transactionAccWeight', null);//облікова вага\n    }else if((transaction === null) && (weight>0) && (weight > minTriggerWeight)){\n        transaction = Date.now();\n        flow.set('transaction',transaction);\n    }\n    if((prevWeight < 0) && ((weight-prevWeight) > minTriggerWeight)){\n        //start of transaction\n        is_minus = true;\n        msg.prevWeight = prevWeight;\n    }\n}\n\nmsg.stable = true;\n\nif (transaction > 0){\n    transactionData.push(weight);    \n\n    //stable\n    if(transactionData.length > stableSize+1){\n        var stabletmp = true;\n        for (var i = transactionData.length-1; i > transactionData.length-1-stableSize; i--){\n            if ((transactionData[i] - transactionData[i-1]) > stableDiff || (transactionData[i] - transactionData[i-1]) < -stableDiff){\n                stabletmp = false;\n                msg.stable = stabletmp;\n                break;\n            }\n            msg.stable = stabletmp;\n        }\n    }else{\n        msg.stable = false;\n    }\n\n    //duration & transactionMaxWeight\n    duration = (Number(Date.now()) - Number(transaction));\n    if( (weight>transactionMaxWeight) || (transactionMaxWeight === null)){\n        transactionMaxWeight = weight;\n        flow.set(\"transactionMaxWeight\",transactionMaxWeight);\n    }\n    \n    if(!transactionHasMaxWeight && weight > maxWeight){\n        msg.transactionHasMaxWeight = true;\n        flow.set('transactionHasMaxWeight',true);\n    }\n    \n    if(!transactionHasMinWeight && weight < minWeight){\n        msg.transactionHasMinWeight = true;\n        flow.set('transactionHasMinWeight',true);\n    }\n    \n    //max duartion\n    if(!transactionHasMaxDuration && duration > maxDuration){\n        msg.transactionHasMaxDuration = true;\n        flow.set('transactionHasMaxDuration',true);\n    }\n}\n\n\n//msg.stable = true;\n//result\nmsg.metadata = {\n    'weight':weight,\n    'prevWeight':prevWeight,\n    'prevTransaction':prevTransaction,\n    'transaction':transaction,\n    'on':msg.on,\n    'transactionDataCount':transactionData.length,\n    'stable':msg.stable,\n    'duration':Math.round(duration/1000),\n    'transactionMaxWeight':transactionMaxWeight,\n    'transactionAccWeight':transactionAccWeight,\n    'waybill':waybill,\n    'perimetr':true,\n    'weight1':msg.weight1,\n    'weight2':msg.weight2,\n    'weight_center':msg.weight_center,\n    'driverInCar':false,\n    'transactionOperationName':transactionOperationName\n}\nflow.set('transactionData',transactionData);\nflow.set('prevWeight',weight);\nflow.set('transactionMetadata',msg.metadata);\nflow.set('lasttimedata', new Date());\nmsg.is_minus = is_minus;\n\nif(transactionAccWeight && transactionOperationName!==operation_name_income){\n    \n   flow.set('transactionHasOverLoad',(weight-transactionAccWeight)>overLoadWeight);\n   \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":500,"wires":[[]]},{"id":"ba72f4e1.530968","type":"debug","z":"f93250c7.39091","name":"","active":false,"console":"false","complete":"false","x":940,"y":180,"wires":[]},{"id":"a3aaa6c1.2eb108","type":"debug","z":"2b507412.efc2cc","name":"","active":true,"console":"false","complete":"false","x":840,"y":160,"wires":[]},{"id":"540c0d91.0179f4","type":"inject","z":"1124af78.b62db1","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":960,"y":460,"wires":[["f4ae6ebe.b8985"]]},{"id":"8c0973c6.ca937","type":"inject","z":"d7f6f063.4555c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":100,"y":420,"wires":[["e1a241c4.d8ae3"]]},{"id":"e1a241c4.d8ae3","type":"function","z":"d7f6f063.4555c","name":"","func":"//‘S’ ‘0’ ‘2’ ‘R’ CR LF\n\nmsg.payload = \"S02R\"  + String.fromCharCode(0x0d)  + String.fromCharCode(0x0a);\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":420,"wires":[["a8368915.7afa68","31155f31.3e129"]]},{"id":"31155f31.3e129","type":"debug","z":"d7f6f063.4555c","name":"","active":true,"console":"false","complete":"payload","x":470,"y":420,"wires":[]},{"id":"2ac8a4ab.c216ac","type":"debug","z":"48413719.e10dd8","name":"info 7","active":false,"console":"false","complete":"payload","x":2370,"y":2200,"wires":[]},{"id":"7018b2a4.cb6d3c","type":"debug","z":"48413719.e10dd8","name":"in 7","active":false,"console":"false","complete":"payload","x":730,"y":2080,"wires":[]},{"id":"42ffdfa2.5f528","type":"comment","z":"48413719.e10dd8","name":"зїзд з ваг 2 rght","info":"","x":1180,"y":1700,"wires":[]},{"id":"534bca24.b498c4","type":"comment","z":"48413719.e10dd8","name":"зїзд з ваг 1 left","info":"","x":1180,"y":2180,"wires":[]},{"id":"8ce77643.238438","type":"comment","z":"48413719.e10dd8","name":"зїзд з ваг 3","info":"","x":1190,"y":2720,"wires":[]},{"id":"a359e29a.9561b","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":200,"y":500,"wires":[["bfa17daf.84396"]]},{"id":"bfa17daf.84396","type":"function","z":"48413719.e10dd8","name":"","func":"msg.payload = {\n    \"Строка1\": \"<s1> 1.Очікуємо:\",\n    \"Строка2\": \"<s2> \",\n    \"АдресУстройства\": \"1\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":540,"wires":[["ef2f4971.08d518"]]},{"id":"14ae62d1.760c4d","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":440,"y":700,"wires":[]},{"id":"70d06bb7.937534","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"weight_2","payloadType":"global","repeat":"","crontab":"","once":false,"x":1480,"y":1720,"wires":[["8b2e9d84.21c6"]]},{"id":"8b2e9d84.21c6","type":"debug","z":"48413719.e10dd8","name":"","active":true,"console":"false","complete":"false","x":1650,"y":1720,"wires":[]},{"id":"617bd2e0.82c7dc","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"weight_1","payloadType":"global","repeat":"","crontab":"","once":false,"x":1480,"y":1760,"wires":[["8b2e9d84.21c6"]]},{"id":"4dc3fa81.868c44","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1160,"y":1800,"wires":[["c81e8073.bc64"]]},{"id":"e43f0296.4e2f1","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1120,"y":2300,"wires":[["b2bc5d14.3586"]]},{"id":"20e3a7ae.5b3cf8","type":"debug","z":"f93250c7.39091","name":"","active":false,"console":"false","complete":"false","x":900,"y":2120,"wires":[]},{"id":"f0cea0ec.73fd9","type":"debug","z":"48413719.e10dd8","name":"in 5","active":false,"console":"false","complete":"payload","x":670,"y":1740,"wires":[]},{"id":"3259c204.6f26fe","type":"delay","z":"f93250c7.39091","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"4","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":660,"y":1420,"wires":[["bcb92471.b44658","87dd1e5b.57d11"]]},{"id":"8615b3a7.0e0b7","type":"ui_chart","z":"f93250c7.39091","name":"","group":"6d8579da.74a558","order":2,"width":0,"height":0,"label":"Заїзд / зїзд ліві","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"Заїзд / зїзд ліві","ymin":"-1","ymax":"2","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"x":770,"y":700,"wires":[[],[]]},{"id":"58febdbb.838aa4","type":"function","z":"f93250c7.39091","name":"","func":"if(msg.on === true){\n    msg.payload = 1;\n}else if(msg.on === false){\n    msg.payload = -1;\n}else{\n    msg.payload = 0;\n}\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":700,"wires":[["8615b3a7.0e0b7"]]},{"id":"44f1f220.69ef0c","type":"function","z":"1124af78.b62db1","name":"","func":"if(msg.on === true){\n    msg.payload = 1;\n}else if(msg.on === false){\n    msg.payload = -1;\n}else{\n    msg.payload = 0;\n}\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":740,"wires":[["c0c7618e.f4bc3"]]},{"id":"c0c7618e.f4bc3","type":"ui_chart","z":"1124af78.b62db1","name":"","group":"6d8579da.74a558","order":3,"width":0,"height":0,"label":"Заїзд/зїзд праві","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-1","ymax":"2","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"x":630,"y":740,"wires":[[],[]]},{"id":"ed9e6c46.31dcf","type":"ui_chart","z":"1124af78.b62db1","name":"","group":"6d8579da.74a558","order":3,"width":0,"height":0,"label":"Транзакція (праві)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"0","ymax":"10000000000","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"x":950,"y":1020,"wires":[[],[]]},{"id":"3c8b56f8.a18f2a","type":"function","z":"1124af78.b62db1","name":"","func":"msg.payload = msg.transaction;\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":1020,"wires":[["ed9e6c46.31dcf"]]},{"id":"1d1a0b2.0a5c3f5","type":"function","z":"f93250c7.39091","name":"","func":"msg.payload = msg.transaction;\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":740,"wires":[["76f22d78.019b64"]]},{"id":"76f22d78.019b64","type":"ui_chart","z":"f93250c7.39091","name":"Транзакція (ліві)","group":"6d8579da.74a558","order":2,"width":0,"height":0,"label":"Транзакція (ліві)","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"Транзакція (ліві)","ymin":"0","ymax":"10000000000","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"x":810,"y":740,"wires":[[],[]]},{"id":"5520ae29.c8d2f","type":"debug","z":"de930ae4.560b48","name":"","active":false,"console":"false","complete":"false","x":650.0177612304688,"y":370.0071105957031,"wires":[]},{"id":"4f88ea85.8b3fc4","type":"debug","z":"f93250c7.39091","name":"transaction","active":false,"console":"true","complete":"transaction","x":380,"y":440,"wires":[]},{"id":"f668d82e.bb3e68","type":"ui_text","z":"f93250c7.39091","group":"a5e83575.29de38","order":0,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload.truck_id}}","layout":"row-spread","x":890,"y":1540,"wires":[]},{"id":"d0c2cd9.1c0353","type":"ui_text","z":"f93250c7.39091","group":"a5e83575.29de38","order":0,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":890,"y":1580,"wires":[]},{"id":"b20348e6.b52b78","type":"function","z":"f93250c7.39091","name":"","func":"msg.payload = new Date();\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":1580,"wires":[["d0c2cd9.1c0353"]]},{"id":"6b07031b.07b87c","type":"ui_text","z":"1124af78.b62db1","group":"c3e11efc.bb5a3","order":0,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload.truck_id}}","layout":"row-spread","x":770,"y":1540,"wires":[]},{"id":"967496f2.6e29e8","type":"ui_text","z":"1124af78.b62db1","group":"c3e11efc.bb5a3","order":0,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":770,"y":1580,"wires":[]},{"id":"ea72742e.18cc38","type":"function","z":"1124af78.b62db1","name":"","func":"msg.payload = new Date();\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":1580,"wires":[["967496f2.6e29e8"]]},{"id":"83352a89.495548","type":"function","z":"f93250c7.39091","name":"","func":"delete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":1540,"wires":[["f668d82e.bb3e68"]]},{"id":"967e297a.941c38","type":"function","z":"1124af78.b62db1","name":"","func":"delete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":1540,"wires":[["6b07031b.07b87c"]]},{"id":"1e3b5db8.c6c392","type":"function","z":"f93250c7.39091","name":"","func":"var transactionMetadata = flow.get(\"transactionMetadata\");\nvar currentWeight = transactionMetadata.weight;\nmsg.payload = currentWeight;\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":1620,"wires":[["47cef2a.81a500c"]]},{"id":"47cef2a.81a500c","type":"ui_text","z":"f93250c7.39091","group":"a5e83575.29de38","order":0,"width":0,"height":0,"name":"","label":"weight","format":"{{msg.payload}}","layout":"row-spread","x":890,"y":1620,"wires":[]},{"id":"d1e01a0.01ef1e8","type":"function","z":"1124af78.b62db1","name":"","func":"var transactionMetadata = flow.get(\"transactionMetadata\");\nvar currentWeight = transactionMetadata.weight;\nmsg.payload = currentWeight;\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":1620,"wires":[["d26703c0.b603c"]]},{"id":"d26703c0.b603c","type":"ui_text","z":"1124af78.b62db1","group":"c3e11efc.bb5a3","order":0,"width":0,"height":0,"name":"","label":"weight","format":"{{msg.payload}}","layout":"row-spread","x":770,"y":1620,"wires":[]},{"id":"d0a24f01.4f0fd","type":"ui_chart","z":"f93250c7.39091","name":"","group":"4edd37d9.5690d8","order":0,"width":0,"height":0,"label":"Зважування ліві","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-1","ymax":"2","removeOlder":"5","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"x":1320,"y":1800,"wires":[[],[]]},{"id":"48c65041.7b44","type":"function","z":"f93250c7.39091","name":"","func":"msg.payload = 1;\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":1130,"y":1760,"wires":[["d0a24f01.4f0fd"]]},{"id":"fbe222.132b8de","type":"function","z":"f93250c7.39091","name":"","func":"msg.payload = -1;\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":1130,"y":1800,"wires":[["d0a24f01.4f0fd"]]},{"id":"11860301.55738d","type":"comment","z":"f93250c7.39091","name":"зважування","info":"","x":1310,"y":1740,"wires":[]},{"id":"fbe9df4c.eb55","type":"ui_chart","z":"1124af78.b62db1","name":"","group":"4edd37d9.5690d8","order":0,"width":0,"height":0,"label":"Зважування праві","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"-1","ymax":"2","removeOlder":"10","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"x":1330,"y":1640,"wires":[[],[]]},{"id":"9614dbbc.9603c8","type":"function","z":"1124af78.b62db1","name":"","func":"msg.payload = 1;\ndelete msg.req;\ndelete msg.res;\nreturn msg;","outputs":1,"noerr":0,"x":1140,"y":1600,"wires":[["fbe9df4c.eb55"]]},{"id":"2898708b.a1ecd","type":"function","z":"1124af78.b62db1","name":"","func":"msg.payload = -1;\n\nreturn msg;","outputs":1,"noerr":0,"x":1140,"y":1640,"wires":[["fbe9df4c.eb55"]]},{"id":"a7152a33.8ca768","type":"comment","z":"1124af78.b62db1","name":"зважування","info":"","x":1320,"y":1580,"wires":[]},{"id":"f6aaf236.db1eb","type":"file","z":"1124af78.b62db1","name":"","filename":"/distr/data/monitoring.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1280,"y":1140,"wires":[]},{"id":"92271c37.6ba15","type":"function","z":"1124af78.b62db1","name":"","func":"msg.payload = {\n    weight:msg.metadata.weight,\n    transaction : msg.transaction,\n    date: new Date()\n}\nreturn msg;","outputs":1,"noerr":0,"x":1040,"y":1140,"wires":[["f6aaf236.db1eb","66179e88.0f549"]]},{"id":"66179e88.0f549","type":"debug","z":"1124af78.b62db1","name":"","active":false,"console":"false","complete":"false","x":1230,"y":1100,"wires":[]},{"id":"74772077.0918e","type":"file in","z":"1124af78.b62db1","name":"","filename":"/distr/data/monitoring.txt","format":"utf8","x":590,"y":2200,"wires":[["a655ed5a.804ea"]]},{"id":"7f319adb.232864","type":"http in","z":"1124af78.b62db1","name":"","url":"/monitoring","method":"get","swaggerDoc":"","x":290,"y":2200,"wires":[["74772077.0918e"]]},{"id":"a655ed5a.804ea","type":"http response","z":"1124af78.b62db1","name":"","x":830,"y":2200,"wires":[]},{"id":"f25e90ce.b879","type":"file","z":"f93250c7.39091","name":"","filename":"/distr/data/monitoring_left.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1180,"y":1040,"wires":[]},{"id":"7ff380b1.583f9","type":"function","z":"f93250c7.39091","name":"","func":"msg.payload = {\n    weight:msg.metadata.weight,\n    transaction : msg.transaction,\n    date: new Date()\n}\nreturn msg;","outputs":1,"noerr":0,"x":930,"y":1040,"wires":[["f25e90ce.b879","1bf3792d.a06bb7"]]},{"id":"1bf3792d.a06bb7","type":"debug","z":"f93250c7.39091","name":"","active":false,"console":"false","complete":"false","x":1120,"y":1000,"wires":[]},{"id":"7a78aa77.256314","type":"inject","z":"f93250c7.39091","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":960,"y":440,"wires":[["adc7a496.374418"]]},{"id":"e5a39d90.5f5bf","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"trigerWeight_7","payloadType":"flow","repeat":"","crontab":"","once":false,"x":2350,"y":1800,"wires":[["3107103e.e2207"]]},{"id":"4ead4b51.a53394","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"trigerWeight_5","payloadType":"flow","repeat":"","crontab":"","once":false,"x":2350,"y":1760,"wires":[["3107103e.e2207"]]},{"id":"3107103e.e2207","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"false","x":2550,"y":1780,"wires":[]},{"id":"bec97204.66147","type":"debug","z":"2b507412.efc2cc","name":"","active":false,"console":"false","complete":"true","x":460,"y":900,"wires":[]},{"id":"cc149d5.4ce3b6","type":"function","z":"1124af78.b62db1","name":"get 1c","func":"msg.payload = {\n    reader:msg.payload.reader,\n    truck_id : msg.payload.truck_id,\n    date: new Date()\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1030,"y":1200,"wires":[["f6aaf236.db1eb"]]},{"id":"9692a8cf.8ed238","type":"function","z":"1124af78.b62db1","name":"","func":"msg.payload = {\n    send1c:'send 1c',\n    date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1030,"y":1300,"wires":[["f6aaf236.db1eb"]]},{"id":"f62eb3fe.3f8bc","type":"inject","z":"1124af78.b62db1","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":240,"y":2580,"wires":[["d623e9e9.900108"]]},{"id":"d623e9e9.900108","type":"file","z":"1124af78.b62db1","name":"","filename":"/distr/data/monitoring.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":620,"y":2580,"wires":[]},{"id":"d8be6f28.936b2","type":"debug","z":"40a858ce.eb2118","name":"","active":false,"console":"false","complete":"false","x":400,"y":680,"wires":[]},{"id":"c3025f16.656e4","type":"debug","z":"cbb45903.f34358","name":"","active":false,"console":"false","complete":"false","x":490,"y":680,"wires":[]},{"id":"ca6d9134.09692","type":"debug","z":"40a858ce.eb2118","name":"stable","active":false,"console":"false","complete":"stable","x":170,"y":460,"wires":[]},{"id":"cb03dc2c.7883a","type":"inject","z":"d6bade09.4de0d","name":"","topic":"","payload":"weight","payloadType":"flow","repeat":"","crontab":"","once":false,"x":260,"y":300,"wires":[["8fd710c8.7fd29"]]},{"id":"8fd710c8.7fd29","type":"debug","z":"d6bade09.4de0d","name":"","active":false,"console":"false","complete":"false","x":450,"y":300,"wires":[]},{"id":"b7515c74.81015","type":"debug","z":"71f38711.545228","name":"","active":false,"console":"false","complete":"true","x":570,"y":260,"wires":[]},{"id":"b73842a.9f150c","type":"debug","z":"d6bade09.4de0d","name":"","active":false,"console":"false","complete":"true","x":430,"y":240,"wires":[]},{"id":"291e013a.8ddcee","type":"comment","z":"48413719.e10dd8","name":"Info","info":"5 і 6 праві ліві ваги\n7 і 8 ліві ваги","x":890,"y":1460,"wires":[]},{"id":"e199eebd.b1fe","type":"function","z":"48413719.e10dd8","name":"log to file","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nmsg.payload = {\n   id:id,\n   string_1:string_1,\n   string_2:string_2,\n   date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1220,"y":1340,"wires":[["8007e216.b930d"]]},{"id":"8007e216.b930d","type":"file","z":"48413719.e10dd8","name":"","filename":"/distr/data/log_board_brutto_right.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1450,"y":1340,"wires":[]},{"id":"87dd1e5b.57d11","type":"function","z":"f93250c7.39091","name":"GET 1C","func":"var reader = msg.payload.reader;\nvar truck_id = msg.payload.truck_id;\n\nmsg.payload = {\n    name:\"GET 1C\",\n    truck_id: truck_id,\n    reader:  reader,\n    date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1240,"y":1560,"wires":[["3a035990.f16596"]]},{"id":"3a035990.f16596","type":"file","z":"f93250c7.39091","name":"","filename":"/distr/data/log_left_1c.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":1490,"y":1560,"wires":[]},{"id":"53e4b8bd.741ce8","type":"function","z":"f93250c7.39091","name":"Send 1C","func":"var transactionMetadata = flow.get('transactionMetadata');\n\nvar truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name:\"SEND 1C\",\n    tM:transactionMetadata.weight,\n    truck_id: truck_id,\n    reader:  reader,\n    date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1240,"y":1600,"wires":[["3a035990.f16596"]]},{"id":"5793a262.8bd36c","type":"function","z":"f93250c7.39091","name":"RES 1C","func":"var res = msg.payload;\nmsg.payload = {\n    name:\"RES 1C\",\n    status:msg.statusCode,\n    res:res,\n    date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1240,"y":1640,"wires":[["3a035990.f16596"]]},{"id":"ec384cb9.8e217","type":"inject","z":"f93250c7.39091","name":"","topic":"","payload":"transactionMetadata","payloadType":"flow","repeat":"","crontab":"","once":false,"x":150,"y":2040,"wires":[["56ffe714.031ab8"]]},{"id":"56ffe714.031ab8","type":"debug","z":"f93250c7.39091","name":"","active":true,"console":"false","complete":"false","x":320,"y":2080,"wires":[]},{"id":"9418b991.1b2a18","type":"function","z":"1124af78.b62db1","name":"GET 1C","func":"var reader = msg.payload.reader;\nvar truck_id = msg.payload.truck_id;\n\nmsg.payload = {\n    name:\"GET 1C\",\n    truck_id: truck_id,\n    reader:  reader,\n    date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1500,"y":1600,"wires":[["6839370a.6f2388"]]},{"id":"6839370a.6f2388","type":"file","z":"1124af78.b62db1","name":"","filename":"/distr/data/log_right_1c.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":1750,"y":1600,"wires":[]},{"id":"3106fd9b.1d1312","type":"function","z":"1124af78.b62db1","name":"Send 1C","func":"var transactionMetadata = flow.get('transactionMetadata');\n\nvar truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name:\"SEND 1C\",\n    tM:transactionMetadata.weight,\n    truck_id: truck_id,\n    reader:  reader,\n    date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1500,"y":1660,"wires":[["6839370a.6f2388"]]},{"id":"32bddad7.d1bbc6","type":"function","z":"1124af78.b62db1","name":"RES 1C","func":"var res = msg.payload;\nmsg.payload = {\n    name:\"RES 1C\",\n    status:msg.statusCode,\n    res:res,\n    date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1500,"y":1760,"wires":[["6839370a.6f2388"]]},{"id":"58c3824e.4c508c","type":"file","z":"f93250c7.39091","name":"","filename":"/distr/data/log_left_1c.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":1670,"y":440,"wires":[]},{"id":"d0e25273.2a365","type":"comment","z":"f93250c7.39091","name":"LOG зїзду","info":"","x":1460,"y":400,"wires":[]},{"id":"de1ab173.ab81c","type":"function","z":"1124af78.b62db1","name":"M_OUT_SEND 1C","func":"var truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name:\"M_OUT_SEND 1C\",\n    truck_id: truck_id,\n    reader:  reader,\n    date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1510,"y":440,"wires":[["e0fedc33.1cfe"]]},{"id":"e0fedc33.1cfe","type":"file","z":"1124af78.b62db1","name":"","filename":"/distr/data/log_right_1c.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":1750,"y":440,"wires":[]},{"id":"b1649b1f.506d88","type":"comment","z":"1124af78.b62db1","name":"LOG зїзду","info":"","x":1480,"y":400,"wires":[]},{"id":"4de97d28.b7e8c4","type":"function","z":"1124af78.b62db1","name":"M_OUT_RES 1C","func":"var truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name:\"M_OUT_RES 1C\",\n    status:msg.statusCode,\n    date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1510,"y":480,"wires":[["e0fedc33.1cfe"]]},{"id":"9d57e126.aa706","type":"function","z":"f93250c7.39091","name":"M_OUT_SEND 1C","func":"var truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name:\"M_OUT_SEND 1C\",\n    truck_id: truck_id,\n    reader:  reader,\n    date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1450,"y":440,"wires":[["58c3824e.4c508c"]]},{"id":"912fd53c.0f1cd8","type":"function","z":"f93250c7.39091","name":"M_OUT_RES 1C","func":"var truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name:\"M_OUT_RES 1C\",\n    status:msg.statusCode,\n    date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1450,"y":480,"wires":[["58c3824e.4c508c"]]},{"id":"c44c6d3b.816eb","type":"debug","z":"71f38711.545228","name":"","active":false,"console":"false","complete":"false","x":310,"y":120,"wires":[]},{"id":"d52eb8d7.ca0318","type":"debug","z":"962df517.4837f8","name":"","active":false,"console":"false","complete":"false","x":1090,"y":60,"wires":[]},{"id":"feec4a11.026258","type":"file","z":"f93250c7.39091","name":"","filename":"/distr/weight_log/log_left_weight.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":380,"y":360,"wires":[]},{"id":"eb4ecd2a.5eccb","type":"function","z":"f93250c7.39091","name":"","func":"var weight = msg.payload;\n\nmsg.payload = {\n    weight: weight,\n    date: new Date(),\n    connect: msg.connect\n};\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":360,"wires":[["feec4a11.026258"]]},{"id":"bec1cf5c.6d566","type":"function","z":"1124af78.b62db1","name":"","func":"var weight = msg.payload;\n\nmsg.payload = {\n    weight: weight,\n    date: new Date(),\n    connect: msg.connect\n};\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":400,"wires":[["7f21a704.9625a8"]]},{"id":"7f21a704.9625a8","type":"file","z":"1124af78.b62db1","name":"","filename":"/distr/weight_log/log_right_weight.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":390,"y":400,"wires":[]},{"id":"be29ba6a.5c29e8","type":"function","z":"48413719.e10dd8","name":"log to file","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nmsg.payload = {\n   id:id,\n   string_1:string_1,\n   string_2:string_2,\n   date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1220,"y":1400,"wires":[["176244eb.70650b"]]},{"id":"176244eb.70650b","type":"file","z":"48413719.e10dd8","name":"","filename":"/distr/data/log_board_tara_left.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1440,"y":1400,"wires":[]},{"id":"3dc4c224.68b6be","type":"comment","z":"48413719.e10dd8","name":"Logs boards","info":"","x":1210,"y":1180,"wires":[]},{"id":"ca8087d7.44ecc8","type":"function","z":"de930ae4.560b48","name":"time_rasp","func":"var time = new Date();\nflow.set(\"time_rasp\", time);\n\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":500,"wires":[["cbbe119f.0b04a"]]},{"id":"ce55f548.515ba8","type":"inject","z":"de930ae4.560b48","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":150,"y":500,"wires":[["ca8087d7.44ecc8"]]},{"id":"cbbe119f.0b04a","type":"function","z":"de930ae4.560b48","name":"sub time","func":"var weigth_time = flow.get(\"weigth_time\");\nvar time_rasp = flow.get(\"time_rasp\");\n\nvar sub = time_rasp - weigth_time;\n//msg.payload = {\n//    sub: time_rasp - weigth_time,\n//    weigth_time: weigth_time,\n//    time_rasp: time_rasp\n//}\n\n    if(sub > 40000){\n    msg.payload = 0;\n    msg.connect = \"not\";\n    return msg;\n    }\n","outputs":1,"noerr":0,"x":440,"y":500,"wires":[["e85099db.8eaef8","b367e701.d54aa8"]]},{"id":"e85099db.8eaef8","type":"debug","z":"de930ae4.560b48","name":"","active":true,"console":"false","complete":"false","x":610,"y":500,"wires":[]},{"id":"2c1a7620.bdc4aa","type":"function","z":"de930ae4.560b48","name":"weigth_time","func":"flow.set('weigth_time',new Date());\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":460,"wires":[[]]},{"id":"6587a4f6.24b27c","type":"function","z":"d7f6f063.4555c","name":"time_rasp","func":"var time = new Date();\nflow.set(\"time_rasp\", time);\n\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":520,"wires":[["a58d6bcf.628ee8"]]},{"id":"278ee01f.91de6","type":"inject","z":"d7f6f063.4555c","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":110,"y":520,"wires":[["6587a4f6.24b27c"]]},{"id":"a58d6bcf.628ee8","type":"function","z":"d7f6f063.4555c","name":"sub time","func":"var weigth_time = flow.get(\"weigth_time\");\nvar time_rasp = flow.get(\"time_rasp\");\n\nvar sub = time_rasp - weigth_time;\n//msg.payload = {\n//    sub: time_rasp - weigth_time,\n//    weigth_time: weigth_time,\n//    time_rasp: time_rasp\n//}\n\n    if(sub > 40000){\n    msg.payload = 0;\n    msg.connect = \"not\";\n    return msg;\n    }\n","outputs":1,"noerr":0,"x":400,"y":520,"wires":[["234f2143.76884e","9a16aa02.d5fb88"]]},{"id":"234f2143.76884e","type":"debug","z":"d7f6f063.4555c","name":"","active":true,"console":"false","complete":"false","x":570,"y":520,"wires":[]},{"id":"2174b150.4bfc9e","type":"function","z":"d7f6f063.4555c","name":"weigth_time","func":"flow.set('weigth_time',new Date());\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":480,"wires":[[]]},{"id":"c10866be.92f638","type":"function","z":"bd4c94f4.ece8e8","name":"time_rasp","func":"var time = new Date();\nflow.set(\"time_rasp\", time);\n\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":600,"wires":[["cd065f2e.c7e2a"]]},{"id":"9b446016.f2174","type":"inject","z":"bd4c94f4.ece8e8","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":110,"y":600,"wires":[["c10866be.92f638"]]},{"id":"cd065f2e.c7e2a","type":"function","z":"bd4c94f4.ece8e8","name":"sub time","func":"var weigth_time = flow.get(\"weigth_time\");\nvar time_rasp = flow.get(\"time_rasp\");\n\nvar sub = time_rasp - weigth_time;\n//msg.payload = {\n//    sub: time_rasp - weigth_time,\n//    weigth_time: weigth_time,\n//    time_rasp: time_rasp\n//}\n\n    if(sub > 40000){\n    msg.payload = 0;\n    msg.connect = \"not\";\n    return msg;\n    }\n","outputs":1,"noerr":0,"x":400,"y":600,"wires":[["52ef4c0a.07c0f4","9b7d63c1.ba68f"]]},{"id":"52ef4c0a.07c0f4","type":"debug","z":"bd4c94f4.ece8e8","name":"","active":false,"console":"false","complete":"false","x":570,"y":600,"wires":[]},{"id":"952f2815.f7ba78","type":"function","z":"bd4c94f4.ece8e8","name":"weigth_time","func":"flow.set('weigth_time',new Date());\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":560,"wires":[[]]},{"id":"537c154d.49597c","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":380,"y":60,"wires":[[]]},{"id":"4014b89.4727f48","type":"file","z":"962df517.4837f8","name":"","filename":"/distr/data/chanell.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1500,"y":400,"wires":[]},{"id":"c751eb5e.8e7a58","type":"comment","z":"40a858ce.eb2118","name":"Зробити фото","info":"","x":1080,"y":400,"wires":[]},{"id":"48a42c07.0bf8d4","type":"http request","z":"40a858ce.eb2118","name":"get id sesion","method":"GET","ret":"obj","url":"https://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir","tls":"d049c21b.cdc58","x":1430,"y":440,"wires":[[]]},{"id":"587c81af.b985b","type":"function","z":"40a858ce.eb2118","name":"sid","func":"//let sid = msg.payload.sid;\nlet sid =global.get('sid');\nmsg.sid = sid;\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":480,"wires":[["aec622da.c6037","65cd3b89.94d784","8a6f1e83.3e557"]]},{"id":"918fc18c.84d75","type":"function","z":"40a858ce.eb2118","name":"screenshot","func":"let guidChannel = \"lNHlkOHv\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":1910,"y":480,"wires":[["ef7f9b1f.27d268"]]},{"id":"ef7f9b1f.27d268","type":"http request","z":"40a858ce.eb2118","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2110,"y":480,"wires":[["5766438a.9e6c3c"]]},{"id":"7ce37804.a95828","type":"switch","z":"40a858ce.eb2118","name":"take snapshot","property":"snapshot","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1080,"y":440,"wires":[["5e0aff63.f3503"]]},{"id":"5766438a.9e6c3c","type":"function","z":"40a858ce.eb2118","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_1');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":480,"wires":[["264fc41c.6f84bc"]]},{"id":"264fc41c.6f84bc","type":"http request","z":"40a858ce.eb2118","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2500,"y":480,"wires":[[]]},{"id":"d3d80746.0f9888","type":"function","z":"40a858ce.eb2118","name":"screenshot","func":"let guidChannel = \"M3lHmE45\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":1910,"y":520,"wires":[["302b12ea.03b9ee"]]},{"id":"7f0ac315.bbea9c","type":"function","z":"40a858ce.eb2118","name":"screenshot","func":"let guidChannel = \"DDO0K3x4\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":1910,"y":560,"wires":[["206318ef.932678"]]},{"id":"3bb8012f.996e0e","type":"function","z":"40a858ce.eb2118","name":"delete","func":"\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":480,"wires":[["587c81af.b985b"]]},{"id":"302b12ea.03b9ee","type":"http request","z":"40a858ce.eb2118","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2110,"y":520,"wires":[["ae31d54b.9754b8"]]},{"id":"ae31d54b.9754b8","type":"function","z":"40a858ce.eb2118","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_1');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":520,"wires":[["f90b22ce.2a497"]]},{"id":"f90b22ce.2a497","type":"http request","z":"40a858ce.eb2118","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2500,"y":520,"wires":[[]]},{"id":"206318ef.932678","type":"http request","z":"40a858ce.eb2118","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2110,"y":560,"wires":[["cc8a3c2b.f84b2"]]},{"id":"cc8a3c2b.f84b2","type":"function","z":"40a858ce.eb2118","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_1');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":560,"wires":[["f761bc8.2f1c64"]]},{"id":"f761bc8.2f1c64","type":"http request","z":"40a858ce.eb2118","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2500,"y":560,"wires":[[]]},{"id":"aec622da.c6037","type":"delay","z":"40a858ce.eb2118","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1720,"y":480,"wires":[["918fc18c.84d75"]]},{"id":"65cd3b89.94d784","type":"delay","z":"40a858ce.eb2118","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1720,"y":520,"wires":[["d3d80746.0f9888"]]},{"id":"8a6f1e83.3e557","type":"delay","z":"40a858ce.eb2118","name":"","pauseType":"delay","timeout":"7","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1720,"y":560,"wires":[["7f0ac315.bbea9c"]]},{"id":"5e0aff63.f3503","type":"delay","z":"40a858ce.eb2118","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1080,"y":480,"wires":[["3bb8012f.996e0e"]]},{"id":"fecfc772.58d9e8","type":"http request","z":"cbb45903.f34358","name":"get id sesion","method":"GET","ret":"obj","url":"https://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir","tls":"d049c21b.cdc58","x":1590,"y":460,"wires":[[]]},{"id":"e685249d.a4eb78","type":"function","z":"cbb45903.f34358","name":"sid","func":"let sid = global.get('sid');\nmsg.sid = sid;\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1730,"y":520,"wires":[["8d2189b2.b3f028","3c791dd9.113912","eb1133aa.5c6b","494d2ceb.6d06b4"]]},{"id":"8c17db29.2e51d8","type":"function","z":"cbb45903.f34358","name":"screenshot","func":"let guidChannel = \"G52s7jnk\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":2070,"y":520,"wires":[["1aab4ae1.585525"]]},{"id":"1aab4ae1.585525","type":"http request","z":"cbb45903.f34358","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2270,"y":520,"wires":[["10726a14.d4abc6"]]},{"id":"32ba32c.2bc7cce","type":"switch","z":"cbb45903.f34358","name":"take snapshot","property":"snapshot","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":1240,"y":480,"wires":[["d62fbb5.0819948"]]},{"id":"10726a14.d4abc6","type":"function","z":"cbb45903.f34358","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_2');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2450,"y":520,"wires":[["ad0b9f7c.f7b43"]]},{"id":"ad0b9f7c.f7b43","type":"http request","z":"cbb45903.f34358","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2660,"y":520,"wires":[[]]},{"id":"d64676d6.a973d8","type":"function","z":"cbb45903.f34358","name":"screenshot","func":"let guidChannel = \"HO4NPFhG\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":2070,"y":560,"wires":[["221de827.da5828"]]},{"id":"5ff7964a.148d48","type":"function","z":"cbb45903.f34358","name":"screenshot","func":"let guidChannel = \"Z78Xokxc\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":2070,"y":600,"wires":[["5175cecf.32dbc"]]},{"id":"6e945dce.dd5ed4","type":"function","z":"cbb45903.f34358","name":"delete","func":"\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1450,"y":520,"wires":[["e685249d.a4eb78"]]},{"id":"221de827.da5828","type":"http request","z":"cbb45903.f34358","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2270,"y":560,"wires":[["c94f050b.c3de48"]]},{"id":"c94f050b.c3de48","type":"function","z":"cbb45903.f34358","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_2');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2450,"y":560,"wires":[["ff78f828.554838"]]},{"id":"ff78f828.554838","type":"http request","z":"cbb45903.f34358","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2660,"y":560,"wires":[[]]},{"id":"5175cecf.32dbc","type":"http request","z":"cbb45903.f34358","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2270,"y":600,"wires":[["14fded76.cc1b13"]]},{"id":"14fded76.cc1b13","type":"function","z":"cbb45903.f34358","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_2');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2450,"y":600,"wires":[["40fcc60b.a89218"]]},{"id":"40fcc60b.a89218","type":"http request","z":"cbb45903.f34358","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2660,"y":600,"wires":[[]]},{"id":"8d2189b2.b3f028","type":"delay","z":"cbb45903.f34358","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1880,"y":520,"wires":[["8c17db29.2e51d8"]]},{"id":"3c791dd9.113912","type":"delay","z":"cbb45903.f34358","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1880,"y":560,"wires":[["d64676d6.a973d8"]]},{"id":"eb1133aa.5c6b","type":"delay","z":"cbb45903.f34358","name":"","pauseType":"delay","timeout":"7","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1880,"y":600,"wires":[["5ff7964a.148d48"]]},{"id":"d62fbb5.0819948","type":"delay","z":"cbb45903.f34358","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1240,"y":520,"wires":[["6e945dce.dd5ed4"]]},{"id":"7cb16d36.08fab4","type":"comment","z":"cbb45903.f34358","name":"Зробити фото","info":"","x":1240,"y":440,"wires":[]},{"id":"6159f6a4.f3ead8","type":"function","z":"cbb45903.f34358","name":"screenshot","func":"let guidChannel = \"B7KQRyWz\";// guid channal\n\nlet url = `https://10.107.9.100:8080/screenshot/${guidChannel}?sid=`;\nlet sid = msg.sid;\n\nmsg.url = url + sid;\ndelete msg.payload;\ndelete msg.statusCode;\ndelete msg.headers;\ndelete msg.sid;\n\n\nmsg.res = flow.get('res');\nmsg.req = flow.get('req');\nreturn msg;\n/*\nlet guidChannel = \"ezoJU3It\";   //TruckScales-R2A08-V6\nlet guidChannel = \"vav9ADtx\"; //TruckScales-R2A07-V5\nlet guidChannel = \"DYL0mD4k\"; //TruckScales-R2A09-V7\n\n\nlet guidChannel = \"oVG1YLM8\"; //TruckScales-R2A05-V3\nlet guidChannel = \"u7c7YCVj\"; //TruckScales-R2A04-V2\n//let guidChannel = \"R2e0sWLr\"; //TruckScales-R2A03-V1\n*/","outputs":1,"noerr":0,"x":2070,"y":640,"wires":[["20c66eca.861aa2"]]},{"id":"20c66eca.861aa2","type":"http request","z":"cbb45903.f34358","name":"","method":"GET","ret":"bin","url":"","tls":"d049c21b.cdc58","x":2270,"y":640,"wires":[["c9fecd10.f8eca"]]},{"id":"c9fecd10.f8eca","type":"function","z":"cbb45903.f34358","name":"snapshot payload","func":"var event_id = msg.event_id;\nvar scale_id = global.get('scale_id_jd_2');\nvar tbase64   = msg.payload.toString('base64');\nmsg.payload = {\n    'event':{\n        'id':msg.event_id\n    },\n    'device':{\n        'id':scale_id\n        \n    },\n    'snapshot':tbase64,\n    'ext':'jpeg'\n}\n\nmsg.headers = {\n    \"content-type\":\"application/json\"\n}\n\nmsg.url = flow.get('main_host')+flow.get('snapshot_url');\nmsg.main_host = flow.get('main_host');\nmsg.snapshot_url = flow.get('snapshot_url');\n\nreturn msg;","outputs":1,"noerr":0,"x":2450,"y":640,"wires":[["f5e8d639.aa19b8"]]},{"id":"f5e8d639.aa19b8","type":"http request","z":"cbb45903.f34358","name":"send a snapshot","method":"POST","ret":"txt","url":"","tls":"95695c19.1ce96","x":2660,"y":640,"wires":[[]]},{"id":"494d2ceb.6d06b4","type":"delay","z":"cbb45903.f34358","name":"","pauseType":"delay","timeout":"9","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1880,"y":640,"wires":[["6159f6a4.f3ead8"]]},{"id":"22430c5c.b265b4","type":"inject","z":"bd4c94f4.ece8e8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":110,"y":560,"wires":[["952f2815.f7ba78"]]},{"id":"8b96aa18.9a4488","type":"debug","z":"2b507412.efc2cc","name":"","active":false,"console":"false","complete":"false","x":1460,"y":520,"wires":[]},{"id":"bc0fd4c9.c22268","type":"debug","z":"2b507412.efc2cc","name":"","active":true,"console":"false","complete":"false","x":2610,"y":740,"wires":[]},{"id":"b3d6774.9e88188","type":"inject","z":"87b488d6.5b73f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":260,"y":1400,"wires":[["9d466260.b471b"]]},{"id":"25f84909.a4d8e6","type":"debug","z":"962df517.4837f8","name":"","active":false,"console":"false","complete":"false","x":430,"y":560,"wires":[]},{"id":"6e90b4a7.3c343c","type":"debug","z":"962df517.4837f8","name":"","active":false,"console":"false","complete":"false","x":750,"y":560,"wires":[]},{"id":"bb878efb.9e68","type":"debug","z":"962df517.4837f8","name":"","active":false,"console":"false","complete":"false","x":930,"y":640,"wires":[]},{"id":"ba5ee7ca.b22468","type":"debug","z":"962df517.4837f8","name":"","active":false,"console":"false","complete":"false","x":1190,"y":560,"wires":[]},{"id":"6dbbb3e.de4754c","type":"file","z":"962df517.4837f8","name":"","filename":"/distr/data/origin_chanell.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1520,"y":440,"wires":[]},{"id":"51ff3f60.fe0bd","type":"function","z":"962df517.4837f8","name":"","func":"msg.payload = {\n    date: new Date(),\n    string:msg.payload\n};\nreturn msg;\n","outputs":1,"noerr":0,"x":1290,"y":440,"wires":[["6dbbb3e.de4754c"]]},{"id":"ee48b9df.02ff88","type":"function","z":"962df517.4837f8","name":"","func":"msg.payload = {\n    date: new Date(),\n    string:msg.payload\n};\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":400,"wires":[["4014b89.4727f48"]]},{"id":"5d3dd923.39b368","type":"file","z":"962df517.4837f8","name":"","filename":"/distr/data/origin_chanell_json.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1540,"y":480,"wires":[]},{"id":"a9bab078.fe8ea","type":"function","z":"962df517.4837f8","name":"","func":"msg.payload = {\n    date: new Date(),\n    string:msg.payload\n};\nreturn msg;\n","outputs":1,"noerr":0,"x":1290,"y":480,"wires":[["5d3dd923.39b368"]]},{"id":"c2ad1c1f.56a4d","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":130,"y":2240,"wires":[["447ab1b5.221a5"]]},{"id":"4c7c0772.b79538","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"obj","url":"https://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir","tls":"d049c21b.cdc58","x":470,"y":2240,"wires":[["bd9f90b.057037","dc112537.8de008"]]},{"id":"bd9f90b.057037","type":"function","z":"962df517.4837f8","name":"sid","func":"let sid = msg.payload.sid;\nflow.set('sid', sid);\nflow.set('date_Sid', new Date());\nglobal.set('sid', sid);\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":2240,"wires":[[]]},{"id":"dc112537.8de008","type":"debug","z":"962df517.4837f8","name":"","active":true,"console":"false","complete":"false","x":690,"y":2160,"wires":[]},{"id":"714dc5b8.88b33c","type":"comment","z":"962df517.4837f8","name":"Получение sid","info":"Трассир SDK.\nАдрес сервера 10.107.9.200    SDK port 8080\nПользователь SDK:\nLogin:  Admin\nPass:  Admin@RHN_Trassir\n\nhttps://10.107.9.100:8080/login?username=Admin&password=Admin@RHN_Trassir\n\n\n\n\n","x":120,"y":2180,"wires":[]},{"id":"dde23fe3.c728c","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":130,"y":2400,"wires":[["bbd61aea.512bd8"]]},{"id":"bbd61aea.512bd8","type":"function","z":"962df517.4837f8","name":"date_now","func":"flow.set('date_now', new Date());\n\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":2400,"wires":[[]]},{"id":"447ab1b5.221a5","type":"function","z":"962df517.4837f8","name":"","func":"var sid_date = flow.get('date_Sid');\nvar date_Now = flow.get('date_now');\nvar sub_Date = date_Now - sid_date;\n\nif(sub_Date >= 600000){\n    return msg;    \n}\n\n","outputs":1,"noerr":0,"x":270,"y":2240,"wires":[["4c7c0772.b79538"]]},{"id":"9d93d3bb.41df1","type":"debug","z":"962df517.4837f8","name":"","active":true,"console":"false","complete":"false","x":370,"y":2480,"wires":[]},{"id":"cdd55785.b4a0e8","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"date_now","payloadType":"flow","repeat":"","crontab":"","once":false,"x":130,"y":2480,"wires":[["9d93d3bb.41df1"]]},{"id":"fb3b4f57.008ba","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":130,"y":2280,"wires":[["4c7c0772.b79538"]]},{"id":"a9ce47b0.49e6c8","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"date_Sid","payloadType":"flow","repeat":"","crontab":"","once":false,"x":130,"y":2520,"wires":[["9d93d3bb.41df1"]]},{"id":"dfc4a11f.54a0a","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"sid","payloadType":"flow","repeat":"","crontab":"","once":false,"x":110,"y":2560,"wires":[["9d93d3bb.41df1"]]},{"id":"49196dd8.e057c4","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":100,"y":2600,"wires":[["b9de7503.76b088"]]},{"id":"b9de7503.76b088","type":"function","z":"962df517.4837f8","name":"","func":"var sid_date = flow.get('date_Sid');\nvar date_Now = flow.get('date_now');\nvar sub_Date = date_Now - sid_date;\nmsg.payload = sub_Date;\nreturn msg;    \n\n\n","outputs":1,"noerr":0,"x":250,"y":2600,"wires":[["9d93d3bb.41df1"]]},{"id":"a3bb96d8.d35ec8","type":"http in","z":"3de7a235.4ff04e","name":"","url":"/get/events/log","method":"get","swaggerDoc":"","x":170,"y":1040,"wires":[["e3daf7a.9d70808","87de9564.686e48"]]},{"id":"1153b7ce.ef16e8","type":"http response","z":"3de7a235.4ff04e","name":"","x":1050,"y":1040,"wires":[]},{"id":"e3daf7a.9d70808","type":"function","z":"3de7a235.4ff04e","name":"","func":"var url = \"https://10.107.5.200:8443/ords/ettn/iot_cli/events/log?\"\n//msg.url = \"https://10.107.5.200:8443/ords/ettn/iot_cli/events/log?\";\n//msg.url = global.get(\"send_1c_url_RaiseBarrier\");\n//?p_start_date=2021-09-23T00:00:00Z&p_end_date=2021-09-24T00:00:00Z&p_report_event=true\n\nvar query = msg.payload;\nvar string_query = [];\nfor(var key in query){\n  let name_key = key; // Имя ключа\n  let value_key = query [key]; // Значение ключа\n  let key_Value = `${name_key}=${value_key}`;\n  string_query.push(key_Value);\n}\n\nvar query_params_to_url = string_query.join('&');\n\n\nmsg.url = url + query_params_to_url;\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":1040,"wires":[["50016a55.f3c3c4","2a2f406b.587f9"]]},{"id":"2a2f406b.587f9","type":"http request","z":"3de7a235.4ff04e","name":"","method":"GET","ret":"txt","url":"","tls":"f436a52.4d81958","x":550,"y":1040,"wires":[["e0a35281.de04","5a1a4462.7a4bac"]]},{"id":"8a53115c.f9858","type":"comment","z":"3de7a235.4ff04e","name":"Забрати події з Апекса на 1С","info":"apiuser\napiuser","x":180,"y":940,"wires":[]},{"id":"e0a35281.de04","type":"debug","z":"3de7a235.4ff04e","name":"res 1c","active":true,"console":"false","complete":"true","x":710,"y":1000,"wires":[]},{"id":"5a1a4462.7a4bac","type":"function","z":"3de7a235.4ff04e","name":"","func":" let statusCode = msg.statusCode;\n \n msg.payload = msg.payload.replace(/↵/g, \"\");\n\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":1040,"wires":[["bff631fe.8bb81","cb5888e3.f82e08","b270f818.8e8aa8"]]},{"id":"cb5888e3.f82e08","type":"debug","z":"3de7a235.4ff04e","name":"","active":true,"console":"true","complete":"true","x":870,"y":1000,"wires":[]},{"id":"fd7e20d8.7bcb7","type":"inject","z":"3de7a235.4ff04e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":980,"wires":[["e3daf7a.9d70808"]]},{"id":"87de9564.686e48","type":"debug","z":"3de7a235.4ff04e","name":"send 1c","active":true,"console":"false","complete":"true","x":380,"y":980,"wires":[]},{"id":"50016a55.f3c3c4","type":"debug","z":"3de7a235.4ff04e","name":"","active":true,"console":"false","complete":"true","x":530,"y":1000,"wires":[]},{"id":"ce9b0e32.ba9ae","type":"debug","z":"3de7a235.4ff04e","name":"","active":true,"console":"false","complete":"true","x":1030,"y":1000,"wires":[]},{"id":"bff631fe.8bb81","type":"json","z":"3de7a235.4ff04e","name":"","x":870,"y":1040,"wires":[["ce9b0e32.ba9ae","1153b7ce.ef16e8","c0e53583.d02e88"]]},{"id":"b270f818.8e8aa8","type":"trigger","z":"3de7a235.4ff04e","op1":"","op2":"{\"error\":\"parameter error or no answer json\"}","op1type":"nul","op2type":"json","duration":"5","extend":false,"units":"s","reset":"","name":"","x":880,"y":1140,"wires":[["1153b7ce.ef16e8"]]},{"id":"c0e53583.d02e88","type":"function","z":"3de7a235.4ff04e","name":"","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":1140,"wires":[["b270f818.8e8aa8","79fc7373.71b3ac"]]},{"id":"79fc7373.71b3ac","type":"debug","z":"3de7a235.4ff04e","name":"","active":true,"console":"false","complete":"true","x":870,"y":1180,"wires":[]},{"id":"4ee89bcf.d942e4","type":"function","z":"2b507412.efc2cc","name":"","func":"var weight = msg.payload;\n\nmsg.payload = {\n    weight: weight,\n    date: new Date(),\n    connect: msg.connect\n};\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":340,"wires":[["a75a2649.e7b568","f88867ab.ceb928"]]},{"id":"a75a2649.e7b568","type":"file","z":"2b507412.efc2cc","name":"","filename":"/distr/weight_log/log_3_weight.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":380,"y":340,"wires":[]},{"id":"8fafc633.841de8","type":"function","z":"71f38711.545228","name":"","func":"var weight = msg.payload;\n\nmsg.payload = {\n    weight: weight,\n    date: new Date(),\n};\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":220,"wires":[["bbfb3872.eee278"]]},{"id":"bbfb3872.eee278","type":"file","z":"71f38711.545228","name":"","filename":"/distr/weight_log/log_jd_1_weight.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":1090,"y":220,"wires":[]},{"id":"ed11b933.3cb568","type":"function","z":"d6bade09.4de0d","name":"","func":"var weight = msg.payload;\n\nmsg.payload = {\n    weight: weight,\n    date: new Date(),\n};\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":180,"wires":[["cec1a869.13c408"]]},{"id":"cec1a869.13c408","type":"file","z":"d6bade09.4de0d","name":"","filename":"/distr/weight_log/log_jd_2_weight.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":870,"y":180,"wires":[]},{"id":"6bea0c89.11e164","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":160,"wires":[["756e5a64.d33c54"]]},{"id":"824b3171.59da7","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":2780,"wires":[["ad11ce79.9b5cc"]]},{"id":"ad11ce79.9b5cc","type":"function","z":"962df517.4837f8","name":"screenshot","func":"\nlet url = `https://10.107.9.100:8080/health?&sid=`;\nlet sid = flow.get('sid');\n\nmsg.url = url + sid;\n\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":2780,"wires":[["a3aaf0da.a9fa5"]]},{"id":"a3aaf0da.a9fa5","type":"http request","z":"962df517.4837f8","name":"","method":"GET","ret":"obj","url":"","tls":"d049c21b.cdc58","x":510,"y":2780,"wires":[["c68c0270.e352d"]]},{"id":"c68c0270.e352d","type":"debug","z":"962df517.4837f8","name":"","active":true,"console":"false","complete":"false","x":690,"y":2780,"wires":[]},{"id":"936d80c4.a14e1","type":"function","z":"48413719.e10dd8","name":"log to file","func":"var info = msg.payload;\n\n\nmsg.payload = {\n   info:info,\n   date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":2420,"y":1580,"wires":[["60747b94.552144"]]},{"id":"60747b94.552144","type":"file","z":"48413719.e10dd8","name":"","filename":"/distr/data/log_board_id_5_brutto_right.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":2660,"y":1580,"wires":[]},{"id":"1211e374.2805bd","type":"function","z":"48413719.e10dd8","name":"log to file","func":"var info = msg.payload;\n\n\nmsg.payload = {\n   info:info,\n   date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":2400,"y":2060,"wires":[["970a2b74.45f6d8"]]},{"id":"970a2b74.45f6d8","type":"file","z":"48413719.e10dd8","name":"","filename":"/distr/data/log_board_id_7_tara_left.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":2630,"y":2060,"wires":[]},{"id":"fb38ae51.5251d","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"400","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":1740,"wires":[["de57d958.381a08"]]},{"id":"b96822ed.24e05","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"400","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":2000,"wires":[["f0cdfcc1.67a0e"]]},{"id":"3901878b.214f68","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"400","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2030,"y":2220,"wires":[["3d2ef2fe.a1737e"]]},{"id":"1b549d6f.36d913","type":"delay","z":"48413719.e10dd8","name":"","pauseType":"delay","timeout":"400","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2070,"y":2480,"wires":[["f5504b1e.6fd158"]]},{"id":"29e19ad5.617286","type":"function","z":"f93250c7.39091","name":"sid","func":"//let sid = msg.payload.sid;\nlet sid =global.get('sid');\nmsg.sid = sid;\n\ndelete msg.url;\ndelete msg.headers;\ndelete msg.statusCode;\ndelete msg.responseUrl;\ndelete msg.req;\ndelete msg.res;\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1390,"y":680,"wires":[[]]},{"id":"eceb9800.7066f8","type":"inject","z":"2b507412.efc2cc","name":"","topic":"","payload":"sid","payloadType":"global","repeat":"","crontab":"","once":false,"x":1280,"y":460,"wires":[["8b96aa18.9a4488"]]},{"id":"3fe54f1d.71ad7","type":"comment","z":"962df517.4837f8","name":"LOG","info":"\n\n\nhttps://10.107.9.100:8080/screenshot/B7KQRyWz?timestamp=0&sid=YSC15Slf","x":1330,"y":360,"wires":[]},{"id":"fc78c600.94ced8","type":"trigger","z":"962df517.4837f8","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"3","extend":false,"units":"s","reset":"","name":"","x":1260,"y":240,"wires":[["32f910c2.54d78"]]},{"id":"a89a97ac.36c1f8","type":"function","z":"962df517.4837f8","name":"reset","func":"msg.reset = true\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":180,"wires":[["fc78c600.94ced8"]]},{"id":"7ed06c02.d6f0b4","type":"http response","z":"962df517.4837f8","name":"","x":1570,"y":240,"wires":[]},{"id":"a2d35de2.a7d12","type":"inject","z":"962df517.4837f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1360,"y":300,"wires":[["fc78c600.94ced8"]]},{"id":"32f910c2.54d78","type":"function","z":"962df517.4837f8","name":"","func":"msg.payload = {\"error\": \"error parse\"};\nreturn msg;","outputs":1,"noerr":0,"x":1420,"y":240,"wires":[["7ed06c02.d6f0b4"]]},{"id":"51d0b8ec.a36248","type":"debug","z":"f93250c7.39091","name":"","active":true,"console":"false","complete":"false","x":2450,"y":760,"wires":[]},{"id":"21429c48.0a6834","type":"function","z":"71f38711.545228","name":"time_rasp","func":"var time = new Date();\nflow.set(\"time_rasp\", time);\n\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":440,"wires":[["2051624a.9fa9ce"]]},{"id":"25cc01df.2bee2e","type":"inject","z":"71f38711.545228","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":170,"y":440,"wires":[["21429c48.0a6834"]]},{"id":"2051624a.9fa9ce","type":"function","z":"71f38711.545228","name":"sub time","func":"var weigth_time = flow.get(\"weigth_time\");\nvar time_rasp = flow.get(\"time_rasp\");\n\nvar sub = time_rasp - weigth_time;\n//msg.payload = {\n//    sub: time_rasp - weigth_time,\n//    weigth_time: weigth_time,\n//    time_rasp: time_rasp\n//}\n\n    if(sub > 30000){\n    msg.connect = \"not\";\n    \n    msg.payload = 0;\n    msg.weight1 = 0;\n    msg.weight2 = 0;\n    msg.weight_center = 0;\n    \n    \n    return msg;\n    }\n","outputs":1,"noerr":0,"x":460,"y":440,"wires":[["e12239c9.9d8ef8","c0377ed3.f7381"]]},{"id":"e12239c9.9d8ef8","type":"debug","z":"71f38711.545228","name":"","active":false,"console":"false","complete":"false","x":630,"y":440,"wires":[]},{"id":"7c80d97c.6b4418","type":"function","z":"71f38711.545228","name":"weigth_time","func":"flow.set('weigth_time',new Date());\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":400,"wires":[[]]},{"id":"d8c7908a.f1b65","type":"inject","z":"71f38711.545228","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":170,"y":400,"wires":[["7c80d97c.6b4418"]]},{"id":"dc7b718f.12c2","type":"function","z":"d6bade09.4de0d","name":"time_rasp","func":"var time = new Date();\nflow.set(\"time_rasp\", time);\n\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":420,"wires":[["df8ddb8e.abade8"]]},{"id":"c4b33bb5.85cbc8","type":"inject","z":"d6bade09.4de0d","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":170,"y":420,"wires":[["dc7b718f.12c2"]]},{"id":"df8ddb8e.abade8","type":"function","z":"d6bade09.4de0d","name":"sub time","func":"var weigth_time = flow.get(\"weigth_time\");\nvar time_rasp = flow.get(\"time_rasp\");\n\nvar sub = time_rasp - weigth_time;\n//msg.payload = {\n//    sub: time_rasp - weigth_time,\n//    weigth_time: weigth_time,\n//    time_rasp: time_rasp\n//}\n\n    if(sub > 30000){\n    msg.connect = \"not\";\n    \n    msg.payload = 0;\n    msg.weight1 = 0;\n    msg.weight2 = 0;\n    msg.weight_center = 0;\n    \n    \n    return msg;\n    }\n","outputs":1,"noerr":0,"x":460,"y":420,"wires":[["3139d054.dd41b","36c7e41.ca9a61c"]]},{"id":"3139d054.dd41b","type":"debug","z":"d6bade09.4de0d","name":"","active":false,"console":"false","complete":"false","x":630,"y":420,"wires":[]},{"id":"209dc59d.32d45a","type":"function","z":"d6bade09.4de0d","name":"weigth_time","func":"flow.set('weigth_time',new Date());\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":380,"wires":[[]]},{"id":"e43b25eb.5a36c8","type":"inject","z":"d6bade09.4de0d","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":170,"y":380,"wires":[["209dc59d.32d45a"]]},{"id":"4432e0f3.3574e","type":"function","z":"40a858ce.eb2118","name":"","func":"var weight = msg.payload;\n\nmsg.payload = {\n    info: weight,\n    date: new Date(),\n};\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":660,"wires":[["1283a398.4581ac"]]},{"id":"1283a398.4581ac","type":"file","z":"40a858ce.eb2118","name":"","filename":"/distr/weight_log/log_jd_1_1c_GET_weight.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":1120,"y":660,"wires":[]},{"id":"db4307e8.c4bed8","type":"function","z":"cbb45903.f34358","name":"","func":"var weight = msg.payload;\n\nmsg.payload = {\n    info: weight,\n    date: new Date(),\n};\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":680,"wires":[["ed3bd40e.f78158"]]},{"id":"ed3bd40e.f78158","type":"file","z":"cbb45903.f34358","name":"","filename":"/distr/weight_log/log_jd_2_1c_GET_weight.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":1180,"y":680,"wires":[]},{"id":"7779f928.906188","type":"function","z":"1124af78.b62db1","name":"Send 1C triger","func":"var transactionMetadata = flow.get('transactionMetadata');\n\nvar truck_id = msg.payload.truck_id;\nvar reader = msg.payload.reader;\n\nmsg.payload = {\n    name:\"SEND 1C triger\",\n    tM:transactionMetadata.weight,\n    truck_id: truck_id,\n    reader:  reader,\n    date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1520,"y":1700,"wires":[["6839370a.6f2388"]]},{"id":"b0b7ca56.1f32d8","type":"inject","z":"48413719.e10dd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":840,"y":160,"wires":[["efe1c6a4.136998"]]},{"id":"dc4cc180.7b2cb","type":"function","z":"48413719.e10dd8","name":"log to file","func":"var id = msg.payload.АдресУстройства;\nvar string_1 = msg.payload.Строка1;\nvar string_2 = msg.payload.Строка2;\n\nmsg.payload = {\n   id:id,\n   string_1:string_1,\n   string_2:string_2,\n   date: new Date()\n};\nreturn msg;","outputs":1,"noerr":0,"x":1120,"y":2840,"wires":[["7a5c5ee.72848a"]]},{"id":"7a5c5ee.72848a","type":"file","z":"48413719.e10dd8","name":"","filename":"/distr/data/log_board_3_sklad.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1330,"y":2840,"wires":[]},{"id":"f88867ab.ceb928","type":"debug","z":"2b507412.efc2cc","name":"","active":false,"console":"false","complete":"false","x":310,"y":380,"wires":[]},{"id":"ce6058c7.8cca18","type":"debug","z":"48413719.e10dd8","name":"","active":false,"console":"false","complete":"payload","x":460,"y":380,"wires":[]},{"id":"62707a5f.f77f24","type":"tcp request","z":"bd4c94f4.ece8e8","server":"10.107.5.177","port":"1886","out":"time","splitc":"1000","name":"","x":350,"y":360,"wires":[["500f25c2.39d0bc"]]},{"id":"500f25c2.39d0bc","type":"debug","z":"bd4c94f4.ece8e8","name":"","active":true,"console":"false","complete":"false","x":550,"y":360,"wires":[]},{"id":"b07de73f.6d9d88","type":"inject","z":"bd4c94f4.ece8e8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":120,"y":340,"wires":[["62707a5f.f77f24"]]},{"id":"a3adee19.947a3","type":"function","z":"48413719.e10dd8","name":"","func":"// var testSend = {\n//     \"АдресУстройства\": \"15\",\n//     \"Строка1\": \"<s1> 1: ТЕСТ1С\",\n//     \"Строка2\": \"<s2> 2: ТЕСТ1С\"\n// }\n\nvar testSend = msg.payload;\nmsg.payload = JSON.stringify(testSend);\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":4180,"wires":[["a0d96258.aa06e","18e1174d.b7e3b9"]]},{"id":"49f2af0a.0f11d","type":"comment","z":"48413719.e10dd8","name":"15","info":"","x":830,"y":4120,"wires":[]},{"id":"18e1174d.b7e3b9","type":"tcp out","z":"48413719.e10dd8","host":"10.107.5.41","port":"4002","beserver":"client","base64":false,"end":true,"name":"","x":1050,"y":4180,"wires":[]},{"id":"a0d96258.aa06e","type":"debug","z":"48413719.e10dd8","name":"","active":true,"console":"false","complete":"false","x":1000,"y":4260,"wires":[]},{"id":"97f7b875.9776f8","type":"debug","z":"f93250c7.39091","name":"","active":true,"console":"false","complete":"true","x":1390,"y":640,"wires":[]},{"id":"764c1774.554388","type":"delay","z":"f93250c7.39091","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1120,"y":700,"wires":[["c567b364.f14a2"]]}]
