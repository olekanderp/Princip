[{"id":"22ab853a.6485e2","type":"tab","label":"Modbus Infrared"},{"id":"d88325d7.1ab86","type":"modbus-client","z":"22ab853a.6485e2","name":"tare scale","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":true,"tcpHost":"10.142.12.1","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":1,"commandDelay":1,"clientTimeout":1000,"reconnectTimeout":2000},{"id":"561f14f2.7dd80c","type":"ui_group","z":"","name":"Платформа ИК","tab":"676ded4a.7791f4","disp":true,"width":"6"},{"id":"676ded4a.7791f4","type":"ui_tab","z":"","name":"Smart Scales","icon":"dashboard"},{"id":"63ae58e3.23cc38","type":"ui_base","name":"Smart Scales","theme":"theme-light"},{"id":"89fbc273.284188","type":"modbus-read","z":"22ab853a.6485e2","name":"","showStatusActivities":true,"showErrors":true,"unitid":"1","dataType":"HoldingRegister","adr":"0","quantity":"10","rate":"1","rateUnit":"s","server":"d88325d7.1ab86","x":90,"y":80,"wires":[["f6da43bb.cc6228","c9e073aa.13a8d"],[]]},{"id":"c9e073aa.13a8d","type":"function","z":"22ab853a.6485e2","name":"state 1","func":"var n = msg.payload[0];\nmsg.payload = n.toString(2);\n\nvar b = [];\nfor (var i = 0; i < 16; i++){\n    b.push((n >> i) & 1);\n}\nvar bi = 4;\n\nflow.set('state_1', !!b[bi]);\nflow.set('state_date_1',new Date());\n\n\nflow.set('b1',b);  \nmsg.d = new Date();\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":60,"wires":[["319538af.44feb","c49d065d.481c5"]]},{"id":"f6da43bb.cc6228","type":"function","z":"22ab853a.6485e2","name":"state 2","func":"var n = msg.payload[1];\nmsg.payload = n.toString(2);\n\nvar b = [];\nfor (var i = 0; i < 16; i++){\n    b.push((n >> i) & 1);\n}\nvar bi = 4;\n\nflow.set('state_2', !!b[bi]);\nflow.set('state_date_2',new Date());\nmsg.d = new Date();\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":120,"wires":[["df154212.f96d48","f4298d85.142cb"]]},{"id":"319538af.44feb","type":"ui_text","z":"22ab853a.6485e2","group":"561f14f2.7dd80c","order":1,"width":0,"height":0,"name":"","label":"Платформа 1 ИК","format":"{{msg.payload}} ","layout":"row-spread","x":490,"y":20,"wires":[]},{"id":"df154212.f96d48","type":"ui_text","z":"22ab853a.6485e2","group":"561f14f2.7dd80c","order":4,"width":0,"height":0,"name":"","label":"Платформа 2 ИК","format":"{{msg.payload}}","layout":"row-spread","x":490,"y":120,"wires":[]},{"id":"9b3c9165.f7d928","type":"http in","z":"22ab853a.6485e2","name":"","url":"/scale1/perimetr","method":"get","swaggerDoc":"","x":160,"y":220,"wires":[["85a6b227.8393f8"]]},{"id":"85a6b227.8393f8","type":"function","z":"22ab853a.6485e2","name":"state 1","func":"var state_date = flow.get('state_date_1');\nvar state = false;\nif (new Date() - state_date < 3000){\n   state = flow.get('state_1'); \n}\n\nmsg.payload = {\n    'state':state\n}\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":220,"wires":[["3e8bd72a.4ae7e"]]},{"id":"3e8bd72a.4ae7e","type":"http response","z":"22ab853a.6485e2","name":"","x":490,"y":220,"wires":[]},{"id":"2e1b1d61.d9c762","type":"http in","z":"22ab853a.6485e2","name":"","url":"/scale2/perimetr","method":"get","swaggerDoc":"","x":160,"y":260,"wires":[["2fd6890.b20a2f8"]]},{"id":"2fd6890.b20a2f8","type":"function","z":"22ab853a.6485e2","name":"state 2","func":"var state_date = flow.get('state_date_2');\nvar state = false;\nif (new Date() - state_date < 3000){\n   state = flow.get('state_2'); \n}\n\nmsg.payload = {\n    'state':state\n}\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":260,"wires":[["26b4ddbe.f00dea"]]},{"id":"26b4ddbe.f00dea","type":"http response","z":"22ab853a.6485e2","name":"","x":490,"y":260,"wires":[]},{"id":"8d19b51a.8e082","type":"inject","z":"22ab853a.6485e2","name":"","topic":"","payload":"state_1","payloadType":"flow","repeat":"1","crontab":"","once":false,"x":110,"y":360,"wires":[["83a31560.855fe8"]]},{"id":"83a31560.855fe8","type":"ui_text","z":"22ab853a.6485e2","group":"561f14f2.7dd80c","order":2,"width":0,"height":0,"name":"","label":"платформа 1 (1С)","format":"{{msg.payload}}","layout":"row-spread","x":310,"y":360,"wires":[]},{"id":"80daf1cb.58446","type":"inject","z":"22ab853a.6485e2","name":"","topic":"","payload":"state_2","payloadType":"flow","repeat":"1","crontab":"","once":false,"x":110,"y":400,"wires":[["6f76f8bb.d6db4"]]},{"id":"6f76f8bb.d6db4","type":"ui_text","z":"22ab853a.6485e2","group":"561f14f2.7dd80c","order":5,"width":0,"height":0,"name":"","label":"платформа 2  (1С)","format":"{{msg.payload}}","layout":"row-spread","x":310,"y":400,"wires":[]},{"id":"c49d065d.481c5","type":"ui_text","z":"22ab853a.6485e2","group":"561f14f2.7dd80c","order":3,"width":0,"height":0,"name":"","label":"Последний опрос 1","format":"{{msg.d}}","layout":"row-spread","x":490,"y":80,"wires":[]},{"id":"f4298d85.142cb","type":"ui_text","z":"22ab853a.6485e2","group":"561f14f2.7dd80c","order":6,"width":0,"height":0,"name":"","label":"Последний опрос 2","format":"{{msg.d}}","layout":"row-spread","x":500,"y":160,"wires":[]}]
