[{"id":"7c8abe24.f8c9f","type":"tab","label":"Modbus Infrared"},{"id":"3c316f01.c8313","type":"socket-io-event","z":"","addr":"getWeight"},{"id":"2700ca56.578c06","type":"socket-io-server","z":"","port":"4001"},{"id":"ee8937eb.82b518","type":"ui_tab","z":"","name":"Smart Scales","icon":"dashboard"},{"id":"e0c44f5.21f2db","type":"ui_group","z":"","name":"Платформа ИК","tab":"ee8937eb.82b518","disp":true,"width":"6"},{"id":"36cba745.737308","type":"ui_base","name":"Smart Scales","theme":"theme-light"},{"id":"d2135a95.e651d8","type":"modbus-client","z":"","name":"","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":false,"tcpHost":"127.0.0.1","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":"1","commandDelay":"1","clientTimeout":"1000","reconnectTimeout":"2000"},{"id":"fa357a13.0d7998","type":"modbus-client","z":"7c8abe24.f8c9f","name":"tare scale","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":true,"tcpHost":"10.142.12.1","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":1,"commandDelay":1,"clientTimeout":1000,"reconnectTimeout":2000},{"id":"a365804c.10a8b","type":"ui_group","z":"","name":"Платформа ИК","tab":"78804044.28acf","disp":true,"width":"6"},{"id":"78804044.28acf","type":"ui_tab","z":"","name":"Smart Scales","icon":"dashboard"},{"id":"72c20d52.dc7f54","type":"ui_base","name":"Smart Scales","theme":"theme-light"},{"id":"ed6345e5.be5008","type":"modbus-client","z":"","name":"","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":false,"tcpHost":"10.142.11.1","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":"1","commandDelay":"1","clientTimeout":"1000","reconnectTimeout":"2000"},{"id":"5082f4b6.30f63c","type":"modbus-read","z":"7c8abe24.f8c9f","name":"","showStatusActivities":true,"showErrors":true,"unitid":"1","dataType":"HoldingRegister","adr":"0","quantity":"10","rate":"1","rateUnit":"s","server":"fa357a13.0d7998","x":90,"y":80,"wires":[["99ac155a.811e38","64239e8d.62c91","4df7fd6e.3b65b4"],[]]},{"id":"64239e8d.62c91","type":"function","z":"7c8abe24.f8c9f","name":"state 1","func":"var n = msg.payload[0];\nmsg.payload = n.toString(2);\n\nvar b = [];\nfor (var i = 0; i < 16; i++){\n    b.push((n >> i) & 1);\n}\nvar bi = 4;\n\nflow.set('state_1', !!b[bi]);\nflow.set('state_date_1',new Date());\n\n\nflow.set('b1',b);  \nmsg.d = new Date();\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":60,"wires":[["60e7693b.7050a8","184dcc97.4bf1b3"]]},{"id":"99ac155a.811e38","type":"function","z":"7c8abe24.f8c9f","name":"state 2","func":"var n = msg.payload[1];\nmsg.payload = n.toString(2);\n\nvar b = [];\nfor (var i = 0; i < 16; i++){\n    b.push((n >> i) & 1);\n}\nvar bi = 4;\n\nflow.set('state_2', !!b[bi]);\nflow.set('state_date_2',new Date());\nmsg.d = new Date();\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":120,"wires":[["39af6382.8f174c","83d6bd97.ceefb"]]},{"id":"60e7693b.7050a8","type":"ui_text","z":"7c8abe24.f8c9f","group":"a365804c.10a8b","order":1,"width":0,"height":0,"name":"","label":"Платформа 1 ИК","format":"{{msg.payload}} ","layout":"row-spread","x":490,"y":20,"wires":[]},{"id":"39af6382.8f174c","type":"ui_text","z":"7c8abe24.f8c9f","group":"a365804c.10a8b","order":4,"width":0,"height":0,"name":"","label":"Платформа 2 ИК","format":"{{msg.payload}}","layout":"row-spread","x":490,"y":120,"wires":[]},{"id":"ed52f168.485c","type":"http in","z":"7c8abe24.f8c9f","name":"","url":"/scale1/perimetr","method":"get","swaggerDoc":"","x":160,"y":220,"wires":[["c1339b2.d16ef68"]]},{"id":"c1339b2.d16ef68","type":"function","z":"7c8abe24.f8c9f","name":"state 1","func":"var state_date = flow.get('state_date_1');\nvar state = false;\nif (new Date() - state_date < 3000){\n   state = flow.get('state_1'); \n}\n\nmsg.payload = {\n    'state':state\n}\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":220,"wires":[["333197a5.ad2e18"]]},{"id":"333197a5.ad2e18","type":"http response","z":"7c8abe24.f8c9f","name":"","x":490,"y":220,"wires":[]},{"id":"f5bbcf95.3d406","type":"http in","z":"7c8abe24.f8c9f","name":"","url":"/scale2/perimetr","method":"get","swaggerDoc":"","x":160,"y":260,"wires":[["4e92c110.e361f"]]},{"id":"4e92c110.e361f","type":"function","z":"7c8abe24.f8c9f","name":"state 2","func":"var state_date = flow.get('state_date_2');\nvar state = false;\nif (new Date() - state_date < 3000){\n   state = flow.get('state_2'); \n}\n\nmsg.payload = {\n    'state':state\n}\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":260,"wires":[["48ef8fe8.44ca3"]]},{"id":"48ef8fe8.44ca3","type":"http response","z":"7c8abe24.f8c9f","name":"","x":490,"y":260,"wires":[]},{"id":"2fb4ac54.640e64","type":"inject","z":"7c8abe24.f8c9f","name":"","topic":"","payload":"state_1","payloadType":"flow","repeat":"1","crontab":"","once":false,"x":110,"y":360,"wires":[["52ac3c6c.9bacb4"]]},{"id":"52ac3c6c.9bacb4","type":"ui_text","z":"7c8abe24.f8c9f","group":"a365804c.10a8b","order":2,"width":0,"height":0,"name":"","label":"платформа 1 (1С)","format":"{{msg.payload}}","layout":"row-spread","x":310,"y":360,"wires":[]},{"id":"34dccfd.a776e3","type":"inject","z":"7c8abe24.f8c9f","name":"","topic":"","payload":"state_2","payloadType":"flow","repeat":"1","crontab":"","once":false,"x":110,"y":400,"wires":[["50323604.57aa88"]]},{"id":"50323604.57aa88","type":"ui_text","z":"7c8abe24.f8c9f","group":"a365804c.10a8b","order":5,"width":0,"height":0,"name":"","label":"платформа 2  (1С)","format":"{{msg.payload}}","layout":"row-spread","x":310,"y":400,"wires":[]},{"id":"184dcc97.4bf1b3","type":"ui_text","z":"7c8abe24.f8c9f","group":"a365804c.10a8b","order":3,"width":0,"height":0,"name":"","label":"Последний опрос 1","format":"{{msg.d}}","layout":"row-spread","x":490,"y":80,"wires":[]},{"id":"83d6bd97.ceefb","type":"ui_text","z":"7c8abe24.f8c9f","group":"a365804c.10a8b","order":6,"width":0,"height":0,"name":"","label":"Последний опрос 2","format":"{{msg.d}}","layout":"row-spread","x":500,"y":160,"wires":[]},{"id":"4df7fd6e.3b65b4","type":"debug","z":"7c8abe24.f8c9f","name":"","active":false,"console":"false","complete":"false","x":259,"y":162,"wires":[]},{"id":"672b22fc.1af0dc","type":"inject","z":"7c8abe24.f8c9f","name":"","topic":"","payload":"","payloadType":"date","repeat":"10","crontab":"","once":false,"x":116,"y":480,"wires":[["30f38fa5.4de8"]]},{"id":"30f38fa5.4de8","type":"modbus-getter","z":"7c8abe24.f8c9f","name":"","showStatusActivities":false,"showErrors":false,"unitid":"1","dataType":"HoldingRegister","adr":"0","quantity":"10","server":"fa357a13.0d7998","x":277,"y":481,"wires":[["e6cd7b62.452e38"],[]]},{"id":"e6cd7b62.452e38","type":"debug","z":"7c8abe24.f8c9f","name":"","active":false,"console":"false","complete":"false","x":473,"y":469,"wires":[]},{"id":"3afeb3ac.4eb52c","type":"catch","z":"7c8abe24.f8c9f","name":"","scope":["30f38fa5.4de8","5082f4b6.30f63c"],"x":95,"y":536,"wires":[["d0d6fbdc.d90cf8","975ce6cb.da6e58"]]},{"id":"d0d6fbdc.d90cf8","type":"debug","z":"7c8abe24.f8c9f","name":"","active":true,"console":"false","complete":"false","x":412,"y":522,"wires":[]},{"id":"975ce6cb.da6e58","type":"file","z":"7c8abe24.f8c9f","name":"","filename":"/distr/data/error_1.txt","appendNewline":true,"createDir":true,"overwriteFile":"true","x":442,"y":563,"wires":[]}]
