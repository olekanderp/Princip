[{"id":"a143ae81.213c6","type":"tab","label":"Main Flow","disabled":false,"info":""},{"id":"d89b76b5.c78b58","type":"tab","label":"Зовні Рфід","disabled":false,"info":""},{"id":"a9cb9ebe.4b364","type":"tab","label":"ТИС Зерно","disabled":false,"info":""},{"id":"11b78381.90926c","type":"tab","label":"Мережевий каталог","disabled":false,"info":""},{"id":"44019beb.1ec4f4","type":"tab","label":"Налаштування","disabled":true,"info":""},{"id":"929483d2.49f73","type":"tab","label":"Flow 1","disabled":true,"info":""},{"id":"ecbe105e.26d37","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"9600","databits":"8","parity":"even","stopbits":"1","waitfor":"","dtr":"none","rts":"none","cts":"none","dsr":"none","newline":"200","bin":"bin","out":"time","addchar":"","responsetimeout":"10000"},{"id":"97b7827e.7903d","type":"ui_group","z":"","name":"Information","tab":"df95b5a7.807318","order":1,"disp":true,"width":"12","collapse":false},{"id":"e7feaeb.de0ae5","type":"ui_group","z":"","name":"Information","tab":"df95b5a7.807318","order":2,"disp":true,"width":"12","collapse":false},{"id":"25a5d38.229822c","type":"ui_group","z":"","name":"Timer","tab":"df95b5a7.807318","order":3,"disp":true,"width":"6","collapse":false},{"id":"df95b5a7.807318","type":"ui_tab","z":"","name":"Головна","icon":"dashboard","disabled":false,"hidden":false},{"id":"30ff0e7a.4cd4a2","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"ТИС Зерно","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"e791336b.c6e84","type":"ui_group","z":"","name":"Данные","tab":"6f343702.e65148","order":4,"disp":true,"width":"8"},{"id":"6f343702.e65148","type":"ui_tab","z":"","name":"Prod","icon":"dashboard","order":2},{"id":"beafc7de.e185c8","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"9600","databits":"8","parity":"even","stopbits":"1","waitfor":"","dtr":"none","rts":"none","cts":"none","dsr":"none","newline":"200","bin":"bin","out":"time","addchar":"","responsetimeout":"10000"},{"id":"219c6386.a1895c","type":"smb config","z":"","name":"SMB Screenshots","share":"\"\\\\192.168.10.7\\ScreenShots\\KPP3_OUT_KABINA\"","domain":""},{"id":"7b8f6cda.1e8604","type":"serial-port","z":"","serialport":"/dev/ttyACM0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","waitfor":"","dtr":"none","rts":"none","cts":"none","dsr":"none","newline":"500","bin":"bin","out":"time","addchar":"","responsetimeout":"10000"},{"id":"8421d0be.1617f","type":"http request","z":"a143ae81.213c6","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.2.6/acc-tis/ws/Checkpoints?wsdl","tls":"","persist":false,"proxy":"","authType":"basic","x":330,"y":4280,"wires":[["1bb1925f.8d86ee"]]},{"id":"b0c4c4ff.1479b8","type":"inject","z":"a143ae81.213c6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":4280,"wires":[["8421d0be.1617f"]]},{"id":"1bb1925f.8d86ee","type":"debug","z":"a143ae81.213c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":520,"y":4280,"wires":[]},{"id":"210b553.c95bdaa","type":"http request","z":"a143ae81.213c6","name":"","method":"POST","ret":"txt","paytoqs":"body","url":"http://192.168.10.5/acc-tis/ws/Checkpoints","tls":"","persist":false,"proxy":"","authType":"basic","x":610,"y":100,"wires":[["7b2ad56d.6c241c"]]},{"id":"2a03e068.1b939","type":"template","z":"a143ae81.213c6","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<soap:Envelope xmlns:soap=\"http://www.w3.org/2003/05/soap-envelope\" xmlns:chec=\"Checkpoints\">\n   <soap:Header/>\n   <soap:Body>\n      <chec:CheckIn>\n         <chec:DirverCardID>{{payload}}</chec:DirverCardID>\n         <chec:PhotoPathFront></chec:PhotoPathFront>\n         <chec:PhotoPathBack></chec:PhotoPathBack>\n         <chec:PointID>5</chec:PointID>\n      </chec:CheckIn>\n   </soap:Body>\n</soap:Envelope>","output":"str","x":440,"y":100,"wires":[["210b553.c95bdaa"]]},{"id":"9a1d0d64.827b9","type":"inject","z":"a143ae81.213c6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":100,"wires":[["fbd09482.4bfdf8"]]},{"id":"7b2ad56d.6c241c","type":"xml","z":"a143ae81.213c6","name":"","property":"payload","attr":"","chr":"","x":770,"y":100,"wires":[["3090dc89.2dbaf4"]]},{"id":"8c6d2940.7b7a68","type":"comment","z":"a143ae81.213c6","name":"Пример вызова в 1с","info":"","x":150,"y":40,"wires":[]},{"id":"3d879dc1.52af62","type":"debug","z":"44019beb.1ec4f4","name":"res","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":260,"wires":[]},{"id":"4d62ad5f.9485c4","type":"serial in","z":"44019beb.1ec4f4","name":"","serial":"ecbe105e.26d37","x":90,"y":260,"wires":[["f0abcd00.ace02"]]},{"id":"f0abcd00.ace02","type":"function","z":"44019beb.1ec4f4","name":"ascii","func":"var str = msg.payload;\nvar len_str = str.length;\nvar out_str = \"\"\n    for(var i = 0; i < len_str; i++){\n    let str_ascii = String.fromCharCode(str[i]); \n    out_str = out_str + str_ascii;\n    }\n\n\nvar init = flow.get(\"init\");\nvar led_on_g = flow.get(\"led_on_g\");\nvar card_take = flow.get(\"card_take\");\n\n//var positiv = str.indexOf('P');\n    if(init === true){\n        \n      var positiv_init = out_str.indexOf('P');\n        if(positiv_init != -1){\n            msg.init = \"Прилад ініціалізований\";\n            flow.set(\"init\", false);\n        }else{\n            msg.init = \"Прилад не ініціалізований. Переініціалізуйте\" \n        }  \n    \n    \n    }else if(led_on_g === true){\n       var positiv_led_on_g = out_str.indexOf('P');\n        if(positiv_led_on_g != -1){\n            msg.positiv_led_on_g = \"Зелений світодіод включений\"\n            msg.color = 'green';\n            flow.set(\"led_on_g\", false);\n        }else{\n            msg.positiv_led_on_g = \"Помилка включення світодіода\"\n            msg.color = 'gray';\n        }  \n    \n    \n    }else if(card_take === true){\n       var positiv_card_take = out_str.indexOf('P');\n        if(positiv_card_take != -1){\n            msg.positiv_card_take = \"Очікуєм карту\";\n            flow.set(\"card_take\", false); \n        }else{\n            msg.positiv_card_take = \"Помилка отримання карти\" \n        }  \n        \n       \n    }\n\n\n    \nmsg.payload = out_str;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":260,"wires":[["3d879dc1.52af62","ca4f484.89460b8","11306b0.f62db95","1bd68aa8.fe4775","cbc127a2.3d8c58","707d4529.dbd8dc"]]},{"id":"17a85755.ab2b49","type":"function","z":"44019beb.1ec4f4","name":"init","func":"\nmsg.payload = Buffer.from('f2000d43303033323431303031303030f673', 'hex')\n\nflow.set(\"init\", true);\n\nreturn msg;\n                                                           \n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":420,"wires":[["111ddec5.d67891","9508f5cc.5e46f8","c4b030a2.da64c"]]},{"id":"64c67b08.265f24","type":"inject","z":"44019beb.1ec4f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":130,"y":420,"wires":[["17a85755.ab2b49"]]},{"id":"111ddec5.d67891","type":"serial out","z":"44019beb.1ec4f4","name":"","serial":"ecbe105e.26d37","x":550,"y":460,"wires":[]},{"id":"a74237a5.8c0ed8","type":"comment","z":"44019beb.1ec4f4","name":"Ініціалізація роботи при старті системи","info":"","x":180,"y":100,"wires":[]},{"id":"df6c0ed2.880d5","type":"function","z":"44019beb.1ec4f4","name":"Узяти картку","func":"msg.payload = Buffer.from(\"f20003433a3019d0\", \"hex\");  \n\nflow.set(\"card_take\", true);\nflow.set(\"card_last\", \"\"); \nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":660,"wires":[["d2480554.f9b7f8","10c1e9e4.555716","e3dbdc0.c7a0528"]]},{"id":"d2480554.f9b7f8","type":"serial out","z":"44019beb.1ec4f4","name":"","serial":"ecbe105e.26d37","x":550,"y":660,"wires":[]},{"id":"94f7f934.12f028","type":"function","z":"44019beb.1ec4f4","name":"led_on_g","func":"\nmsg.payload = Buffer.from(\"f2000343353119cf\", \"hex\");  \n\n\nflow.set(\"led_on_g\", true);\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":540,"wires":[["e4069345.8e922","596d989f.3ed3c8"]]},{"id":"e4069345.8e922","type":"serial out","z":"44019beb.1ec4f4","name":"","serial":"ecbe105e.26d37","x":550,"y":500,"wires":[]},{"id":"9508f5cc.5e46f8","type":"delay","z":"44019beb.1ec4f4","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":120,"y":540,"wires":[["94f7f934.12f028"]]},{"id":"747a600b.7401e","type":"comment","z":"44019beb.1ec4f4","name":"Узяти карту","info":"","x":130,"y":620,"wires":[]},{"id":"10c1e9e4.555716","type":"exec","z":"44019beb.1ec4f4","command":"sudo python /home/pi/read-rfid-on-rpi.py","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"read rfid","x":120,"y":760,"wires":[["23b2ec2f.fce804"],[],[]]},{"id":"7ece1835.6c78e8","type":"function","z":"44019beb.1ec4f4","name":"","func":"let str = msg.payload;\nlet card_last = flow.get(\"card_last\");\n\n\nlet arr = str.split('');\nvar array = \"\";\n\nfor (var i = 0; i < arr.length; i++) {\n    \n    if(arr[i] == \")\"){\n       arr[i] = 0;   \n    }else if(arr[i] == \"!\"){\n       arr[i] = 1;    \n    }else if(arr[i] == \"@\"){\n       arr[i] = 2;    \n    }else if(arr[i] == \"#\"){\n       arr[i] = 3;    \n    }else if(arr[i] == \"$\"){\n       arr[i] = 4;    \n    }else if(arr[i] == \"%\"){\n       arr[i] = 5;    \n    }else if(arr[i] == \"^\"){\n       arr[i] = 6;    \n    }else if(arr[i] == \"&\"){\n       arr[i] = 7;    \n    }else if(arr[i] == \"*\"){\n       arr[i] = 8;    \n    }else if(arr[i] == \"(\"){\n       arr[i] = 9;    \n    }\n    \n}\n\nvar correct_str = arr.join(\"\");\n    correct_str = +correct_str;\n    correct_str = correct_str.toString(16)\n    \n  \nif(correct_str != card_last){\n  msg.payload = correct_str;\n  flow.set(\"card_last\", correct_str); \n  flow.set(\"timer\", true);\n  msg.color = \"orange\"; \n  msg.positiv_led_on_g = \"Оранжевий світодіод включений\";\n  msg.positiv_card_take = \"Карта отримана\";\n  return msg;\n}    \n    \n    \n\n\n\n\n\n\n//)))#%!%*^( - 1569\n//0003515869\n// 0: 0x35\n// 1: 0xa5\n// 2: 0xdd\n\n\n\n//)))&)&#%#! - 0802\n//0007073531\n// 0: 107\n// 1: 238\n// 2: 251\n\n// 0: 0x6b\n// 1: 0xee\n// 2: 0xfb","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":760,"wires":[["3f49f764.671838","ad4fa4dc.28fc28","fd9d67f2.806b18","93ff3dc5.12e0a","9c5158e3.871218"]]},{"id":"f054993c.c66b48","type":"delay","z":"44019beb.1ec4f4","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":120,"y":840,"wires":[["10c1e9e4.555716"]]},{"id":"3f49f764.671838","type":"debug","z":"44019beb.1ec4f4","name":"card","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":700,"wires":[]},{"id":"23b2ec2f.fce804","type":"switch","z":"44019beb.1ec4f4","name":"","property":"rc.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"neq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":760,"wires":[["7ece1835.6c78e8"],["f054993c.c66b48"]]},{"id":"e00eaa9f.5062e8","type":"inject","z":"44019beb.1ec4f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":790,"y":80,"wires":[["db45d232.18a4f"]]},{"id":"db45d232.18a4f","type":"switch","z":"44019beb.1ec4f4","name":"","property":"timer","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":950,"y":80,"wires":[["e6b51dbc.163be"],[]]},{"id":"e6b51dbc.163be","type":"function","z":"44019beb.1ec4f4","name":"counter","func":"var counter = flow.get(\"counter\");\n\ncounter = counter - 1;\n\nflow.set(\"counter\", counter);\n\n\nif(counter === 0){\n  flow.set(\"timer\", false);\n  flow.set(\"counter\", 31);\n\n}\nmsg.payload = counter;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":80,"wires":[["d725233.98f4ae","cfffe877.eb5c28","3e2ecde2.3a4162"]]},{"id":"ca22adef.dad69","type":"comment","z":"44019beb.1ec4f4","name":"Робота лічильника","info":"","x":790,"y":20,"wires":[]},{"id":"5583fcf2.d331b4","type":"inject","z":"44019beb.1ec4f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":110,"y":60,"wires":[["194a5a84.2c2be5"]]},{"id":"d6b3126.86f4bf","type":"comment","z":"44019beb.1ec4f4","name":"Ініціалізація змінних","info":"","x":120,"y":20,"wires":[]},{"id":"194a5a84.2c2be5","type":"function","z":"44019beb.1ec4f4","name":"","func":"flow.set(\"counter\", 31);\nflow.set(\"timer\", false);\nflow.set(\"card_last\", \"\"); \n//статуси роботи картоприймача\nflow.set(\"init\", false);\nflow.set(\"led_on_g\", false);\nflow.set(\"card_take\", false);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":60,"wires":[[]]},{"id":"d725233.98f4ae","type":"debug","z":"44019beb.1ec4f4","name":"timer","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1230,"y":80,"wires":[]},{"id":"b70b3791.6a7bb8","type":"link in","z":"44019beb.1ec4f4","name":"Початок циклу лічильник/команда","links":["d04aec00.0c0bf8"],"x":135,"y":380,"wires":[["17a85755.ab2b49"]]},{"id":"d04aec00.0c0bf8","type":"link out","z":"44019beb.1ec4f4","name":"Ініт після лічильника","links":["b70b3791.6a7bb8"],"x":1195,"y":120,"wires":[]},{"id":"47946ff0.085bc","type":"ui_text","z":"44019beb.1ec4f4","group":"97b7827e.7903d","order":1,"width":0,"height":0,"name":"","label":"Status Init:","format":"{{msg.init}}","layout":"row-left","x":1190,"y":300,"wires":[]},{"id":"e162a78d.3e9c68","type":"ui_text","z":"44019beb.1ec4f4","group":"97b7827e.7903d","order":2,"width":0,"height":0,"name":"","label":"Status Led:","format":"{{msg.positiv_led_on_g}}","layout":"row-left","x":1190,"y":340,"wires":[]},{"id":"ac0c8016.4829e","type":"ui_text","z":"44019beb.1ec4f4","group":"97b7827e.7903d","order":3,"width":0,"height":0,"name":"","label":"Status card:","format":"{{msg.positiv_card_take}}","layout":"row-left","x":1190,"y":380,"wires":[]},{"id":"ca4f484.89460b8","type":"link out","z":"44019beb.1ec4f4","name":"Статус картоприймач","links":["fa8a64b4.49f678","99c979ec.992e48"],"x":435,"y":300,"wires":[]},{"id":"fa8a64b4.49f678","type":"link in","z":"44019beb.1ec4f4","name":"Статус картоприймач","links":["ca4f484.89460b8","ad4fa4dc.28fc28"],"x":855,"y":320,"wires":[["b97d5fc.66e5ea","61f93d22.67f084","f406cd3c.dc1ac"]]},{"id":"b97d5fc.66e5ea","type":"switch","z":"44019beb.1ec4f4","name":"","property":"init","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":970,"y":300,"wires":[["47946ff0.085bc"]]},{"id":"61f93d22.67f084","type":"switch","z":"44019beb.1ec4f4","name":"","property":"positiv_led_on_g","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":970,"y":340,"wires":[["e162a78d.3e9c68"]]},{"id":"f406cd3c.dc1ac","type":"switch","z":"44019beb.1ec4f4","name":"","property":"positiv_card_take","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":970,"y":380,"wires":[["ac0c8016.4829e"]]},{"id":"c4b030a2.da64c","type":"debug","z":"44019beb.1ec4f4","name":"res","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":530,"y":420,"wires":[]},{"id":"1545b0c1.0f00cf","type":"comment","z":"44019beb.1ec4f4","name":"Дашборд","info":"","x":860,"y":220,"wires":[]},{"id":"e038ff31.4b848","type":"ui_template","z":"44019beb.1ec4f4","group":"e7feaeb.de0ae5","name":"","order":4,"width":0,"height":0,"format":"<style>\n    #circle {\n    width: 60px;\n    height: 60px;\n    background: #FFFFE0;\n    -moz-border-radius: 60px;\n    -webkit-border-radius: 60px;\n    border-radius: 60px;\n    }\n    \n</style>\n\n\n<script>\n(function(scope) {\n    // $watch fires each time the node is triggered in the flow\n    scope.$watch('msg', function(msg) {\n            if (msg.color == \"red\") {\n                document.getElementById(\"circle\").style.backgroundColor = \"red\";    \n            }else if(msg.color == \"green\"){\n                document.getElementById(\"circle\").style.backgroundColor = \"green\"; \n            }else if(msg.color == \"orange\"){\n                document.getElementById(\"circle\").style.backgroundColor = \"orange\"; \n            }else if(msg.color == \"gray\"){\n                document.getElementById(\"circle\").style.backgroundColor = \"gray\"; \n            }\n        });\n})(scope);    \n</script>\n\n<div id=\"circle\"></div>\n\n\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1180,"y":420,"wires":[[]]},{"id":"8fe8caf5.9c1638","type":"switch","z":"44019beb.1ec4f4","name":"","property":"color","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":970,"y":420,"wires":[["e038ff31.4b848"]]},{"id":"99c979ec.992e48","type":"link in","z":"44019beb.1ec4f4","name":"Статус картоприймач","links":["ca4f484.89460b8","ad4fa4dc.28fc28"],"x":835,"y":420,"wires":[["8fe8caf5.9c1638"]]},{"id":"596d989f.3ed3c8","type":"delay","z":"44019beb.1ec4f4","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":600,"wires":[["df6c0ed2.880d5"]]},{"id":"ad4fa4dc.28fc28","type":"link out","z":"44019beb.1ec4f4","name":"Узяв карту","links":["fa8a64b4.49f678","99c979ec.992e48"],"x":675,"y":840,"wires":[]},{"id":"cfffe877.eb5c28","type":"switch","z":"44019beb.1ec4f4","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":120,"wires":[["d04aec00.0c0bf8"]]},{"id":"16d7ac8.b8a0854","type":"ui_gauge","z":"44019beb.1ec4f4","name":"","group":"25a5d38.229822c","order":5,"width":0,"height":0,"gtype":"gage","title":"gauge","label":"units","format":"{{value}}","min":0,"max":"30","colors":["#b30000","#e6e600","#4acb3a"],"seg1":"","seg2":"","x":1170,"y":260,"wires":[]},{"id":"3e2ecde2.3a4162","type":"link out","z":"44019beb.1ec4f4","name":"Лічильник","links":["3a8cac0c.637c54"],"x":1195,"y":40,"wires":[]},{"id":"3a8cac0c.637c54","type":"link in","z":"44019beb.1ec4f4","name":"Лічильник","links":["3e2ecde2.3a4162"],"x":855,"y":260,"wires":[["16d7ac8.b8a0854"]]},{"id":"fd9d67f2.806b18","type":"http request","z":"44019beb.1ec4f4","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"www.google.com","tls":"","persist":false,"proxy":"","authType":"","x":1030,"y":760,"wires":[["1df88049.7bb02"]]},{"id":"377497e1.930ab8","type":"inject","z":"44019beb.1ec4f4","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":120,"y":700,"wires":[["df6c0ed2.880d5"]]},{"id":"8181e697.4f6608","type":"comment","z":"44019beb.1ec4f4","name":"Відправка номеру карти","info":"","x":890,"y":720,"wires":[]},{"id":"9ba42297.71add","type":"comment","z":"44019beb.1ec4f4","name":"Включити діод","info":"","x":280,"y":220,"wires":[]},{"id":"23da75e4.c54e8a","type":"function","z":"44019beb.1ec4f4","name":"led_on_o","func":"msg.payload = Buffer.from(\"f20003433533398d\", \"hex\");  \n\nreturn msg;\n","outputs":1,"noerr":0,"x":720,"y":940,"wires":[["18202941.a423d7"]]},{"id":"18202941.a423d7","type":"serial out","z":"44019beb.1ec4f4","name":"","serial":"ecbe105e.26d37","x":910,"y":940,"wires":[]},{"id":"4ec8a4eb.1702bc","type":"comment","z":"44019beb.1ec4f4","name":"Включити діод оранжевого кольору","info":"","x":800,"y":900,"wires":[]},{"id":"11306b0.f62db95","type":"switch","z":"44019beb.1ec4f4","name":"","property":"init","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":110,"y":340,"wires":[["17a85755.ab2b49"]]},{"id":"1bd68aa8.fe4775","type":"switch","z":"44019beb.1ec4f4","name":"","property":"card_take","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":110,"y":660,"wires":[["df6c0ed2.880d5"]]},{"id":"cbc127a2.3d8c58","type":"switch","z":"44019beb.1ec4f4","name":"","property":"led_on_g","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":110,"y":500,"wires":[["94f7f934.12f028"]]},{"id":"b36804c7.4c1bd8","type":"function","z":"44019beb.1ec4f4","name":"","func":"var card = msg.payload;\n    msg.payload = {\n       card: card \n    }\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":760,"wires":[[]]},{"id":"b4e8ff98.ced8","type":"function","z":"44019beb.1ec4f4","name":"led_on_r","func":"\nmsg.payload = Buffer.from(\"f2000343353229ac\", \"hex\");  \n\nreturn msg;\n","outputs":1,"noerr":0,"x":1220,"y":660,"wires":[["783e2b00.056664"]]},{"id":"783e2b00.056664","type":"serial out","z":"44019beb.1ec4f4","name":"","serial":"ecbe105e.26d37","x":1410,"y":660,"wires":[]},{"id":"db4a002f.5e1c7","type":"comment","z":"44019beb.1ec4f4","name":"Помилка, включити червоний","info":"","x":1250,"y":600,"wires":[]},{"id":"2244cd03.3f27e2","type":"comment","z":"44019beb.1ec4f4","name":"Успішно, початок циклу","info":"","x":1250,"y":880,"wires":[]},{"id":"1bf085c6.e0783a","type":"comment","z":"44019beb.1ec4f4","name":"Початок циклу","info":"","x":460,"y":380,"wires":[]},{"id":"1df88049.7bb02","type":"switch","z":"44019beb.1ec4f4","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"str"},{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1190,"y":760,"wires":[["b4e8ff98.ced8"],["fe6c9c30.2b568"]]},{"id":"e3dbdc0.c7a0528","type":"exec","z":"44019beb.1ec4f4","command":"sudo python /home/pi/read-rfid-on-rpi_1.py","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"read rfid","x":120,"y":940,"wires":[["49d24f0c.23f65"],[],[]]},{"id":"49d24f0c.23f65","type":"switch","z":"44019beb.1ec4f4","name":"","property":"rc.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"neq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":920,"wires":[["7ece1835.6c78e8"],["200ef661.5d2f6a"]]},{"id":"200ef661.5d2f6a","type":"delay","z":"44019beb.1ec4f4","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":120,"y":1040,"wires":[["e3dbdc0.c7a0528"]]},{"id":"93ff3dc5.12e0a","type":"ui_text","z":"44019beb.1ec4f4","group":"97b7827e.7903d","order":3,"width":0,"height":0,"name":"","label":"Карта: ","format":"{{msg.payload}}","layout":"row-left","x":1170,"y":460,"wires":[]},{"id":"fe6c9c30.2b568","type":"function","z":"44019beb.1ec4f4","name":"Перемістити карту у контейнер","func":"msg.payload = Buffer.from(\"f20003433331b369\", \"hex\");  \nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":920,"wires":[["72cd5028.f7bda"]]},{"id":"72cd5028.f7bda","type":"serial out","z":"44019beb.1ec4f4","name":"","serial":"ecbe105e.26d37","x":1490,"y":920,"wires":[]},{"id":"60bb93c4.6dab2c","type":"comment","z":"44019beb.1ec4f4","name":"Успішно, початок циклу","info":"","x":770,"y":1000,"wires":[]},{"id":"9c5158e3.871218","type":"function","z":"44019beb.1ec4f4","name":"Перемістити карту у контейнер","func":"msg.payload = Buffer.from(\"f20003433331b369\", \"hex\");  \nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1040,"wires":[["f200801d.e26a5"]]},{"id":"f200801d.e26a5","type":"serial out","z":"44019beb.1ec4f4","name":"","serial":"ecbe105e.26d37","x":1010,"y":1040,"wires":[]},{"id":"707d4529.dbd8dc","type":"link out","z":"44019beb.1ec4f4","name":"Відповіді з картоприймача","links":[],"x":435,"y":200,"wires":[]},{"id":"708a1a27.123f24","type":"link in","z":"929483d2.49f73","name":"Команда Ініціалізація","links":[],"x":115,"y":280,"wires":[["4285b9c8.8674f8"]]},{"id":"62471a49.049594","type":"link in","z":"929483d2.49f73","name":"Команда Включити зелений","links":[],"x":115,"y":400,"wires":[["31c9c6ed.4f175a"]]},{"id":"5e28a49a.6d326c","type":"link in","z":"929483d2.49f73","name":"Команда узяти карту","links":[],"x":115,"y":500,"wires":[["46e610e5.00da2"]]},{"id":"dac58bcd.7990e8","type":"link in","z":"929483d2.49f73","name":"Команда Перемістити карту у контейнер","links":[],"x":115,"y":600,"wires":[["f4b64c6.70f13b"]]},{"id":"4285b9c8.8674f8","type":"function","z":"929483d2.49f73","name":"init","func":"\nmsg.payload = Buffer.from('f2000d43303033323431303031303030f673', 'hex')\n\nflow.set(\"init\", true);\n\nreturn msg;\n                                                           \n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":280,"wires":[["fe9cc9f9.04b5c8"]]},{"id":"31c9c6ed.4f175a","type":"function","z":"929483d2.49f73","name":"led_on_g","func":"\nmsg.payload = Buffer.from(\"f2000343353119cf\", \"hex\");  \n\n\nflow.set(\"led_on_g\", true);\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":400,"wires":[["fe9cc9f9.04b5c8"]]},{"id":"46e610e5.00da2","type":"function","z":"929483d2.49f73","name":"Узяти картку","func":"msg.payload = Buffer.from(\"f20003433a3019d0\", \"hex\");  \n\nflow.set(\"card_take\", true);\nflow.set(\"card_last\", \"\"); \nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":500,"wires":[["fe9cc9f9.04b5c8"]]},{"id":"f4b64c6.70f13b","type":"function","z":"929483d2.49f73","name":"Перемістити карту у контейнер","func":"msg.payload = Buffer.from(\"f20003433331b369\", \"hex\");  \nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":600,"wires":[["fe9cc9f9.04b5c8"]]},{"id":"b03c75d3.a4e1d8","type":"function","z":"929483d2.49f73","name":"led_on_r","func":"\nmsg.payload = Buffer.from(\"f2000343353229ac\", \"hex\");  \n\nreturn msg;\n","outputs":1,"noerr":0,"x":240,"y":720,"wires":[["fe9cc9f9.04b5c8"]]},{"id":"12e177e8.eea588","type":"link in","z":"929483d2.49f73","name":"Команда Включити червоний","links":[],"x":115,"y":720,"wires":[["b03c75d3.a4e1d8"]]},{"id":"468d4ec0.9b942","type":"comment","z":"929483d2.49f73","name":"Ініціалізація","info":"","x":150,"y":220,"wires":[]},{"id":"dd4e1f20.df568","type":"comment","z":"929483d2.49f73","name":"Включити зелений","info":"","x":170,"y":360,"wires":[]},{"id":"b95cf21.a21101","type":"comment","z":"929483d2.49f73","name":"Узяти карту","info":"","x":150,"y":460,"wires":[]},{"id":"e8c7d87c.4ffe48","type":"comment","z":"929483d2.49f73","name":"Перемістити у контейнер","info":"","x":190,"y":560,"wires":[]},{"id":"cea6bfd5.e6b13","type":"comment","z":"929483d2.49f73","name":"Включити червоний","info":"","x":170,"y":680,"wires":[]},{"id":"fe9cc9f9.04b5c8","type":"serial out","z":"929483d2.49f73","name":"","serial":"ecbe105e.26d37","x":930,"y":280,"wires":[]},{"id":"f092128e.4018f","type":"function","z":"929483d2.49f73","name":"led_on_o","func":"msg.payload = Buffer.from(\"f20003433533398d\", \"hex\");  \n\nreturn msg;\n","outputs":1,"noerr":0,"x":240,"y":840,"wires":[["fe9cc9f9.04b5c8"]]},{"id":"b0c64ac2.186928","type":"comment","z":"929483d2.49f73","name":"Включити оранжевий","info":"","x":180,"y":800,"wires":[]},{"id":"e9cae153.53675","type":"link in","z":"929483d2.49f73","name":"Команда Включити оранжевий","links":[],"x":115,"y":840,"wires":[["f092128e.4018f"]]},{"id":"757fb82.5b32348","type":"debug","z":"a9cb9ebe.4b364","name":"res_card_acceptor","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":560,"y":180,"wires":[]},{"id":"b030d43d.a99bb8","type":"serial in","z":"a9cb9ebe.4b364","name":"","serial":"ecbe105e.26d37","x":150,"y":180,"wires":[["3cf64517.e56c1a"]]},{"id":"3cf64517.e56c1a","type":"function","z":"a9cb9ebe.4b364","name":"ascii","func":"var str = msg.payload;\nvar len_str = str.length;\nvar out_str = \"\"\n    for(var i = 0; i < len_str; i++){\n    let str_ascii = String.fromCharCode(str[i]); \n    out_str = out_str + str_ascii;\n    }\n\n\nvar init = flow.get(\"init\");\nvar led_on_g  = flow.get(\"led_on_g\");\nvar card_take = flow.get(\"card_take\");\n\n//var positiv = str.indexOf('P');\nif(init === true){\n    \n  var positiv_init = out_str.indexOf('P');\n    if(positiv_init != -1){\n        msg.init = \"Прилад ініціалізований\";\n        flow.set(\"init\", false);\n    }else{\n        msg.init = \"Прилад не ініціалізований. Переініціалізуйте\" \n    }  \n    \n    \n}else if(led_on_g === true){\n       var positiv_led_on_g = out_str.indexOf('P');\n        if(positiv_led_on_g != -1){\n            msg.positiv_led_on_g = \"Зелений світодіод включений\"\n            msg.color = 'green';\n            flow.set(\"led_on_g\", false);\n        }else{\n            msg.positiv_led_on_g = \"Помилка включення світодіода\"\n            msg.color = 'gray';\n        }  \n    \n    \n    }else if(card_take === true){\n       var positiv_card_take = out_str.indexOf('P');\n        if(positiv_card_take != -1){\n            msg.positiv_card_take = \"Очікуєм карту\";\n            flow.set(\"card_take\", false); \n        }else{\n            msg.positiv_card_take = \"Помилка отримання карти\" \n        }  \n        \n       \n    }\n\n\n    \nmsg.payload = out_str.toString();\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":180,"wires":[["757fb82.5b32348","22ec3bf3.d9ad34","d1037965.93d418","86ec38ae.ec1838","e78d79e5.e11e68","d6ab1f.1c5b34e"]]},{"id":"6475915.fcd547","type":"function","z":"a9cb9ebe.4b364","name":"init","func":"msg.payload = Buffer.from('f2000d43303033323431303031303030f673', 'hex')\nflow.set(\"init\", true);\n\nmsg.message = \"Вставте карту в диспенсер\";\n\nflow.set(\"last_cmd\",\"init\");\nreturn msg;\n                                                           \n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":340,"wires":[["1b03579e.df4bc8","93181f32.ce684","ce7cd129.e8bf8","b6520e33.6b368","bf804daf.eae75"]]},{"id":"d3b943d2.3ccbd","type":"inject","z":"a9cb9ebe.4b364","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":150,"y":400,"wires":[["6475915.fcd547"]]},{"id":"1b03579e.df4bc8","type":"serial out","z":"a9cb9ebe.4b364","name":"","serial":"ecbe105e.26d37","x":610,"y":340,"wires":[]},{"id":"b521fafb.81f3d8","type":"comment","z":"a9cb9ebe.4b364","name":"Ініціалізація роботи при старті системи","info":"","x":220,"y":20,"wires":[]},{"id":"cce1fec5.b9273","type":"function","z":"a9cb9ebe.4b364","name":"Узяти картку для зчитування","func":"msg.payload = Buffer.from(\"f20003433a3019d0\", \"hex\");  \n\nflow.set(\"card_take\", true);\nflow.set(\"card_last\", \"\"); \nflow.set(\"last_cmd\",\"get_card\");\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":860,"wires":[["69ddf220.d1b79c","4796d345.489a8c","f43aab52.449258","28c8e04d.b12d2","7580ca09.dd3de4"]]},{"id":"69ddf220.d1b79c","type":"serial out","z":"a9cb9ebe.4b364","name":"","serial":"ecbe105e.26d37","x":730,"y":860,"wires":[]},{"id":"a21f760e.a43158","type":"function","z":"a9cb9ebe.4b364","name":"led_on_g","func":"msg.payload = Buffer.from(\"f2000343353119cf\", \"hex\");  \nflow.set(\"led_on_g\", true);\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":580,"wires":[["f8b81466.fd32e8","573c467.afb6cb8"]]},{"id":"f8b81466.fd32e8","type":"serial out","z":"a9cb9ebe.4b364","name":"","serial":"ecbe105e.26d37","x":610,"y":580,"wires":[]},{"id":"ce7cd129.e8bf8","type":"delay","z":"a9cb9ebe.4b364","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":140,"y":580,"wires":[["a21f760e.a43158"]]},{"id":"2ba2683b.a1c9d8","type":"comment","z":"a9cb9ebe.4b364","name":"Узяти карту","info":"","x":110,"y":760,"wires":[]},{"id":"4796d345.489a8c","type":"exec","z":"a9cb9ebe.4b364","command":"sudo python /home/pi/read-rfid-on-rpi.py","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"read rfid","x":160,"y":1160,"wires":[["413a8912.c3b848","fbc86e44.1e945"],[],[]]},{"id":"1644a4f5.ca0e5b","type":"function","z":"a9cb9ebe.4b364","name":"","func":"let str = msg.payload;\nlet card_last = flow.get(\"card_last\");\n\nlet arr = str.split('');\nvar array = \"\";\n\nfor (var i = 0; i < arr.length; i++) {\n    \n    if(arr[i] == \")\"){\n       arr[i] = 0;   \n    }else if(arr[i] == \"!\"){\n       arr[i] = 1;    \n    }else if(arr[i] == \"@\"){\n       arr[i] = 2;    \n    }else if(arr[i] == \"#\"){\n       arr[i] = 3;    \n    }else if(arr[i] == \"$\"){\n       arr[i] = 4;    \n    }else if(arr[i] == \"%\"){\n       arr[i] = 5;    \n    }else if(arr[i] == \"^\"){\n       arr[i] = 6;    \n    }else if(arr[i] == \"&\"){\n       arr[i] = 7;    \n    }else if(arr[i] == \"*\"){\n       arr[i] = 8;    \n    }else if(arr[i] == \"(\"){\n       arr[i] = 9;    \n    }\n    \n}\n\nvar correct_str = arr.join(\"\");\n    correct_str = +correct_str;\n    correct_str = correct_str.toString(10)\n    \n  \nif(correct_str != card_last){\n  msg.payload = correct_str;\n  flow.set(\"card_last\", correct_str); \n  flow.set(\"timer\", true);\n  flow.set(\"get_info_from_1c\", false);\n  msg.color = \"orange\"; \n  msg.positiv_led_on_g = \"Оранжевий світодіод включений\";\n  msg.positiv_card_take = \"Карта отримана\";\n  msg.message = \"Ожидайте обработку карты\";\n  return msg;\n}    \n    \n//)))#%!%*^( - 1569\n//0003515869\n// 0: 0x35\n// 1: 0xa5\n// 2: 0xdd\n\n\n\n//)))&)&#%#! - 0802\n//0007073531\n// 0: 107\n// 1: 238\n// 2: 251\n\n// 0: 0x6b\n// 1: 0xee\n// 2: 0xfb","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":1200,"wires":[["78a3b9bd.8023d8","9c75a8ef.b8aae8","67fa601c.ac2da"]]},{"id":"b09b2dc2.e24a","type":"delay","z":"a9cb9ebe.4b364","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":160,"y":1240,"wires":[["4796d345.489a8c"]]},{"id":"78a3b9bd.8023d8","type":"debug","z":"a9cb9ebe.4b364","name":"card_acceptor","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":730,"y":1120,"wires":[]},{"id":"413a8912.c3b848","type":"switch","z":"a9cb9ebe.4b364","name":"","property":"rc.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"neq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":1160,"wires":[["d1b373cb.4c3cc"],["b09b2dc2.e24a","acd565fc.b27258"]]},{"id":"86813b7e.a9acd8","type":"inject","z":"a9cb9ebe.4b364","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":850,"y":120,"wires":[["86f8fc82.ff612"]]},{"id":"86f8fc82.ff612","type":"switch","z":"a9cb9ebe.4b364","name":"","property":"timer","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1010,"y":120,"wires":[["aa45a16.b09786"],[]]},{"id":"aa45a16.b09786","type":"function","z":"a9cb9ebe.4b364","name":"counter","func":"var counter = flow.get(\"counter\");\ncounter = counter - 1;\nflow.set(\"counter\", counter);\n\nif(counter === 0){\n  flow.set(\"timer\", false);\n  flow.set(\"counter\", 31);\n}\nmsg.payload = counter;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1140,"y":120,"wires":[["e8414362.d1363","c6b3dd35.2413e","d4939641.5418a8"]]},{"id":"7f2575e7.74053c","type":"comment","z":"a9cb9ebe.4b364","name":"Робота лічильника","info":"","x":850,"y":60,"wires":[]},{"id":"6833783b.fca6a8","type":"inject","z":"a9cb9ebe.4b364","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"","payloadType":"date","x":170,"y":100,"wires":[["5dcc9662.ff6778"]]},{"id":"4d14228.89b78dc","type":"comment","z":"a9cb9ebe.4b364","name":"Ініціалізація змінних","info":"","x":180,"y":60,"wires":[]},{"id":"5dcc9662.ff6778","type":"function","z":"a9cb9ebe.4b364","name":"","func":"flow.set(\"counter\", 31);\nflow.set(\"timer\", false);\nflow.set(\"card_last\", \"\"); \n//статуси роботи картоприймача\nflow.set(\"init\", false);\nflow.set(\"led_on_g\", false);\nflow.set(\"card_take\", false);\nflow.set(\"get_info_from_1c\", false);\nflow.set(\"send_error\", false);\nflow.set(\"last_cmd\",\"\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":100,"wires":[[]]},{"id":"e8414362.d1363","type":"debug","z":"a9cb9ebe.4b364","name":"timer","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1290,"y":120,"wires":[]},{"id":"23f2392d.db7b66","type":"link in","z":"a9cb9ebe.4b364","name":"Початок циклу лічильник/команда","links":["8864ce8a.00a27","19456652.d14faa"],"x":95,"y":340,"wires":[["6475915.fcd547"]]},{"id":"c759b21a.0e015","type":"link out","z":"a9cb9ebe.4b364","name":"Ініт після лічильника","links":["914a4e1.9f62cb"],"x":1255,"y":160,"wires":[]},{"id":"22ec3bf3.d9ad34","type":"link out","z":"a9cb9ebe.4b364","name":"Статус картоприймач","links":["4dfcaeb5.d87cb","3e0ce4ad.e5a55c"],"x":475,"y":220,"wires":[]},{"id":"27feb0b3.6c9f1","type":"comment","z":"a9cb9ebe.4b364","name":"Дашборд","info":"","x":1020,"y":680,"wires":[]},{"id":"573c467.afb6cb8","type":"delay","z":"a9cb9ebe.4b364","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":140,"y":800,"wires":[["cce1fec5.b9273"]]},{"id":"59b554c6.3b1e0c","type":"link out","z":"a9cb9ebe.4b364","name":"Карту отримав","links":["f0062461.e67fd8","946f84ea.0b1f38"],"x":935,"y":1220,"wires":[]},{"id":"c6b3dd35.2413e","type":"switch","z":"a9cb9ebe.4b364","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":1130,"y":160,"wires":[["c759b21a.0e015"]]},{"id":"d4939641.5418a8","type":"link out","z":"a9cb9ebe.4b364","name":"Лічильник","links":[],"x":1255,"y":80,"wires":[]},{"id":"ef99051b.92c348","type":"comment","z":"a9cb9ebe.4b364","name":"Включити діод","info":"","x":160,"y":500,"wires":[]},{"id":"ca7ebf5c.20bfb","type":"function","z":"a9cb9ebe.4b364","name":"led_on_o","func":"msg.payload = Buffer.from(\"f20003433533398d\", \"hex\");  \n\nreturn msg;\n","outputs":1,"noerr":0,"x":1140,"y":1380,"wires":[["3d6a2e31.dda332"]]},{"id":"3d6a2e31.dda332","type":"serial out","z":"a9cb9ebe.4b364","name":"","serial":"ecbe105e.26d37","x":1310,"y":1380,"wires":[]},{"id":"5edb0d54.40f464","type":"comment","z":"a9cb9ebe.4b364","name":"Включити діод оранжевого кольору","info":"","x":1220,"y":1340,"wires":[]},{"id":"d1037965.93d418","type":"switch","z":"a9cb9ebe.4b364","name":"","property":"init","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":130,"y":300,"wires":[["6475915.fcd547"]]},{"id":"d6ab1f.1c5b34e","type":"switch","z":"a9cb9ebe.4b364","name":"","property":"card_take","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":130,"y":880,"wires":[["cce1fec5.b9273"]]},{"id":"86ec38ae.ec1838","type":"switch","z":"a9cb9ebe.4b364","name":"","property":"led_on_g","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":130,"y":540,"wires":[["a21f760e.a43158"]]},{"id":"97d8a6b.1e07b58","type":"function","z":"a9cb9ebe.4b364","name":"led_on_r","func":"var get_info_from_1c = flow.get(\"get_info_from_1c\");\n\nif(get_info_from_1c === false){\n    flow.set(\"last_cmd\",\"card_false\");\n    msg.payload = Buffer.from(\"f2000343353229ac\", \"hex\");  \n    msg.message = \"Карта не принята. Заберите карту с картоприемника и свяжитесь по горячей линии\";\n    return msg;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1180,"y":1100,"wires":[["106d4b48.158005","8912ac7e.a58b7","a138b87f.daacb8","7975ec19.888bc4"]]},{"id":"106d4b48.158005","type":"serial out","z":"a9cb9ebe.4b364","name":"","serial":"ecbe105e.26d37","x":1440,"y":1100,"wires":[]},{"id":"5489f89b.dde078","type":"comment","z":"a9cb9ebe.4b364","name":"Помилка, включити червоний","info":"","x":1230,"y":940,"wires":[]},{"id":"b69203e5.3692b","type":"comment","z":"a9cb9ebe.4b364","name":"Успішно, початок циклу","info":"","x":1190,"y":1200,"wires":[]},{"id":"b6b8faa9.9028e8","type":"comment","z":"a9cb9ebe.4b364","name":"Початок циклу","info":"","x":140,"y":260,"wires":[]},{"id":"f43aab52.449258","type":"exec","z":"a9cb9ebe.4b364","command":"sudo python /home/pi/read-rfid-on-rpi_1.py","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"read rfid","x":160,"y":1320,"wires":[["4c66f4a8.382c9c","fbc86e44.1e945"],[],[]]},{"id":"4c66f4a8.382c9c","type":"switch","z":"a9cb9ebe.4b364","name":"","property":"rc.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"neq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":1300,"wires":[["d1b373cb.4c3cc"],["a6ff003d.9f08e","acd565fc.b27258"]]},{"id":"a6ff003d.9f08e","type":"delay","z":"a9cb9ebe.4b364","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":160,"y":1420,"wires":[["f43aab52.449258"]]},{"id":"ef6fab69.1ab5b8","type":"function","z":"a9cb9ebe.4b364","name":"Перемістити карту у контейнер","func":"msg.payload = Buffer.from(\"f20003433331b369\", \"hex\");  \n\nmsg.message  = \"Карта принята\";\nmsg.false_1c = false;\nflow.set(\"last_cmd\",\"card_success\");\nflow.set(\"get_info_from_1c\", true);\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":1240,"wires":[["2e2f5479.7c951c","8912ac7e.a58b7","a3a215d1.423b48","72008760.4fa108"]]},{"id":"2e2f5479.7c951c","type":"serial out","z":"a9cb9ebe.4b364","name":"","serial":"ecbe105e.26d37","x":1890,"y":1240,"wires":[]},{"id":"e78d79e5.e11e68","type":"link out","z":"a9cb9ebe.4b364","name":"Відповіді з картоприймача","links":[],"x":475,"y":140,"wires":[]},{"id":"7cb9dd22.194314","type":"link in","z":"a9cb9ebe.4b364","name":"Включити зелений діод","links":[],"x":95,"y":620,"wires":[["a21f760e.a43158"]]},{"id":"3f39557e.d88c8a","type":"link in","z":"a9cb9ebe.4b364","name":"Узяти карту","links":[],"x":95,"y":840,"wires":[["cce1fec5.b9273"]]},{"id":"d6c07dbb.f6251","type":"comment","z":"a9cb9ebe.4b364","name":"Команди від картоприймача","info":"","x":180,"y":140,"wires":[]},{"id":"93479c7a.e7c7f","type":"comment","z":"a9cb9ebe.4b364","name":"Активація зчитування карти","info":"","x":200,"y":1100,"wires":[]},{"id":"c677f404.c01138","type":"comment","z":"a9cb9ebe.4b364","name":"При отримані карти ДІЯ","info":"","x":570,"y":1160,"wires":[]},{"id":"914a4e1.9f62cb","type":"link in","z":"a9cb9ebe.4b364","name":"Включити червоний","links":["c759b21a.0e015"],"x":1035,"y":1100,"wires":[["97d8a6b.1e07b58"]]},{"id":"64931114.4adb9","type":"link in","z":"a9cb9ebe.4b364","name":"Перемістити карту у контейнер","links":["726ec143.e93e8","897ae9cf.8aae88"],"x":1035,"y":1240,"wires":[["ef6fab69.1ab5b8","a8576f04.6bcf4"]]},{"id":"102c8577.6a837b","type":"link in","z":"a9cb9ebe.4b364","name":"Включити діод оранжевого кольору","links":[],"x":1035,"y":1380,"wires":[["ca7ebf5c.20bfb"]]},{"id":"c4057099.7c5c","type":"ui_template","z":"a9cb9ebe.4b364","group":"97b7827e.7903d","name":"","order":0,"width":"8","height":"9","format":"<style>\n   p.dline {\n    line-height: 1.2;\n    font-size:42px;\n    font-weight:bold;\n   }\n \n \n</style>\n\n<p class=\"dline\" ng-bind-html=\"msg.message\"></p>\n\n\n\n\n\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1100,"y":780,"wires":[[]]},{"id":"ecdfd0c7.7a1a4","type":"link in","z":"a9cb9ebe.4b364","name":"Дашборд","links":["8912ac7e.a58b7","93181f32.ce684","e768e53c.823828"],"x":935,"y":780,"wires":[["c4057099.7c5c","54700300.d9066c"]]},{"id":"8912ac7e.a58b7","type":"link out","z":"a9cb9ebe.4b364","name":"Дашборд Інформація","links":["ecdfd0c7.7a1a4"],"x":1355,"y":1160,"wires":[]},{"id":"54700300.d9066c","type":"debug","z":"a9cb9ebe.4b364","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1090,"y":840,"wires":[]},{"id":"fbd09482.4bfdf8","type":"function","z":"a143ae81.213c6","name":"","func":"msg.payload = '00001'\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":100,"wires":[["2a03e068.1b939"]]},{"id":"f0062461.e67fd8","type":"link in","z":"a143ae81.213c6","name":"1С выезд","links":["59b554c6.3b1e0c"],"x":295,"y":60,"wires":[["2a03e068.1b939","d3358f6e.4e7c2"]]},{"id":"3090dc89.2dbaf4","type":"function","z":"a143ae81.213c6","name":"","func":"var ndata = {};\nvar pl = msg.payload;\nndata.response = pl[\"soap:Envelope\"][\"soap:Body\"][0][\"m:CheckInResponse\"][0][\"m:return\"][0];\nndata.TransportID = ndata.response.TransportID[0][\"_\"];\nmsg.payload = ndata;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":100,"wires":[["d693b51d.815428","99643b59.895b98"]]},{"id":"d693b51d.815428","type":"switch","z":"a143ae81.213c6","name":"","property":"payload.TransportID","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"neq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1070,"y":100,"wires":[["b54a1a0e.a53c98","d345f884.57d508"],["726ec143.e93e8","204f2c98.a7d964"]]},{"id":"726ec143.e93e8","type":"link out","z":"a143ae81.213c6","name":"1C response OK","links":["64931114.4adb9"],"x":1155,"y":140,"wires":[]},{"id":"2b9194a1.9453bc","type":"debug","z":"a143ae81.213c6","name":"res_2_1C","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":890,"y":40,"wires":[]},{"id":"d3358f6e.4e7c2","type":"debug","z":"a143ae81.213c6","name":"card_2_in","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":440,"y":40,"wires":[]},{"id":"56987928.3e6668","type":"inject","z":"a9cb9ebe.4b364","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":")()((**&^","payloadType":"str","x":500,"y":1040,"wires":[["1644a4f5.ca0e5b"]]},{"id":"8864ce8a.00a27","type":"link out","z":"a9cb9ebe.4b364","name":"Видати карту після помилки/ініціалізація цикл","links":["23f2392d.db7b66"],"x":1615,"y":1160,"wires":[]},{"id":"504c112b.a3262","type":"inject","z":"a9cb9ebe.4b364","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":")()((**(((","payloadType":"str","x":510,"y":1000,"wires":[["1644a4f5.ca0e5b"]]},{"id":"a138b87f.daacb8","type":"debug","z":"a9cb9ebe.4b364","name":"card","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1550,"y":1120,"wires":[]},{"id":"a8576f04.6bcf4","type":"debug","z":"a9cb9ebe.4b364","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1150,"y":1280,"wires":[]},{"id":"93181f32.ce684","type":"link out","z":"a9cb9ebe.4b364","name":"очікування карти","links":["ecdfd0c7.7a1a4"],"x":555,"y":380,"wires":[]},{"id":"e768e53c.823828","type":"link out","z":"a9cb9ebe.4b364","name":"Обробка даних","links":["ecdfd0c7.7a1a4"],"x":935,"y":1180,"wires":[]},{"id":"b54a1a0e.a53c98","type":"link out","z":"a143ae81.213c6","name":"1C response FALSE","links":["33eb830.8d9f77e"],"x":1155,"y":80,"wires":[]},{"id":"33eb830.8d9f77e","type":"link in","z":"a9cb9ebe.4b364","name":"Помилка 1С, вернути карту","links":["b54a1a0e.a53c98","c50bee80.0c4d7"],"x":1035,"y":1040,"wires":[["ff28d7b6.ea3dc8"]]},{"id":"ff28d7b6.ea3dc8","type":"function","z":"a9cb9ebe.4b364","name":"Получили false 1C","func":"flow.set(\"get_info_from_1c\",false);\nflow.set(\"timer\",false);\nflow.set(\"card_take\",false);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1180,"y":1040,"wires":[["97d8a6b.1e07b58"]]},{"id":"d345f884.57d508","type":"debug","z":"a143ae81.213c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1270,"y":20,"wires":[]},{"id":"204f2c98.a7d964","type":"debug","z":"a143ae81.213c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1280,"y":220,"wires":[]},{"id":"28c8e04d.b12d2","type":"debug","z":"a9cb9ebe.4b364","name":"take_card","active":false,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":740,"y":740,"wires":[]},{"id":"9c75a8ef.b8aae8","type":"switch","z":"a9cb9ebe.4b364","name":"","property":"last_cmd","propertyType":"flow","rules":[{"t":"eq","v":"get_card","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":830,"y":1200,"wires":[["59b554c6.3b1e0c","e768e53c.823828"]]},{"id":"78936a6e.db3304","type":"serial out","z":"a9cb9ebe.4b364","name":"","serial":"ecbe105e.26d37","x":2220,"y":1040,"wires":[]},{"id":"7975ec19.888bc4","type":"delay","z":"a9cb9ebe.4b364","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1420,"y":1040,"wires":[["675f42a9.32850c","73bc6e36.1037a"]]},{"id":"675f42a9.32850c","type":"delay","z":"a9cb9ebe.4b364","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1820,"y":960,"wires":[["19456652.d14faa"]]},{"id":"19456652.d14faa","type":"link out","z":"a9cb9ebe.4b364","name":"Карту не забрали после ошибки 1с","links":["23f2392d.db7b66"],"x":1935,"y":960,"wires":[]},{"id":"86ab2afc.358ef8","type":"serial out","z":"929483d2.49f73","name":"","serial":"beafc7de.e185c8","x":1490,"y":480,"wires":[]},{"id":"23e59238.9ee0ce","type":"debug","z":"929483d2.49f73","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1490,"y":540,"wires":[]},{"id":"db883efd.b220f","type":"inject","z":"929483d2.49f73","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":980,"y":440,"wires":[["ed8ed22b.d876f"]]},{"id":"ed8ed22b.d876f","type":"function","z":"929483d2.49f73","name":"led_of","func":"//msg.payload = \"C003241001000\";\n\n                                                        //31 включити\nvar cmd = String.fromCharCode(0xf2,0x00,0x03,0x43,0x35,0x30);\n    \n msg.payload = Buffer.from(\"f2000343353009ee\", \"hex\");  \n\nreturn msg;\n//String.fromCharCode(65, 66, 67);\n//Buffer.from('33323431303031303030', 'hex')\n//String.fromCharCode(f2,00,03,43,35,31,19,cf);\n/*\nf2000343353119cf\nPlease use “$” before the each Hex character.\nIt is also possible to enter “C003241001000”\n\n*/","outputs":1,"noerr":0,"x":1130,"y":440,"wires":[["86ab2afc.358ef8"]]},{"id":"16108041.16ded","type":"function","z":"929483d2.49f73","name":"init","func":"/*\nmsg.payload = \nString.fromCharCode(0xf2, 0x00, 0x0d, 0x43, 0x30, 0x30, 0x33, \n0x32, 0x34, 0x31, 0x30, 0x30, 0x31, 0x30, 0x30, 0x30, 0xf6, 0x73);\n*/\n\nmsg.payload = Buffer.from('f2000d43303033323431303031303030f673', 'hex')\n\n//msg.payload = cmd;\nreturn msg;\n//String.fromCharCode(65, 66, 67);\n//Buffer.from('f2000d43303033323431303031303030f673', 'hex')\n//String.fromCharCode(f2,00,03,43,35,31,19,cf);\n/*\n    f2000d43303033323431303031303030f673                                                            \n\n\n*/","outputs":1,"noerr":0,"x":1130,"y":480,"wires":[["86ab2afc.358ef8","23e59238.9ee0ce"]]},{"id":"a7fd22b9.1e1d1","type":"inject","z":"929483d2.49f73","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":980,"y":480,"wires":[["16108041.16ded"]]},{"id":"2f602d3d.ec4e02","type":"inject","z":"929483d2.49f73","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":980,"y":520,"wires":[["aeb1244c.aa2de8"]]},{"id":"aeb1244c.aa2de8","type":"function","z":"929483d2.49f73","name":"led_on_g","func":"//msg.payload = \"C003241001000\";\n\n                                                        //31 включити\nvar cmd = String.fromCharCode(0xf2,0x00,0x03,0x43,0x35,0x30);\n    \n msg.payload = Buffer.from(\"f2000343353119cf\", \"hex\");  \n\nreturn msg;\n//String.fromCharCode(65, 66, 67);\n//Buffer.from('33323431303031303030', 'hex')\n//String.fromCharCode(f2,00,03,43,35,31,19,cf);\n/*\nf2000343353119cf\nPlease use “$” before the each Hex character.\nIt is also possible to enter “C003241001000”\n\n*/","outputs":1,"noerr":0,"x":1143,"y":519.0000038146973,"wires":[["86ab2afc.358ef8"]]},{"id":"1e48f940.151817","type":"inject","z":"929483d2.49f73","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":980,"y":679.0000038146973,"wires":[["20b78721.7b4cc8"]]},{"id":"20b78721.7b4cc8","type":"function","z":"929483d2.49f73","name":"Status","func":"//P1102 - є каоточка\n//P1100 - немає карточки\n//P1101 - карточку треба достати\nmsg.payload = Buffer.from(\"f20003433131D50B\", \"hex\");  \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1130,"y":679.0000038146973,"wires":[["86ab2afc.358ef8"]]},{"id":"ac467925.c5ea18","type":"inject","z":"929483d2.49f73","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":980,"y":719.9999732971191,"wires":[["c334f89f.c74c98"]]},{"id":"c334f89f.c74c98","type":"function","z":"929483d2.49f73","name":"Status 30","func":"        \n  \nmsg.payload = Buffer.from(\"f20003433130c52a\", \"hex\");  \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1140,"y":719.9999732971191,"wires":[["86ab2afc.358ef8"]]},{"id":"d09b3d80.027b5","type":"inject","z":"929483d2.49f73","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":980,"y":759.9999732971191,"wires":[["743f20cf.ad9a7"]]},{"id":"743f20cf.ad9a7","type":"function","z":"929483d2.49f73","name":"Узяти картку","func":"        \n  \nmsg.payload = Buffer.from(\"f20003433a3019d0\", \"hex\");  \n\nreturn msg;\n","outputs":1,"noerr":0,"x":1150,"y":759.9999732971191,"wires":[["86ab2afc.358ef8"]]},{"id":"6ce6b391.19121c","type":"inject","z":"929483d2.49f73","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":980,"y":800.9999732971191,"wires":[["ee4813ed.34d17"]]},{"id":"ee4813ed.34d17","type":"function","z":"929483d2.49f73","name":"Прочитати","func":"\n  \nmsg.payload = Buffer.from(\"f200034336350c18\", \"hex\");  \n\nreturn msg;\n","outputs":1,"noerr":0,"x":1150,"y":800.9999732971191,"wires":[["86ab2afc.358ef8"]]},{"id":"49445798.8c28a8","type":"inject","z":"929483d2.49f73","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":979,"y":841.9999732971191,"wires":[["dd45dcf4.b6505"]]},{"id":"dd45dcf4.b6505","type":"function","z":"929483d2.49f73","name":"Видати картку","func":"//    f2 00 03 43 33 30 a3 48                           т..C30ЈH         \n\n  \nmsg.payload = Buffer.from(\"f20003433330a348\", \"hex\");  \n\nreturn msg;\n","outputs":1,"noerr":0,"x":1159,"y":841.9999732971191,"wires":[["86ab2afc.358ef8"]]},{"id":"a180926b.6125e","type":"inject","z":"929483d2.49f73","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":978.7142791748047,"y":558.4285621643066,"wires":[["8b1b4ff0.31632"]]},{"id":"8b1b4ff0.31632","type":"function","z":"929483d2.49f73","name":"led_on_r","func":"\nmsg.payload = Buffer.from(\"f2000343353229ac\", \"hex\");  \n\nreturn msg;\n","outputs":1,"noerr":0,"x":1141.7142791748047,"y":557.4285659790039,"wires":[["86ab2afc.358ef8"]]},{"id":"d0a1b7f4.a45c78","type":"inject","z":"929483d2.49f73","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":974.7142791748047,"y":592.4285621643066,"wires":[["9e74df8b.fda01"]]},{"id":"9e74df8b.fda01","type":"function","z":"929483d2.49f73","name":"led_on_o","func":"msg.payload = Buffer.from(\"f20003433533398d\", \"hex\");  \n\nreturn msg;\n","outputs":1,"noerr":0,"x":1137.7142791748047,"y":591.4285659790039,"wires":[["86ab2afc.358ef8"]]},{"id":"61d76113.fb8e8","type":"inject","z":"a9cb9ebe.4b364","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":680,"y":260,"wires":[["6475915.fcd547"]]},{"id":"a3a215d1.423b48","type":"delay","z":"a9cb9ebe.4b364","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1480,"y":1160,"wires":[["8864ce8a.00a27"]]},{"id":"52d550fd.6a64c","type":"rpi-gpio out","z":"a9cb9ebe.4b364","name":"Выезд","pin":"37","set":"","level":"0","freq":"","out":"out","x":1310,"y":380,"wires":[]},{"id":"45efe44.97cde1c","type":"function","z":"a9cb9ebe.4b364","name":"красный","func":"msg.payload = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":380,"wires":[["52d550fd.6a64c"]]},{"id":"29944808.461be8","type":"function","z":"a9cb9ebe.4b364","name":"зеленый","func":"msg.payload = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":440,"wires":[["52d550fd.6a64c"]]},{"id":"1b774c24.5b4584","type":"link in","z":"a9cb9ebe.4b364","name":"Выезд красный","links":["b6520e33.6b368"],"x":935,"y":380,"wires":[["45efe44.97cde1c"]]},{"id":"e9a43ee1.1022c","type":"link in","z":"a9cb9ebe.4b364","name":"Выезд зеленый","links":["72008760.4fa108"],"x":935,"y":440,"wires":[["29944808.461be8"]]},{"id":"b6520e33.6b368","type":"link out","z":"a9cb9ebe.4b364","name":"Инит включить красный","links":["1b774c24.5b4584"],"x":555,"y":420,"wires":[]},{"id":"72008760.4fa108","type":"link out","z":"a9cb9ebe.4b364","name":"ответ 1с включить зеленый","links":["e9a43ee1.1022c"],"x":1425,"y":1300,"wires":[]},{"id":"b17923a6.bd2f8","type":"comment","z":"a9cb9ebe.4b364","name":"Светлофор","info":"","x":1010,"y":320,"wires":[]},{"id":"ac7ad48e.bafa38","type":"http request","z":"a9cb9ebe.4b364","name":"Выезд кабина","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.10.180/ISAPI/Streaming/channels/1/picture","tls":"","persist":false,"proxy":"","authType":"basic","x":240,"y":1680,"wires":[["ac5adeb0.ca8a3"]]},{"id":"c33631a4.a9af2","type":"comment","z":"a9cb9ebe.4b364","name":"Видеокамеры","info":"","x":160,"y":1540,"wires":[]},{"id":"edc974a2.dc8248","type":"link in","z":"a9cb9ebe.4b364","name":"Сделать снимок Выезд кабина","links":[],"x":75,"y":1680,"wires":[["ac7ad48e.bafa38"]]},{"id":"6b8fd413.d0a33c","type":"http request","z":"a9cb9ebe.4b364","name":"Выезд кузов","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.10.181/ISAPI/Streaming/channels/1/picture","tls":"","persist":false,"proxy":"","authType":"basic","x":230,"y":1740,"wires":[["960a9d27.78139"]]},{"id":"960a9d27.78139","type":"debug","z":"a9cb9ebe.4b364","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":410,"y":1740,"wires":[]},{"id":"e9580629.d10be8","type":"link in","z":"a9cb9ebe.4b364","name":"Сделать снимок Выезд кузов","links":[],"x":75,"y":1740,"wires":[["6b8fd413.d0a33c"]]},{"id":"3881af9b.234d2","type":"http request","z":"a9cb9ebe.4b364","name":"Въезд кузов","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.10.182/ISAPI/Streaming/channels/1/picture","tls":"","persist":false,"proxy":"","authType":"basic","x":230,"y":1840,"wires":[["c92596b9.6592b8"]]},{"id":"c92596b9.6592b8","type":"debug","z":"a9cb9ebe.4b364","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":430,"y":1840,"wires":[]},{"id":"bae5b896.c90ce8","type":"link in","z":"a9cb9ebe.4b364","name":"Сделать снимок Въезд кузов","links":[],"x":75,"y":1840,"wires":[["3881af9b.234d2"]]},{"id":"6993b58c.02251c","type":"http request","z":"a9cb9ebe.4b364","name":"Въезд кабина","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.10.183/ISAPI/Streaming/channels/1/picture","tls":"","persist":false,"proxy":"","authType":"basic","x":240,"y":1900,"wires":[["2dea0b84.1a8ec4"]]},{"id":"2dea0b84.1a8ec4","type":"debug","z":"a9cb9ebe.4b364","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":430,"y":1900,"wires":[]},{"id":"114832ab.5214ed","type":"link in","z":"a9cb9ebe.4b364","name":"Сделать снимок Выезд кабина","links":[],"x":75,"y":1900,"wires":[["6993b58c.02251c"]]},{"id":"ac5adeb0.ca8a3","type":"SMB","z":"a9cb9ebe.4b364","name":"","config":"219c6386.a1895c","operation":"create","path":"myfile.jpeg","path_new":"","format":"string","x":470,"y":1680,"wires":[["1f4e9ef2.88f161"]]},{"id":"1f4e9ef2.88f161","type":"debug","z":"a9cb9ebe.4b364","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":710,"y":1600,"wires":[]},{"id":"a6e77eed.e28a6","type":"serial in","z":"d89b76b5.c78b58","name":"","serial":"7b8f6cda.1e8604","x":110,"y":40,"wires":[["c4b297b6.cfc2f8","f6614b6a.8ae048"]]},{"id":"acd565fc.b27258","type":"debug","z":"a9cb9ebe.4b364","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":580,"y":1320,"wires":[]},{"id":"fbc86e44.1e945","type":"debug","z":"a9cb9ebe.4b364","name":"Rfid_card","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":360,"y":1380,"wires":[]},{"id":"88d54281.8f25c","type":"inject","z":"a9cb9ebe.4b364","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":980,"wires":[["ff28d7b6.ea3dc8"]]},{"id":"29f21a5.03508e6","type":"http request","z":"a143ae81.213c6","name":"","method":"POST","ret":"txt","paytoqs":"body","url":"http://192.168.10.5/acc-tis/ws/Checkpoints","tls":"","persist":false,"proxy":"","authType":"basic","x":630,"y":380,"wires":[["acb78dfa.389ac"]]},{"id":"f50a5279.a2b8c","type":"template","z":"a143ae81.213c6","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<soap:Envelope xmlns:soap=\"http://www.w3.org/2003/05/soap-envelope\" xmlns:chec=\"Checkpoints\">\n   <soap:Header/>\n   <soap:Body>\n      <chec:CheckIn>\n         <chec:DirverCardID>{{payload}}</chec:DirverCardID>\n         <chec:PhotoPathFront></chec:PhotoPathFront>\n         <chec:PhotoPathBack></chec:PhotoPathBack>\n         <chec:PointID>1</chec:PointID>\n      </chec:CheckIn>\n   </soap:Body>\n</soap:Envelope>","output":"str","x":460,"y":380,"wires":[["29f21a5.03508e6"]]},{"id":"a54f5ea6.0f5db","type":"inject","z":"a143ae81.213c6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":380,"wires":[["41458898.ee2bd8"]]},{"id":"acb78dfa.389ac","type":"xml","z":"a143ae81.213c6","name":"","property":"payload","attr":"","chr":"","x":790,"y":380,"wires":[["20c5d9ec.beb876"]]},{"id":"a1e5bb50.98f3f8","type":"comment","z":"a143ae81.213c6","name":"1C Въезд","info":"","x":130,"y":320,"wires":[]},{"id":"41458898.ee2bd8","type":"function","z":"a143ae81.213c6","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":380,"wires":[["f50a5279.a2b8c"]]},{"id":"946f84ea.0b1f38","type":"link in","z":"a143ae81.213c6","name":"1С Въезд","links":["59b554c6.3b1e0c","94a51f76.ce8f5"],"x":315,"y":340,"wires":[["f50a5279.a2b8c","81a814e7.b1b688"]]},{"id":"20c5d9ec.beb876","type":"function","z":"a143ae81.213c6","name":"","func":"var ndata = {};\nvar pl = msg.payload;\nndata.response = pl[\"soap:Envelope\"][\"soap:Body\"][0][\"m:CheckInResponse\"][0][\"m:return\"][0];\nndata.TransportID = ndata.response.TransportID[0][\"_\"];\nmsg.payload = ndata;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":380,"wires":[["4e3513f5.eff43c","89a5312c.94b07"]]},{"id":"4e3513f5.eff43c","type":"switch","z":"a143ae81.213c6","name":"","property":"payload.TransportID","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"neq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1090,"y":380,"wires":[["256818c4.721858","806460f1.86475"],["f0bb0821.c06238","700ada3b.5f58f4","57d5f45b.579b4c"]]},{"id":"7b4b2b78.8e1a54","type":"debug","z":"a143ae81.213c6","name":"res_1C","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":880,"y":320,"wires":[]},{"id":"81a814e7.b1b688","type":"debug","z":"a143ae81.213c6","name":"card in","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":460,"y":320,"wires":[]},{"id":"256818c4.721858","type":"debug","z":"a143ae81.213c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1290,"y":300,"wires":[]},{"id":"f0bb0821.c06238","type":"debug","z":"a143ae81.213c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1290,"y":560,"wires":[]},{"id":"21375549.c3b30a","type":"rpi-gpio out","z":"d89b76b5.c78b58","name":"Въезд","pin":"38","set":"","level":"0","freq":"","out":"out","x":390,"y":200,"wires":[]},{"id":"a1b2b1ac.f27b1","type":"function","z":"d89b76b5.c78b58","name":"красный","func":"msg.payload = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":220,"y":200,"wires":[["21375549.c3b30a"]]},{"id":"ee89f2dc.2a22b","type":"function","z":"d89b76b5.c78b58","name":"зеленый","func":"msg.payload = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":220,"y":260,"wires":[["21375549.c3b30a"]]},{"id":"81d7ef9e.573ea","type":"link in","z":"d89b76b5.c78b58","name":"Въезд красный","links":["806460f1.86475"],"x":55,"y":200,"wires":[["a1b2b1ac.f27b1"]]},{"id":"a93e798d.176808","type":"link in","z":"d89b76b5.c78b58","name":"Въезд зеленый","links":["700ada3b.5f58f4"],"x":55,"y":260,"wires":[["ee89f2dc.2a22b"]]},{"id":"c4b297b6.cfc2f8","type":"function","z":"d89b76b5.c78b58","name":"hex to dec","func":"var buffer = msg.payload;\nvar b1 = buffer[0].toString(\"16\");\nvar b2 = buffer[1].toString(\"16\");\nvar b3 = buffer[2].toString(\"16\");\n\n\n//var number = buffer[0].toString(\"16\") + buffer[1].toString(\"16\") + buffer[2].toString(\"16\");\nif(b1.length == 1){\n   b1 = \"0\" + b1; \n}\nif(b2.length == 1){\n   b2 = \"0\" + b2; \n}\nif(b3.length == 1){\n   b3 = \"0\" + b3; \n}\n\n\nvar number = b1 + b2 + b3;\n\nvar dec = parseInt(number,16).toString();\nmsg.payload = dec;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":40,"wires":[["94a51f76.ce8f5","c8a1544a.debf78"]]},{"id":"94a51f76.ce8f5","type":"link out","z":"d89b76b5.c78b58","name":"Зовн РФИД","links":["946f84ea.0b1f38"],"x":445,"y":40,"wires":[]},{"id":"700ada3b.5f58f4","type":"link out","z":"a143ae81.213c6","name":"1С въезд ответ Истина","links":["a93e798d.176808"],"x":1235,"y":420,"wires":[]},{"id":"806460f1.86475","type":"link out","z":"a143ae81.213c6","name":"1С въезд ответ Ложь","links":["81d7ef9e.573ea"],"x":1235,"y":360,"wires":[]},{"id":"57d5f45b.579b4c","type":"delay","z":"a143ae81.213c6","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1280,"y":480,"wires":[["806460f1.86475"]]},{"id":"7580ca09.dd3de4","type":"exec","z":"a9cb9ebe.4b364","command":"sudo python /home/pi/read-rfid-on-rpi_2.py","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"read rfid","x":160,"y":1480,"wires":[["cdb3b7f2.dfcde8","fbc86e44.1e945"],[],[]]},{"id":"cdb3b7f2.dfcde8","type":"switch","z":"a9cb9ebe.4b364","name":"","property":"rc.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"neq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":1460,"wires":[["acd565fc.b27258","d1b373cb.4c3cc"],["caccfce6.34ed6"]]},{"id":"caccfce6.34ed6","type":"delay","z":"a9cb9ebe.4b364","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":160,"y":1600,"wires":[["7580ca09.dd3de4"]]},{"id":"8fdd2ddb.40f41","type":"inject","z":"11b78381.90926c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":180,"wires":[["d0ce41d.813e1c"]]},{"id":"b9d724.cc1bb8e","type":"debug","z":"11b78381.90926c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1130,"y":200,"wires":[]},{"id":"3f2171a.296288e","type":"exec","z":"11b78381.90926c","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":410,"y":220,"wires":[["e31a0d75.c548c","844d2234.64376"],[],[]]},{"id":"d0ce41d.813e1c","type":"function","z":"11b78381.90926c","name":"","func":"//перевіряєм чи є папка у у розшареному каталозі\nmsg.payload = \"ls /mnt/winshare\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":180,"wires":[["3f2171a.296288e"]]},{"id":"a821794e.16f8e8","type":"inject","z":"11b78381.90926c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":340,"wires":[["276d3305.5a8c9c"]]},{"id":"276d3305.5a8c9c","type":"function","z":"11b78381.90926c","name":"","func":"function formatDate(date) {\n    var d = new Date(date),\n        month = '' + (d.getMonth() + 1),\n        day = '' + d.getDate(),\n        year = d.getFullYear(),\n        hours = d.getHours() + 3,\n        minutes= d.getMinutes(),\n        seconds = d.getSeconds();\n        \n\n    if (month.length < 2) \n        month = '0' + month;\n    if (day.length < 2) \n        day = '0' + day ;\n    if (hours.length < 2) \n        hours = '0' + hours;\n    if (minutes.length < 2) \n        minutes = '0' + minutes;\n    \n    //day = 11;\n    return [year,month,day].join('-');\n}\n\n        var time_in  = formatDate(msg.payload);\n        var time_out = new Date(msg.payload);\n        \nmsg.payload = time_in;\n\nflow.set(\"time_in\", time_in);\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":340,"wires":[["7ea323e4.5fb8dc"]]},{"id":"7ea323e4.5fb8dc","type":"debug","z":"11b78381.90926c","name":"req","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":430,"y":340,"wires":[]},{"id":"e31a0d75.c548c","type":"function","z":"11b78381.90926c","name":"","func":"//перевіряєм чи є каталог у дані папці що примонтували\n\nvar result = msg.payload;\nvar date_today = flow.get(\"time_in\");//шукає даний каталог у мережевому каталозі\n\nvar enter = String.fromCharCode(10);\nvar arra_dir = result.split(enter);//масив файлів у мережевому каталозі\n\nfor (var i = 0; i < arra_dir.length; i++) {\n     if(arra_dir[i] == date_today){\n            msg.payload = \"is\";\n            break;\n        }else{\n            msg.payload = \"not\";\n        }\n}\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":220,"wires":[["db95d8e7.8916d8","2c6af897.4f5db8"]]},{"id":"844d2234.64376","type":"debug","z":"11b78381.90926c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":550,"y":180,"wires":[]},{"id":"2c6af897.4f5db8","type":"debug","z":"11b78381.90926c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":650,"y":280,"wires":[]},{"id":"db95d8e7.8916d8","type":"switch","z":"11b78381.90926c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"not","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":690,"y":220,"wires":[["2bca06bf.59e6fa"]]},{"id":"af1d3cb2.15b0d","type":"exec","z":"11b78381.90926c","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":970,"y":220,"wires":[["b9d724.cc1bb8e"],[],[]]},{"id":"2bca06bf.59e6fa","type":"function","z":"11b78381.90926c","name":"","func":"//cтворюєм каталог у vережеві папці\nvar date_today = flow.get(\"time_in\");//каталог який створюєм\nvar dir = \"/mnt/winshare\";//мережевий каталог\nmsg.payload = \"sudo mkdir \" + dir + \"/\" + date_today;\nmsg.dir = \"/mnt/winshare\" + \"/\" + date_today;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":220,"wires":[["dece9cb4.54fb1","af1d3cb2.15b0d"]]},{"id":"dece9cb4.54fb1","type":"debug","z":"11b78381.90926c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":830,"y":280,"wires":[]},{"id":"85d37af0.97c468","type":"comment","z":"11b78381.90926c","name":"Сьогоднішня дата","info":"","x":130,"y":300,"wires":[]},{"id":"90e61676.7a95f8","type":"http request","z":"11b78381.90926c","name":"Выезд кабина","method":"GET","ret":"bin","paytoqs":"ignore","url":"http://192.168.10.180/ISAPI/Streaming/channels/1/picture","tls":"","persist":false,"proxy":"","authType":"basic","x":300,"y":600,"wires":[["d5852946.c0baa8"]]},{"id":"b50cdce7.75331","type":"http request","z":"11b78381.90926c","name":"Выезд кузов","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.10.181/ISAPI/Streaming/channels/1/picture","tls":"","persist":false,"proxy":"","authType":"basic","x":290,"y":660,"wires":[["5397f8af.19c8c8"]]},{"id":"16b53067.a91b2","type":"http request","z":"11b78381.90926c","name":"Въезд кузов","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.10.182/ISAPI/Streaming/channels/1/picture","tls":"","persist":false,"proxy":"","authType":"basic","x":290,"y":740,"wires":[["519335f7.64374c"]]},{"id":"fffbfab8.8493c8","type":"http request","z":"11b78381.90926c","name":"Въезд кабина","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.10.183/ISAPI/Streaming/channels/1/picture","tls":"","persist":false,"proxy":"","authType":"basic","x":300,"y":800,"wires":[["55327f79.a44ff"]]},{"id":"55327f79.a44ff","type":"debug","z":"11b78381.90926c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":490,"y":800,"wires":[]},{"id":"519335f7.64374c","type":"debug","z":"11b78381.90926c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":490,"y":740,"wires":[]},{"id":"5397f8af.19c8c8","type":"debug","z":"11b78381.90926c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":660,"wires":[]},{"id":"2310f6f2.dd2b5a","type":"inject","z":"11b78381.90926c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":600,"wires":[["90e61676.7a95f8"]]},{"id":"7256dce9.49ab84","type":"inject","z":"11b78381.90926c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":660,"wires":[["b50cdce7.75331"]]},{"id":"9053ee74.f0ef9","type":"inject","z":"11b78381.90926c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":740,"wires":[["16b53067.a91b2"]]},{"id":"4d710260.8969ec","type":"inject","z":"11b78381.90926c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":800,"wires":[["fffbfab8.8493c8"]]},{"id":"104ea9bc.25a836","type":"comment","z":"11b78381.90926c","name":"Камери","info":".jpeg\n\n\nhttp://admin:ITSLog_1@192.168.10.180/ISAPI/Streaming/channels/1/picture\n\nhttp://admin:ITSLog_1@192.168.10.181/ISAPI/Streaming/channels/1/picture\n\nhttp://admin:ITSLog_1@192.168.10.182/ISAPI/Streaming/channels/1/picture\n\nhttp://admin:ITSLog_1@192.168.10.183/ISAPI/Streaming/channels/1/picture","x":90,"y":520,"wires":[]},{"id":"d5852946.c0baa8","type":"base64","z":"11b78381.90926c","name":"","action":"","property":"payload","x":360,"y":540,"wires":[["4f249071.0514c"]]},{"id":"c22d758c.3e72e8","type":"file","z":"11b78381.90926c","name":"","filename":"","appendNewline":true,"createDir":true,"overwriteFile":"false","encoding":"none","x":610,"y":560,"wires":[["51cbebd1.2cd084"]]},{"id":"4f249071.0514c","type":"function","z":"11b78381.90926c","name":"Запис файла у мережевий каталог","func":"var dir_date = flow.get(\"time_in\");//каталог у якому буде фото з камери\nvar name = Number(new Date());//гарантує унікальність імені фото\nmsg.filename = \"/mnt/winshare/\" + dir_date + \"/180_\"+name +\".jpeg\";\n//мережевий каталог у лінуксі - /mnt/winshare/\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":500,"wires":[["c22d758c.3e72e8"]]},{"id":"51cbebd1.2cd084","type":"debug","z":"11b78381.90926c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":750,"y":560,"wires":[]},{"id":"2b7f9a59.7a85b6","type":"inject","z":"11b78381.90926c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":80,"wires":[["790686dc.e3ee28"]]},{"id":"2d2c5165.e015ee","type":"exec","z":"11b78381.90926c","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":570,"y":80,"wires":[["d4545ce3.bde44"],["d4545ce3.bde44"],["d4545ce3.bde44"]]},{"id":"790686dc.e3ee28","type":"function","z":"11b78381.90926c","name":"Монтуєм мережевий каталог","func":"msg.payload = \"sudo mount -t cifs //192.168.10.7/ScreenShots -o username=api,password=Inkognito1=,file_mode=0777,dir_mode=0777,vers=2.0, /mnt/winshare\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":80,"wires":[["2d2c5165.e015ee"]]},{"id":"d4545ce3.bde44","type":"debug","z":"11b78381.90926c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":710,"y":60,"wires":[]},{"id":"73bc6e36.1037a","type":"function","z":"a9cb9ebe.4b364","name":"Перемістити карту у контейнер","func":"msg.payload = Buffer.from(\"f20003433331b369\", \"hex\");  \n\nmsg.message  = \"Карта принята\";\nmsg.false_1c = false;\nflow.set(\"last_cmd\",\"card_success\");\nflow.set(\"get_info_from_1c\", true);\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1890,"y":1040,"wires":[["78936a6e.db3304"]]},{"id":"7c34c0d9.c6629","type":"comment","z":"11b78381.90926c","name":"Команда на монтування","info":"","x":320,"y":40,"wires":[]},{"id":"cbfeac26.bf529","type":"comment","z":"11b78381.90926c","name":"Перевірка чи є каталог","info":"","x":320,"y":140,"wires":[]},{"id":"c8a1544a.debf78","type":"debug","z":"d89b76b5.c78b58","name":"card rfid_read","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":510,"y":80,"wires":[]},{"id":"bf804daf.eae75","type":"debug","z":"a9cb9ebe.4b364","name":"init_card_acceptor","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":640,"y":460,"wires":[]},{"id":"89a5312c.94b07","type":"json","z":"a143ae81.213c6","name":"","property":"payload","action":"str","pretty":false,"x":710,"y":320,"wires":[["7b4b2b78.8e1a54"]]},{"id":"99643b59.895b98","type":"json","z":"a143ae81.213c6","name":"","property":"payload","action":"str","pretty":false,"x":730,"y":40,"wires":[["2b9194a1.9453bc"]]},{"id":"f6614b6a.8ae048","type":"debug","z":"d89b76b5.c78b58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":410,"y":120,"wires":[]},{"id":"41902ccf.772de4","type":"inject","z":"d89b76b5.c78b58","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":480,"wires":[["b434fac1.6e4398"]]},{"id":"b434fac1.6e4398","type":"function","z":"d89b76b5.c78b58","name":"","func":"msg.payload = Buffer.from(\"380e0a\",\"hex\")\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":480,"wires":[["699aaba5.eb5904","644cde0.ca06924"]]},{"id":"699aaba5.eb5904","type":"debug","z":"d89b76b5.c78b58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":490,"y":480,"wires":[]},{"id":"644cde0.ca06924","type":"function","z":"d89b76b5.c78b58","name":"hex to dec","func":"var buffer = msg.payload;\nvar b1 = buffer[0].toString(\"16\");\nvar b2 = buffer[1].toString(\"16\");\nvar b3 = buffer[2].toString(\"16\");\n\n\n//var number = buffer[0].toString(\"16\") + buffer[1].toString(\"16\") + buffer[2].toString(\"16\");\n\nif(b1.length == 1){\n   b1 = \"0\" + b1; \n}\nif(b2.length == 1){\n   b2 = \"0\" + b2; \n}\nif(b3.length == 1){\n   b3 = \"0\" + b3; \n}\n\nvar number = b1 + b2 + b3;\n\nvar dec = parseInt(number,16).toString();\nmsg.payload = dec;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":400,"wires":[["699aaba5.eb5904"]]},{"id":"6f1d456b.3d3c1c","type":"inject","z":"d89b76b5.c78b58","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":520,"wires":[["ea1880db.d9878"]]},{"id":"ea1880db.d9878","type":"function","z":"d89b76b5.c78b58","name":"","func":"msg.payload = Buffer.from(\"7f630e\",\"hex\")\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":520,"wires":[["699aaba5.eb5904","644cde0.ca06924"]]},{"id":"d1b373cb.4c3cc","type":"function","z":"a9cb9ebe.4b364","name":"","func":"var in_data = msg.payload;\nif(in_data.length > 1){\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1260,"wires":[["1644a4f5.ca0e5b"]]},{"id":"c2227dce.a7eba","type":"exec","z":"a9cb9ebe.4b364","command":"bash /home/pi/kill_pid.sh","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":850,"y":1500,"wires":[["a193bff5.c1378"],[],[]]},{"id":"6270f1d.c409c1","type":"inject","z":"a9cb9ebe.4b364","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":550,"y":1480,"wires":[["c2227dce.a7eba"]]},{"id":"a193bff5.c1378","type":"debug","z":"a9cb9ebe.4b364","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1100,"y":1500,"wires":[]},{"id":"7a871cd9.63ca74","type":"delay","z":"a9cb9ebe.4b364","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":750,"y":1400,"wires":[["c2227dce.a7eba"]]},{"id":"67fa601c.ac2da","type":"delay","z":"a9cb9ebe.4b364","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":750,"y":1300,"wires":[["7a871cd9.63ca74"]]}]
