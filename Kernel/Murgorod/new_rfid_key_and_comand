[{"id":"b5cb8d46.ec3e","type":"tab","label":"Display","disabled":false,"info":""},{"id":"d4442915.ce0938","type":"HIDConfig","z":"","vid":"1155","pid":"22352","name":""},{"id":"3109b4ab.a6160c","type":"HIDConfig","z":"","vid":"34578","pid":"34600","name":"keyboard"},{"id":"10ff6963.867a57","type":"HIDdevice","z":"b5cb8d46.ec3e","connection":"3109b4ab.a6160c","name":"","x":410,"y":280,"wires":[["968337df.7dd128","c574bd92.2c5d","314a2f06.010c1"],["c574bd92.2c5d"]]},{"id":"e583f40d.4f8528","type":"getHIDdevices","z":"b5cb8d46.ec3e","name":"","x":280,"y":80,"wires":[["aec2d5ff.b5db08"]]},{"id":"9592587a.042a38","type":"inject","z":"b5cb8d46.ec3e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":80,"wires":[["e583f40d.4f8528"]]},{"id":"aec2d5ff.b5db08","type":"debug","z":"b5cb8d46.ec3e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":470,"y":80,"wires":[]},{"id":"d0e4ecd2.7c602","type":"function","z":"b5cb8d46.ec3e","name":"","func":"msg.payload = [0xf4, 0x10,\n 0xee,\n 0x1,\n 0x6,\n 0xe2,\n 0x0,\n 0x0,\n 0x19,\n 0x34,\n 0x11,\n 0x0,\n 0x72,\n 0x23,\n 0x80,\n 0x24,\n 0xc4,\n 0xce,\n 0x4a,\n 0xfe,\n 0xab,\n 0xa,\n 0xca,\n 0x8f,\n 0x5f,\n 0xd3,\n 0xd3,\n 0x3f,\n 0x1f,\n 0x8,\n 0x6d,\n 0x19,\n 0x1a,\n 0x2a,\n 0xa6,\n 0xce,\n 0x96,\n 0x61,\n 0x4e,\n 0x5f,\n 0xa2,\n 0x25,\n 0xeb,\n 0xb9,\n 0x49,\n 0x2d,\n 0xd8,\n 0x50,\n 0x97,\n 0x50,\n 0x61,\n 0x7c,\n 0x6,\n 0x99,\n 0x88,\n 0x9c,\n 0xd7,\n 0xa4,\n 0xc7,\n 0x97,\n 0xba,\n 0xab,\n 0x9b,\n 0x89];\n return msg;\n \n ","outputs":1,"noerr":0,"x":450,"y":40,"wires":[["8ec48aa0.404798"]]},{"id":"55b7c22d.1edf0c","type":"inject","z":"b5cb8d46.ec3e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":288.75000762939453,"y":37.5,"wires":[["d0e4ecd2.7c602"]]},{"id":"968337df.7dd128","type":"function","z":"b5cb8d46.ec3e","name":"filter error","func":"var b_1 = msg.payload[0];\nif(b_1 == 244){\n    flow.set(\"trg\",0)\n}else if(b_1 == 240){\n    flow.set(\"trg\",1)\n}\nreturn msg;","outputs":1,"noerr":0,"x":463.75000762939453,"y":132.50000190734863,"wires":[["5ce11f76.f67f5"]]},{"id":"387c3bf0.56cac4","type":"inject","z":"b5cb8d46.ec3e","name":"","topic":"","payload":"metka","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":147,"y":426,"wires":[["8cf25ad0.c93f48"]]},{"id":"5ce11f76.f67f5","type":"switch","z":"b5cb8d46.ec3e","name":"","property":"trg","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":613,"y":126,"wires":[["65eaae2c.bd3dd"],["e4cf6ce1.e3eb"]]},{"id":"8ec48aa0.404798","type":"function","z":"b5cb8d46.ec3e","name":"init","func":"flow.set(\"metka_bad\",msg.payload);\nflow.set(\"str\",[]);\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":40,"wires":[["ee4ea28e.30eaf"]]},{"id":"ee4ea28e.30eaf","type":"debug","z":"b5cb8d46.ec3e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":810,"y":40,"wires":[]},{"id":"65eaae2c.bd3dd","type":"function","z":"b5cb8d46.ec3e","name":"error","func":"\nreturn msg;","outputs":1,"noerr":0,"x":758,"y":127,"wires":[["79c29857.7c3398","78d53b1f.e95ef4"]]},{"id":"e4cf6ce1.e3eb","type":"function","z":"b5cb8d46.ec3e","name":"correct","func":"return msg;","outputs":1,"noerr":0,"x":541.7500076293945,"y":186.50000381469727,"wires":[["1caf6839.91f208"]]},{"id":"1caf6839.91f208","type":"function","z":"b5cb8d46.ec3e","name":"flow.set(\"metka\")","func":"flow.set(\"metka\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":718.2500152587891,"y":189.00000381469727,"wires":[["aadc9f63.c714a"]]},{"id":"79c29857.7c3398","type":"debug","z":"b5cb8d46.ec3e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":950.7500114440918,"y":131.50000190734863,"wires":[]},{"id":"aadc9f63.c714a","type":"debug","z":"b5cb8d46.ec3e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":952.2500152587891,"y":223.0000057220459,"wires":[]},{"id":"8cf25ad0.c93f48","type":"function","z":"b5cb8d46.ec3e","name":"КОмандний Режим","func":"var metka = msg.payload;\nmetka = metka.toString(\"hex\");\nvar metka_all = metka.toString();\nmetka = metka.substring(0,34);\nvar response_rfid = metka.substring(0,10)\nvar EPC = metka.substring(10,34)\nvar CRC = metka.substring(30,34);\nmsg.payload = {\n    all_str: metka_all,\n    response_rfid: response_rfid,\n    EPC:EPC,\n    CRC:CRC\n};\nflow.set(\"date_m\",msg.payload );\nreturn msg;","outputs":1,"noerr":0,"x":372,"y":427,"wires":[["885fa8f5.aff3e8"]]},{"id":"885fa8f5.aff3e8","type":"debug","z":"b5cb8d46.ec3e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":566,"y":428,"wires":[]},{"id":"c574bd92.2c5d","type":"debug","z":"b5cb8d46.ec3e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":615,"y":326,"wires":[]},{"id":"78d53b1f.e95ef4","type":"function","z":"b5cb8d46.ec3e","name":"","func":"var metka = msg.payload;\nmetka = metka.toString(\"hex\");\nmetka = metka.substring(0,60);\nvar response_rfid = metka.substring(0,36)\nvar EPC = metka.substring(36,60)\nvar CRC = metka.substring(56,60);\nmsg.payload = {\n    all_str: metka,\n    response_rfid: response_rfid,\n    EPC:EPC,\n   CRC:CRC\n};\n\n\nreturn msg;","outputs":1,"noerr":0,"x":918.5000114440918,"y":172.25000286102295,"wires":[["a4170867.fb6ed8"]]},{"id":"a4170867.fb6ed8","type":"debug","z":"b5cb8d46.ec3e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1071.250015258789,"y":175.00000381469727,"wires":[]},{"id":"b00a8a3a.159568","type":"function","z":"b5cb8d46.ec3e","name":"read start program","func":"msg.payload = [0x40,0x06,0xEE,0x01,0x00,0x00,0x00,0xCB];\nreturn msg;","outputs":1,"noerr":0,"x":249,"y":194,"wires":[["5a789064.260cd","10ff6963.867a57"]]},{"id":"18b3151c.9c869b","type":"inject","z":"b5cb8d46.ec3e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":79,"y":188,"wires":[["b00a8a3a.159568"]]},{"id":"5a789064.260cd","type":"debug","z":"b5cb8d46.ec3e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":182,"y":280,"wires":[]},{"id":"621fec0f.9f2d64","type":"debug","z":"b5cb8d46.ec3e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":356,"y":469.25,"wires":[]},{"id":"314a2f06.010c1","type":"function","z":"b5cb8d46.ec3e","name":"шфр.Key","func":"var in_v = msg.payload[3];\n\nif(in_v == 8){\n    msg.payload = \"e\";\n}else if(in_v === 0 ){\n    msg.payload = \"\";\n}else if(in_v == 30 ){\n    msg.payload = 1;\n}else if(in_v == 31 ){\n    msg.payload = 2;\n}else if(in_v == 32 ){\n    msg.payload = 3;\n}else if(in_v == 33 ){\n    msg.payload = 4;\n}else if(in_v == 34 ){\n    msg.payload = 5;\n}else if(in_v == 35 ){\n    msg.payload = 6;\n}else if(in_v == 36 ){\n    msg.payload = 7;\n}else if(in_v == 37 ){\n    msg.payload = 8;\n}else if(in_v == 38 ){\n    msg.payload = 9;\n}else if(in_v == 39 ){\n    msg.payload = 0;\n}else if(in_v == 6 ){\n    msg.payload = \"c\";\n}else if(in_v == 4 ){\n    msg.payload = \"a\";\n}else if(in_v == 5 ){\n    msg.payload = \"b\";\n}else if(in_v == 7 ){\n    msg.payload = \"d\";\n}else if(in_v == 9 ){\n    msg.payload = \"f\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":573.0000076293945,"y":275.00000381469727,"wires":[["102d1c9e.cddcc3"]]},{"id":"102d1c9e.cddcc3","type":"function","z":"b5cb8d46.ec3e","name":"масив","func":"var str_1 = flow.get(\"str\");\nstr_1.push(msg.payload);\nmsg.payload = str_1;\nreturn msg;","outputs":1,"noerr":0,"x":705.5,"y":274.75,"wires":[["3853f05a.ffe01"]]},{"id":"aff0aaf4.141aa8","type":"function","z":"b5cb8d46.ec3e","name":"get all str EPC","func":"var str_1 = flow.get(\"str\");\nstr_1 = str_1.join('');\nmsg.payload = str_1;\nreturn msg;","outputs":1,"noerr":0,"x":1296.2500190734863,"y":272.5000047683716,"wires":[["cb0a05c0.b1c058","c328c971.e6cb58","a2bfe96d.3a3e88"]]},{"id":"63b33945.1c41c8","type":"inject","z":"b5cb8d46.ec3e","name":"Остання мітка","topic":"","payload":"str","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":166,"y":469.5,"wires":[["621fec0f.9f2d64"]]},{"id":"cb0a05c0.b1c058","type":"debug","z":"b5cb8d46.ec3e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1495.75,"y":273.5,"wires":[]},{"id":"65d96afc.944934","type":"delay","z":"b5cb8d46.ec3e","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":955,"y":272.75,"wires":[["8b57620e.61284"]]},{"id":"8b57620e.61284","type":"delay","z":"b5cb8d46.ec3e","name":"","pauseType":"rate","timeout":"400","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1112.500015258789,"y":270.00000381469727,"wires":[["aff0aaf4.141aa8"]]},{"id":"ce2b012.f4c3f","type":"function","z":"b5cb8d46.ec3e","name":"reset \"str\"","func":"flow.set(\"str\",[]);\n\nreturn msg;","outputs":1,"noerr":0,"x":1418,"y":417.5,"wires":[[]]},{"id":"f3df866b.fbd178","type":"debug","z":"b5cb8d46.ec3e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1000.0000152587891,"y":330.00000381469727,"wires":[]},{"id":"c328c971.e6cb58","type":"delay","z":"b5cb8d46.ec3e","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1205.25,"y":356.5,"wires":[["20d3c760.330a28"]]},{"id":"20d3c760.330a28","type":"delay","z":"b5cb8d46.ec3e","name":"","pauseType":"rate","timeout":"400","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"4","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1377,"y":355.5,"wires":[["ce2b012.f4c3f"]]},{"id":"3853f05a.ffe01","type":"function","z":"b5cb8d46.ec3e","name":"стр","func":"var str_1 = flow.get(\"str\");\nstr_1 = str_1.join('');\nmsg.payload = str_1;\nreturn msg;","outputs":1,"noerr":0,"x":824.25,"y":273.5,"wires":[["65d96afc.944934","f3df866b.fbd178"]]},{"id":"c7e09b92.368a18","type":"comment","z":"b5cb8d46.ec3e","name":"GEt RFID WIHT HTTp","info":"","x":188.5,"y":535,"wires":[]},{"id":"8df68da2.891a5","type":"http in","z":"b5cb8d46.ec3e","name":"","url":"/api/platform/getTag","method":"get","upload":false,"swaggerDoc":"","x":140.5,"y":608,"wires":[["9ba289bc.831718"]]},{"id":"9ba289bc.831718","type":"function","z":"b5cb8d46.ec3e","name":"RFID SEND","func":"msg.payload = {\n    \"rfid\": flow.get(\"rfid\")\n}\nreturn msg;","outputs":1,"noerr":0,"x":352.5,"y":608,"wires":[["e63f2c9d.75004","e69240c6.b22c9"]]},{"id":"e63f2c9d.75004","type":"http response","z":"b5cb8d46.ec3e","name":"","statusCode":"","headers":{},"x":552.5,"y":607,"wires":[]},{"id":"a2bfe96d.3a3e88","type":"function","z":"b5cb8d46.ec3e","name":"set rfid","func":"flow.set(\"rfid\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":1387.5,"y":223,"wires":[[]]},{"id":"7b197e2c.3b1db","type":"comment","z":"b5cb8d46.ec3e","name":"CLEAR RFID CARD","info":"","x":178,"y":674,"wires":[]},{"id":"a34219d.a4f2ee8","type":"http in","z":"b5cb8d46.ec3e","name":"","url":"/api/platform/reset","method":"get","upload":false,"swaggerDoc":"","x":126,"y":726,"wires":[["a61e63de.2de12"]]},{"id":"a61e63de.2de12","type":"function","z":"b5cb8d46.ec3e","name":"Clear  RFID","func":"msg.payload = {\n    \"rfid\": flow.set(\"rfid\",[])\n}\nreturn msg;","outputs":1,"noerr":0,"x":348,"y":726,"wires":[["7f1749d0.6443a8"]]},{"id":"7f1749d0.6443a8","type":"http response","z":"b5cb8d46.ec3e","name":"","statusCode":"","headers":{},"x":491,"y":726,"wires":[]},{"id":"e69240c6.b22c9","type":"debug","z":"b5cb8d46.ec3e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":478.5,"y":531,"wires":[]},{"id":"886364c6.37dcd8","type":"inject","z":"b5cb8d46.ec3e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":182.9285774230957,"y":990.9999027252197,"wires":[["828a08e5.8933b8"]]},{"id":"d0903a8e.176d38","type":"debug","z":"b5cb8d46.ec3e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":657.4999923706055,"y":818.0000219345093,"wires":[]},{"id":"91b57b1.0661e88","type":"function","z":"b5cb8d46.ec3e","name":"ThingsBoard integrations","func":"var resultTH = {\n   \"deviceName\": \"rfid\",\n   \"deviceType\": \"rfid_1\",\n   \"attributes\": {\n       \"model\": \"VD-67\",\n       \"serialNumber\": \"SN012345\",\n       \"integrationName\": \"Smart scale rfid integration\"\n   }\n};\nflow.set('resultTH',resultTH);   \nreturn msg;","outputs":1,"noerr":0,"x":400.02479553222656,"y":831.6021919250488,"wires":[[]]},{"id":"a915765d.e489e8","type":"http request","z":"b5cb8d46.ec3e","name":"ThingsBoard Smart RFID","method":"POST","ret":"txt","url":"http://10.3.5.223:8080/api/v1/LYbPfZbLCZgvtN2qU4lz/telemetry","tls":"","x":878.286693572998,"y":1006.745038986206,"wires":[[]]},{"id":"a93f05a0.335e08","type":"function","z":"b5cb8d46.ec3e","name":"","func":"msg.headers = {\n    \"Content-Type\":\"application/json\"\n}\nmsg.payload = msg.payload.telemetry;\nreturn msg;","outputs":1,"noerr":0,"x":608.2867908477783,"y":1009.6021299362183,"wires":[["a915765d.e489e8"]]},{"id":"828a08e5.8933b8","type":"function","z":"b5cb8d46.ec3e","name":"rfid_card","func":"var payload = flow.get('resultTH');\npayload.telemetry = {\n    \"rfid_card\" : flow.get(\"rfid\"),\n    \"event\":\"Виявлена картка\"\n}; \nmsg.payload = payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":398.28679275512695,"y":1003.8878231048584,"wires":[["a93f05a0.335e08"]]},{"id":"fbd91de5.8994c","type":"inject","z":"b5cb8d46.ec3e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":202.14285278320312,"y":830.0000305175781,"wires":[["91b57b1.0661e88"]]}]
