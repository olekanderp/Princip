[{"id":"3d3d5d98.3bdb72","type":"tab","label":"KODA D400"},{"id":"89e4584a.994288","type":"tab","label":"METLER TOLEDO 8530"},{"id":"417832f2.ceac3c","type":"tab","label":"Data grabber"},{"id":"df260e7f.13538","type":"tab","label":"Send on 1C"},{"id":"6593b3ce.8e2a6c","type":"tab","label":"Stable"},{"id":"4d8485d8.74a3dc","type":"tab","label":"RFID Gateway"},{"id":"11ac1d6c.2da8f3","type":"tab","label":"PostgreSql "},{"id":"302507b1.f00e28","type":"serial-port","z":"","serialport":"/dev/princip/usb1","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\r","bin":"false","out":"char","addchar":true},{"id":"60d70e98.4788b","type":"socket-io-event","z":"","addr":"getWeight"},{"id":"51dd5296.bae66c","type":"socket-io-server","z":"","port":"4001"},{"id":"73140961.690048","type":"socket-io-server","z":"","port":"4002"},{"id":"ddc9d29a.27599","type":"serial-port","z":"","serialport":"/dev/princip/usb0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\r","bin":"false","out":"char","addchar":true},{"id":"c1cb1f75.5dd2d","type":"ui_tab","z":"","name":"Home","icon":"dashboard"},{"id":"72cbf799.9991a8","type":"ui_group","z":"","name":"Автомобільні ваги 60т","tab":"c1cb1f75.5dd2d","order":2,"disp":true,"width":"6"},{"id":"f2460cfc.9d535","type":"ui_group","z":"","name":"Автомобільні ваги 80т","tab":"c1cb1f75.5dd2d","order":1,"disp":true,"width":"6"},{"id":"5e6e55de.24490c","type":"ui_base","name":"Smart Scales Dashboard","theme":"theme-light"},{"id":"527be637.9619e8","type":"mongodb","z":"","hostname":"10.1.132.168","port":"27017","db":"truck_dataset","name":""},{"id":"3dd05591.fb6bea","type":"ui_group","z":"","name":"Поточний стан контрольних точок","tab":"33dad969.1027f6","order":2,"disp":true,"width":"3"},{"id":"33dad969.1027f6","type":"ui_tab","z":"","name":"Smart Scales","icon":"dashboard"},{"id":"1af05285.16139d","type":"postgresdb","z":"","hostname":"10.3.5.250","port":"5432","db":"rfid_log","ssl":false},{"id":"ceea46a1.937728","type":"websocket-client","z":"","path":"","wholemsg":"false"},{"id":"def35c91.5116c","type":"websocket-listener","z":"","path":"http://10.1.132.168:1880","wholemsg":"false"},{"id":"b07aa37e.8530d","type":"inject","z":"3d3d5d98.3bdb72","name":"","topic":"","payload":"p.inject","payloadType":"flow","repeat":"1","crontab":"","once":false,"x":116,"y":179,"wires":[["9a603448.55aa48"]]},{"id":"9a603448.55aa48","type":"serial out","z":"3d3d5d98.3bdb72","name":"","serial":"302507b1.f00e28","x":316,"y":179,"wires":[]},{"id":"da959451.fb4528","type":"serial in","z":"3d3d5d98.3bdb72","name":"","serial":"302507b1.f00e28","x":116,"y":239,"wires":[["f7d6094c.eed178","149fffa4.fe805"]]},{"id":"f7d6094c.eed178","type":"function","z":"3d3d5d98.3bdb72","name":"GET WEIGHT","func":"var v = msg.payload;\nvar p = flow.get('p');\nvar currentWeight = p.parser(v);\n\nflow.set('currentWeight',currentWeight);\n\nmsg.queryParameters = msg.queryParameters || {};\nmsg.queryParameters.parWeight = currentWeight;\nmsg.queryParameters.parDate   = new Date();\nmsg.queryParameters.parSource = p.source;\nmsg.queryParameters.parScale  = p.scale;\nmsg.payload                   = currentWeight;\n\nreturn msg;","outputs":1,"noerr":0,"x":306,"y":239,"wires":[["ab3be6b8.1aa8d8","b2e7399d.236558","4406301c.eb175","ee31f16e.9d93f","1e0cc9c4.ee8726"]]},{"id":"f5df9973.b52ea8","type":"http in","z":"3d3d5d98.3bdb72","name":"","url":"/mir_avto1/status","method":"get","swaggerDoc":"","x":146.25,"y":825.2500104904175,"wires":[["66fd12ad.ce824c","8bd01ca3.db1ad","521781e9.5b746","921cdde8.6c44"]]},{"id":"43d3c173.bf7cd","type":"http in","z":"3d3d5d98.3bdb72","name":"","url":"/mir_avto1","method":"get","swaggerDoc":"","x":125,"y":896.2500133514404,"wires":[["d9331021.7c978","8bd01ca3.db1ad","521781e9.5b746","2badc273.d4b7be","7212e3be.d48efc"]]},{"id":"d9331021.7c978","type":"function","z":"3d3d5d98.3bdb72","name":"FAST WEIGHT","func":"msg.payload = {\n    weight: flow.get('currentWeight'),\n    status:true,\n    stable:true,    \n    perimetr:true\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":431.50000762939453,"y":925.0000133514404,"wires":[["37ca2538.c9077a"]]},{"id":"37ca2538.c9077a","type":"http response","z":"3d3d5d98.3bdb72","name":"","x":584.8333206176758,"y":926.2500133514404,"wires":[]},{"id":"18b0e2b2.7410bd","type":"comment","z":"3d3d5d98.3bdb72","name":"Device level","info":"","x":110,"y":140,"wires":[]},{"id":"10e23581.e62bca","type":"comment","z":"3d3d5d98.3bdb72","name":"INTEGRATION LEVEL (API)","info":"","x":129.7142791748047,"y":772.8571395874023,"wires":[]},{"id":"9ff04266.08783","type":"socket-io-out","z":"3d3d5d98.3bdb72","name":"getWeight","event":"60d70e98.4788b","server":"51dd5296.bae66c","x":720,"y":100,"wires":[]},{"id":"d4c9f983.30a798","type":"http in","z":"3d3d5d98.3bdb72","name":"","url":"/mir_avto1/socket","method":"get","swaggerDoc":"","x":145,"y":973.3333292007446,"wires":[["e23e335f.5e9ab"]]},{"id":"e23e335f.5e9ab","type":"template","z":"3d3d5d98.3bdb72","name":"socket page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n     <style>\n        #circle1 {\n      width: 50px;\n      height: 50px;\n      -webkit-border-radius: 25px;\n      -moz-border-radius: 25px;\n      border-radius: 25px;\n      background: blue;\n      margin-bottom: 10px;\n    }\n    \n    </style>\n  <body>\n    <h1><p id='weight'></p></h1>\n    \n     <script>\n    setTimeout(function() {\n       ;(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.io=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_(\"./lib/\")},{\"./lib/\":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_(\"./socket\");module.exports.parser=_dereq_(\"engine.io-parser\")},{\"./socket\":3,\"engine.io-parser\":19}],3:[function(_dereq_,module,exports){(function(global){var transports=_dereq_(\"./transports\");var Emitter=_dereq_(\"component-emitter\");var debug=_dereq_(\"debug\")(\"engine.io-client:socket\");var index=_dereq_(\"indexof\");var parser=_dereq_(\"engine.io-parser\");var parseuri=_dereq_(\"parseuri\");var parsejson=_dereq_(\"parsejson\");var parseqs=_dereq_(\"parseqs\");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&\"object\"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==\"https\"||uri.protocol==\"wss\";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&\"https:\"==location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?\"443\":\"80\"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:\"localhost\");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if(\"string\"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||\"t\";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||[\"polling\",\"websocket\"];this.readyState=\"\";this.writeBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?null:opts.rejectUnauthorized;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}}this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_(\"./transport\");Socket.transports=_dereq_(\"./transports\");Socket.parser=_dereq_(\"engine.io-parser\");Socket.prototype.createTransport=function(name){debug('creating transport \"%s\"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf(\"websocket\")!=-1){transport=\"websocket\"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit(\"error\",\"No transports available\")},0);return}else{transport=this.transports[0]}this.readyState=\"opening\";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug(\"setting transport %s\",transport.name);var self=this;if(this.transport){debug(\"clearing existing transport %s\",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on(\"drain\",function(){self.onDrain()}).on(\"packet\",function(packet){self.onPacket(packet)}).on(\"error\",function(e){self.onError(e)}).on(\"close\",function(){self.onClose(\"transport close\")})};Socket.prototype.probe=function(name){debug('probing transport \"%s\"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport \"%s\" opened',name);transport.send([{type:\"ping\",data:\"probe\"}]);transport.once(\"packet\",function(msg){if(failed)return;if(\"pong\"==msg.type&&\"probe\"==msg.data){debug('probe transport \"%s\" pong',name);self.upgrading=true;self.emit(\"upgrading\",transport);if(!transport)return;Socket.priorWebsocketSuccess=\"websocket\"==transport.name;debug('pausing current transport \"%s\"',self.transport.name);self.transport.pause(function(){if(failed)return;if(\"closed\"==self.readyState)return;debug(\"changing transport and sending upgrade packet\");cleanup();self.setTransport(transport);transport.send([{type:\"upgrade\"}]);self.emit(\"upgrade\",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport \"%s\" failed',name);var err=new Error(\"probe error\");err.transport=transport.name;self.emit(\"upgradeError\",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error(\"probe error: \"+err);error.transport=transport.name;freezeTransport();debug('probe transport \"%s\" failed because of error: %s',name,err);self.emit(\"upgradeError\",error)}function onTransportClose(){onerror(\"transport closed\")}function onclose(){onerror(\"socket closed\")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('\"%s\" works - aborting \"%s\"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener(\"open\",onTransportOpen);transport.removeListener(\"error\",onerror);transport.removeListener(\"close\",onTransportClose);self.removeListener(\"close\",onclose);self.removeListener(\"upgrading\",onupgrade)}transport.once(\"open\",onTransportOpen);transport.once(\"error\",onerror);transport.once(\"close\",onTransportClose);this.once(\"close\",onclose);this.once(\"upgrading\",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug(\"socket open\");this.readyState=\"open\";Socket.priorWebsocketSuccess=\"websocket\"==this.transport.name;this.emit(\"open\");this.flush();if(\"open\"==this.readyState&&this.upgrade&&this.transport.pause){debug(\"starting upgrade probes\");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if(\"opening\"==this.readyState||\"open\"==this.readyState){debug('socket receive: type \"%s\", data \"%s\"',packet.type,packet.data);this.emit(\"packet\",packet);this.emit(\"heartbeat\");switch(packet.type){case\"open\":this.onHandshake(parsejson(packet.data));break;case\"pong\":this.setPing();this.emit(\"pong\");break;case\"error\":var err=new Error(\"server error\");err.code=packet.data;this.onError(err);break;case\"message\":this.emit(\"data\",packet.data);this.emit(\"message\",packet.data);break}}else{debug('packet received with socket readyState \"%s\"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit(\"handshake\",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if(\"closed\"==this.readyState)return;this.setPing();this.removeListener(\"heartbeat\",this.onHeartbeat);this.on(\"heartbeat\",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if(\"closed\"==self.readyState)return;self.onClose(\"ping timeout\")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug(\"writing ping packet - expecting pong within %sms\",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket(\"ping\",function(){self.emit(\"ping\")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit(\"drain\")}else{this.flush()}};Socket.prototype.flush=function(){if(\"closed\"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug(\"flushing %d packets in socket\",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit(\"flush\")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket(\"message\",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if(\"function\"==typeof data){fn=data;data=undefined}if(\"function\"==typeof options){fn=options;options=null}if(\"closing\"==this.readyState||\"closed\"==this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit(\"packetCreate\",packet);this.writeBuffer.push(packet);if(fn)this.once(\"flush\",fn);this.flush()};Socket.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.readyState=\"closing\";var self=this;if(this.writeBuffer.length){this.once(\"drain\",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose(\"forced close\");debug(\"socket closing - telling transport to close\");self.transport.close()}function cleanupAndClose(){self.removeListener(\"upgrade\",cleanupAndClose);self.removeListener(\"upgradeError\",cleanupAndClose);close()}function waitForUpgrade(){self.once(\"upgrade\",cleanupAndClose);self.once(\"upgradeError\",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug(\"socket error %j\",err);Socket.priorWebsocketSuccess=false;this.emit(\"error\",err);this.onClose(\"transport error\",err)};Socket.prototype.onClose=function(reason,desc){if(\"opening\"==this.readyState||\"open\"==this.readyState||\"closing\"==this.readyState){debug('socket close with reason: \"%s\"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners(\"close\");this.transport.close();this.transport.removeAllListeners();this.readyState=\"closed\";this.id=null;this.emit(\"close\",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./transport\":4,\"./transports\":5,\"component-emitter\":15,debug:17,\"engine.io-parser\":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(_dereq_,module,exports){var parser=_dereq_(\"engine.io-parser\");var Emitter=_dereq_(\"component-emitter\");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState=\"\";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type=\"TransportError\";err.description=desc;this.emit(\"error\",err);return this};Transport.prototype.open=function(){if(\"closed\"==this.readyState||\"\"==this.readyState){this.readyState=\"opening\";this.doOpen()}return this};Transport.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if(\"open\"==this.readyState){this.write(packets)}else{throw new Error(\"Transport not open\")}};Transport.prototype.onOpen=function(){this.readyState=\"open\";this.writable=true;this.emit(\"open\")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit(\"packet\",packet)};Transport.prototype.onClose=function(){this.readyState=\"closed\";this.emit(\"close\")}},{\"component-emitter\":15,\"engine.io-parser\":19}],5:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var XHR=_dereq_(\"./polling-xhr\");var JSONP=_dereq_(\"./polling-jsonp\");var websocket=_dereq_(\"./websocket\");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if(\"open\"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error(\"JSONP disabled\");return new JSONP(opts)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling-jsonp\":6,\"./polling-xhr\":7,\"./websocket\":9,\"xmlhttprequest-ssl\":10}],6:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_(\"./polling\");var inherit=_dereq_(\"component-inherit\");module.exports=JSONPPolling;var rNewline=/\\n/g;var rEscapedNewline=/\\\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener(\"beforeunload\",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement(\"script\");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError(\"jsonp poll error\",e)};var insertAt=document.getElementsByTagName(\"script\")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko=\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement(\"iframe\");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement(\"form\");var area=document.createElement(\"textarea\");var id=this.iframeId=\"eio_iframe_\"+this.index;var iframe;form.className=\"socketio\";form.style.position=\"absolute\";form.style.top=\"-1000px\";form.style.left=\"-1000px\";form.target=id;form.method=\"POST\";form.setAttribute(\"accept-charset\",\"utf-8\");area.name=\"d\";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError(\"jsonp polling iframe removal error\",e)}}try{var html='<iframe src=\"javascript:0\" name=\"'+self.iframeId+'\">';iframe=document.createElement(html)}catch(e){iframe=document.createElement(\"iframe\");iframe.name=self.iframeId;iframe.src=\"javascript:0\"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,\"\\\\\\n\");this.area.value=data.replace(rNewline,\"\\\\n\");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==\"complete\"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-inherit\":16}],7:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var Polling=_dereq_(\"./polling\");var Emitter=_dereq_(\"component-emitter\");var inherit=_dereq_(\"component-inherit\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling-xhr\");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}else{this.extraHeaders=opts.extraHeaders}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!==\"string\"&&data!==undefined;var req=this.request({method:\"POST\",data:data,isBinary:isBinary});var self=this;req.on(\"success\",fn);req.on(\"error\",function(err){self.onError(\"xhr post error\",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug(\"xhr poll\");var req=this.request();var self=this;req.on(\"data\",function(data){self.onData(data)});req.on(\"error\",function(err){self.onError(\"xhr poll error\",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||\"GET\";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug(\"xhr open %s: %s\",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){xhr.responseType=\"arraybuffer\"}if(\"POST\"==this.method){try{if(this.isBinary){xhr.setRequestHeader(\"Content-type\",\"application/octet-stream\")}else{xhr.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}}catch(e){}}if(\"withCredentials\"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug(\"xhr data %s\",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit(\"success\");this.cleanup()};Request.prototype.onData=function(data){this.emit(\"data\",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit(\"error\",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if(\"undefined\"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader(\"Content-Type\").split(\";\")[0]}catch(e){}if(contentType===\"application/octet-stream\"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var ui8Arr=new Uint8Array(this.xhr.response);var dataArray=[];for(var idx=0,length=ui8Arr.length;idx<length;idx++){dataArray.push(ui8Arr[idx])}data=String.fromCharCode.apply(null,dataArray)}}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return\"undefined\"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent(\"onunload\",unloadHandler)}else if(global.addEventListener){global.addEventListener(\"beforeunload\",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-emitter\":15,\"component-inherit\":16,debug:17,\"xmlhttprequest-ssl\":10}],8:[function(_dereq_,module,exports){var Transport=_dereq_(\"../transport\");var parseqs=_dereq_(\"parseqs\");var parser=_dereq_(\"engine.io-parser\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling\");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name=\"polling\";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState=\"pausing\";function pause(){debug(\"paused\");self.readyState=\"paused\";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug(\"we are currently polling - waiting to pause\");total++;this.once(\"pollComplete\",function(){debug(\"pre-pause polling complete\");--total||pause()})}if(!this.writable){debug(\"we are currently writing - waiting to pause\");total++;this.once(\"drain\",function(){debug(\"pre-pause writing complete\");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug(\"polling\");this.polling=true;this.doPoll();this.emit(\"poll\")};Polling.prototype.onData=function(data){var self=this;debug(\"polling got data %s\",data);var callback=function(packet,index,total){if(\"opening\"==self.readyState){self.onOpen()}if(\"close\"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if(\"closed\"!=this.readyState){this.polling=false;this.emit(\"pollComplete\");if(\"open\"==this.readyState){this.poll()}else{debug('ignoring poll - transport state \"%s\"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug(\"writing close packet\");self.write([{type:\"close\"}])}if(\"open\"==this.readyState){debug(\"transport open - closing\");close()}else{debug(\"transport not open - deferring close\");this.once(\"open\",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit(\"drain\")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"https\":\"http\";var port=\"\";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&(\"https\"==schema&&this.port!=443||\"http\"==schema&&this.port!=80)){port=\":\"+this.port}if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query}},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,\"xmlhttprequest-ssl\":10,yeast:30}],9:[function(_dereq_,module,exports){(function(global){var Transport=_dereq_(\"../transport\");var parser=_dereq_(\"engine.io-parser\");var parseqs=_dereq_(\"parseqs\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:websocket\");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window===\"undefined\"){try{WebSocket=_dereq_(\"ws\")}catch(e){}}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name=\"websocket\";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}this.ws=BrowserWebSocket?new WebSocket(uri):new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType=\"buffer\"}else{this.ws.binaryType=\"arraybuffer\"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError(\"websocket error\",e)}};if(\"undefined\"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!BrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len=\"string\"==typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(BrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug(\"websocket closed before onclose event\")}--total||done()})})(packets[i])}function done(){self.emit(\"flush\");setTimeout(function(){self.writable=true;self.emit(\"drain\")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!==\"undefined\"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"wss\":\"ws\";var port=\"\";if(this.port&&(\"wss\"==schema&&this.port!=443||\"ws\"==schema&&this.port!=80)){port=\":\"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!(\"__initialize\"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,ws:undefined,yeast:30}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_(\"has-cors\");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if(\"undefined\"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(e){}}}},{\"has-cors\":22}],11:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error(\"after called too many times\")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],12:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],13:[function(_dereq_,module,exports){(function(chars){\"use strict\";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64=\"\";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];\nbase64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+\"=\"}else if(len%3===1){base64=base64.substring(0,base64.length-2)+\"==\"}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]===\"=\"){bufferLength--;if(base64[base64.length-2]===\"=\"){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\")},{}],14:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob([\"hi\"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],15:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],16:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],17:[function(_dereq_,module,exports){exports=module.exports=_dereq_(\"./debug\");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=\"undefined\"!=typeof chrome&&\"undefined\"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"];function useColors(){return\"WebkitAppearance\"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?\"%c\":\"\")+this.namespace+(useColors?\" %c\":\" \")+args[0]+(useColors?\"%c \":\" \")+\"+\"+exports.humanize(this.diff);if(!useColors)return args;var c=\"color: \"+this.color;args=[args[0],c,\"color: inherit\"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if(\"%%\"===match)return;index++;if(\"%c\"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return\"object\"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem(\"debug\")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{\"./debug\":18}],18:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_(\"ms\");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if(\"string\"!==typeof args[0]){args=[\"%o\"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match===\"%%\")return match;index++;var formatter=exports.formatters[format];if(\"function\"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if(\"function\"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||\"\").split(/[\\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\\*/g,\".*?\");if(namespaces[0]===\"-\"){exports.skips.push(new RegExp(\"^\"+namespaces.substr(1)+\"$\"))}else{exports.names.push(new RegExp(\"^\"+namespaces+\"$\"))}}}function disable(){exports.enable(\"\")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:25}],19:[function(_dereq_,module,exports){(function(global){var keys=_dereq_(\"./keys\");var hasBinary=_dereq_(\"has-binary\");var sliceBuffer=_dereq_(\"arraybuffer.slice\");var base64encoder=_dereq_(\"base64-arraybuffer\");var after=_dereq_(\"after\");var utf8=_dereq_(\"utf8\");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:\"error\",data:\"parser error\"};var Blob=_dereq_(\"blob\");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if(\"function\"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if(\"function\"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(\"\"+encoded)};function encodeBase64Object(packet,callback){var message=\"b\"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message=\"b\"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(\",\")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data==\"string\"||data===undefined){if(data.charAt(0)==\"b\"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType===\"blob\"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType===\"blob\"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary==\"function\"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback(\"0:\")}function setLengthHeader(message){return message.length+\":\"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(\"\"))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!=\"string\"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var packet;if(data==\"\"){return callback(err,0,1)}var length=\"\",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(\":\"!=chr){length+=chr}else{if(\"\"==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=\"\"}}if(length!=\"\"){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p===\"string\"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p===\"string\";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded===\"string\"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength=\"\";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg=\"\";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./keys\":20,after:11,\"arraybuffer.slice\":12,\"base64-arraybuffer\":13,blob:14,\"has-binary\":21,utf8:29}],20:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],21:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:24}],22:[function(_dereq_,module,exports){try{module.exports=typeof XMLHttpRequest!==\"undefined\"&&\"withCredentials\"in new XMLHttpRequest}catch(err){module.exports=false}},{}],23:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],24:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)==\"[object Array]\"}},{}],25:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if(\"string\"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=\"\"+str;if(str.length>1e4)return;var match=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||\"ms\").toLowerCase();switch(type){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return n*y;case\"days\":case\"day\":case\"d\":return n*d;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return n*h;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return n*m;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return n*s;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+\"d\";if(ms>=h)return Math.round(ms/h)+\"h\";if(ms>=m)return Math.round(ms/m)+\"m\";if(ms>=s)return Math.round(ms/s)+\"s\";return ms+\"ms\"}function long(ms){return plural(ms,d,\"day\")||plural(ms,h,\"hour\")||plural(ms,m,\"minute\")||plural(ms,s,\"second\")||ms+\" ms\"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+\" \"+name;return Math.ceil(ms/n)+\" \"+name+\"s\"}},{}],26:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\\],:{}\\s]*$/;var rvalidescape=/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\\s*\\[)+/g;var rtrimLeft=/^\\s+/;var rtrimRight=/\\s+$/;module.exports=function parsejson(data){if(\"string\"!=typeof data||!data){return null}data=data.replace(rtrimLeft,\"\").replace(rtrimRight,\"\");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,\"@\").replace(rvalidtokens,\"]\").replace(rvalidbraces,\"\"))){return new Function(\"return \"+data)()}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],27:[function(_dereq_,module,exports){exports.encode=function(obj){var str=\"\";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+=\"&\";str+=encodeURIComponent(i)+\"=\"+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split(\"&\");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split(\"=\");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],28:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;var parts=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];module.exports=function parseuri(str){var src=str,b=str.indexOf(\"[\"),e=str.indexOf(\"]\");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,\";\")+str.substring(e,str.length)}var m=re.exec(str||\"\"),uri={},i=14;while(i--){uri[parts[i]]=m[i]||\"\"}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,\":\");uri.authority=uri.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\");uri.ipv6uri=true}return uri}},{}],29:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports==\"object\"&&exports;var freeModule=typeof module==\"object\"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output=\"\";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error(\"Lone surrogate U+\"+codePoint.toString(16).toUpperCase()+\" is not a scalar value\")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol=\"\";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString=\"\";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error(\"Invalid byte index\")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error(\"Invalid continuation byte\")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error(\"Invalid byte index\")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error(\"Invalid UTF-8 detected\")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:\"2.0.0\",encode:utf8encode,decode:utf8decode};if(typeof define==\"function\"&&typeof define.amd==\"object\"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],30:[function(_dereq_,module,exports){\"use strict\";var alphabet=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded=\"\";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+\".\"+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],31:[function(_dereq_,module,exports){var url=_dereq_(\"./url\");var parser=_dereq_(\"socket.io-parser\");var Manager=_dereq_(\"./manager\");var debug=_dereq_(\"debug\")(\"socket.io-client\");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==\"object\"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts[\"force new connection\"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug(\"ignoring socket cache for %s\",source);io=Manager(source,opts)}else{if(!cache[id]){debug(\"new io instance for %s\",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_(\"./manager\");exports.Socket=_dereq_(\"./socket\")},{\"./manager\":32,\"./socket\":34,\"./url\":35,debug:39,\"socket.io-parser\":47}],32:[function(_dereq_,module,exports){var eio=_dereq_(\"engine.io-client\");var Socket=_dereq_(\"./socket\");var Emitter=_dereq_(\"component-emitter\");var parser=_dereq_(\"socket.io-parser\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:manager\");var indexOf=_dereq_(\"indexof\");var Backoff=_dereq_(\"backo2\");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&\"object\"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||\"/socket.io\";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState=\"closed\";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.engine.id}}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug(\"readyState %s\",this.readyState);if(~this.readyState.indexOf(\"open\"))return this;debug(\"opening %s\",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState=\"opening\";this.skipReconnect=false;var openSub=on(socket,\"open\",function(){self.onopen();fn&&fn()});var errorSub=on(socket,\"error\",function(data){debug(\"connect_error\");self.cleanup();self.readyState=\"closed\";self.emitAll(\"connect_error\",data);if(fn){var err=new Error(\"Connection error\");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug(\"connect attempt will timeout after %d\",timeout);var timer=setTimeout(function(){debug(\"connect attempt timed out after %d\",timeout);openSub.destroy();socket.close();socket.emit(\"error\",\"timeout\");self.emitAll(\"connect_timeout\",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug(\"open\");this.cleanup();this.readyState=\"open\";this.emit(\"open\");var socket=this.engine;this.subs.push(on(socket,\"data\",bind(this,\"ondata\")));this.subs.push(on(socket,\"ping\",bind(this,\"onping\")));this.subs.push(on(socket,\"pong\",bind(this,\"onpong\")));this.subs.push(on(socket,\"error\",bind(this,\"onerror\")));this.subs.push(on(socket,\"close\",bind(this,\"onclose\")));this.subs.push(on(this.decoder,\"decoded\",bind(this,\"ondecoded\")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll(\"ping\")};Manager.prototype.onpong=function(){this.emitAll(\"pong\",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit(\"packet\",packet)};Manager.prototype.onerror=function(err){debug(\"error\",err);this.emitAll(\"error\",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on(\"connecting\",onConnecting);\nsocket.on(\"connect\",function(){socket.id=self.engine.id});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug(\"writing packet %j\",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug(\"cleanup\");var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug(\"disconnect\");this.skipReconnect=true;this.reconnecting=false;if(\"opening\"==this.readyState){this.cleanup()}this.backoff.reset();this.readyState=\"closed\";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug(\"onclose\");this.cleanup();this.backoff.reset();this.readyState=\"closed\";this.emit(\"close\",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug(\"reconnect failed\");this.backoff.reset();this.emitAll(\"reconnect_failed\");this.reconnecting=false}else{var delay=this.backoff.duration();debug(\"will wait %dms before reconnect attempt\",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug(\"attempting reconnect\");self.emitAll(\"reconnect_attempt\",self.backoff.attempts);self.emitAll(\"reconnecting\",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug(\"reconnect attempt error\");self.reconnecting=false;self.reconnect();self.emitAll(\"reconnect_error\",err.data)}else{debug(\"reconnect success\");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll(\"reconnect\",attempt)}},{\"./on\":33,\"./socket\":34,backo2:36,\"component-bind\":37,\"component-emitter\":38,debug:39,\"engine.io-client\":1,indexof:42,\"socket.io-parser\":47}],33:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],34:[function(_dereq_,module,exports){var parser=_dereq_(\"socket.io-parser\");var Emitter=_dereq_(\"component-emitter\");var toArray=_dereq_(\"to-array\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:socket\");var hasBin=_dereq_(\"has-binary\");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,\"open\",bind(this,\"onopen\")),on(io,\"packet\",bind(this,\"onpacket\")),on(io,\"close\",bind(this,\"onclose\"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if(\"open\"==this.io.readyState)this.onopen();this.emit(\"connecting\");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift(\"message\");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if(\"function\"==typeof args[args.length-1]){debug(\"emitting packet with ack id %d\",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug(\"transport is open - connecting\");if(\"/\"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug(\"close (%s)\",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit(\"disconnect\",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit(\"error\",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug(\"emitting event %j\",args);if(null!=packet.id){debug(\"attaching ack callback to event\");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug(\"sending ack %j\",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if(\"function\"==typeof ack){debug(\"calling ack %s with %j\",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug(\"bad ack %s\",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit(\"connect\");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug(\"server disconnect (%s)\",this.nsp);this.destroy();this.onclose(\"io server disconnect\")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug(\"performing disconnect (%s)\",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose(\"io client disconnect\")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{\"./on\":33,\"component-bind\":37,\"component-emitter\":38,debug:39,\"has-binary\":41,\"socket.io-parser\":47,\"to-array\":51}],35:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_(\"parseuri\");var debug=_dereq_(\"debug\")(\"socket.io-client:url\");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+\"//\"+loc.host;if(\"string\"==typeof uri){if(\"/\"==uri.charAt(0)){if(\"/\"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\\/\\//.test(uri)){debug(\"protocol-less url %s\",uri);if(\"undefined\"!=typeof loc){uri=loc.protocol+\"//\"+uri}else{uri=\"https://\"+uri}}debug(\"parse %s\",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port=\"80\"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port=\"443\"}}obj.path=obj.path||\"/\";var ipv6=obj.host.indexOf(\":\")!==-1;var host=ipv6?\"[\"+obj.host+\"]\":obj.host;obj.id=obj.protocol+\"://\"+host+\":\"+obj.port;obj.href=obj.protocol+\"://\"+host+(loc&&loc.port==obj.port?\"\":\":\"+obj.port);return obj}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{debug:39,parseuri:45}],36:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],37:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if(\"string\"==typeof fn)fn=obj[fn];if(\"function\"!=typeof fn)throw new Error(\"bind() requires a function\");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],38:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[\"$\"+event]=this._callbacks[\"$\"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[\"$\"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[\"$\"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[\"$\"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[\"$\"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],39:[function(_dereq_,module,exports){arguments[4][17][0].apply(exports,arguments)},{\"./debug\":40,dup:17}],40:[function(_dereq_,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:44}],41:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON&&\"function\"==typeof obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:43}],42:[function(_dereq_,module,exports){arguments[4][23][0].apply(exports,arguments)},{dup:23}],43:[function(_dereq_,module,exports){arguments[4][24][0].apply(exports,arguments)},{dup:24}],44:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],45:[function(_dereq_,module,exports){arguments[4][28][0].apply(exports,arguments)},{dup:28}],46:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");var isBuf=_dereq_(\"./is-buffer\");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if(\"object\"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&\"object\"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&\"object\"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./is-buffer\":48,isarray:43}],47:[function(_dereq_,module,exports){var debug=_dereq_(\"debug\")(\"socket.io-parser\");var json=_dereq_(\"json3\");var isArray=_dereq_(\"isarray\");var Emitter=_dereq_(\"component-emitter\");var binary=_dereq_(\"./binary\");var isBuf=_dereq_(\"./is-buffer\");exports.protocol=4;exports.types=[\"CONNECT\",\"DISCONNECT\",\"EVENT\",\"BINARY_EVENT\",\"ACK\",\"BINARY_ACK\",\"ERROR\"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug(\"encoding packet %j\",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str=\"\";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+=\"-\"}if(obj.nsp&&\"/\"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=\",\";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=\",\";str+=json.stringify(obj.data)}debug(\"encoded %j as %s\",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if(\"string\"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit(\"decoded\",packet)}}else{this.emit(\"decoded\",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error(\"got binary data when not reconstructing a packet\")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit(\"decoded\",packet)}}}else{throw new Error(\"Unknown type: \"+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf=\"\";while(str.charAt(++i)!=\"-\"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!=\"-\"){throw new Error(\"Illegal attachments\")}p.attachments=Number(buf)}if(\"/\"==str.charAt(i+1)){p.nsp=\"\";while(++i){var c=str.charAt(i);if(\",\"==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp=\"/\"}var next=str.charAt(i+1);if(\"\"!==next&&Number(next)==next){p.id=\"\";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug(\"decoded %s as %j\",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:\"parser error\"}}},{\"./binary\":46,\"./is-buffer\":48,\"component-emitter\":49,debug:39,isarray:43,json3:50}],48:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],49:[function(_dereq_,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],50:[function(_dereq_,module,exports){(function(global){(function(){var isLoader=typeof define===\"function\"&&define.amd;var objectTypes={\"function\":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global==\"object\"&&global;if(freeGlobal&&(freeGlobal[\"global\"]===freeGlobal||freeGlobal[\"window\"]===freeGlobal||freeGlobal[\"self\"]===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root[\"Object\"]());exports||(exports=root[\"Object\"]());var Number=context[\"Number\"]||root[\"Number\"],String=context[\"String\"]||root[\"String\"],Object=context[\"Object\"]||root[\"Object\"],Date=context[\"Date\"]||root[\"Date\"],SyntaxError=context[\"SyntaxError\"]||root[\"SyntaxError\"],TypeError=context[\"TypeError\"]||root[\"TypeError\"],Math=context[\"Math\"]||root[\"Math\"],nativeJSON=context[\"JSON\"]||root[\"JSON\"];if(typeof nativeJSON==\"object\"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name==\"bug-string-char-index\"){isSupported=\"a\"[0]!=\"a\"}else if(name==\"json\"){isSupported=has(\"json-stringify\")&&has(\"json-parse\")}else{var value,serialized='{\"a\":[1,true,false,null,\"\\\\u0000\\\\b\\\\n\\\\f\\\\r\\\\t\"]}';if(name==\"json-stringify\"){var stringify=exports.stringify,stringifySupported=typeof stringify==\"function\"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)===\"0\"&&stringify(new Number)===\"0\"&&stringify(new String)=='\"\"'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)===\"1\"&&stringify([value])==\"[1]\"&&stringify([undef])==\"[null]\"&&stringify(null)==\"null\"&&stringify([undef,getClass,null])==\"[null,null,null]\"&&stringify({a:[value,true,false,null,\"\\x00\\b\\n\\f\\r\t\"]})==serialized&&stringify(null,value)===\"1\"&&stringify([1,2],null,1)==\"[\\n 1,\\n 2\\n]\"&&stringify(new Date(-864e13))=='\"-271821-04-20T00:00:00.000Z\"'&&stringify(new Date(864e13))=='\"+275760-09-13T00:00:00.000Z\"'&&stringify(new Date(-621987552e5))=='\"-000001-01-01T00:00:00.000Z\"'&&stringify(new Date(-1))=='\"1969-12-31T23:59:59.999Z\"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name==\"json-parse\"){var parse=exports.parse;if(typeof parse==\"function\"){try{if(parse(\"0\")===0&&!parse(false)){value=parse(serialized);var parseSupported=value[\"a\"].length==5&&value[\"a\"][0]===1;if(parseSupported){try{parseSupported=!parse('\"\t\"')}catch(exception){}if(parseSupported){try{parseSupported=parse(\"01\")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse(\"1.\")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has(\"json\")){var functionClass=\"[object Function]\",dateClass=\"[object Date]\",numberClass=\"[object Number]\",stringClass=\"[object String]\",arrayClass=\"[object Array]\",booleanClass=\"[object Boolean]\";var charIndexBuggy=has(\"bug-string-char-index\");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=[\"valueOf\",\"toString\",\"toLocaleString\",\"propertyIsEnumerable\",\"isPrototypeOf\",\"hasOwnProperty\",\"constructor\"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!=\"function\"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property==\"prototype\")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property==\"prototype\")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property==\"prototype\")&&isProperty.call(object,property)&&!(isConstructor=property===\"constructor\")){callback(property)}}if(isConstructor||isProperty.call(object,property=\"constructor\")){callback(property)}}}return forEach(object,callback)};if(!has(\"json-stringify\")){var Escapes={92:\"\\\\\\\\\",34:'\\\\\"',8:\"\\\\b\",12:\"\\\\f\",10:\"\\\\n\",13:\"\\\\r\",9:\"\\\\t\"};var leadingZeroes=\"000000\";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix=\"\\\\u00\";var quote=function(value){var result='\"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(\"\"):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'\"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value==\"object\"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,\"toJSON\")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?\"-\":\"+\")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+\"-\"+toPaddedString(2,month+1)+\"-\"+toPaddedString(2,date)+\"T\"+toPaddedString(2,hours)+\":\"+toPaddedString(2,minutes)+\":\"+toPaddedString(2,seconds)+\".\"+toPaddedString(3,milliseconds)+\"Z\"}else{value=null}}else if(typeof value.toJSON==\"function\"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,\"toJSON\"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return\"null\"}className=getClass.call(value);if(className==booleanClass){return\"\"+value}else if(className==numberClass){return value>-1/0&&value<1/0?\"\"+value:\"null\"}else if(className==stringClass){return quote(\"\"+value)}if(typeof value==\"object\"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?\"null\":element)}result=results.length?whitespace?\"[\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"]\":\"[\"+results.join(\",\")+\"]\":\"[]\"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+\":\"+(whitespace?\" \":\"\")+element)}});result=results.length?whitespace?\"{\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"}\":\"{\"+results.join(\",\")+\"}\":\"{}\"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace=\"\",width>10&&(width=10);whitespace.length<width;whitespace+=\" \");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize(\"\",(value={},value[\"\"]=source,value),callback,properties,whitespace,\"\",[])}}if(!has(\"json-parse\")){var fromCharCode=String.fromCharCode;var Unescapes={92:\"\\\\\",34:'\"',47:\"/\",98:\"\\b\",116:\"\t\",110:\"\\n\",102:\"\\f\",114:\"\\r\"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value=\"@\",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode(\"0x\"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)==\"true\"){Index+=4;return true}else if(source.slice(Index,Index+5)==\"false\"){Index+=5;return false}else if(source.slice(Index,Index+4)==\"null\"){Index+=4;return null}abort()}}return\"$\"};var get=function(value){var results,hasMembers;if(value==\"$\"){abort()}if(typeof value==\"string\"){if((charIndexBuggy?value.charAt(0):value[0])==\"@\"){return value.slice(1)}if(value==\"[\"){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"]\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"]\"){abort()}}else{abort()}}if(value==\",\"){abort()}results.push(get(value))}return results}else if(value==\"{\"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"}\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"}\"){abort()}}else{abort()}}if(value==\",\"||typeof value!=\"string\"||(charIndexBuggy?value.charAt(0):value[0])!=\"@\"||lex()!=\":\"){abort()}results[value.slice(1)]=get(lex())\n}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value==\"object\"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=\"\"+source;result=get(lex());if(lex()!=\"$\"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[\"\"]=result,value),\"\",callback):result}}}exports[\"runInContext\"]=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root[\"JSON3\"],isRestored=false;var JSON3=runInContext(root,root[\"JSON3\"]={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root[\"JSON3\"]=previousJSON;nativeJSON=previousJSON=null}return JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],51:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[31])(31)});\n\n    \n      ;var weight = document.getElementById('weight');\n      var socket = io('http://10.3.5.202:4001');\n      socket.on('getWeight', function(msg) {\n        weight.innerHTML = msg;\n    \n      }); \n    }, 1000);\n    </script>\n\n  </body>\n</html>\n","x":386.22222900390625,"y":967.7778005599976,"wires":[["95535d71.7a597"]]},{"id":"95535d71.7a597","type":"http response","z":"3d3d5d98.3bdb72","name":"","x":538.4444313049316,"y":963.3333559036255,"wires":[]},{"id":"55bde3ff.6475dc","type":"inject","z":"3d3d5d98.3bdb72","name":"init","topic":"","payload":"init","payloadType":"str","repeat":"","crontab":"","once":true,"x":90,"y":80,"wires":[["38bcdbe.c001b24","31a5e2b7.7dcece"]]},{"id":"31a5e2b7.7dcece","type":"function","z":"3d3d5d98.3bdb72","name":"INIT VARIABLES","func":"var p = {\n    'organizationName':'Миргородська дільниця',\n    'organizationID':'01',\n    'typeOfScale':'IoT',\n    'scale':'mir_avto1',\n    'log':0,\n    'inject':\"XB\",\n    'parser':function(v){\n            \n            v = v.replace('kg','');\n            v = v.replace('B','');\n            v = v.replace(' ','');\n            v = v.replace('\\n','');\n            v = v.replace('\\r','');\n            \n            return Number(v);\n        }\n}\nflow.set('p',p);\n\nflow.set('table',[]);\nflow.set('arrayOfWeights',[]);\nflow.set('lastWeight',0);\nflow.set('currentWeight',0);\nflow.set('lastUID','');\nflow.set('zero',false);\nflow.set('deltaWeight',250);\nflow.set('perimetrStatus',true);\nflow.set('stability',true);\nflow.set('arrayOfWeights',[]);\nflow.set('sizeOfArrayOfWeights',5);\nflow.set('inaccuracy',10);\nflow.set('config',msg.payload);\n\n//\nflow.set('events',[]);\nflow.set('log',0);\nflow.set('in',false);\nflow.set('out',true);\nflow.set('time_start',new Date());\nflow.set('time_end',new Date());\nflow.set('chat_id',0);\nflow.set('onScales_start',new Date());\nflow.set('devConnection',true);\nflow.set('diffDatemax',4);\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":80,"wires":[["b548a0c2.28464"]]},{"id":"8bd01ca3.db1ad","type":"function","z":"3d3d5d98.3bdb72","name":"SOVA","func":"var reader = msg.req.query.reader;\nmsg.payload = {\n        \"ObjectID\": \"1001\", \n        \"Value\": flow.get('currentWeight'), \n        \"ChannelNumber\": \"13\",\n        \"Type\": \"OneC\",\n        \"WUID\": msg.req.query.reader,\n        \"truck1\": msg.req.query.truck1,\n        \"truck2\": msg.req.query.truck2\n};\nreturn msg;","outputs":1,"noerr":0,"x":417.75000381469727,"y":1036.2500133514404,"wires":[["34028e6d.6e9472","b2a0b430.a23968"]]},{"id":"744e6dda.5f5c74","type":"http request","z":"3d3d5d98.3bdb72","name":"","method":"POST","ret":"txt","url":"10.3.5.205:8080","tls":"","x":1750,"y":80,"wires":[["81f55ce1.67448"]]},{"id":"81f55ce1.67448","type":"debug","z":"3d3d5d98.3bdb72","name":"","active":false,"console":"false","complete":"false","x":1910,"y":80,"wires":[]},{"id":"eb13e5ca.3ad348","type":"comment","z":"3d3d5d98.3bdb72","name":"CONTROL EVENTS","info":"","x":109,"y":1044.9999856948853,"wires":[]},{"id":"2168a683.fc149a","type":"comment","z":"3d3d5d98.3bdb72","name":"INITIALIZING","info":"","x":110,"y":20,"wires":[]},{"id":"ab3be6b8.1aa8d8","type":"ui_gauge","z":"3d3d5d98.3bdb72","name":"","group":"f2460cfc.9d535","order":2,"width":0,"height":0,"gtype":"donut","title":"Поточне значення","label":"кг.","format":"{{value}}","min":0,"max":"80000","colors":["#00b500","#e6e600","#ca3838"],"x":530,"y":300,"wires":[]},{"id":"fa3dbbf0.fcfef8","type":"function","z":"3d3d5d98.3bdb72","name":"MAKE BODY","func":"var payload = {\n \"RfidCommand\": {\n  \"__type\": \"RFIDCommandSetGPO:#ERFID.CommunicationClient.Interfaces\",\n  \"ComandReceiver\": \"PHISICAL_READER\",\n  \"ReceiverName\": msg.queryParameters.parAdress,\n    \"ChannelsConfig\": [{\n   \"GPOIndex\": 1,\n   \"TurnON\": msg.queryParameters.parTurnON1\n  },\n  {\n   \"GPOIndex\": 2,\n   \"TurnON\": msg.queryParameters.parTurnON2\n  },\n  {\n   \"GPOIndex\": 3,\n   \"TurnON\": msg.queryParameters.parTurnON3\n  },\n  {\n   \"GPOIndex\": 4,\n   \"TurnON\": msg.queryParameters.parTurnON4\n  }]\n }\n};\n\nmsg.payload = payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":1580,"y":80,"wires":[[]]},{"id":"57c1170a.7f01b8","type":"function","z":"3d3d5d98.3bdb72","name":"Truck on scales","func":"var config = flow.get('config');\n\nmsg.queryParameters = msg.queryParameters || {};\n\nif (config && config.trcukOnScales)\n{\n    msg.queryParameters.parAdress  = config.trcukOnScales.Adress; \n    msg.queryParameters.parTurnON1 = config.trcukOnScales.parTurnON1; \n    msg.queryParameters.parTurnON2 = config.trcukOnScales.parTurnON2;\n    msg.queryParameters.parTurnON3 = config.trcukOnScales.parTurnON3;\n    msg.queryParameters.parTurnON4 = config.trcukOnScales.parTurnON4;\n    \n} else {\n    \n    msg.queryParameters.parAdress  = '10.3.5.217:5084'; \n    msg.queryParameters.parTurnON1 = \"false\";\n    msg.queryParameters.parTurnON2 = \"false\";\n    msg.queryParameters.parTurnON3 = \"false\";\n    msg.queryParameters.parTurnON4 = \"false\";\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":1420,"y":40,"wires":[["fa3dbbf0.fcfef8"]]},{"id":"dbc2b656.b4d608","type":"function","z":"3d3d5d98.3bdb72","name":"Scales is empty","func":"var config = flow.get('config');\n\nmsg.queryParameters = msg.queryParameters || {};\n\nif (config && config.ScalesIsEmpty)\n{\n    msg.queryParameters.parAdress  = config.ScalesIsEmpty.Adress; \n    msg.queryParameters.parTurnON1 = config.ScalesIsEmpty.parTurnON1; \n    msg.queryParameters.parTurnON2 = config.ScalesIsEmpty.parTurnON2;\n    msg.queryParameters.parTurnON3 = config.ScalesIsEmpty.parTurnON3;\n    msg.queryParameters.parTurnON4 = config.ScalesIsEmpty.parTurnON4;\n    \n} else {\n    \n    msg.queryParameters.parAdress  = '10.3.5.217:5084'; \n    msg.queryParameters.parTurnON1 = \"true\";\n    msg.queryParameters.parTurnON2 = \"false\";\n    msg.queryParameters.parTurnON3 = \"true\";\n    msg.queryParameters.parTurnON4 = \"false\";\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":1420,"y":120,"wires":[["fa3dbbf0.fcfef8"]]},{"id":"30f57774.87bef8","type":"switch","z":"3d3d5d98.3bdb72","name":"","property":"currentWeight","propertyType":"flow","rules":[{"t":"neq","v":"0","vt":"str"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","outputs":2,"x":950,"y":60,"wires":[["c6bfe615.144d98"],["aede6cb.3c8019"]]},{"id":"b2e7399d.236558","type":"function","z":"3d3d5d98.3bdb72","name":"MAKE PAGE","func":"var payload = '';\npayload = 'Вес: '+msg.payload;\nmsg.payload = payload;\nreturn msg;","outputs":1,"noerr":0,"x":564.444465637207,"y":184.44443893432617,"wires":[["9ff04266.08783"]]},{"id":"6b3acadb.2d9d34","type":"comment","z":"3d3d5d98.3bdb72","name":"TRAFFIC LIGHT","info":"!","x":900,"y":20,"wires":[]},{"id":"66fd12ad.ce824c","type":"function","z":"3d3d5d98.3bdb72","name":"STATUS","func":"var UID = msg.req.query.reader;\nvar lastUID = flow.get('lastUID');\nvar zero    =  flow.get('zero');\n\nif (UID!==lastUID && !zero) \n{\n    msg.statusZero = false;    \n} else {\n    \n    msg.statusZero = true;\n    flow.set('zero',false);\n    flow.set('lastUID',UID);\n}\n\nmsg.uid = UID; \n\nmsg.payload = zero;\nreturn msg;\n","outputs":1,"noerr":0,"x":560.2500076293945,"y":618.7500104904175,"wires":[["da3eb796.8b7768"]]},{"id":"ed050f7d.01948","type":"function","z":"3d3d5d98.3bdb72","name":"Logging to table","func":"var table = flow.get('table');\nvar currentWeight = flow.get('currentWeight');\nvar obj = {\n    'datetime': new Date(),\n    'uid': msg.uid,\n    'weight': currentWeight\n    \n};\ntable.push(obj);\nflow.set('table',table);\nflow.set('lastWeight',currentWeight);\nmsg.payload = obj;\nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":160,"wires":[[]]},{"id":"4406301c.eb175","type":"ui_chart","z":"3d3d5d98.3bdb72","name":"","group":"f2460cfc.9d535","order":1,"width":0,"height":0,"label":"Графік за останні 5 хвилин","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"0","ymax":"80000","removeOlder":"5","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"x":530,"y":340,"wires":[[],[]]},{"id":"2df42f53.9c5d8","type":"function","z":"3d3d5d98.3bdb72","name":"MAKE BODY","func":"msg.payload = {\n    weight: flow.get('currentWeight'),\n    status:msg.statusZero,\n    stable:flow.get('stability'),    \n    perimetr:flow.get('perimetrStatus')\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":930,"y":680,"wires":[["82a6f2be.a4dfe"]]},{"id":"3b2e2402.919fbc","type":"http response","z":"3d3d5d98.3bdb72","name":"","x":1270,"y":680,"wires":[]},{"id":"82a6f2be.a4dfe","type":"function","z":"3d3d5d98.3bdb72","name":"CHECK RESULT","func":"var result = msg.payload;\n\nif((result.stable === false) || (result.status === false) || (result.perimetr === false))\n{\n    result.err = \"Помилка при зважуванні:  \";\n}\nmsg.payload = result;\nreturn msg;\n","outputs":1,"noerr":0,"x":1110,"y":680,"wires":[["3b2e2402.919fbc","d196e927.45b068"]]},{"id":"34028e6d.6e9472","type":"http request","z":"3d3d5d98.3bdb72","name":"","method":"POST","ret":"txt","url":"http://10.45.1.60:8081/event","tls":"","x":614.0000076293945,"y":1020.0000152587891,"wires":[[]]},{"id":"149fffa4.fe805","type":"debug","z":"3d3d5d98.3bdb72","name":"","active":false,"console":"false","complete":"payload","x":296,"y":279,"wires":[]},{"id":"ee31f16e.9d93f","type":"function","z":"3d3d5d98.3bdb72","name":"STABLE","func":"var arrayOfWeights       = flow.get('arrayOfWeights');\nvar sizeOfArrayOfWeights = flow.get('sizeOfArrayOfWeights');\nvar inaccuracy           = flow.get('inaccuracy');\nvar size = arrayOfWeights.length - 1 - sizeOfArrayOfWeights;\n\narrayOfWeights.push(msg.payload);\n\n\nif (size > 0){\n    \n    flow.set('stability',true);\n    \n    for (var i = 0; i <= sizeOfArrayOfWeights; i++ ){\n        var ai = (arrayOfWeights.length - 1 - i);\n        var bi = (ai - 1);\n        var a = arrayOfWeights[ai];\n        var b = arrayOfWeights[bi];\n        if ((a-b)>inaccuracy || (a-b)<-inaccuracy){\n            flow.set('stability',false);\n            break;\n        }\n    }\n    \n}else {\n    flow.set('stability',false);\n}\n\nflow.set('arrayOfWeights',arrayOfWeights);\nmsg.payload = flow.get('stability');\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":260,"wires":[["449972ad.8873dc"]]},{"id":"449972ad.8873dc","type":"ui_text","z":"3d3d5d98.3bdb72","group":"f2460cfc.9d535","order":0,"width":0,"height":0,"name":"","label":"Стабільність","format":"{{msg.payload}}","layout":"col-center","x":723.3333435058594,"y":383.33332443237305,"wires":[]},{"id":"dde2a974.ff4f98","type":"inject","z":"3d3d5d98.3bdb72","name":"","topic":"","payload":"arrayOfWeights","payloadType":"flow","repeat":"","crontab":"","once":false,"x":115,"y":1103.9999856948853,"wires":[["7c2c5c4f.e10f44"]]},{"id":"7c2c5c4f.e10f44","type":"debug","z":"3d3d5d98.3bdb72","name":"","active":true,"console":"false","complete":"false","x":335,"y":1103.9999856948853,"wires":[]},{"id":"ff8ca970.6f9ca8","type":"function","z":"89e4584a.994288","name":"INIT VARIABLES","func":"var p = {\n    'organizationName':'Миргородська дільниця',\n    'organizationID':'01',\n    'typeOfScale':'IoT',\n    'scale':'mir_avto2',\n    'log':0,\n    'inject':String.fromCharCode(2)+\"2UB\",\n    'parser':function(v){\n            \n            v = v.replace('2UB','');\n            v = v.replace(String.fromCharCode(2),'');\n            v = v.replace(String.fromCharCode(3),'');\n            return Number(v);\n            \n        }\n}\nflow.set('p',p);\n\nflow.set('table',[]);\nflow.set('arrayOfWeights',[]);\nflow.set('lastWeight',0);\nflow.set('currentWeight',0);\nflow.set('lastUID','');\nflow.set('zero',false);\nflow.set('deltaWeight',250);\nflow.set('perimetrStatus',true);\nflow.set('stability',true);\nflow.set('arrayOfWeights',[]);\nflow.set('sizeOfArrayOfWeights',5);\nflow.set('inaccuracy',10);\nflow.set('config',msg.payload);\n\n//\nflow.set('events',[]);\nflow.set('log',0);\nflow.set('in',false);\nflow.set('out',true);\nflow.set('time_start',new Date());\nflow.set('time_end',new Date());\nflow.set('chat_id',0);\nflow.set('onScales_start',new Date());\nflow.set('devConnection',true);\nflow.set('diffDatemax',4);\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":80,"wires":[["18dd8f6.dbd1f71"]]},{"id":"21ca2fab.bfdd3","type":"inject","z":"89e4584a.994288","name":"","topic":"","payload":"p.inject","payloadType":"flow","repeat":"1","crontab":"","once":false,"x":96,"y":179,"wires":[["b4c4f25e.97431"]]},{"id":"b4c4f25e.97431","type":"serial out","z":"89e4584a.994288","name":"","serial":"ddc9d29a.27599","x":296,"y":179,"wires":[]},{"id":"3d9a74f5.469e5c","type":"serial in","z":"89e4584a.994288","name":"","serial":"ddc9d29a.27599","x":96,"y":239,"wires":[["752db750.04d268","5df2d00a.3df69"]]},{"id":"752db750.04d268","type":"function","z":"89e4584a.994288","name":"GET WEIGHT","func":"var v = msg.payload;\nvar p = flow.get('p');\nvar currentWeight = p.parser(v);\n\nflow.set('currentWeight',currentWeight);\n\nmsg.queryParameters = msg.queryParameters || {};\nmsg.queryParameters.parWeight = currentWeight;\nmsg.queryParameters.parDate   = new Date();\nmsg.queryParameters.parSource = p.source;\nmsg.queryParameters.parScale  = p.scale;\nmsg.payload                   = currentWeight;\n\nreturn msg;","outputs":1,"noerr":0,"x":286,"y":239,"wires":[["fa4c250e.4b54d8","1576c770.3fe9f9","7671c447.e5418c","5e933c89.03f964","458850bf.34a29"]]},{"id":"50c0be54.3a3dd","type":"http in","z":"89e4584a.994288","name":"","url":"/mir_avto2/status","method":"get","swaggerDoc":"","x":145,"y":585.7142601013184,"wires":[["a2bdfab7.40ef48","aea231cd.e2592","a95a5dd2.cddfe","68a2497d.6c45c8"]]},{"id":"16cc6092.d94b3f","type":"http in","z":"89e4584a.994288","name":"","url":"/mir_avto2","method":"get","swaggerDoc":"","x":125,"y":642.4285697937012,"wires":[["a874dfba.4ecad","aea231cd.e2592","a95a5dd2.cddfe","668ed0f.eccf23","5c47420e.69a78c"]]},{"id":"a874dfba.4ecad","type":"function","z":"89e4584a.994288","name":"FAST WEIGHT","func":"msg.payload = {\n    weight: flow.get('currentWeight'),\n    status:true,\n    stable:true,    \n    perimetr:true\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":408.2857208251953,"y":652.4285430908203,"wires":[["d02a8882.765418","ed107599.c4d268"]]},{"id":"d02a8882.765418","type":"http response","z":"89e4584a.994288","name":"","x":573.2857437133789,"y":652.4285373687744,"wires":[]},{"id":"7b46b8ce.da4b18","type":"comment","z":"89e4584a.994288","name":"Device level","info":"","x":90,"y":140,"wires":[]},{"id":"16cc1128.d698bf","type":"comment","z":"89e4584a.994288","name":"INTEGRATION LEVEL (API)","info":"","x":134,"y":441,"wires":[]},{"id":"9d4f91fa.9997d","type":"socket-io-out","z":"89e4584a.994288","name":"getWeight","event":"60d70e98.4788b","server":"73140961.690048","x":730,"y":200,"wires":[]},{"id":"fc68d0eb.f0702","type":"http in","z":"89e4584a.994288","name":"","url":"/mir_avto2/socket","method":"get","swaggerDoc":"","x":146.85714721679688,"y":769.5714092254639,"wires":[["58aa2bf0.337fa4"]]},{"id":"58aa2bf0.337fa4","type":"template","z":"89e4584a.994288","name":"socket page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n     <style>\n        #circle1 {\n      width: 50px;\n      height: 50px;\n      -webkit-border-radius: 25px;\n      -moz-border-radius: 25px;\n      border-radius: 25px;\n      background: blue;\n      margin-bottom: 10px;\n    }\n    \n    </style>\n  <body>\n    <h1><p id='weight'></p></h1>\n    \n     <script>\n    setTimeout(function() {\n       ;(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.io=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_(\"./lib/\")},{\"./lib/\":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_(\"./socket\");module.exports.parser=_dereq_(\"engine.io-parser\")},{\"./socket\":3,\"engine.io-parser\":19}],3:[function(_dereq_,module,exports){(function(global){var transports=_dereq_(\"./transports\");var Emitter=_dereq_(\"component-emitter\");var debug=_dereq_(\"debug\")(\"engine.io-client:socket\");var index=_dereq_(\"indexof\");var parser=_dereq_(\"engine.io-parser\");var parseuri=_dereq_(\"parseuri\");var parsejson=_dereq_(\"parsejson\");var parseqs=_dereq_(\"parseqs\");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&\"object\"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==\"https\"||uri.protocol==\"wss\";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&\"https:\"==location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?\"443\":\"80\"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:\"localhost\");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if(\"string\"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||\"t\";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||[\"polling\",\"websocket\"];this.readyState=\"\";this.writeBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?null:opts.rejectUnauthorized;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}}this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_(\"./transport\");Socket.transports=_dereq_(\"./transports\");Socket.parser=_dereq_(\"engine.io-parser\");Socket.prototype.createTransport=function(name){debug('creating transport \"%s\"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf(\"websocket\")!=-1){transport=\"websocket\"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit(\"error\",\"No transports available\")},0);return}else{transport=this.transports[0]}this.readyState=\"opening\";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug(\"setting transport %s\",transport.name);var self=this;if(this.transport){debug(\"clearing existing transport %s\",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on(\"drain\",function(){self.onDrain()}).on(\"packet\",function(packet){self.onPacket(packet)}).on(\"error\",function(e){self.onError(e)}).on(\"close\",function(){self.onClose(\"transport close\")})};Socket.prototype.probe=function(name){debug('probing transport \"%s\"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport \"%s\" opened',name);transport.send([{type:\"ping\",data:\"probe\"}]);transport.once(\"packet\",function(msg){if(failed)return;if(\"pong\"==msg.type&&\"probe\"==msg.data){debug('probe transport \"%s\" pong',name);self.upgrading=true;self.emit(\"upgrading\",transport);if(!transport)return;Socket.priorWebsocketSuccess=\"websocket\"==transport.name;debug('pausing current transport \"%s\"',self.transport.name);self.transport.pause(function(){if(failed)return;if(\"closed\"==self.readyState)return;debug(\"changing transport and sending upgrade packet\");cleanup();self.setTransport(transport);transport.send([{type:\"upgrade\"}]);self.emit(\"upgrade\",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport \"%s\" failed',name);var err=new Error(\"probe error\");err.transport=transport.name;self.emit(\"upgradeError\",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error(\"probe error: \"+err);error.transport=transport.name;freezeTransport();debug('probe transport \"%s\" failed because of error: %s',name,err);self.emit(\"upgradeError\",error)}function onTransportClose(){onerror(\"transport closed\")}function onclose(){onerror(\"socket closed\")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('\"%s\" works - aborting \"%s\"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener(\"open\",onTransportOpen);transport.removeListener(\"error\",onerror);transport.removeListener(\"close\",onTransportClose);self.removeListener(\"close\",onclose);self.removeListener(\"upgrading\",onupgrade)}transport.once(\"open\",onTransportOpen);transport.once(\"error\",onerror);transport.once(\"close\",onTransportClose);this.once(\"close\",onclose);this.once(\"upgrading\",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug(\"socket open\");this.readyState=\"open\";Socket.priorWebsocketSuccess=\"websocket\"==this.transport.name;this.emit(\"open\");this.flush();if(\"open\"==this.readyState&&this.upgrade&&this.transport.pause){debug(\"starting upgrade probes\");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if(\"opening\"==this.readyState||\"open\"==this.readyState){debug('socket receive: type \"%s\", data \"%s\"',packet.type,packet.data);this.emit(\"packet\",packet);this.emit(\"heartbeat\");switch(packet.type){case\"open\":this.onHandshake(parsejson(packet.data));break;case\"pong\":this.setPing();this.emit(\"pong\");break;case\"error\":var err=new Error(\"server error\");err.code=packet.data;this.onError(err);break;case\"message\":this.emit(\"data\",packet.data);this.emit(\"message\",packet.data);break}}else{debug('packet received with socket readyState \"%s\"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit(\"handshake\",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if(\"closed\"==this.readyState)return;this.setPing();this.removeListener(\"heartbeat\",this.onHeartbeat);this.on(\"heartbeat\",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if(\"closed\"==self.readyState)return;self.onClose(\"ping timeout\")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug(\"writing ping packet - expecting pong within %sms\",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket(\"ping\",function(){self.emit(\"ping\")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit(\"drain\")}else{this.flush()}};Socket.prototype.flush=function(){if(\"closed\"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug(\"flushing %d packets in socket\",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit(\"flush\")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket(\"message\",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if(\"function\"==typeof data){fn=data;data=undefined}if(\"function\"==typeof options){fn=options;options=null}if(\"closing\"==this.readyState||\"closed\"==this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit(\"packetCreate\",packet);this.writeBuffer.push(packet);if(fn)this.once(\"flush\",fn);this.flush()};Socket.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.readyState=\"closing\";var self=this;if(this.writeBuffer.length){this.once(\"drain\",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose(\"forced close\");debug(\"socket closing - telling transport to close\");self.transport.close()}function cleanupAndClose(){self.removeListener(\"upgrade\",cleanupAndClose);self.removeListener(\"upgradeError\",cleanupAndClose);close()}function waitForUpgrade(){self.once(\"upgrade\",cleanupAndClose);self.once(\"upgradeError\",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug(\"socket error %j\",err);Socket.priorWebsocketSuccess=false;this.emit(\"error\",err);this.onClose(\"transport error\",err)};Socket.prototype.onClose=function(reason,desc){if(\"opening\"==this.readyState||\"open\"==this.readyState||\"closing\"==this.readyState){debug('socket close with reason: \"%s\"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners(\"close\");this.transport.close();this.transport.removeAllListeners();this.readyState=\"closed\";this.id=null;this.emit(\"close\",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./transport\":4,\"./transports\":5,\"component-emitter\":15,debug:17,\"engine.io-parser\":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(_dereq_,module,exports){var parser=_dereq_(\"engine.io-parser\");var Emitter=_dereq_(\"component-emitter\");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState=\"\";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type=\"TransportError\";err.description=desc;this.emit(\"error\",err);return this};Transport.prototype.open=function(){if(\"closed\"==this.readyState||\"\"==this.readyState){this.readyState=\"opening\";this.doOpen()}return this};Transport.prototype.close=function(){if(\"opening\"==this.readyState||\"open\"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if(\"open\"==this.readyState){this.write(packets)}else{throw new Error(\"Transport not open\")}};Transport.prototype.onOpen=function(){this.readyState=\"open\";this.writable=true;this.emit(\"open\")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit(\"packet\",packet)};Transport.prototype.onClose=function(){this.readyState=\"closed\";this.emit(\"close\")}},{\"component-emitter\":15,\"engine.io-parser\":19}],5:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var XHR=_dereq_(\"./polling-xhr\");var JSONP=_dereq_(\"./polling-jsonp\");var websocket=_dereq_(\"./websocket\");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if(\"open\"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error(\"JSONP disabled\");return new JSONP(opts)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling-jsonp\":6,\"./polling-xhr\":7,\"./websocket\":9,\"xmlhttprequest-ssl\":10}],6:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_(\"./polling\");var inherit=_dereq_(\"component-inherit\");module.exports=JSONPPolling;var rNewline=/\\n/g;var rEscapedNewline=/\\\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener(\"beforeunload\",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement(\"script\");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError(\"jsonp poll error\",e)};var insertAt=document.getElementsByTagName(\"script\")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko=\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement(\"iframe\");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement(\"form\");var area=document.createElement(\"textarea\");var id=this.iframeId=\"eio_iframe_\"+this.index;var iframe;form.className=\"socketio\";form.style.position=\"absolute\";form.style.top=\"-1000px\";form.style.left=\"-1000px\";form.target=id;form.method=\"POST\";form.setAttribute(\"accept-charset\",\"utf-8\");area.name=\"d\";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError(\"jsonp polling iframe removal error\",e)}}try{var html='<iframe src=\"javascript:0\" name=\"'+self.iframeId+'\">';iframe=document.createElement(html)}catch(e){iframe=document.createElement(\"iframe\");iframe.name=self.iframeId;iframe.src=\"javascript:0\"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,\"\\\\\\n\");this.area.value=data.replace(rNewline,\"\\\\n\");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==\"complete\"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-inherit\":16}],7:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var Polling=_dereq_(\"./polling\");var Emitter=_dereq_(\"component-emitter\");var inherit=_dereq_(\"component-inherit\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling-xhr\");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL=\"https:\"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}else{this.extraHeaders=opts.extraHeaders}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!==\"string\"&&data!==undefined;var req=this.request({method:\"POST\",data:data,isBinary:isBinary});var self=this;req.on(\"success\",fn);req.on(\"error\",function(err){self.onError(\"xhr post error\",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug(\"xhr poll\");var req=this.request();var self=this;req.on(\"data\",function(data){self.onData(data)});req.on(\"error\",function(err){self.onError(\"xhr poll error\",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||\"GET\";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug(\"xhr open %s: %s\",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){xhr.responseType=\"arraybuffer\"}if(\"POST\"==this.method){try{if(this.isBinary){xhr.setRequestHeader(\"Content-type\",\"application/octet-stream\")}else{xhr.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}}catch(e){}}if(\"withCredentials\"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug(\"xhr data %s\",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit(\"success\");this.cleanup()};Request.prototype.onData=function(data){this.emit(\"data\",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit(\"error\",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if(\"undefined\"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader(\"Content-Type\").split(\";\")[0]}catch(e){}if(contentType===\"application/octet-stream\"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var ui8Arr=new Uint8Array(this.xhr.response);var dataArray=[];for(var idx=0,length=ui8Arr.length;idx<length;idx++){dataArray.push(ui8Arr[idx])}data=String.fromCharCode.apply(null,dataArray)}}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return\"undefined\"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent(\"onunload\",unloadHandler)}else if(global.addEventListener){global.addEventListener(\"beforeunload\",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./polling\":8,\"component-emitter\":15,\"component-inherit\":16,debug:17,\"xmlhttprequest-ssl\":10}],8:[function(_dereq_,module,exports){var Transport=_dereq_(\"../transport\");var parseqs=_dereq_(\"parseqs\");var parser=_dereq_(\"engine.io-parser\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:polling\");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_(\"xmlhttprequest-ssl\");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name=\"polling\";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState=\"pausing\";function pause(){debug(\"paused\");self.readyState=\"paused\";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug(\"we are currently polling - waiting to pause\");total++;this.once(\"pollComplete\",function(){debug(\"pre-pause polling complete\");--total||pause()})}if(!this.writable){debug(\"we are currently writing - waiting to pause\");total++;this.once(\"drain\",function(){debug(\"pre-pause writing complete\");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug(\"polling\");this.polling=true;this.doPoll();this.emit(\"poll\")};Polling.prototype.onData=function(data){var self=this;debug(\"polling got data %s\",data);var callback=function(packet,index,total){if(\"opening\"==self.readyState){self.onOpen()}if(\"close\"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if(\"closed\"!=this.readyState){this.polling=false;this.emit(\"pollComplete\");if(\"open\"==this.readyState){this.poll()}else{debug('ignoring poll - transport state \"%s\"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug(\"writing close packet\");self.write([{type:\"close\"}])}if(\"open\"==this.readyState){debug(\"transport open - closing\");close()}else{debug(\"transport not open - deferring close\");this.once(\"open\",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit(\"drain\")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"https\":\"http\";var port=\"\";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&(\"https\"==schema&&this.port!=443||\"http\"==schema&&this.port!=80)){port=\":\"+this.port}if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query}},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,\"xmlhttprequest-ssl\":10,yeast:30}],9:[function(_dereq_,module,exports){(function(global){var Transport=_dereq_(\"../transport\");var parser=_dereq_(\"engine.io-parser\");var parseqs=_dereq_(\"parseqs\");var inherit=_dereq_(\"component-inherit\");var yeast=_dereq_(\"yeast\");var debug=_dereq_(\"debug\")(\"engine.io-client:websocket\");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window===\"undefined\"){try{WebSocket=_dereq_(\"ws\")}catch(e){}}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name=\"websocket\";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}this.ws=BrowserWebSocket?new WebSocket(uri):new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType=\"buffer\"}else{this.ws.binaryType=\"arraybuffer\"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError(\"websocket error\",e)}};if(\"undefined\"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!BrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len=\"string\"==typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(BrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug(\"websocket closed before onclose event\")}--total||done()})})(packets[i])}function done(){self.emit(\"flush\");setTimeout(function(){self.writable=true;self.emit(\"drain\")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!==\"undefined\"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?\"wss\":\"ws\";var port=\"\";if(this.port&&(\"wss\"==schema&&this.port!=443||\"ws\"==schema&&this.port!=80)){port=\":\"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query=\"?\"+query}var ipv6=this.hostname.indexOf(\":\")!==-1;return schema+\"://\"+(ipv6?\"[\"+this.hostname+\"]\":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!(\"__initialize\"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"../transport\":4,\"component-inherit\":16,debug:17,\"engine.io-parser\":19,parseqs:27,ws:undefined,yeast:30}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_(\"has-cors\");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if(\"undefined\"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(e){}}}},{\"has-cors\":22}],11:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error(\"after called too many times\")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],12:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],13:[function(_dereq_,module,exports){(function(chars){\"use strict\";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64=\"\";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];\nbase64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+\"=\"}else if(len%3===1){base64=base64.substring(0,base64.length-2)+\"==\"}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]===\"=\"){bufferLength--;if(base64[base64.length-2]===\"=\"){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\")},{}],14:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob([\"hi\"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],15:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],16:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],17:[function(_dereq_,module,exports){exports=module.exports=_dereq_(\"./debug\");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=\"undefined\"!=typeof chrome&&\"undefined\"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"];function useColors(){return\"WebkitAppearance\"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?\"%c\":\"\")+this.namespace+(useColors?\" %c\":\" \")+args[0]+(useColors?\"%c \":\" \")+\"+\"+exports.humanize(this.diff);if(!useColors)return args;var c=\"color: \"+this.color;args=[args[0],c,\"color: inherit\"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if(\"%%\"===match)return;index++;if(\"%c\"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return\"object\"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem(\"debug\")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{\"./debug\":18}],18:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_(\"ms\");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if(\"string\"!==typeof args[0]){args=[\"%o\"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match===\"%%\")return match;index++;var formatter=exports.formatters[format];if(\"function\"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if(\"function\"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||\"\").split(/[\\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\\*/g,\".*?\");if(namespaces[0]===\"-\"){exports.skips.push(new RegExp(\"^\"+namespaces.substr(1)+\"$\"))}else{exports.names.push(new RegExp(\"^\"+namespaces+\"$\"))}}}function disable(){exports.enable(\"\")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:25}],19:[function(_dereq_,module,exports){(function(global){var keys=_dereq_(\"./keys\");var hasBinary=_dereq_(\"has-binary\");var sliceBuffer=_dereq_(\"arraybuffer.slice\");var base64encoder=_dereq_(\"base64-arraybuffer\");var after=_dereq_(\"after\");var utf8=_dereq_(\"utf8\");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:\"error\",data:\"parser error\"};var Blob=_dereq_(\"blob\");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if(\"function\"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if(\"function\"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(\"\"+encoded)};function encodeBase64Object(packet,callback){var message=\"b\"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message=\"b\"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(\",\")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data==\"string\"||data===undefined){if(data.charAt(0)==\"b\"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType===\"blob\"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType===\"blob\"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary==\"function\"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback(\"0:\")}function setLengthHeader(message){return message.length+\":\"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(\"\"))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!=\"string\"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var packet;if(data==\"\"){return callback(err,0,1)}var length=\"\",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(\":\"!=chr){length+=chr}else{if(\"\"==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=\"\"}}if(length!=\"\"){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p===\"string\"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p===\"string\";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded===\"string\"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType===\"function\"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength=\"\";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg=\"\";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./keys\":20,after:11,\"arraybuffer.slice\":12,\"base64-arraybuffer\":13,blob:14,\"has-binary\":21,utf8:29}],20:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],21:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:24}],22:[function(_dereq_,module,exports){try{module.exports=typeof XMLHttpRequest!==\"undefined\"&&\"withCredentials\"in new XMLHttpRequest}catch(err){module.exports=false}},{}],23:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],24:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)==\"[object Array]\"}},{}],25:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if(\"string\"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=\"\"+str;if(str.length>1e4)return;var match=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||\"ms\").toLowerCase();switch(type){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return n*y;case\"days\":case\"day\":case\"d\":return n*d;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return n*h;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return n*m;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return n*s;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+\"d\";if(ms>=h)return Math.round(ms/h)+\"h\";if(ms>=m)return Math.round(ms/m)+\"m\";if(ms>=s)return Math.round(ms/s)+\"s\";return ms+\"ms\"}function long(ms){return plural(ms,d,\"day\")||plural(ms,h,\"hour\")||plural(ms,m,\"minute\")||plural(ms,s,\"second\")||ms+\" ms\"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+\" \"+name;return Math.ceil(ms/n)+\" \"+name+\"s\"}},{}],26:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\\],:{}\\s]*$/;var rvalidescape=/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\\s*\\[)+/g;var rtrimLeft=/^\\s+/;var rtrimRight=/\\s+$/;module.exports=function parsejson(data){if(\"string\"!=typeof data||!data){return null}data=data.replace(rtrimLeft,\"\").replace(rtrimRight,\"\");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,\"@\").replace(rvalidtokens,\"]\").replace(rvalidbraces,\"\"))){return new Function(\"return \"+data)()}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],27:[function(_dereq_,module,exports){exports.encode=function(obj){var str=\"\";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+=\"&\";str+=encodeURIComponent(i)+\"=\"+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split(\"&\");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split(\"=\");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],28:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;var parts=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];module.exports=function parseuri(str){var src=str,b=str.indexOf(\"[\"),e=str.indexOf(\"]\");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,\";\")+str.substring(e,str.length)}var m=re.exec(str||\"\"),uri={},i=14;while(i--){uri[parts[i]]=m[i]||\"\"}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,\":\");uri.authority=uri.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\");uri.ipv6uri=true}return uri}},{}],29:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports==\"object\"&&exports;var freeModule=typeof module==\"object\"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global==\"object\"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output=\"\";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error(\"Lone surrogate U+\"+codePoint.toString(16).toUpperCase()+\" is not a scalar value\")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol=\"\";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString=\"\";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error(\"Invalid byte index\")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error(\"Invalid continuation byte\")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error(\"Invalid byte index\")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error(\"Invalid continuation byte\")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error(\"Invalid UTF-8 detected\")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:\"2.0.0\",encode:utf8encode,decode:utf8decode};if(typeof define==\"function\"&&typeof define.amd==\"object\"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],30:[function(_dereq_,module,exports){\"use strict\";var alphabet=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded=\"\";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+\".\"+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],31:[function(_dereq_,module,exports){var url=_dereq_(\"./url\");var parser=_dereq_(\"socket.io-parser\");var Manager=_dereq_(\"./manager\");var debug=_dereq_(\"debug\")(\"socket.io-client\");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==\"object\"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts[\"force new connection\"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug(\"ignoring socket cache for %s\",source);io=Manager(source,opts)}else{if(!cache[id]){debug(\"new io instance for %s\",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_(\"./manager\");exports.Socket=_dereq_(\"./socket\")},{\"./manager\":32,\"./socket\":34,\"./url\":35,debug:39,\"socket.io-parser\":47}],32:[function(_dereq_,module,exports){var eio=_dereq_(\"engine.io-client\");var Socket=_dereq_(\"./socket\");var Emitter=_dereq_(\"component-emitter\");var parser=_dereq_(\"socket.io-parser\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:manager\");var indexOf=_dereq_(\"indexof\");var Backoff=_dereq_(\"backo2\");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&\"object\"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||\"/socket.io\";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState=\"closed\";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.engine.id}}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug(\"readyState %s\",this.readyState);if(~this.readyState.indexOf(\"open\"))return this;debug(\"opening %s\",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState=\"opening\";this.skipReconnect=false;var openSub=on(socket,\"open\",function(){self.onopen();fn&&fn()});var errorSub=on(socket,\"error\",function(data){debug(\"connect_error\");self.cleanup();self.readyState=\"closed\";self.emitAll(\"connect_error\",data);if(fn){var err=new Error(\"Connection error\");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug(\"connect attempt will timeout after %d\",timeout);var timer=setTimeout(function(){debug(\"connect attempt timed out after %d\",timeout);openSub.destroy();socket.close();socket.emit(\"error\",\"timeout\");self.emitAll(\"connect_timeout\",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug(\"open\");this.cleanup();this.readyState=\"open\";this.emit(\"open\");var socket=this.engine;this.subs.push(on(socket,\"data\",bind(this,\"ondata\")));this.subs.push(on(socket,\"ping\",bind(this,\"onping\")));this.subs.push(on(socket,\"pong\",bind(this,\"onpong\")));this.subs.push(on(socket,\"error\",bind(this,\"onerror\")));this.subs.push(on(socket,\"close\",bind(this,\"onclose\")));this.subs.push(on(this.decoder,\"decoded\",bind(this,\"ondecoded\")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll(\"ping\")};Manager.prototype.onpong=function(){this.emitAll(\"pong\",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit(\"packet\",packet)};Manager.prototype.onerror=function(err){debug(\"error\",err);this.emitAll(\"error\",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on(\"connecting\",onConnecting);\nsocket.on(\"connect\",function(){socket.id=self.engine.id});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug(\"writing packet %j\",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug(\"cleanup\");var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug(\"disconnect\");this.skipReconnect=true;this.reconnecting=false;if(\"opening\"==this.readyState){this.cleanup()}this.backoff.reset();this.readyState=\"closed\";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug(\"onclose\");this.cleanup();this.backoff.reset();this.readyState=\"closed\";this.emit(\"close\",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug(\"reconnect failed\");this.backoff.reset();this.emitAll(\"reconnect_failed\");this.reconnecting=false}else{var delay=this.backoff.duration();debug(\"will wait %dms before reconnect attempt\",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug(\"attempting reconnect\");self.emitAll(\"reconnect_attempt\",self.backoff.attempts);self.emitAll(\"reconnecting\",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug(\"reconnect attempt error\");self.reconnecting=false;self.reconnect();self.emitAll(\"reconnect_error\",err.data)}else{debug(\"reconnect success\");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll(\"reconnect\",attempt)}},{\"./on\":33,\"./socket\":34,backo2:36,\"component-bind\":37,\"component-emitter\":38,debug:39,\"engine.io-client\":1,indexof:42,\"socket.io-parser\":47}],33:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],34:[function(_dereq_,module,exports){var parser=_dereq_(\"socket.io-parser\");var Emitter=_dereq_(\"component-emitter\");var toArray=_dereq_(\"to-array\");var on=_dereq_(\"./on\");var bind=_dereq_(\"component-bind\");var debug=_dereq_(\"debug\")(\"socket.io-client:socket\");var hasBin=_dereq_(\"has-binary\");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,\"open\",bind(this,\"onopen\")),on(io,\"packet\",bind(this,\"onpacket\")),on(io,\"close\",bind(this,\"onclose\"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if(\"open\"==this.io.readyState)this.onopen();this.emit(\"connecting\");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift(\"message\");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if(\"function\"==typeof args[args.length-1]){debug(\"emitting packet with ack id %d\",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug(\"transport is open - connecting\");if(\"/\"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug(\"close (%s)\",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit(\"disconnect\",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit(\"error\",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug(\"emitting event %j\",args);if(null!=packet.id){debug(\"attaching ack callback to event\");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug(\"sending ack %j\",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if(\"function\"==typeof ack){debug(\"calling ack %s with %j\",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug(\"bad ack %s\",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit(\"connect\");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug(\"server disconnect (%s)\",this.nsp);this.destroy();this.onclose(\"io server disconnect\")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug(\"performing disconnect (%s)\",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose(\"io client disconnect\")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{\"./on\":33,\"component-bind\":37,\"component-emitter\":38,debug:39,\"has-binary\":41,\"socket.io-parser\":47,\"to-array\":51}],35:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_(\"parseuri\");var debug=_dereq_(\"debug\")(\"socket.io-client:url\");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+\"//\"+loc.host;if(\"string\"==typeof uri){if(\"/\"==uri.charAt(0)){if(\"/\"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\\/\\//.test(uri)){debug(\"protocol-less url %s\",uri);if(\"undefined\"!=typeof loc){uri=loc.protocol+\"//\"+uri}else{uri=\"https://\"+uri}}debug(\"parse %s\",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port=\"80\"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port=\"443\"}}obj.path=obj.path||\"/\";var ipv6=obj.host.indexOf(\":\")!==-1;var host=ipv6?\"[\"+obj.host+\"]\":obj.host;obj.id=obj.protocol+\"://\"+host+\":\"+obj.port;obj.href=obj.protocol+\"://\"+host+(loc&&loc.port==obj.port?\"\":\":\"+obj.port);return obj}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{debug:39,parseuri:45}],36:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],37:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if(\"string\"==typeof fn)fn=obj[fn];if(\"function\"!=typeof fn)throw new Error(\"bind() requires a function\");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],38:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[\"$\"+event]=this._callbacks[\"$\"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[\"$\"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[\"$\"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[\"$\"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[\"$\"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],39:[function(_dereq_,module,exports){arguments[4][17][0].apply(exports,arguments)},{\"./debug\":40,dup:17}],40:[function(_dereq_,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:44}],41:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&\"object\"==typeof obj){if(obj.toJSON&&\"function\"==typeof obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{isarray:43}],42:[function(_dereq_,module,exports){arguments[4][23][0].apply(exports,arguments)},{dup:23}],43:[function(_dereq_,module,exports){arguments[4][24][0].apply(exports,arguments)},{dup:24}],44:[function(_dereq_,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],45:[function(_dereq_,module,exports){arguments[4][28][0].apply(exports,arguments)},{dup:28}],46:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_(\"isarray\");var isBuf=_dereq_(\"./is-buffer\");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if(\"object\"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&\"object\"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&\"object\"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{\"./is-buffer\":48,isarray:43}],47:[function(_dereq_,module,exports){var debug=_dereq_(\"debug\")(\"socket.io-parser\");var json=_dereq_(\"json3\");var isArray=_dereq_(\"isarray\");var Emitter=_dereq_(\"component-emitter\");var binary=_dereq_(\"./binary\");var isBuf=_dereq_(\"./is-buffer\");exports.protocol=4;exports.types=[\"CONNECT\",\"DISCONNECT\",\"EVENT\",\"BINARY_EVENT\",\"ACK\",\"BINARY_ACK\",\"ERROR\"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug(\"encoding packet %j\",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str=\"\";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+=\"-\"}if(obj.nsp&&\"/\"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=\",\";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=\",\";str+=json.stringify(obj.data)}debug(\"encoded %j as %s\",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if(\"string\"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit(\"decoded\",packet)}}else{this.emit(\"decoded\",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error(\"got binary data when not reconstructing a packet\")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit(\"decoded\",packet)}}}else{throw new Error(\"Unknown type: \"+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf=\"\";while(str.charAt(++i)!=\"-\"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!=\"-\"){throw new Error(\"Illegal attachments\")}p.attachments=Number(buf)}if(\"/\"==str.charAt(i+1)){p.nsp=\"\";while(++i){var c=str.charAt(i);if(\",\"==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp=\"/\"}var next=str.charAt(i+1);if(\"\"!==next&&Number(next)==next){p.id=\"\";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug(\"decoded %s as %j\",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:\"parser error\"}}},{\"./binary\":46,\"./is-buffer\":48,\"component-emitter\":49,debug:39,isarray:43,json3:50}],48:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],49:[function(_dereq_,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],50:[function(_dereq_,module,exports){(function(global){(function(){var isLoader=typeof define===\"function\"&&define.amd;var objectTypes={\"function\":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global==\"object\"&&global;if(freeGlobal&&(freeGlobal[\"global\"]===freeGlobal||freeGlobal[\"window\"]===freeGlobal||freeGlobal[\"self\"]===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root[\"Object\"]());exports||(exports=root[\"Object\"]());var Number=context[\"Number\"]||root[\"Number\"],String=context[\"String\"]||root[\"String\"],Object=context[\"Object\"]||root[\"Object\"],Date=context[\"Date\"]||root[\"Date\"],SyntaxError=context[\"SyntaxError\"]||root[\"SyntaxError\"],TypeError=context[\"TypeError\"]||root[\"TypeError\"],Math=context[\"Math\"]||root[\"Math\"],nativeJSON=context[\"JSON\"]||root[\"JSON\"];if(typeof nativeJSON==\"object\"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name==\"bug-string-char-index\"){isSupported=\"a\"[0]!=\"a\"}else if(name==\"json\"){isSupported=has(\"json-stringify\")&&has(\"json-parse\")}else{var value,serialized='{\"a\":[1,true,false,null,\"\\\\u0000\\\\b\\\\n\\\\f\\\\r\\\\t\"]}';if(name==\"json-stringify\"){var stringify=exports.stringify,stringifySupported=typeof stringify==\"function\"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)===\"0\"&&stringify(new Number)===\"0\"&&stringify(new String)=='\"\"'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)===\"1\"&&stringify([value])==\"[1]\"&&stringify([undef])==\"[null]\"&&stringify(null)==\"null\"&&stringify([undef,getClass,null])==\"[null,null,null]\"&&stringify({a:[value,true,false,null,\"\\x00\\b\\n\\f\\r\t\"]})==serialized&&stringify(null,value)===\"1\"&&stringify([1,2],null,1)==\"[\\n 1,\\n 2\\n]\"&&stringify(new Date(-864e13))=='\"-271821-04-20T00:00:00.000Z\"'&&stringify(new Date(864e13))=='\"+275760-09-13T00:00:00.000Z\"'&&stringify(new Date(-621987552e5))=='\"-000001-01-01T00:00:00.000Z\"'&&stringify(new Date(-1))=='\"1969-12-31T23:59:59.999Z\"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name==\"json-parse\"){var parse=exports.parse;if(typeof parse==\"function\"){try{if(parse(\"0\")===0&&!parse(false)){value=parse(serialized);var parseSupported=value[\"a\"].length==5&&value[\"a\"][0]===1;if(parseSupported){try{parseSupported=!parse('\"\t\"')}catch(exception){}if(parseSupported){try{parseSupported=parse(\"01\")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse(\"1.\")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has(\"json\")){var functionClass=\"[object Function]\",dateClass=\"[object Date]\",numberClass=\"[object Number]\",stringClass=\"[object String]\",arrayClass=\"[object Array]\",booleanClass=\"[object Boolean]\";var charIndexBuggy=has(\"bug-string-char-index\");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=[\"valueOf\",\"toString\",\"toLocaleString\",\"propertyIsEnumerable\",\"isPrototypeOf\",\"hasOwnProperty\",\"constructor\"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!=\"function\"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property==\"prototype\")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property==\"prototype\")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property==\"prototype\")&&isProperty.call(object,property)&&!(isConstructor=property===\"constructor\")){callback(property)}}if(isConstructor||isProperty.call(object,property=\"constructor\")){callback(property)}}}return forEach(object,callback)};if(!has(\"json-stringify\")){var Escapes={92:\"\\\\\\\\\",34:'\\\\\"',8:\"\\\\b\",12:\"\\\\f\",10:\"\\\\n\",13:\"\\\\r\",9:\"\\\\t\"};var leadingZeroes=\"000000\";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix=\"\\\\u00\";var quote=function(value){var result='\"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(\"\"):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'\"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value==\"object\"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,\"toJSON\")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?\"-\":\"+\")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+\"-\"+toPaddedString(2,month+1)+\"-\"+toPaddedString(2,date)+\"T\"+toPaddedString(2,hours)+\":\"+toPaddedString(2,minutes)+\":\"+toPaddedString(2,seconds)+\".\"+toPaddedString(3,milliseconds)+\"Z\"}else{value=null}}else if(typeof value.toJSON==\"function\"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,\"toJSON\"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return\"null\"}className=getClass.call(value);if(className==booleanClass){return\"\"+value}else if(className==numberClass){return value>-1/0&&value<1/0?\"\"+value:\"null\"}else if(className==stringClass){return quote(\"\"+value)}if(typeof value==\"object\"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?\"null\":element)}result=results.length?whitespace?\"[\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"]\":\"[\"+results.join(\",\")+\"]\":\"[]\"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+\":\"+(whitespace?\" \":\"\")+element)}});result=results.length?whitespace?\"{\\n\"+indentation+results.join(\",\\n\"+indentation)+\"\\n\"+prefix+\"}\":\"{\"+results.join(\",\")+\"}\":\"{}\"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace=\"\",width>10&&(width=10);whitespace.length<width;whitespace+=\" \");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize(\"\",(value={},value[\"\"]=source,value),callback,properties,whitespace,\"\",[])}}if(!has(\"json-parse\")){var fromCharCode=String.fromCharCode;var Unescapes={92:\"\\\\\",34:'\"',47:\"/\",98:\"\\b\",116:\"\t\",110:\"\\n\",102:\"\\f\",114:\"\\r\"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value=\"@\",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode(\"0x\"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)==\"true\"){Index+=4;return true}else if(source.slice(Index,Index+5)==\"false\"){Index+=5;return false}else if(source.slice(Index,Index+4)==\"null\"){Index+=4;return null}abort()}}return\"$\"};var get=function(value){var results,hasMembers;if(value==\"$\"){abort()}if(typeof value==\"string\"){if((charIndexBuggy?value.charAt(0):value[0])==\"@\"){return value.slice(1)}if(value==\"[\"){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"]\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"]\"){abort()}}else{abort()}}if(value==\",\"){abort()}results.push(get(value))}return results}else if(value==\"{\"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value==\"}\"){break}if(hasMembers){if(value==\",\"){value=lex();if(value==\"}\"){abort()}}else{abort()}}if(value==\",\"||typeof value!=\"string\"||(charIndexBuggy?value.charAt(0):value[0])!=\"@\"||lex()!=\":\"){abort()}results[value.slice(1)]=get(lex())\n}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value==\"object\"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=\"\"+source;result=get(lex());if(lex()!=\"$\"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[\"\"]=result,value),\"\",callback):result}}}exports[\"runInContext\"]=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root[\"JSON3\"],isRestored=false;var JSON3=runInContext(root,root[\"JSON3\"]={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root[\"JSON3\"]=previousJSON;nativeJSON=previousJSON=null}return JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this)}).call(this,typeof self!==\"undefined\"?self:typeof window!==\"undefined\"?window:typeof global!==\"undefined\"?global:{})},{}],51:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[31])(31)});\n\n    \n      ;var weight = document.getElementById('weight');\n      var socket = io('http://10.3.5.202:4002');\n      socket.on('getWeight', function(msg) {\n        weight.innerHTML = msg;\n    \n      }); \n    }, 1000);\n    </script>\n\n  </body>\n</html>\n","x":366.8571472167969,"y":769.5714092254639,"wires":[["cc6988a9.4640d8"]]},{"id":"cc6988a9.4640d8","type":"http response","z":"89e4584a.994288","name":"","x":526.8571472167969,"y":769.5714092254639,"wires":[]},{"id":"9a4ef13c.9acdc","type":"inject","z":"89e4584a.994288","name":"init","topic":"","payload":"init","payloadType":"str","repeat":"","crontab":"","once":true,"x":70,"y":80,"wires":[["284e29a3.518486","ff8ca970.6f9ca8"]]},{"id":"aea231cd.e2592","type":"function","z":"89e4584a.994288","name":"SOVA","func":"var reader = msg.req.query.reader;\nmsg.payload = {\n        \"ObjectID\": \"1001\", \n        \"Value\": flow.get('currentWeight'), \n        \"ChannelNumber\": \"12\",\n        \"Type\": \"OneC\",\n        \"WUID\": msg.req.query.reader,\n        \"truck1\": msg.req.query.truck1,\n        \"truck2\": msg.req.query.truck2\n};\nreturn msg;","outputs":1,"noerr":0,"x":354,"y":699.5714015960693,"wires":[["77d7d0a3.4eae9"]]},{"id":"8d4aef9.7277f1","type":"http request","z":"89e4584a.994288","name":"","method":"POST","ret":"txt","url":"10.3.5.205:8080","tls":"","x":1730,"y":60,"wires":[[]]},{"id":"de3f5b06.96ffe8","type":"debug","z":"89e4584a.994288","name":"","active":false,"console":"false","complete":"false","x":1890,"y":60,"wires":[]},{"id":"28b5da3d.5b6d06","type":"comment","z":"89e4584a.994288","name":"CONTROL EVENTS","info":"","x":110,"y":820,"wires":[]},{"id":"98cdb991.8730a8","type":"comment","z":"89e4584a.994288","name":"INITIALIZING","info":"","x":90,"y":20,"wires":[]},{"id":"fa4c250e.4b54d8","type":"ui_gauge","z":"89e4584a.994288","name":"","group":"72cbf799.9991a8","order":2,"width":0,"height":0,"gtype":"donut","title":"Поточне значення","label":"кг.","format":"{{value}}","min":0,"max":"80000","colors":["#00b500","#e6e600","#ca3838"],"x":516.6666870117188,"y":368.3333282470703,"wires":[]},{"id":"36d7c2a5.952e1e","type":"switch","z":"89e4584a.994288","name":"","property":"currentWeight","propertyType":"flow","rules":[{"t":"neq","v":"0","vt":"str"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","outputs":2,"x":930,"y":80,"wires":[["a307f813.841f58"],["a5e33b13.65ee68"]]},{"id":"1576c770.3fe9f9","type":"function","z":"89e4584a.994288","name":"MAKE PAGE","func":"var payload = '';\npayload = 'Вес: '+msg.payload;\nmsg.payload = payload;\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":200,"wires":[["9d4f91fa.9997d"]]},{"id":"cd491e59.200c2","type":"function","z":"89e4584a.994288","name":"BORDER","func":"msg.payload = {\n \"RfidCommand\": {\n  \"__type\": \"RFIDCommandGetStatusGPIO:#ERFID.CommunicationClient.Interfaces\",\n  \"ComandReceiver\": \"PHISICAL_READER\",\n  \"ReceiverName\": \"10.3.5.212:5084\"\n }\n};\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":400,"wires":[["2a7fd958.700726"]]},{"id":"2a7fd958.700726","type":"http request","z":"89e4584a.994288","name":"","method":"POST","ret":"txt","url":"10.3.5.205:8080","tls":"","x":790,"y":380,"wires":[["8d53de62.d230c"]]},{"id":"8d53de62.d230c","type":"function","z":"89e4584a.994288","name":"DEVICE DATA","func":"var perimetrStatus;\n\n    var payload = JSON.parse(msg.payload);\n    msg.payload = payload;\n    \n    if (payload.RfidCommandResult.IsOK)\n    {\n        var GPOIndex1 = payload.RfidCommandResult.GPIStatus[0].TurnON;\n        var GPOIndex2 = payload.RfidCommandResult.GPIStatus[1].TurnON;\n    \n        if (GPOIndex1 || GPOIndex2){\n            perimetrStatus = false;\n        } else {\n            perimetrStatus = true; \n        }\n    }\n    \n\nflow.set('perimetrStatus',perimetrStatus);\n\nreturn msg;","outputs":1,"noerr":0,"x":978,"y":420,"wires":[[]]},{"id":"831495cb.2c1388","type":"comment","z":"89e4584a.994288","name":"TRAFFIC LIGHT","info":"!","x":880,"y":20,"wires":[]},{"id":"a2bdfab7.40ef48","type":"function","z":"89e4584a.994288","name":"STATUS","func":"var UID = msg.req.query.reader;\nvar lastUID = flow.get('lastUID');\nvar zero    =  flow.get('zero');\n\nif (UID!==lastUID && !zero) \n{\n    msg.statusZero = false;    \n} else {\n    \n    msg.statusZero = true;\n    flow.set('zero',false);\n    flow.set('lastUID',UID);\n}\n\nmsg.uid = UID; \n\nmsg.payload = zero;\nreturn msg;\n","outputs":1,"noerr":0,"x":492.33329010009766,"y":505.7619514465332,"wires":[["e43646ff.6b1ad8","a00eeda.df1321"]]},{"id":"3b287654.b69c1a","type":"function","z":"89e4584a.994288","name":"Logging to table","func":"var table = flow.get('table');\nvar currentWeight = flow.get('currentWeight');\nvar obj = {\n    'datetime': new Date(),\n    'uid': msg.uid,\n    'weight': currentWeight\n    \n};\ntable.push(obj);\nflow.set('table',table);\nflow.set('lastWeight',currentWeight);\nmsg.payload = obj;\nreturn msg;","outputs":1,"noerr":0,"x":1173.333251953125,"y":248.3333330154419,"wires":[[]]},{"id":"7671c447.e5418c","type":"ui_chart","z":"89e4584a.994288","name":"","group":"72cbf799.9991a8","order":1,"width":0,"height":0,"label":"Графік за останні 5 хвилин","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","ymin":"0","ymax":"80000","removeOlder":"5","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"x":514.9999885559082,"y":403.33331871032715,"wires":[[],[]]},{"id":"917ec497.4e3958","type":"function","z":"89e4584a.994288","name":"MAKE BODY","func":"msg.payload = {\n    weight: flow.get('currentWeight'),\n    status:msg.statusZero,\n    stable:flow.get('stability'),    \n    perimetr:flow.get('perimetrStatus')\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":829.5237808227539,"y":561.4285907745361,"wires":[["b410784d.b56958"]]},{"id":"700c7e86.fcd2e","type":"http response","z":"89e4584a.994288","name":"","x":1200.7142848968506,"y":557.857159614563,"wires":[]},{"id":"b410784d.b56958","type":"function","z":"89e4584a.994288","name":"CHECK RESULT","func":"var result = msg.payload;\n\nif((result.stable === false) || (result.status === false) || (result.perimetr === false))\n{\n    result.err = \"Помилка при зважуванні:  \";\n}\nmsg.payload = result;\nreturn msg;\n","outputs":1,"noerr":0,"x":1008.3333587646484,"y":559.761842250824,"wires":[["700c7e86.fcd2e","ad4385fd.d14128"]]},{"id":"77d7d0a3.4eae9","type":"http request","z":"89e4584a.994288","name":"","method":"POST","ret":"txt","url":"http://10.45.1.60:8081/event","tls":"","x":512.5714340209961,"y":706.7142944335938,"wires":[[]]},{"id":"5df2d00a.3df69","type":"debug","z":"89e4584a.994288","name":"","active":false,"console":"false","complete":"payload","x":276,"y":279,"wires":[]},{"id":"bab9078b.90cc18","type":"inject","z":"89e4584a.994288","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":780,"y":80,"wires":[["36d7c2a5.952e1e"]]},{"id":"5e933c89.03f964","type":"function","z":"89e4584a.994288","name":"STABLE","func":"var arrayOfWeights       = flow.get('arrayOfWeights');\nvar sizeOfArrayOfWeights = flow.get('sizeOfArrayOfWeights');\nvar inaccuracy           = flow.get('inaccuracy');\nvar size = arrayOfWeights.length - 1 - sizeOfArrayOfWeights;\n\narrayOfWeights.push(msg.payload);\n\n\nif (size > 0){\n    \n    flow.set('stability',true);\n    \n    for (var i = 0; i <= sizeOfArrayOfWeights; i++ ){\n        var ai = (arrayOfWeights.length - 1 - i);\n        var bi = (ai - 1);\n        var a = arrayOfWeights[ai];\n        var b = arrayOfWeights[bi];\n        if ((a-b)>inaccuracy || (a-b)<-inaccuracy){\n            flow.set('stability',false);\n            break;\n        }\n    }\n    \n}else {\n    flow.set('stability',false);\n}\n\nflow.set('arrayOfWeights',arrayOfWeights);\nmsg.payload = flow.get('stability');\nreturn msg;","outputs":1,"noerr":0,"x":538.3333129882812,"y":333.333345413208,"wires":[["e906bba4.30b738"]]},{"id":"e906bba4.30b738","type":"ui_text","z":"89e4584a.994288","group":"72cbf799.9991a8","order":0,"width":0,"height":0,"name":"","label":"Стабільність","format":"{{msg.payload}}","layout":"col-center","x":728.3333396911621,"y":335.0000014305115,"wires":[]},{"id":"a9d34935.a6b0a8","type":"inject","z":"89e4584a.994288","name":"","topic":"","payload":"arrayOfWeights","payloadType":"flow","repeat":"","crontab":"","once":false,"x":116,"y":879,"wires":[["c20d99f0.1f36e8"]]},{"id":"c20d99f0.1f36e8","type":"debug","z":"89e4584a.994288","name":"","active":true,"console":"false","complete":"false","x":336,"y":879,"wires":[]},{"id":"7fca9e5f.24ff2","type":"function","z":"3d3d5d98.3bdb72","name":"","func":"flow.set('perimetrStatus',msg.perimetrStatus);\nreturn msg;","outputs":1,"noerr":0,"x":780.4097747802734,"y":681.2430801391602,"wires":[["2df42f53.9c5d8"]]},{"id":"153999a8.5648a6","type":"function","z":"89e4584a.994288","name":"","func":"flow.set('perimetrStatus',msg.perimetrStatus);\nreturn msg;","outputs":1,"noerr":0,"x":674.0476989746094,"y":560.714316368103,"wires":[["917ec497.4e3958"]]},{"id":"a95a5dd2.cddfe","type":"function","z":"89e4584a.994288","name":"to mongo","func":"msg.payload =msg.req.query;\nmsg.url_above = \"http://10.45.1.10/Streaming/channels/1/picture\";\nmsg.url_front = \"http://10.45.1.12/Streaming/channels/1/picture\";\nmsg.url_back  = \"http://10.45.1.13/Streaming/channels/1/picture\";\nreturn msg;","outputs":1,"noerr":0,"x":428.5768814086914,"y":579.8159885406494,"wires":[["ec69a399.9b01e"]]},{"id":"8fd776b7.919ee8","type":"http request","z":"4d8485d8.74a3dc","name":"","method":"POST","ret":"txt","url":"http://10.3.5.233:4000/auth/login","tls":"","x":270,"y":280,"wires":[[]]},{"id":"6479d80b.a6df58","type":"function","z":"4d8485d8.74a3dc","name":"login","func":"msg.headers = {\n    \"Content-Type\":\"application/json\"\n}\nmsg.payload = {\n    \"username\":\"user\",\n    \"password\":\"user\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":110,"y":280,"wires":[["8fd776b7.919ee8"]]},{"id":"eaf501ca.5a0de","type":"function","z":"4d8485d8.74a3dc","name":"set request","func":"// var response = JSON.parse(msg.payload);\n// msg.headers = {\n//     \"Content-Type\":\"application/json\",\n//     \"token\":response.token\n// }\n\nmsg.url = 'http://10.3.5.223:1880/api/platform/setReaderConfig?rfidID='+msg.rfidID;\nmsg.payload  = {\n    \"cmd\":msg.gpo+flow.get(msg.color)\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":120,"wires":[["474ce02e.d9585"]]},{"id":"474ce02e.d9585","type":"http request","z":"4d8485d8.74a3dc","name":"","method":"POST","ret":"txt","url":"","tls":"","x":690,"y":120,"wires":[[]]},{"id":"6724f74b.78c038","type":"inject","z":"4d8485d8.74a3dc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":130,"y":60,"wires":[["178e9181.b5ddfe"]]},{"id":"178e9181.b5ddfe","type":"function","z":"4d8485d8.74a3dc","name":"","func":"flow.set('green',\"00\");\nflow.set('red',\"80\");\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":60,"wires":[[]]},{"id":"557bca76.6c1c54","type":"link in","z":"4d8485d8.74a3dc","name":"","links":["6f0c6feb.8d09e","bc41ac89.36b5b"],"x":55,"y":120,"wires":[["eaf501ca.5a0de","b2976a5d.3de4a8","18f49220.16338e","92cf4561.d45b58"]]},{"id":"c6bfe615.144d98","type":"function","z":"3d3d5d98.3bdb72","name":"червоний","func":"msg.rfidID = '10.3.5.217';\nmsg.color = 'red';\nmsg.gpo = '01';\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":40,"wires":[["6f0c6feb.8d09e"]]},{"id":"aede6cb.3c8019","type":"function","z":"3d3d5d98.3bdb72","name":"зелений","func":"msg.rfidID = '10.3.5.217';\nmsg.color = 'green';\nmsg.gpo = '01';\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":100,"wires":[["6f0c6feb.8d09e"]]},{"id":"6f0c6feb.8d09e","type":"link out","z":"3d3d5d98.3bdb72","name":"","links":["557bca76.6c1c54","6a3dd8a9.3bba18"],"x":1220,"y":80,"wires":[]},{"id":"5403f969.8c2168","type":"function","z":"89e4584a.994288","name":"Scales is empty","func":"var config = flow.get('config');\n\nmsg.queryParameters = msg.queryParameters || {};\n\nif (config && config.ScalesIsEmpty)\n{\n    msg.queryParameters.parAdress  = config.ScalesIsEmpty.Adress; \n    msg.queryParameters.parTurnON1 = config.ScalesIsEmpty.parTurnON1; \n    msg.queryParameters.parTurnON2 = config.ScalesIsEmpty.parTurnON2;\n    msg.queryParameters.parTurnON3 = config.ScalesIsEmpty.parTurnON3;\n    msg.queryParameters.parTurnON4 = config.ScalesIsEmpty.parTurnON4;\n    \n} else {\n    \n    msg.queryParameters.parAdress  = '10.3.5.212:5084'; \n    msg.queryParameters.parTurnON1 = \"true\";\n    msg.queryParameters.parTurnON2 = \"false\";\n    msg.queryParameters.parTurnON3 = \"true\";\n    msg.queryParameters.parTurnON4 = \"false\";\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":1380,"y":100,"wires":[["8198cdc6.52b9c"]]},{"id":"fd16700b.65f4b","type":"function","z":"89e4584a.994288","name":"Truck on scales","func":"var config = flow.get('config');\n\nmsg.queryParameters = msg.queryParameters || {};\n\nif (config && config.trcukOnScales)\n{\n    msg.queryParameters.parAdress  = config.trcukOnScales.Adress; \n    msg.queryParameters.parTurnON1 = config.trcukOnScales.parTurnON1; \n    msg.queryParameters.parTurnON2 = config.trcukOnScales.parTurnON2;\n    msg.queryParameters.parTurnON3 = config.trcukOnScales.parTurnON3;\n    msg.queryParameters.parTurnON4 = config.trcukOnScales.parTurnON4;\n    \n} else {\n    \n    msg.queryParameters.parAdress  = '10.3.5.212:5084'; \n    msg.queryParameters.parTurnON1 = \"true\";\n    msg.queryParameters.parTurnON2 = \"true\";\n    msg.queryParameters.parTurnON3 = \"true\";\n    msg.queryParameters.parTurnON4 = \"true\";\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":1380,"y":20,"wires":[["8198cdc6.52b9c"]]},{"id":"8198cdc6.52b9c","type":"function","z":"89e4584a.994288","name":"MAKE BODY","func":"var payload = {\n \"RfidCommand\": {\n  \"__type\": \"RFIDCommandSetGPO:#ERFID.CommunicationClient.Interfaces\",\n  \"ComandReceiver\": \"PHISICAL_READER\",\n  \"ReceiverName\": msg.queryParameters.parAdress,\n    \"ChannelsConfig\": [{\n   \"GPOIndex\": 1,\n   \"TurnON\": msg.queryParameters.parTurnON1\n  },\n  {\n   \"GPOIndex\": 2,\n   \"TurnON\": msg.queryParameters.parTurnON2\n  },\n  {\n   \"GPOIndex\": 3,\n   \"TurnON\": msg.queryParameters.parTurnON3\n  },\n  {\n   \"GPOIndex\": 4,\n   \"TurnON\": msg.queryParameters.parTurnON4\n  }]\n }\n};\n\nmsg.payload = payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":60,"wires":[[]]},{"id":"a307f813.841f58","type":"function","z":"89e4584a.994288","name":"червоний","func":"msg.rfidID = '10.3.5.212';\nmsg.color = 'red';\nmsg.gpo = '01';\nreturn msg;","outputs":1,"noerr":0,"x":1080,"y":60,"wires":[["bc41ac89.36b5b"]]},{"id":"a5e33b13.65ee68","type":"function","z":"89e4584a.994288","name":"зелений","func":"msg.rfidID = '10.3.5.212';\nmsg.color = 'green';\nmsg.gpo = '01';\nreturn msg;","outputs":1,"noerr":0,"x":1080,"y":100,"wires":[["bc41ac89.36b5b"]]},{"id":"bc41ac89.36b5b","type":"link out","z":"89e4584a.994288","name":"","links":["557bca76.6c1c54","6a3dd8a9.3bba18"],"x":1175,"y":80,"wires":[]},{"id":"55c7a73d.2b29a8","type":"http request","z":"3d3d5d98.3bdb72","name":"","method":"GET","ret":"txt","url":"","tls":"","x":947.4895782470703,"y":613.2604446411133,"wires":[["b453a85f.f8c898"]]},{"id":"b453a85f.f8c898","type":"function","z":"3d3d5d98.3bdb72","name":"","func":"//\"[{\"GPI_ID\":1,\"GPI_Status\":1},{\"GPI_ID\":2,\"GPI_Status\":1},{\"GPI_ID\":3,\"GPI_Status\":0},{\"GPI_ID\":4,\"GPI_Status\":0}]\"\n\nvar perimetrStatus = ((msg.payload[0].GPI_Status == 1)&&(msg.payload[1].GPI_Status == 1));\nmsg.perimetrStatus = perimetrStatus;\nreturn msg;","outputs":1,"noerr":0,"x":1097.2500190734863,"y":614.2500095367432,"wires":[["7fca9e5f.24ff2","16d035b9.1a0e2a"]]},{"id":"e43646ff.6b1ad8","type":"function","z":"89e4584a.994288","name":"set request","func":"// var response = JSON.parse(msg.payload);\n// msg.headers = {\n//     \"Content-Type\":\"application/json\",\n//     \"token\":response.token\n// }\nmsg.rfidID = '10.3.5.217';\nmsg.url = 'http://10.3.5.223:1880/api/platform/getReaderConfig?rfidID='+msg.rfidID;\n\nreturn msg;","outputs":1,"noerr":0,"x":686.9047393798828,"y":502.3809595108032,"wires":[["b367e8fd.b7bd68"]]},{"id":"b367e8fd.b7bd68","type":"http request","z":"89e4584a.994288","name":"","method":"GET","ret":"txt","url":"","tls":"","x":859.2857246398926,"y":500.95237159729004,"wires":[["c3a2a074.70f5b"]]},{"id":"c3a2a074.70f5b","type":"function","z":"89e4584a.994288","name":"","func":"//\"[{\"GPI_ID\":1,\"GPI_Status\":1},{\"GPI_ID\":2,\"GPI_Status\":1},{\"GPI_ID\":3,\"GPI_Status\":0},{\"GPI_ID\":4,\"GPI_Status\":0}]\"\n\nif(msg.payload[0].GPI_Status){\nvar perimetrStatus = ((msg.payload[0].GPI_Status == 1)&&(msg.payload[1].GPI_Status == 1));\nmsg.perimetrStatus = perimetrStatus;\n}else{\n msg.perimetrStatus = true;   \n}\nreturn msg;","outputs":1,"noerr":0,"x":1009.7617874145508,"y":499.04762744903564,"wires":[["153999a8.5648a6"]]},{"id":"da3eb796.8b7768","type":"function","z":"3d3d5d98.3bdb72","name":"set request","func":"// var response = JSON.parse(msg.payload);\n// msg.headers = {\n//     \"Content-Type\":\"application/json\",\n//     \"token\":response.token\n// }\nmsg.rfidID = '10.3.5.212';\nmsg.url = 'http://10.3.5.223:1880/api/platform/getReaderConfig?rfidID='+msg.rfidID;\n\nreturn msg;","outputs":1,"noerr":0,"x":758.489574432373,"y":611.7604465484619,"wires":[["55c7a73d.2b29a8"]]},{"id":"1e0cc9c4.ee8726","type":"function","z":"3d3d5d98.3bdb72","name":"LAST WEIGHT v2","func":"var lastWeight    = flow.get('lastWeight');\nvar currentWeight = flow.get('currentWeight');\nvar deltaWeight   = flow.get('config').deltaWeight;\nvar table         = flow.get('table');\n\nvar log = 0;\nvar log_direction = 0;\n\n//определяем необходимость фиксировать изменение веса\nif ((lastWeight - currentWeight)>deltaWeight || (lastWeight - currentWeight) < -deltaWeight){\n    log = 1;\n} else if( lastWeight>0 && currentWeight === 0){\n    log = 1;\n} else {\n    log = 0;\n}\n//определяем направление движения\nif (log){\n    if (currentWeight > lastWeight){\n        if(!flow.get('in')){\n            log_direction = 1;    \n        }\n        flow.set('in',true);\n        flow.set('out',false);\n    }else{\n        if(!flow.get('out')){\n            log_direction = 1;     \n        }\n        flow.set('in',false);\n        flow.set('out',true);\n    } \n}else{\n    flow.set('in',false);\n    flow.set('out',false);\n}\n\n//обнуляем контроль статуса и количество взвешиваний\nif (currentWeight === 0){\n    flow.set('zero',true);\n    flow.set('arrayOfWeights',[]);\n}\n\n//определяем максимальный и минимаьный вес за последнюю весовую транзакцию\nvar cw = 0;\nvar cw_min = -100000;\nfor(var i=0;i<table.length;i++){\n    if(table[i].weight > cw){\n        cw = table[i].weight;\n    }\n}\nmsg.maxWeight = cw;\nmsg.truckOnScales = flow.get('sub_vesa');\n\n//определяем сколько автомобиль находился на весах\nvar onScales = Math.round((new Date()-flow.get('onScales_start'))/1000);\n\n//определяем холостой проезд\nvar dummy = false;\nif(!log && table.length > 0 && currentWeight === 0) {\n    dummy = true;\n    for(var i=0;i<table.length;i++){\n        if(table[i].uid){\n            dummy = false;  \n            break;\n        }    \n    }\n    \n    flow.set('table',[]);\n    flow.set('onScales',0);\n    \n}\n//если был 0, устанавливаем дату отсчета взвешивания\nvar lastOnScales = flow.get('onScales');    \n\nif (currentWeight===0 && lastOnScales === 0){\n    flow.set('onScales_start',new Date());\n}else{\n   onScales = Math.round((new Date()-flow.get('onScales_start'))/1000);\n   flow.set('onScales',onScales);\n}\n\nflow.set('lastWeight',currentWeight);\n\nmsg.log = log;\nmsg.log_direction = log_direction;\nmsg.dummy = dummy;\nmsg.uid = '';\nmsg.onScales = onScales;\n\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":220,"wires":[["918e8cfa.2c77","55961f1f.148b9"]]},{"id":"918e8cfa.2c77","type":"switch","z":"3d3d5d98.3bdb72","name":"Logging direction","property":"log_direction","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","outputs":1,"x":777.142879486084,"y":219.99999618530273,"wires":[["372e264b.9e670a","ed050f7d.01948","30f57774.87bef8"]]},{"id":"372e264b.9e670a","type":"function","z":"3d3d5d98.3bdb72","name":"GET DIRECTION","func":"var vIn = flow.get('in');\nvar vOut = flow.get('out');\n\nif(vIn){\n    pl = 'Заезд на весы'\n}else if(vOut){\n    pl = 'Съезд с весов' \n}else{\n    pl = \"---------------\";\n}\nvar events = flow.get('events');\nevents.push({\n    \"name\": \"Направление заезда на весы\",\n    \"value\":pl\n});\n\nmsg.payload = pl;\nreturn msg;","outputs":1,"noerr":0,"x":980,"y":220,"wires":[["d4193c94.8ee1d","c22cda4c.23b988","b1d4d0ca.4ee13"]]},{"id":"c22cda4c.23b988","type":"function","z":"3d3d5d98.3bdb72","name":"Заїзд/зїзд","func":"var payload = flow.get('resultTH');\nvar count = \". Текуший вес: \" + flow.get(\"currentWeight\");\npayload.telemetry = {\n    \"event\" : msg.payload + count\n    \n    }; \nmsg.payload = payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":1160,"y":220,"wires":[["ace945d3.fcefe8"]]},{"id":"d4193c94.8ee1d","type":"ui_text","z":"3d3d5d98.3bdb72","group":"f2460cfc.9d535","order":4,"width":0,"height":0,"name":"","label":"Напрямок руху","format":"{{msg.payload}}","layout":"col-center","x":820,"y":300,"wires":[]},{"id":"b548a0c2.28464","type":"function","z":"3d3d5d98.3bdb72","name":"config","func":"var config;\n\nconfig = {\n    'scale':'scale1',\n    'camera_front_name':'Вигляд зпереду',\n    'deltaWeight':250,\n    'sizeOfArrayOfWeights':5,\n    'inaccuracy':60\n}\n \nflow.set('config',config);\n\nreturn msg;","outputs":1,"noerr":0,"x":567.8571428571428,"y":102.85714285714285,"wires":[[]]},{"id":"38bcdbe.c001b24","type":"function","z":"3d3d5d98.3bdb72","name":"ThingsBoard integrations","func":"var resultTH = {\n   \"deviceName\": \"vesa80t\",\n   \"deviceType\": \"avto\",\n   \"attributes\": {\n       \"model\": \"Koda d400\",\n       \"serialNumber\": \"SN012345\",\n       \"integrationName\": \"Smart scale integration\"\n   }\n};\nflow.set('resultTH',resultTH);   \nreturn msg;","outputs":1,"noerr":0,"x":294.5238571166992,"y":130.23809051513672,"wires":[[]]},{"id":"ace945d3.fcefe8","type":"function","z":"3d3d5d98.3bdb72","name":"telemetry","func":"msg.headers = {\n    \"Content-Type\":\"application/json\"\n}\nmsg.payload = msg.payload.telemetry;\nreturn msg;","outputs":1,"noerr":0,"x":1325.0000190734863,"y":253.75000476837158,"wires":[["db2eee1d.8e829","85de2262.d6d2f"]]},{"id":"db2eee1d.8e829","type":"http request","z":"3d3d5d98.3bdb72","name":"ThingsBoard Smart ","method":"POST","ret":"txt","url":"http://10.3.5.223:8080/api/v1/v0nRTrSs8l2bQMjlByaJ/telemetry","tls":"","x":1502.5000228881836,"y":237.50000381469727,"wires":[[]]},{"id":"284e29a3.518486","type":"function","z":"89e4584a.994288","name":"ThingsBoard integrations","func":"var resultTH = {\n   \"deviceName\": \"vesa80t\",\n   \"deviceType\": \"avto\",\n   \"attributes\": {\n       \"model\": \"Koda d400\",\n       \"serialNumber\": \"SN012345\",\n       \"integrationName\": \"Smart scale integration\"\n   }\n};\nflow.set('resultTH',resultTH);   \nreturn msg;","outputs":1,"noerr":0,"x":280,"y":131.42857360839844,"wires":[[]]},{"id":"18dd8f6.dbd1f71","type":"function","z":"89e4584a.994288","name":"config","func":"var config;\n\nconfig = {\n    'scale':'scale1',\n    'camera_front_name':'Вигляд зпереду',\n    'deltaWeight':250,\n    'sizeOfArrayOfWeights':5,\n    'inaccuracy':60\n}\n \nflow.set('config',config);\n\nreturn msg;","outputs":1,"noerr":0,"x":546.1904258728027,"y":121.19047927856445,"wires":[[]]},{"id":"458850bf.34a29","type":"function","z":"89e4584a.994288","name":"LAST WEIGHT v2","func":"var lastWeight    = flow.get('lastWeight');\nvar currentWeight = flow.get('currentWeight');\nvar deltaWeight   = flow.get('config').deltaWeight;\nvar table         = flow.get('table');\n\nvar log = 0;\nvar log_direction = 0;\n\n//определяем необходимость фиксировать изменение веса\nif ((lastWeight - currentWeight)>deltaWeight || (lastWeight - currentWeight) < -deltaWeight){\n    log = 1;\n} else if( lastWeight>0 && currentWeight === 0){\n    log = 1;\n} else {\n    log = 0;\n}\n//определяем направление движения\nif (log){\n    if (currentWeight > lastWeight){\n        if(!flow.get('in')){\n            log_direction = 1;    \n        }\n        flow.set('in',true);\n        flow.set('out',false);\n    }else{\n        if(!flow.get('out')){\n            log_direction = 1;     \n        }\n        flow.set('in',false);\n        flow.set('out',true);\n    } \n}else{\n    flow.set('in',false);\n    flow.set('out',false);\n}\n\n//обнуляем контроль статуса и количество взвешиваний\nif (currentWeight === 0){\n    flow.set('zero',true);\n    flow.set('arrayOfWeights',[]);\n}\n\n//определяем максимальный и минимаьный вес за последнюю весовую транзакцию\nvar cw = 0;\nvar cw_min = -100000;\nfor(var i=0;i<table.length;i++){\n    if(table[i].weight > cw){\n        cw = table[i].weight;\n    }\n}\nmsg.maxWeight = cw;\nmsg.truckOnScales = flow.get('sub_vesa');\n\n//определяем сколько автомобиль находился на весах\nvar onScales = Math.round((new Date()-flow.get('onScales_start'))/1000);\n\n//определяем холостой проезд\nvar dummy = false;\nif(!log && table.length > 0 && currentWeight === 0) {\n    dummy = true;\n    for(var i=0;i<table.length;i++){\n        if(table[i].uid){\n            dummy = false;  \n            break;\n        }    \n    }\n    \n    flow.set('table',[]);\n    flow.set('onScales',0);\n    \n}\n//если был 0, устанавливаем дату отсчета взвешивания\nvar lastOnScales = flow.get('onScales');    \n\nif (currentWeight===0 && lastOnScales === 0){\n    flow.set('onScales_start',new Date());\n}else{\n   onScales = Math.round((new Date()-flow.get('onScales_start'))/1000);\n   flow.set('onScales',onScales);\n}\n\nflow.set('lastWeight',currentWeight);\n\nmsg.log = log;\nmsg.log_direction = log_direction;\nmsg.dummy = dummy;\nmsg.uid = '';\nmsg.onScales = onScales;\n\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":240,"wires":[["b7f664af.623298","a00eeda.df1321"]]},{"id":"b7f664af.623298","type":"switch","z":"89e4584a.994288","name":"Logging direction","property":"log_direction","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","outputs":1,"x":770,"y":280,"wires":[["a06fcd58.983c","36d7c2a5.952e1e","3b287654.b69c1a"]]},{"id":"a06fcd58.983c","type":"function","z":"89e4584a.994288","name":"GET DIRECTION","func":"var vIn = flow.get('in');\nvar vOut = flow.get('out');\n\nif(vIn){\n    pl = 'Заезд на весы'\n}else if(vOut){\n    pl = 'Съезд с весов' \n}else{\n    pl = \"---------------\";\n}\nvar events = flow.get('events');\nevents.push({\n    \"name\": \"Направление заезда на весы\",\n    \"value\":pl\n});\n\nmsg.payload = pl;\nreturn msg;","outputs":1,"noerr":0,"x":1180.500087738037,"y":292.92054557800293,"wires":[["648c7faa.4d32f","a5349dc7.48db7","c77e7c76.aaeb9"]]},{"id":"648c7faa.4d32f","type":"ui_text","z":"89e4584a.994288","group":"72cbf799.9991a8","order":4,"width":0,"height":0,"name":"","label":"Напрямок руху","format":"{{msg.payload}}","layout":"col-center","x":1396.0476608276367,"y":251.92066764831543,"wires":[]},{"id":"a5349dc7.48db7","type":"function","z":"89e4584a.994288","name":"Заїзд/зїзд","func":"var payload = flow.get('resultTH');\nvar count = \". Текуший вес: \" + flow.get(\"currentWeight\");\npayload.telemetry = {\n    \"event\" : msg.payload + count\n    \n    }; \nmsg.payload = payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":1394.333267211914,"y":293.8253221511841,"wires":[["2d0d7819.10e878"]]},{"id":"2d0d7819.10e878","type":"function","z":"89e4584a.994288","name":"telemetry","func":"msg.headers = {\n    \"Content-Type\":\"application/json\"\n}\nmsg.payload = msg.payload.telemetry;\nreturn msg;","outputs":1,"noerr":0,"x":1546.5954399108887,"y":300.53966522216797,"wires":[["fb5ff25c.e3b1e","c8096623.eabd88"]]},{"id":"fb5ff25c.e3b1e","type":"http request","z":"89e4584a.994288","name":"ThingsBoard Smart ","method":"POST","ret":"txt","url":"http://10.3.5.223:8080/api/v1/SORWdWUxyshYXMt05Zd8/telemetry","tls":"","x":1761.357322692871,"y":311.96821212768555,"wires":[[]]},{"id":"46fd87d3.707e18","type":"function","z":"89e4584a.994288","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1312.8570861816406,"y":728.5714340209961,"wires":[["e6afb0ee.09706"]]},{"id":"f6258cfb.28a3a","type":"function","z":"3d3d5d98.3bdb72","name":"req_wit_1c","func":"var payload = flow.get('resultTH');\nvar truck1 = flow.get('truck1');\nvar truck2 = flow.get('truck2');\npayload.truck1 = truck1;\npayload.truck2 = truck2;\nvar weight_for_1c = flow.get('currentWeight');\npayload.weight_for_1c = weight_for_1c;\npayload.telemetry = {\n    \"event\" :\"1C взвесило. Вес:\" + weight_for_1c + \". Авто \" + truck1 + \". Прицеп \" + truck2\n    \n    }; \nmsg.payload = payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":1201.428565979004,"y":985.2379770278931,"wires":[["e06ee3b1.bd4a6"]]},{"id":"d196e927.45b068","type":"function","z":"3d3d5d98.3bdb72","name":"req_wit_1c_status","func":"var payload = flow.get('resultTH');\nvar status_str = msg.payload.status;\nvar stable_str = msg.payload.stable;\nvar perimetr_str = msg.payload.perimetr;\nvar weight_str = msg.payload.weight;\n\nif(status_str === true){\n    status_str =\"Статус пройден\"\n}else{\n    status_str =\"Статус непройден\"\n}\n\nif(stable_str === true){\n    stable_str =\"Вес стабильний\"\n}else{\n    stable_str =\"Вес нестабильний\"\n}\n\nif(perimetr_str === true){\n    perimetr_str =\"Периметр не пересечен\"\n}else{\n    perimetr_str =\"Периметр пересечен\"\n}\npayload.telemetry = {\n    \"event\" : \"1C взвесило Вес:\" + weight_str + \". \" + status_str + \". \" + stable_str + \". \" + perimetr_str ,\n   \n    }; \nmsg.payload = payload;\n//{\"weight\":0,\"status\":true,\"stable\":false,\"perimetr\":false,\"err\":\"Помилка при зважуванні:  \"}\nreturn msg;","outputs":1,"noerr":0,"x":1215.8929061889648,"y":931.3690557479858,"wires":[["e06ee3b1.bd4a6"]]},{"id":"e06ee3b1.bd4a6","type":"function","z":"3d3d5d98.3bdb72","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1382.202247619629,"y":961.5476951599121,"wires":[["8bd611a9.b840e"]]},{"id":"ad4385fd.d14128","type":"function","z":"89e4584a.994288","name":"req_wit_1c_status","func":"var payload = flow.get('resultTH');\nvar status_str = msg.payload.status;\nvar stable_str = msg.payload.stable;\nvar perimetr_str = msg.payload.perimetr;\nvar weight_str = msg.payload.weight;\n\nif(status_str === true){\n    status_str =\"Статус пройден\"\n}else{\n    status_str =\"Статус непройден\"\n}\n\nif(stable_str === true){\n    stable_str =\"Вес стабильний\"\n}else{\n    stable_str =\"Вес нестабильний\"\n}\n\nif(perimetr_str === true){\n    perimetr_str =\"Периметр не пересечен\"\n}else{\n    perimetr_str =\"Периметр пересечен\"\n}\npayload.telemetry = {\n    \"event\" : \"1C взвесило Вес:\" + weight_str + \". \" + status_str + \". \" + stable_str + \". \" + perimetr_str ,\n   \n    }; \nmsg.payload = payload;\n//{\"weight\":0,\"status\":true,\"stable\":false,\"perimetr\":false,\"err\":\"Помилка при зважуванні:  \"}\nreturn msg;","outputs":1,"noerr":0,"x":1135.0000076293945,"y":672.3808870315552,"wires":[["46fd87d3.707e18"]]},{"id":"b2a0b430.a23968","type":"function","z":"3d3d5d98.3bdb72","name":"set truck","func":"flow.set('truck1',msg.payload.truck1);\nflow.set('truck2',msg.payload.truck2);\nreturn msg;","outputs":1,"noerr":0,"x":631.0000076293945,"y":1079.2500162124634,"wires":[["f6258cfb.28a3a"]]},{"id":"2df0e052.8486","type":"postgres","z":"89e4584a.994288","postgresdb":"1af05285.16139d","name":"rfid_log","output":true,"outputs":1,"x":817.4998397827148,"y":4705.000023841858,"wires":[["f1b2afd7.97d87"]]},{"id":"986a6ce1.96749","type":"function","z":"3d3d5d98.3bdb72","name":"setup params","func":"msg.queryParameters = msg.queryParameters || {};\nmsg.queryParameters.param1 = msg.payload.event_name;\nmsg.queryParameters.param2 = msg.payload.event_desc;\nmsg.queryParameters.param3 = msg.payload.ip;\nmsg.queryParameters.param4 = flow.get(\"isoDate\");\nreturn msg;","outputs":1,"noerr":0,"x":1610,"y":420,"wires":[["e300b12d.ec3c7"]]},{"id":"e300b12d.ec3c7","type":"template","z":"3d3d5d98.3bdb72","name":"query field1","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO event_table(\n             Event_name,Event_description,IP,lastSeenTimestampUTC)\n    VALUES ($param1,$param2,$param3,$param4);","x":1770,"y":420,"wires":[["ead8752.17f4b88"]]},{"id":"85de2262.d6d2f","type":"function","z":"3d3d5d98.3bdb72","name":"заголовок","func":"msg.payload.ip = '10.3.5.202';\nmsg.payload.event_name = \"Подія на 80т\";\nmsg.payload.event_desc = msg.payload.event;\nreturn msg;","outputs":1,"noerr":0,"x":1451.2500190734863,"y":418.7500057220459,"wires":[["986a6ce1.96749"]]},{"id":"7acb37f6.b0a7f8","type":"function","z":"89e4584a.994288","name":"setup params","func":"msg.queryParameters = msg.queryParameters || {};\nmsg.queryParameters.param1 = msg.payload.event_name;\nmsg.queryParameters.param2 = msg.payload.event_desc;\nmsg.queryParameters.param3 = msg.payload.ip;\nmsg.queryParameters.param4 = flow.get(\"isoDate\");\nreturn msg;","outputs":1,"noerr":0,"x":1870.0000762939453,"y":455.7142906188965,"wires":[["1e5cef96.829db"]]},{"id":"1e5cef96.829db","type":"template","z":"89e4584a.994288","name":"query field1","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO event_table(\n             Event_name,Event_description,IP,lastSeenTimestampUTC)\n    VALUES ($param1,$param2,$param3,$param4);","x":2039.9999313354492,"y":458.57141494750977,"wires":[["f70cf669.5c1488"]]},{"id":"c8096623.eabd88","type":"function","z":"89e4584a.994288","name":"заголовок","func":"msg.payload.ip = '10.3.5.202';\nmsg.payload.event_name = \"Подія на 60т\";\nmsg.payload.event_desc = msg.payload.event;\nreturn msg;","outputs":1,"noerr":0,"x":1672.5714111328125,"y":455.4285583496094,"wires":[["7acb37f6.b0a7f8"]]},{"id":"ead8752.17f4b88","type":"postgres","z":"3d3d5d98.3bdb72","postgresdb":"1af05285.16139d","name":"rfid_log","output":true,"outputs":1,"x":1913.7500381469727,"y":423.75000190734863,"wires":[["4181f44d.182c9c"]]},{"id":"4181f44d.182c9c","type":"debug","z":"3d3d5d98.3bdb72","name":"","active":false,"console":false,"complete":"true","x":2043.33353805542,"y":424.4048023223877,"wires":[]},{"id":"e9bf13eb.7d15e","type":"function","z":"4d8485d8.74a3dc","name":"set request","func":"// var response = JSON.parse(msg.payload);\n// msg.headers = {\n//     \"Content-Type\":\"application/json\",\n//     \"token\":response.token\n// }\n\nmsg.url = 'http://10.3.5.223:1880/api/platform/setReaderConfig?rfidID='+msg.rfidID;\nmsg.payload  = {\n    \"cmd\":\"02\"+flow.get(msg.color)\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":160,"wires":[["7a03610f.39cc5"]]},{"id":"7a03610f.39cc5","type":"http request","z":"4d8485d8.74a3dc","name":"","method":"POST","ret":"txt","url":"","tls":"","x":690,"y":160,"wires":[[]]},{"id":"733f9f49.1e102","type":"function","z":"4d8485d8.74a3dc","name":"set request","func":"// var response = JSON.parse(msg.payload);\n// msg.headers = {\n//     \"Content-Type\":\"application/json\",\n//     \"token\":response.token\n// }\n\nmsg.url = 'http://10.3.5.223:1880/api/platform/setReaderConfig?rfidID='+msg.rfidID;\nmsg.payload  = {\n    \"cmd\":\"03\"+flow.get(msg.color)\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":200,"wires":[["168e3644.1d522a"]]},{"id":"168e3644.1d522a","type":"http request","z":"4d8485d8.74a3dc","name":"","method":"POST","ret":"txt","url":"","tls":"","x":690,"y":200,"wires":[[]]},{"id":"e131c57f.e35f48","type":"function","z":"4d8485d8.74a3dc","name":"set request","func":"// var response = JSON.parse(msg.payload);\n// msg.headers = {\n//     \"Content-Type\":\"application/json\",\n//     \"token\":response.token\n// }\n\nmsg.url = 'http://10.3.5.223:1880/api/platform/setReaderConfig?rfidID='+msg.rfidID;\nmsg.payload  = {\n    \"cmd\":\"04\"+flow.get(msg.color)\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":240,"wires":[["271f8ecb.122602"]]},{"id":"271f8ecb.122602","type":"http request","z":"4d8485d8.74a3dc","name":"","method":"POST","ret":"txt","url":"","tls":"","x":690,"y":240,"wires":[[]]},{"id":"b2976a5d.3de4a8","type":"delay","z":"4d8485d8.74a3dc","name":"","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":160,"wires":[["e9bf13eb.7d15e"]]},{"id":"18f49220.16338e","type":"delay","z":"4d8485d8.74a3dc","name":"","pauseType":"delay","timeout":"400","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":200,"wires":[["733f9f49.1e102"]]},{"id":"92cf4561.d45b58","type":"delay","z":"4d8485d8.74a3dc","name":"","pauseType":"delay","timeout":"600","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":240,"wires":[["e131c57f.e35f48"]]},{"id":"a00eeda.df1321","type":"switch","z":"89e4584a.994288","name":"Logging","property":"log","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","outputs":1,"x":740,"y":240,"wires":[["3b287654.b69c1a","37a9886a.ab2378"]]},{"id":"55961f1f.148b9","type":"switch","z":"3d3d5d98.3bdb72","name":"Logging","property":"log","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","outputs":1,"x":760,"y":160,"wires":[["ed050f7d.01948","e8a24ad6.a71768"]]},{"id":"e91cb063.e8a39","type":"function","z":"3d3d5d98.3bdb72","name":"","func":"msg.payload = {\n    reader: \"e38627f4-0458-11e9-e184-0242ac130003\",\ntruck1: \"ВІ4976СН\",\ntruck2: \"БЕЗПРИЧЕПА\",\nTruckPlateNumber: \"ВІ4976СН\",\nTruckModelType: \"FORD\",\nTruckModel: \"CARGO 3536D DC\",\nTruckType: \"Вантажний\",\nTruckTypeID: \"ВАНТАЖНИЙ\",\nTruckSubType: \"Самосвал\",\nTruckSubTypeID: \"САМОСВАЛ\",\nTruckTare: \"14 312\",\nTruckFullWeight: \"34 000\",\nItemName: \"Відходи 3 категорії з соняшника\",\nItemID: \"ВІДХОДИ_3_СОН\",\nItemGroupName: \"Відходи 3-ї кат.\",\nItemGroupID: \"ВІДХОДИ 3 КАТ\",\n\n}\nmsg.url_above = \"http://10.45.1.11/Streaming/channels/1/picture\";\nmsg.url_front = \"http://10.45.1.14/Streaming/channels/1/picture\";\nmsg.url_back  = \"http://10.45.1.15/Streaming/channels/1/picture\";\n\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":600,"wires":[["f1884fb3.0f845","1885547b.a082ac"]]},{"id":"ec12e054.2ad38","type":"inject","z":"3d3d5d98.3bdb72","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":84.73213958740234,"y":596.7857398986816,"wires":[["e91cb063.e8a39"]]},{"id":"f1884fb3.0f845","type":"debug","z":"3d3d5d98.3bdb72","name":"","active":false,"console":"false","complete":"false","x":377.3214416503906,"y":593.3928413391113,"wires":[]},{"id":"fd8ee67a.b37f38","type":"inject","z":"11ac1d6c.2da8f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":180,"y":160,"wires":[["874b5b57.f82308"]]},{"id":"874b5b57.f82308","type":"template","z":"11ac1d6c.2da8f3","name":"CREATE TABLE","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"CREATE TABLE event_table\n(\n    Event_name character varying,\n    Event_description character varying,\n    IP character varying,\n    Command character varying\n\n)","x":370,"y":160,"wires":[[]]},{"id":"3051c095.f8303","type":"inject","z":"11ac1d6c.2da8f3","name":"trigger","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":240,"wires":[["1debdf56.c45241"]]},{"id":"1debdf56.c45241","type":"template","z":"11ac1d6c.2da8f3","name":"format query","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"select * from event_table ","x":350,"y":244,"wires":[["8aecf8b7.6efa28"]]},{"id":"9cea44e9.de9de8","type":"comment","z":"11ac1d6c.2da8f3","name":"створена таблиця івентів ","info":"","x":310,"y":120,"wires":[]},{"id":"56e424be.04ecbc","type":"debug","z":"11ac1d6c.2da8f3","name":"","active":true,"console":false,"complete":"payload","x":750,"y":200,"wires":[]},{"id":"d3f7fc76.82912","type":"inject","z":"11ac1d6c.2da8f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":200,"y":60,"wires":[["ccb11493.786ca8"]]},{"id":"ccb11493.786ca8","type":"template","z":"11ac1d6c.2da8f3","name":" add colon","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"ALTER TABLE event_table\nADD COLUMN resultAnalysis character varying;\n\n\n","x":360,"y":60,"wires":[["7d9612c6.24554c"]]},{"id":"7d9612c6.24554c","type":"debug","z":"11ac1d6c.2da8f3","name":"","active":true,"console":false,"complete":"false","x":590,"y":60,"wires":[]},{"id":"8aecf8b7.6efa28","type":"postgres","z":"11ac1d6c.2da8f3","postgresdb":"1af05285.16139d","name":"rfid_log","output":true,"outputs":1,"x":584,"y":192,"wires":[["56e424be.04ecbc"]]},{"id":"f6c19cd1.890d1","type":"function","z":"3d3d5d98.3bdb72","name":"setup params","func":"msg.queryParameters = msg.queryParameters || {};\nmsg.queryParameters.param1 = msg.payload.event_name;\nmsg.queryParameters.param2 = msg.payload.event_desc;\nmsg.queryParameters.param3 = msg.payload.ip;\nmsg.queryParameters.param4 = flow.get(\"isoDate\");\nmsg.queryParameters.param5 = flow.get('currentWeight');\nmsg.queryParameters.param6 = flow.get('truck1');\nmsg.queryParameters.param7 = flow.get('truck2');\n\nreturn msg;","outputs":1,"noerr":0,"x":430.83341217041016,"y":4516.000051498413,"wires":[["b0ff3a81.e91cc8"]]},{"id":"b0ff3a81.e91cc8","type":"template","z":"3d3d5d98.3bdb72","name":"query field1","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO event_table(\n             Event_name,Event_description,IP,lastSeenTimestampUTC,EventValue1,EventValue2,EventValue3)\n    VALUES ($param1,$param2,$param3,$param4,$param5,$param6,$param7);","x":618.3334159851074,"y":4511.000051498413,"wires":[[]]},{"id":"9c117a59.6ccec8","type":"function","z":"3d3d5d98.3bdb72","name":"telemetry","func":"msg.headers = {\n    \"Content-Type\":\"application/json\"\n}\nmsg.payload = msg.payload.telemetry;\nreturn msg;","outputs":1,"noerr":0,"x":239.58341217041016,"y":4588.750053405762,"wires":[["5f671880.780be8","80bbb5e2.693b78"]]},{"id":"5f671880.780be8","type":"function","z":"3d3d5d98.3bdb72","name":"заголовок","func":"msg.payload.ip = '10.3.5.202';\nmsg.payload.event_name = \"Подія на 80т\";\nmsg.payload.event_desc = msg.payload.event;\nreturn msg;","outputs":1,"noerr":0,"x":395.83341217041016,"y":4586.250053405762,"wires":[["f6c19cd1.890d1"]]},{"id":"7c703085.82a1a","type":"function","z":"89e4584a.994288","name":"setup params","func":"msg.queryParameters = msg.queryParameters || {};\nmsg.queryParameters.param1 = msg.payload.event_name;\nmsg.queryParameters.param2 = msg.payload.event_desc;\nmsg.queryParameters.param3 = msg.payload.ip;\nmsg.queryParameters.param4 = flow.get(\"isoDate\");\nmsg.queryParameters.param5 = flow.get('currentWeight');\nmsg.queryParameters.param6 = flow.get('truck1');\nmsg.queryParameters.param7 = flow.get('truck2');\n\nreturn msg;","outputs":1,"noerr":0,"x":488.03580474853516,"y":4706.785710334778,"wires":[["aea30e87.02b85"]]},{"id":"aea30e87.02b85","type":"template","z":"89e4584a.994288","name":"query field1","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO event_table(\n             Event_name,Event_description,IP,lastSeenTimestampUTC,EventValue1,EventValue2,EventValue3)\n    VALUES ($param1,$param2,$param3,$param4,$param5,$param6,$param7);","x":655.0000686645508,"y":4705.000022888184,"wires":[["2df0e052.8486"]]},{"id":"da386095.24136","type":"function","z":"89e4584a.994288","name":"telemetry","func":"msg.headers = {\n    \"Content-Type\":\"application/json\"\n}\nmsg.payload = msg.payload.telemetry;\nreturn msg;","outputs":1,"noerr":0,"x":177.67859649658203,"y":4766.678584098816,"wires":[["5a5a297d.b216a8","398b83c8.6279cc"]]},{"id":"5a5a297d.b216a8","type":"function","z":"89e4584a.994288","name":"заголовок","func":"msg.payload.ip = '10.3.5.202';\nmsg.payload.event_name = \"Подія на 60т\";\nmsg.payload.event_desc = msg.payload.event;\nreturn msg;","outputs":1,"noerr":0,"x":318.8214645385742,"y":4705.535782814026,"wires":[["7c703085.82a1a"]]},{"id":"f1b2afd7.97d87","type":"debug","z":"89e4584a.994288","name":"","active":false,"console":"false","complete":"true","x":953.7500877380371,"y":4708.750023841858,"wires":[]},{"id":"32409473.646afc","type":"template","z":"11ac1d6c.2da8f3","name":"format query","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM event_table\nWHERE lastseentimestamputc <> NULL\nORDER BY lastseentimestamputc DESC\nLIMIT 100 ;\n","x":399,"y":389,"wires":[["8aecf8b7.6efa28"]]},{"id":"1ba392b.8bbab6d","type":"inject","z":"11ac1d6c.2da8f3","name":"trigger","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":185,"y":394,"wires":[["32409473.646afc"]]},{"id":"392640a1.a710a","type":"comment","z":"11ac1d6c.2da8f3","name":"читаєм таблицю івентів","info":"","x":310,"y":200,"wires":[]},{"id":"58b62e24.7c2db","type":"comment","z":"11ac1d6c.2da8f3","name":"зчитуєм останні","info":"","x":278,"y":331,"wires":[]},{"id":"80bbb5e2.693b78","type":"http request","z":"3d3d5d98.3bdb72","name":"ThingsBoard Smart ","method":"POST","ret":"txt","url":"http://10.3.5.223:8080/api/v1/v0nRTrSs8l2bQMjlByaJ/telemetry","tls":"","x":400.83341217041016,"y":4633.750053405762,"wires":[[]]},{"id":"b5889bdb.ca61a8","type":"comment","z":"3d3d5d98.3bdb72","name":"Поді про зважування в 1С","info":"","x":464.5834197998047,"y":4463.750049591064,"wires":[]},{"id":"145925b0.5a665a","type":"comment","z":"3d3d5d98.3bdb72","name":"Поді на вагах","info":"","x":1618.75,"y":365,"wires":[]},{"id":"398b83c8.6279cc","type":"http request","z":"89e4584a.994288","name":"ThingsBoard Smart ","method":"POST","ret":"txt","url":"http://10.3.5.223:8080/api/v1/SORWdWUxyshYXMt05Zd8/telemetry","tls":"","x":392.8572311401367,"y":4859.28572177887,"wires":[[]]},{"id":"e8e006e0.ad85e8","type":"comment","z":"89e4584a.994288","name":"Поді на вагах","info":"","x":1751.4285888671875,"y":394.2857360839844,"wires":[]},{"id":"b98a1d3a.5e9d3","type":"comment","z":"89e4584a.994288","name":"Поді про зважування в 1С","info":"","x":463.92867279052734,"y":4658.035759925842,"wires":[]},{"id":"f0f95081.8e141","type":"function","z":"89e4584a.994288","name":"setup isoDate","func":"\nmsg.payload = new Date();\nvar isoDate = new Date().toISOString();\n\n/*\nFri Dec 21 2018 15:33:01 GMT+0000 (Coordinated Universal Time)\nFri Dec 21 2018 15:32:04 GMT+0000 (UTC)\n\nlastseentimestamputc: \"2018-12-21T14:20:12.550+00:00\"\nlastseentimestamputc: \"\"2018-12-21T14:39:03.994Z\"\"\n\n*/\nflow.set(\"isoDate\",isoDate);\nmsg.payload = isoDate;\nreturn msg;","outputs":1,"noerr":0,"x":563.7500762939453,"y":4781.500031471252,"wires":[["d9f71349.c913d"]]},{"id":"f10e44c5.6e3628","type":"inject","z":"89e4584a.994288","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":388.7500762939453,"y":4781.500029563904,"wires":[["f0f95081.8e141"]]},{"id":"d9f71349.c913d","type":"debug","z":"89e4584a.994288","name":"","active":false,"console":"false","complete":"false","x":730.0000801086426,"y":4783.750029563904,"wires":[]},{"id":"4ad632e9.f5607c","type":"comment","z":"11ac1d6c.2da8f3","name":"зчитуєм вибірку","info":"","x":287.5,"y":456.25,"wires":[]},{"id":"ae81263b.4bcb98","type":"inject","z":"11ac1d6c.2da8f3","name":"trigger","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":170,"y":505,"wires":[["ca1d6f3b.a1f5a"]]},{"id":"ca1d6f3b.a1f5a","type":"template","z":"11ac1d6c.2da8f3","name":"format query","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM event_table\nLIMIT 100  OFFSET 105100;","x":384,"y":500,"wires":[["8aecf8b7.6efa28"]]},{"id":"91670e15.00af3","type":"comment","z":"89e4584a.994288","name":"Встановлення дати","info":"","x":576.2500457763672,"y":4748.750027656555,"wires":[]},{"id":"a683ddd.7cae82","type":"function","z":"3d3d5d98.3bdb72","name":"setup isoDate","func":"\nmsg.payload = new Date();\nvar isoDate = new Date().toISOString();\n\n/*\nFri Dec 21 2018 15:33:01 GMT+0000 (Coordinated Universal Time)\nFri Dec 21 2018 15:32:04 GMT+0000 (UTC)\n\nlastseentimestamputc: \"2018-12-21T14:20:12.550+00:00\"\nlastseentimestamputc: \"\"2018-12-21T14:39:03.994Z\"\"\n\n*/\nflow.set(\"isoDate\",isoDate);\nmsg.payload = isoDate;\nreturn msg;","outputs":1,"noerr":0,"x":550.8334121704102,"y":4707.500047683716,"wires":[["82b96ed3.c1fc3"]]},{"id":"e1737c6e.3f8c4","type":"inject","z":"3d3d5d98.3bdb72","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":375.83341217041016,"y":4707.500045776367,"wires":[["a683ddd.7cae82"]]},{"id":"82b96ed3.c1fc3","type":"debug","z":"3d3d5d98.3bdb72","name":"","active":false,"console":"false","complete":"false","x":717.0834159851074,"y":4709.750045776367,"wires":[]},{"id":"b161f5a5.a64bb8","type":"comment","z":"3d3d5d98.3bdb72","name":"Встановлення дати","info":"","x":563.333381652832,"y":4674.750043869019,"wires":[]},{"id":"2ea47bd.03c0684","type":"link in","z":"417832f2.ceac3c","name":"","links":["1885547b.a082ac","ec69a399.9b01e"],"x":45.000003814697266,"y":104.44443798065186,"wires":[["25773261.c5ed5e"]]},{"id":"1885547b.a082ac","type":"link out","z":"3d3d5d98.3bdb72","name":"","links":["2ea47bd.03c0684"],"x":547.5000076293945,"y":821.2500114440918,"wires":[]},{"id":"25773261.c5ed5e","type":"function","z":"417832f2.ceac3c","name":"to mongo","func":"msg.metadata = msg.payload;\nmsg.metadata.rowKey =  \"key\"+new Date()+msg.metadata.reader;\nflow.set('rowKey_for_analis',\"key\"+new Date()+msg.metadata.reader);\nreturn msg;","outputs":1,"noerr":0,"x":150.00000381469727,"y":104.44443798065186,"wires":[["9bc41848.5242e8","d0d7f11f.c29c3","2604db35.153bd4","b4e98284.c0be1","a392dd27.cef2e"]]},{"id":"d7b35695.185368","type":"http request","z":"417832f2.ceac3c","name":"","method":"POST","ret":"obj","url":"http://10.1.132.168:1880/api/Logs/setData","tls":"","x":740.0000038146973,"y":124.44443798065186,"wires":[["a1edaea6.b1785"]]},{"id":"a1edaea6.b1785","type":"debug","z":"417832f2.ceac3c","name":"","active":false,"console":"false","complete":"false","x":920.0000038146973,"y":124.44443798065186,"wires":[]},{"id":"efa904e.e8f04f8","type":"http request","z":"417832f2.ceac3c","name":"above","method":"GET","ret":"bin","url":"","tls":"","x":420.00000381469727,"y":164.44443798065186,"wires":[["81aaac63.a01f7"]]},{"id":"d0e96afd.b7e048","type":"http response","z":"417832f2.ceac3c","name":"","x":545,"y":362.75,"wires":[]},{"id":"f0f3700c.6fa31","type":"http request","z":"417832f2.ceac3c","name":"front","method":"GET","ret":"bin","url":"","tls":"","x":420.00000381469727,"y":204.44443798065186,"wires":[["24626e3a.b6ff42"]]},{"id":"7f126012.99fe9","type":"http request","z":"417832f2.ceac3c","name":"back","method":"GET","ret":"bin","url":"","tls":"","x":420.00000381469727,"y":244.44443798065186,"wires":[["1b4a2d0c.ff7cb3"]]},{"id":"2b347c73.34e934","type":"function","z":"417832f2.ceac3c","name":"","func":"msg.url = \"http://10.1.132.168:1880/api/Photo/setData?rowKey=\"+msg.metadata.rowKey+\"&type=\"+msg.type;\nreturn msg;","outputs":1,"noerr":0,"x":660.0000038146973,"y":224.44443798065186,"wires":[["fb734c35.d2c29","914be0c8.ac25c"]]},{"id":"9bc41848.5242e8","type":"function","z":"417832f2.ceac3c","name":"","func":"msg.payload = msg.metadata;\nreturn msg;","outputs":1,"noerr":0,"x":580.0000038146973,"y":124.44443798065186,"wires":[["d7b35695.185368"]]},{"id":"521781e9.5b746","type":"function","z":"3d3d5d98.3bdb72","name":"to mongo","func":"msg.payload = msg.req.query;\nmsg.url_above = \"http://10.45.1.11/Streaming/channels/1/picture\";\nmsg.url_front = \"http://10.45.1.14/Streaming/channels/1/picture\";\nmsg.url_back  = \"http://10.45.1.15/Streaming/channels/1/picture\";\nreturn msg;","outputs":1,"noerr":0,"x":432.50000762939453,"y":831.2500123977661,"wires":[["1885547b.a082ac"]]},{"id":"8bd611a9.b840e","type":"link out","z":"3d3d5d98.3bdb72","name":"Send D on TB 1C 80t","links":["f55a217e.a133f"],"x":1489.1430082321167,"y":965.1428565979004,"wires":[]},{"id":"1aa1dda1.3e2322","type":"postgres","z":"df260e7f.13538","postgresdb":"1af05285.16139d","name":"rfid_log","output":true,"outputs":1,"x":945.7144012451172,"y":314.5237636566162,"wires":[["58011ad0.e18674"]]},{"id":"fdfe0a2d.1f2828","type":"function","z":"df260e7f.13538","name":"setup params","func":"msg.queryParameters = msg.queryParameters || {};\nmsg.queryParameters.param1 = msg.payload.event_name;\nmsg.queryParameters.param2 = msg.payload.event_desc;\nmsg.queryParameters.param3 = msg.payload.ip;\nmsg.queryParameters.param4 = flow.get(\"isoDate\");\nmsg.queryParameters.param5 = msg.payload.weight_for_1c;\nmsg.queryParameters.param6 = msg.payload.truck1;\nmsg.queryParameters.param7 = msg.payload.truck2;\nmsg.queryParameters.param8 = msg.payload.tag;\nmsg.queryParameters.param9 = msg.payload.perimetrStatus;\nreturn msg;","outputs":1,"noerr":0,"x":605.8929214477539,"y":317.24997329711914,"wires":[["38e953c0.3505ec"]]},{"id":"38e953c0.3505ec","type":"template","z":"df260e7f.13538","name":"query field1","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO event_table(\n             Event_name,Event_description,IP,lastSeenTimestampUTC,EventValue1,EventValue2,EventValue3,Tag,perimetrStatus)\n    VALUES ($param1,$param2,$param3,$param4,$param5,$param6,$param7,$param8,$param9);","x":788.3929443359375,"y":317.2499713897705,"wires":[["1aa1dda1.3e2322"]]},{"id":"d3ba702d.86dc","type":"function","z":"df260e7f.13538","name":"telemetry","func":"msg.headers = {\n    \"Content-Type\":\"application/json\"\n}\nmsg.payload = msg.payload.telemetry;\nreturn msg;","outputs":1,"noerr":0,"x":273.21434020996094,"y":317.1428451538086,"wires":[["4c67e74f.1cfa98"]]},{"id":"4c67e74f.1cfa98","type":"function","z":"df260e7f.13538","name":"заголовок","func":"msg.payload.ip = '10.3.5.202';\nmsg.payload.event_name = \"Подія на 80т\";\nmsg.payload.event_desc = msg.payload.event;\nmsg.payload.truck1 = flow.get('truck1');\nmsg.payload.truck2 = flow.get('truck2');\nmsg.payload.weight_for_1c = flow.get('weight_for_1c');\nmsg.payload.tag = msg.tagId;\nmsg.payload.perimetrStatus = msg.perimetrStatus;\nreturn msg;","outputs":1,"noerr":0,"x":440.8929214477539,"y":314.64284324645996,"wires":[["fdfe0a2d.1f2828"]]},{"id":"415b39bd.cc6708","type":"http request","z":"df260e7f.13538","name":"ThingsBoard Smart ","method":"POST","ret":"txt","url":"http://10.3.5.223:8080/api/v1/v0nRTrSs8l2bQMjlByaJ/telemetry","tls":"","x":443.9881362915039,"y":390.3968029022217,"wires":[[]]},{"id":"32e13080.88eed","type":"comment","z":"df260e7f.13538","name":"Поді про зважування в 1С","info":"","x":401.0714797973633,"y":266.42858505249023,"wires":[]},{"id":"8f975bf8.cb4078","type":"function","z":"df260e7f.13538","name":"setup isoDate","func":"\nmsg.payload = new Date();\nvar isoDate = new Date().toISOString();\n\n/*\nFri Dec 21 2018 15:33:01 GMT+0000 (Coordinated Universal Time)\nFri Dec 21 2018 15:32:04 GMT+0000 (UTC)\n\nlastseentimestamputc: \"2018-12-21T14:20:12.550+00:00\"\nlastseentimestamputc: \"\"2018-12-21T14:39:03.994Z\"\"\n\n*/\nflow.set(\"isoDate\",isoDate);\nmsg.payload = isoDate;\nreturn msg;","outputs":1,"noerr":0,"x":771.6071472167969,"y":72.75000953674316,"wires":[["cf5ee32.f5d4c2"]]},{"id":"9a63da4e.917ac8","type":"inject","z":"df260e7f.13538","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":596.6071472167969,"y":72.75000762939453,"wires":[["8f975bf8.cb4078"]]},{"id":"cf5ee32.f5d4c2","type":"debug","z":"df260e7f.13538","name":"","active":false,"console":"false","complete":"false","x":943.5714416503906,"y":76.42859268188477,"wires":[]},{"id":"6e1085f1.9fe4fc","type":"comment","z":"df260e7f.13538","name":"Встановлення дати","info":"","x":764.1071014404297,"y":32.85714149475098,"wires":[]},{"id":"13ef793f.141b97","type":"function","z":"df260e7f.13538","name":"ThingsBoard integrations","func":"var resultTH = {\n   \"deviceName\": \"vesa80t\",\n   \"deviceType\": \"avto\",\n   \"attributes\": {\n       \"model\": \"Koda d400\",\n       \"serialNumber\": \"SN012345\",\n       \"integrationName\": \"Smart scale integration\"\n   }\n};\nflow.set('resultTH',resultTH);   \nreturn msg;","outputs":1,"noerr":0,"x":323.8095474243164,"y":47.14285659790039,"wires":[[]]},{"id":"3c855f9b.c73ce","type":"inject","z":"df260e7f.13538","name":"init","topic":"","payload":"init","payloadType":"str","repeat":"","crontab":"","once":true,"x":127.85713195800781,"y":44.04762268066406,"wires":[["13ef793f.141b97"]]},{"id":"19ae253.5cfdadb","type":"comment","z":"df260e7f.13538","name":"Відправка на TB","info":"","x":440.1587600708008,"y":356.0317840576172,"wires":[]},{"id":"f55a217e.a133f","type":"link in","z":"df260e7f.13538","name":"","links":["8bd611a9.b840e","fad3ae90.04543","8991ed0c.f5f5a","8f29ec3b.7bbd9"],"x":120.00000980922152,"y":315.7142898014613,"wires":[["d3ba702d.86dc","d5999b35.407738"]]},{"id":"e6afb0ee.09706","type":"link out","z":"89e4584a.994288","name":"Send D on TB 1C 60t","links":["21fda60f.1c889a","248d489.c953cb8"],"x":1410.7143287658691,"y":731.9047756195068,"wires":[]},{"id":"f70cf669.5c1488","type":"postgres","z":"89e4584a.994288","postgresdb":"1af05285.16139d","name":"rfid_log","output":true,"outputs":1,"x":2205.000087738037,"y":458.3333206176758,"wires":[[]]},{"id":"8d3cf09a.edf69","type":"comment","z":"3d3d5d98.3bdb72","name":"Події про зважування","info":"Avto80t send data in 1C","x":1453.3333892822266,"y":911.6666603088379,"wires":[]},{"id":"74fc5690.0c15d8","type":"comment","z":"89e4584a.994288","name":"Події про зважування","info":"Avto60t send data in 1C","x":1368.333251953125,"y":676.6666259765625,"wires":[]},{"id":"d5999b35.407738","type":"function","z":"df260e7f.13538","name":"set truck","func":"flow.set('truck1',msg.payload.truck1);\nflow.set('truck2',msg.payload.truck2);\nflow.set('weight_for_1c',msg.payload.weight_for_1c);\n\nmsg.payalod = flow.get('truck1');\nreturn msg;","outputs":1,"noerr":0,"x":227.14287567138672,"y":224.28572273254395,"wires":[[]]},{"id":"ed107599.c4d268","type":"function","z":"89e4584a.994288","name":"req_wit_1c","func":"var payload = flow.get('resultTH');\nvar truck1 = flow.get('truck1');\nvar truck2 = flow.get('truck2');\npayload.truck1 = truck1;\npayload.truck2 = truck2;\nvar weight_for_1c = flow.get('currentWeight');\npayload.weight_for_1c = weight_for_1c;\n\npayload.telemetry = {\n    \"event\" :\"1C взвесило. Вес:\" + weight_for_1c + \". Авто \" + truck1 + \". Прицеп \" + truck2\n    \n    }; \nmsg.payload = payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":1119.9999809265137,"y":750.0000190734863,"wires":[["46fd87d3.707e18"]]},{"id":"248d489.c953cb8","type":"link in","z":"df260e7f.13538","name":"","links":["e6afb0ee.09706"],"x":34.28571319580078,"y":694.2857055664062,"wires":[["e450e033.336c9","43e581f5.07ed4"]]},{"id":"43e581f5.07ed4","type":"function","z":"df260e7f.13538","name":"telemetry","func":"msg.headers = {\n    \"Content-Type\":\"application/json\"\n}\nmsg.payload = msg.payload.telemetry;\nreturn msg;","outputs":1,"noerr":0,"x":209.00799560546875,"y":695.4761905670166,"wires":[["44bc92e6.664ccc"]]},{"id":"fffb3ff2.0e06f","type":"http request","z":"df260e7f.13538","name":"ThingsBoard Smart ","method":"POST","ret":"txt","url":"http://10.3.5.223:8080/api/v1/SORWdWUxyshYXMt05Zd8/telemetry","tls":"","x":443.1151351928711,"y":769.8413124084473,"wires":[[]]},{"id":"a4756e3d.8aec7","type":"comment","z":"df260e7f.13538","name":"Поді про зважування в 1С","info":"","x":384.642909867423,"y":644.7619514465332,"wires":[]},{"id":"b44af753.556018","type":"comment","z":"df260e7f.13538","name":"Відправка на TB","info":"","x":428.1746368408203,"y":732.1429538726807,"wires":[]},{"id":"e450e033.336c9","type":"function","z":"df260e7f.13538","name":"set truck","func":"flow.set('truck1_60',msg.payload.truck1);\nflow.set('truck2_60',msg.payload.truck2);\nflow.set('weight_for_1c_60',msg.payload.weight_for_1c);\n\nmsg.payalod = flow.get('truck1');\nreturn msg;","outputs":1,"noerr":0,"x":202.93653869628906,"y":653.7302150726318,"wires":[[]]},{"id":"a95e79b5.975d18","type":"comment","z":"df260e7f.13538","name":"Події на 60 тон","info":"","x":181.96429443359375,"y":606.428596496582,"wires":[]},{"id":"1bb8074e.31cf89","type":"comment","z":"df260e7f.13538","name":"Події на 60 тон","info":"","x":352.28173828125,"y":606.4286231994629,"wires":[]},{"id":"1406ab6a.944dc5","type":"comment","z":"df260e7f.13538","name":"Події на 80 тон","info":"","x":380.0000228881836,"y":171.42857551574707,"wires":[]},{"id":"fb734c35.d2c29","type":"http request","z":"417832f2.ceac3c","name":"","method":"POST","ret":"obj","url":"","tls":"","x":803.0556259155273,"y":218.16667938232422,"wires":[[]]},{"id":"81aaac63.a01f7","type":"function","z":"417832f2.ceac3c","name":"","func":"msg.type = 'above';\nflow.set('type_for_analis',msg.type);\nreturn msg;","outputs":1,"noerr":0,"x":540.0000038146973,"y":164.44443798065186,"wires":[["2b347c73.34e934"]]},{"id":"24626e3a.b6ff42","type":"function","z":"417832f2.ceac3c","name":"","func":"msg.type = 'front';\nreturn msg;","outputs":1,"noerr":0,"x":540.0000038146973,"y":204.44443798065186,"wires":[["2b347c73.34e934"]]},{"id":"1b4a2d0c.ff7cb3","type":"function","z":"417832f2.ceac3c","name":"","func":"msg.type = 'back';\nreturn msg;","outputs":1,"noerr":0,"x":540.0000038146973,"y":244.44443798065186,"wires":[["2b347c73.34e934"]]},{"id":"d0d7f11f.c29c3","type":"function","z":"417832f2.ceac3c","name":"url above","func":"msg.url = msg.url_above;\nreturn msg;","outputs":1,"noerr":0,"x":290.00000381469727,"y":164.44443798065186,"wires":[["efa904e.e8f04f8"]]},{"id":"2604db35.153bd4","type":"function","z":"417832f2.ceac3c","name":"url front","func":"msg.url = msg.url_front;\nreturn msg;","outputs":1,"noerr":0,"x":290.00000381469727,"y":204.44443798065186,"wires":[["f0f3700c.6fa31"]]},{"id":"b4e98284.c0be1","type":"function","z":"417832f2.ceac3c","name":"url_back","func":"msg.url = msg.url_back;\nreturn msg;","outputs":1,"noerr":0,"x":290.00000381469727,"y":244.44443798065186,"wires":[["7f126012.99fe9"]]},{"id":"ec69a399.9b01e","type":"link out","z":"89e4584a.994288","name":"60 t mongo","links":["2ea47bd.03c0684"],"x":540.000002861023,"y":593.3333778381348,"wires":[]},{"id":"287ee419.3de14c","type":"http request","z":"417832f2.ceac3c","name":"","method":"GET","ret":"bin","url":"http://10.45.1.11/Streaming/channels/1/picture","tls":"","x":381.25000762939453,"y":360,"wires":[["d0e96afd.b7e048"]]},{"id":"843f309.7ac1cd","type":"http in","z":"417832f2.ceac3c","name":"","url":"/getPhoto","method":"get","swaggerDoc":"","x":167.5,"y":365.0000057220459,"wires":[["287ee419.3de14c"]]},{"id":"67f943dc.73844c","type":"http request","z":"417832f2.ceac3c","name":"","method":"GET","ret":"bin","url":"http://admin:Rfhfcb13q@10.45.16.12/Streaming/channels/1/picture","tls":"","x":355,"y":529,"wires":[["16dd01a.0165bfe"]]},{"id":"abe700d4.7f51","type":"inject","z":"417832f2.ceac3c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":175,"y":531,"wires":[["67f943dc.73844c"]]},{"id":"16dd01a.0165bfe","type":"debug","z":"417832f2.ceac3c","name":"","active":true,"console":"false","complete":"false","x":540.0000076293945,"y":523.5000076293945,"wires":[]},{"id":"e5e875dc.761018","type":"comment","z":"3d3d5d98.3bdb72","name":"Події про стабільність ваги","info":"Avto60t send data in 1C","x":780,"y":1126.25,"wires":[]},{"id":"43e416e0.01a8d8","type":"link in","z":"6593b3ce.8e2a6c","name":"stable 80t","links":["e8a24ad6.a71768"],"x":139.28571428571428,"y":164.28571428571428,"wires":[["6163f2da.b0000c"]]},{"id":"2d38584a.88baa8","type":"link in","z":"6593b3ce.8e2a6c","name":"stable 60t","links":["37a9886a.ab2378"],"x":130.71428871154785,"y":707.1428108215332,"wires":[["22b9eea7.219392"]]},{"id":"9f743f82.358fd","type":"comment","z":"6593b3ce.8e2a6c","name":"80t","info":"","x":289.2857142857143,"y":44.285714285714285,"wires":[]},{"id":"c612ae66.62741","type":"comment","z":"6593b3ce.8e2a6c","name":"60t","info":"","x":271.4285764694214,"y":647.1428270339966,"wires":[]},{"id":"e8a24ad6.a71768","type":"link out","z":"3d3d5d98.3bdb72","name":"","links":["43e416e0.01a8d8"],"x":827.8571166992188,"y":122.85715007781982,"wires":[]},{"id":"37a9886a.ab2378","type":"link out","z":"89e4584a.994288","name":"","links":["2d38584a.88baa8"],"x":996.4285714285713,"y":178.57142857142856,"wires":[]},{"id":"6163f2da.b0000c","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"true","x":276.42857360839844,"y":84.28570365905762,"wires":[]},{"id":"22b9eea7.219392","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"true","x":267.14286708831787,"y":685.7142648696899,"wires":[]},{"id":"f5615cde.8bded","type":"tcp in","z":"6593b3ce.8e2a6c","name":"","server":"client","host":"10.3.5.223","port":"4003","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":140,"y":241.4285717010498,"wires":[["f33f1e20.63073","2e841a52.863356"]]},{"id":"f33f1e20.63073","type":"function","z":"6593b3ce.8e2a6c","name":"get tag","func":"flow.set(\"tag_epc_80\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":243.9285707473755,"wires":[[]]},{"id":"2e841a52.863356","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"false","x":321.51786041259766,"y":286.24997329711914,"wires":[]},{"id":"9d0db881.d09688","type":"inject","z":"6593b3ce.8e2a6c","name":"","topic":"","payload":"tag_epc_80","payloadType":"flow","repeat":"","crontab":"","once":false,"x":143.42259979248047,"y":289.22606086730957,"wires":[["2e841a52.863356"]]},{"id":"28cfddad.6c34b2","type":"tcp in","z":"6593b3ce.8e2a6c","name":"","server":"client","host":"10.3.5.223","port":"4004","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":151.42857360839844,"y":800,"wires":[["83f65de6.8a28f","ad872e0d.d070c"]]},{"id":"83f65de6.8a28f","type":"function","z":"6593b3ce.8e2a6c","name":"get tag","func":"flow.set(\"tag_epc_60\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":331.42857360839844,"y":802.4999990463257,"wires":[[]]},{"id":"ad872e0d.d070c","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"false","x":315.2678527832031,"y":860.1785469055176,"wires":[]},{"id":"8eec8b41.acf2e8","type":"inject","z":"6593b3ce.8e2a6c","name":"","topic":"","payload":"tag_epc_60","payloadType":"flow","repeat":"","crontab":"","once":false,"x":144.40474700927734,"y":857.9760589599609,"wires":[["ad872e0d.d070c"]]},{"id":"b483f1e3.e32e6","type":"function","z":"6593b3ce.8e2a6c","name":"st w e","func":"var weight = flow.get('currentWeight_80');\nvar stable = flow.get('stability_80');  \n    \n    \n    if((weight > 200) && (stable === true) ){\n    msg.payload = 'Вес стабильный.' + \" Вес:\" + weight ; \n    \n    }else{\n     msg.payload = '5'\n    \n    }\n    \n    \n    \n    \nreturn msg;\n","outputs":1,"noerr":0,"x":739.9999618530273,"y":188.0952262878418,"wires":[["e2c3d1fb.edb","78eb4cf3.ae2c24"]]},{"id":"67c0ab6c.8efd64","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"false","x":1709.6668548583984,"y":167.4920139312744,"wires":[]},{"id":"78eb4cf3.ae2c24","type":"switch","z":"6593b3ce.8e2a6c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"5","vt":"str"}],"checkall":"true","outputs":1,"x":923.0000267028809,"y":191.30177879333496,"wires":[["d90361cb.9eeb7"]]},{"id":"e2c3d1fb.edb","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"false","x":1043.5555324554443,"y":136.2221965789795,"wires":[]},{"id":"3a17d141.43eaee","type":"function","z":"6593b3ce.8e2a6c","name":"стабильность веса","func":"var payload = flow.get('resultTH');\npayload.telemetry = {\n    \"event\" : msg.payload\n    \n    }; \nmsg.payload = payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":1499.6668014526367,"y":188.99991416931152,"wires":[["67c0ab6c.8efd64","8f29ec3b.7bbd9"]]},{"id":"6af59bd.efbb664","type":"function","z":"6593b3ce.8e2a6c","name":"st w e reset","func":"var weight = flow.get('currentWeight_80');\nvar stable = flow.get('stability_80');  \n    \n    \n    if((stable === false )){\n    msg.payload = 2;\n    }\n    \n    \n    \n    \nreturn msg;\n","outputs":1,"noerr":0,"x":756.1744766235352,"y":230.3968276977539,"wires":[["10053be4.eac624"]]},{"id":"d90361cb.9eeb7","type":"trigger","z":"6593b3ce.8e2a6c","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"2","name":"","x":1153.5553016662598,"y":190.66656684875488,"wires":[["f146dc5d.e3d0b","9c920221.e0d7b"]]},{"id":"f146dc5d.e3d0b","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"false","x":1341.8887634277344,"y":239.55549812316895,"wires":[]},{"id":"7d6a2caa.e1a014","type":"inject","z":"6593b3ce.8e2a6c","name":"","topic":"","payload":"2","payloadType":"num","repeat":"","crontab":"","once":true,"x":909.2698211669922,"y":260.58721351623535,"wires":[["d90361cb.9eeb7"]]},{"id":"9c920221.e0d7b","type":"switch","z":"6593b3ce.8e2a6c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"2","vt":"num"}],"checkall":"true","outputs":1,"x":1335.2221374511719,"y":190.11099338531494,"wires":[["3a17d141.43eaee"]]},{"id":"10053be4.eac624","type":"switch","z":"6593b3ce.8e2a6c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"2","vt":"num"}],"checkall":"true","outputs":1,"x":908.9524116516113,"y":227.22209358215332,"wires":[["d90361cb.9eeb7"]]},{"id":"e503ead3.4426c8","type":"comment","z":"6593b3ce.8e2a6c","name":"Події про стабільність ваги","info":"Avto60t send data in 1C","x":764.666654586792,"y":151.36106872558594,"wires":[]},{"id":"b36d048d.23f0f8","type":"function","z":"6593b3ce.8e2a6c","name":"st w e","func":"var weight = flow.get('currentWeight_80');\nvar stable = flow.get('stability_80');  \nvar tag = flow.get(\"tag_epc_80\");    \n    \n    if((weight > 200) && (stable === true) ){\n    msg.payload = 'Без операторное взвешивания.' + \" Вес:\" + weight + \". Мітка:\" + tag; \n    \n    }else{\n     msg.payload = '5'\n    \n    }\n    \n//периметр пересечен    \n    \n    \nreturn msg;\n","outputs":1,"noerr":0,"x":651.5118103027344,"y":358.62295722961426,"wires":[["18724e9d.20a561"]]},{"id":"18724e9d.20a561","type":"switch","z":"6593b3ce.8e2a6c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"5","vt":"str"}],"checkall":"true","outputs":1,"x":780.4405212402344,"y":360.4682102203369,"wires":[["68890155.b948b"]]},{"id":"91bf528e.e288","type":"function","z":"6593b3ce.8e2a6c","name":"стабильность веса + мітка","func":"var payload = flow.get('resultTH');\npayload.telemetry = {\n    \"event\" : flow.get(\"str_st_80\") + \". \" + flow.get(\"perimetrStatus_80\")\n    \n    }; \nmsg.payload = payload;\nmsg.tagId = flow.get('tag_epc_80');\nreturn msg;","outputs":1,"noerr":0,"x":1390.3808898925781,"y":394.09919261932373,"wires":[["53a6da1a.8a40d4","8f29ec3b.7bbd9"]]},{"id":"53a6da1a.8a40d4","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"true","x":1665.9763088226318,"y":394.8134527206421,"wires":[]},{"id":"68890155.b948b","type":"trigger","z":"6593b3ce.8e2a6c","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"2","name":"","x":996.03564453125,"y":359.5753631591797,"wires":[["c388e7f7.bbf3a8","2759af3.376d05"]]},{"id":"82befe5f.5c32b","type":"comment","z":"6593b3ce.8e2a6c","name":"дані про вагу ","info":"","x":164.16667938232422,"y":338.3333625793457,"wires":[]},{"id":"303c37e2.157f88","type":"comment","z":"6593b3ce.8e2a6c","name":"дані про вагу ","info":"","x":150,"y":953.3333129882812,"wires":[]},{"id":"86f1875f.69bbc8","type":"link in","z":"6593b3ce.8e2a6c","name":"дані 80т","links":["1dc49f7b.0f4341"],"x":145.83333333333331,"y":394.99999999999994,"wires":[["1cb225af.e2138a","1fa66cfb.e42a53"]]},{"id":"9639d3e7.73277","type":"link in","z":"6593b3ce.8e2a6c","name":"дані 60т","links":["54b0208.c8ba4e"],"x":114.99999237060547,"y":1021.6666259765625,"wires":[["ec39980e.acec68","8e497619.a0fe48"]]},{"id":"a25a236a.335b4","type":"inject","z":"3d3d5d98.3bdb72","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":116.66666412353516,"y":1215,"wires":[["3ffc9658.b46b8a"]]},{"id":"3ffc9658.b46b8a","type":"function","z":"3d3d5d98.3bdb72","name":"st w e","func":"var weight = flow.get('currentWeight');\nvar stable = flow.get('stability');  \n\nmsg.weight = weight;\nmsg.stable = stable;    \n    \n    \nreturn msg;\n","outputs":1,"noerr":0,"x":266.3610954284668,"y":1213.9167156219482,"wires":[["1dc49f7b.0f4341"]]},{"id":"1dc49f7b.0f4341","type":"link out","z":"3d3d5d98.3bdb72","name":"","links":["86f1875f.69bbc8"],"x":355.83331871032715,"y":1213.3333415985107,"wires":[]},{"id":"9b64044f.16c1f8","type":"comment","z":"3d3d5d98.3bdb72","name":"Відправка даних на ФЛОв","info":"","x":148.3333282470703,"y":1171.6666259765625,"wires":[]},{"id":"b426fb6.b203808","type":"inject","z":"89e4584a.994288","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":114.99999237060547,"y":976.6666259765625,"wires":[["dee6c4e.641ef38"]]},{"id":"dee6c4e.641ef38","type":"function","z":"89e4584a.994288","name":"st w e","func":"var weight = flow.get('currentWeight');\nvar stable = flow.get('stability');  \n\nmsg.weight = weight;\nmsg.stable = stable;    \n    \n    \nreturn msg;\n","outputs":1,"noerr":0,"x":264.6944236755371,"y":975.5833415985107,"wires":[["54b0208.c8ba4e"]]},{"id":"54b0208.c8ba4e","type":"link out","z":"89e4584a.994288","name":"","links":["9639d3e7.73277"],"x":354.16664695739746,"y":974.9999675750732,"wires":[]},{"id":"3a60817.031e07e","type":"comment","z":"89e4584a.994288","name":"Відправка даних на ФЛОв","info":"","x":146.66665649414062,"y":933.333251953125,"wires":[]},{"id":"1cb225af.e2138a","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"true","x":239.9999885559082,"y":393.3333282470703,"wires":[]},{"id":"ec39980e.acec68","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"true","x":223.33331680297852,"y":1025.0000019073486,"wires":[]},{"id":"1fa66cfb.e42a53","type":"function","z":"6593b3ce.8e2a6c","name":"init_date","func":"flow.set('currentWeight_80',msg.weight);\nflow.set('stability_80',msg.stable); \nmsg.payload = {\n    we:msg.weight,\n    st:msg.stable\n}\nreturn msg;","outputs":1,"noerr":0,"x":247.4999885559082,"y":431.6666431427002,"wires":[["e88b3674.afbb78"]]},{"id":"8e497619.a0fe48","type":"function","z":"6593b3ce.8e2a6c","name":"init_date","func":"flow.set('currentWeight_60',msg.weight);\nflow.set('stability_60',msg.stable); \nmsg.payload = {\n    we:msg.weight,\n    st:msg.stable\n}\nreturn msg;","outputs":1,"noerr":0,"x":229.99999237060547,"y":1061.6666278839111,"wires":[["41989c2c.fbbe54"]]},{"id":"58312cc1.6e6774","type":"function","z":"6593b3ce.8e2a6c","name":"ThingsBoard integrations","func":"var resultTH = {\n   \"deviceName\": \"vesa\",\n   \"deviceType\": \"avto\",\n   \"attributes\": {\n       \"model\": \"Koda d400\",\n       \"serialNumber\": \"SN012345\",\n       \"integrationName\": \"Smart scale integration\"\n   }\n};\nflow.set('resultTH',resultTH);   \nreturn msg;","outputs":1,"noerr":0,"x":679.9999465942383,"y":23.333330154418945,"wires":[[]]},{"id":"11b54b0.67b02b5","type":"inject","z":"6593b3ce.8e2a6c","name":"init","topic":"","payload":"init","payloadType":"str","repeat":"","crontab":"","once":true,"x":492.1427688598633,"y":23.095237731933594,"wires":[["58312cc1.6e6774"]]},{"id":"34f45ce5.e9ab54","type":"inject","z":"6593b3ce.8e2a6c","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":564.1666488647461,"y":190.00000762939453,"wires":[["b483f1e3.e32e6","6af59bd.efbb664","b36d048d.23f0f8"]]},{"id":"9dfdb07.ede975","type":"switch","z":"6593b3ce.8e2a6c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"2","vt":"num"}],"checkall":"true","outputs":1,"x":898.0951881408691,"y":825.9523601531982,"wires":[["3cf9d98.8262926"]]},{"id":"c1d33bba.129dc8","type":"function","z":"6593b3ce.8e2a6c","name":"st w e reset","func":"var weight = flow.get('currentWeight_60');\nvar stable = flow.get('stability_60');  \n    \n    \n    if((stable === false )){\n    msg.payload = 2;\n    }\n    \n    \n    \n    \nreturn msg;\n","outputs":1,"noerr":0,"x":759.6030426025391,"y":826.2699689865112,"wires":[["9dfdb07.ede975"]]},{"id":"3cf9d98.8262926","type":"trigger","z":"6593b3ce.8e2a6c","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"2","name":"","x":1048.4124488830566,"y":777.9682559967041,"wires":[["235b20fe.4dabf","e29f9d82.74588"]]},{"id":"5d0c5d3e.c427d4","type":"inject","z":"6593b3ce.8e2a6c","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":579.0237464904785,"y":781.5873532295227,"wires":[["52d9b012.d617a","c1d33bba.129dc8","ea6c91a6.6c4ab"]]},{"id":"efd0bd.578eef4","type":"switch","z":"6593b3ce.8e2a6c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"5","vt":"str"}],"checkall":"true","outputs":1,"x":873.5713806152344,"y":777.1748962402344,"wires":[["3cf9d98.8262926"]]},{"id":"235b20fe.4dabf","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"false","x":1353.8887062072754,"y":904.0000371932983,"wires":[]},{"id":"e29f9d82.74588","type":"switch","z":"6593b3ce.8e2a6c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"2","vt":"num"}],"checkall":"true","outputs":1,"x":1347.222080230713,"y":854.5555324554443,"wires":[["c0a65a56.9b2868"]]},{"id":"b95278f1.73f828","type":"inject","z":"6593b3ce.8e2a6c","name":"","topic":"","payload":"2","payloadType":"num","repeat":"","crontab":"","once":true,"x":898.4126319885254,"y":860.7460689544678,"wires":[["3cf9d98.8262926"]]},{"id":"52d9b012.d617a","type":"function","z":"6593b3ce.8e2a6c","name":"st w e","func":"var weight = flow.get('currentWeight_60');\nvar stable = flow.get('stability_60');  \n    \n    \n    if((weight > 200) && (stable === true) ){\n    msg.payload = 'Вес стабильный.' + \" Вес:\" + weight ; \n    \n    }else{\n     msg.payload = '5'\n    \n    }\n    \n    \n    \n    \nreturn msg;\n","outputs":1,"noerr":0,"x":739.1427040100098,"y":781.1111831665039,"wires":[["554a52f.50b81ac","efd0bd.578eef4"]]},{"id":"c0a65a56.9b2868","type":"function","z":"6593b3ce.8e2a6c","name":"стабильность веса","func":"var payload = flow.get('resultTH');\npayload.telemetry = {\n    \"event\" : msg.payload\n    \n    }; \nmsg.payload = payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":1511.6667442321777,"y":853.4444532394409,"wires":[["d52c4821.e87ef8","1250c198.b99b5e"]]},{"id":"554a52f.50b81ac","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"false","x":879.8412132263184,"y":737.8096179962158,"wires":[]},{"id":"d52c4821.e87ef8","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"false","x":1711.6667594909668,"y":856.2222661972046,"wires":[]},{"id":"e88b3674.afbb78","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"payload","x":411.78570556640625,"y":431.0714168548584,"wires":[]},{"id":"ea6c91a6.6c4ab","type":"function","z":"6593b3ce.8e2a6c","name":"st w e","func":"var weight = flow.get('currentWeight_60');\nvar stable = flow.get('stability_60');  \nvar tag = flow.get(\"tag_epc_60\");    \n    \n    if((weight > 200) && (stable === true) ){\n    msg.payload = 'Без операторное взвешивания.' + \" Вес:\" + weight + \". Мітка:\" + tag; \n    \n    }else{\n     msg.payload = '5'\n    \n    }\n    \n    \n    \n    \nreturn msg;\n","outputs":1,"noerr":0,"x":674.2856941223145,"y":989.4642238616943,"wires":[["63a5fe18.b8017"]]},{"id":"63a5fe18.b8017","type":"switch","z":"6593b3ce.8e2a6c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"5","vt":"str"}],"checkall":"true","outputs":1,"x":800.3572616577148,"y":992.7381229400635,"wires":[["6f0a72c9.9a0d5c"]]},{"id":"8a0eb0d0.ccd92","type":"function","z":"6593b3ce.8e2a6c","name":"стабильность веса + мітка","func":"var payload = flow.get('resultTH');\npayload.telemetry = {\n    \"event\" : flow.get(\"str_st_60\") + \". \" + flow.get(\"perimetrStatus_60\")\n    \n    }; \nmsg.payload = payload;\nmsg.tagId = flow.get('tag_epc_60');\nreturn msg;","outputs":1,"noerr":0,"x":1440.2976684570312,"y":1022.083417892456,"wires":[["dd7ab3be.63da5","1250c198.b99b5e"]]},{"id":"6f0a72c9.9a0d5c","type":"trigger","z":"6593b3ce.8e2a6c","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"2","name":"","x":1019.1666526794434,"y":985.2381248474121,"wires":[["dda123e3.8090a","bfe1ad97.338ad"]]},{"id":"dd7ab3be.63da5","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"true","x":1674.4643287658691,"y":1017.0833826065063,"wires":[]},{"id":"41989c2c.fbbe54","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"false","x":388.5714302062988,"y":1065.7142505645752,"wires":[]},{"id":"8f29ec3b.7bbd9","type":"link out","z":"6593b3ce.8e2a6c","name":"Send D on TB 1C 80t","links":["f55a217e.a133f"],"x":1688.33323097229,"y":274.99999046325684,"wires":[]},{"id":"1250c198.b99b5e","type":"link out","z":"6593b3ce.8e2a6c","name":"Send D on TB 1C 60t","links":["21fda60f.1c889a","248d489.c953cb8"],"x":1628.3332328796387,"y":939.9999561309814,"wires":[]},{"id":"eff21199.19e1","type":"function","z":"df260e7f.13538","name":"setup params","func":"msg.queryParameters = msg.queryParameters || {};\nmsg.queryParameters.param1 = msg.payload.event_name;\nmsg.queryParameters.param2 = msg.payload.event_desc;\nmsg.queryParameters.param3 = msg.payload.ip;\nmsg.queryParameters.param4 = flow.get(\"isoDate\");\nmsg.queryParameters.param5 = msg.payload.weight_for_1c;\nmsg.queryParameters.param6 = msg.payload.truck1;\nmsg.queryParameters.param7 = msg.payload.truck2;\nmsg.queryParameters.param8 = msg.payload.tag;\nmsg.queryParameters.param9 = msg.payload.perimetrStatus;\nreturn msg;","outputs":1,"noerr":0,"x":595,"y":691.2499990463257,"wires":[["3c469265.69464e"]]},{"id":"3c469265.69464e","type":"template","z":"df260e7f.13538","name":"query field1","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO event_table(\n             Event_name,Event_description,IP,lastSeenTimestampUTC,EventValue1,EventValue2,EventValue3,Tag,perimetrStatus)\n    VALUES ($param1,$param2,$param3,$param4,$param5,$param6,$param7,$param8,$param9);","x":761.9444695881434,"y":690.1388416290283,"wires":[["cb6bf216.742be"]]},{"id":"44bc92e6.664ccc","type":"function","z":"df260e7f.13538","name":"заголовок","func":"msg.payload.ip = '10.3.5.202';\nmsg.payload.event_name = \"Подія на 60т\";\nmsg.payload.event_desc = msg.payload.event;\nmsg.payload.truck1 = flow.get('truck1_60');\nmsg.payload.truck2 = flow.get('truck2_60');\nmsg.payload.weight_for_1c = flow.get('weight_for_1c_60');\nmsg.payload.tag = msg.tagId;\nmsg.payload.perimetrStatus = msg.perimetrStatus;\nreturn msg;","outputs":1,"noerr":0,"x":418.75000762939453,"y":687.5000133514404,"wires":[["eff21199.19e1"]]},{"id":"cb6bf216.742be","type":"postgres","z":"df260e7f.13538","postgresdb":"1af05285.16139d","name":"rfid_log","output":true,"outputs":1,"x":912.5000133514404,"y":687.5000095367432,"wires":[[]]},{"id":"36837aa5.2ad766","type":"debug","z":"3d3d5d98.3bdb72","name":"","active":true,"console":"false","complete":"false","x":957.8571281433105,"y":769.9999694824219,"wires":[]},{"id":"16d035b9.1a0e2a","type":"function","z":"3d3d5d98.3bdb72","name":"","func":"msg.payload = msg.perimetrStatus;\nreturn msg;","outputs":1,"noerr":0,"x":820.7142857142857,"y":769.9999999999999,"wires":[["36837aa5.2ad766"]]},{"id":"c388e7f7.bbf3a8","type":"function","z":"6593b3ce.8e2a6c","name":"set request","func":"// var response = JSON.parse(msg.payload);\n// msg.headers = {\n//     \"Content-Type\":\"application/json\",\n//     \"token\":response.token\n// }\nmsg.rfidID = '10.3.5.212';\nmsg.url = 'http://10.3.5.223:1880/api/platform/getReaderConfig?rfidID='+msg.rfidID;\n\nreturn msg;","outputs":1,"noerr":0,"x":669.1071472167969,"y":425.17856788635254,"wires":[["dbb063ef.a68b"]]},{"id":"dbb063ef.a68b","type":"http request","z":"6593b3ce.8e2a6c","name":"","method":"GET","ret":"txt","url":"","tls":"","x":854.7142791748047,"y":425.2500057220459,"wires":[["8aa06b25.a725b8"]]},{"id":"8aa06b25.a725b8","type":"function","z":"6593b3ce.8e2a6c","name":"","func":"//\"[{\"GPI_ID\":1,\"GPI_Status\":1},{\"GPI_ID\":2,\"GPI_Status\":1},{\"GPI_ID\":3,\"GPI_Status\":0},{\"GPI_ID\":4,\"GPI_Status\":0}]\"\n\nvar perimetrStatus = ((msg.payload[0].GPI_Status == 1)&&(msg.payload[1].GPI_Status == 1));\nmsg.perimetrStatus = perimetrStatus;\nreturn msg;","outputs":1,"noerr":0,"x":997.3319091796875,"y":428.20383644104004,"wires":[["f5ee98ac.59ef48"]]},{"id":"5c866444.5a9ecc","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"true","x":1371.4285316467285,"y":471.07143783569336,"wires":[]},{"id":"f5ee98ac.59ef48","type":"function","z":"6593b3ce.8e2a6c","name":"perimetrStatus","func":"msg.payload = msg.perimetrStatus;\n//flow.set(\"perimetrStatus\",msg.payload);\nvar perimetrStatus = msg.perimetrStatus;\n\nif(perimetrStatus === true){\n   flow.set(\"perimetrStatus_80\",'Периметр не пересечен'); \n}else{\n   flow.set(\"perimetrStatus_80\",'Периметр пересечен');  \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1150.0000324249268,"y":431.24999237060547,"wires":[["5c866444.5a9ecc","91bf528e.e288"]]},{"id":"e82970ac.4ed0f","type":"inject","z":"6593b3ce.8e2a6c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":363.125,"y":556.25,"wires":[[]]},{"id":"2759af3.376d05","type":"function","z":"6593b3ce.8e2a6c","name":"","func":"flow.set(\"str_st_80\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":1170.625,"y":340,"wires":[[]]},{"id":"dda123e3.8090a","type":"function","z":"6593b3ce.8e2a6c","name":"str_st_60","func":"flow.set(\"str_st_60\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":1234.8214263916016,"y":987.8571529388428,"wires":[[]]},{"id":"b501096a.4e33d8","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"true","x":1425.6250114440918,"y":1098.750020980835,"wires":[]},{"id":"5db2d2.fa205d3","type":"function","z":"6593b3ce.8e2a6c","name":"perimetrStatus","func":"msg.payload = msg.perimetrStatus;\n//flow.set(\"perimetrStatus\",msg.payload);\nvar perimetrStatus = msg.perimetrStatus;\n\nif(perimetrStatus === true){\n   flow.set(\"perimetrStatus_60\",'Периметр не пересечен'); \n}else{\n   flow.set(\"perimetrStatus_60\",'Периметр пересечен');  \n}\nreturn msg;","outputs":1,"noerr":0,"x":1181.3393325805664,"y":1058.928518295288,"wires":[["b501096a.4e33d8","8a0eb0d0.ccd92"]]},{"id":"1d183751.6c9449","type":"function","z":"6593b3ce.8e2a6c","name":"","func":"//\"[{\"GPI_ID\":1,\"GPI_Status\":1},{\"GPI_ID\":2,\"GPI_Status\":1},{\"GPI_ID\":3,\"GPI_Status\":0},{\"GPI_ID\":4,\"GPI_Status\":0}]\"\n\nvar perimetrStatus = ((msg.payload[0].GPI_Status == 1)&&(msg.payload[1].GPI_Status == 1));\nmsg.perimetrStatus = perimetrStatus;\nreturn msg;","outputs":1,"noerr":0,"x":1044.3855476379395,"y":1060.1681938171387,"wires":[["5db2d2.fa205d3"]]},{"id":"bb315e01.0769e","type":"http request","z":"6593b3ce.8e2a6c","name":"","method":"GET","ret":"txt","url":"","tls":"","x":910.3392715454102,"y":1061.499963760376,"wires":[["1d183751.6c9449"]]},{"id":"bfe1ad97.338ad","type":"function","z":"6593b3ce.8e2a6c","name":"set request","func":"// var response = JSON.parse(msg.payload);\n// msg.headers = {\n//     \"Content-Type\":\"application/json\",\n//     \"token\":response.token\n// }\nmsg.rfidID = '10.3.5.212';\nmsg.url = 'http://10.3.5.223:1880/api/platform/getReaderConfig?rfidID='+msg.rfidID;\n\nreturn msg;","outputs":1,"noerr":0,"x":746.1606826782227,"y":1062.857141494751,"wires":[["bb315e01.0769e"]]},{"id":"58011ad0.e18674","type":"debug","z":"df260e7f.13538","name":"","active":false,"console":"false","complete":"true","x":984.2857055664062,"y":391.4285888671875,"wires":[]},{"id":"b1d4d0ca.4ee13","type":"link out","z":"3d3d5d98.3bdb72","name":"сєзд з весов 80","links":["496d9f66.33004"],"x":1125.6250171661377,"y":276.2500047683716,"wires":[]},{"id":"496d9f66.33004","type":"link in","z":"6593b3ce.8e2a6c","name":"","links":["b1d4d0ca.4ee13"],"x":508.4821300506592,"y":313.5714406967163,"wires":[["65f167e9.9c9ce8"]]},{"id":"52cfc535.5552dc","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"true","x":953.5714569091797,"y":319.464298248291,"wires":[]},{"id":"c77e7c76.aaeb9","type":"link out","z":"89e4584a.994288","name":"сєзд з весов 60","links":["2b3ec778.c73dc8"],"x":1286.875,"y":368.75,"wires":[]},{"id":"2b3ec778.c73dc8","type":"link in","z":"6593b3ce.8e2a6c","name":"","links":["c77e7c76.aaeb9"],"x":537.4702606201172,"y":942.7381496429443,"wires":[["7907ca59.094454"]]},{"id":"65f167e9.9c9ce8","type":"function","z":"6593b3ce.8e2a6c","name":"reset triger","func":"if(msg.payload == \"Съезд с весов\"){\n   msg.payload = 2; \n}\nreturn msg;","outputs":1,"noerr":0,"x":635.0000228881836,"y":312.8570852279663,"wires":[["17adab21.fc6a45"]]},{"id":"17adab21.fc6a45","type":"switch","z":"6593b3ce.8e2a6c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"2","vt":"num"}],"checkall":"true","outputs":1,"x":782.8571739196777,"y":311.42857360839844,"wires":[["68890155.b948b","52cfc535.5552dc"]]},{"id":"7907ca59.094454","type":"function","z":"6593b3ce.8e2a6c","name":"reset triger","func":"if(msg.payload == \"Съезд с весов\"){\n   msg.payload = 2; \n}\nreturn msg;","outputs":1,"noerr":0,"x":698.5714263916016,"y":942.8570919036865,"wires":[["44d45aa6.380504"]]},{"id":"44d45aa6.380504","type":"switch","z":"6593b3ce.8e2a6c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"2","vt":"num"}],"checkall":"true","outputs":1,"x":839.285816192627,"y":942.8571434020996,"wires":[["66bd0eb7.76445","6f0a72c9.9a0d5c"]]},{"id":"66bd0eb7.76445","type":"debug","z":"6593b3ce.8e2a6c","name":"","active":false,"console":"false","complete":"true","x":977.1429634094238,"y":908.0357675552368,"wires":[]},{"id":"af0b5dc3.4c69d","type":"comment","z":"6593b3ce.8e2a6c","name":"60t","info":"","x":685.7142562866211,"y":670.0000414848328,"wires":[]},{"id":"35c6b548.75860a","type":"comment","z":"6593b3ce.8e2a6c","name":"60t","info":"","x":955.7142944335938,"y":668.5714702606201,"wires":[]},{"id":"fbb73cac.20dee","type":"comment","z":"6593b3ce.8e2a6c","name":"60t","info":"","x":1217.1429061889648,"y":665.7142658233643,"wires":[]},{"id":"68a2497d.6c45c8","type":"debug","z":"89e4584a.994288","name":"","active":false,"console":"false","complete":"true","x":728.5714111328125,"y":645.7142944335938,"wires":[]},{"id":"668ed0f.eccf23","type":"debug","z":"89e4584a.994288","name":"","active":false,"console":"false","complete":"true","x":731.428581237793,"y":749.9999980926514,"wires":[]},{"id":"af5956ce.8ba4c8","type":"http in","z":"89e4584a.994288","name":"","url":"/api/Photo_a/setData","method":"post","swaggerDoc":"","x":155,"y":1072.8572463989258,"wires":[["90840f5c.c692b","aae6c8a0.601998"]]},{"id":"90840f5c.c692b","type":"debug","z":"89e4584a.994288","name":"","active":true,"console":"false","complete":"true","x":424.2857360839844,"y":1074.285800933838,"wires":[]},{"id":"aae6c8a0.601998","type":"http response","z":"89e4584a.994288","name":"","x":425.0000305175781,"y":1042.8572216033936,"wires":[]},{"id":"d12959b3.12e098","type":"http request","z":"417832f2.ceac3c","name":"analis","method":"POST","ret":"txt","url":"http://10.1.132.168:1880/api/Photo_a/setData","tls":"","x":940.0000305175781,"y":312.22216987609863,"wires":[["5ec93b21.716f64"]]},{"id":"5ec93b21.716f64","type":"debug","z":"417832f2.ceac3c","name":"","active":true,"console":"false","complete":"false","x":1181.3889770507812,"y":381.11112880706787,"wires":[]},{"id":"d184071.a99b5f8","type":"function","z":"417832f2.ceac3c","name":"result_analiz","func":"/*\n1 - повний\n2 - неопридільон\n0 - пустий\n*/\nflow.set('result_analis', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":1087.4305038452148,"y":281.5277919769287,"wires":[["50f310f0.b38af"]]},{"id":"8c3321be.9e81","type":"inject","z":"417832f2.ceac3c","name":"","topic":"","payload":"result_analis","payloadType":"flow","repeat":"","crontab":"","once":false,"x":793.3333511352539,"y":394.30554962158203,"wires":[["5ec93b21.716f64"]]},{"id":"eeb51ed6.c2c97","type":"inject","z":"89e4584a.994288","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":188.125,"y":516.25,"wires":[["6c872d9e.b50984"]]},{"id":"6c872d9e.b50984","type":"function","z":"89e4584a.994288","name":"to mongo","func":"msg.url_above = \"http://10.45.1.10/Streaming/channels/1/picture\";\nmsg.url_front = \"http://10.45.1.12/Streaming/channels/1/picture\";\nmsg.url_back  = \"http://10.45.1.13/Streaming/channels/1/picture\";\nreturn msg;","outputs":1,"noerr":0,"x":332.0833320617676,"y":473.88888359069824,"wires":[["ec69a399.9b01e"]]},{"id":"921cdde8.6c44","type":"debug","z":"3d3d5d98.3bdb72","name":"","active":false,"console":"false","complete":"true","x":630.0000076293945,"y":760.0000114440918,"wires":[]},{"id":"2badc273.d4b7be","type":"debug","z":"3d3d5d98.3bdb72","name":"","active":false,"console":"false","complete":"true","x":625.3571853637695,"y":856.7857189178467,"wires":[]},{"id":"5c47420e.69a78c","type":"function","z":"89e4584a.994288","name":"audit or full","func":"var FullEmpty = msg.payload.FullEmpty;\nmsg.payload = FullEmpty;\nreturn msg;","outputs":1,"noerr":0,"x":591.8750076293945,"y":851.2500133514404,"wires":[["eaa0b3ab.c7aed"]]},{"id":"7212e3be.d48efc","type":"function","z":"3d3d5d98.3bdb72","name":"audit or full 80t","func":"var FullEmpty = msg.payload.FullEmpty;\nmsg.payload = FullEmpty;\nreturn msg;","outputs":1,"noerr":0,"x":530.0000076293945,"y":890.0000133514404,"wires":[["4bb9c77c.1acd78"]]},{"id":"4bb9c77c.1acd78","type":"link out","z":"3d3d5d98.3bdb72","name":"audit or full 80t","links":["4cd6dc6f.096d14"],"x":683.1250114440918,"y":891.2500133514404,"wires":[]},{"id":"eaa0b3ab.c7aed","type":"link out","z":"89e4584a.994288","name":"audit or full 60t","links":["4cd6dc6f.096d14"],"x":738.7500114440918,"y":848.7500133514404,"wires":[]},{"id":"4cd6dc6f.096d14","type":"link in","z":"417832f2.ceac3c","name":"","links":["4bb9c77c.1acd78","eaa0b3ab.c7aed"],"x":75.62500190734863,"y":432.5000066757202,"wires":[["52f7bbe9.87ed04"]]},{"id":"52f7bbe9.87ed04","type":"function","z":"417832f2.ceac3c","name":"","func":"var result_with_1c = msg.payload;\nflow.set('result_with_1c',result_with_1c);\n    \n\nreturn msg;","outputs":1,"noerr":0,"x":206.87500381469727,"y":435.0000057220459,"wires":[["747acb4f.7eafe4"]]},{"id":"747acb4f.7eafe4","type":"debug","z":"417832f2.ceac3c","name":"","active":true,"console":"false","complete":"false","x":363.75,"y":441.25,"wires":[]},{"id":"50f310f0.b38af","type":"function","z":"417832f2.ceac3c","name":"","func":"var result_with_1c = flow.get('result_with_1c');\nvar result_analis = flow.get('result_analis');\n    result_analis = result_analis.substring(0,1);\n//msg.payload = result_analis;\n    if(result_with_1c == result_analis){\n        msg.analis = \"Заповнений\"\n    }else if(result_analis == '2'){\n        msg.analis = \"Неопределенный\"\n    }else{\n        msg.analis = \"Пустой\" \n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":930.9722290039062,"y":504.3055610656738,"wires":[["462780a6.23d44","b618b396.e2e96"]]},{"id":"462780a6.23d44","type":"debug","z":"417832f2.ceac3c","name":"","active":false,"console":"true","complete":"true","x":1090.8333625793457,"y":511.944429397583,"wires":[]},{"id":"bb0e3561.36ebf8","type":"inject","z":"417832f2.ceac3c","name":"","topic":"","payload":"result_with_1c","payloadType":"flow","repeat":"","crontab":"","once":false,"x":791.5277709960938,"y":427.6388864517212,"wires":[["5ec93b21.716f64"]]},{"id":"30cc2381.47a2ac","type":"function","z":"df260e7f.13538","name":"заголовок","func":"//msg.event_name = \"Подія аналіз фото\";\nmsg.payload.analis = msg.analis;\nvar url_above = msg.url_above;\n\nif(url_above == \"http://10.45.1.11/Streaming/channels/1/picture\"){\n  msg.event_name = \"Подія на 80т\";  \n}else if(url_above == \"http://10.45.1.10/Streaming/channels/1/picture\"){\n  msg.event_name = \"Подія на 60т\";  \n}\nmsg.event_desc = \"Аналіз фото на вагах\";\n//msg.url_above_80 = \"http://10.45.1.11/Streaming/channels/1/picture\";\n//msg.url_above_60 = \"http://10.45.1.10/Streaming/channels/1/picture\";\nreturn msg;","outputs":1,"noerr":0,"x":307.50000381469727,"y":482.5000066757202,"wires":[["55b66109.3696f","b4935a23.f8a9f8"]]},{"id":"55b66109.3696f","type":"function","z":"df260e7f.13538","name":"setup params","func":"msg.queryParameters = msg.queryParameters || {};\nmsg.queryParameters.param1 = msg.event_name;\nmsg.queryParameters.param2 = msg.analis;\nmsg.queryParameters.param3 = flow.get(\"isoDate\");\nmsg.queryParameters.param4 = msg.event_desc;\nreturn msg;","outputs":1,"noerr":0,"x":486.25000762939453,"y":480.10712242126465,"wires":[["9205a5ef.6da5e8"]]},{"id":"9205a5ef.6da5e8","type":"template","z":"df260e7f.13538","name":"query field1","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO event_table(\n             Event_name,resultanalysis,lastSeenTimestampUTC,Event_description)\n    VALUES ($param1,$param2,$param3,$param4);","x":682.5000114440918,"y":487.60712337493896,"wires":[["f6e54e3e.b5b03","9d2b3ba0.6417e8"]]},{"id":"b618b396.e2e96","type":"link out","z":"417832f2.ceac3c","name":"send analis  Postgree","links":["a839ec3f.c2f55"],"x":1077.4305839538574,"y":483.6111078262329,"wires":[]},{"id":"a839ec3f.c2f55","type":"link in","z":"df260e7f.13538","name":"","links":["b618b396.e2e96"],"x":128.12500286102295,"y":482.5000066757202,"wires":[["30cc2381.47a2ac"]]},{"id":"f6e54e3e.b5b03","type":"debug","z":"df260e7f.13538","name":"","active":false,"console":"false","complete":"true","x":855.0000114440918,"y":487.50000762939453,"wires":[]},{"id":"a78f6641.4e38e8","type":"inject","z":"417832f2.ceac3c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":763.9583473205566,"y":515.9722137451172,"wires":[["50f310f0.b38af"]]},{"id":"337ec28b.d0d32e","type":"comment","z":"df260e7f.13538","name":"Відправка аналізу фото","info":"","x":492.5,"y":437.5,"wires":[]},{"id":"9d2b3ba0.6417e8","type":"postgres","z":"df260e7f.13538","postgresdb":"1af05285.16139d","name":"rfid_log","output":true,"outputs":1,"x":857.5,"y":436.25,"wires":[[]]},{"id":"b4935a23.f8a9f8","type":"debug","z":"df260e7f.13538","name":"","active":false,"console":"false","complete":"true","x":430,"y":556.25,"wires":[]},{"id":"a392dd27.cef2e","type":"debug","z":"417832f2.ceac3c","name":"","active":true,"console":"false","complete":"true","x":361.1110954284668,"y":67.77777099609375,"wires":[]},{"id":"46fac206.f3b8dc","type":"inject","z":"417832f2.ceac3c","name":"","topic":"","payload":"rowKey_for_analis","payloadType":"flow","repeat":"","crontab":"","once":false,"x":798.8887672424316,"y":466.6666603088379,"wires":[["5ec93b21.716f64"]]},{"id":"e0d651.ccaf49b","type":"inject","z":"417832f2.ceac3c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":623.8888778686523,"y":319.9999885559082,"wires":[["b965ce75.3fb8a"]]},{"id":"55715140.1d8dc","type":"debug","z":"417832f2.ceac3c","name":"","active":true,"console":"false","complete":"true","x":1112.2220516204834,"y":244.4444456100464,"wires":[]},{"id":"b965ce75.3fb8a","type":"function","z":"417832f2.ceac3c","name":"","func":"msg.url = 'http://10.1.132.168:1880/api/Photo_a/setData';\nmsg.payload = {\n    \n    rowKey: \"keyMon Feb 11 2019 11:06:14 GMT+0000 (UTC)94b6704c-2ddf-11e9-f986-0242ac130003\",\n    type: 'above'\n}\n\nreturn msg;\n    \n","outputs":1,"noerr":0,"x":776.6666488647461,"y":339.99998664855957,"wires":[["d12959b3.12e098"]]},{"id":"8a834db4.4cdea","type":"function","z":"417832f2.ceac3c","name":"","func":"if(msg.type == 'above'){\n   \nreturn msg;\n  \n}","outputs":1,"noerr":0,"x":766.6666412353516,"y":291.1111364364624,"wires":[["d12959b3.12e098","55715140.1d8dc"]]},{"id":"914be0c8.ac25c","type":"function","z":"417832f2.ceac3c","name":"","func":"msg.payload = flow.get('rowKey_for_analis');\nreturn msg;","outputs":1,"noerr":0,"x":796.1110954284668,"y":258.8888940811157,"wires":[["8a834db4.4cdea"]]}]
