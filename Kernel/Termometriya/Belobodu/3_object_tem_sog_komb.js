[{"id":"24a0a480.4f402c","type":"tab","label":"TERMO","disabled":false,"info":""},{"id":"b9afc94d.c6e8e8","type":"tab","label":"PODVESU","disabled":false,"info":""},{"id":"e31e7792.ce32c8","type":"tab","label":"Conver mdb to CSV","disabled":false,"info":""},{"id":"a440efc6.988bc","type":"tab","label":"Termiks","disabled":false,"info":""},{"id":"9bb1f8c1.ef6888","type":"tab","label":"Kombikorm","disabled":false,"info":""},{"id":"569f7697.a14888","type":"tab","label":"Otladka","disabled":false,"info":""},{"id":"aff7e881.69e678","type":"MySQLdatabase","z":"","name":"","host":"10.3.40.185","port":"3306","db":"OIK_THERMO","tz":""},{"id":"7ae13833.cbf9e8","type":"inject","z":"24a0a480.4f402c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"0.2","x":110,"y":260,"wires":[["3af59869.563e48"]]},{"id":"3af59869.563e48","type":"file in","z":"24a0a480.4f402c","name":"Zamery.csv","filename":"/home/sa.palanyuk/file_for_download/Zamery.csv","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":330,"y":260,"wires":[["3cbe10fa.18633"]]},{"id":"3cbe10fa.18633","type":"csv","z":"24a0a480.4f402c","name":"","sep":",","hdrin":"","hdrout":true,"multi":"mult","ret":"\\n","temp":"PODVESKA,ZAM_DATE,TEMPE1,TEMPE2,TEMPE3,TEMPE4,TEMPE5,TEMPE6,TEMPEM,KOD_PROD,VES_PROD,VYS_PROD","skip":"1","strings":true,"x":490,"y":260,"wires":[["19a96e40.ac2192"]]},{"id":"19a96e40.ac2192","type":"function","z":"24a0a480.4f402c","name":"","func":"flow.set(\"out_date_csv\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":220,"wires":[["5dac0cbf.c35fb4","b5e5f5e8.029258","20629295.95b5ce"]]},{"id":"5dac0cbf.c35fb4","type":"debug","z":"24a0a480.4f402c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":220,"wires":[]},{"id":"b5e5f5e8.029258","type":"function","z":"24a0a480.4f402c","name":"correct","func":"var in_array =  msg.payload;\nvar ID = \"\";\n\n    for (var i = 0; i < in_array.length; i++) {\n       ID = in_array[i].ZAM_DATE;\n       ID = new Date(ID);\n       in_array[i].ID = Number(ID);\n       var string_Name = in_array[i].PODVESKA\n\n       in_array[i].sensors = [{\n           name: string_Name +\"_TEMPE1\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE1\n       },\n       {\n           name:string_Name +\"_TEMPE2\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE2\n       },{\n           name:string_Name +\"_TEMPE3\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE3\n       },{\n           name: string_Name +\"_TEMPE4\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE4\n       },{\n           name: string_Name +\"_TEMPE5\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE5\n       },{\n           name: string_Name +\"_TEMPE6\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE6\n       },\n       ]\n       \n       delete in_array[i].KOD_PROD\n       delete in_array[i].VES_PROD\n       delete in_array[i].VYS_PROD\n       //delete in_array[i].TEMPE4\n       //delete in_array[i].TEMPE5\n       //delete in_array[i].TEMPE6\n       //delete in_array[i].TEMPEM\n        \n        \n        \n    }\n\nmsg.payload = in_array;    \n\nflow.set(\"in_array\", in_array);\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":180,"wires":[["dfdc5e6f.4bca1"]]},{"id":"dfdc5e6f.4bca1","type":"debug","z":"24a0a480.4f402c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":180,"wires":[]},{"id":"20629295.95b5ce","type":"function","z":"24a0a480.4f402c","name":"All ID","func":"var in_date = msg.payload;\nvar arr_ZAM_DATE = [];\nvar arr_PODVESKA = [];\n\n\n    for (var q = 0; q < in_date.length; q++) {\n        arr_PODVESKA.push(in_date[q].PODVESKA);   \n        arr_ZAM_DATE.push(in_date[q].ZAM_DATE);\n    }\n\n    var a = arr_ZAM_DATE;\n    var seen = {};\n    var out = [];\n    var len = a.length;\n    var j = 0;\n        for(var i = 0; i < len; i++) {\n             var item = a[i];\n             if(seen[item] !== 1) {\n                   seen[item] = 1;\n                   out[j++] = item;\n                   \n                   \n                   \n             }\n        }\n    \nvar correct = out;\n    \ncorrect.sort();   \n        for(var n = 0; n < correct.length; n++) {\n        var ID = new Date(correct[n]);\n        correct[n] = Number(ID);    \n        }\n\n//msg.payload =  correct\nmsg.payload = {\n    ZAM_DATE: arr_ZAM_DATE,\n    correct: correct\n    \n} \n\n\n\n\nflow.set(\"ID\", msg.payload.correct);\nflow.set(\"ID_2\", msg.payload.correct)\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":260,"wires":[["5f827541.1a0a5c"]]},{"id":"5f827541.1a0a5c","type":"debug","z":"24a0a480.4f402c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":260,"wires":[]},{"id":"77f89010.b897b","type":"inject","z":"24a0a480.4f402c","name":"","topic":"","payload":"ID","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":100,"wires":[["1cff7314.24637d"]]},{"id":"af05710f.4ffb8","type":"inject","z":"24a0a480.4f402c","name":"","topic":"","payload":"ID_2","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":140,"wires":[["1cff7314.24637d"]]},{"id":"3a5af9c6.148e16","type":"inject","z":"24a0a480.4f402c","name":"","topic":"","payload":"in_array","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":180,"wires":[["1cff7314.24637d"]]},{"id":"1cff7314.24637d","type":"debug","z":"24a0a480.4f402c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":330,"y":120,"wires":[]},{"id":"527dd2ea.5e18fc","type":"http in","z":"24a0a480.4f402c","name":"","url":"/get/TEMP_2","method":"get","upload":false,"swaggerDoc":"","x":150,"y":360,"wires":[["dbd02d2a.c986d","3a1d7360.18891c"]]},{"id":"dbd02d2a.c986d","type":"function","z":"24a0a480.4f402c","name":"array res","func":"//var startSensor = Number(msg.req.query.offsets);\n//var range = Number(msg.req.query.counts);\nvar id = Number(msg.req.query.id);\n//var id = msg.id;\n\nvar arra_id = flow.get(\"ID_2\");\nvar arra_id_3 = arra_id.slice();\nvar arra_id_2 = arra_id.slice();\nvar copy_arra_id = [];\n//find element array\nvar num_id = arra_id_2.indexOf(id);  \n    arra_id_2.splice(0, num_id );//array date\nvar len_arra_id = arra_id_2.length;\n\nvar array_in = []\narray_in = flow.get(\"in_array\");\n\nvar array_in_2 = array_in.slice();\nvar len_array = array_in_2.length;\n\nvar array_out = [];\nvar count = 0;\n\n    for (var j = 0; j < len_arra_id; j++) {\n        \n\n            for (var i = 0; i < len_array; i++) {\n                if(array_in_2[i].ID == arra_id_2[j]) {\n                   delete array_in_2[i].TEMPE1 \n                   delete array_in_2[i].TEMPE2 \n                   delete array_in_2[i].TEMPE3\n                   delete array_in_2[i].TEMPE4 \n                   delete array_in_2[i].TEMPE5 \n                   delete array_in_2[i].TEMPE6 \n                   delete array_in_2[i].TEMPEM \n                   delete array_in_2[i].ZAM_DATE \n                   delete array_in_2[i].PODVESKA \n                   delete array_in_2[i].ID \n                    array_out[count] = array_in_2[i]; \n                    count++;\n                }\n                \n            }\n        copy_arra_id[j] = array_out;\n        array_out = [];\n        count = 0;\n    }\n\n\n    \n    \n    \n    \n//msg.payload = array_out;\n\nmsg.id = arra_id_3[arra_id_3.length - 1];\nmsg.payload = copy_arra_id;\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":360,"wires":[["daf0d6a6.dfea28","5ba45287.52705c"]]},{"id":"daf0d6a6.dfea28","type":"function","z":"24a0a480.4f402c","name":"res","func":"var ID = msg.id;\nvar in_data = msg.payload;\nvar len_in_data = in_data.length;\nvar array3 = [];\n//var array3 = array1.concat(array2);\n\n     for (var i = 0; i < len_in_data; i++) {\n          var len_array_I = in_data[i].length;\n              for (var j = 0; j < len_array_I; j++) {\n                array3 = array3.concat(in_data[i][j].sensors)    \n              }\n         \n     }\n\nmsg.payload = \n    { \n        id:ID,\n        sensors:array3\n        \n        \n    }\n    ;\n\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":360,"wires":[["a5e6ed49.e645d","66ba622a.00d39c","3af59869.563e48","af0d8b4c.68b218"]]},{"id":"a5e6ed49.e645d","type":"http response","z":"24a0a480.4f402c","name":"","statusCode":"","headers":{},"x":650,"y":360,"wires":[]},{"id":"66ba622a.00d39c","type":"debug","z":"24a0a480.4f402c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":650,"y":320,"wires":[]},{"id":"b88c776.af90a88","type":"inject","z":"24a0a480.4f402c","name":"","topic":"","payload":"out_date_csv","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":60,"wires":[["1cff7314.24637d"]]},{"id":"3a1d7360.18891c","type":"debug","z":"24a0a480.4f402c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":250,"y":440,"wires":[]},{"id":"ff9c4c88.67d83","type":"debug","z":"24a0a480.4f402c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":280,"wires":[]},{"id":"10fbf7ab.e45908","type":"debug","z":"24a0a480.4f402c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":360,"wires":[]},{"id":"12ca689c.b167a7","type":"file in","z":"b9afc94d.c6e8e8","name":"","filename":"/home/sa.palanyuk/file_for_download/Podvesky.csv","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":410,"y":60,"wires":[["fa28f85b.d1f9e8"]]},{"id":"fa28f85b.d1f9e8","type":"csv","z":"b9afc94d.c6e8e8","name":"","sep":",","hdrin":"","hdrout":true,"multi":"mult","ret":"\\n","temp":"METKA,KOEF1,KOEF2,KOEF3,KOEF4,KOEF5,KOEF6,KOEFA,PODVESKA,SILOS,BANKA,KOL_DATH,REMONT,KOD_PROD,VES_PROD,VYS_PROD,VYS_PUST,KORPUS,M_STROKA,M_STOLB","skip":"1","strings":true,"x":370,"y":120,"wires":[["e8849000.e4648"]]},{"id":"e8849000.e4648","type":"function","z":"b9afc94d.c6e8e8","name":"","func":"var in_date = msg.payload;\nvar new_date = [];\n    for (var i = 0; i < in_date.length; i++) {\n        new_date[i] = {\n            silos: in_date[i].SILOS,\n            SerialNumber: in_date[i].PODVESKA,\n            GroupBob: [{\n                name:in_date[i].PODVESKA + \"_TEMPE1\",\n                name_r: \"Датчик01\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE2\",\n                name_r: \"Датчик02\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE3\",\n                name_r: \"Датчик03\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE4\",\n                name_r: \"Датчик04\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE5\",\n                name_r: \"Датчик05\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE6\",\n                name_r: \"Датчик06\"\n            },\n            ]\n        }\n  \n    }\n\nmsg.payload = {\n    GroupSensor: new_date\n}\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":120,"wires":[["56769457.29cd2c","dec6a6e8.f9d528"]]},{"id":"95b21b0e.a74258","type":"http in","z":"b9afc94d.c6e8e8","name":"","url":"/get/Podvesu","method":"get","upload":false,"swaggerDoc":"","x":110,"y":60,"wires":[["12ca689c.b167a7"]]},{"id":"56769457.29cd2c","type":"http response","z":"b9afc94d.c6e8e8","name":"","statusCode":"","headers":{},"x":630,"y":120,"wires":[]},{"id":"d47a8c2f.a84a7","type":"file in","z":"b9afc94d.c6e8e8","name":"","filename":"/home/sa.palanyuk/file_for_download/Podvesky.csv","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":410,"y":220,"wires":[["8bea6108.4b88"]]},{"id":"f7a991b.de0607","type":"function","z":"b9afc94d.c6e8e8","name":"podvesu","func":"var in_date = msg.payload;\nvar arr_PODVESKA = [];\nvar arr_Silos = [];\nvar arr_Banka = [];\n\n    for (var i = 0; i < in_date.length; i++) {\n        arr_PODVESKA.push(in_date[i].PODVESKA);   \n        arr_Silos.push(in_date[i].SILOS);\n        arr_Banka.push(in_date[i].BANKA);\n    }\n\nmsg.payload = {\n    PODVESKA: arr_PODVESKA,\n    SILOS: arr_Silos,\n    BANKA: arr_Banka\n}\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":300,"wires":[["b7e4a4da.11d428"]]},{"id":"b7e4a4da.11d428","type":"function","z":"b9afc94d.c6e8e8","name":"","func":" var a = msg.payload.SILOS;\n    var seen = {};\n    var out = [];\n    var len = a.length;\n    var j = 0;\n        for(var i = 0; i < len; i++) {\n             var item = a[i];\n             if(seen[item] !== 1) {\n                   seen[item] = 1;\n                   out[j++] = item;\n                   \n                   \n                   \n             }\n        }\n    \nvar correct = out;\nmsg.payload = out;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":300,"wires":[["b0f5b401.729d68","1c495772.cc2b79"]]},{"id":"780817f.36412e8","type":"http in","z":"b9afc94d.c6e8e8","name":"","url":"/get/Silos","method":"get","upload":false,"swaggerDoc":"","x":90,"y":220,"wires":[["d47a8c2f.a84a7"]]},{"id":"b0f5b401.729d68","type":"http response","z":"b9afc94d.c6e8e8","name":"","statusCode":"","headers":{},"x":610,"y":340,"wires":[]},{"id":"14488b47.6782c5","type":"inject","z":"b9afc94d.c6e8e8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":180,"wires":[["d47a8c2f.a84a7"]]},{"id":"1c495772.cc2b79","type":"debug","z":"b9afc94d.c6e8e8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":630,"y":300,"wires":[]},{"id":"8bea6108.4b88","type":"csv","z":"b9afc94d.c6e8e8","name":"","sep":",","hdrin":"","hdrout":true,"multi":"mult","ret":"\\n","temp":"METKA,KOEF1,KOEF2,KOEF3,KOEF4,KOEF5,KOEF6,KOEFA,PODVESKA,SILOS,BANKA,KOL_DATH,REMONT,KOD_PROD,VES_PROD,VYS_PROD,VYS_PUST,KORPUS,M_STROKA,M_STOLB","skip":"1","strings":true,"x":690,"y":220,"wires":[["f7a991b.de0607"]]},{"id":"63110566.84815c","type":"exec","z":"e31e7792.ce32c8","command":"bash /home/sa.palanyuk/file_for_download/script.sh","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"CONVERT","x":470,"y":120,"wires":[["4d2b1744.b85b18","c43ecd6a.55762"],[],[]]},{"id":"4d2b1744.b85b18","type":"debug","z":"e31e7792.ce32c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":670,"y":100,"wires":[]},{"id":"5ba45287.52705c","type":"debug","z":"24a0a480.4f402c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":430,"y":440,"wires":[]},{"id":"476cfe6f.21555","type":"inject","z":"24a0a480.4f402c","name":"","topic":"","payload":"1586763441000","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":20,"wires":[["1cff7314.24637d"]]},{"id":"dec6a6e8.f9d528","type":"debug","z":"b9afc94d.c6e8e8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":180,"wires":[]},{"id":"3c60c0ee.8ea82","type":"inject","z":"b9afc94d.c6e8e8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":100,"wires":[["12ca689c.b167a7"]]},{"id":"5ca2b6c8.fd3588","type":"inject","z":"e31e7792.ce32c8","name":"","topic":"","payload":"","payloadType":"date","repeat":"7200","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":180,"wires":[["7f1ecdaf.78bff4","e07f2e56.d0b99"]]},{"id":"7f1ecdaf.78bff4","type":"exec","z":"e31e7792.ce32c8","command":"cp /mnt/winshare/termbase.mdb /home/sa.palanyuk/file_for_download/termbase.mdb","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"copy termbase","x":320,"y":180,"wires":[["e2c09983.1725a8"],[],[]]},{"id":"e2c09983.1725a8","type":"debug","z":"e31e7792.ce32c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":160,"wires":[]},{"id":"2fe36b65.4affc4","type":"comment","z":"e31e7792.ce32c8","name":"info about script","info":"cp /mnt/winshare/termbase.mdb /home/sa.palanyuk/file_for_download/termbase.mdb  \n\n/home/sa.palanyuk/file_for_download/","x":120,"y":120,"wires":[]},{"id":"b8a60d32.f565e","type":"comment","z":"e31e7792.ce32c8","name":"","info":"","x":140,"y":40,"wires":[]},{"id":"e07f2e56.d0b99","type":"delay","z":"e31e7792.ce32c8","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":120,"wires":[["63110566.84815c"]]},{"id":"c43ecd6a.55762","type":"link out","z":"e31e7792.ce32c8","name":"update","links":["b2f35cbe.ed766","fe8c5fb7.44a79"],"x":595,"y":40,"wires":[]},{"id":"b2f35cbe.ed766","type":"link in","z":"24a0a480.4f402c","name":"update","links":["c43ecd6a.55762"],"x":55,"y":300,"wires":[["3af59869.563e48"]]},{"id":"af0d8b4c.68b218","type":"link out","z":"24a0a480.4f402c","name":"update_date after http","links":["cdc9ad88.f56ad"],"x":615,"y":400,"wires":[]},{"id":"cdc9ad88.f56ad","type":"link in","z":"e31e7792.ce32c8","name":"","links":["af0d8b4c.68b218","23a2ab77.8cd524"],"x":75,"y":220,"wires":[["7f1ecdaf.78bff4","e07f2e56.d0b99"]]},{"id":"ea1ec360.0eacf","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":40,"wires":[["c3399547.624908"]]},{"id":"43c41e12.de099","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":670,"y":40,"wires":[]},{"id":"c3399547.624908","type":"template","z":"569f7697.a14888","name":"SENSORS","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM SENSORS;","output":"str","x":270,"y":40,"wires":[[]]},{"id":"cf0f9a11.e9a528","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":340,"wires":[["82b7db17.e1a338"]]},{"id":"c60a683f.56b0c8","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":630,"y":340,"wires":[]},{"id":"82b7db17.e1a338","type":"template","z":"569f7697.a14888","name":"SILAGES","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM SILAGES;","output":"str","x":260,"y":340,"wires":[[]]},{"id":"17648c37.9ee9d4","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":460,"wires":[["540bebc7.4ab544"]]},{"id":"a0205ce2.4a968","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":460,"wires":[]},{"id":"540bebc7.4ab544","type":"template","z":"569f7697.a14888","name":"OBJECTGROUPS","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM OBJECTGROUPS;","output":"str","x":290,"y":460,"wires":[[]]},{"id":"132ee553.3f663b","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":540,"wires":[["3fab6abb.79a1a6"]]},{"id":"71d91804.beada8","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":540,"wires":[]},{"id":"3fab6abb.79a1a6","type":"template","z":"569f7697.a14888","name":"EventsLog","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM EventsLog;","output":"str","x":270,"y":540,"wires":[[]]},{"id":"edade7c.2af8918","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":860,"wires":[["1dabdc53.297304"]]},{"id":"3a529710.f9a5e8","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":860,"wires":[]},{"id":"1dabdc53.297304","type":"template","z":"569f7697.a14888","name":"TLMAX_D","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM TLMAX_D\nLIMIT 3;","output":"str","x":270,"y":860,"wires":[[]]},{"id":"9349d933.6e03e8","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":620,"wires":[["887aee82.79cf2"]]},{"id":"5a327614.a6a9e8","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":620,"wires":[]},{"id":"887aee82.79cf2","type":"template","z":"569f7697.a14888","name":"REESTR","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM REESTR\nORDER BY DATETIME DESC LIMIT 10;\n","output":"str","x":260,"y":620,"wires":[[]]},{"id":"b38ff01a.7863d","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":680,"wires":[["4d42a478.118abc"]]},{"id":"c562099d.ef7ac8","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":680,"wires":[]},{"id":"4d42a478.118abc","type":"template","z":"569f7697.a14888","name":"TLMAX","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM TLMAX\nORDER BY DATETIME DESC LIMIT 3000;;","output":"str","x":260,"y":680,"wires":[[]]},{"id":"4a645f01.7be2","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":160,"wires":[["a3bdf43.cd39b08"]]},{"id":"e1346f1c.eb399","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":160,"wires":[]},{"id":"a3bdf43.cd39b08","type":"template","z":"569f7697.a14888","name":"DEVICES","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM DEVICES;","output":"str","x":260,"y":160,"wires":[[]]},{"id":"209b43a4.2b053c","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":220,"wires":[["9309702b.473e2"]]},{"id":"a6ff535d.95c1e","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":630,"y":220,"wires":[]},{"id":"9309702b.473e2","type":"template","z":"569f7697.a14888","name":"LAVALIERS","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM LAVALIERS;","output":"str","x":270,"y":220,"wires":[[]]},{"id":"99ddce5d.c6ef3","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":300,"wires":[["8f5da76.6e84458"]]},{"id":"ab93b032.4057d","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":630,"y":260,"wires":[]},{"id":"8f5da76.6e84458","type":"template","z":"569f7697.a14888","name":"LAVALIERS","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT LAVALIERS.ID, SENSORS.TSB_ID, SENSORS.USER_T, SENSORS.ONLINE, SENSORS.T, LAVALIERS.SILAGE_ID, LAVALIERS.LevelCount\nFROM LAVALIERS, SENSORS\nWHERE LAVALIERS.ID = SENSORS.TSB_ID;","output":"str","x":270,"y":300,"wires":[[]]},{"id":"d28fcc11.c32f7","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":940,"wires":[["e0cdffc0.32373"]]},{"id":"cd2cebd8.03a6e8","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":940,"wires":[]},{"id":"e0cdffc0.32373","type":"template","z":"569f7697.a14888","name":"REPORT_T","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM REPORT_T;","output":"str","x":270,"y":940,"wires":[[]]},{"id":"1e65cac4.96f3c5","type":"function","z":"569f7697.a14888","name":"","func":"msg.payload = {\n    LOG_RECNO: msg.payload[2500].LOG_RECNO,\n    DATETIME: msg.payload[2500].DATETIME,\n    SILAGE_ID: msg.payload[2500].SILAGE_ID,\n    LEVEL: msg.payload[2500].LEVEL,\n    SENSOR_ONLINE: msg.payload[2500].SENSOR_ONLINE,\n    SENSOR_STATE: msg.payload[2500].SENSOR_STATE,\n    SENSOR_VALUE: msg.payload[2500].SENSOR_VALUE,\n}\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":760,"wires":[["17b9378.12d4ac9"]]},{"id":"17b9378.12d4ac9","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":760,"wires":[]},{"id":"1ee59dd1.4b5892","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":1080,"wires":[["3003b26e.970fae"]]},{"id":"1805a57c.dca51b","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":1080,"wires":[]},{"id":"3003b26e.970fae","type":"template","z":"569f7697.a14888","name":"TLMAX","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM TLMAX\nWHERE LOG_RECNO = 2148 AND SILAGE_ID = 173\nORDER BY DATETIME DESC ;\n\n","output":"str","x":260,"y":1080,"wires":[[]]},{"id":"cc0c2fc8.484d7","type":"function","z":"569f7697.a14888","name":"","func":"msg.payload = {\n    LOG_RECNO: msg.payload[2500].LOG_RECNO,\n    DATETIME: msg.payload[2500].DATETIME,\n    SILAGE_ID: msg.payload[2500].SILAGE_ID,\n    LEVEL: msg.payload[2500].LEVEL,\n    SENSOR_ONLINE: msg.payload[2500].SENSOR_ONLINE,\n    SENSOR_STATE: msg.payload[2500].SENSOR_STATE,\n    SENSOR_VALUE: msg.payload[2500].SENSOR_VALUE,\n}\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":1160,"wires":[["5c9ea741.c5eaf8"]]},{"id":"5c9ea741.c5eaf8","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":1160,"wires":[]},{"id":"399ce728.82de78","type":"template","z":"569f7697.a14888","name":"TLMAX","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM TLMAX\nWHERE LOG_RECNO = 2149;\n\n","output":"str","x":260,"y":1020,"wires":[[]]},{"id":"bfbaff9e.241d1","type":"debug","z":"a440efc6.988bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":330,"y":60,"wires":[]},{"id":"413ec86.b024738","type":"http in","z":"a440efc6.988bc","name":"","url":"/getTempTermiks","method":"get","upload":false,"swaggerDoc":"","x":100,"y":60,"wires":[["b45df020.351fb","bfbaff9e.241d1"]]},{"id":"b45df020.351fb","type":"template","z":"a440efc6.988bc","name":"TLMAX","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM TLMAX\nWHERE LOG_RECNO = StringID\nORDER BY DATETIME DESC ;\n\n","output":"str","x":160,"y":120,"wires":[["1e648a59.4c59b6"]]},{"id":"860c3c6c.fee5b","type":"inject","z":"a440efc6.988bc","name":"","topic":"","payload":"2150","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":180,"wires":[["b45df020.351fb"]]},{"id":"1e648a59.4c59b6","type":"function","z":"a440efc6.988bc","name":"chek id","func":"var id = Number(msg.req.query.id);\n//var id = msg.payload;\n\n\n\n\nmsg.topic = msg.topic.replace(\"StringID\", id);\n\nmsg.payload = id;\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":120,"wires":[["30678d50.ee8712"]]},{"id":"30678d50.ee8712","type":"mysql","z":"a440efc6.988bc","mydb":"aff7e881.69e678","name":"","x":480,"y":120,"wires":[["7ffb08a4.703638","64222458.18eabc"]]},{"id":"7ffb08a4.703638","type":"debug","z":"a440efc6.988bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":120,"wires":[]},{"id":"64222458.18eabc","type":"function","z":"a440efc6.988bc","name":"res","func":"var in_data = msg.payload;\nvar id = msg.payload[0].LOG_RECNO;\nvar zam_data = msg.payload[0].DATETIME;\n\nvar len_data = msg.payload.length;\nvar Array_out = [];\n\n    for (var i = 0; i < len_data; i++) {\n        Array_out[i] = {\n            \"name\": in_data[i].SILAGE_ID + \"_\" + in_data[i].LEVEL,\n            \"zam_date\": in_data[i].DATETIME,\n            \"temp\": in_data[i].USER_VALUE  \n        }\n    }\n\n\nmsg.payload = {\n    id: id ,\n    sensors: Array_out\n}\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":160,"wires":[["95163b1e.091df8","3c55019b.8677ce"]]},{"id":"95163b1e.091df8","type":"debug","z":"a440efc6.988bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":430,"y":200,"wires":[]},{"id":"3c55019b.8677ce","type":"http response","z":"a440efc6.988bc","name":"","statusCode":"","headers":{},"x":610,"y":160,"wires":[]},{"id":"e43c497b.975708","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"arrayGroup_all","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":1220,"wires":[[]]},{"id":"dc0d4b5d.0ff448","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":630,"y":1220,"wires":[]},{"id":"92f08da.d76fd7","type":"function","z":"569f7697.a14888","name":"","func":"var in_date = msg.payload;\nvar len_in_date = in_date.length;\nvar array_out = [];\nvar array_sensor = [];\nvar silos = 0;\nvar SerialNumber = 0;\n\n    for (var i = 0; i < len_in_date; i++) {\n        for (var j = 0; j < in_date[i].length; j++) {\n            silos = in_date[i][j].SILAGE_ID;\n            SerialNumber = in_date[i][j].ID;\n            array_sensor[j] = {\n                name: in_date[i][j].ID + \"_\" + in_date[i][j].LEVEL,\n                name_r: \"Датчик\" + in_date[i][j].LEVEL\n            }\n  \n  \n        }\n        array_out[i] = {\n            silos: silos,\n            SerialNumber: SerialNumber,\n            GroupBob:   array_sensor\n        } \n        array_sensor = [];\n  \n    }\n\n\n\nmsg.payload = {\n    GroupSensor: array_out\n}\n\nreturn msg;\n/*\nGroupSensor\": [\n    {\n      \"silos\": \"1203 \",\n      \"SerialNumber\": \"010101\",\n      \"GroupBob\": [\n        {\n          \"name\": \"010101_TEMPE1\",\n          \"name_r\": \"Датчик01\"\n        },\n        \n*/","outputs":1,"noerr":0,"x":350,"y":1240,"wires":[["dc0d4b5d.0ff448","87b6e197.44c7d"]]},{"id":"87b6e197.44c7d","type":"http response","z":"569f7697.a14888","name":"","statusCode":"","headers":{},"x":610,"y":1260,"wires":[]},{"id":"21d6985c.619238","type":"http in","z":"a440efc6.988bc","name":"","url":"/getPodvesuTermiks","method":"get","upload":false,"swaggerDoc":"","x":110,"y":340,"wires":[["e10b0981.d533a8"]]},{"id":"e10b0981.d533a8","type":"template","z":"a440efc6.988bc","name":"LAVALIERS","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT LAVALIERS.ID, SENSORS.TSB_ID, SENSORS.USER_T, SENSORS.ONLINE, SENSORS.T, SENSORS.LEVEL, LAVALIERS.SILAGE_ID, LAVALIERS.LevelCount\nFROM LAVALIERS, SENSORS\nWHERE LAVALIERS.ID = SENSORS.TSB_ID;","output":"str","x":330,"y":340,"wires":[["e366492a.23dfd8"]]},{"id":"976ed8af.cee368","type":"inject","z":"a440efc6.988bc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":380,"wires":[["e10b0981.d533a8"]]},{"id":"e366492a.23dfd8","type":"mysql","z":"a440efc6.988bc","mydb":"aff7e881.69e678","name":"","x":500,"y":340,"wires":[["1ffd46d8.cbdd89","81ad3afa.eae958"]]},{"id":"1ffd46d8.cbdd89","type":"debug","z":"a440efc6.988bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":710,"y":340,"wires":[]},{"id":"81ad3afa.eae958","type":"function","z":"a440efc6.988bc","name":"find ID","func":"var in_date = msg.payload;\nvar arr_ID = [];\n\n\n\n    for (var q = 0; q < in_date.length; q++) {\n        arr_ID.push(in_date[q].ID);   \n       \n    }\n\n    var a = arr_ID;\n    var seen = {};\n    var out = [];\n    var len = a.length;\n    var j = 0;\n        for(var i = 0; i < len; i++) {\n             var item = a[i];\n             if(seen[item] !== 1) {\n                   seen[item] = 1;\n                   out[j++] = item;\n                   \n                   \n                   \n             }\n        }\n    \nvar correct = out;\n    \n//correct.sort();   \n\nvar true_res = correct.sort(function(a, b) {\n  return a - b;\n});\n\n\n\n//msg.payload =  correct\n\n\n\n\n\nflow.set(\"ID\", true_res);\nmsg.payload = in_date;\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":380,"wires":[["9b501a2d.ac69f8","82421308.2db58"]]},{"id":"9b501a2d.ac69f8","type":"function","z":"a440efc6.988bc","name":"group Podv.","func":"var in_data = msg.payload;\nvar array_id = flow.get(\"ID\");\nvar len_in_data = in_data.length;\n//var len_LevelCount = in_data[0].in_data;\nvar len_LevelCount = 0;\nvar arrayGroup = [];\nvar arrayGroup_all = [];\nvar n = 0;\nvar k = 0;\nvar i = 0;\n    for (var j = 0; j < array_id.length; j++) {\n        \n        for (i = 0  ;i < len_in_data; i++) {\n        \n            if(array_id[j] == in_data[i].ID){\n               arrayGroup[n] = in_data[i]; \n               n = n + 1;\n            }    \n        }\n    arrayGroup_all[j] = arrayGroup;\n    arrayGroup = [];\n    n = 0;\n    }\n        \n        \n\n    \n    \n\n\nmsg.payload = arrayGroup_all;\n    \nflow.set(\"arrayGroup_all\", arrayGroup_all);\nreturn msg;\n\n/*\nGroupSensor\": [\n    {\n      \"silos\": \"1203 \",\n      \"SerialNumber\": \"010101\",\n      \"GroupBob\": [\n        {\n          \"name\": \"010101_TEMPE1\",\n          \"name_r\": \"Датчик01\"\n        },\n        \n*/","outputs":1,"noerr":0,"x":490,"y":380,"wires":[["f59a783c.631798","105e56cb.357439"]]},{"id":"f59a783c.631798","type":"function","z":"a440efc6.988bc","name":"res","func":"var in_date = msg.payload;\nvar len_in_date = in_date.length;\nvar array_out = [];\nvar array_sensor = [];\nvar silos = 0;\nvar SerialNumber = 0;\n\n    for (var i = 0; i < len_in_date; i++) {\n        for (var j = 0; j < in_date[i].length; j++) {\n            SerialNumber = in_date[i][j].SILAGE_ID;\n            if (SerialNumber >= 0 && SerialNumber < 13){\n                silos = \"1.1\";\n            }else if(SerialNumber >= 13 && SerialNumber < 26){\n                silos = \"1.2\";\n            }else if(SerialNumber >= 26 && SerialNumber < 39){\n                silos = \"1.3\";\n            }else if(SerialNumber >= 39 && SerialNumber < 52){\n                silos = \"1.4\";\n            }else if(SerialNumber >= 52 && SerialNumber < 65){\n                silos = \"1.5\";\n            }else if(SerialNumber >= 65 && SerialNumber < 78){\n                silos = \"1.6\";\n            }else if(SerialNumber >= 78 && SerialNumber < 91){\n                silos = \"1.7\";\n            }else if(SerialNumber >= 91 && SerialNumber < 104){\n                silos = \"1.8\";\n            }else if(SerialNumber >= 104 && SerialNumber < 117){\n                silos = \"1.9\";\n            }else if(SerialNumber >= 117 && SerialNumber < 122){\n                silos = \"3.1\";\n            }else if(SerialNumber >= 122 && SerialNumber < 127){\n                silos = \"3.2\";\n            }else if(SerialNumber >= 127 && SerialNumber < 132){\n                silos = \"3.3\";\n            }else if(SerialNumber >= 132 && SerialNumber < 137){\n                silos = \"3.4\";\n            }else if(SerialNumber >= 137 && SerialNumber < 142){\n                silos = \"3.5\";\n            }else if(SerialNumber >= 142 && SerialNumber < 147){\n                silos = \"3.6\";\n            }else if(SerialNumber >= 147 && SerialNumber < 160){\n                silos = \"25.1\";\n            }else if(SerialNumber >= 160 && SerialNumber < 173){\n                silos = \"25.2\";\n            }else if(SerialNumber >= 173 && SerialNumber <= 173){\n                silos = \"26.2\";\n            }else if(SerialNumber >= 174 && SerialNumber <= 174){\n                silos = \"26.1\";\n            }\n            \n            \n            //silos = in_date[i][j].SILAGE_ID;\n            var name_r = \"\";\n            var number = in_date[i][j].LEVEL + 1; \n                if(number < 10){\n                    name_r =  \"Датчик0\" + number;    \n                }else{\n                    name_r =  \"Датчик\" + number;    \n                }\n            \n            array_sensor[j] = {\n                name: in_date[i][j].SILAGE_ID + \"_\" + in_date[i][j].LEVEL,\n                name_r: name_r\n            }\n  \n  \n        }\n        array_out[i] = {\n            silos: silos,\n            SerialNumber: SerialNumber,\n            GroupBob:   array_sensor\n        } \n        array_sensor = [];\n  \n    }\n\n\n\nmsg.payload = {\n    GroupSensor: array_out\n}\n\nreturn msg;\n/*\nGroupSensor\": [\n    {\n      \"silos\": \"1203 \",\n      \"SerialNumber\": \"010101\",\n      \"GroupBob\": [\n        {\n          \"name\": \"010101_TEMPE1\",\n          \"name_r\": \"Датчик01\"\n        },\n        \n*/","outputs":1,"noerr":0,"x":630,"y":380,"wires":[["d4863bb2.1df128","f4b52e27.b6858"]]},{"id":"d4863bb2.1df128","type":"http response","z":"a440efc6.988bc","name":"","statusCode":"","headers":{},"x":770,"y":380,"wires":[]},{"id":"1009e04d.6f1fb","type":"exec","z":"e31e7792.ce32c8","command":"mount.cifs //SC-DPBE-01/Obmin/Special /mnt/winshare -o username=tm_be_exch,password='Bqzv[q*(Saz<e5g3'","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"mount","x":320,"y":340,"wires":[["e63bbd51.b4563"],["e63bbd51.b4563"],["e63bbd51.b4563"]]},{"id":"8d8dbc7b.70603","type":"inject","z":"e31e7792.ce32c8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":320,"wires":[["1009e04d.6f1fb"]]},{"id":"e63bbd51.b4563","type":"debug","z":"e31e7792.ce32c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":490,"y":320,"wires":[]},{"id":"370514df.47d7fc","type":"comment","z":"e31e7792.ce32c8","name":"mount info","info":"Необхідно запускати дану команду у випадку відсутності файла в сетевому диску ","x":80,"y":280,"wires":[]},{"id":"295c7db5.b9f4b2","type":"file in","z":"9bb1f8c1.ef6888","name":"","filename":"/home/sa.palanyuk/file_for_kombukorm/Podvesky.csv","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":520,"y":60,"wires":[["ad162eb5.17d28"]]},{"id":"ad162eb5.17d28","type":"csv","z":"9bb1f8c1.ef6888","name":"","sep":",","hdrin":"","hdrout":true,"multi":"mult","ret":"\\n","temp":"METKA,KOEF1,KOEF2,KOEF3,KOEF4,KOEF5,KOEF6,KOEF7,KOEF8,KOEF9,KOEFA,PODVESKA,SILOS,BANKA,KOL_DATH,REMONT,KOD_PROD,VES_PROD,VYS_PROD,VYS_PUST,KORPUS,M_STROKA,M_STOLB","skip":"1","strings":true,"x":330,"y":120,"wires":[["ff29a8cf.5fb8f8","a1f14514.c4eb08"]]},{"id":"46de8b85.e25684","type":"http in","z":"9bb1f8c1.ef6888","name":"","url":"/get/PodvesuKombikorm","method":"get","upload":false,"swaggerDoc":"","x":140,"y":60,"wires":[["295c7db5.b9f4b2"]]},{"id":"de581e6b.43453","type":"inject","z":"9bb1f8c1.ef6888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":120,"wires":[["295c7db5.b9f4b2"]]},{"id":"ff29a8cf.5fb8f8","type":"function","z":"9bb1f8c1.ef6888","name":"","func":"var in_date = msg.payload;\nvar new_date = [];\n    for (var i = 0; i < in_date.length; i++) {\n        new_date[i] = {\n            silos: in_date[i].SILOS,\n            SerialNumber: in_date[i].PODVESKA,\n            GroupBob: [{\n                name:in_date[i].PODVESKA + \"_TEMPE1\",\n                name_r: \"Датчик01\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE2\",\n                name_r: \"Датчик02\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE3\",\n                name_r: \"Датчик03\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE4\",\n                name_r: \"Датчик04\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE5\",\n                name_r: \"Датчик05\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE6\",\n                name_r: \"Датчик06\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE7\",\n                name_r: \"Датчик07\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE8\",\n                name_r: \"Датчик08\"\n            },\n            {\n                name:in_date[i].PODVESKA + \"_TEMPE9\",\n                name_r: \"Датчик09\"\n            },\n            ]\n        }\n  \n    }\n\nmsg.payload = {\n    GroupSensor: new_date\n}\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":120,"wires":[["2da8641a.85dc0c","40bafd25.35f674"]]},{"id":"2da8641a.85dc0c","type":"http response","z":"9bb1f8c1.ef6888","name":"","statusCode":"","headers":{},"x":650,"y":120,"wires":[]},{"id":"40bafd25.35f674","type":"debug","z":"9bb1f8c1.ef6888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":200,"wires":[]},{"id":"a1f14514.c4eb08","type":"debug","z":"9bb1f8c1.ef6888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":430,"y":200,"wires":[]},{"id":"13ce9b3d.039fa5","type":"function","z":"9bb1f8c1.ef6888","name":"array res","func":"//var startSensor = Number(msg.req.query.offsets);\n//var range = Number(msg.req.query.counts);\nvar id = Number(msg.req.query.id);\n//var id = msg.id;\n\nvar arra_id = flow.get(\"ID_2\");\nvar arra_id_3 = arra_id.slice();\nvar arra_id_2 = arra_id.slice();\nvar copy_arra_id = [];\n//find element array\nvar num_id = arra_id_2.indexOf(id);  \n    arra_id_2.splice(0, num_id );//array date\nvar len_arra_id = arra_id_2.length;\n\nvar array_in = []\narray_in = flow.get(\"in_array\");\n\nvar array_in_2 = array_in.slice();\nvar len_array = array_in_2.length;\n\nvar array_out = [];\nvar count = 0;\n\n    for (var j = 0; j < len_arra_id; j++) {\n        \n\n            for (var i = 0; i < len_array; i++) {\n                if(array_in_2[i].ID == arra_id_2[j]) {\n                   delete array_in_2[i].TEMPE1 \n                   delete array_in_2[i].TEMPE2 \n                   delete array_in_2[i].TEMPE3\n                   delete array_in_2[i].TEMPE4 \n                   delete array_in_2[i].TEMPE5 \n                   delete array_in_2[i].TEMPE6\n                   delete array_in_2[i].TEMPE7 \n                   delete array_in_2[i].TEMPE8 \n                   delete array_in_2[i].TEMPE9\n                   delete array_in_2[i].TEMPEM \n                   delete array_in_2[i].ZAM_DATE \n                   delete array_in_2[i].PODVESKA \n                   delete array_in_2[i].ID \n                    array_out[count] = array_in_2[i]; \n                    count++;\n                }\n                \n            }\n        copy_arra_id[j] = array_out;\n        array_out = [];\n        count = 0;\n    }\n\n\n    \n    \n    \n    \n//msg.payload = array_out;\n\nmsg.id = arra_id_3[arra_id_3.length - 1];\nmsg.payload = copy_arra_id;\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":600,"wires":[["67399d1e.80ab84","8486d833.f290a8"]]},{"id":"fa04806f.7d6a9","type":"http in","z":"9bb1f8c1.ef6888","name":"","url":"/get/TEMP_kombikorm","method":"get","upload":false,"swaggerDoc":"","x":140,"y":580,"wires":[["13ce9b3d.039fa5","a420e28f.9b8bd"]]},{"id":"67399d1e.80ab84","type":"function","z":"9bb1f8c1.ef6888","name":"res","func":"var ID = msg.id;\nvar in_data = msg.payload;\nvar len_in_data = in_data.length;\nvar array3 = [];\n//var array3 = array1.concat(array2);\n\n     for (var i = 0; i < len_in_data; i++) {\n          var len_array_I = in_data[i].length;\n              for (var j = 0; j < len_array_I; j++) {\n                array3 = array3.concat(in_data[i][j].sensors)    \n              }\n         \n     }\n\nmsg.payload = \n    { \n        id:ID,\n        sensors:array3\n        \n        \n    }\n    ;\n\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":600,"wires":[["6d095a9b.f1d754","55dfb73a.96f788","cd256bec.1a0ef8","47ea97d5.808f88"]]},{"id":"8486d833.f290a8","type":"debug","z":"9bb1f8c1.ef6888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":680,"wires":[]},{"id":"a420e28f.9b8bd","type":"debug","z":"9bb1f8c1.ef6888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":290,"y":680,"wires":[]},{"id":"6d095a9b.f1d754","type":"http response","z":"9bb1f8c1.ef6888","name":"","statusCode":"","headers":{},"x":690,"y":600,"wires":[]},{"id":"55dfb73a.96f788","type":"debug","z":"9bb1f8c1.ef6888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":690,"y":560,"wires":[]},{"id":"cd256bec.1a0ef8","type":"file in","z":"9bb1f8c1.ef6888","name":"Zamery.csv_Kombikorm","filename":"/home/sa.palanyuk/file_for_kombukorm/Zamery.csv","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":410,"y":500,"wires":[["b583620d.68c8e"]]},{"id":"90aeb6fc.c15398","type":"inject","z":"9bb1f8c1.ef6888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"0.2","x":150,"y":500,"wires":[["cd256bec.1a0ef8"]]},{"id":"b583620d.68c8e","type":"csv","z":"9bb1f8c1.ef6888","name":"","sep":",","hdrin":"","hdrout":true,"multi":"mult","ret":"\\n","temp":"PODVESKA,ZAM_DATE,TEMPE1,TEMPE2,TEMPE3,TEMPE4,TEMPE5,TEMPE6,TEMPE7,TEMPE8,TEMPE9,TEMPEM,KOD_PROD,VES_PROD,VYS_PROD","skip":"1","strings":true,"x":530,"y":460,"wires":[["1333acb1.6635b3","e98db7ce.48d4f8"]]},{"id":"1333acb1.6635b3","type":"function","z":"9bb1f8c1.ef6888","name":"","func":"flow.set(\"out_date_csv\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":460,"wires":[["e9ea2a08.c17578","d49a9e5c.b230c","acfa4523.68e5a8"]]},{"id":"e9ea2a08.c17578","type":"debug","z":"9bb1f8c1.ef6888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":460,"wires":[]},{"id":"d49a9e5c.b230c","type":"function","z":"9bb1f8c1.ef6888","name":"correct","func":"var in_array =  msg.payload;\nvar ID = \"\";\n\n    for (var i = 0; i < in_array.length; i++) {\n       ID = in_array[i].ZAM_DATE;\n       ID = new Date(ID);\n       in_array[i].ID = Number(ID);\n       var string_Name = in_array[i].PODVESKA\n\n       in_array[i].sensors = [{\n           name: string_Name +\"_TEMPE1\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE1\n       },\n       {\n           name:string_Name +\"_TEMPE2\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE2\n       },{\n           name:string_Name +\"_TEMPE3\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE3\n       },{\n           name: string_Name +\"_TEMPE4\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE4\n       },{\n           name: string_Name +\"_TEMPE5\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE5\n       },{\n           name: string_Name +\"_TEMPE6\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE6\n       },{\n           name: string_Name +\"_TEMPE7\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE7\n       },{\n           name: string_Name +\"_TEMPE8\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE8\n       },{\n           name: string_Name +\"_TEMPE9\",\n           zam_date:in_array[i].ZAM_DATE,\n           temp: in_array[i].TEMPE9\n       }\n       ]\n       \n       delete in_array[i].KOD_PROD\n       delete in_array[i].VES_PROD\n       delete in_array[i].VYS_PROD\n       //delete in_array[i].TEMPE4\n       //delete in_array[i].TEMPE5\n       //delete in_array[i].TEMPE6\n       //delete in_array[i].TEMPEM\n        \n        \n        \n    }\n\nmsg.payload = in_array;    \n\nflow.set(\"in_array\", in_array);\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":420,"wires":[["27b47cc0.818334"]]},{"id":"acfa4523.68e5a8","type":"function","z":"9bb1f8c1.ef6888","name":"All ID","func":"var in_date = msg.payload;\nvar arr_ZAM_DATE = [];\nvar arr_PODVESKA = [];\n\n\n    for (var q = 0; q < in_date.length; q++) {\n        arr_PODVESKA.push(in_date[q].PODVESKA);   \n        arr_ZAM_DATE.push(in_date[q].ZAM_DATE);\n    }\n\n    var a = arr_ZAM_DATE;\n    var seen = {};\n    var out = [];\n    var len = a.length;\n    var j = 0;\n        for(var i = 0; i < len; i++) {\n             var item = a[i];\n             if(seen[item] !== 1) {\n                   seen[item] = 1;\n                   out[j++] = item;\n                   \n                   \n                   \n             }\n        }\n    \nvar correct = out;\n    \ncorrect.sort();   \n        for(var n = 0; n < correct.length; n++) {\n        var ID = new Date(correct[n]);\n        correct[n] = Number(ID);    \n        }\n\n//msg.payload =  correct\nmsg.payload = {\n    ZAM_DATE: arr_ZAM_DATE,\n    correct: correct\n    \n} \n\n\n\n\nflow.set(\"ID\", msg.payload.correct);\nflow.set(\"ID_2\", msg.payload.correct)\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":500,"wires":[["4e08b20.590dc5"]]},{"id":"27b47cc0.818334","type":"debug","z":"9bb1f8c1.ef6888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":420,"wires":[]},{"id":"4e08b20.590dc5","type":"debug","z":"9bb1f8c1.ef6888","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":500,"wires":[]},{"id":"a2ffb50a.567748","type":"inject","z":"9bb1f8c1.ef6888","name":"","topic":"","payload":"ID","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":340,"wires":[["46015ce4.485a84"]]},{"id":"ffbc7def.0dfa2","type":"inject","z":"9bb1f8c1.ef6888","name":"","topic":"","payload":"ID_2","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":380,"wires":[["46015ce4.485a84"]]},{"id":"c87a172a.ab6888","type":"inject","z":"9bb1f8c1.ef6888","name":"","topic":"","payload":"in_array","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":420,"wires":[["46015ce4.485a84"]]},{"id":"46015ce4.485a84","type":"debug","z":"9bb1f8c1.ef6888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":350,"y":360,"wires":[]},{"id":"df6b02a2.40b18","type":"inject","z":"9bb1f8c1.ef6888","name":"","topic":"","payload":"out_date_csv","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":300,"wires":[["46015ce4.485a84"]]},{"id":"654ce1f8.e8999","type":"inject","z":"9bb1f8c1.ef6888","name":"","topic":"","payload":"1586763441000","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":260,"wires":[["46015ce4.485a84"]]},{"id":"1584a3d2.923c4c","type":"inject","z":"e31e7792.ce32c8","name":"","topic":"","payload":"","payloadType":"date","repeat":"7200","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":480,"wires":[["ea804fe3.de317"]]},{"id":"ea804fe3.de317","type":"exec","z":"e31e7792.ce32c8","command":"bash /home/sa.palanyuk/file_for_kombukorm/script.sh","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"CONVERT","x":310,"y":480,"wires":[["d8c1c04f.b1e5c","b1935652.debac8"],[],[]]},{"id":"d8c1c04f.b1e5c","type":"debug","z":"e31e7792.ce32c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":490,"y":460,"wires":[]},{"id":"e8091ec6.2aaf9","type":"comment","z":"e31e7792.ce32c8","name":"Kombicorm convert","info":"","x":110,"y":400,"wires":[]},{"id":"47ea97d5.808f88","type":"link out","z":"9bb1f8c1.ef6888","name":"update_kombikorm","links":["76851844.0d1db8"],"x":680,"y":660,"wires":[]},{"id":"76851844.0d1db8","type":"link in","z":"e31e7792.ce32c8","name":"update_kombikorm","links":["47ea97d5.808f88"],"x":75,"y":520,"wires":[["ea804fe3.de317"]]},{"id":"b1935652.debac8","type":"link out","z":"e31e7792.ce32c8","name":"update_kombikorm_zameru","links":["bc812e57.3d6f2"],"x":440,"y":420,"wires":[]},{"id":"bc812e57.3d6f2","type":"link in","z":"9bb1f8c1.ef6888","name":"update_kombikorm_zameru","links":["b1935652.debac8"],"x":95,"y":540,"wires":[["cd256bec.1a0ef8"]]},{"id":"e98db7ce.48d4f8","type":"debug","z":"9bb1f8c1.ef6888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":340,"wires":[]},{"id":"669428e6.5d7748","type":"comment","z":"9bb1f8c1.ef6888","name":"","info":"METKA,KOEF1,KOEF2,KOEF3,KOEF4,KOEF5,KOEF6,KOEF7,KOEF8,KOEF9,KOEFA,PODVESKA,SILOS,BANKA,KOL_DATH,REMONT,KOD_PROD,VES_PROD,VYS_PROD,VYS_PUST,KORPUS,M_STROKA,M_STOLB","x":360,"y":420,"wires":[]},{"id":"2165864.39ea37a","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":260,"wires":[["a8a18906.54f008"]]},{"id":"a8a18906.54f008","type":"template","z":"569f7697.a14888","name":"LAVALIERS","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM LAVALIERS\nWHERE SILAGE_ID = 174;","output":"str","x":250,"y":260,"wires":[[]]},{"id":"6fdf9e9f.1b84d","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":80,"wires":[["46d856c2.0f3918"]]},{"id":"46d856c2.0f3918","type":"template","z":"569f7697.a14888","name":"SENSORS","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM SENSORS\nWHERE TSB_ID = 1;","output":"str","x":270,"y":80,"wires":[[]]},{"id":"82421308.2db58","type":"debug","z":"a440efc6.988bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":350,"y":460,"wires":[]},{"id":"105e56cb.357439","type":"debug","z":"a440efc6.988bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":550,"y":460,"wires":[]},{"id":"f4b52e27.b6858","type":"debug","z":"a440efc6.988bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":460,"wires":[]},{"id":"4220aaec.cc4a24","type":"inject","z":"a440efc6.988bc","name":"","topic":"","payload":"ID","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":280,"wires":[["5c05987.efb7768"]]},{"id":"5c05987.efb7768","type":"debug","z":"a440efc6.988bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":250,"y":280,"wires":[]},{"id":"49c8af70.2e0aa","type":"template","z":"569f7697.a14888","name":"TLMAX","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM TLMAX\nWHERE LOG_RECNO = StringID\nORDER BY DATETIME DESC ;\n\n","output":"str","x":220,"y":760,"wires":[[]]},{"id":"e55f486.fcfc4b8","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":450,"y":520,"wires":[]},{"id":"236f1453.48b8fc","type":"function","z":"569f7697.a14888","name":"","func":"var in_date = msg.payload;\nvar GROUP = [];\nvar NO = [];\n    for (var i = 0; i < in_date.length; i++) {\n        if(in_date[i].GROUP === 0 || in_date[i].GROUP == 7){\n        GROUP.push(in_date[i]);    \n        }\n       \n    }\n    \n    for (var j = 0; j < in_date.length; j++) {\n        if(in_date[j].GROUP === 0 || in_date[j].GROUP == 7){\n        NO.push(in_date[j].NO);    \n        }\n       \n    }\n    \n    \n    \n    msg.payload = {\n        GROUP: GROUP,\n        NO: NO\n    }\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":400,"wires":[["82ec5d70.1c331"]]},{"id":"82ec5d70.1c331","type":"debug","z":"569f7697.a14888","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":670,"y":400,"wires":[]},{"id":"6f93ce09.369f6","type":"template","z":"569f7697.a14888","name":"SILAGES","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT * FROM SILAGES;","output":"str","x":240,"y":380,"wires":[[]]},{"id":"fe438cc7.6c326","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":380,"wires":[["6f93ce09.369f6"]]},{"id":"127c7fd3.b32ac","type":"template","z":"569f7697.a14888","name":"LAVALIERS","field":"topic","fieldType":"msg","format":"text","syntax":"mustache","template":"SELECT LAVALIERS.ID, SENSORS.TSB_ID, SENSORS.USER_T, SENSORS.ONLINE, SENSORS.T, SENSORS.LEVEL, LAVALIERS.SILAGE_ID, LAVALIERS.LevelCount\nFROM LAVALIERS, SENSORS\nWHERE LAVALIERS.ID = SENSORS.TSB_ID;","output":"str","x":370,"y":1360,"wires":[[]]},{"id":"a07a2c54.34897","type":"inject","z":"569f7697.a14888","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":1020,"wires":[["399ce728.82de78"]]},{"id":"425d4a14.8b5294","type":"function","z":"569f7697.a14888","name":"find ID","func":"var in_date = msg.payload;\nvar arr_ID = [];\n\n\n\n    for (var q = 0; q < in_date.length; q++) {\n        arr_ID.push(in_date[q].SILAGE_ID);   \n       \n    }\n\n    var a = arr_ID;\n    var seen = {};\n    var out = [];\n    var len = a.length;\n    var j = 0;\n        for(var i = 0; i < len; i++) {\n             var item = a[i];\n             if(seen[item] !== 1) {\n                   seen[item] = 1;\n                   out[j++] = item;\n                   \n                   \n                   \n             }\n        }\n    \nvar correct = out;\n    \n//correct.sort();   \n\nvar true_res = correct.sort(function(a, b) {\n  return a - b;\n});\n\n\n\nmsg.payload =  true_res;\n\n\n\n\n\n//flow.set(\"ID\", true_res);\n//msg.payload = in_date;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":260,"wires":[["ab93b032.4057d"]]},{"id":"576526f4.aa33f8","type":"comment","z":"569f7697.a14888","name":"0.13.26.39.52.65.78.91.104.122.117.127.132.137.142.147.160","info":"0.\n13.\n26.\n39.\n52.\n65.\n78.\n91.\n104.\n117.\n122.\n127.\n132.\n137.\n142.\n147.\n160","x":260,"y":120,"wires":[]}]
