[{"id":"8240f32a.64e8d","type":"tab","label":"RFID UHF"},{"id":"ec08de82.9f8fc","type":"tab","label":"Tablo 1 Ворота","disabled":false,"info":""},{"id":"f5b7c2df.fcf43","type":"tab","label":"Tablo_2 Дальні","disabled":false,"info":""},{"id":"40dcdbed.95c274","type":"tab","label":"Зчитувач","disabled":false,"info":""},{"id":"17b156e0.3aac29","type":"tab","label":"Периметр","disabled":false,"info":""},{"id":"58118560.4b14cc","type":"tab","label":"Ваги","disabled":false,"info":""},{"id":"16ab13ed.699cdc","type":"tab","label":"Dashboard","disabled":false,"info":""},{"id":"f049111d.b9ba2","type":"subflow","name":"ETTN","info":"","in":[],"out":[]},{"id":"5df307b.7f71cf8","type":"subflow","name":"Subflow 1","info":"","in":[],"out":[]},{"id":"8590abb5.5b4548","type":"ui_group","z":"","name":"Табло 1","tab":"ded5b23.f17bc5","order":1,"disp":true,"width":"6","collapse":false},{"id":"dee24f35.bc1eb","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#007ace","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#0e1b6a","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#007ace","edited":true},"page-titlebar-backgroundColor":{"value":"#007ace","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1ba2ff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#007ace","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"e9f9a8a1.a26618","type":"ui_group","z":"","name":"Зчитувачі","tab":"ded5b23.f17bc5","order":3,"disp":true,"width":"6","collapse":false},{"id":"ded5b23.f17bc5","type":"ui_tab","z":"","name":"Monitoring","icon":"dashboard","disabled":false,"hidden":false},{"id":"a759403f.19307","type":"ui_group","z":"","name":"Табло 2","tab":"ded5b23.f17bc5","order":2,"disp":true,"width":"6","collapse":false},{"id":"6a5b2eb3.f08ef","type":"ui_group","z":"","name":"Вага","tab":"ded5b23.f17bc5","disp":true,"width":"6","collapse":false},{"id":"455cc101.994c1","type":"ui_group","z":"","name":"Периметр","tab":"ded5b23.f17bc5","disp":true,"width":"5","collapse":false},{"id":"b181607b.5d7e8","type":"inject","z":"ec08de82.9f8fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":120,"wires":[["69ac7d70.de3964"]]},{"id":"69ac7d70.de3964","type":"function","z":"ec08de82.9f8fc","name":"Дані строки ТЕСТ 1","func":"\nvar num_avto_r1 = \"АК 3456 ВІ\";\nvar num_avto_r2 = \"1234 кг\";\n\n\nmsg.payload =\"START1;0;0;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":340,"y":120,"wires":[["ef3b48e0.93b098"]]},{"id":"9dbc46e2.ef2d28","type":"tcp out","z":"ec08de82.9f8fc","host":"10.3.45.245","port":"9761","beserver":"client","base64":false,"end":false,"name":"","x":820,"y":120,"wires":[]},{"id":"9c4ec8df.e8c3f8","type":"exec","z":"40dcdbed.95c274","command":"node /home/pi/wiegan/app.js","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":340,"y":100,"wires":[["6fa1007a.613f5"],[],[]]},{"id":"aedacfe8.a5a76","type":"inject","z":"40dcdbed.95c274","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":160,"wires":[["9c4ec8df.e8c3f8","e7bd5d10.1a24a","ebbbbf1b.6fc38"]]},{"id":"e7bd5d10.1a24a","type":"exec","z":"40dcdbed.95c274","command":"node /home/pi/wiegan/app_1.js","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":350,"y":240,"wires":[["8d2750c8.13d78"],[],[]]},{"id":"ebbbbf1b.6fc38","type":"exec","z":"40dcdbed.95c274","command":"node /home/pi/wiegan/app_2.js","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":350,"y":380,"wires":[["e837e947.e18e78"],[],[]]},{"id":"e8642214.68de","type":"debug","z":"40dcdbed.95c274","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":360,"wires":[]},{"id":"a36e99b6.42a1e8","type":"Wiegand","z":"40dcdbed.95c274","name":"Gpio RFID 17 18 Init","host":"17","timer":"18","x":340,"y":40,"wires":[[]]},{"id":"3378f055.b60f8","type":"Wiegand","z":"40dcdbed.95c274","name":"Gpio RFID 22 23 Init","host":"22","timer":"23","x":340,"y":180,"wires":[[]]},{"id":"8064ca21.6572b8","type":"Wiegand","z":"40dcdbed.95c274","name":"Gpio RFID 25 5 Init","host":"25","timer":"5","x":330,"y":320,"wires":[[]]},{"id":"f5de37cf.190fd8","type":"converter","z":"f5b7c2df.fcf43","name":"","from":"win1251","x":560,"y":100,"wires":[["8d868905.bc65f8"]]},{"id":"22c504b9.a16a4c","type":"comment","z":"40dcdbed.95c274","name":"Охорона","info":"","x":140,"y":380,"wires":[]},{"id":"38ad4b55.1f5584","type":"comment","z":"40dcdbed.95c274","name":"Вїзд","info":"","x":130,"y":100,"wires":[]},{"id":"aa394268.f1e3a","type":"comment","z":"40dcdbed.95c274","name":"Виїзд","info":"","x":130,"y":240,"wires":[]},{"id":"ef3b48e0.93b098","type":"converter","z":"ec08de82.9f8fc","name":"","from":"win1251","x":620,"y":120,"wires":[["9dbc46e2.ef2d28"]]},{"id":"8d868905.bc65f8","type":"tcp out","z":"f5b7c2df.fcf43","host":"10.3.45.246","port":"9761","beserver":"client","base64":false,"end":false,"name":"","x":760,"y":100,"wires":[]},{"id":"4ca19d35.babad4","type":"function","z":"ec08de82.9f8fc","name":"Дані  ТЕСТ 2","func":"\nvar num_avto_r1 = \"АК ТЕСТ ВІ\";\nvar num_avto_r2 = \"99999 кг\";\n\n\nmsg.payload =\"START1;0;0;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":310,"y":160,"wires":[["ef3b48e0.93b098"]]},{"id":"c047d9b2.d957d8","type":"inject","z":"ec08de82.9f8fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":160,"wires":[["4ca19d35.babad4"]]},{"id":"b51e00c4.5b999","type":"inject","z":"f5b7c2df.fcf43","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":60,"wires":[["f01036a4.cf0c78"]]},{"id":"f01036a4.cf0c78","type":"function","z":"f5b7c2df.fcf43","name":"Дані строки ТЕСТ 1","func":"\nvar num_avto_r1 = \"АК4323ВВ\";\nvar num_avto_r2 = \"13200 кг\";\n\n\nmsg.payload =\"START1;0;0;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":300,"y":60,"wires":[["f5de37cf.190fd8"]]},{"id":"4054101b.b98da","type":"function","z":"f5b7c2df.fcf43","name":"Дані строки ТЕСТ 2 ","func":"\nvar num_avto_r1 = \" 123  \";\nvar num_avto_r2 = \" Ряд 34 \";\n\n\nmsg.payload =\"START1;0;0;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":300,"y":100,"wires":[["f5de37cf.190fd8"]]},{"id":"f52cd310.f9e5e","type":"inject","z":"f5b7c2df.fcf43","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":100,"wires":[["4054101b.b98da"]]},{"id":"ec96cff.b24cf3","type":"debug","z":"17b156e0.3aac29","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":100,"wires":[]},{"id":"ae90f454.dcf108","type":"debug","z":"17b156e0.3aac29","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":200,"wires":[]},{"id":"d47d12b1.d5e85","type":"comment","z":"17b156e0.3aac29","name":"Виїзд Init","info":"","x":200,"y":40,"wires":[]},{"id":"1729ce58.1fb8a2","type":"comment","z":"17b156e0.3aac29","name":"Вїзд Init","info":"","x":190,"y":160,"wires":[]},{"id":"65a4554e.7c2bac","type":"comment","z":"17b156e0.3aac29","name":"1 Не пересічено: 0 Пересічено","info":"","x":410,"y":40,"wires":[]},{"id":"99330818.919488","type":"function","z":"ec08de82.9f8fc","name":"Світлофор зелений","func":"\n\n\nmsg.payload =\"START1;0;0;3;2;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":380,"y":380,"wires":[["9dbc46e2.ef2d28","111213b.239acec"]]},{"id":"d130bc90.16af7","type":"function","z":"ec08de82.9f8fc","name":"Світлофор червний","func":"\n\n\nmsg.payload =\"START1;0;1;3;1;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":380,"y":420,"wires":[["9dbc46e2.ef2d28","d7952c4.0e479d"]]},{"id":"d74d70b2.8c3e5","type":"inject","z":"ec08de82.9f8fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":80,"y":560,"wires":[["754a65fb.20f4ac"]]},{"id":"754a65fb.20f4ac","type":"function","z":"ec08de82.9f8fc","name":"погасити світлофори","func":"\n\n\nmsg.payload =\"START1;0;0;3;0;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":280,"y":560,"wires":[["22c74702.5d3f58","9dbc46e2.ef2d28"]]},{"id":"22c74702.5d3f58","type":"debug","z":"ec08de82.9f8fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":560,"wires":[]},{"id":"3591aa1f.138566","type":"inject","z":"f5b7c2df.fcf43","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":280,"wires":[["cfd960ba.7a694"]]},{"id":"cfd960ba.7a694","type":"function","z":"f5b7c2df.fcf43","name":"Світлофор зелений","func":"\n\n\nmsg.payload =\"START1;0;0;3;2;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":300,"y":280,"wires":[["308e9d96.5bc5a2","8d868905.bc65f8"]]},{"id":"308e9d96.5bc5a2","type":"debug","z":"f5b7c2df.fcf43","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":280,"wires":[]},{"id":"dd95b845.a6dfd8","type":"inject","z":"f5b7c2df.fcf43","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":320,"wires":[["f17f2e38.d77b7"]]},{"id":"f17f2e38.d77b7","type":"function","z":"f5b7c2df.fcf43","name":"Світлофор червний","func":"\n\n\nmsg.payload =\"START1;0;1;3;1;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":300,"y":320,"wires":[["90f22f78.a06c6","8d868905.bc65f8"]]},{"id":"90f22f78.a06c6","type":"debug","z":"f5b7c2df.fcf43","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":320,"wires":[]},{"id":"3a80ec5.46d6b14","type":"inject","z":"f5b7c2df.fcf43","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":460,"wires":[["5653fd8a.bcd734"]]},{"id":"5653fd8a.bcd734","type":"function","z":"f5b7c2df.fcf43","name":"погасити світлофори","func":"\n\n\nmsg.payload =\"START1;0;0;3;0;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":300,"y":460,"wires":[["e4b5a562.b843d8","8d868905.bc65f8"]]},{"id":"e4b5a562.b843d8","type":"debug","z":"f5b7c2df.fcf43","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":460,"wires":[]},{"id":"f788a444.4ac578","type":"inject","z":"ec08de82.9f8fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":80,"y":600,"wires":[["636cd96d.18aa38"]]},{"id":"636cd96d.18aa38","type":"function","z":"ec08de82.9f8fc","name":"яскравість на 100","func":"\n\n\nmsg.payload =\"START1;0;0;102;255;255;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":270,"y":600,"wires":[["b355504f.af78c","9dbc46e2.ef2d28"]]},{"id":"b355504f.af78c","type":"debug","z":"ec08de82.9f8fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":600,"wires":[]},{"id":"aae8060d.591ef8","type":"inject","z":"f5b7c2df.fcf43","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":520,"wires":[["fa6b914c.9b8aa"]]},{"id":"fa6b914c.9b8aa","type":"function","z":"f5b7c2df.fcf43","name":"яскравість 100","func":"\n\n\nmsg.payload =\"START1;0;0;102;255;255;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":280,"y":520,"wires":[["4dc57a3b.3fc484","8d868905.bc65f8"]]},{"id":"4dc57a3b.3fc484","type":"debug","z":"f5b7c2df.fcf43","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":520,"wires":[]},{"id":"24499bf4.7729a4","type":"link out","z":"40dcdbed.95c274","name":"ЗЧ Вїзд","links":["de0306a3.44eb18","d7e31676.44ef28","6e922916.48a198","38e0f8e5.10ab38"],"x":675,"y":40,"wires":[]},{"id":"d140e40a.1d6fc8","type":"link out","z":"40dcdbed.95c274","name":"ЗЧ Виїзд","links":["7f9b68cc.93c368","2039c89d.c40578","84650412.8eddc8"],"x":695,"y":180,"wires":[]},{"id":"2dc8481b.c01a28","type":"link out","z":"40dcdbed.95c274","name":"ЗЧ Охорона","links":["de0306a3.44eb18","c3c1173.da750e8","e3fecac1.084838","38e0f8e5.10ab38"],"x":695,"y":320,"wires":[]},{"id":"7f9b68cc.93c368","type":"link in","z":"f5b7c2df.fcf43","name":"","links":["d140e40a.1d6fc8"],"x":115,"y":20,"wires":[[]]},{"id":"e837e947.e18e78","type":"function","z":"40dcdbed.95c274","name":"Парсинг строки","func":"msg.payload = msg.payload.substring(0,7);\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":360,"wires":[["e8642214.68de","2dc8481b.c01a28"]]},{"id":"8d2750c8.13d78","type":"function","z":"40dcdbed.95c274","name":"Парсинг строки","func":"msg.payload = msg.payload.substring(0,7);\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":220,"wires":[["de6e0905.3ec5f8","d140e40a.1d6fc8"]]},{"id":"de6e0905.3ec5f8","type":"debug","z":"40dcdbed.95c274","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":220,"wires":[]},{"id":"6fa1007a.613f5","type":"function","z":"40dcdbed.95c274","name":"Парсинг строки","func":"msg.payload = msg.payload.substring(0,7);\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":80,"wires":[["71087b82.1d4b84","24499bf4.7729a4"]]},{"id":"71087b82.1d4b84","type":"debug","z":"40dcdbed.95c274","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":750,"y":80,"wires":[]},{"id":"de0306a3.44eb18","type":"link in","z":"ec08de82.9f8fc","name":"","links":["24499bf4.7729a4","2dc8481b.c01a28"],"x":140,"y":60,"wires":[[]]},{"id":"f9efb3b2.f3e1a","type":"function","z":"ec08de82.9f8fc","name":"Дані строки з NFC","func":"\nvar num_avto_r1 = msg.payload;\nvar num_avto_r2 = \"\";\n\n\nmsg.payload =\"START1;0;0;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":270,"y":60,"wires":[["ef3b48e0.93b098","55853880.338a08"]]},{"id":"55853880.338a08","type":"debug","z":"ec08de82.9f8fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":60,"wires":[]},{"id":"40ed95a.7dd506c","type":"function","z":"f5b7c2df.fcf43","name":"Дані строки з NFC","func":"\nvar num_avto_r1 = msg.payload;\nvar num_avto_r2 = \"\";\n\n\nmsg.payload =\"START1;0;0;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":290,"y":20,"wires":[["f5de37cf.190fd8"]]},{"id":"5deb1308.403dcc","type":"rpi-gpio in","z":"17b156e0.3aac29","name":"","pin":"31","intype":"down","debounce":"1000","read":false,"x":200,"y":200,"wires":[["ae90f454.dcf108"]]},{"id":"f1b693b4.613ef","type":"rpi-gpio in","z":"17b156e0.3aac29","name":"","pin":"40","intype":"down","debounce":"1000","read":false,"x":200,"y":100,"wires":[["ec96cff.b24cf3"]]},{"id":"3c58a7ac.43a128","type":"tcp in","z":"58118560.4b14cc","name":"","server":"server","host":"10.3.45.250","port":"2500","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":170,"y":100,"wires":[["fd38a4d2.ab0648"]]},{"id":"a2e60f27.2375e","type":"debug","z":"58118560.4b14cc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":100,"wires":[]},{"id":"fd38a4d2.ab0648","type":"delay","z":"58118560.4b14cc","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":370,"y":100,"wires":[["a2e60f27.2375e","bed9a4fb.40adc8"]]},{"id":"a30e037d.81cd1","type":"http in","z":"ec08de82.9f8fc","name":"","url":"/dispay1/setGreen","method":"get","upload":false,"swaggerDoc":"","x":120,"y":380,"wires":[["99330818.919488"]]},{"id":"a4da1bd0.f8a018","type":"http in","z":"ec08de82.9f8fc","name":"","url":"/display1/setRed","method":"get","upload":false,"swaggerDoc":"","x":120,"y":420,"wires":[["d130bc90.16af7"]]},{"id":"c20bd0f8.3da67","type":"inject","z":"17b156e0.3aac29","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":360,"wires":[["965692c9.2f492"]]},{"id":"965692c9.2f492","type":"exec","z":"17b156e0.3aac29","command":"cat /sys/class/gpio/gpio6/value","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"В'їзд","x":270,"y":360,"wires":[["7ac078f5.7c42e8","3cf9adeb.131762","71516403.bb7a9c"],[],[]]},{"id":"9cd8e191.6e3a6","type":"Wiegand","z":"17b156e0.3aac29","name":"","host":"21","timer":"6","x":240,"y":300,"wires":[[]]},{"id":"7ac078f5.7c42e8","type":"debug","z":"17b156e0.3aac29","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":360,"wires":[]},{"id":"8df1afa1.c5e","type":"inject","z":"17b156e0.3aac29","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":420,"wires":[["5ec7eae3.bce124"]]},{"id":"5ec7eae3.bce124","type":"exec","z":"17b156e0.3aac29","command":"cat /sys/class/gpio/gpio21/value","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Виїзд","x":270,"y":420,"wires":[["ecd01e7f.df954","a4c66598.c429c8","c560a518.6fbbf8"],[],[]]},{"id":"ecd01e7f.df954","type":"debug","z":"17b156e0.3aac29","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":420,"wires":[]},{"id":"bef50c23.3fdf4","type":"ui_button","z":"16ab13ed.699cdc","name":"","group":"e9f9a8a1.a26618","order":1,"width":0,"height":0,"passthru":true,"label":"NFC Охорона","tooltip":"","color":"","bgcolor":"","icon":"","payload":"nfc_1","payloadType":"flow","topic":"NFC Охорона","x":380,"y":500,"wires":[["825f0f87.c25","5ee786cb.4ae1f8"]]},{"id":"cfbed1a.76ca93","type":"ui_button","z":"16ab13ed.699cdc","name":"","group":"e9f9a8a1.a26618","order":3,"width":0,"height":0,"passthru":false,"label":"NFC В'їзд","tooltip":"","color":"","bgcolor":"","icon":"","payload":"nfc_2","payloadType":"flow","topic":"NFC В'їзд","x":360,"y":540,"wires":[["ab5f8111.6a6f2"]]},{"id":"ddbad782.1b2968","type":"ui_button","z":"16ab13ed.699cdc","name":"","group":"e9f9a8a1.a26618","order":5,"width":0,"height":0,"passthru":false,"label":"NFC Виїзд","tooltip":"","color":"","bgcolor":"","icon":"","payload":"nfc_3","payloadType":"flow","topic":"NFC Охорона","x":370,"y":580,"wires":[["9bf3dedf.4f37d"]]},{"id":"6fad1175.4c52b","type":"link out","z":"16ab13ed.699cdc","name":"Дані для табло 1","links":["b3fee6e8.f31788"],"x":375,"y":60,"wires":[]},{"id":"57071f01.eb759","type":"link out","z":"16ab13ed.699cdc","name":"Дані для табло 2","links":["cc3d0766.8f63f8"],"x":375,"y":100,"wires":[]},{"id":"b3fee6e8.f31788","type":"link in","z":"ec08de82.9f8fc","name":"","links":["6fad1175.4c52b"],"x":95,"y":260,"wires":[["b01a1655.ff7438"]]},{"id":"cc3d0766.8f63f8","type":"link in","z":"f5b7c2df.fcf43","name":"","links":["57071f01.eb759"],"x":55,"y":160,"wires":[["531f61d.2b6c4a"]]},{"id":"b01a1655.ff7438","type":"function","z":"ec08de82.9f8fc","name":"Дані строки з форми","func":"var num_avto_r1 = msg.payload.r1;\nvar num_avto_r2 = msg.payload.r2;\n\n\n\nmsg.payload =\"START1;0;0;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":240,"y":260,"wires":[["f210020e.e7cb7","ef3b48e0.93b098"]]},{"id":"f210020e.e7cb7","type":"debug","z":"ec08de82.9f8fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":430,"y":260,"wires":[]},{"id":"121f99e6.c29f86","type":"inject","z":"ec08de82.9f8fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":60,"y":20,"wires":[[]]},{"id":"5c540912.b20f08","type":"ui_form","z":"16ab13ed.699cdc","name":"","label":"Табло 1 IN","group":"8590abb5.5b4548","order":1,"width":0,"height":0,"options":[{"label":"Номер","value":"r1","type":"text","required":false},{"label":"Вага","value":"r2","type":"text","required":false}],"formValue":{"r1":"","r2":""},"payload":"","submit":"submit","cancel":"cancel","topic":"","x":140,"y":60,"wires":[["6fad1175.4c52b"]]},{"id":"2aa72011.9d77b","type":"ui_form","z":"16ab13ed.699cdc","name":"","label":"Табло2 OUT","group":"a759403f.19307","order":1,"width":0,"height":0,"options":[{"label":"Номер","value":"r1","type":"text","required":false},{"label":"Вага","value":"r2","type":"text","required":false}],"formValue":{"r1":"","r2":""},"payload":"","submit":"submit","cancel":"cancel","topic":"","x":150,"y":100,"wires":[["57071f01.eb759"]]},{"id":"531f61d.2b6c4a","type":"function","z":"f5b7c2df.fcf43","name":"Дані строки з форми","func":"var num_avto_r1 = msg.payload.r1;\nvar num_avto_r2 = msg.payload.r2;\n\n\n\nmsg.payload =\"START1;0;0;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":236,"y":161,"wires":[["f5de37cf.190fd8"]]},{"id":"b5724898.c39438","type":"ui_gauge","z":"16ab13ed.699cdc","name":"Вага","group":"6a5b2eb3.f08ef","order":0,"width":0,"height":0,"gtype":"gage","title":"Вага, кг","label":"units","format":"{{value}}","min":0,"max":"60000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"20000","seg2":"40000","x":330,"y":700,"wires":[]},{"id":"76d44e18.5ade9","type":"link out","z":"58118560.4b14cc","name":"scale","links":["378ee394.4cff5c"],"x":600,"y":160,"wires":[]},{"id":"bed9a4fb.40adc8","type":"function","z":"58118560.4b14cc","name":"","func":"msg.payload = global.set(\"weight\",Number(msg.payload));\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":160,"wires":[["76d44e18.5ade9"]]},{"id":"378ee394.4cff5c","type":"link in","z":"16ab13ed.699cdc","name":"scale","links":["76d44e18.5ade9"],"x":100,"y":700,"wires":[["b5724898.c39438"]]},{"id":"825f0f87.c25","type":"ui_text","z":"16ab13ed.699cdc","group":"e9f9a8a1.a26618","order":2,"width":0,"height":0,"name":"","label":"ID:","format":"{{msg.payload}}","layout":"row-spread","x":590,"y":500,"wires":[]},{"id":"ab5f8111.6a6f2","type":"ui_text","z":"16ab13ed.699cdc","group":"e9f9a8a1.a26618","order":4,"width":0,"height":0,"name":"","label":"ID:","format":"{{msg.payload}}","layout":"row-spread","x":590,"y":540,"wires":[]},{"id":"9bf3dedf.4f37d","type":"ui_text","z":"16ab13ed.699cdc","group":"e9f9a8a1.a26618","order":6,"width":0,"height":0,"name":"","label":"ID:","format":"{{msg.payload}}","layout":"row-spread","x":590,"y":580,"wires":[]},{"id":"5ee786cb.4ae1f8","type":"debug","z":"16ab13ed.699cdc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":460,"wires":[]},{"id":"c3c1173.da750e8","type":"link in","z":"16ab13ed.699cdc","name":"","links":["2dc8481b.c01a28"],"x":75,"y":480,"wires":[["42357672.d364b8","9e718b7b.d4ebf8"]]},{"id":"d7e31676.44ef28","type":"link in","z":"16ab13ed.699cdc","name":"","links":["24499bf4.7729a4"],"x":75,"y":520,"wires":[["2a6e7014.a6ee9","77775458.4edfdc"]]},{"id":"2039c89d.c40578","type":"link in","z":"16ab13ed.699cdc","name":"","links":["d140e40a.1d6fc8"],"x":75,"y":560,"wires":[["43b9c72e.a85298"]]},{"id":"42357672.d364b8","type":"function","z":"16ab13ed.699cdc","name":"1 nfc","func":"flow.set(\"nfc_1\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":480,"wires":[["825f0f87.c25"]]},{"id":"2a6e7014.a6ee9","type":"function","z":"16ab13ed.699cdc","name":"2 nfc","func":"flow.set(\"nfc_2\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":520,"wires":[["ab5f8111.6a6f2"]]},{"id":"43b9c72e.a85298","type":"function","z":"16ab13ed.699cdc","name":"3 nfc","func":"flow.set(\"nfc_3\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":560,"wires":[["9bf3dedf.4f37d"]]},{"id":"3cf9adeb.131762","type":"link out","z":"17b156e0.3aac29","name":"Периметр в'їзд","links":["92c2bcb9.503b6","c7693f9.7ef73c"],"x":515,"y":320,"wires":[]},{"id":"a4c66598.c429c8","type":"link out","z":"17b156e0.3aac29","name":"Периметр виїзд","links":["c6ac85cf.2584f8","41192ee0.1c066"],"x":515,"y":460,"wires":[]},{"id":"92c2bcb9.503b6","type":"link in","z":"16ab13ed.699cdc","name":"","links":["3cf9adeb.131762"],"x":95,"y":800,"wires":[["a0f27b71.1cf038"]]},{"id":"c6ac85cf.2584f8","type":"link in","z":"16ab13ed.699cdc","name":"","links":["a4c66598.c429c8"],"x":95,"y":840,"wires":[["3606970b.006e48"]]},{"id":"38f0b3d5.d4a62c","type":"ui_text","z":"16ab13ed.699cdc","group":"455cc101.994c1","order":2,"width":0,"height":0,"name":"","label":"Статус в'їзд","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":800,"wires":[]},{"id":"2ce793a9.e01cec","type":"ui_text","z":"16ab13ed.699cdc","group":"455cc101.994c1","order":1,"width":0,"height":0,"name":"","label":"Статус виїзд","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":840,"wires":[]},{"id":"a0f27b71.1cf038","type":"function","z":"16ab13ed.699cdc","name":"","func":"if(msg.payload == 1){\n    msg.payload = \"В нормі\"\n}else{\n    msg.payload = \"Порушений\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":800,"wires":[["38f0b3d5.d4a62c"]]},{"id":"3606970b.006e48","type":"function","z":"16ab13ed.699cdc","name":"","func":"if(msg.payload == 1){\n    msg.payload = \"В нормі\"\n}else{\n    msg.payload = \"Порушений\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":840,"wires":[["2ce793a9.e01cec"]]},{"id":"58c254a5.da832c","type":"ui_button","z":"16ab13ed.699cdc","name":"","group":"e9f9a8a1.a26618","order":7,"width":0,"height":0,"passthru":false,"label":"Зважування завершене","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":290,"y":640,"wires":[["bf60e2d1.97ab1"]]},{"id":"bf60e2d1.97ab1","type":"function","z":"16ab13ed.699cdc","name":"","func":"msg.payload = \"\";\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":640,"wires":[["825f0f87.c25","ab5f8111.6a6f2","9bf3dedf.4f37d"]]},{"id":"111213b.239acec","type":"http response","z":"ec08de82.9f8fc","name":"","statusCode":"","headers":{},"x":630,"y":380,"wires":[]},{"id":"d7952c4.0e479d","type":"http response","z":"ec08de82.9f8fc","name":"","statusCode":"","headers":{},"x":630,"y":420,"wires":[]},{"id":"9e718b7b.d4ebf8","type":"debug","z":"16ab13ed.699cdc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":230,"y":420,"wires":[]},{"id":"77775458.4edfdc","type":"debug","z":"16ab13ed.699cdc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":430,"y":420,"wires":[]},{"id":"b8c748b1.f1f4b8","type":"http in","z":"8240f32a.64e8d","name":"","url":"/api/platform/setAccessTable","method":"post","upload":false,"swaggerDoc":"","x":180,"y":240,"wires":[["a27c4f6.e4a65b","6977f44f.754c3c"]]},{"id":"a27c4f6.e4a65b","type":"function","z":"8240f32a.64e8d","name":"set Access Table","func":"// var accessTable = [exampleAcess];\n// var exampleAcess = {\n//     \"pointID\":\"35235325325235\"\n//     \"ip\":\"10.3.5.210\",\n//     \"antennaID\":\"1\",\n//     \"direction\":0,\n//     \"tags\":[\"124124\",\"3525235\"],\n//     \"gpo\":['80','00'],\n//      \"marked\":false\n// }\n\nflow.set('accessTable',msg.payload);\nflow.set('accessTableUpdate',new Date());\nmsg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":240,"wires":[["38399916.7a5ea6"]]},{"id":"38399916.7a5ea6","type":"http response","z":"8240f32a.64e8d","name":"","x":630,"y":240,"wires":[]},{"id":"670f64aa.bb312c","type":"inject","z":"8240f32a.64e8d","name":"init","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":90,"y":40,"wires":[["9869dd8f.25b58"]]},{"id":"9869dd8f.25b58","type":"function","z":"8240f32a.64e8d","name":"NFC conf","func":"//040300000012000001dd0000db0007000280 - 02 GPO index, 80 or 00 - on/off\nflow.set('accessTable',[]);\n//timeout for delay to getting infrared state, ms\nflow.set('infraredtimeout',5000);\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":40,"wires":[["edd8e25e.51f26"]]},{"id":"bfbabe81.f935a","type":"function","z":"8240f32a.64e8d","name":"get row from Access Table","func":"var aT = flow.get('accessTable');\nvar aTDate = flow.get('accessTableUpdate');\nvar nowDate = Date();\nvar diff = flow.get('actualDiff');\n\nmsg.do = true;\n//if access table is not actual\nif (nowDate-aTDate > diff){\n    msg.do = false;\n}else{\nfor (var i = 0; i < aT.length; i++){\n    if ((aT[i].ip === msg.ip)&&(Number(aT[i].antenna)===msg.tag.antennaID) && (aT[i].tags.indexOf(msg.tag.tagID) >= 0)&&!(aT[i].done)){\n        msg.accessTable = aT[i];\n        msg.aTLength = aT.length;\n        if ((aT[i].pointID != \"Неопределенно\")){\n            aT[i].done = true;\n        }\n        break;\n     }\n}\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":340,"wires":[["4b64697d.781288"]]},{"id":"4088a2cf.771b5c","type":"function","z":"8240f32a.64e8d","name":"get IP","func":"\nmsg.tagID = msg.payload;\nmsg.tag   = {\"tagID\":msg.payload};\nmsg.antennaID = msg.antennaID;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":340,"wires":[["bfbabe81.f935a","be80fb0e.263628"]]},{"id":"bbb0caa8.bfd318","type":"http in","z":"8240f32a.64e8d","name":"","url":"/api/platform/getReaderConfig","method":"get","upload":false,"swaggerDoc":"","x":180,"y":600,"wires":[["bfe70c93.012bd","2cff98e5.1b45f8"]]},{"id":"ff0397a0.441f58","type":"http response","z":"8240f32a.64e8d","name":"","x":630,"y":600,"wires":[]},{"id":"6f98fc09.6f9694","type":"http in","z":"8240f32a.64e8d","name":"","url":"/api/platform/setDefaultTable","method":"post","upload":false,"swaggerDoc":"","x":180,"y":280,"wires":[["6f7f4933.e32778"]]},{"id":"6f7f4933.e32778","type":"function","z":"8240f32a.64e8d","name":"set default Table","func":"// var accessTable = [];\n// var exampleAcess = {\n//     \"ip\":\"10.3.5.210\",\n//     \"port\":5084,\n//     \"gpo\":['0180','0200']\n// }\n\nflow.set('accessTable',msg.payload);\nmsg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":280,"wires":[["1d0fcc3c.b3e304"]]},{"id":"1d0fcc3c.b3e304","type":"http response","z":"8240f32a.64e8d","name":"","x":630,"y":280,"wires":[]},{"id":"53928169.278e3","type":"function","z":"8240f32a.64e8d","name":"FRONT","func":"msg.ip = \"NFC_front\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"x":220,"y":360,"wires":[["4088a2cf.771b5c"]]},{"id":"b251f021.4f29b","type":"function","z":"8240f32a.64e8d","name":"IN","func":"msg.ip = \"NFC_in\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":400,"wires":[["4088a2cf.771b5c"]]},{"id":"c745a69f.4a3578","type":"function","z":"8240f32a.64e8d","name":"OUT","func":"msg.ip = \"NFC_out\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":440,"wires":[["4088a2cf.771b5c"]]},{"id":"1d1483d7.fffdec","type":"http in","z":"8240f32a.64e8d","name":"","url":"/api/platform/setReaderConfig","method":"post","upload":false,"swaggerDoc":"","x":660,"y":40,"wires":[["18502db0.5e20c2","18230c7f.b4def4","d2fff1c5.38f77"]]},{"id":"18502db0.5e20c2","type":"http response","z":"8240f32a.64e8d","name":"","x":910,"y":100,"wires":[]},{"id":"927b1d94.09847","type":"inject","z":"8240f32a.64e8d","name":"","topic":"","payload":"puller","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":"","x":100,"y":780,"wires":[["451445f3.85d95c"]]},{"id":"4b64697d.781288","type":"switch","z":"8240f32a.64e8d","name":"","property":"do","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":890,"y":340,"wires":[[]]},{"id":"f9f6318f.8e7c1","type":"inject","z":"8240f32a.64e8d","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":93.5,"y":840,"wires":[["27289cbd.f8d254"]]},{"id":"27289cbd.f8d254","type":"function","z":"8240f32a.64e8d","name":"get row from Access Table","func":"var aT = flow.get('accessTable');\nvar aTDate = flow.get('accessTableUpdate');\nvar nowDate = Date();\nvar diff = 2000;\n\nmsg.do = true;\n//if access table is not actual\nif (nowDate-aTDate > diff){\n    msg.do = false;\n}else{\nfor (var i = 0; i < aT.length; i++){\n    if ((aT[i].ip === msg.ip)&&Number(aT[i].antenna)===msg.tag.antennaID){\n        msg.accessTable = aT[i];\n        msg.aTLength = aT.length;\n        break;\n     }\n}\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":294,"y":840,"wires":[["451445f3.85d95c"]]},{"id":"1df745e.487f1ba","type":"function","z":"8240f32a.64e8d","name":"send to 1C","func":"msg.url = flow.get('host1C');\nmsg.tag.lastSeenTimestampUTC = new Date();\nmsg.tag.ip = msg.ip;\nmsg.tag.antenna = String(msg.antennaID);\nmsg.tag.antennaID = String(msg.antennaID);\nmsg.tag.direction = 'IN';\nmsg.tag.weight = JSON.parse(msg.payload);\n\nmsg.payload = [msg.tag];\n\nreturn msg;","outputs":1,"noerr":0,"x":1730,"y":500,"wires":[["c31812f5.3954"]]},{"id":"c31812f5.3954","type":"http request","z":"8240f32a.64e8d","name":"to 1C","method":"POST","ret":"txt","url":"","tls":"","x":1890,"y":500,"wires":[["7784dfd6.ca5a4"]]},{"id":"edd8e25e.51f26","type":"function","z":"8240f32a.64e8d","name":"1C conf","func":"//var host1C = \"http://s-app-mir-test/rfid_mir_test/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\n//var host1C = \"http://s-app-yag-test/UE_yag/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\nvar host1C = \"http://10.3.45.251/UE_yag/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\n\nflow.set('host1C',host1C);\nflow.set('actualDiff',86900); //сколько секунда таблица доступа актуальна\nmsg.url = host1C;\nflow.set('puller',[]);\nflow.set('puller_timeout_sec',120);\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":40,"wires":[["6a63f3c2.3cc6ec"]]},{"id":"18230c7f.b4def4","type":"function","z":"8240f32a.64e8d","name":"","func":"msg.payload.ip = msg.req.query.rfidID;\nmsg.payload.event_name = \"Отправка команды\";\nmsg.payload.event_desc = msg.payload.event_name+\" \"+msg.payload.ip+\" \"+msg.payload.cmd;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":20,"wires":[[]]},{"id":"6a63f3c2.3cc6ec","type":"http request","z":"8240f32a.64e8d","name":"","method":"GET","ret":"txt","url":"","tls":"","x":350,"y":140,"wires":[["c288bcf5.1a0ac"]]},{"id":"c288bcf5.1a0ac","type":"function","z":"8240f32a.64e8d","name":"set Access Table","func":"flow.set('accessTable',JSON.parse(msg.payload));\nflow.set('accessTableUpdate',new Date());\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":140,"wires":[[]]},{"id":"be80fb0e.263628","type":"function","z":"8240f32a.64e8d","name":"Filling Puller","func":"var puller = flow.get('puller');\nvar puller_timeout_sec = flow.get('puller_timeout_sec');\nvar current_element = {\n    'ip':msg.ip,\n    'tagID':msg.tagID,\n    'antennaID':msg.tag.antennaID,\n    'lastSeenTimestampUTC':new Date()\n}\nvar pull = true;\nvar finded = false\nfor (var i = 0; i < puller.length; i++){\n    var element = puller[i];\n    if ((element.ip === current_element.ip)&&(element.tagID===current_element.tagID)&&(element.antennaID===current_element.antennaID)){\n        var diff = (current_element.lastSeenTimestampUTC-element.lastSeenTimestampUTC)*1000;\n        if (diff < puller_timeout_sec){\n            pull = false; \n        }else{\n            puller[i]=current_element;\n        }\n        finded = true;\n    }\n}\nif (!finded){\n    puller.push(current_element);\n}\n\nflow.set('puller',puller);\nmsg.pull = pull;\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":500,"wires":[["e5fe751.8cbae88"]]},{"id":"e5fe751.8cbae88","type":"switch","z":"8240f32a.64e8d","name":"","property":"pull","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":750,"y":500,"wires":[["fc634e06.1ab9f","2f7d1420.5b0cdc"]]},{"id":"451445f3.85d95c","type":"debug","z":"8240f32a.64e8d","name":"","active":true,"console":"false","complete":"false","x":490,"y":780,"wires":[]},{"id":"e3fecac1.084838","type":"link in","z":"8240f32a.64e8d","name":"","links":["2dc8481b.c01a28"],"x":75,"y":360,"wires":[["53928169.278e3","97d60ede.b4fb7"]]},{"id":"6e922916.48a198","type":"link in","z":"8240f32a.64e8d","name":"","links":["24499bf4.7729a4"],"x":75,"y":400,"wires":[["b251f021.4f29b","97d60ede.b4fb7"]]},{"id":"84650412.8eddc8","type":"link in","z":"8240f32a.64e8d","name":"","links":["d140e40a.1d6fc8"],"x":75,"y":440,"wires":[["c745a69f.4a3578","97d60ede.b4fb7"]]},{"id":"97d60ede.b4fb7","type":"debug","z":"8240f32a.64e8d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":170,"y":320,"wires":[]},{"id":"71516403.bb7a9c","type":"function","z":"17b156e0.3aac29","name":"infrared state 1","func":"global.set('infraredstate1',msg.payload);\nglobal.set('infraredstate1Date', new Date());\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":280,"wires":[[]]},{"id":"c560a518.6fbbf8","type":"function","z":"17b156e0.3aac29","name":"infrared state 2","func":"global.set('infraredstate2Date', new Date());\nglobal.set('infraredstate2', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":500,"wires":[[]]},{"id":"bfe70c93.012bd","type":"function","z":"8240f32a.64e8d","name":"check infrared state","func":"var payload = {\n    'infraredstate1':0,\n    'infraredstate2':0\n}\nvar infraredtimeout = flow.get('infraredtimeout');\nvar cDate = new Date();\nif ((cDate - global.get('infraredstate1Date')) < infraredtimeout){\n    payload.infraredstate1 = global.get('infraredstate1') ;   \n}\n\nif ((cDate - global.get('infraredstate2Date')) < infraredtimeout){\n    payload.infraredstate2 = global.get('infraredstate2') ;   \n}\n\nmsg.payload = {\"infraredstate\":payload.infraredstate1 == 1 && payload.infraredstate1 == 2};\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":600,"wires":[["ff0397a0.441f58"]]},{"id":"2cff98e5.1b45f8","type":"debug","z":"8240f32a.64e8d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":400,"y":520,"wires":[]},{"id":"6977f44f.754c3c","type":"debug","z":"8240f32a.64e8d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":450,"y":200,"wires":[]},{"id":"83dda67a.b59358","type":"ui_button","z":"16ab13ed.699cdc","name":"","group":"8590abb5.5b4548","order":1,"width":0,"height":0,"passthru":true,"label":"Зелений","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":140,"y":140,"wires":[["f95d1749.87e708"]]},{"id":"6f99a3ca.c99e5c","type":"ui_button","z":"16ab13ed.699cdc","name":"","group":"8590abb5.5b4548","order":1,"width":0,"height":0,"passthru":true,"label":"Червоний","tooltip":"","color":"","bgcolor":"red","icon":"","payload":"","payloadType":"date","topic":"","x":140,"y":180,"wires":[["8a76d757.ccee78"]]},{"id":"f95d1749.87e708","type":"link out","z":"16ab13ed.699cdc","name":"Зелений Т1","links":["1f95baf4.180d55"],"x":255,"y":140,"wires":[]},{"id":"8a76d757.ccee78","type":"link out","z":"16ab13ed.699cdc","name":"Чероний Т1","links":["3b5651f6.753dde"],"x":255,"y":180,"wires":[]},{"id":"1f95baf4.180d55","type":"link in","z":"ec08de82.9f8fc","name":"table_in_green","links":["c799557e.2e76b8","f95d1749.87e708","fd3236dd.6025f8"],"x":200,"y":340,"wires":[["99330818.919488","cb2cf6cb.633918"]]},{"id":"3b5651f6.753dde","type":"link in","z":"ec08de82.9f8fc","name":"table_in_red","links":["3c3bae72.7db8b2","8a76d757.ccee78","ac989baf.1ca518","bcb8ccec.c50b9"],"x":195,"y":460,"wires":[["d130bc90.16af7","cb2cf6cb.633918"]]},{"id":"c5070c2f.76ab","type":"ui_button","z":"16ab13ed.699cdc","name":"","group":"a759403f.19307","order":1,"width":0,"height":0,"passthru":true,"label":"Зелений","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":500,"y":140,"wires":[["c799557e.2e76b8"]]},{"id":"bc656dc7.7f5cf","type":"ui_button","z":"16ab13ed.699cdc","name":"","group":"a759403f.19307","order":1,"width":0,"height":0,"passthru":true,"label":"Червоний","tooltip":"","color":"","bgcolor":"red","icon":"","payload":"","payloadType":"date","topic":"","x":500,"y":180,"wires":[["ac989baf.1ca518"]]},{"id":"c799557e.2e76b8","type":"link out","z":"16ab13ed.699cdc","name":"Зелений Т2","links":["1f95baf4.180d55","a0fb2f4c.029dc"],"x":615,"y":140,"wires":[]},{"id":"ac989baf.1ca518","type":"link out","z":"16ab13ed.699cdc","name":"Чероний Т2","links":["3b5651f6.753dde","a622d9c1.240fb8"],"x":615,"y":180,"wires":[]},{"id":"a0fb2f4c.029dc","type":"link in","z":"f5b7c2df.fcf43","name":"table_out_green","links":["c799557e.2e76b8","7554c058.eda19"],"x":55,"y":360,"wires":[["cfd960ba.7a694"]]},{"id":"a622d9c1.240fb8","type":"link in","z":"f5b7c2df.fcf43","name":"table_out_red","links":["ac989baf.1ca518","94cfe2ce.f011e"],"x":135,"y":380,"wires":[["f17f2e38.d77b7"]]},{"id":"7784dfd6.ca5a4","type":"debug","z":"8240f32a.64e8d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2070,"y":500,"wires":[]},{"id":"11735989.86d496","type":"ui_button","z":"16ab13ed.699cdc","name":"","group":"8590abb5.5b4548","order":1,"width":0,"height":0,"passthru":true,"label":"Погасити","tooltip":"","color":"","bgcolor":"gray","icon":"","payload":"","payloadType":"date","topic":"","x":140,"y":220,"wires":[["3c3bae72.7db8b2"]]},{"id":"3c3bae72.7db8b2","type":"link out","z":"16ab13ed.699cdc","name":" погасити Т1","links":["3b5651f6.753dde","4a0d3a20.552444"],"x":255,"y":220,"wires":[]},{"id":"e49312df.baa15","type":"ui_button","z":"16ab13ed.699cdc","name":"","group":"a759403f.19307","order":1,"width":0,"height":0,"passthru":true,"label":"Погасити","tooltip":"","color":"","bgcolor":"gray","icon":"","payload":"","payloadType":"date","topic":"","x":500,"y":220,"wires":[["c33d5543.a961f8"]]},{"id":"c33d5543.a961f8","type":"link out","z":"16ab13ed.699cdc","name":" погасити Т2","links":["bb00b17f.9f733"],"x":615,"y":220,"wires":[]},{"id":"bb00b17f.9f733","type":"link in","z":"f5b7c2df.fcf43","name":"","links":["c33d5543.a961f8"],"x":140,"y":420,"wires":[["5653fd8a.bcd734"]]},{"id":"4a0d3a20.552444","type":"link in","z":"ec08de82.9f8fc","name":"","links":["3c3bae72.7db8b2"],"x":195,"y":500,"wires":[["754a65fb.20f4ac"]]},{"id":"982cc711.70f6e8","type":"switch","z":"8240f32a.64e8d","name":"board_in_out","property":"ip","propertyType":"msg","rules":[{"t":"eq","v":"board_in","vt":"str"},{"t":"eq","v":"board_out","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1070,"y":180,"wires":[["ea10be78.65eb8"],["67337a85.f350f4"]]},{"id":"fd3236dd.6025f8","type":"link out","z":"8240f32a.64e8d","name":"","links":["1f95baf4.180d55"],"x":1335,"y":80,"wires":[]},{"id":"ea10be78.65eb8","type":"switch","z":"8240f32a.64e8d","name":"green/red","property":"cmd","propertyType":"msg","rules":[{"t":"eq","v":"0100","vt":"str"},{"t":"eq","v":"0180","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1200,"y":100,"wires":[["fd3236dd.6025f8"],["bcb8ccec.c50b9"]]},{"id":"67337a85.f350f4","type":"switch","z":"8240f32a.64e8d","name":"green/red","property":"cmd","propertyType":"msg","rules":[{"t":"eq","v":"0100","vt":"str"},{"t":"eq","v":"0180","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1220,"y":240,"wires":[["7554c058.eda19"],["94cfe2ce.f011e"]]},{"id":"bcb8ccec.c50b9","type":"link out","z":"8240f32a.64e8d","name":"","links":["3b5651f6.753dde"],"x":1335,"y":120,"wires":[]},{"id":"7554c058.eda19","type":"link out","z":"8240f32a.64e8d","name":"","links":["a0fb2f4c.029dc"],"x":1335,"y":220,"wires":[]},{"id":"94cfe2ce.f011e","type":"link out","z":"8240f32a.64e8d","name":"","links":["a622d9c1.240fb8"],"x":1335,"y":260,"wires":[]},{"id":"fc634e06.1ab9f","type":"function","z":"8240f32a.64e8d","name":"send truck number to board","func":"var ChannelNumber = null;\nvar Type = null;\nvar truck1 = 'не визначено';\nvar truck2 = 'не визначено';\nmsg.finded = false;\n// if((msg.ip === '10.3.5.210')&&(msg.antennaID==1)){\n//     //въезд КПП 1\n//     ChannelNumber = 5;\n//     Type = 'TruckIn';\n// }else if ((msg.ip === '10.3.5.216')&&(msg.antennaID==1)){\n//     //въезд КПП 2\n//     ChannelNumber = 7;\n//     Type = 'TruckIn';\n// }else if ((msg.ip === '10.3.5.210')&&(msg.antennaID==2)){\n//     //выезд КПП 1\n//     ChannelNumber = 5;\n//     Type = 'TruckOut';\n// }else if ((msg.ip === '10.3.5.216')&&(msg.antennaID==2)){\n//     //выезд КПП 2\n//     ChannelNumber = 7;\n//     Type = 'TruckOut';\n// }\n\nmsg.ChannelNumber = ChannelNumber;\nmsg.Type = Type;\nvar aT = flow.get('accessTable');\nfor (var i = 0; i < aT.length; i++){\n    var tags_data = aT[i].tags_data;\n    for (var j = 0; j < tags_data.length; j++){\n        if (tags_data[j].tag === msg.tagID){\n            truck1 = tags_data[j].truck_number;\n            truck2 = tags_data[j].truck_number2;\n            msg.finded = true;\n        }        \n    }\n}\nmsg.truck1 = truck1;\nmsg.truck2 = truck2;\n\n// msg.payload = {\"truck1\": truck1, \n//                 \"ObjectID\": \"1001\", \n//                 \"truck2\": truck2,\n//                 \"Value\": \"test\",\n//                 \"ChannelNumber\": ChannelNumber, \n//                 \"Type\": Type};\nreturn msg;","outputs":1,"noerr":0,"x":960,"y":380,"wires":[[]]},{"id":"2f8ce0ff.e7177","type":"link in","z":"ec08de82.9f8fc","name":"rfid truck 1 table 1","links":["46f16a9d.111e54"],"x":95,"y":220,"wires":[["40b0706d.7c9d4"]]},{"id":"40b0706d.7c9d4","type":"function","z":"ec08de82.9f8fc","name":"Дані строки з NFC","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":230,"y":220,"wires":[["ef3b48e0.93b098","2d3883b4.3c277c"]]},{"id":"46f16a9d.111e54","type":"link out","z":"8240f32a.64e8d","name":"RFID 1C","links":["2f8ce0ff.e7177","c5ee7c46.e8575"],"x":1195,"y":380,"wires":[]},{"id":"c5ee7c46.e8575","type":"link in","z":"f5b7c2df.fcf43","name":"rfid truck 1 table 2","links":["46f16a9d.111e54"],"x":55,"y":220,"wires":[["93ad19b6.413138"]]},{"id":"93ad19b6.413138","type":"function","z":"f5b7c2df.fcf43","name":"Дані строки з NFC","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":210,"y":220,"wires":[["f5de37cf.190fd8","85a03ac6.b363f8"]]},{"id":"2d3883b4.3c277c","type":"switch","z":"ec08de82.9f8fc","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"finded","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":220,"wires":[["d130bc90.16af7"]]},{"id":"85a03ac6.b363f8","type":"switch","z":"f5b7c2df.fcf43","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"finded","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":710,"y":260,"wires":[["f17f2e38.d77b7"]]},{"id":"3591ed0f.20a192","type":"debug","z":"8240f32a.64e8d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":860,"y":200,"wires":[]},{"id":"cb2cf6cb.633918","type":"debug","z":"ec08de82.9f8fc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":840,"y":280,"wires":[]},{"id":"d2fff1c5.38f77","type":"function","z":"8240f32a.64e8d","name":"","func":"msg.ip      = msg.req.query.rfidID;\nmsg.cmd     = msg.payload.cmd;\nreturn msg;","outputs":"1","noerr":0,"x":910,"y":60,"wires":[["982cc711.70f6e8","3591ed0f.20a192"]]},{"id":"2f68e665.491b7a","type":"http in","z":"8240f32a.64e8d","name":"","url":"/api/platform/setBoardText","method":"post","upload":false,"swaggerDoc":"","x":150,"y":680,"wires":[["af2915ed.cb57f8"]]},{"id":"af2915ed.cb57f8","type":"function","z":"8240f32a.64e8d","name":"get boarad ID","func":"msg.ip      = msg.req.query.boardID;\nreturn msg;","outputs":"1","noerr":0,"x":400,"y":680,"wires":[["394b308.a66c4d","890d55b5.38ecd8"]]},{"id":"394b308.a66c4d","type":"switch","z":"8240f32a.64e8d","name":"board_in_out","property":"ip","propertyType":"msg","rules":[{"t":"eq","v":"board_in","vt":"str"},{"t":"eq","v":"board_out","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":680,"wires":[["28bd5b55.dee084"],["75659f9c.4d943"]]},{"id":"a12d48be.da69c8","type":"function","z":"ec08de82.9f8fc","name":"Дані строки з 1C","func":"msg.payload =\"START1;0;0;1;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":830,"y":200,"wires":[["ef3b48e0.93b098"]]},{"id":"2cbfc58e.c4996a","type":"link in","z":"ec08de82.9f8fc","name":"1C to Board 1","links":["28bd5b55.dee084"],"x":695,"y":200,"wires":[["a12d48be.da69c8"]]},{"id":"28bd5b55.dee084","type":"link out","z":"8240f32a.64e8d","name":"1c to Board 1 (rest)","links":["2cbfc58e.c4996a"],"x":735,"y":640,"wires":[]},{"id":"75659f9c.4d943","type":"link out","z":"8240f32a.64e8d","name":"1c to Board 2 (rest)","links":["5ff6eb49.f272b4"],"x":735,"y":700,"wires":[]},{"id":"eed8b4c8.2f1208","type":"function","z":"f5b7c2df.fcf43","name":"Дані строки з 1C","func":"msg.payload =\"START1;0;0;1;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":830,"y":180,"wires":[["f5de37cf.190fd8"]]},{"id":"5ff6eb49.f272b4","type":"link in","z":"f5b7c2df.fcf43","name":"1C to board 2","links":["75659f9c.4d943"],"x":695,"y":180,"wires":[["eed8b4c8.2f1208"]]},{"id":"890d55b5.38ecd8","type":"http response","z":"8240f32a.64e8d","name":"","statusCode":"","headers":{},"x":590,"y":720,"wires":[]},{"id":"1b21c769.ee2b09","type":"http request","z":"8240f32a.64e8d","name":"","method":"POST","ret":"txt","url":"http://10.3.45.250:4000/auth/login","tls":"","x":1170,"y":500,"wires":[["88225e85.1edce"]]},{"id":"2f7d1420.5b0cdc","type":"function","z":"8240f32a.64e8d","name":"Авторизация на весах","func":"msg.payload = {\n    \"username\":\"user\", \n    \"password\":\"user\"\n}\nmsg.headers = {\n    \"Content-Type\":\"application/json\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":970,"y":500,"wires":[["1b21c769.ee2b09"]]},{"id":"88225e85.1edce","type":"function","z":"8240f32a.64e8d","name":"Получаем токен","func":"var payload = JSON.parse(msg.payload);\nmsg.headers = {\n    \"token\":payload.token\n}\nreturn msg;","outputs":1,"noerr":0,"x":1350,"y":500,"wires":[["de215ea7.0c2e7"]]},{"id":"de215ea7.0c2e7","type":"http request","z":"8240f32a.64e8d","name":"","method":"GET","ret":"txt","url":"http://10.3.45.250:4000/api/platform/yag_avto2/getWeight/status","tls":"","x":1550,"y":500,"wires":[["1df745e.487f1ba"]]}]
