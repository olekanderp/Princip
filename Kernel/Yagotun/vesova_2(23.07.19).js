[{"id":"413320aa.6d7e6","type":"tab","label":"RFID UHF"},{"id":"f45c3419.e74828","type":"tab","label":"1_Табло 1 (СТ 1 і 2)","disabled":false,"info":""},{"id":"d5e6d634.8c2198","type":"tab","label":"Зчитувач_1","disabled":false,"info":""},{"id":"cb4b1015.765ba","type":"tab","label":"Периметр_1","disabled":false,"info":""},{"id":"1adcf522.c0ee0b","type":"tab","label":"Ваги_1","disabled":false,"info":""},{"id":"ff818cbc.32d49","type":"tab","label":"Dashboard_1","disabled":false,"info":""},{"id":"5da0322.c98b9cc","type":"tab","label":"FTP","disabled":false,"info":""},{"id":"9410a531.9205c8","type":"subflow","name":"ETTN","info":"","in":[],"out":[]},{"id":"46a7b027.f1634","type":"subflow","name":"Subflow 1","info":"","in":[],"out":[]},{"id":"5df4d31f.2969ac","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#007ace","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#0e1b6a","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#007ace","edited":true},"page-titlebar-backgroundColor":{"value":"#007ace","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1ba2ff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#007ace","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"9a1aff02.f908","type":"ui_group","z":"","name":"Зчитувачі","tab":"40d1d88.c297728","order":5,"disp":true,"width":"6","collapse":false},{"id":"40d1d88.c297728","type":"ui_tab","z":"","name":"Monitoring","icon":"dashboard","disabled":false,"hidden":false},{"id":"9661ee11.56254","type":"ui_group","z":"","name":"Вага","tab":"40d1d88.c297728","order":6,"disp":true,"width":"6","collapse":false},{"id":"467937a8.e4a118","type":"ui_group","z":"","name":"Периметр","tab":"40d1d88.c297728","order":7,"disp":true,"width":"5","collapse":false},{"id":"a14246ce.0a0208","type":"ui_group","z":"","name":"Табло 1 IN Сторона 0","tab":"40d1d88.c297728","order":1,"disp":true,"width":"6","collapse":false},{"id":"a21bdbd5.aec148","type":"ftp","z":"","host":"10.3.45.250","port":"21","secureOptions":"","user":"sa.palanyuk","connTimeout":"","pasvTimeout":"","keepalive":""},{"id":"fd989333.7e972","type":"serial-port","z":"","serialport":"/dev/a_rfid_1","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","waitfor":"","newline":"200","bin":"bin","out":"time","addchar":"","responsetimeout":"10000"},{"id":"28ace721.cab2c8","type":"serial-port","z":"","serialport":"/dev/a_rfid_2","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","waitfor":"","newline":"200","bin":"bin","out":"time","addchar":"","responsetimeout":"10000"},{"id":"34c77367.4742bc","type":"comment","z":"cb4b1015.765ba","name":"Виїзд Init","info":"","x":200,"y":40,"wires":[]},{"id":"862dc2ae.55bc6","type":"comment","z":"cb4b1015.765ba","name":"1 Не пересічено: 0 Пересічено","info":"","x":410,"y":40,"wires":[]},{"id":"dc0c9c03.38748","type":"tcp in","z":"1adcf522.c0ee0b","name":"","server":"server","host":"10.3.45.250","port":"2500","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":170,"y":100,"wires":[["273eb4a6.87391c"]]},{"id":"a9e52993.1eb5f8","type":"debug","z":"1adcf522.c0ee0b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":100,"wires":[]},{"id":"273eb4a6.87391c","type":"delay","z":"1adcf522.c0ee0b","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":370,"y":100,"wires":[["a9e52993.1eb5f8","c94204d.94108f8","d1650abc.305fa8"]]},{"id":"c0003100.91b14","type":"ui_button","z":"ff818cbc.32d49","name":"","group":"9a1aff02.f908","order":1,"width":0,"height":0,"passthru":true,"label":"NFC Охорона","tooltip":"","color":"","bgcolor":"","icon":"","payload":"nfc_1","payloadType":"flow","topic":"NFC Охорона","x":380,"y":500,"wires":[["c68c918b.c1c98","3bb176b1.21164a"]]},{"id":"205a7e.e9fb3582","type":"ui_button","z":"ff818cbc.32d49","name":"","group":"9a1aff02.f908","order":5,"width":0,"height":0,"passthru":false,"label":"NFC Виїзд","tooltip":"","color":"","bgcolor":"","icon":"","payload":"nfc_3","payloadType":"flow","topic":"NFC Охорона","x":370,"y":580,"wires":[["6a5dbd4a.bd4794"]]},{"id":"c39206d0.79e9c8","type":"ui_form","z":"ff818cbc.32d49","name":"","label":"Табло 1 IN Сторона 0 (До вагів)","group":"a14246ce.0a0208","order":1,"width":0,"height":0,"options":[{"label":"Номер","value":"r1","type":"text","required":false},{"label":"Вага","value":"r2","type":"text","required":false}],"formValue":{"r1":"","r2":""},"payload":"","submit":"submit","cancel":"cancel","topic":"","x":150,"y":160,"wires":[["642c6f73.79d56"]]},{"id":"5f3ea18e.1a1d3","type":"ui_gauge","z":"ff818cbc.32d49","name":"Вага","group":"9661ee11.56254","order":0,"width":0,"height":0,"gtype":"gage","title":"Вага, кг","label":"units","format":"{{value}}","min":0,"max":"60000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"20000","seg2":"40000","x":330,"y":700,"wires":[]},{"id":"75fac6e2.324c48","type":"link out","z":"1adcf522.c0ee0b","name":"scale","links":["b29ba998.384b68"],"x":600,"y":160,"wires":[]},{"id":"c94204d.94108f8","type":"function","z":"1adcf522.c0ee0b","name":"","func":"msg.payload = global.set(\"weight\",Number(msg.payload));\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":160,"wires":[["75fac6e2.324c48"]]},{"id":"b29ba998.384b68","type":"link in","z":"ff818cbc.32d49","name":"scale","links":["75fac6e2.324c48"],"x":100,"y":700,"wires":[["5f3ea18e.1a1d3"]]},{"id":"c68c918b.c1c98","type":"ui_text","z":"ff818cbc.32d49","group":"9a1aff02.f908","order":2,"width":0,"height":0,"name":"","label":"ID:","format":"{{msg.payload}}","layout":"row-spread","x":590,"y":500,"wires":[]},{"id":"6a5dbd4a.bd4794","type":"ui_text","z":"ff818cbc.32d49","group":"9a1aff02.f908","order":6,"width":0,"height":0,"name":"","label":"ID:","format":"{{msg.payload}}","layout":"row-spread","x":590,"y":580,"wires":[]},{"id":"3bb176b1.21164a","type":"debug","z":"ff818cbc.32d49","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":460,"wires":[]},{"id":"428abc27.8a3384","type":"link in","z":"ff818cbc.32d49","name":"","links":["262c8bf1.0737c4","4ab25b0b.77dab4","a9618fb.830527"],"x":75,"y":480,"wires":[["b0228fdc.96085","55ff5103.d4b22"]]},{"id":"f37d6e39.237f5","type":"link in","z":"ff818cbc.32d49","name":"","links":["dad39117.a9626"],"x":75,"y":560,"wires":[["5767bc6e.83d904"]]},{"id":"b0228fdc.96085","type":"function","z":"ff818cbc.32d49","name":"1 nfc","func":"flow.set(\"nfc_1\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":480,"wires":[["c68c918b.c1c98"]]},{"id":"5767bc6e.83d904","type":"function","z":"ff818cbc.32d49","name":"3 nfc","func":"flow.set(\"nfc_3\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":560,"wires":[["6a5dbd4a.bd4794","d9bb249b.b15378"]]},{"id":"3aeb1089.f9e8a","type":"link in","z":"ff818cbc.32d49","name":"","links":["865de601.9f1688","986db88f.cfb188"],"x":95,"y":800,"wires":[["b56c6c18.56fb5","f3b215dc.8bc038"]]},{"id":"7767656b.ca024c","type":"link in","z":"ff818cbc.32d49","name":"","links":["f82ca052.34f86","2d37c0da.f46c3"],"x":95,"y":840,"wires":[["16acbc5b.4817a4","17f4b9d.c16f946"]]},{"id":"3785acf4.dc79e4","type":"ui_text","z":"ff818cbc.32d49","group":"467937a8.e4a118","order":2,"width":0,"height":0,"name":"","label":"Статус в'їзд","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":800,"wires":[]},{"id":"8eefaf9c.8b9d4","type":"ui_text","z":"ff818cbc.32d49","group":"467937a8.e4a118","order":1,"width":0,"height":0,"name":"","label":"Статус виїзд","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":840,"wires":[]},{"id":"b56c6c18.56fb5","type":"function","z":"ff818cbc.32d49","name":"","func":"if(msg.payload == 1){\n    msg.payload = \"В нормі\"\n}else{\n    msg.payload = \"Порушений\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":800,"wires":[["3785acf4.dc79e4"]]},{"id":"16acbc5b.4817a4","type":"function","z":"ff818cbc.32d49","name":"","func":"if(msg.payload == 1){\n    msg.payload = \"В нормі\"\n}else{\n    msg.payload = \"Порушений\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":840,"wires":[["8eefaf9c.8b9d4"]]},{"id":"a8a4ae17.1fbab","type":"ui_button","z":"ff818cbc.32d49","name":"","group":"9a1aff02.f908","order":7,"width":0,"height":0,"passthru":false,"label":"Зважування завершене","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":290,"y":640,"wires":[["7ccecd86.1032f4"]]},{"id":"7ccecd86.1032f4","type":"function","z":"ff818cbc.32d49","name":"","func":"msg.payload = \"\";\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":640,"wires":[["c68c918b.c1c98","6a5dbd4a.bd4794"]]},{"id":"55ff5103.d4b22","type":"debug","z":"ff818cbc.32d49","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":230,"y":420,"wires":[]},{"id":"d8d46b61.8b5b18","type":"ui_button","z":"ff818cbc.32d49","name":"","group":"a14246ce.0a0208","order":1,"width":0,"height":0,"passthru":true,"label":"Зелений","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":100,"y":200,"wires":[["3d621e93.5b79e2"]]},{"id":"252385d3.c4aa8a","type":"ui_button","z":"ff818cbc.32d49","name":"","group":"a14246ce.0a0208","order":1,"width":0,"height":0,"passthru":true,"label":"Червоний","tooltip":"","color":"","bgcolor":"red","icon":"","payload":"","payloadType":"date","topic":"","x":100,"y":240,"wires":[["6625227f.70d93c"]]},{"id":"f94cacdb.28f28","type":"ui_button","z":"ff818cbc.32d49","name":"","group":"a14246ce.0a0208","order":1,"width":0,"height":0,"passthru":true,"label":"Погасити","tooltip":"","color":"","bgcolor":"gray","icon":"","payload":"","payloadType":"date","topic":"","x":100,"y":280,"wires":[["870b31b9.1136a"]]},{"id":"f3b215dc.8bc038","type":"debug","z":"ff818cbc.32d49","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":270,"y":740,"wires":[]},{"id":"7cd7ba95.ad5244","type":"debug","z":"1adcf522.c0ee0b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":220,"wires":[]},{"id":"d1650abc.305fa8","type":"function","z":"1adcf522.c0ee0b","name":"в дашборд","func":"msg.payload = Number(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":220,"wires":[["7cd7ba95.ad5244","75fac6e2.324c48"]]},{"id":"4288ab6.d755d54","type":"function","z":"f45c3419.e74828","name":"Світлофор зелений СТ_0","func":"\n\n\nmsg.payload =\"START1;0;0;3;0;2;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":480,"y":220,"wires":[["bcf0210d.9a7ff"]]},{"id":"653b7e44.b133d","type":"comment","z":"f45c3419.e74828","name":"","info":"START1;0;0;1;0;Верхня;Нижня<EOR>\n\nSTART1;0;0;1;іва;фів;","x":80,"y":20,"wires":[]},{"id":"d7727b6c.ec0b98","type":"inject","z":"f45c3419.e74828","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":60,"wires":[["9233fa72.76ce08"]]},{"id":"9233fa72.76ce08","type":"function","z":"f45c3419.e74828","name":"ТЕСТ 1 сторона 0","func":"\nvar num_avto_r1 = \"АК4323ВВ\";\nvar num_avto_r2 = \"13200 кг\";\n\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n//            START1;0;0;1;0;Верхня;Нижня<EOR>            \nreturn msg;","outputs":1,"noerr":0,"x":290,"y":60,"wires":[["64275751.6c0988"]]},{"id":"bcf0210d.9a7ff","type":"tcp out","z":"f45c3419.e74828","host":"10.3.45.242","port":"9761","beserver":"client","base64":false,"end":false,"name":"","x":1060,"y":440,"wires":[]},{"id":"df80380e.cec3e8","type":"function","z":"f45c3419.e74828","name":"Світлофор червний СТ_0","func":"\n\n\nmsg.payload =\"START1;0;1;3;0;1;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":480,"y":260,"wires":[["bcf0210d.9a7ff"]]},{"id":"2b54d691.1ea75a","type":"inject","z":"f45c3419.e74828","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":220,"wires":[["4288ab6.d755d54"]]},{"id":"281c6dba.69d612","type":"inject","z":"f45c3419.e74828","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":260,"wires":[["df80380e.cec3e8"]]},{"id":"b46bf6f2.8cea48","type":"comment","z":"f45c3419.e74828","name":"СТОРОНА 0","info":"START1;0;0;1;0;Верхня;Нижня<EOR>\n\nSTART1;0;0;1;іва;фів;","x":70,"y":160,"wires":[]},{"id":"9a9f3de8.1882f","type":"inject","z":"f45c3419.e74828","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":300,"wires":[["ecddd384.6541c"]]},{"id":"ecddd384.6541c","type":"function","z":"f45c3419.e74828","name":"погасити світлофори СТ_0","func":"\n\n\nmsg.payload =\"START1;0;0;3;0;0;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":480,"y":300,"wires":[["bcf0210d.9a7ff"]]},{"id":"ae252fb1.21d06","type":"inject","z":"f45c3419.e74828","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":100,"wires":[["e5065550.1809f8"]]},{"id":"e5065550.1809f8","type":"function","z":"f45c3419.e74828","name":"яскравість 100 всі сторони","func":"\n\n\nmsg.payload =\"START1;0;0;102;255;255;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":320,"y":100,"wires":[["bcf0210d.9a7ff"]]},{"id":"8434075f.db0658","type":"function","z":"f45c3419.e74828","name":"Дані строки з форми СТ_0","func":"var num_avto_r1 = msg.payload.r1;\nvar num_avto_r2 = msg.payload.r2;\n\n\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":480,"y":340,"wires":[["64275751.6c0988"]]},{"id":"3d632b2e.1eaee4","type":"function","z":"f45c3419.e74828","name":"Дані строки з NFC CТ_0","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":470,"y":380,"wires":[["64275751.6c0988"]]},{"id":"642c6f73.79d56","type":"link out","z":"ff818cbc.32d49","name":"T1 _ side 0","links":["b95886b1.3472f8"],"x":315,"y":160,"wires":[]},{"id":"3d621e93.5b79e2","type":"link out","z":"ff818cbc.32d49","name":"T1_side_0_green","links":["3b10fe0b.4b9b02"],"x":215,"y":200,"wires":[]},{"id":"6625227f.70d93c","type":"link out","z":"ff818cbc.32d49","name":"T1_side_0_red","links":["5e5b31b8.c7b52"],"x":210,"y":240,"wires":[]},{"id":"870b31b9.1136a","type":"link out","z":"ff818cbc.32d49","name":"T1_side_0_off","links":["f1418528.23aec8"],"x":210,"y":280,"wires":[]},{"id":"b95886b1.3472f8","type":"link in","z":"f45c3419.e74828","name":"T1 _ side 0_t","links":["642c6f73.79d56"],"x":315,"y":340,"wires":[["8434075f.db0658"]]},{"id":"3b10fe0b.4b9b02","type":"link in","z":"f45c3419.e74828","name":"T1_side_0_gree_t","links":["3d621e93.5b79e2"],"x":275,"y":200,"wires":[["4288ab6.d755d54"]]},{"id":"5e5b31b8.c7b52","type":"link in","z":"f45c3419.e74828","name":"T1_side_0_red_t","links":["6625227f.70d93c"],"x":275,"y":240,"wires":[["df80380e.cec3e8"]]},{"id":"f1418528.23aec8","type":"link in","z":"f45c3419.e74828","name":"T1_side_0_off_t","links":["870b31b9.1136a"],"x":275,"y":280,"wires":[["ecddd384.6541c"]]},{"id":"146f5267.6db85e","type":"comment","z":"ff818cbc.32d49","name":"До вагів T1 S0","info":"","x":100,"y":120,"wires":[]},{"id":"8e87519f.d20ec","type":"comment","z":"f45c3419.e74828","name":"До вагів T1 S0","info":"","x":220,"y":160,"wires":[]},{"id":"9ff90459.e76c68","type":"function","z":"f45c3419.e74828","name":"Дані строки з NFC","func":"\nvar num_avto_r1 = msg.payload;\nvar num_avto_r2 = \"\";\n\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":450,"y":440,"wires":[["64275751.6c0988"]]},{"id":"59797be1.e4ac54","type":"link in","z":"f45c3419.e74828","name":"","links":["482c6e54.c5362","262c8bf1.0737c4","4ab25b0b.77dab4","a9618fb.830527"],"x":295,"y":420,"wires":[[]]},{"id":"b365439f.9dea9","type":"link in","z":"f45c3419.e74828","name":"1C to Board 1","links":["c7813a33.665558","60730fad.f057c"],"x":155,"y":500,"wires":[["815fc9a6.ff3ef8","4b772d40.db2214"]]},{"id":"13a40a4a.2d9c56","type":"function","z":"f45c3419.e74828","name":"Дані строки з 1C","func":"msg.payload =\"START1;0;0;1;0;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":330,"y":500,"wires":[["64275751.6c0988"]]},{"id":"7deaf3ba.d9e91c","type":"link in","z":"f45c3419.e74828","name":"rfid truck 1 table 1","links":["46f16a9d.111e54"],"x":155,"y":540,"wires":[["4cec6845.f860a8"]]},{"id":"4cec6845.f860a8","type":"function","z":"f45c3419.e74828","name":"Дані строки з NFC","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":330,"y":540,"wires":[["acd6593b.f4de48","64275751.6c0988"]]},{"id":"acd6593b.f4de48","type":"switch","z":"f45c3419.e74828","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"finded","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":540,"wires":[["df80380e.cec3e8"]]},{"id":"a4822489.cc4958","type":"link in","z":"f45c3419.e74828","name":"table_in_green_1_S0","links":["2cfafcb6.ff49e4","984a5610.b576b8"],"x":155,"y":360,"wires":[["4288ab6.d755d54"]]},{"id":"6b246ec7.750a7","type":"link in","z":"f45c3419.e74828","name":"table_in_red_1_S0","links":["f9dc4703.d9dcc8","c7734ae5.72b348","e816ae7e.7db6c"],"x":155,"y":400,"wires":[["df80380e.cec3e8"]]},{"id":"a298a6a6.6cb748","type":"inject","z":"f45c3419.e74828","name":"reset","topic":"","payload":"msgPayload","payloadType":"flow","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":720,"wires":[["f0870957.21eb08"]]},{"id":"f0870957.21eb08","type":"switch","z":"f45c3419.e74828","name":"","property":"cmdOts1","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":190,"y":720,"wires":[["815fc9a6.ff3ef8"]]},{"id":"815fc9a6.ff3ef8","type":"function","z":"f45c3419.e74828","name":"true","func":"var dies_1 = msg.payload.row1;\nvar dies_2 = msg.payload.row2;\n\n    if(dies_1 == \"#вес\" || dies_2 == \"#вес\"){\n        flow.set(\"cmdOts1\",true);\n    }else if(dies_1 !== \"#вес\" && dies_2 !== \"#вес\"){\n        flow.set(\"cmdOts1\",false);\n    }\n\nvar last_mes = {\n    row1: dies_1,\n    row2: dies_2\n}\n\nflow.set(\"row1\", msg.payload.row1);\nflow.set(\"row2\", msg.payload.row2);\nflow.set(\"msgPayload\", last_mes);\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":660,"wires":[["75f5f808.e40a68"]]},{"id":"75f5f808.e40a68","type":"function","z":"f45c3419.e74828","name":"Дані строки з 1C","func":"var row1 = flow.get(\"row1\");\nvar row2 = flow.get(\"row2\");\n\n//msg.payload.row1 = flow.get(\"row1\");\n//msg.payload.row2 = flow.get(\"row2\");\n\n\nif(row1 == \"#вес\" ){\n   msg.payload.row1 = global.get(\"weight\");\n   msg.payload.row2 = flow.get(\"row2\"); \n   }else if(row2 == \"#вес\" ){\n   msg.payload.row2 = global.get(\"weight\");\n   msg.payload.row1 = flow.get(\"row1\"); \n}\n\n\nmsg.payload =\"START1;0;0;1;0;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":430,"y":720,"wires":[["ffe28216.91b16","64275751.6c0988"]]},{"id":"ffe28216.91b16","type":"debug","z":"f45c3419.e74828","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":630,"y":720,"wires":[]},{"id":"8944ec07.1e616","type":"function","z":"f45c3419.e74828","name":"init Змінні для події    #вага","func":"flow.set(\"cmdOts1\",false);\nflow.set(\"msgPayload\",{});\nflow.set(\"row1\",\"\");\nflow.set(\"row2\",\"\");\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":620,"wires":[[]]},{"id":"41d14a6f.ac6cc4","type":"inject","z":"f45c3419.e74828","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":620,"wires":[["8944ec07.1e616"]]},{"id":"4b772d40.db2214","type":"debug","z":"f45c3419.e74828","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":310,"y":580,"wires":[]},{"id":"64275751.6c0988","type":"converter","z":"f45c3419.e74828","name":"","from":"win1251","x":840,"y":440,"wires":[["bcf0210d.9a7ff"]]},{"id":"ca8632af.ac8ef","type":"inject","z":"d5e6d634.8c2198","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":100,"wires":[["9f60415.10bb3c"]]},{"id":"9f60415.10bb3c","type":"exec","z":"d5e6d634.8c2198","command":"sudo bash /home/pi/top/start.sh","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":350,"y":100,"wires":[["3fbc45fa.5869aa"],[],[]]},{"id":"3fbc45fa.5869aa","type":"debug","z":"d5e6d634.8c2198","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":80,"wires":[]},{"id":"3e6d397.41129c6","type":"comment","z":"d5e6d634.8c2198","name":"Init","info":"","x":190,"y":60,"wires":[]},{"id":"27cf2fc2.40faf","type":"comment","z":"d5e6d634.8c2198","name":"Охорона(Двері)","info":"","x":220,"y":240,"wires":[]},{"id":"6ece8096.600f3","type":"comment","z":"d5e6d634.8c2198","name":"Виїзд","info":"","x":190,"y":460,"wires":[]},{"id":"a9618fb.830527","type":"link out","z":"d5e6d634.8c2198","name":"ЗЧ Охорона","links":["de0306a3.44eb18","428abc27.8a3384","9851376e.dae908","38e0f8e5.10ab38","96e400b2.8de26","59797be1.e4ac54","82d3e7ad.577ce8"],"x":595,"y":280,"wires":[]},{"id":"dad39117.a9626","type":"link out","z":"d5e6d634.8c2198","name":"ЗЧ Виїзд","links":["5d286c14.4cb6c4","8461f24b.e5801","f37d6e39.237f5","1c2e544b.82ccdc"],"x":595,"y":500,"wires":[]},{"id":"4b88f36c.a4016c","type":"inject","z":"cb4b1015.765ba","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"0.2","x":170,"y":140,"wires":[["f50edca6.6789a"]]},{"id":"f50edca6.6789a","type":"exec","z":"cb4b1015.765ba","command":"sudo bash /home/pi/status/status.sh","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":420,"y":140,"wires":[["ed9c4ea6.46dfd"],[],[]]},{"id":"ed9c4ea6.46dfd","type":"debug","z":"cb4b1015.765ba","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":120,"wires":[]},{"id":"aac4b965.018968","type":"inject","z":"cb4b1015.765ba","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":460,"wires":[["fadc4b7b.0e6228"]]},{"id":"fadc4b7b.0e6228","type":"exec","z":"cb4b1015.765ba","command":"cat /sys/class/gpio/gpio6/value","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":true,"name":"","x":410,"y":460,"wires":[["4a2a2035.1bca1","2d37c0da.f46c3","18f16af9.b23ea5"],[],[]]},{"id":"4a2a2035.1bca1","type":"debug","z":"cb4b1015.765ba","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":440,"wires":[]},{"id":"6c1ddbba.6bb354","type":"inject","z":"cb4b1015.765ba","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":280,"wires":[["3031e22c.dbe35e"]]},{"id":"3031e22c.dbe35e","type":"exec","z":"cb4b1015.765ba","command":"cat /sys/class/gpio/gpio12/value","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":true,"name":"","x":410,"y":280,"wires":[["5dbf2a03.c8bbe4","bf772373.925ef","986db88f.cfb188"],[],[]]},{"id":"5dbf2a03.c8bbe4","type":"debug","z":"cb4b1015.765ba","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":280,"wires":[]},{"id":"c3a1135c.9c3a3","type":"comment","z":"cb4b1015.765ba","name":"В*їзд","info":"","x":130,"y":240,"wires":[]},{"id":"991bdc0e.7238f","type":"comment","z":"cb4b1015.765ba","name":"Виїзд","info":"","x":130,"y":420,"wires":[]},{"id":"4464143e.79880c","type":"comment","z":"cb4b1015.765ba","name":"Init","info":"","x":230,"y":100,"wires":[]},{"id":"bf772373.925ef","type":"function","z":"cb4b1015.765ba","name":"infrared state 1","func":"global.set('infraredstate1',msg.payload);\nglobal.set('infraredstate1Date', new Date());\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":220,"wires":[[]]},{"id":"18f16af9.b23ea5","type":"function","z":"cb4b1015.765ba","name":"infrared state 2","func":"global.set('infraredstate2Date', new Date());\nglobal.set('infraredstate2', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":380,"wires":[[]]},{"id":"986db88f.cfb188","type":"link out","z":"cb4b1015.765ba","name":"Периметр в'їзд","links":["3aeb1089.f9e8a","c7693f9.7ef73c"],"x":615,"y":340,"wires":[]},{"id":"2d37c0da.f46c3","type":"link out","z":"cb4b1015.765ba","name":"Периметр виїзд","links":["7767656b.ca024c","41192ee0.1c066"],"x":595,"y":480,"wires":[]},{"id":"17f4b9d.c16f946","type":"debug","z":"ff818cbc.32d49","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":250,"y":900,"wires":[]},{"id":"d9bb249b.b15378","type":"debug","z":"ff818cbc.32d49","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":330,"y":540,"wires":[]},{"id":"a3ee878c.c2ba48","type":"rpi-gpio in","z":"cb4b1015.765ba","name":"","pin":"31","intype":"down","debounce":"25","read":false,"x":200,"y":500,"wires":[["ae030ae2.023368"]]},{"id":"ae030ae2.023368","type":"debug","z":"cb4b1015.765ba","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":380,"y":500,"wires":[]},{"id":"e08bd0d7.c38a1","type":"rpi-gpio in","z":"cb4b1015.765ba","name":"","pin":"32","intype":"down","debounce":"25","read":false,"x":260,"y":200,"wires":[["274fceb.d86db32"]]},{"id":"274fceb.d86db32","type":"debug","z":"cb4b1015.765ba","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":440,"y":200,"wires":[]},{"id":"afbc2d51.5d44a","type":"http in","z":"413320aa.6d7e6","name":"","url":"/api/platform/setAccessTable","method":"post","upload":false,"swaggerDoc":"","x":180,"y":240,"wires":[["ce43da50.1dd808"]]},{"id":"ce43da50.1dd808","type":"function","z":"413320aa.6d7e6","name":"set Access Table","func":"// var accessTable = [exampleAcess];\n// var exampleAcess = {\n//     \"pointID\":\"35235325325235\"\n//     \"ip\":\"10.3.5.210\",\n//     \"antennaID\":\"1\",\n//     \"direction\":0,\n//     \"tags\":[\"124124\",\"3525235\"],\n//     \"gpo\":['80','00'],\n//      \"marked\":false\n// }\n\nflow.set('accessTable',msg.payload);\nflow.set('accessTableUpdate',new Date());\nmsg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":240,"wires":[["b3c1c5a4.c84318"]]},{"id":"b3c1c5a4.c84318","type":"http response","z":"413320aa.6d7e6","name":"","x":630,"y":240,"wires":[]},{"id":"a8add7aa.b73f78","type":"inject","z":"413320aa.6d7e6","name":"init","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":110,"y":40,"wires":[["9690e769.b10288"]]},{"id":"9690e769.b10288","type":"function","z":"413320aa.6d7e6","name":"NFC conf","func":"//040300000012000001dd0000db0007000280 - 02 GPO index, 80 or 00 - on/off\nflow.set('accessTable',[]);\n//timeout for delay to getting infrared state, ms\nflow.set('infraredtimeout',5000);\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":40,"wires":[["3f02e846.367598"]]},{"id":"df61f9a4.7e6c78","type":"function","z":"413320aa.6d7e6","name":"get row from Access Table","func":"var aT = flow.get('accessTable');\nvar aTDate = flow.get('accessTableUpdate');\nvar nowDate = Date();\nvar diff = flow.get('actualDiff');\n\nmsg.do = false;\n//if access table is not actual\n\nfor (var i = 0; i < aT.length; i++){\n    //slice -3 for all tags ia array\n    var temp_tags = aT[i].tags.slice();\n    //for (var j = 0; j < temp_tags.length; j++){\n        //temp_tags[j] = temp_tags[j].slice(0,-3);    \n    //}\n    if ((aT[i].ip === msg.ip) && (Number(aT[i].antenna)===msg.antennaID) && (temp_tags.indexOf(msg.tag.tagID) >= 0)&&!(aT[i].done)){\n        msg.accessTable = aT[i];\n        msg.aTLength = aT.length;\n        if ((aT[i].pointID != \"Неопределенно\")){\n            aT[i].done = true;\n            continue;\n        }\n        msg.do = true;\n        break;\n     }\n}\nmsg.temp_tags = temp_tags;\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":340,"wires":[["31311b53.9787a4","c3e3587a.35ae58"]]},{"id":"d9a82b20.d87a18","type":"function","z":"413320aa.6d7e6","name":"get IP","func":"msg.tagID = msg.payload;\nvar  s = \"-\";\nmsg.tagID = msg.tagID.substring(0,2)+s+msg.tagID.substring(2,4)+s+msg.tagID.substring(4,6)+s+msg.tagID.substring(6,8);\n//msg.tagID = msg.tagID.substring(0,2)+s+msg.tagID.substring(2,4)+s+msg.tagID.substring(4,6);\nmsg.tag   = {\"tagID\":msg.tagID};\nmsg.antennaID = msg.antennaID;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":340,"wires":[["df61f9a4.7e6c78"]]},{"id":"9c2e9736.325f28","type":"http in","z":"413320aa.6d7e6","name":"","url":"/api/platform/getReaderConfig","method":"get","upload":false,"swaggerDoc":"","x":180,"y":600,"wires":[["62b8c18a.e5711"]]},{"id":"89ef6799.4a0368","type":"http response","z":"413320aa.6d7e6","name":"","x":630,"y":600,"wires":[]},{"id":"6dd732f0.bfb9fc","type":"http in","z":"413320aa.6d7e6","name":"","url":"/api/platform/setDefaultTable","method":"post","upload":false,"swaggerDoc":"","x":180,"y":280,"wires":[["74db2b22.513d64"]]},{"id":"74db2b22.513d64","type":"function","z":"413320aa.6d7e6","name":"set default Table","func":"// var accessTable = [];\n// var exampleAcess = {\n//     \"ip\":\"10.3.5.210\",\n//     \"port\":5084,\n//     \"gpo\":['0180','0200']\n// }\n\nflow.set('accessTable',msg.payload);\nmsg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":280,"wires":[["3c73664b.c2729a"]]},{"id":"3c73664b.c2729a","type":"http response","z":"413320aa.6d7e6","name":"","x":630,"y":280,"wires":[]},{"id":"1123b6b4.069b49","type":"function","z":"413320aa.6d7e6","name":"FRONT","func":"msg.ip = \"NFC_front2\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"x":220,"y":360,"wires":[["d9a82b20.d87a18"]]},{"id":"95440970.945a38","type":"function","z":"413320aa.6d7e6","name":"IN","func":"msg.ip = \"NFC_in\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":400,"wires":[["d9a82b20.d87a18"]]},{"id":"18e29939.f1e737","type":"function","z":"413320aa.6d7e6","name":"OUT","func":"msg.ip = \"NFC_out2\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":440,"wires":[["d9a82b20.d87a18"]]},{"id":"3aa1c96e.d39e16","type":"http in","z":"413320aa.6d7e6","name":"","url":"/api/platform/setReaderConfig","method":"post","upload":false,"swaggerDoc":"","x":660,"y":40,"wires":[["86505d48.9fe8","782325f5.8edabc","6dcc2197.77e5"]]},{"id":"86505d48.9fe8","type":"http response","z":"413320aa.6d7e6","name":"","x":910,"y":100,"wires":[]},{"id":"5dd09dc2.e4ded4","type":"inject","z":"413320aa.6d7e6","name":"","topic":"","payload":"puller","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":"","x":100,"y":780,"wires":[[]]},{"id":"c75ca239.f0c22","type":"inject","z":"413320aa.6d7e6","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":93.5,"y":840,"wires":[["11749d18.e06a93"]]},{"id":"11749d18.e06a93","type":"function","z":"413320aa.6d7e6","name":"get row from Access Table","func":"var aT = flow.get('accessTable');\nvar aTDate = flow.get('accessTableUpdate');\nvar nowDate = Date();\nvar diff = 2000;\n\nmsg.do = true;\n//if access table is not actual\nif (nowDate-aTDate > diff){\n    msg.do = false;\n}else{\nfor (var i = 0; i < aT.length; i++){\n    if ((aT[i].ip === msg.ip)&&Number(aT[i].antenna)===msg.tag.antennaID){\n        msg.accessTable = aT[i];\n        msg.aTLength = aT.length;\n        break;\n     }\n}\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":294,"y":840,"wires":[[]]},{"id":"a01aa8ec.c5def8","type":"function","z":"413320aa.6d7e6","name":"send to 1C","func":"msg.url = flow.get('host1C');\nmsg.tag.lastSeenTimestampUTC = new Date();\nmsg.tag.ip = msg.ip;\nmsg.tag.antenna = String(msg.antennaID);\nmsg.tag.antennaID = String(msg.antennaID);\nmsg.tag.direction = 'IN';\nmsg.tag.weight = JSON.parse(msg.payload);\n\nmsg.payload = [msg.tag];\n\nreturn msg;","outputs":1,"noerr":0,"x":1950,"y":440,"wires":[["bda2f219.db9c"]]},{"id":"bda2f219.db9c","type":"http request","z":"413320aa.6d7e6","name":"to 1C","method":"POST","ret":"txt","url":"","tls":"","x":2090,"y":440,"wires":[["d203d3c8.9eb62"]]},{"id":"3f02e846.367598","type":"function","z":"413320aa.6d7e6","name":"1C conf","func":"//var host1C = \"http://s-app-mir-test/rfid_mir_test/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\n//var host1C = \"http://s-app-yag-test/UE_yag/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\nvar host1C = \"http://10.3.45.253/UE_yag/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\n\nflow.set('host1C',host1C);\nflow.set('actualDiff',86900); //сколько секунда таблица доступа актуальна\nmsg.url = host1C;\nflow.set('puller',[]);\nflow.set('puller_timeout_sec',30);\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":40,"wires":[["8c5b8797.6877c8"]]},{"id":"782325f5.8edabc","type":"function","z":"413320aa.6d7e6","name":"","func":"msg.payload.ip = msg.req.query.rfidID;\nmsg.payload.event_name = \"Отправка команды\";\nmsg.payload.event_desc = msg.payload.event_name+\" \"+msg.payload.ip+\" \"+msg.payload.cmd;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":20,"wires":[[]]},{"id":"8c5b8797.6877c8","type":"http request","z":"413320aa.6d7e6","name":"","method":"GET","ret":"txt","url":"","tls":"","x":350,"y":140,"wires":[["8d7260f2.87feb"]]},{"id":"8d7260f2.87feb","type":"function","z":"413320aa.6d7e6","name":"set Access Table","func":"flow.set('accessTable',JSON.parse(msg.payload));\nflow.set('accessTableUpdate',new Date());\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":140,"wires":[["db763065.57a66"]]},{"id":"1d070e39.40ccc2","type":"function","z":"413320aa.6d7e6","name":"Filling Puller","func":"var puller = flow.get('puller');\nvar puller_timeout_sec = flow.get('puller_timeout_sec');\nvar current_element = {\n    'ip':msg.ip,\n    'tagID':msg.tagID,\n    'antennaID':msg.tag.antennaID,\n    'lastSeenTimestampUTC':new Date()\n}\nvar pull = true;\nvar finded = false\nfor (var i = 0; i < puller.length; i++){\n    var element = puller[i];\n    if ((element.ip === current_element.ip)&&(element.tagID===current_element.tagID)&&(element.antennaID===current_element.antennaID)){\n        var diff = (current_element.lastSeenTimestampUTC-element.lastSeenTimestampUTC)*1000;\n        if (diff < puller_timeout_sec){\n            pull = false; \n        }else{\n            puller[i]=current_element;\n        }\n        finded = true;\n    }\n}\nif (!finded){\n    puller.push(current_element);\n}\n\nflow.set('puller',puller);\nmsg.pull = pull;\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":500,"wires":[["49b9ebb4.4fe094"]]},{"id":"49b9ebb4.4fe094","type":"switch","z":"413320aa.6d7e6","name":"","property":"pull","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":750,"y":500,"wires":[["4a3cff0c.84769"]]},{"id":"82d3e7ad.577ce8","type":"link in","z":"413320aa.6d7e6","name":"","links":["a9618fb.830527"],"x":75,"y":360,"wires":[["1123b6b4.069b49"]]},{"id":"bbb2d2e1.f5c4","type":"link in","z":"413320aa.6d7e6","name":"","links":["24499bf4.7729a4"],"x":75,"y":400,"wires":[[]]},{"id":"1c2e544b.82ccdc","type":"link in","z":"413320aa.6d7e6","name":"","links":["dad39117.a9626"],"x":75,"y":440,"wires":[["18e29939.f1e737"]]},{"id":"62b8c18a.e5711","type":"function","z":"413320aa.6d7e6","name":"check infrared state","func":"var payload = {\n    'infraredstate1':0,\n    'infraredstate2':0\n}\nvar infraredtimeout = flow.get('infraredtimeout');\nvar cDate = new Date();\nif ((cDate - global.get('infraredstate1Date')) < infraredtimeout){\n    payload.infraredstate1 = global.get('infraredstate1') ;   \n}\n\nif ((cDate - global.get('infraredstate2Date')) < infraredtimeout){\n    payload.infraredstate2 = global.get('infraredstate2') ;   \n}\n\nmsg.payload = {\"infraredstate\":payload.infraredstate1 == 1 && payload.infraredstate1 == 2};\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":600,"wires":[["89ef6799.4a0368"]]},{"id":"f2d43f18.9256d","type":"switch","z":"413320aa.6d7e6","name":"board_in_out","property":"ip","propertyType":"msg","rules":[{"t":"eq","v":"board_in","vt":"str"},{"t":"eq","v":"board_out","vt":"str"},{"t":"eq","v":"board_in2","vt":"str"},{"t":"eq","v":"board_out2","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":1010,"y":160,"wires":[["840a7bdd.a444f8"],[],[],[]]},{"id":"984a5610.b576b8","type":"link out","z":"413320aa.6d7e6","name":"t_g_1_s_0","links":["a4822489.cc4958"],"x":1315,"y":120,"wires":[]},{"id":"840a7bdd.a444f8","type":"switch","z":"413320aa.6d7e6","name":"green/red","property":"cmd","propertyType":"msg","rules":[{"t":"eq","v":"0100","vt":"str"},{"t":"eq","v":"0180","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1200,"y":140,"wires":[["984a5610.b576b8"],["e816ae7e.7db6c"]]},{"id":"e816ae7e.7db6c","type":"link out","z":"413320aa.6d7e6","name":"t_r_1_s_0","links":["6b246ec7.750a7"],"x":1315,"y":160,"wires":[]},{"id":"6dcc2197.77e5","type":"function","z":"413320aa.6d7e6","name":"","func":"msg.ip      = msg.req.query.rfidID;\nmsg.cmd     = msg.payload.cmd;\nreturn msg;","outputs":"1","noerr":0,"x":910,"y":60,"wires":[["f2d43f18.9256d"]]},{"id":"4d9516a1.b62d58","type":"http in","z":"413320aa.6d7e6","name":"","url":"/api/platform/setBoardText","method":"post","upload":false,"swaggerDoc":"","x":150,"y":680,"wires":[["18a93e72.c789b2","b318baca.939588"]]},{"id":"18a93e72.c789b2","type":"function","z":"413320aa.6d7e6","name":"get boarad ID","func":"msg.ip      = msg.req.query.boardID;\nreturn msg;","outputs":"1","noerr":0,"x":400,"y":680,"wires":[["ae720ff6.eda96","fb46d616.21f728"]]},{"id":"ae720ff6.eda96","type":"switch","z":"413320aa.6d7e6","name":"board_in_out","property":"ip","propertyType":"msg","rules":[{"t":"eq","v":"board_in","vt":"str"},{"t":"eq","v":"board_out","vt":"str"},{"t":"eq","v":"board_in2","vt":"str"},{"t":"eq","v":"board_out2","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":590,"y":680,"wires":[["60730fad.f057c","fa2cfd01.0169f"],[],[],[]]},{"id":"60730fad.f057c","type":"link out","z":"413320aa.6d7e6","name":"1c to Board 1_S0 (rest)","links":["b365439f.9dea9"],"x":755,"y":640,"wires":[]},{"id":"fb46d616.21f728","type":"http response","z":"413320aa.6d7e6","name":"","statusCode":"","headers":{},"x":490,"y":740,"wires":[]},{"id":"a9e0cb85.904c88","type":"http request","z":"413320aa.6d7e6","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"http://10.3.45.249:4000/auth/login","tls":"","proxy":"","authType":"basic","x":1310,"y":440,"wires":[["e0056a95.6f5058"]]},{"id":"3425ea4.c592316","type":"function","z":"413320aa.6d7e6","name":"Авторизация на весах","func":"flow.set('access_granted',false);\nmsg.payload = {\n    \"username\":\"user\", \n    \"password\":\"user\"\n}\nmsg.headers = {\n    \"Content-Type\":\"application/json\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":440,"wires":[["a9e0cb85.904c88"]]},{"id":"e0056a95.6f5058","type":"function","z":"413320aa.6d7e6","name":"Получаем токен","func":"var payload = JSON.parse(msg.payload);\n\n\nmsg.headers = {\n    \"token\":payload.token\n}\n\nmsg.url = 'http://10.3.45.249:4000/api/platform/yag_avto1/getWeight/status';\n\nif (msg.tagData){\n    msg.url = msg.url+\"?truck1=\"+encodeURI(msg.tagData.truck1)+\"&truck2=\"+encodeURI(msg.tagData.truck2);    \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1490,"y":440,"wires":[["6dc0431d.a04d1c"]]},{"id":"6dc0431d.a04d1c","type":"http request","z":"413320aa.6d7e6","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1690,"y":440,"wires":[["a01aa8ec.c5def8","2469df79.b0e96"]]},{"id":"7482bb4.dc2d744","type":"http in","z":"413320aa.6d7e6","name":"","url":"/api/platform/getAccessTable","method":"get","upload":false,"swaggerDoc":"","x":170,"y":200,"wires":[["1868248a.9af8ab"]]},{"id":"1868248a.9af8ab","type":"function","z":"413320aa.6d7e6","name":"set Access Table","func":"msg.payload = flow.get('accessTable');\nmsg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":200,"wires":[["d7b3e591.501688"]]},{"id":"d7b3e591.501688","type":"http response","z":"413320aa.6d7e6","name":"","statusCode":"","headers":{},"x":620,"y":200,"wires":[]},{"id":"4a3cff0c.84769","type":"function","z":"413320aa.6d7e6","name":"check infrared state","func":"var payload = {\n    'infraredstate1':0,\n    'infraredstate2':0\n}\nvar infraredtimeout = flow.get('infraredtimeout');\nvar cDate = new Date();\nif ((cDate - global.get('infraredstate1Date')) < infraredtimeout){\n    payload.infraredstate1 = global.get('infraredstate1') ;   \n}\n\nif ((cDate - global.get('infraredstate2Date')) < infraredtimeout){\n    payload.infraredstate2 = global.get('infraredstate2') ;   \n}\nmsg.infraredstate1 = Number(payload.infraredstate1.substring(0,1));\nmsg.infraredstate2 = Number(payload.infraredstate2.substring(0,1));\n\nmsg.perimetr = (msg.infraredstate1 == 1 && msg.infraredstate2 == 1);\n\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":500,"wires":[["55852f45.0f114"]]},{"id":"c85da4ab.dd8418","type":"switch","z":"413320aa.6d7e6","name":"access_granted","property":"access_granted","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1260,"y":580,"wires":[["34119059.d5d6e"],["5008afa5.83615"]]},{"id":"5008afa5.83615","type":"function","z":"413320aa.6d7e6","name":"send text to board","func":"flow.set('temp_tagID',msg.tagID);\n\nmsg.payload = {\n                \"row1\":\"датчик\",\n                \"row2\":\"перекрито\"\n            };\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":640,"wires":[["60730fad.f057c"]]},{"id":"31311b53.9787a4","type":"switch","z":"413320aa.6d7e6","name":"access granted","property":"do","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":910,"y":340,"wires":[["8775d7cd.113178"],["1d070e39.40ccc2"]]},{"id":"8775d7cd.113178","type":"function","z":"413320aa.6d7e6","name":"set granted ","func":"flow.set('access_granted',true);\nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":340,"wires":[["583385dd.95f0fc","cd8615ae.b82628"]]},{"id":"583385dd.95f0fc","type":"function","z":"413320aa.6d7e6","name":"send text to board","func":"msg.payload = {\n                \"row1\":\"пр. карту\",\n                \"row2\":\"#вес\"\n            };\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1330,"y":340,"wires":[["60730fad.f057c"]]},{"id":"93e65ad.e771aa8","type":"http request","z":"413320aa.6d7e6","name":"to 1C ","method":"POST","ret":"txt","url":"","tls":"","x":2110,"y":600,"wires":[[]]},{"id":"b8f6fe0a.74f06","type":"function","z":"413320aa.6d7e6","name":"Взвесили с пересеченным периметром","func":"var host = 'http://10.3.45.253/UE_yag/hs/PerimeterControl/api/SmartScales/yag_avto2';\nmsg.payload = {\n    'ИдентификаторОбъекта':msg.tag.tagID,\n    'ИдентификаторАктивности':'ab2abea2-8602-11e9-4782-0242ac130003',\n    'ЗначениеВеса':global.get('weight')\n};\nmsg.url = host;\nmsg.headers = {};\nmsg.req = {};\nmsg.res = {};\nreturn msg;","outputs":1,"noerr":0,"x":1880,"y":600,"wires":[["93e65ad.e771aa8"]]},{"id":"4f41e1bb.84f35","type":"switch","z":"413320aa.6d7e6","name":"","property":"payload.perimetr","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":1760,"y":540,"wires":[["b8f6fe0a.74f06"]]},{"id":"55852f45.0f114","type":"switch","z":"413320aa.6d7e6","name":"perimetr true/false","property":"perimetr","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1030,"y":580,"wires":[["34119059.d5d6e"],["c85da4ab.dd8418"]]},{"id":"cd8615ae.b82628","type":"debug","z":"413320aa.6d7e6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1040,"y":280,"wires":[]},{"id":"2469df79.b0e96","type":"json","z":"413320aa.6d7e6","name":"","property":"payload","action":"obj","pretty":false,"x":1740,"y":500,"wires":[["4f41e1bb.84f35"]]},{"id":"db763065.57a66","type":"debug","z":"413320aa.6d7e6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":750,"y":140,"wires":[]},{"id":"c3e3587a.35ae58","type":"debug","z":"413320aa.6d7e6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":800,"y":260,"wires":[]},{"id":"34119059.d5d6e","type":"function","z":"413320aa.6d7e6","name":"1C get Tag Data","func":"msg.url = \"http://10.3.45.253/UE_yag/hs/PerimeterControl/api/PrincipNodeRed/getTagData\";\nreturn msg;","outputs":1,"noerr":0,"x":1460,"y":760,"wires":[["fccbc816.762bb8"]]},{"id":"fccbc816.762bb8","type":"http request","z":"413320aa.6d7e6","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1670,"y":760,"wires":[["1341cdb8.24a182"]]},{"id":"1341cdb8.24a182","type":"json","z":"413320aa.6d7e6","name":"","property":"payload","action":"obj","pretty":false,"x":1850,"y":760,"wires":[["257a5996.badd86"]]},{"id":"257a5996.badd86","type":"function","z":"413320aa.6d7e6","name":"get tag Data","func":"var tagID   = msg.tag.tagID.toUpperCase();\nvar tagdDataArray = msg.payload;\nvar tagData = {};\nfor(var i=0; i < tagdDataArray.length; i++){\n    if (tagdDataArray[i].tagID === tagID){\n        tagData = tagdDataArray[i];        \n    }\n}\n\nmsg.tagData = tagData;\nmsg.req = {};\nmsg.res = {};\nmsg.url = {};\n\nreturn msg;","outputs":1,"noerr":0,"x":2010,"y":760,"wires":[["3425ea4.c592316"]]},{"id":"d203d3c8.9eb62","type":"debug","z":"413320aa.6d7e6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2240,"y":440,"wires":[]},{"id":"83331400.9e3308","type":"comment","z":"d5e6d634.8c2198","name":"4083331900","info":"[ 1,\n  1,\n  1,\n  1,\n  1,\n  0,\n  0,\n  1,\n  1,\n  0,\n  1,\n  1,\n  0,\n  0,\n  0,\n  1,\n  0,\n  1,\n  0,\n  1,\n  1,\n  0,\n  0,\n  1,\n  1,\n  0,\n  0,\n  1,\n  1,\n  1,\n  1,\n  0,\n  0,\n  0 ]","x":150,"y":660,"wires":[]},{"id":"8a1ccc37.44235","type":"comment","z":"d5e6d634.8c2198","name":"","info":"[ 0,\n  1,\n  0,\n  0,\n  1,\n  0,\n  1,\n  0,\n  0,\n  0,\n  0,\n  0,\n  0,\n  1,\n  1,\n  1,\n  1,\n  1,\n  1,\n  1,\n  0,\n  1,\n  0,\n  1,\n  1,\n  1,\n  0,\n  0,\n  1,\n  1,\n  0,\n  0,\n  0,\n  1,\n  0 ]","x":320,"y":660,"wires":[]},{"id":"2734ab54.47bca4","type":"comment","z":"d5e6d634.8c2198","name":"","info":"[ 0,\n  1,\n  0,\n  0,\n  1,\n  0,\n  1,\n  0,\n  0,\n  0,\n  0,\n  0,\n  1,\n  1,\n  1,\n  1,\n  1,\n  1,\n  1,\n  0,\n  1,\n  0,\n  1,\n  1,\n  1,\n  0,\n  0,\n  1,\n  1,\n  0,\n  0,\n  0,\n  1,\n  0 ]\n2485114673","x":480,"y":660,"wires":[]},{"id":"36fcb7f8.df9a28","type":"comment","z":"d5e6d634.8c2198","name":"","info":"[ 0,\n  0,\n  0,\n  1,\n  0,\n  0,\n  1,\n  0,\n  0,\n  1,\n  1,\n  1,\n  1,\n  1,\n  0,\n  1,\n  0,\n  1,\n  1,\n  0,\n  1,\n  1,\n  1,\n  1,\n  0,\n  1,\n  0,\n  0,\n  0,\n  1,\n  0,\n  0,\n  0,\n  1,\n  1 ]","x":640,"y":660,"wires":[]},{"id":"fa2cfd01.0169f","type":"debug","z":"413320aa.6d7e6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":760,"y":840,"wires":[]},{"id":"b318baca.939588","type":"debug","z":"413320aa.6d7e6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":340,"y":780,"wires":[]},{"id":"93f94f83.8c3b2","type":"serial in","z":"d5e6d634.8c2198","name":"","serial":"fd989333.7e972","x":90,"y":500,"wires":[["63d27823.2c9a88"]]},{"id":"b418c2fd.81629","type":"serial in","z":"d5e6d634.8c2198","name":"","serial":"28ace721.cab2c8","x":90,"y":280,"wires":[["7519ccb5.849814"]]},{"id":"7519ccb5.849814","type":"function","z":"d5e6d634.8c2198","name":"Парсинг строки","func":"var keycode = \"\";\nvar el = \"\";\n\n\nmsg.payload.reverse().forEach(function(element) {\n  if (element.toString('16').length <2) el = \"0\" + element.toString('16'); else el = element.toString('16');\n  keycode = keycode + el;\n});\n\nmsg.payload = keycode;\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":280,"wires":[["30b86afd.33bef6","a9618fb.830527"]]},{"id":"30b86afd.33bef6","type":"debug","z":"d5e6d634.8c2198","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":490,"y":220,"wires":[]},{"id":"63d27823.2c9a88","type":"function","z":"d5e6d634.8c2198","name":"Парсинг строки","func":"var keycode = \"\";\nvar el = \"\";\n\n\nmsg.payload.reverse().forEach(function(element) {\n  if (element.toString('16').length <2) el = \"0\" + element.toString('16'); else el = element.toString('16');\n  keycode = keycode + el;\n});\n\nmsg.payload = keycode;\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":500,"wires":[["9ddc2297.79ae6","dad39117.a9626"]]},{"id":"9ddc2297.79ae6","type":"debug","z":"d5e6d634.8c2198","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":470,"y":460,"wires":[]},{"id":"e753501d.715c5","type":"tcp in","z":"5da0322.c98b9cc","name":"","server":"server","host":"","port":"3001","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":100,"y":200,"wires":[["f475c7f1.e00128"]]},{"id":"9ea07ea5.c3931","type":"tcp in","z":"5da0322.c98b9cc","name":"","server":"server","host":"","port":"3000","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":100,"y":260,"wires":[["16ff6060.fee1d"]]},{"id":"b7de71b5.1c8ff","type":"debug","z":"5da0322.c98b9cc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":410,"y":200,"wires":[]},{"id":"1c96eeb5.6e83b1","type":"debug","z":"5da0322.c98b9cc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":430,"y":260,"wires":[]},{"id":"16ff6060.fee1d","type":"function","z":"5da0322.c98b9cc","name":"in","func":"var encoded = msg.payload;\nvar actual = JSON.parse(encoded);\nmsg.payload = actual;\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":260,"wires":[["1c96eeb5.6e83b1"]]},{"id":"f475c7f1.e00128","type":"function","z":"5da0322.c98b9cc","name":"out","func":"var encoded = msg.payload;\nvar actual = JSON.parse(encoded);\nmsg.payload = actual;\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":200,"wires":[["b7de71b5.1c8ff"]]}]
