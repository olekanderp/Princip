[{"id":"37aa78f1.d64678","type":"tab","label":"Вагова 3","disabled":false,"info":"Машини лише на виїзд"},{"id":"d273f23a.da887","type":"tab","label":"RFID UHF","disabled":false,"info":""},{"id":"37f9888b.bf2178","type":"tab","label":"Табло 1 (СТ 1)","disabled":false,"info":""},{"id":"9f6e54f6.294ab8","type":"tab","label":"Табло 2 (СТ 1)","disabled":false,"info":""},{"id":"ef8d74d.cfc5d88","type":"tab","label":"Зчитувач","disabled":false,"info":""},{"id":"8d474e3a.15c34","type":"tab","label":"Периметр","disabled":false,"info":""},{"id":"1709892a.5599b7","type":"tab","label":"Dashboard","disabled":false,"info":""},{"id":"2c87636e.674b4c","type":"tab","label":"Ваги","disabled":false,"info":""},{"id":"7e938ba1.76a5f4","type":"subflow","name":"ETTN","info":"","in":[],"out":[]},{"id":"f0950d6d.bb47c","type":"subflow","name":"Subflow 1","info":"","in":[],"out":[]},{"id":"b5d0ae77.f70e5","type":"subflow","name":"ETTN (2)","info":"","in":[],"out":[]},{"id":"2ad6f0df.fc0ba","type":"subflow","name":"Subflow 1 (2)","info":"","in":[],"out":[]},{"id":"78294d59.60bdf4","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"b0c7977d.c04a48","type":"ui_tab","name":"Tab 1","icon":"dashboard","order":1},{"id":"ffff4fd6.3cc61","type":"ui_tab","z":"","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"ccba4e58.c5c9f","type":"ui_tab","z":"","name":"TAb","icon":"dashboard","disabled":false,"hidden":false},{"id":"3a2d5b4d.7fee24","type":"ui_group","z":"","name":"Зчитувачі","tab":"62be8a11.50a724","order":5,"disp":true,"width":"6","collapse":false},{"id":"62be8a11.50a724","type":"ui_tab","z":"","name":"Monitoring","icon":"dashboard","disabled":false,"hidden":false},{"id":"58a81001.1f32","type":"ui_group","z":"","name":"Вага","tab":"62be8a11.50a724","order":6,"disp":true,"width":"6","collapse":false},{"id":"e0de19b5.b05f58","type":"ui_group","z":"","name":"Периметр","tab":"62be8a11.50a724","order":7,"disp":true,"width":"5","collapse":false},{"id":"fdac088b.b70e68","type":"ui_group","z":"","name":"Табло 1 IN Сторона 1","tab":"62be8a11.50a724","order":2,"disp":true,"width":"6","collapse":false},{"id":"837b733c.8f5d9","type":"ui_group","z":"","name":"Табло 1 IN Сторона 0","tab":"62be8a11.50a724","order":1,"disp":true,"width":"6","collapse":false},{"id":"30afbb8f.c2fee4","type":"ui_group","z":"","name":"Табло 2 OUT Сторона 1","tab":"62be8a11.50a724","order":4,"disp":true,"width":"6","collapse":false},{"id":"10e988b.17bb977","type":"ui_group","z":"","name":"Графік ваги","tab":"62be8a11.50a724","order":8,"disp":true,"width":"6","collapse":false},{"id":"787c258b.c342ec","type":"ui_group","z":"","name":"Номери автомобілів","tab":"62be8a11.50a724","order":9,"disp":true,"width":"6","collapse":false},{"id":"f97acbd4.c351d8","type":"serial-port","z":"","serialport":"/dev/ttyACM0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","waitfor":"","dtr":"none","rts":"none","cts":"none","dsr":"none","newline":"200","bin":"bin","out":"time","addchar":"","responsetimeout":"10000"},{"id":"7860a2e9.b5c28c","type":"comment","z":"ef8d74d.cfc5d88","name":"Вїзд","info":"","x":70,"y":100,"wires":[]},{"id":"d58981ab.54843","type":"debug","z":"8d474e3a.15c34","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":200,"wires":[]},{"id":"ac807203.258e9","type":"comment","z":"8d474e3a.15c34","name":"Виїзд Init","info":"","x":200,"y":40,"wires":[]},{"id":"b1fdc192.361f6","type":"comment","z":"8d474e3a.15c34","name":"Вїзд Init","info":"","x":190,"y":160,"wires":[]},{"id":"2119e2d.b47f31e","type":"comment","z":"8d474e3a.15c34","name":"1 Не пересічено: 0 Пересічено","info":"","x":410,"y":40,"wires":[]},{"id":"48cfc8e4.24e988","type":"link out","z":"ef8d74d.cfc5d88","name":"ЗЧ Вїзд","links":["de0306a3.44eb18","236fb509.93f16a","50121f5b.25501","38e0f8e5.10ab38","96e400b2.8de26","3908c5d9.7a89ca"],"x":735,"y":100,"wires":[]},{"id":"78f32c28.8e4d94","type":"rpi-gpio in","z":"8d474e3a.15c34","name":"","pin":"12","intype":"down","debounce":"1000","read":false,"x":200,"y":200,"wires":[["d58981ab.54843"]]},{"id":"e4ec1770.5be3d8","type":"tcp in","z":"2c87636e.674b4c","name":"","server":"server","host":"","port":"2500","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":130,"y":100,"wires":[["ad6fb000.6ac54"]]},{"id":"498febab.d7ad94","type":"debug","z":"2c87636e.674b4c","name":"weight","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":740,"y":280,"wires":[]},{"id":"ad6fb000.6ac54","type":"delay","z":"2c87636e.674b4c","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":370,"y":100,"wires":[["1409dbc7.c85114","78e642b4.4a55cc","3f704e04.ffe732","76d0848a.197b0c"]]},{"id":"4c8d2751.8d9018","type":"inject","z":"8d474e3a.15c34","name":"","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":360,"wires":[["73c0bb24.d0f864"]]},{"id":"73c0bb24.d0f864","type":"exec","z":"8d474e3a.15c34","command":"cat /sys/class/gpio/gpio17/value","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"В'їзд","x":270,"y":360,"wires":[["a48ef537.e25ef8","7d6b5319.cb2d2c","c643ee25.9b63b"],[],[]]},{"id":"a48ef537.e25ef8","type":"debug","z":"8d474e3a.15c34","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":360,"wires":[]},{"id":"c354f628.725268","type":"inject","z":"8d474e3a.15c34","name":"","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":420,"wires":[["8dd33bd4.8442e8"]]},{"id":"8dd33bd4.8442e8","type":"exec","z":"8d474e3a.15c34","command":"cat /sys/class/gpio/gpio18/value","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"Виїзд","x":270,"y":420,"wires":[["7886b26c.8a2b2c","b6176c6b.9669","955d33b0.6a0b"],[],[]]},{"id":"7886b26c.8a2b2c","type":"debug","z":"8d474e3a.15c34","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":420,"wires":[]},{"id":"f7756960.f7a4b8","type":"ui_button","z":"1709892a.5599b7","name":"","group":"3a2d5b4d.7fee24","order":3,"width":0,"height":0,"passthru":false,"label":"NFC В'їзд","tooltip":"","color":"","bgcolor":"","icon":"","payload":"nfc_2","payloadType":"flow","topic":"NFC В'їзд","x":360,"y":540,"wires":[["ec12e6f5.050a98"]]},{"id":"c410b219.ff84a","type":"ui_button","z":"1709892a.5599b7","name":"","group":"3a2d5b4d.7fee24","order":5,"width":0,"height":0,"passthru":false,"label":"NFC Виїзд","tooltip":"","color":"","bgcolor":"","icon":"","payload":"nfc_3","payloadType":"flow","topic":"NFC Охорона","x":370,"y":580,"wires":[["a937e798.114e68"]]},{"id":"e9bf6db5.cb9f2","type":"link out","z":"1709892a.5599b7","name":"T2_side_0","links":["cc3d0766.8f63f8","b37fe6e6.3d71b8"],"x":975,"y":160,"wires":[]},{"id":"e9a7303a.9f02d","type":"ui_gauge","z":"1709892a.5599b7","name":"Вага","group":"58a81001.1f32","order":0,"width":0,"height":0,"gtype":"gage","title":"Вага, кг","label":"units","format":"{{value}}","min":0,"max":"60000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"20000","seg2":"40000","x":330,"y":700,"wires":[]},{"id":"1ec0bd33.c440e3","type":"link out","z":"2c87636e.674b4c","name":"scale","links":["18925025.9dd51"],"x":715,"y":160,"wires":[]},{"id":"1409dbc7.c85114","type":"function","z":"2c87636e.674b4c","name":"","func":"msg.payload = global.set(\"weight\",Number(msg.payload));\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":160,"wires":[["1ec0bd33.c440e3"]]},{"id":"18925025.9dd51","type":"link in","z":"1709892a.5599b7","name":"scale","links":["1ec0bd33.c440e3"],"x":100,"y":700,"wires":[["e9a7303a.9f02d","58b96256.9c8cec"]]},{"id":"ec12e6f5.050a98","type":"ui_text","z":"1709892a.5599b7","group":"3a2d5b4d.7fee24","order":4,"width":0,"height":0,"name":"","label":"ID:","format":"{{msg.payload}}","layout":"row-spread","x":590,"y":540,"wires":[]},{"id":"a937e798.114e68","type":"ui_text","z":"1709892a.5599b7","group":"3a2d5b4d.7fee24","order":6,"width":0,"height":0,"name":"","label":"ID:","format":"{{msg.payload}}","layout":"row-spread","x":590,"y":580,"wires":[]},{"id":"568ca427.fc834c","type":"debug","z":"1709892a.5599b7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":460,"wires":[]},{"id":"f1b8f21c.15e3d","type":"link in","z":"1709892a.5599b7","name":"","links":["e4690a36.062b38"],"x":75,"y":480,"wires":[["b65c0957.beb6e8","17b01bd4.930de4"]]},{"id":"236fb509.93f16a","type":"link in","z":"1709892a.5599b7","name":"","links":["48cfc8e4.24e988"],"x":75,"y":520,"wires":[["f155910.714a27","71eca643.f4ff28"]]},{"id":"3e893bd9.7da214","type":"link in","z":"1709892a.5599b7","name":"","links":["243f72de.9dc35e"],"x":75,"y":560,"wires":[["feda3e8f.278aa"]]},{"id":"b65c0957.beb6e8","type":"function","z":"1709892a.5599b7","name":"1 nfc","func":"flow.set(\"nfc_1\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":480,"wires":[[]]},{"id":"f155910.714a27","type":"function","z":"1709892a.5599b7","name":"2 nfc","func":"flow.set(\"nfc_2\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":520,"wires":[["ec12e6f5.050a98"]]},{"id":"feda3e8f.278aa","type":"function","z":"1709892a.5599b7","name":"3 nfc","func":"flow.set(\"nfc_3\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":560,"wires":[["a937e798.114e68"]]},{"id":"7d6b5319.cb2d2c","type":"link out","z":"8d474e3a.15c34","name":"Периметр в'їзд","links":["7514037d.5b9f2c","c7693f9.7ef73c"],"x":515,"y":320,"wires":[]},{"id":"b6176c6b.9669","type":"link out","z":"8d474e3a.15c34","name":"Периметр виїзд","links":["966b595.c20f7a8","41192ee0.1c066"],"x":515,"y":460,"wires":[]},{"id":"7514037d.5b9f2c","type":"link in","z":"1709892a.5599b7","name":"","links":["7d6b5319.cb2d2c"],"x":95,"y":800,"wires":[["bc73f4a5.22dcc8"]]},{"id":"966b595.c20f7a8","type":"link in","z":"1709892a.5599b7","name":"","links":["b6176c6b.9669"],"x":95,"y":840,"wires":[["d56e4fd4.3a9ff"]]},{"id":"6d098823.88f858","type":"ui_text","z":"1709892a.5599b7","group":"e0de19b5.b05f58","order":2,"width":0,"height":0,"name":"","label":"Статус в'їзд","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":800,"wires":[]},{"id":"8315a3cf.7243","type":"ui_text","z":"1709892a.5599b7","group":"e0de19b5.b05f58","order":1,"width":0,"height":0,"name":"","label":"Статус виїзд","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":840,"wires":[]},{"id":"bc73f4a5.22dcc8","type":"function","z":"1709892a.5599b7","name":"","func":"if(msg.payload == 1){\n    msg.payload = \"В нормі\"\n}else{\n    msg.payload = \"Порушений\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":800,"wires":[["6d098823.88f858"]]},{"id":"d56e4fd4.3a9ff","type":"function","z":"1709892a.5599b7","name":"","func":"if(msg.payload == 1){\n    msg.payload = \"В нормі\"\n}else{\n    msg.payload = \"Порушений\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":840,"wires":[["8315a3cf.7243"]]},{"id":"b98adba1.751df8","type":"ui_button","z":"1709892a.5599b7","name":"","group":"3a2d5b4d.7fee24","order":7,"width":0,"height":0,"passthru":false,"label":"Зважування завершене","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":290,"y":640,"wires":[["47efe056.ce951"]]},{"id":"47efe056.ce951","type":"function","z":"1709892a.5599b7","name":"","func":"msg.payload = \"\";\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":640,"wires":[["ec12e6f5.050a98","a937e798.114e68"]]},{"id":"17b01bd4.930de4","type":"debug","z":"1709892a.5599b7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":230,"y":420,"wires":[]},{"id":"71eca643.f4ff28","type":"debug","z":"1709892a.5599b7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":430,"y":420,"wires":[]},{"id":"789d583e.0b0fd8","type":"http in","z":"d273f23a.da887","name":"","url":"/api/platform/setAccessTable","method":"post","upload":false,"swaggerDoc":"","x":160,"y":240,"wires":[["588f84a4.a46d6c","806c4b1a.348198"]]},{"id":"588f84a4.a46d6c","type":"function","z":"d273f23a.da887","name":"set Access Table","func":"// var accessTable = [exampleAcess];\n// var exampleAcess = {\n//     \"pointID\":\"35235325325235\"\n//     \"ip\":\"10.3.5.210\",\n//     \"antennaID\":\"1\",\n//     \"direction\":0,\n//     \"tags\":[\"124124\",\"3525235\"],\n//     \"gpo\":['80','00'],\n//      \"marked\":false\n// }\n\nflow.set('accessTable',msg.payload);\nflow.set('accessTableUpdate',new Date());\nmsg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":240,"wires":[["7fb674bf.c9b9fc"]]},{"id":"7fb674bf.c9b9fc","type":"http response","z":"d273f23a.da887","name":"","x":630,"y":240,"wires":[]},{"id":"74fa4ca8.126424","type":"inject","z":"d273f23a.da887","name":"init","repeat":"","crontab":"","once":true,"topic":"","payload":"","payloadType":"str","x":110,"y":40,"wires":[["ee204bca.eacc88"]]},{"id":"ee204bca.eacc88","type":"function","z":"d273f23a.da887","name":"NFC conf","func":"//040300000012000001dd0000db0007000280 - 02 GPO index, 80 or 00 - on/off\nflow.set('accessTable',[]);\n//timeout for delay to getting infrared state, ms\nflow.set('infraredtimeout',5000);\nglobal.set('zeroWeight',false);\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":40,"wires":[["461aa1ed.4744b"]]},{"id":"ed5514ef.316888","type":"function","z":"d273f23a.da887","name":"get row from Access Table","func":"var aT = flow.get('accessTable');\nvar serviceTagsObj = flow.get('serviceTagsObj');\nmsg.do = false;\n\nif(serviceTagsObj[msg.tag.tagID.toUpperCase()] === 'service'){\n    msg.do = true;\n}\n\nfor (var i = 0; i < aT.length; i++){\n    var temp_tags = aT[i].tags.slice();\n    if ((aT[i].ip === msg.ip) && (Number(aT[i].antenna)===msg.antennaID) && (temp_tags.indexOf(msg.tag.tagID) >= 0)&&!(aT[i].done)){\n        msg.accessTable = aT[i];\n        msg.aTLength = aT.length;\n        if ((aT[i].pointID != \"Неопределенно\")){\n            aT[i].done = true;\n        }\n        \n        break;\n     }\n}\nmsg.temp_tags = temp_tags;\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":360,"wires":[["5269607c.4410d"]]},{"id":"c6ff3d8b.4dc71","type":"function","z":"d273f23a.da887","name":"get IP","func":"msg.tagID = msg.payload;\nvar  s = \"-\";\nmsg.tagID = msg.tagID.substring(0,2)+s+msg.tagID.substring(2,4)+s+msg.tagID.substring(4,6)+s+msg.tagID.substring(6,8);\nmsg.tag   = {\"tagID\":msg.tagID};\nmsg.antennaID = msg.antennaID;\nmsg.elk_log = JSON.stringify({\n    tagID: msg.tagID,\n    antennaID: msg.antennaID,\n    antennaIP: msg.ip\n});\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":360,"wires":[["ed5514ef.316888","af4da576.b8ec08"]]},{"id":"5bd246e1.952278","type":"http in","z":"d273f23a.da887","name":"","url":"/api/platform/getReaderConfig","method":"get","upload":false,"swaggerDoc":"","x":180,"y":600,"wires":[["89357db4.cddda","c44e38f7.a9da48"]]},{"id":"d0141e9a.a242c","type":"http response","z":"d273f23a.da887","name":"","x":630,"y":600,"wires":[]},{"id":"8d5a640d.ab98d8","type":"http in","z":"d273f23a.da887","name":"","url":"/api/platform/setDefaultTable","method":"post","upload":false,"swaggerDoc":"","x":160,"y":300,"wires":[["1a648e8f.3b50a1","9eb00852.b34f78","5333434f.05a7ac"]]},{"id":"1a648e8f.3b50a1","type":"function","z":"d273f23a.da887","name":"set default Table","func":"// var accessTable = [];\n// var exampleAcess = {\n//     \"ip\":\"10.3.5.210\",\n//     \"port\":5084,\n//     \"gpo\":['0180','0200']\n// }\n\nflow.set('accessTable',msg.payload);\nmsg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":320,"wires":[["38fd9560.4d6aea"]]},{"id":"38fd9560.4d6aea","type":"http response","z":"d273f23a.da887","name":"","x":630,"y":320,"wires":[]},{"id":"3fcb323b.64a61e","type":"function","z":"d273f23a.da887","name":"FRONT","func":"msg.ip = \"NFC_front\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"x":220,"y":360,"wires":[["c6ff3d8b.4dc71"]]},{"id":"1a7fb23b.77adde","type":"function","z":"d273f23a.da887","name":"IN","func":"msg.ip = \"NFC_in_3\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":210,"y":400,"wires":[["c6ff3d8b.4dc71"]]},{"id":"c518bdc1.93457","type":"function","z":"d273f23a.da887","name":"OUT","func":"msg.ip = \"NFC_out_3\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":210,"y":440,"wires":[["c6ff3d8b.4dc71"]]},{"id":"f334d058.b42b7","type":"http in","z":"d273f23a.da887","name":"","url":"/api/platform/setReaderConfig","method":"post","upload":false,"swaggerDoc":"","x":660,"y":40,"wires":[["95191f46.d5bac","1746cbe8.16de04","fd95d25d.04849","4d5ae2d3.60b14c"]]},{"id":"95191f46.d5bac","type":"http response","z":"d273f23a.da887","name":"","x":910,"y":100,"wires":[]},{"id":"c0318d4c.78b13","type":"inject","z":"d273f23a.da887","name":"","repeat":"","crontab":"","once":false,"onceDelay":"","topic":"","payload":"puller","payloadType":"flow","x":100,"y":780,"wires":[[]]},{"id":"5cbdfa13.cdc774","type":"inject","z":"d273f23a.da887","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"str","x":93.5,"y":840,"wires":[["bd96cba6.5bbea8"]]},{"id":"bd96cba6.5bbea8","type":"function","z":"d273f23a.da887","name":"get row from Access Table","func":"var aT = flow.get('accessTable');\nvar aTDate = flow.get('accessTableUpdate');\nvar nowDate = Date();\nvar diff = 2000;\n\nmsg.do = true;\n//if access table is not actual\nif (nowDate-aTDate > diff){\n    msg.do = false;\n}else{\nfor (var i = 0; i < aT.length; i++){\n    if ((aT[i].ip === msg.ip)&&Number(aT[i].antenna)===msg.tag.antennaID){\n        msg.accessTable = aT[i];\n        msg.aTLength = aT.length;\n        break;\n     }\n}\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":294,"y":840,"wires":[[]]},{"id":"12975c5d.7f9264","type":"function","z":"d273f23a.da887","name":"send to 1C","func":"msg.url = flow.get('host1C');\nmsg.tag.lastSeenTimestampUTC = new Date();\nmsg.tag.ip = msg.ip;\nmsg.tag.antenna = String(msg.antennaID);\nmsg.tag.antennaID = String(msg.antennaID);\nmsg.tag.direction = 'IN';\nmsg.tag.weight = JSON.parse(msg.payload);\n\nmsg.payload = [msg.tag];\n\nglobal.set('zeroWeight',false);\nreturn msg;","outputs":1,"noerr":0,"x":2230,"y":520,"wires":[["f1fad05f.08476","6b19c562.24ac9c","a2cb0a1b.f2c9b8"]]},{"id":"a2cb0a1b.f2c9b8","type":"http request","z":"d273f23a.da887","name":"to 1C","method":"POST","ret":"txt","url":"","tls":"","x":2390,"y":520,"wires":[["6b19c562.24ac9c"]]},{"id":"461aa1ed.4744b","type":"function","z":"d273f23a.da887","name":"1C conf","func":"//var host1C = \"http://s-app-mir-test/rfid_mir_test/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\n//var host1C = \"http://s-app-yag-test/UE_yag/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\n//var host1C = \"http://10.3.45.253/UE_yag/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\nvar host1C = \"http://10.3.6.253/UE_laz/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\n\nflow.set('host1C',host1C);\nflow.set('actualDiff',86900); //сколько секунда таблица доступа актуальна\nmsg.url = host1C;\nflow.set('puller',[]);\nflow.set('puller_timeout_sec',30);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":40,"wires":[["57458e0c.dc53c"]]},{"id":"1746cbe8.16de04","type":"function","z":"d273f23a.da887","name":"","func":"msg.payload.ip = msg.req.query.rfidID;\nmsg.payload.event_name = \"Отправка команды\";\nmsg.payload.event_desc = msg.payload.event_name+\" \"+msg.payload.ip+\" \"+msg.payload.cmd;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":20,"wires":[["a48d4b0e.208e28"]]},{"id":"57458e0c.dc53c","type":"http request","z":"d273f23a.da887","name":"","method":"GET","ret":"txt","url":"","tls":"","x":190,"y":80,"wires":[["d2253524.7a7c78"]]},{"id":"d2253524.7a7c78","type":"function","z":"d273f23a.da887","name":"set Access Table","func":"flow.set('accessTable',JSON.parse(msg.payload));\nflow.set('accessTableUpdate',new Date());\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":80,"wires":[["c42ad77e.928508","3d0c7cab.16ff04"]]},{"id":"ab9c685e.4d8778","type":"function","z":"d273f23a.da887","name":"Filling Puller","func":"var puller = flow.get('puller');\nvar puller_timeout_sec = flow.get('puller_timeout_sec');\nvar current_element = {\n    'ip':msg.ip,\n    'tagID':msg.tagID,\n    'antennaID':msg.tag.antennaID,\n    'lastSeenTimestampUTC':new Date()\n}\nvar pull = true;\nvar finded = false\nfor (var i = 0; i < puller.length; i++){\n    var element = puller[i];\n    if ((element.ip === current_element.ip)&&(element.tagID===current_element.tagID)&&(element.antennaID===current_element.antennaID)){\n        var diff = (current_element.lastSeenTimestampUTC-element.lastSeenTimestampUTC)*1000;\n        if (diff < puller_timeout_sec){\n            pull = false; \n        }else{\n            puller[i]=current_element;\n        }\n        finded = true;\n    }\n}\nif (!finded){\n    puller.push(current_element);\n}\n\nflow.set('puller',puller);\nmsg.pull = pull;\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":500,"wires":[["52fc8e57.38e32"]]},{"id":"52fc8e57.38e32","type":"switch","z":"d273f23a.da887","name":"","property":"pull","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":750,"y":500,"wires":[["b4f7a034.7af3f"]]},{"id":"afd45ead.b9b3a","type":"link in","z":"d273f23a.da887","name":"","links":["e4690a36.062b38"],"x":75,"y":360,"wires":[["3fcb323b.64a61e"]]},{"id":"50121f5b.25501","type":"link in","z":"d273f23a.da887","name":"","links":["48cfc8e4.24e988"],"x":75,"y":400,"wires":[["1a7fb23b.77adde"]]},{"id":"84e148f6.ca0c98","type":"link in","z":"d273f23a.da887","name":"","links":["243f72de.9dc35e"],"x":75,"y":440,"wires":[["c518bdc1.93457"]]},{"id":"c643ee25.9b63b","type":"function","z":"8d474e3a.15c34","name":"infrared state 1","func":"global.set('infraredstate1',msg.payload);\nglobal.set('infraredstate1Date', new Date());\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":260,"wires":[[]]},{"id":"955d33b0.6a0b","type":"function","z":"8d474e3a.15c34","name":"infrared state 2","func":"global.set('infraredstate2Date', new Date());\nglobal.set('infraredstate2', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":500,"wires":[[]]},{"id":"89357db4.cddda","type":"function","z":"d273f23a.da887","name":"check infrared state","func":"var payload = {\n    'infraredstate1':0,\n    'infraredstate2':0\n}\nvar infraredtimeout = flow.get('infraredtimeout');\nvar cDate = new Date();\nif ((cDate - global.get('infraredstate1Date')) < infraredtimeout){\n    payload.infraredstate1 = global.get('infraredstate1') ;   \n}\n\nif ((cDate - global.get('infraredstate2Date')) < infraredtimeout){\n    payload.infraredstate2 = global.get('infraredstate2') ;   \n}\n\nmsg.payload = {\"infraredstate\":payload.infraredstate1 == 1 && payload.infraredstate2 == 1};\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":600,"wires":[["d0141e9a.a242c"]]},{"id":"2435d9a1.585386","type":"switch","z":"d273f23a.da887","name":"board_in_out","property":"ip","propertyType":"msg","rules":[{"t":"eq","v":"board_in","vt":"str"},{"t":"eq","v":"board_in2","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1010,"y":160,"wires":[["7251b910.afa5a8"],["bbae61e3.cda12"]]},{"id":"7251b910.afa5a8","type":"switch","z":"d273f23a.da887","name":"green/red","property":"cmd","propertyType":"msg","rules":[{"t":"eq","v":"0100","vt":"str"},{"t":"eq","v":"0180","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1200,"y":40,"wires":[["d459ee31.afc7e"],["27c957eb.27eed8"]]},{"id":"fd95d25d.04849","type":"function","z":"d273f23a.da887","name":"","func":"msg.ip      = msg.req.query.rfidID;\nmsg.cmd     = msg.payload.cmd;\nreturn msg;","outputs":"1","noerr":0,"x":910,"y":60,"wires":[["2435d9a1.585386","b0f4f8b2.955658"]]},{"id":"1daa304b.8af1f","type":"http in","z":"d273f23a.da887","name":"","url":"/api/platform/setBoardText","method":"post","upload":false,"swaggerDoc":"","x":150,"y":680,"wires":[["919bd4e3.b6f1f8","c232535.26d34b"]]},{"id":"919bd4e3.b6f1f8","type":"function","z":"d273f23a.da887","name":"get boarad ID","func":"msg.ip      = msg.req.query.boardID;\nreturn msg;","outputs":"1","noerr":0,"x":400,"y":680,"wires":[["5efd75a6.3ab0ec","eb7e986e.1f5658","37a38484.e291ec"]]},{"id":"5efd75a6.3ab0ec","type":"switch","z":"d273f23a.da887","name":"board_in_out","property":"ip","propertyType":"msg","rules":[{"t":"eq","v":"board_in","vt":"str"},{"t":"eq","v":"board_in2","vt":"str"},{"t":"eq","v":"board_upload","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":590,"y":680,"wires":[["4bdfc10a.26301"],["97a45d05.7621f"],["c7c6c0b0.88847"]]},{"id":"4bdfc10a.26301","type":"link out","z":"d273f23a.da887","name":"1c to Board 1_S0 (rest)","links":["97059c09.7eb39","2cbfc58e.c4996a"],"x":735,"y":640,"wires":[]},{"id":"97a45d05.7621f","type":"link out","z":"d273f23a.da887","name":"1c to Board 2_S1 (rest)","links":["5ff6eb49.f272b4","a4b324e.6e512d8"],"x":735,"y":700,"wires":[]},{"id":"eb7e986e.1f5658","type":"http response","z":"d273f23a.da887","name":"","statusCode":"","headers":{},"x":530,"y":740,"wires":[]},{"id":"58d86e48.ac527","type":"http request","z":"d273f23a.da887","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://10.3.6.247:4000/auth/login","tls":"","persist":false,"proxy":"","authType":"","x":1310,"y":440,"wires":[["bfd563f.1db27a"]]},{"id":"4c31e5ff.e2624c","type":"function","z":"d273f23a.da887","name":"Авторизация на весах","func":"flow.set('access_granted',false);\nmsg.payload = {\n    \"username\":\"user\", \n    \"password\":\"user\"\n}\nmsg.headers = {\n    \"Content-Type\":\"application/json\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":440,"wires":[["58d86e48.ac527"]]},{"id":"bfd563f.1db27a","type":"function","z":"d273f23a.da887","name":"Получаем токен","func":"var payload = JSON.parse(msg.payload);\n\n\nmsg.headers = {\n    \"token\":payload.token\n}\n\nmsg.url = 'http://10.3.6.247:4000/api/platform/laz_avto3/getWeight/status';\n\nif (msg.tagData){\n    let tagsObj = flow.get('tagsObj');\n    msg.url = msg.url+\"?truck1=\"+encodeURI(msg.tagData.truck1)+\"&truck2=\"+encodeURI(msg.tagData.truck2)+\"&reader=\"+encodeURI(tagsObj[msg.tagData.tagID.toUpperCase()]);\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":440,"wires":[["79beae7d.6abe","e4020d97.ba562"]]},{"id":"79beae7d.6abe","type":"http request","z":"d273f23a.da887","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1690,"y":440,"wires":[["6617533a.79c8ec","412782a8.484b3c"]]},{"id":"58b96256.9c8cec","type":"debug","z":"1709892a.5599b7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":270,"y":740,"wires":[]},{"id":"78e642b4.4a55cc","type":"function","z":"2c87636e.674b4c","name":"в дашборд","func":"msg.payload = Number(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":300,"wires":[["1ec0bd33.c440e3","498febab.d7ad94"]]},{"id":"18a3044.a876efc","type":"comment","z":"9f6e54f6.294ab8","name":"","info":"START1;0;0;1;0;Верхня;Нижня<EOR>\n\nSTART1;0;0;1;іва;фів;","x":100,"y":40,"wires":[]},{"id":"d645075e.7c4d28","type":"inject","z":"9f6e54f6.294ab8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":80,"wires":[["de19f9e6.a642e8"]]},{"id":"fb1ec659.a81658","type":"inject","z":"9f6e54f6.294ab8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":440,"wires":[["2a18641f.1479bc"]]},{"id":"de19f9e6.a642e8","type":"function","z":"9f6e54f6.294ab8","name":"ТЕСТ 1 сторона 0","func":"\nvar num_avto_r1 = \"1111\";\nvar num_avto_r2 = \"13200 кг\";\n\n\nmsg.payload =\"START1;0;0;1;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n//            START1;0;0;1;0;Верхня;Нижня<EOR>            \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":80,"wires":[["a6c830a5.ece67"]]},{"id":"2a18641f.1479bc","type":"function","z":"9f6e54f6.294ab8","name":"ТЕСТ сторона 1","func":"\nvar num_avto_r1 = \" 123  \";\nvar num_avto_r2 = \" ТЕск кг \";\n\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n           \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":440,"wires":[["a6c830a5.ece67"]]},{"id":"a6c830a5.ece67","type":"converter","z":"9f6e54f6.294ab8","name":"","from":"win1251","x":1000,"y":560,"wires":[["98617429.ca6c28"]]},{"id":"98617429.ca6c28","type":"tcp out","z":"9f6e54f6.294ab8","host":"10.3.6.227","port":"9761","beserver":"client","base64":false,"end":false,"name":"","x":1200,"y":460,"wires":[]},{"id":"39514863.7c3a88","type":"inject","z":"9f6e54f6.294ab8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":560,"wires":[["943e49d4.d77c88"]]},{"id":"943e49d4.d77c88","type":"function","z":"9f6e54f6.294ab8","name":"погасити світлофори СТ_1","func":"\n\n\nmsg.payload =\"START1;0;0;3;0;0;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":560,"wires":[["6ccc0f83.d9e53","98617429.ca6c28"]]},{"id":"6ccc0f83.d9e53","type":"debug","z":"9f6e54f6.294ab8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":560,"wires":[]},{"id":"5dbc734b.3ed67c","type":"debug","z":"9f6e54f6.294ab8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":480,"wires":[]},{"id":"a2a2277.aa61fd8","type":"debug","z":"9f6e54f6.294ab8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":520,"wires":[]},{"id":"e194cb4.1053338","type":"function","z":"9f6e54f6.294ab8","name":"Світлофор червний СТ_1","func":"\n\n\nmsg.payload =\"START1;0;1;3;0;1;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":520,"wires":[["a2a2277.aa61fd8","98617429.ca6c28"]]},{"id":"78cd42fa.838efc","type":"function","z":"9f6e54f6.294ab8","name":"Світлофор зелений СТ_1","func":"\n\n\nmsg.payload =\"START1;0;0;3;0;2;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":480,"wires":[["5dbc734b.3ed67c","98617429.ca6c28"]]},{"id":"2f224ab4.bddcc6","type":"inject","z":"9f6e54f6.294ab8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":480,"wires":[["78cd42fa.838efc"]]},{"id":"3b6896d9.d4023a","type":"inject","z":"9f6e54f6.294ab8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":520,"wires":[["e194cb4.1053338"]]},{"id":"91c9c3fc.601f3","type":"comment","z":"9f6e54f6.294ab8","name":"СТОРОНА 0","info":"START1;0;0;1;0;Верхня;Нижня<EOR>\n\nSTART1;0;0;1;іва;фів;","x":70,"y":180,"wires":[]},{"id":"cdae85a0.fd66b8","type":"inject","z":"9f6e54f6.294ab8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":120,"wires":[["7602d397.415c8c"]]},{"id":"7602d397.415c8c","type":"function","z":"9f6e54f6.294ab8","name":"яскравість 100 всі сторони","func":"\n\n\nmsg.payload =\"START1;0;0;102;255;255;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":340,"y":120,"wires":[["98617429.ca6c28"]]},{"id":"66437ea3.ad74f","type":"comment","z":"37f9888b.bf2178","name":"","info":"START1;0;0;1;0;Верхня;Нижня<EOR>\n\nSTART1;0;0;1;іва;фів;","x":80,"y":20,"wires":[]},{"id":"3dad6295.345e6e","type":"inject","z":"37f9888b.bf2178","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":220,"wires":[["ca2871f5.97ce6"]]},{"id":"ca2871f5.97ce6","type":"function","z":"37f9888b.bf2178","name":"ТЕСТ сторона 1","func":"\nvar num_avto_r1 = \" 7777  \";\nvar num_avto_r2 = \" ТЕск кг \";\n\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n           \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":220,"wires":[["61abb34e.0af6cc"]]},{"id":"61abb34e.0af6cc","type":"converter","z":"37f9888b.bf2178","name":"","from":"win1251","x":900,"y":440,"wires":[["f34934a.5ed3bc8"]]},{"id":"f34934a.5ed3bc8","type":"tcp out","z":"37f9888b.bf2178","host":"10.3.6.225","port":"9761","beserver":"client","base64":false,"end":false,"name":"","x":1240,"y":400,"wires":[]},{"id":"419e376b.002c48","type":"inject","z":"37f9888b.bf2178","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":340,"wires":[["56dadc4c.3900c4"]]},{"id":"56dadc4c.3900c4","type":"function","z":"37f9888b.bf2178","name":"погасити світлофори СТ_1","func":"\n\n\nmsg.payload =\"START1;0;0;3;0;0;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":340,"wires":[["120b560b.8d61da","f34934a.5ed3bc8"]]},{"id":"120b560b.8d61da","type":"debug","z":"37f9888b.bf2178","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":810,"y":340,"wires":[]},{"id":"3ec352f4.e7325e","type":"debug","z":"37f9888b.bf2178","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":810,"y":260,"wires":[]},{"id":"cb9111ce.e675a","type":"debug","z":"37f9888b.bf2178","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":810,"y":300,"wires":[]},{"id":"d58b0a41.dcdcb8","type":"function","z":"37f9888b.bf2178","name":"Світлофор червний СТ_1","func":"\n\n\nmsg.payload =\"START1;0;1;3;0;1;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":300,"wires":[["cb9111ce.e675a","f34934a.5ed3bc8"]]},{"id":"511c689e.bbdbe8","type":"function","z":"37f9888b.bf2178","name":"Світлофор зелений СТ_1","func":"\n\n\nmsg.payload =\"START1;0;0;3;0;2;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":260,"wires":[["3ec352f4.e7325e","f34934a.5ed3bc8"]]},{"id":"a4a70240.bb9e8","type":"inject","z":"37f9888b.bf2178","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":260,"wires":[["511c689e.bbdbe8"]]},{"id":"e9c06439.0d27b8","type":"inject","z":"37f9888b.bf2178","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":300,"wires":[["d58b0a41.dcdcb8"]]},{"id":"378be6f6.a1c01a","type":"comment","z":"37f9888b.bf2178","name":"СТОРОНА 0","info":"START1;0;0;1;0;Верхня;Нижня<EOR>\n\nSTART1;0;0;1;іва;фів;","x":90,"y":100,"wires":[]},{"id":"a122f4dc.6beea8","type":"inject","z":"37f9888b.bf2178","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":60,"wires":[["e7b366cc.4bb2c8"]]},{"id":"e7b366cc.4bb2c8","type":"function","z":"37f9888b.bf2178","name":"яскравість 100 всі сторони","func":"\n\n\nmsg.payload =\"START1;0;0;102;255;255;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":320,"y":60,"wires":[["f34934a.5ed3bc8"]]},{"id":"883f1516.0c5fe8","type":"function","z":"9f6e54f6.294ab8","name":"Дані строки з форми СТ_1","func":"var num_avto_r1 = msg.payload.r1;\nvar num_avto_r2 = msg.payload.r2;\n\n\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":400,"wires":[["a6c830a5.ece67"]]},{"id":"f079f3b4.d480e","type":"function","z":"37f9888b.bf2178","name":"Дані строки з форми СТ_1","func":"var num_avto_r1 = msg.payload.r1;\nvar num_avto_r2 = msg.payload.r2;\n\n\n             \nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":180,"wires":[["61abb34e.0af6cc"]]},{"id":"2646c0c2.56bd1","type":"function","z":"9f6e54f6.294ab8","name":"Дані строки з NFC CТ_1","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":360,"wires":[[]]},{"id":"522aa08c.460eb","type":"ui_form","z":"1709892a.5599b7","name":"","label":"Табло 1 IN Сторона 1 (Від вагів)","group":"fdac088b.b70e68","order":1,"width":0,"height":0,"options":[{"label":"Номер","value":"r1","type":"text","required":false},{"label":"Вага","value":"r2","type":"text","required":false}],"formValue":{"r1":"","r2":""},"payload":"","submit":"submit","cancel":"cancel","topic":"","x":470,"y":160,"wires":[["3356668a.67fc9a"]]},{"id":"25b15442.7906ac","type":"ui_form","z":"1709892a.5599b7","name":"","label":"Табло2 OUT Сторона 1 (До вагів)","group":"30afbb8f.c2fee4","order":1,"width":0,"height":0,"options":[{"label":"Номер","value":"r1","type":"text","required":false},{"label":"Вага","value":"r2","type":"text","required":false}],"formValue":{"r1":"","r2":""},"payload":"","submit":"submit","cancel":"cancel","topic":"","x":1160,"y":160,"wires":[["8ea2ad30.fc865"]]},{"id":"3356668a.67fc9a","type":"link out","z":"1709892a.5599b7","name":"T1 _ side 1","links":["40a1e5fb.6a3f4c"],"x":635,"y":160,"wires":[]},{"id":"8ea2ad30.fc865","type":"link out","z":"1709892a.5599b7","name":"T2_side 1","links":["2cd54aa.719d7b6"],"x":1335,"y":160,"wires":[]},{"id":"40a1e5fb.6a3f4c","type":"link in","z":"37f9888b.bf2178","name":"","links":["3356668a.67fc9a"],"x":375,"y":180,"wires":[["f079f3b4.d480e"]]},{"id":"162819f.c1f9fe6","type":"ui_button","z":"1709892a.5599b7","name":"","group":"fdac088b.b70e68","order":1,"width":0,"height":0,"passthru":true,"label":"Зелений","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":400,"y":200,"wires":[["4ca30032.c6219"]]},{"id":"c70feb0d.d24f28","type":"ui_button","z":"1709892a.5599b7","name":"","group":"fdac088b.b70e68","order":1,"width":0,"height":0,"passthru":true,"label":"Червоний","tooltip":"","color":"","bgcolor":"red","icon":"","payload":"","payloadType":"date","topic":"","x":400,"y":240,"wires":[["41f50adb.e649f4"]]},{"id":"d9b7d03f.dbfb8","type":"ui_button","z":"1709892a.5599b7","name":"","group":"fdac088b.b70e68","order":1,"width":0,"height":0,"passthru":true,"label":"Погасити","tooltip":"","color":"","bgcolor":"gray","icon":"","payload":"","payloadType":"date","topic":"","x":400,"y":280,"wires":[["25a8c452.d7e73c"]]},{"id":"2bd92e6b.965b32","type":"ui_button","z":"1709892a.5599b7","name":"","group":"30afbb8f.c2fee4","order":1,"width":0,"height":0,"passthru":true,"label":"Зелений","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":1160,"y":200,"wires":[["380238d0.268288"]]},{"id":"74747b0c.c18444","type":"ui_button","z":"1709892a.5599b7","name":"","group":"30afbb8f.c2fee4","order":1,"width":0,"height":0,"passthru":true,"label":"Червоний","tooltip":"","color":"","bgcolor":"red","icon":"","payload":"","payloadType":"date","topic":"","x":1160,"y":240,"wires":[["f3f1617f.1a17b"]]},{"id":"380238d0.268288","type":"link out","z":"1709892a.5599b7","name":"Зелений Т2","links":["88a26ebd.675cb"],"x":1275,"y":200,"wires":[]},{"id":"f3f1617f.1a17b","type":"link out","z":"1709892a.5599b7","name":"Чероний Т2","links":["9cb6b82e.16d798"],"x":1275,"y":240,"wires":[]},{"id":"35684bfe.0186c4","type":"ui_button","z":"1709892a.5599b7","name":"","group":"30afbb8f.c2fee4","order":1,"width":0,"height":0,"passthru":true,"label":"Погасити","tooltip":"","color":"","bgcolor":"gray","icon":"","payload":"","payloadType":"date","topic":"","x":1160,"y":280,"wires":[["60c2034d.55d30c"]]},{"id":"60c2034d.55d30c","type":"link out","z":"1709892a.5599b7","name":" погасити Т2","links":["15e91c04.e59854"],"x":1275,"y":280,"wires":[]},{"id":"4ca30032.c6219","type":"link out","z":"1709892a.5599b7","name":"T1_side_1_green","links":["1d12d8f3.8135d7"],"x":540,"y":200,"wires":[]},{"id":"41f50adb.e649f4","type":"link out","z":"1709892a.5599b7","name":"T1_side_1_red","links":["c1d3c9f3.11be48"],"x":535,"y":240,"wires":[]},{"id":"25a8c452.d7e73c","type":"link out","z":"1709892a.5599b7","name":"T1_side_1_off","links":["516abf1c.0615d"],"x":535,"y":280,"wires":[]},{"id":"1d12d8f3.8135d7","type":"link in","z":"37f9888b.bf2178","name":"","links":["4ca30032.c6219"],"x":375,"y":280,"wires":[["511c689e.bbdbe8"]]},{"id":"c1d3c9f3.11be48","type":"link in","z":"37f9888b.bf2178","name":"","links":["41f50adb.e649f4","f26a2a5e.db7998","27c957eb.27eed8"],"x":375,"y":320,"wires":[["d58b0a41.dcdcb8"]]},{"id":"516abf1c.0615d","type":"link in","z":"37f9888b.bf2178","name":"","links":["25a8c452.d7e73c"],"x":375,"y":360,"wires":[["56dadc4c.3900c4"]]},{"id":"2cd54aa.719d7b6","type":"link in","z":"9f6e54f6.294ab8","name":"T2_side_1","links":["8ea2ad30.fc865"],"x":355,"y":400,"wires":[["883f1516.0c5fe8"]]},{"id":"88a26ebd.675cb","type":"link in","z":"9f6e54f6.294ab8","name":"T2_side_1_green","links":["380238d0.268288","de74e617.eba2d8","69cc92bd.5da93c"],"x":355,"y":460,"wires":[["78cd42fa.838efc"]]},{"id":"9cb6b82e.16d798","type":"link in","z":"9f6e54f6.294ab8","name":"T2_side_1_red","links":["f3f1617f.1a17b","f26a2a5e.db7998","181efdc9.fa79b2"],"x":355,"y":500,"wires":[["e194cb4.1053338"]]},{"id":"15e91c04.e59854","type":"link in","z":"9f6e54f6.294ab8","name":"T2_side_1_off","links":["60c2034d.55d30c"],"x":355,"y":540,"wires":[["943e49d4.d77c88"]]},{"id":"5a6da5a7.0a1c9c","type":"comment","z":"1709892a.5599b7","name":"До вагів T2 S1","info":"","x":1100,"y":120,"wires":[]},{"id":"289c6371.d15ecc","type":"comment","z":"1709892a.5599b7","name":"Від вагів T1 S1","info":"","x":420,"y":120,"wires":[]},{"id":"ca58e1ed.c8259","type":"comment","z":"37f9888b.bf2178","name":"До вагів T1 S1","info":"","x":240,"y":100,"wires":[]},{"id":"ba4c43ba.f969e","type":"comment","z":"9f6e54f6.294ab8","name":"Від вагів T2 S0","info":"","x":220,"y":180,"wires":[]},{"id":"97059c09.7eb39","type":"link in","z":"37f9888b.bf2178","name":"1C to Board 1","links":["4bdfc10a.26301"],"x":155,"y":520,"wires":[["c1d9ad0e.31cff","7b72b285.30a68c"]]},{"id":"91d5e64c.e1a7a8","type":"link in","z":"37f9888b.bf2178","name":"rfid truck 1 table 1","links":["46f16a9d.111e54"],"x":155,"y":560,"wires":[["8f0b327c.df1cc"]]},{"id":"8f0b327c.df1cc","type":"function","z":"37f9888b.bf2178","name":"Дані строки з NFC","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":330,"y":560,"wires":[["89800f2f.34289","61abb34e.0af6cc"]]},{"id":"89800f2f.34289","type":"switch","z":"37f9888b.bf2178","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"finded","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":560,"wires":[[]]},{"id":"cfa1c75c.70d8b8","type":"function","z":"9f6e54f6.294ab8","name":"Дані строки з NFC","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":220,"wires":[["c5ac1f76.a2f07","a6c830a5.ece67"]]},{"id":"b139a900.fdd868","type":"link in","z":"9f6e54f6.294ab8","name":"rfid truck 1 table 2","links":["46f16a9d.111e54"],"x":195,"y":220,"wires":[["cfa1c75c.70d8b8"]]},{"id":"c5ac1f76.a2f07","type":"switch","z":"9f6e54f6.294ab8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"finded","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":220,"wires":[["e194cb4.1053338"]]},{"id":"896d4bfc.682298","type":"link in","z":"9f6e54f6.294ab8","name":"table_out_green_2_S1","links":["167f0697.799dc9"],"x":175,"y":300,"wires":[["78cd42fa.838efc"]]},{"id":"a59a21d3.110c1","type":"link in","z":"9f6e54f6.294ab8","name":"table_out_red_2_S1","links":["c56bb043.38715"],"x":175,"y":340,"wires":[["e194cb4.1053338"]]},{"id":"a4b324e.6e512d8","type":"link in","z":"9f6e54f6.294ab8","name":"1C to board 2","links":["97a45d05.7621f"],"x":195,"y":760,"wires":[["7dff928c.eee6ac","872f36da.946ae8"]]},{"id":"9bb56269.2c96d","type":"function","z":"9f6e54f6.294ab8","name":"Дані строки з 1C","func":"msg.payload =\"START1;0;0;1;1;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":350,"y":760,"wires":[["a6c830a5.ece67"]]},{"id":"97d48da7.0d6f1","type":"link in","z":"37f9888b.bf2178","name":"1C to Board 1 S1","links":["568c638f.8e6a7c"],"x":195,"y":440,"wires":[["fa106cff.a38be"]]},{"id":"fa106cff.a38be","type":"function","z":"37f9888b.bf2178","name":"Дані строки з 1C","func":"msg.payload =\"START1;0;0;1;0;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":440,"wires":[["61abb34e.0af6cc"]]},{"id":"bbae61e3.cda12","type":"switch","z":"d273f23a.da887","name":"green/red","property":"cmd","propertyType":"msg","rules":[{"t":"eq","v":"0100","vt":"str"},{"t":"eq","v":"0180","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1200,"y":160,"wires":[["69cc92bd.5da93c"],["181efdc9.fa79b2"]]},{"id":"b638d393.8dc4","type":"link in","z":"37f9888b.bf2178","name":"table_in_green_1_S1","links":["7d6cb2dd.738f7c","ad4b3612.0cdb78","d459ee31.afc7e"],"x":215,"y":160,"wires":[["511c689e.bbdbe8"]]},{"id":"67f94f73.4936d","type":"link in","z":"37f9888b.bf2178","name":"table_in_red_1_S1","links":["170079a4.6e9326","be133205.bcff7","27c957eb.27eed8"],"x":215,"y":200,"wires":[["d58b0a41.dcdcb8"]]},{"id":"8acfaffb.45166","type":"http in","z":"d273f23a.da887","name":"","url":"/api/platform/getAccessTable","method":"get","upload":false,"swaggerDoc":"","x":160,"y":160,"wires":[["7b294af2.2d4334","804f7f61.fc7b5"]]},{"id":"7b294af2.2d4334","type":"function","z":"d273f23a.da887","name":"set Access Table","func":"msg.payload = flow.get('accessTable');\nmsg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":160,"wires":[["d5c94848.89e208"]]},{"id":"d5c94848.89e208","type":"http response","z":"d273f23a.da887","name":"","statusCode":"","headers":{},"x":630,"y":160,"wires":[]},{"id":"b4f7a034.7af3f","type":"function","z":"d273f23a.da887","name":"check infrared state","func":"var payload = {\n    'infraredstate1':0,\n    'infraredstate2':0\n}\nvar infraredtimeout = flow.get('infraredtimeout');\nvar cDate = new Date();\nif ((cDate - global.get('infraredstate1Date')) < infraredtimeout){\n    payload.infraredstate1 = global.get('infraredstate1') ;   \n}\n\nif ((cDate - global.get('infraredstate2Date')) < infraredtimeout){\n    payload.infraredstate2 = global.get('infraredstate2') ;   \n}\nmsg.infraredstate1 = Number(payload.infraredstate1.substring(0,1));\nmsg.infraredstate2 = Number(payload.infraredstate2.substring(0,1));\n\nmsg.perimetr = (msg.infraredstate1 == 1 && msg.infraredstate2 == 1);\n\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":500,"wires":[["1d16ee2c.6b47f2"]]},{"id":"f24b3f26.f9849","type":"switch","z":"d273f23a.da887","name":"access_granted","property":"access_granted","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1260,"y":580,"wires":[["870e724a.e03fd"],["9de955b7.0dea28"]]},{"id":"9de955b7.0dea28","type":"function","z":"d273f23a.da887","name":"send text to board","func":"flow.set('temp_tagID',msg.tagID);\n\nmsg.payload = {\n                \"row1\":\"датчик\",\n                \"row2\":\"перекрито\"\n            };\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":640,"wires":[["4bdfc10a.26301","97a45d05.7621f"]]},{"id":"5269607c.4410d","type":"switch","z":"d273f23a.da887","name":"access granted","property":"do","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1000,"y":340,"wires":[["98b12cae.ca4c3"],["ab9c685e.4d8778"]]},{"id":"98b12cae.ca4c3","type":"function","z":"d273f23a.da887","name":"set granted ","func":"flow.set('access_granted',true);\nglobal.set('zeroWeight',true);\nreturn msg;","outputs":1,"noerr":0,"x":1210,"y":340,"wires":[["e36f2853.8a9468"]]},{"id":"e36f2853.8a9468","type":"function","z":"d273f23a.da887","name":"send text to board","func":"msg.payload = {\n                \"row1\":\"пр. карту\",\n                \"row2\":\"#вес\"\n            };\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1430,"y":340,"wires":[["4bdfc10a.26301","97a45d05.7621f"]]},{"id":"8f5e29e9.70c358","type":"http request","z":"d273f23a.da887","name":"to 1C ","method":"POST","ret":"txt","url":"","tls":"","x":2390,"y":560,"wires":[["36399b98.c042f4"]]},{"id":"ef3cf544.b53888","type":"function","z":"d273f23a.da887","name":"Взвесили с пересеченным периметром","func":"var host = 'http://10.3.6.253/UE_laz/hs/PerimeterControl/api/SmartScales/yag_avto2';\nmsg.payload = {\n    'ИдентификаторОбъекта':msg.tag.tagID,\n    'ИдентификаторАктивности':'ab2abea2-8602-11e9-4782-0242ac130003',\n    'ЗначениеВеса':global.get('weight')\n};\nmsg.url = host;\nmsg.headers = {};\nmsg.req = {};\nmsg.res = {};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2140,"y":560,"wires":[["36399b98.c042f4","8f5e29e9.70c358","f1fad05f.08476"]]},{"id":"e7ee304b.a81a7","type":"switch","z":"d273f23a.da887","name":"","property":"perimetr","propertyType":"msg","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":1910,"y":560,"wires":[["ef3cf544.b53888"]]},{"id":"1d16ee2c.6b47f2","type":"switch","z":"d273f23a.da887","name":"perimetr true/false","property":"perimetr","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1030,"y":580,"wires":[["870e724a.e03fd"],["f24b3f26.f9849"]]},{"id":"6617533a.79c8ec","type":"json","z":"d273f23a.da887","name":"","property":"payload","action":"obj","pretty":false,"x":1740,"y":500,"wires":[["f2480ad.742bff8"]]},{"id":"c42ad77e.928508","type":"debug","z":"d273f23a.da887","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":80,"wires":[]},{"id":"870e724a.e03fd","type":"function","z":"d273f23a.da887","name":"1C get Tag Data","func":"msg.url = \"http://10.3.6.253/UE_laz/hs/PerimeterControl/api/PrincipNodeRed/getTagData\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1360,"y":700,"wires":[["b9f85bf5.ffc688"]]},{"id":"b9f85bf5.ffc688","type":"http request","z":"d273f23a.da887","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1570,"y":700,"wires":[["8b81ff6b.6411","6849b41a.2de7dc"]]},{"id":"8b81ff6b.6411","type":"json","z":"d273f23a.da887","name":"","property":"payload","action":"obj","pretty":false,"x":1730,"y":700,"wires":[["505fb4c4.fbb2cc"]]},{"id":"505fb4c4.fbb2cc","type":"function","z":"d273f23a.da887","name":"get tag Data","func":"var tagID   = msg.tag.tagID.toUpperCase();\nvar tagdDataArray = msg.payload;\nvar tagData = {};\nfor(var i=0; i < tagdDataArray.length; i++){\n    if (tagdDataArray[i].tagID === tagID){\n        tagData = tagdDataArray[i];        \n    }\n}\n\nmsg.tagData = tagData;\nmsg.req = {};\nmsg.res = {};\nmsg.url = {};\n\nreturn msg;","outputs":1,"noerr":0,"x":1870,"y":700,"wires":[["4c31e5ff.e2624c"]]},{"id":"6b19c562.24ac9c","type":"debug","z":"d273f23a.da887","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2550,"y":520,"wires":[]},{"id":"ddb439ce.06f768","type":"function","z":"37f9888b.bf2178","name":"Дані строки з 1C","func":"var row1 = flow.get(\"row1\");\nvar row2 = flow.get(\"row2\");\n\n//msg.payload.row1 = flow.get(\"row1\");\n//msg.payload.row2 = flow.get(\"row2\");\n\n\nif(row1 == \"#вес\" ){\n   msg.payload.row1 = global.get(\"weight\");\n   msg.payload.row2 = flow.get(\"row2\"); \n   }else if(row2 == \"#вес\" ){\n   msg.payload.row2 = global.get(\"weight\");\n   msg.payload.row1 = flow.get(\"row1\"); \n}\n\n\nmsg.payload =\"START1;0;0;1;1;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":430,"y":1780,"wires":[["4d66565.f2aeea8"]]},{"id":"4d66565.f2aeea8","type":"debug","z":"37f9888b.bf2178","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":610,"y":1780,"wires":[]},{"id":"181fed83.e39b42","type":"function","z":"37f9888b.bf2178","name":"true","func":"msg.payload = {\n    row2: \"Очіування \",\n    row1: \"#вес\",\n    ident: \"cmd\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":1620,"wires":[["b8e6a53f.842638"]]},{"id":"86e10534.ca2658","type":"function","z":"37f9888b.bf2178","name":"true","func":"msg.payload = {\n    row2: \"Очіування \",\n    row1: \"TEST\",\n    ident: \"cmd\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":233.55554962158203,"y":1574.9166717529297,"wires":[["b8e6a53f.842638"]]},{"id":"24146376.b174cc","type":"inject","z":"37f9888b.bf2178","name":"1с","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"row2\":\"Аналіз\",\"row1\":\"Очікування\",\"ident\":\"cmd\"}","payloadType":"json","x":93.88886260986328,"y":1615.2777700424194,"wires":[["181fed83.e39b42"]]},{"id":"d96230f7.54ad5","type":"switch","z":"37f9888b.bf2178","name":"","property":"cmdOts1","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":190,"y":1780,"wires":[["b8e6a53f.842638"]]},{"id":"2f3feba5.644d64","type":"inject","z":"37f9888b.bf2178","name":"1с","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"row2\":\"Аналіз\",\"row1\":\"Очікування\",\"ident\":\"cmd\"}","payloadType":"json","x":83.19442367553711,"y":1576.9445180892944,"wires":[["86e10534.ca2658"]]},{"id":"1404c1c5.9ebe9e","type":"inject","z":"37f9888b.bf2178","name":"reset","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"msgPayload","payloadType":"flow","x":70,"y":1780,"wires":[["d96230f7.54ad5","b5912b9e.20a388"]]},{"id":"40c6f6f8.babb18","type":"inject","z":"37f9888b.bf2178","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":430,"y":1700,"wires":[["8ae573bc.c3f88"]]},{"id":"8ae573bc.c3f88","type":"function","z":"37f9888b.bf2178","name":"init Змінні для події    #вага","func":"flow.set(\"cmdOts1\",false);\nflow.set(\"msgPayload\",{});\nflow.set(\"row1\",\"\");\nflow.set(\"row2\",\"\");\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":1700,"wires":[[]]},{"id":"2aa2bfc1.d81cb","type":"inject","z":"37f9888b.bf2178","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"weight","payloadType":"global","x":430,"y":1820,"wires":[["50fd2fe2.246a3"]]},{"id":"50fd2fe2.246a3","type":"debug","z":"37f9888b.bf2178","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":1820,"wires":[]},{"id":"7c14a20d.1a097c","type":"inject","z":"37f9888b.bf2178","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":1500,"wires":[[]]},{"id":"5b6c92ef.aea63c","type":"function","z":"37f9888b.bf2178","name":"true","func":"flow.set(\"cmdOts1\",true);\n\n\n\nmsg.payload = {\n    row2: \"Очіування \",\n    row1: \"#вес\",\n    ident: \"cmd\"\n}\n\nflow.set(\"row1\", msg.payload.row1);\nflow.set(\"row2\", msg.payload.row2);\nflow.set(\"msgPayload\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":1500,"wires":[[]]},{"id":"b8e6a53f.842638","type":"function","z":"37f9888b.bf2178","name":"true","func":"var dies_1 = msg.payload.row1;\nvar dies_2 = msg.payload.row2;\n\n    if(dies_1 == \"#вес\" || dies_2 == \"#вес\"){\n        flow.set(\"cmdOts1\",true);\n    }else if(dies_1 !== \"#вес\" && dies_2 !== \"#вес\"){\n        flow.set(\"cmdOts1\",false);\n    }\n\nvar last_mes = {\n    row1: dies_1,\n    row2: dies_2\n}\n\nflow.set(\"row1\", msg.payload.row1);\nflow.set(\"row2\", msg.payload.row2);\nflow.set(\"msgPayload\", last_mes);\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":1620,"wires":[["ddb439ce.06f768","77329eee.6768d"]]},{"id":"47ff1349.a2abcc","type":"inject","z":"37f9888b.bf2178","name":"1с","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"row2\":\"Аналіз\",\"row1\":\"Очікування\",\"ident\":\"cmd\"}","payloadType":"json","x":110,"y":1660,"wires":[["e5b58235.72e23"]]},{"id":"e5b58235.72e23","type":"function","z":"37f9888b.bf2178","name":"true","func":"msg.payload = {\n    row2: \"#вес\",\n    row1: \"АНАЛІЗ\",\n    ident: \"cmd\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":1680,"wires":[["b8e6a53f.842638","c489290.2d20cd8"]]},{"id":"d004f6e4.cc6808","type":"inject","z":"37f9888b.bf2178","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"row1","payloadType":"flow","x":260,"y":1400,"wires":[["464142e8.9a186c"]]},{"id":"464142e8.9a186c","type":"debug","z":"37f9888b.bf2178","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":460,"y":1440,"wires":[]},{"id":"d954138.93e6bf","type":"inject","z":"37f9888b.bf2178","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"row2","payloadType":"flow","x":260,"y":1440,"wires":[["464142e8.9a186c"]]},{"id":"c489290.2d20cd8","type":"debug","z":"37f9888b.bf2178","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":370,"y":1540,"wires":[]},{"id":"77329eee.6768d","type":"debug","z":"37f9888b.bf2178","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":490,"y":1600,"wires":[]},{"id":"b5912b9e.20a388","type":"debug","z":"37f9888b.bf2178","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":210,"y":1860,"wires":[]},{"id":"1e4de5ba.be157a","type":"inject","z":"37f9888b.bf2178","name":"reset","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"msgPayload","payloadType":"flow","x":70,"y":740,"wires":[["596dbfe6.08da9"]]},{"id":"596dbfe6.08da9","type":"switch","z":"37f9888b.bf2178","name":"","property":"cmdOts1","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":190,"y":740,"wires":[["c1d9ad0e.31cff"]]},{"id":"c1d9ad0e.31cff","type":"function","z":"37f9888b.bf2178","name":"true","func":"var dies_1 = msg.payload.row1;\nvar dies_2 = msg.payload.row2;\n\n    if(dies_1 == \"#вес\" || dies_2 == \"#вес\"){\n        flow.set(\"cmdOts1\",true);\n    }else if(dies_1 !== \"#вес\" && dies_2 !== \"#вес\"){\n        flow.set(\"cmdOts1\",false);\n    }\n\nvar last_mes = {\n    row1: dies_1,\n    row2: dies_2\n}\n\nflow.set(\"row1\", msg.payload.row1);\nflow.set(\"row2\", msg.payload.row2);\nflow.set(\"msgPayload\", last_mes);\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":680,"wires":[["2fd83b6f.a8f394"]]},{"id":"2fd83b6f.a8f394","type":"function","z":"37f9888b.bf2178","name":"Дані строки з 1C","func":"var row1 = flow.get(\"row1\");\nvar row2 = flow.get(\"row2\");\n\n//msg.payload.row1 = flow.get(\"row1\");\n//msg.payload.row2 = flow.get(\"row2\");\n\n\nif(row1 == \"#вес\" ){\n   msg.payload.row1 = global.get(\"weight\");\n   msg.payload.row2 = flow.get(\"row2\"); \n   }else if(row2 == \"#вес\" ){\n   msg.payload.row2 = global.get(\"weight\");\n   msg.payload.row1 = flow.get(\"row1\"); \n}\n\n\"START1;0;0;1;0;\"\nmsg.payload =\"START1;0;0;1;0;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":740,"wires":[["74dc8d36.45fc24","61abb34e.0af6cc","49c541b2.3155f"]]},{"id":"74dc8d36.45fc24","type":"debug","z":"37f9888b.bf2178","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":450,"y":780,"wires":[]},{"id":"318ab2d5.eac76e","type":"function","z":"37f9888b.bf2178","name":"init Змінні для події    #вага","func":"flow.set(\"cmdOts1\",false);\nflow.set(\"msgPayload\",{});\nflow.set(\"row1\",\"\");\nflow.set(\"row2\",\"\");\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":640,"wires":[[]]},{"id":"94fbdfa3.c689e","type":"inject","z":"37f9888b.bf2178","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":640,"wires":[["318ab2d5.eac76e"]]},{"id":"2ca79514.80ae5a","type":"inject","z":"9f6e54f6.294ab8","name":"reset","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"msgPayload","payloadType":"flow","x":110,"y":920,"wires":[["176e695f.4d9127"]]},{"id":"176e695f.4d9127","type":"switch","z":"9f6e54f6.294ab8","name":"","property":"cmdOts1","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":230,"y":920,"wires":[["7dff928c.eee6ac"]]},{"id":"7dff928c.eee6ac","type":"function","z":"9f6e54f6.294ab8","name":"true","func":"var dies_1 = msg.payload.row1;\nvar dies_2 = msg.payload.row2;\n\n    if(dies_1 == \"#вес\" || dies_2 == \"#вес\"){\n        flow.set(\"cmdOts1\",true);\n    }else if(dies_1 !== \"#вес\" && dies_2 !== \"#вес\"){\n        flow.set(\"cmdOts1\",false);\n    }\n\nvar last_mes = {\n    row1: dies_1,\n    row2: dies_2\n}\n\nflow.set(\"row1\", msg.payload.row1);\nflow.set(\"row2\", msg.payload.row2);\nflow.set(\"msgPayload\", last_mes);\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":860,"wires":[["c717d15b.4527e"]]},{"id":"c717d15b.4527e","type":"function","z":"9f6e54f6.294ab8","name":"Дані строки з 1C","func":"var row1 = flow.get(\"row1\");\nvar row2 = flow.get(\"row2\");\n\n//msg.payload.row1 = flow.get(\"row1\");\n//msg.payload.row2 = flow.get(\"row2\");\n\n\nif(row1 == \"#вес\" ){\n   msg.payload.row1 = global.get(\"weight\");\n   msg.payload.row2 = flow.get(\"row2\"); \n   }else if(row2 == \"#вес\" ){\n   msg.payload.row2 = global.get(\"weight\");\n   msg.payload.row1 = flow.get(\"row1\"); \n}\n\n\nmsg.payload =\"START1;0;0;1;0;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":920,"wires":[["be0b944d.17d0d8","a6c830a5.ece67"]]},{"id":"cc482ced.741cc","type":"function","z":"9f6e54f6.294ab8","name":"init Змінні для події    #вага","func":"flow.set(\"cmdOts1\",false);\nflow.set(\"msgPayload\",{});\nflow.set(\"row1\",\"\");\nflow.set(\"row2\",\"\");\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":820,"wires":[[]]},{"id":"54291abf.999c04","type":"inject","z":"9f6e54f6.294ab8","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":820,"wires":[["cc482ced.741cc"]]},{"id":"be0b944d.17d0d8","type":"debug","z":"9f6e54f6.294ab8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":510,"y":1000,"wires":[]},{"id":"872f36da.946ae8","type":"debug","z":"9f6e54f6.294ab8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":330,"y":720,"wires":[]},{"id":"7b72b285.30a68c","type":"debug","z":"37f9888b.bf2178","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":310,"y":600,"wires":[]},{"id":"49c541b2.3155f","type":"delay","z":"37f9888b.bf2178","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":510,"y":680,"wires":[["64cdd58e.a119ec"]]},{"id":"64cdd58e.a119ec","type":"delay","z":"37f9888b.bf2178","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":620,"wires":[["e7b366cc.4bb2c8"]]},{"id":"3f704e04.ffe732","type":"function","z":"2c87636e.674b4c","name":"set global zero weight","func":"var weight = Number(msg.payload);\n\nif (weight === 0){\n    global.set('zeroWeight',true);\n}\nmsg.weight = weight;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":400,"wires":[["f4737f25.4de5d","c8db59c6.ee1448"]]},{"id":"f4737f25.4de5d","type":"debug","z":"2c87636e.674b4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":400,"wires":[]},{"id":"78d55b68.334a94","type":"inject","z":"1709892a.5599b7","name":"","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"zeroWeight","payloadType":"global","x":170,"y":360,"wires":[["6a3669cd.b5e118","7fd46015.b1872"]]},{"id":"6a3669cd.b5e118","type":"ui_text","z":"1709892a.5599b7","group":"58a81001.1f32","order":1,"width":0,"height":0,"name":"","label":"Ноль установлен","format":"{{msg.payload}}","layout":"row-spread","x":570,"y":320,"wires":[]},{"id":"412782a8.484b3c","type":"switch","z":"d273f23a.da887","name":"zero Weight","property":"zeroWeight","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1870,"y":440,"wires":[["6074494a.865ce8"],["bd97ae85.2ff1a"]]},{"id":"69f68086.65066","type":"inject","z":"2c87636e.674b4c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":500,"wires":[["9617957d.f6eeb8"]]},{"id":"9617957d.f6eeb8","type":"function","z":"2c87636e.674b4c","name":"","func":" global.set('zeroWeight',true);\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":500,"wires":[[]]},{"id":"bd97ae85.2ff1a","type":"function","z":"d273f23a.da887","name":"send text to board","func":"msg.payload = {\n                \"row1\":\"ваги\",\n                \"row2\":\"не обнулені\"\n            };\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1390,"y":500,"wires":[["4bdfc10a.26301","97a45d05.7621f"]]},{"id":"c8db59c6.ee1448","type":"ui_chart","z":"2c87636e.674b4c","name":"","group":"10e988b.17bb977","order":2,"width":0,"height":0,"label":"Графік ваги","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"-100","ymax":"65000","removeOlder":"10","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":840,"y":180,"wires":[[]]},{"id":"7fd46015.b1872","type":"function","z":"1709892a.5599b7","name":"","func":"msg.payload = Number(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":380,"wires":[["e203e6aa.3705d8"]]},{"id":"e203e6aa.3705d8","type":"ui_chart","z":"1709892a.5599b7","name":"","group":"837b733c.8f5d9","order":4,"width":0,"height":0,"label":"Графік нуля","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"1","removeOlder":"30","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":570,"y":380,"wires":[[]]},{"id":"7710a701.a88668","type":"delay","z":"ef8d74d.cfc5d88","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":620,"y":100,"wires":[["48cfc8e4.24e988"]]},{"id":"3908b655.9e4eea","type":"serial in","z":"ef8d74d.cfc5d88","name":"","serial":"f97acbd4.c351d8","x":230,"y":100,"wires":[["3f4fcc0e.7784d4","5504f2f9.60028c"]]},{"id":"3f4fcc0e.7784d4","type":"function","z":"ef8d74d.cfc5d88","name":"Парсинг строки","func":"var keycode = \"\";\nvar el = \"\";\n\n\nmsg.payload.reverse().forEach(function(element) {\n  if (element.toString('16').length <2) el = \"0\" + element.toString('16'); else el = element.toString('16');\n  keycode = keycode + el;\n});\n\nmsg.payload = keycode;\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":100,"wires":[["1fc55c33.e48524","7710a701.a88668"]]},{"id":"1fc55c33.e48524","type":"debug","z":"ef8d74d.cfc5d88","name":"rfid_in","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","x":600,"y":140,"wires":[]},{"id":"2d3a6d30.325fe2","type":"tcp in","z":"d273f23a.da887","name":"","server":"server","host":"","port":"10001","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":80,"y":540,"wires":[["89e1a7bb.60d418","56654cdf.9a3174"]]},{"id":"89e1a7bb.60d418","type":"function","z":"d273f23a.da887","name":"UPLOAD","func":"msg.ip = \"NFC_upload\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":540,"wires":[["50cecd02.be0134"]]},{"id":"160f0d66.931c63","type":"tcp out","z":"d273f23a.da887","host":"10.3.45.241","port":"10005","beserver":"client","base64":false,"end":false,"name":"","x":800,"y":820,"wires":[]},{"id":"c7c6c0b0.88847","type":"json","z":"d273f23a.da887","name":"","property":"payload","action":"str","pretty":false,"x":630,"y":820,"wires":[["160f0d66.931c63","fec719fa.54e8b8"]]},{"id":"50cecd02.be0134","type":"function","z":"d273f23a.da887","name":"get IP","func":"msg.tagID = msg.payload;\nvar  s = \"-\";\nmsg.tagID = msg.tagID.substring(0,2)+s+msg.tagID.substring(2,4)+s+msg.tagID.substring(4,6)+s+msg.tagID.substring(6,8);\nmsg.tag   = {\"tagID\":msg.tagID};\nmsg.antennaID = msg.antennaID;\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":540,"wires":[["d0539a8e.e765b8"]]},{"id":"d0539a8e.e765b8","type":"function","z":"d273f23a.da887","name":"send to 1C","func":"msg.url = flow.get('host1C');\nmsg.tag.lastSeenTimestampUTC = new Date();\nmsg.tag.ip = msg.ip;\nmsg.tag.antenna = String(msg.antennaID);\nmsg.tag.antennaID = String(msg.antennaID);\nmsg.tag.direction = 'IN';\n\nmsg.payload = [msg.tag];\n\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":540,"wires":[["a2cb0a1b.f2c9b8"]]},{"id":"40bd6d81.003774","type":"ui_button","z":"2c87636e.674b4c","name":"","group":"58a81001.1f32","order":2,"width":0,"height":0,"passthru":false,"label":"Зкинути 0","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":380,"wires":[["9617957d.f6eeb8"]]},{"id":"165c7801.df3368","type":"link in","z":"1709892a.5599b7","name":"","links":["b7b41aad.7f9fc8"],"x":75,"y":960,"wires":[["a873d35.ab0b23"]]},{"id":"8681c44f.4d6a58","type":"link in","z":"1709892a.5599b7","name":"","links":["a192ae63.568f6"],"x":75,"y":1040,"wires":[["c3d33797.3a9c98"]]},{"id":"a873d35.ab0b23","type":"function","z":"1709892a.5599b7","name":"","func":"msg.payload = msg.payload.number;\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":960,"wires":[["22b391d.58e186e"]]},{"id":"22b391d.58e186e","type":"ui_text","z":"1709892a.5599b7","group":"787c258b.c342ec","order":5,"width":0,"height":0,"name":"","label":"Номер вїзд:","format":"{{msg.payload}}","layout":"row-spread","x":310,"y":960,"wires":[]},{"id":"c3d33797.3a9c98","type":"function","z":"1709892a.5599b7","name":"","func":"msg.payload = msg.payload.number;\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":1040,"wires":[["90d9e8a2.b233d8"]]},{"id":"90d9e8a2.b233d8","type":"ui_text","z":"1709892a.5599b7","group":"787c258b.c342ec","order":5,"width":0,"height":0,"name":"","label":"Номер виїзд:","format":"{{msg.payload}}","layout":"row-spread","x":320,"y":1040,"wires":[]},{"id":"ab835ff1.67cf6","type":"rpi-gpio in","z":"8d474e3a.15c34","name":"","pin":"11","intype":"down","debounce":"1000","read":false,"x":200,"y":100,"wires":[["f2e65b93.86fc28"]]},{"id":"f2e65b93.86fc28","type":"debug","z":"8d474e3a.15c34","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":100,"wires":[]},{"id":"f2480ad.742bff8","type":"function","z":"d273f23a.da887","name":"check infrared state","func":"var payload = {\n    'infraredstate1':0,\n    'infraredstate2':0\n}\nvar infraredtimeout = flow.get('infraredtimeout');\nvar cDate = new Date();\nif ((cDate - global.get('infraredstate1Date')) < infraredtimeout){\n    payload.infraredstate1 = global.get('infraredstate1') ;   \n}\n\nif ((cDate - global.get('infraredstate2Date')) < infraredtimeout){\n    payload.infraredstate2 = global.get('infraredstate2') ;   \n}\n\nmsg.infraredstate1 = Number(payload.infraredstate1.substring(0,1));\nmsg.infraredstate2 = Number(payload.infraredstate2.substring(0,1));\nmsg.perimetr = (msg.infraredstate1 == 1 && msg.infraredstate2 == 1);\nreturn msg;","outputs":1,"noerr":0,"x":1750,"y":560,"wires":[["e7ee304b.a81a7"]]},{"id":"36399b98.c042f4","type":"debug","z":"d273f23a.da887","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2550,"y":560,"wires":[]},{"id":"56654cdf.9a3174","type":"debug","z":"d273f23a.da887","name":"tcp:10001","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":260,"y":500,"wires":[]},{"id":"df4a677e.4db5a8","type":"inject","z":"d273f23a.da887","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"123213123","payloadType":"num","x":170,"y":1340,"wires":[["dca4a8ab.3aeaa8"]]},{"id":"dca4a8ab.3aeaa8","type":"debug","z":"d273f23a.da887","name":"test","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":340,"y":1360,"wires":[]},{"id":"fec719fa.54e8b8","type":"debug","z":"d273f23a.da887","name":"board_upload","active":true,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":840,"y":780,"wires":[]},{"id":"ed8d5e8f.d9201","type":"debug","z":"d273f23a.da887","name":"api/platform/setBoardText","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":300,"y":720,"wires":[]},{"id":"52742dd7.4e6204","type":"debug","z":"d273f23a.da887","name":"api/platform/getReaderConfig","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":350,"y":640,"wires":[]},{"id":"c44e38f7.a9da48","type":"json","z":"d273f23a.da887","name":"","property":"payload","action":"str","pretty":false,"x":150,"y":640,"wires":[["52742dd7.4e6204"]]},{"id":"c232535.26d34b","type":"json","z":"d273f23a.da887","name":"","property":"payload","action":"str","pretty":false,"x":110,"y":720,"wires":[["ed8d5e8f.d9201"]]},{"id":"2a64f96.93c6706","type":"inject","z":"ef8d74d.cfc5d88","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"121332","payloadType":"num","x":390,"y":140,"wires":[["1fc55c33.e48524","5504f2f9.60028c"]]},{"id":"dc21d1a5.6d56b","type":"debug","z":"d273f23a.da887","name":"send to 1C","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","x":2420,"y":460,"wires":[]},{"id":"f1fad05f.08476","type":"json","z":"d273f23a.da887","name":"","property":"payload","action":"str","pretty":false,"x":2270,"y":460,"wires":[["dc21d1a5.6d56b"]]},{"id":"9eb00852.b34f78","type":"json","z":"d273f23a.da887","name":"","property":"payload","action":"str","pretty":false,"x":390,"y":280,"wires":[["920633c2.41e26","3d0c7cab.16ff04"]]},{"id":"920633c2.41e26","type":"debug","z":"d273f23a.da887","name":"POST_/api/platform/setDefaultTable","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":610,"y":280,"wires":[]},{"id":"806c4b1a.348198","type":"json","z":"d273f23a.da887","name":"","property":"payload","action":"str","pretty":false,"x":370,"y":200,"wires":[["b09d4946.3dd3c8","3d0c7cab.16ff04"]]},{"id":"b09d4946.3dd3c8","type":"debug","z":"d273f23a.da887","name":"POST_/api/platform/getAccessTable","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":590,"y":200,"wires":[]},{"id":"804f7f61.fc7b5","type":"json","z":"d273f23a.da887","name":"","property":"payload","action":"str","pretty":false,"x":390,"y":120,"wires":[["b257c705.597b08"]]},{"id":"b257c705.597b08","type":"debug","z":"d273f23a.da887","name":"GET_/api/platform/getAccessTable","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":610,"y":120,"wires":[]},{"id":"76d0848a.197b0c","type":"debug","z":"2c87636e.674b4c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":100,"wires":[]},{"id":"6074494a.865ce8","type":"function","z":"d273f23a.da887","name":"Stable weight check","func":"var msg1 = msg;\nvar msg2 = msg;\nvar weight = JSON.parse(msg.payload);\nif(weight.stable === true){\n    msg1.payload = msg.payload;\n    return [msg1, null];\n}else{\n    global.set('zeroWeight',true);\n    msg2.payload = {\n                \"row1\":\"вага\",\n                \"row2\":\"нестабільна\"\n    };\n    return [null,msg2];\n}","outputs":2,"noerr":0,"x":2060,"y":420,"wires":[["2d1aa078.4fb35","12975c5d.7f9264"],["cdbe9590.f7cc58","4bdfc10a.26301","97a45d05.7621f","a598d8c6.8d6838"]]},{"id":"2d1aa078.4fb35","type":"debug","z":"d273f23a.da887","name":"if true","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2250,"y":320,"wires":[]},{"id":"cdbe9590.f7cc58","type":"debug","z":"d273f23a.da887","name":"if false","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2270,"y":360,"wires":[]},{"id":"a598d8c6.8d6838","type":"delay","z":"d273f23a.da887","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2040,"y":360,"wires":[["e36f2853.8a9468"]]},{"id":"3d0c7cab.16ff04","type":"function","z":"d273f23a.da887","name":"tagsObjCreate","func":"let guidObj = {};\nlet serviceTagsObj = {};\nJSON.parse(msg.payload).forEach(function(obj){\n    obj.tags_data.forEach(function(item){\n        if(item.tag.trim() !== '') guidObj[item.tag.toUpperCase()] = item.guid;\n    });\n});\nJSON.parse(msg.payload).forEach(function(obj){\n    if(obj.pointID === 'Неопределенно'){\n        obj.tags.forEach(function(item){\n            if(item !== '') serviceTagsObj[item.toUpperCase()] = 'service';\n        });\n    }\n});\nflow.set('tagsObj',guidObj);\nflow.set('serviceTagsObj',serviceTagsObj);\nmsg.payload = {guidObj: guidObj, serviceTagsObj: serviceTagsObj};\nreturn msg;","outputs":1,"noerr":0,"x":1440,"y":60,"wires":[["8080933e.f3018"]]},{"id":"c91328a3.466de8","type":"debug","z":"d273f23a.da887","name":"NewTagsObjFromAccessTable","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","x":1500,"y":100,"wires":[]},{"id":"5333434f.05a7ac","type":"debug","z":"d273f23a.da887","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":280,"wires":[]},{"id":"13599913.e02657","type":"function","z":"d273f23a.da887","name":"check infrared state","func":"var serviceTagsObj = flow.get('serviceTagsObj');\nmsg.do = false;\nmsg.tag = {tagID: 'fc-7a-cd-63'};\nif(serviceTagsObj[msg.tag.tagID.toUpperCase()] === 'service'){\n    msg.do = true;\n}\nmsg.testRes = serviceTagsObj[msg.tag.tagID.toUpperCase()];\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1200,"wires":[["85e4ab23.e18c78"]]},{"id":"70e808f.c1e73f8","type":"inject","z":"d273f23a.da887","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":200,"y":1200,"wires":[["13599913.e02657","4b38c394.5a1a0c"]]},{"id":"85e4ab23.e18c78","type":"debug","z":"d273f23a.da887","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":590,"y":1200,"wires":[]},{"id":"4b38c394.5a1a0c","type":"function","z":"d273f23a.da887","name":"check infrared state","func":"var payload = {\n    'infraredstate1':0,\n    'infraredstate2':0\n}\nvar infraredtimeout = flow.get('infraredtimeout');\nvar cDate = new Date();\nif ((cDate - global.get('infraredstate1Date')) < infraredtimeout){\n    payload.infraredstate1 = global.get('infraredstate1') ;   \n}\n\nif ((cDate - global.get('infraredstate2Date')) < infraredtimeout){\n    payload.infraredstate2 = global.get('infraredstate2') ;   \n}\n\nmsg.infraredstate1 = Number(payload.infraredstate1.substring(0,1));\nmsg.infraredstate2 = Number(payload.infraredstate2.substring(0,1));\nmsg.perimetr = (msg.infraredstate1 == 1 && msg.infraredstate2 == 1);\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1260,"wires":[["6f353544.633fdc"]]},{"id":"6f353544.633fdc","type":"debug","z":"d273f23a.da887","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":590,"y":1260,"wires":[]},{"id":"4d5ae2d3.60b14c","type":"debug","z":"d273f23a.da887","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":840,"y":220,"wires":[]},{"id":"a48d4b0e.208e28","type":"debug","z":"d273f23a.da887","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1030,"y":20,"wires":[]},{"id":"b0f4f8b2.955658","type":"debug","z":"d273f23a.da887","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1030,"y":240,"wires":[]},{"id":"af4da576.b8ec08","type":"debug","z":"d273f23a.da887","name":"ScanCard","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"elk_log","x":470,"y":420,"wires":[]},{"id":"8080933e.f3018","type":"json","z":"d273f23a.da887","name":"","property":"payload","action":"","pretty":false,"x":1590,"y":60,"wires":[["c91328a3.466de8"]]},{"id":"e4020d97.ba562","type":"debug","z":"d273f23a.da887","name":"SOVA URL","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"url","x":1800,"y":280,"wires":[]},{"id":"6849b41a.2de7dc","type":"debug","z":"d273f23a.da887","name":"TruckNumberParseService","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"paylaod","x":2020,"y":760,"wires":[]},{"id":"5504f2f9.60028c","type":"debug","z":"ef8d74d.cfc5d88","name":"rfid_in","active":false,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","x":380,"y":60,"wires":[]},{"id":"37a38484.e291ec","type":"debug","z":"d273f23a.da887","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":780,"wires":[]},{"id":"181efdc9.fa79b2","type":"link out","z":"d273f23a.da887","name":"t_r_1_s_0","links":["9cb6b82e.16d798"],"x":1295,"y":180,"wires":[]},{"id":"69cc92bd.5da93c","type":"link out","z":"d273f23a.da887","name":"t_g_1_s_0","links":["88a26ebd.675cb"],"x":1295,"y":140,"wires":[]},{"id":"d459ee31.afc7e","type":"link out","z":"d273f23a.da887","name":"t_g_1_s_1","links":["b638d393.8dc4"],"x":1295,"y":20,"wires":[]},{"id":"27c957eb.27eed8","type":"link out","z":"d273f23a.da887","name":"t_r_1_s_1","links":["3b5651f6.753dde","67f94f73.4936d","c1d3c9f3.11be48"],"x":1295,"y":60,"wires":[]}]
