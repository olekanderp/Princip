[{"id":"23d48a50.34fe86","type":"tab","label":"Вагова 2 ","disabled":false,"info":""},{"id":"6280a9fb.c72548","type":"tab","label":"RFID UHF","disabled":false,"info":""},{"id":"70555ce8.17ecb4","type":"tab","label":"Табло 1 (СТ 1 і 2)","disabled":false,"info":""},{"id":"5a1cfe92.37e8f","type":"tab","label":"Табло 2  Дальнє(СТ 1 і 2)","disabled":false,"info":""},{"id":"10d39a76.2386c6","type":"tab","label":"Зчитувач","disabled":false,"info":""},{"id":"2d1f7cd0.735b14","type":"tab","label":"Периметр","disabled":false,"info":""},{"id":"13ebd25d.3a683e","type":"tab","label":"Dashboard","disabled":false,"info":""},{"id":"e5aa27b6.d78288","type":"tab","label":"Ваги","disabled":false,"info":""},{"id":"b75c4a82.842c98","type":"subflow","name":"ETTN","info":"","in":[],"out":[]},{"id":"90d6c784.b030f8","type":"subflow","name":"Subflow 1","info":"","in":[],"out":[]},{"id":"7ecf841.c4e047c","type":"subflow","name":"ETTN (2)","info":"","in":[],"out":[]},{"id":"9674d803.06e3d8","type":"subflow","name":"Subflow 1 (2)","info":"","in":[],"out":[]},{"id":"3b12e9fc.b39e36","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"d5858087.31c14","type":"ui_group","z":"","name":"Зчитувачі","tab":"57fbe5b7.69e30c","order":5,"disp":true,"width":"6","collapse":false},{"id":"57fbe5b7.69e30c","type":"ui_tab","z":"","name":"Monitoring","icon":"dashboard","disabled":false,"hidden":false},{"id":"beead279.6b01f","type":"ui_group","z":"","name":"Вага","tab":"57fbe5b7.69e30c","order":6,"disp":true,"width":"6","collapse":false},{"id":"e931da00.5800f8","type":"ui_group","z":"","name":"Периметр","tab":"57fbe5b7.69e30c","order":7,"disp":true,"width":"5","collapse":false},{"id":"73729c49.e00d24","type":"ui_group","z":"","name":"Табло 1 IN Сторона 1","tab":"57fbe5b7.69e30c","order":2,"disp":true,"width":"6","collapse":false},{"id":"2a33a361.b71c7c","type":"ui_group","z":"","name":"Табло 1 IN Сторона 0","tab":"57fbe5b7.69e30c","order":1,"disp":true,"width":"6","collapse":false},{"id":"21d250f2.04b49","type":"ui_group","z":"","name":"Табло 2 OUT Сторона 0","tab":"57fbe5b7.69e30c","order":3,"disp":true,"width":"6","collapse":false},{"id":"aa448d43.a0b1c","type":"ui_group","z":"","name":"Табло 2 OUT Сторона 1","tab":"57fbe5b7.69e30c","order":4,"disp":true,"width":"6","collapse":false},{"id":"2c1c654f.e9ddca","type":"ui_group","z":"","name":"Графік ваги","tab":"57fbe5b7.69e30c","order":8,"disp":true,"width":"6","collapse":false},{"id":"84c7492a.a95898","type":"serial-port","z":"","serialport":"/dev/rfid_r_2","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","waitfor":"","newline":"500","bin":"bin","out":"time","addchar":"false","responsetimeout":"10000"},{"id":"b6f82620.2f3998","type":"serial-port","z":"","serialport":"/dev/rfid_r_1","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","waitfor":"","newline":"200","bin":"bin","out":"time","addchar":"false","responsetimeout":"10000"},{"id":"2005a425.559e9c","type":"ui_group","z":"","name":"Номери автомобілів","tab":"57fbe5b7.69e30c","order":9,"disp":true,"width":"6","collapse":false},{"id":"acb90b75.29ba08","type":"comment","z":"10d39a76.2386c6","name":"Вїзд","info":"","x":70,"y":100,"wires":[]},{"id":"f6c27959.c31238","type":"debug","z":"2d1f7cd0.735b14","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":200,"wires":[]},{"id":"1dbb0890.62f437","type":"comment","z":"2d1f7cd0.735b14","name":"Виїзд Init","info":"","x":160,"y":160,"wires":[]},{"id":"12c543f4.65c9ec","type":"comment","z":"2d1f7cd0.735b14","name":"Вїзд Init","info":"","x":150,"y":60,"wires":[]},{"id":"a032855e.f960a8","type":"comment","z":"2d1f7cd0.735b14","name":"1 Не пересічено: 0 Пересічено","info":"","x":410,"y":40,"wires":[]},{"id":"dfeabeda.5a578","type":"link out","z":"10d39a76.2386c6","name":"ЗЧ Вїзд","links":["de0306a3.44eb18","4a780ca7.f8df04","46f1bdf8.64de24","38e0f8e5.10ab38","96e400b2.8de26","88549679.e93978"],"x":735,"y":100,"wires":[]},{"id":"84b6cf0.1e85f3","type":"link out","z":"10d39a76.2386c6","name":"ЗЧ Виїзд","links":["7f9b68cc.93c368","87697667.f49b28","2aa1720a.e2c9be","7084f4f5.d3b4dc"],"x":735,"y":200,"wires":[]},{"id":"dadf241b.225cc8","type":"rpi-gpio in","z":"2d1f7cd0.735b14","name":"","pin":"12","intype":"down","debounce":"1000","read":false,"x":200,"y":200,"wires":[["f6c27959.c31238"]]},{"id":"deb05218.6a36d","type":"tcp in","z":"e5aa27b6.d78288","name":"","server":"server","host":"","port":"2500","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":130,"y":100,"wires":[["39476f43.39fc7"]]},{"id":"46ced085.fc7a3","type":"debug","z":"e5aa27b6.d78288","name":"weight","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":740,"y":280,"wires":[]},{"id":"39476f43.39fc7","type":"delay","z":"e5aa27b6.d78288","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":370,"y":100,"wires":[["99d155fc.8f1338","8de5e2d1.b8dc6","755678ea.3e62f8","3e0a822.9da8f7e"]]},{"id":"8262ebfc.5474f8","type":"inject","z":"2d1f7cd0.735b14","name":"","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":360,"wires":[["f8a88c87.22028"]]},{"id":"f8a88c87.22028","type":"exec","z":"2d1f7cd0.735b14","command":"cat /sys/class/gpio/gpio17/value","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"В'їзд","x":270,"y":360,"wires":[["6569fc3f.e1e234","e54ea171.d5048","784af228.bbccec"],[],[]]},{"id":"6569fc3f.e1e234","type":"debug","z":"2d1f7cd0.735b14","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":360,"wires":[]},{"id":"87cda234.916b4","type":"inject","z":"2d1f7cd0.735b14","name":"","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":420,"wires":[["5c6a3f7e.3fb5c"]]},{"id":"5c6a3f7e.3fb5c","type":"exec","z":"2d1f7cd0.735b14","command":"cat /sys/class/gpio/gpio18/value","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"Виїзд","x":270,"y":420,"wires":[["fe64584b.88ed28","d4906d67.0d5b4","df929b1b.12d208"],[],[]]},{"id":"fe64584b.88ed28","type":"debug","z":"2d1f7cd0.735b14","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":420,"wires":[]},{"id":"b1b761ba.1bdad","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"d5858087.31c14","order":3,"width":0,"height":0,"passthru":false,"label":"NFC В'їзд","tooltip":"","color":"","bgcolor":"","icon":"","payload":"nfc_2","payloadType":"flow","topic":"NFC В'їзд","x":360,"y":540,"wires":[["40f2353c.75c8ac"]]},{"id":"ba34e53.384e718","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"d5858087.31c14","order":5,"width":0,"height":0,"passthru":false,"label":"NFC Виїзд","tooltip":"","color":"","bgcolor":"","icon":"","payload":"nfc_3","payloadType":"flow","topic":"NFC Охорона","x":370,"y":580,"wires":[["35ab04dd.aebe1c"]]},{"id":"b9121206.53afb","type":"link out","z":"13ebd25d.3a683e","name":"T2_side_0","links":["cc3d0766.8f63f8","3572085d.4e37d8"],"x":975,"y":160,"wires":[]},{"id":"527fd7c2.4b25e8","type":"ui_form","z":"13ebd25d.3a683e","name":"","label":"Табло 1 IN Сторона 0 (До вагів)","group":"2a33a361.b71c7c","order":1,"width":0,"height":0,"options":[{"label":"Номер","value":"r1","type":"text","required":false},{"label":"Вага","value":"r2","type":"text","required":false}],"formValue":{"r1":"","r2":""},"payload":"","submit":"submit","cancel":"cancel","topic":"","x":150,"y":160,"wires":[["5688608.85e14a"]]},{"id":"1c68a1ee.edba6e","type":"ui_form","z":"13ebd25d.3a683e","name":"","label":"Табло2 OUT Сторона 0 (Від вагів)","group":"21d250f2.04b49","order":1,"width":0,"height":0,"options":[{"label":"Номер","value":"r1","type":"text","required":false},{"label":"Вага","value":"r2","type":"text","required":false}],"formValue":{"r1":"","r2":""},"payload":"","submit":"submit","cancel":"cancel","topic":"","x":800,"y":160,"wires":[["b9121206.53afb"]]},{"id":"11a68ec0.5218a1","type":"ui_gauge","z":"13ebd25d.3a683e","name":"Вага","group":"beead279.6b01f","order":0,"width":0,"height":0,"gtype":"gage","title":"Вага, кг","label":"units","format":"{{value}}","min":0,"max":"60000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"20000","seg2":"40000","x":330,"y":700,"wires":[]},{"id":"76639af7.e502e4","type":"link out","z":"e5aa27b6.d78288","name":"scale","links":["c6022e53.9b2b1"],"x":715,"y":160,"wires":[]},{"id":"99d155fc.8f1338","type":"function","z":"e5aa27b6.d78288","name":"","func":"msg.payload = global.set(\"weight\",Number(msg.payload));\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":160,"wires":[["76639af7.e502e4"]]},{"id":"c6022e53.9b2b1","type":"link in","z":"13ebd25d.3a683e","name":"scale","links":["76639af7.e502e4"],"x":100,"y":700,"wires":[["11a68ec0.5218a1","ffb0e6df.c53c28"]]},{"id":"40f2353c.75c8ac","type":"ui_text","z":"13ebd25d.3a683e","group":"d5858087.31c14","order":4,"width":0,"height":0,"name":"","label":"ID:","format":"{{msg.payload}}","layout":"row-spread","x":590,"y":540,"wires":[]},{"id":"35ab04dd.aebe1c","type":"ui_text","z":"13ebd25d.3a683e","group":"d5858087.31c14","order":6,"width":0,"height":0,"name":"","label":"ID:","format":"{{msg.payload}}","layout":"row-spread","x":590,"y":580,"wires":[]},{"id":"bcd01393.55619","type":"debug","z":"13ebd25d.3a683e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":460,"wires":[]},{"id":"d05d4ab2.7bd588","type":"link in","z":"13ebd25d.3a683e","name":"","links":["e4690a36.062b38"],"x":75,"y":480,"wires":[["736b621d.1b027c"]]},{"id":"4a780ca7.f8df04","type":"link in","z":"13ebd25d.3a683e","name":"","links":["dfeabeda.5a578"],"x":75,"y":520,"wires":[["df3dac0d.4eb16","66bfb815.fb8ce8"]]},{"id":"87697667.f49b28","type":"link in","z":"13ebd25d.3a683e","name":"","links":["84b6cf0.1e85f3"],"x":75,"y":560,"wires":[["82ae0a07.20a1b8"]]},{"id":"df3dac0d.4eb16","type":"function","z":"13ebd25d.3a683e","name":"2 nfc","func":"flow.set(\"nfc_2\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":520,"wires":[["40f2353c.75c8ac"]]},{"id":"82ae0a07.20a1b8","type":"function","z":"13ebd25d.3a683e","name":"3 nfc","func":"flow.set(\"nfc_3\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":560,"wires":[["35ab04dd.aebe1c"]]},{"id":"e54ea171.d5048","type":"link out","z":"2d1f7cd0.735b14","name":"Периметр в'їзд","links":["65cb66f.fe68898","c7693f9.7ef73c"],"x":515,"y":320,"wires":[]},{"id":"d4906d67.0d5b4","type":"link out","z":"2d1f7cd0.735b14","name":"Периметр виїзд","links":["fb34e853.f57f88","41192ee0.1c066"],"x":515,"y":460,"wires":[]},{"id":"65cb66f.fe68898","type":"link in","z":"13ebd25d.3a683e","name":"","links":["e54ea171.d5048"],"x":95,"y":800,"wires":[["23a29f1a.32a69"]]},{"id":"fb34e853.f57f88","type":"link in","z":"13ebd25d.3a683e","name":"","links":["d4906d67.0d5b4"],"x":95,"y":840,"wires":[["5d6858f1.323b58"]]},{"id":"a984e8aa.300b48","type":"ui_text","z":"13ebd25d.3a683e","group":"e931da00.5800f8","order":2,"width":0,"height":0,"name":"","label":"Статус в'їзд","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":800,"wires":[]},{"id":"68d04a9.73cd3b4","type":"ui_text","z":"13ebd25d.3a683e","group":"e931da00.5800f8","order":1,"width":0,"height":0,"name":"","label":"Статус виїзд","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":840,"wires":[]},{"id":"23a29f1a.32a69","type":"function","z":"13ebd25d.3a683e","name":"","func":"if(msg.payload == 1){\n    msg.payload = \"В нормі\"\n}else{\n    msg.payload = \"Порушений\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":800,"wires":[["a984e8aa.300b48"]]},{"id":"5d6858f1.323b58","type":"function","z":"13ebd25d.3a683e","name":"","func":"if(msg.payload == 1){\n    msg.payload = \"В нормі\"\n}else{\n    msg.payload = \"Порушений\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":840,"wires":[["68d04a9.73cd3b4"]]},{"id":"6249a039.a467a","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"d5858087.31c14","order":7,"width":0,"height":0,"passthru":false,"label":"Зважування завершене","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":290,"y":640,"wires":[["1f65ca41.68f436"]]},{"id":"1f65ca41.68f436","type":"function","z":"13ebd25d.3a683e","name":"","func":"msg.payload = \"\";\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":640,"wires":[["40f2353c.75c8ac","35ab04dd.aebe1c"]]},{"id":"736b621d.1b027c","type":"debug","z":"13ebd25d.3a683e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":230,"y":420,"wires":[]},{"id":"66bfb815.fb8ce8","type":"debug","z":"13ebd25d.3a683e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":430,"y":420,"wires":[]},{"id":"ffe049d4.695208","type":"http in","z":"6280a9fb.c72548","name":"","url":"/api/platform/setAccessTable","method":"post","upload":false,"swaggerDoc":"","x":160,"y":240,"wires":[["376edf5d.2b553","23a23498.f2a82c"]]},{"id":"376edf5d.2b553","type":"function","z":"6280a9fb.c72548","name":"set Access Table","func":"// var accessTable = [exampleAcess];\n// var exampleAcess = {\n//     \"pointID\":\"35235325325235\"\n//     \"ip\":\"10.3.5.210\",\n//     \"antennaID\":\"1\",\n//     \"direction\":0,\n//     \"tags\":[\"124124\",\"3525235\"],\n//     \"gpo\":['80','00'],\n//      \"marked\":false\n// }\n\nflow.set('accessTable',msg.payload);\nflow.set('accessTableUpdate',new Date());\nmsg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":240,"wires":[["98bea2a0.c7e22"]]},{"id":"98bea2a0.c7e22","type":"http response","z":"6280a9fb.c72548","name":"","x":630,"y":240,"wires":[]},{"id":"ec138087.9b41e","type":"inject","z":"6280a9fb.c72548","name":"init","repeat":"","crontab":"","once":true,"topic":"","payload":"","payloadType":"str","x":110,"y":40,"wires":[["7fbfc016.a5f0f"]]},{"id":"7fbfc016.a5f0f","type":"function","z":"6280a9fb.c72548","name":"NFC conf","func":"//040300000012000001dd0000db0007000280 - 02 GPO index, 80 or 00 - on/off\nflow.set('accessTable',[]);\n//timeout for delay to getting infrared state, ms\nflow.set('infraredtimeout',5000);\nglobal.set('zeroWeight',false);\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":40,"wires":[["2a97760e.c6f22a"]]},{"id":"432715a1.d312dc","type":"function","z":"6280a9fb.c72548","name":"get row from Access Table","func":"var aT = flow.get('accessTable');\nvar serviceTagsObj = flow.get('serviceTagsObj');\nmsg.do = false;\n\nif(serviceTagsObj[msg.tag.tagID.toUpperCase()] === 'service'){\n    msg.do = true;\n}\n\nfor (var i = 0; i < aT.length; i++){\n    var temp_tags = aT[i].tags.slice();\n    if ((aT[i].ip === msg.ip) && (Number(aT[i].antenna)===msg.antennaID) && (temp_tags.indexOf(msg.tag.tagID) >= 0)&&!(aT[i].done)){\n        msg.accessTable = aT[i];\n        msg.aTLength = aT.length;\n        if ((aT[i].pointID != \"Неопределенно\")){\n            aT[i].done = true;\n        }\n        \n        break;\n     }\n}\nmsg.temp_tags = temp_tags;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":360,"wires":[["147b71d1.7cb67e"]]},{"id":"b23bd71d.93fe08","type":"function","z":"6280a9fb.c72548","name":"get IP","func":"msg.tagID = msg.payload;\nvar  s = \"-\";\nmsg.tagID = msg.tagID.substring(0,2)+s+msg.tagID.substring(2,4)+s+msg.tagID.substring(4,6)+s+msg.tagID.substring(6,8);\nmsg.tag   = {\"tagID\":msg.tagID};\nmsg.antennaID = msg.antennaID;\nmsg.elk_log = JSON.stringify({\n    tagID: msg.tagID,\n    antennaID: msg.antennaID,\n    antennaIP: msg.ip\n});\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":360,"wires":[["432715a1.d312dc","85bcd7cb.238288"]]},{"id":"58354752.fbc548","type":"http in","z":"6280a9fb.c72548","name":"","url":"/api/platform/getReaderConfig","method":"get","upload":false,"swaggerDoc":"","x":180,"y":600,"wires":[["97396a62.2b67a8","256ccd56.1d2512"]]},{"id":"205dbb95.865fd4","type":"http response","z":"6280a9fb.c72548","name":"","x":630,"y":600,"wires":[]},{"id":"2f276aaf.702d36","type":"http in","z":"6280a9fb.c72548","name":"","url":"/api/platform/setDefaultTable","method":"post","upload":false,"swaggerDoc":"","x":160,"y":300,"wires":[["3fd8ec62.049ce4","bd68e8a0.ee4c68","38357f8f.57e4e"]]},{"id":"3fd8ec62.049ce4","type":"function","z":"6280a9fb.c72548","name":"set default Table","func":"// var accessTable = [];\n// var exampleAcess = {\n//     \"ip\":\"10.3.5.210\",\n//     \"port\":5084,\n//     \"gpo\":['0180','0200']\n// }\n\nflow.set('accessTable',msg.payload);\nmsg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":320,"wires":[["28b76c71.690e24"]]},{"id":"28b76c71.690e24","type":"http response","z":"6280a9fb.c72548","name":"","x":630,"y":320,"wires":[]},{"id":"909d9510.539fa8","type":"function","z":"6280a9fb.c72548","name":"FRONT","func":"msg.ip = \"NFC_front\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":220,"y":360,"wires":[["b23bd71d.93fe08"]]},{"id":"b982b803.96b7d8","type":"function","z":"6280a9fb.c72548","name":"IN","func":"msg.ip = \"NFC_in_2\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":210,"y":400,"wires":[["b23bd71d.93fe08"]]},{"id":"21c50612.92ba6a","type":"function","z":"6280a9fb.c72548","name":"OUT","func":"msg.ip = \"NFC_out_2\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":210,"y":440,"wires":[["b23bd71d.93fe08"]]},{"id":"b0bfbe52.3fd91","type":"http in","z":"6280a9fb.c72548","name":"","url":"/api/platform/setReaderConfig","method":"post","upload":false,"swaggerDoc":"","x":660,"y":40,"wires":[["d4b0008b.c130b","9256e379.62d25","88189719.c6ea18","d3051d11.f37e3"]]},{"id":"d4b0008b.c130b","type":"http response","z":"6280a9fb.c72548","name":"","x":910,"y":100,"wires":[]},{"id":"101dcae9.146e35","type":"inject","z":"6280a9fb.c72548","name":"","repeat":"","crontab":"","once":false,"onceDelay":"","topic":"","payload":"puller","payloadType":"flow","x":100,"y":780,"wires":[[]]},{"id":"73c8ab6f.563e04","type":"inject","z":"6280a9fb.c72548","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"str","x":93.5,"y":840,"wires":[["54715c6f.f3a6d4"]]},{"id":"54715c6f.f3a6d4","type":"function","z":"6280a9fb.c72548","name":"get row from Access Table","func":"var aT = flow.get('accessTable');\nvar aTDate = flow.get('accessTableUpdate');\nvar nowDate = Date();\nvar diff = 2000;\n\nmsg.do = true;\n//if access table is not actual\nif (nowDate-aTDate > diff){\n    msg.do = false;\n}else{\nfor (var i = 0; i < aT.length; i++){\n    if ((aT[i].ip === msg.ip)&&Number(aT[i].antenna)===msg.tag.antennaID){\n        msg.accessTable = aT[i];\n        msg.aTLength = aT.length;\n        break;\n     }\n}\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":294,"y":840,"wires":[[]]},{"id":"28d4b21f.b1d8ee","type":"function","z":"6280a9fb.c72548","name":"send to 1C","func":"msg.url = flow.get('host1C');\nmsg.tag.lastSeenTimestampUTC = new Date();\nmsg.tag.ip = msg.ip;\nmsg.tag.antenna = String(msg.antennaID);\nmsg.tag.antennaID = String(msg.antennaID);\nmsg.tag.direction = 'IN';\nmsg.tag.weight = JSON.parse(msg.payload);\n\nmsg.payload = [msg.tag];\n\nglobal.set('zeroWeight',false);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2230,"y":520,"wires":[["5ff6375e.34b838","59c8affe.48d18","4bb16f1.38d299"]]},{"id":"4bb16f1.38d299","type":"http request","z":"6280a9fb.c72548","name":"to 1C","method":"POST","ret":"txt","url":"","tls":"","x":2390,"y":520,"wires":[["59c8affe.48d18"]]},{"id":"2a97760e.c6f22a","type":"function","z":"6280a9fb.c72548","name":"1C conf","func":"//var host1C = \"http://s-app-mir-test/rfid_mir_test/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\n//var host1C = \"http://s-app-yag-test/UE_yag/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\n//var host1C = \"http://10.3.45.253/UE_yag/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\nvar host1C = \"http://10.3.6.253/UE_laz/hs/PerimeterControl/api/PrincipNodeRed/getTags\";\n\nflow.set('host1C',host1C);\nflow.set('actualDiff',86900); //сколько секунда таблица доступа актуальна\nmsg.url = host1C;\nflow.set('puller',[]);\nflow.set('puller_timeout_sec',30);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":40,"wires":[["1f674950.2d99a7"]]},{"id":"9256e379.62d25","type":"function","z":"6280a9fb.c72548","name":"","func":"msg.payload.ip = msg.req.query.rfidID;\nmsg.payload.event_name = \"Отправка команды\";\nmsg.payload.event_desc = msg.payload.event_name+\" \"+msg.payload.ip+\" \"+msg.payload.cmd;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":20,"wires":[[]]},{"id":"1f674950.2d99a7","type":"http request","z":"6280a9fb.c72548","name":"","method":"GET","ret":"txt","url":"","tls":"","x":190,"y":80,"wires":[["2cb4fb43.dd7ad4"]]},{"id":"2cb4fb43.dd7ad4","type":"function","z":"6280a9fb.c72548","name":"set Access Table","func":"flow.set('accessTable',JSON.parse(msg.payload));\nflow.set('accessTableUpdate',new Date());\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":80,"wires":[["cc952bdc.c00678","d83ab0e9.81254"]]},{"id":"6d9298bd.14d408","type":"function","z":"6280a9fb.c72548","name":"Filling Puller","func":"var puller = flow.get('puller');\nvar puller_timeout_sec = flow.get('puller_timeout_sec');\nvar current_element = {\n    'ip':msg.ip,\n    'tagID':msg.tagID,\n    'antennaID':msg.tag.antennaID,\n    'lastSeenTimestampUTC':new Date()\n}\nvar pull = true;\nvar finded = false\nfor (var i = 0; i < puller.length; i++){\n    var element = puller[i];\n    if ((element.ip === current_element.ip)&&(element.tagID===current_element.tagID)&&(element.antennaID===current_element.antennaID)){\n        var diff = (current_element.lastSeenTimestampUTC-element.lastSeenTimestampUTC)*1000;\n        if (diff < puller_timeout_sec){\n            pull = false; \n        }else{\n            puller[i]=current_element;\n        }\n        finded = true;\n    }\n}\nif (!finded){\n    puller.push(current_element);\n}\n\nflow.set('puller',puller);\nmsg.pull = pull;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":500,"wires":[["d472692a.d3e248"]]},{"id":"d472692a.d3e248","type":"switch","z":"6280a9fb.c72548","name":"","property":"pull","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":750,"y":500,"wires":[["cf914825.d26768"]]},{"id":"69566da2.042b74","type":"link in","z":"6280a9fb.c72548","name":"","links":["e4690a36.062b38"],"x":75,"y":360,"wires":[["909d9510.539fa8"]]},{"id":"46f1bdf8.64de24","type":"link in","z":"6280a9fb.c72548","name":"","links":["dfeabeda.5a578"],"x":75,"y":400,"wires":[["b982b803.96b7d8"]]},{"id":"2aa1720a.e2c9be","type":"link in","z":"6280a9fb.c72548","name":"","links":["84b6cf0.1e85f3"],"x":75,"y":440,"wires":[["21c50612.92ba6a"]]},{"id":"784af228.bbccec","type":"function","z":"2d1f7cd0.735b14","name":"infrared state 1","func":"global.set('infraredstate1',msg.payload);\nglobal.set('infraredstate1Date', new Date());\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":260,"wires":[[]]},{"id":"df929b1b.12d208","type":"function","z":"2d1f7cd0.735b14","name":"infrared state 2","func":"global.set('infraredstate2Date', new Date());\nglobal.set('infraredstate2', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":500,"wires":[[]]},{"id":"97396a62.2b67a8","type":"function","z":"6280a9fb.c72548","name":"check infrared state","func":"var payload = {\n    'infraredstate1':0,\n    'infraredstate2':0\n}\nvar infraredtimeout = flow.get('infraredtimeout');\nvar cDate = new Date();\nif ((cDate - global.get('infraredstate1Date')) < infraredtimeout){\n    payload.infraredstate1 = global.get('infraredstate1') ;   \n}\n\nif ((cDate - global.get('infraredstate2Date')) < infraredtimeout){\n    payload.infraredstate2 = global.get('infraredstate2') ;   \n}\n\nmsg.payload = {\"infraredstate\":payload.infraredstate1 == 1 && payload.infraredstate2 == 1};\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":600,"wires":[["205dbb95.865fd4"]]},{"id":"6446985a.765408","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"2a33a361.b71c7c","order":1,"width":0,"height":0,"passthru":true,"label":"Зелений","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":100,"y":200,"wires":[["3a5f7dfc.accc72"]]},{"id":"8d17a2fd.433b2","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"2a33a361.b71c7c","order":1,"width":0,"height":0,"passthru":true,"label":"Червоний","tooltip":"","color":"","bgcolor":"red","icon":"","payload":"","payloadType":"date","topic":"","x":100,"y":240,"wires":[["7e0b2082.fb7eb"]]},{"id":"1487d5fc.98afca","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"21d250f2.04b49","order":1,"width":0,"height":0,"passthru":true,"label":"Зелений","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":760,"y":200,"wires":[["8918c75a.a56b28"]]},{"id":"30884153.006cee","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"21d250f2.04b49","order":1,"width":0,"height":0,"passthru":true,"label":"Червоний","tooltip":"","color":"","bgcolor":"red","icon":"","payload":"","payloadType":"date","topic":"","x":760,"y":240,"wires":[["4b9f81e4.d3168"]]},{"id":"8918c75a.a56b28","type":"link out","z":"13ebd25d.3a683e","name":"T2_side_0_green_t0","links":["afa9628d.db5ba"],"x":875,"y":200,"wires":[]},{"id":"4b9f81e4.d3168","type":"link out","z":"13ebd25d.3a683e","name":"T2_side_0_red_t0","links":["aeb7f869.2b07f8"],"x":875,"y":240,"wires":[]},{"id":"bcdc76fc.f9c5a8","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"2a33a361.b71c7c","order":1,"width":0,"height":0,"passthru":true,"label":"Погасити","tooltip":"","color":"","bgcolor":"gray","icon":"","payload":"","payloadType":"date","topic":"","x":100,"y":280,"wires":[["e6f85945.7153b8"]]},{"id":"1260adcb.33e202","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"21d250f2.04b49","order":1,"width":0,"height":0,"passthru":true,"label":"Погасити","tooltip":"","color":"","bgcolor":"gray","icon":"","payload":"","payloadType":"date","topic":"","x":760,"y":280,"wires":[["e626f291.4ed7"]]},{"id":"e626f291.4ed7","type":"link out","z":"13ebd25d.3a683e","name":"T2_side_0_off_t0","links":["2c51e85b.729248"],"x":875,"y":280,"wires":[]},{"id":"901774c9.128b98","type":"switch","z":"6280a9fb.c72548","name":"board_in_out","property":"ip","propertyType":"msg","rules":[{"t":"eq","v":"board_in","vt":"str"},{"t":"eq","v":"board_out","vt":"str"},{"t":"eq","v":"board_in2","vt":"str"},{"t":"eq","v":"board_out2","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":1010,"y":160,"wires":[["5b2594a1.e75b0c"],["99a9f6b2.a5a508"],["896b8279.e972d"],["4c60517.c7e87b"]]},{"id":"9b93a5db.a89dc8","type":"link out","z":"6280a9fb.c72548","name":"t_g_1_s_0","links":["1f95baf4.180d55","6b0ee542.9bee5c"],"x":1315,"y":20,"wires":[]},{"id":"5b2594a1.e75b0c","type":"switch","z":"6280a9fb.c72548","name":"green/red","property":"cmd","propertyType":"msg","rules":[{"t":"eq","v":"0100","vt":"str"},{"t":"eq","v":"0180","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1200,"y":40,"wires":[["9b93a5db.a89dc8"],["d54798a6.ce6378"]]},{"id":"99a9f6b2.a5a508","type":"switch","z":"6280a9fb.c72548","name":"green/red","property":"cmd","propertyType":"msg","rules":[{"t":"eq","v":"0100","vt":"str"},{"t":"eq","v":"0180","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1200,"y":100,"wires":[["e442cf81.b5bbf"],["e0fddba4.102a98"]]},{"id":"d54798a6.ce6378","type":"link out","z":"6280a9fb.c72548","name":"t_r_1_s_0","links":["3b5651f6.753dde","4bb89c8b.387794"],"x":1315,"y":60,"wires":[]},{"id":"e442cf81.b5bbf","type":"link out","z":"6280a9fb.c72548","name":"t_g_2_s_1","links":["c97aa556.56e868","a0fb2f4c.029dc"],"x":1315,"y":100,"wires":[]},{"id":"e0fddba4.102a98","type":"link out","z":"6280a9fb.c72548","name":"t_r_2_s_1","links":["a622d9c1.240fb8","71b01e27.99bc2"],"x":1315,"y":140,"wires":[]},{"id":"88189719.c6ea18","type":"function","z":"6280a9fb.c72548","name":"","func":"msg.ip      = msg.req.query.rfidID;\nmsg.cmd     = msg.payload.cmd;\nreturn msg;","outputs":"1","noerr":0,"initialize":"","finalize":"","x":910,"y":60,"wires":[["901774c9.128b98","e7519367.f34d2"]]},{"id":"9d0b05ec.3feef8","type":"http in","z":"6280a9fb.c72548","name":"","url":"/api/platform/setBoardText","method":"post","upload":false,"swaggerDoc":"","x":150,"y":680,"wires":[["c8a793bb.9f703","dfd7cad2.30f998","80c8e30c.d3f78"]]},{"id":"c8a793bb.9f703","type":"function","z":"6280a9fb.c72548","name":"get boarad ID","func":"msg.ip      = msg.req.query.boardID;\nreturn msg;","outputs":"1","noerr":0,"initialize":"","finalize":"","x":400,"y":680,"wires":[["df471515.f80c28","2bf9e58d.3d1baa"]]},{"id":"df471515.f80c28","type":"switch","z":"6280a9fb.c72548","name":"board_in_out","property":"ip","propertyType":"msg","rules":[{"t":"eq","v":"board_in","vt":"str"},{"t":"eq","v":"board_out","vt":"str"},{"t":"eq","v":"board_in2","vt":"str"},{"t":"eq","v":"board_out2","vt":"str"},{"t":"eq","v":"board_upload","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":590,"y":680,"wires":[["f41fd7c8.0a9578"],["19d2ce65.fa5f72"],["e113b150.50da"],["70e34dab.e774d4"],["19dbf625.21f20a"]]},{"id":"f41fd7c8.0a9578","type":"link out","z":"6280a9fb.c72548","name":"1c to Board 1_S0 (rest)","links":["ff68561b.3dd958","2cbfc58e.c4996a"],"x":735,"y":640,"wires":[]},{"id":"19d2ce65.fa5f72","type":"link out","z":"6280a9fb.c72548","name":"1c to Board 2_S1 (rest)","links":["5ff6eb49.f272b4","d57e16c.2cb4de8"],"x":735,"y":680,"wires":[]},{"id":"2bf9e58d.3d1baa","type":"http response","z":"6280a9fb.c72548","name":"","statusCode":"","headers":{},"x":530,"y":740,"wires":[]},{"id":"26aca029.e8791","type":"http request","z":"6280a9fb.c72548","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://10.3.6.247:4000/auth/login","tls":"","persist":false,"proxy":"","authType":"","x":1310,"y":440,"wires":[["8aa4cfcb.f988c"]]},{"id":"49ca4e89.f450c","type":"function","z":"6280a9fb.c72548","name":"Авторизация на весах","func":"flow.set('access_granted',false);\nmsg.payload = {\n    \"username\":\"user\", \n    \"password\":\"user\"\n}\nmsg.headers = {\n    \"Content-Type\":\"application/json\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":440,"wires":[["26aca029.e8791"]]},{"id":"8aa4cfcb.f988c","type":"function","z":"6280a9fb.c72548","name":"Получаем токен","func":"var payload = JSON.parse(msg.payload);\n\n\nmsg.headers = {\n    \"token\":payload.token\n}\n\nmsg.url = 'http://10.3.6.247:4000/api/platform/laz_avto2/getWeight/status';\n\n//if (msg.tagData){\n//    let tagsObj = flow.get('tagsObj');\n//    msg.url = msg.url+\"?truck1=\"+encodeURI(msg.tagData.truck1)+\"&truck2=\"+encodeURI(msg.tagData.truck2)+\"&reader=\"+encodeURI(tagsObj[msg.tagData.tagID.toUpperCase()]);\n//}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":440,"wires":[["1af617b4.16f8a8","bfc06df2.957"]]},{"id":"1af617b4.16f8a8","type":"http request","z":"6280a9fb.c72548","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1690,"y":440,"wires":[["cae9ad67.b0fc8","38891bb.080ece4"]]},{"id":"ffb0e6df.c53c28","type":"debug","z":"13ebd25d.3a683e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":270,"y":740,"wires":[]},{"id":"8de5e2d1.b8dc6","type":"function","z":"e5aa27b6.d78288","name":"в дашборд","func":"msg.payload = Number(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":300,"wires":[["76639af7.e502e4","46ced085.fc7a3"]]},{"id":"e484572d.be4ff8","type":"comment","z":"5a1cfe92.37e8f","name":"","info":"START1;0;0;1;0;Верхня;Нижня<EOR>\n\nSTART1;0;0;1;іва;фів;","x":100,"y":40,"wires":[]},{"id":"8462ddda.82567","type":"inject","z":"5a1cfe92.37e8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":80,"wires":[["1073929.0019e6d"]]},{"id":"11653ee3.f5a341","type":"inject","z":"5a1cfe92.37e8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":1340,"wires":[["5ff4829f.cd263c"]]},{"id":"1073929.0019e6d","type":"function","z":"5a1cfe92.37e8f","name":"ТЕСТ 1 сторона 0","func":"\nvar num_avto_r1 = \"1111\";\nvar num_avto_r2 = \"13200 кг\";\n\n\nmsg.payload =\"START1;0;0;1;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n//            START1;0;0;1;0;Верхня;Нижня<EOR>            \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":80,"wires":[["c1122f40.02659"]]},{"id":"5ff4829f.cd263c","type":"function","z":"5a1cfe92.37e8f","name":"ТЕСТ сторона 1","func":"\nvar num_avto_r1 = \" 123  \";\nvar num_avto_r2 = \" ТЕск кг \";\n\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n           \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1340,"wires":[["c1122f40.02659"]]},{"id":"c1122f40.02659","type":"converter","z":"5a1cfe92.37e8f","name":"","from":"win1251","x":820,"y":460,"wires":[["265f6972.4cb7b6"]]},{"id":"265f6972.4cb7b6","type":"tcp out","z":"5a1cfe92.37e8f","host":"10.3.6.226","port":"9761","beserver":"client","base64":false,"end":false,"name":"","x":1060,"y":460,"wires":[]},{"id":"8d1590d5.2434d","type":"function","z":"5a1cfe92.37e8f","name":"Світлофор червний СТ_0","func":"\n\n\nmsg.payload =\"START1;0;1;3;1;1;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":280,"wires":[["265f6972.4cb7b6"]]},{"id":"9e1e786b.0b8a18","type":"function","z":"5a1cfe92.37e8f","name":"Світлофор зелений СТ_0","func":"\n\n\nmsg.payload =\"START1;0;0;3;1;2;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":240,"wires":[["265f6972.4cb7b6"]]},{"id":"28529877.8aa038","type":"inject","z":"5a1cfe92.37e8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":240,"wires":[["9e1e786b.0b8a18"]]},{"id":"3290c90a.8653a6","type":"inject","z":"5a1cfe92.37e8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":280,"wires":[["8d1590d5.2434d"]]},{"id":"7a878ac1.112614","type":"inject","z":"5a1cfe92.37e8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":1460,"wires":[["fbd74567.846e28"]]},{"id":"fbd74567.846e28","type":"function","z":"5a1cfe92.37e8f","name":"погасити світлофори СТ_1","func":"\n\n\nmsg.payload =\"START1;0;0;3;0;0;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1460,"wires":[["4c151f9b.3f0c3","265f6972.4cb7b6"]]},{"id":"4c151f9b.3f0c3","type":"debug","z":"5a1cfe92.37e8f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":810,"y":1460,"wires":[]},{"id":"20709330.44b3ac","type":"debug","z":"5a1cfe92.37e8f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":810,"y":1380,"wires":[]},{"id":"b94409aa.8a2238","type":"debug","z":"5a1cfe92.37e8f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":810,"y":1420,"wires":[]},{"id":"ba163a46.8bc2a8","type":"function","z":"5a1cfe92.37e8f","name":"Світлофор червний СТ_1","func":"\n\n\nmsg.payload =\"START1;0;1;3;0;1;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1420,"wires":[["b94409aa.8a2238","265f6972.4cb7b6"]]},{"id":"48a13098.9d64c","type":"function","z":"5a1cfe92.37e8f","name":"Світлофор зелений СТ_1","func":"\n\n\nmsg.payload =\"START1;0;0;3;0;2;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1380,"wires":[["20709330.44b3ac","265f6972.4cb7b6"]]},{"id":"74095d0e.0853c4","type":"inject","z":"5a1cfe92.37e8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":1380,"wires":[["48a13098.9d64c"]]},{"id":"450a80f4.00dbc","type":"inject","z":"5a1cfe92.37e8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":1420,"wires":[["ba163a46.8bc2a8"]]},{"id":"809bd363.af904","type":"comment","z":"5a1cfe92.37e8f","name":"СТОРОНА 0","info":"START1;0;0;1;0;Верхня;Нижня<EOR>\n\nSTART1;0;0;1;іва;фів;","x":70,"y":180,"wires":[]},{"id":"c011700b.40717","type":"inject","z":"5a1cfe92.37e8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":320,"wires":[["df1efd3f.49dd4"]]},{"id":"df1efd3f.49dd4","type":"function","z":"5a1cfe92.37e8f","name":"погасити світлофори СТ_0","func":"\n\n\nmsg.payload =\"START1;0;0;3;1;0;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":320,"wires":[["265f6972.4cb7b6"]]},{"id":"a3f1437a.5992b","type":"inject","z":"5a1cfe92.37e8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":120,"wires":[["9567d1d3.7b3bc"]]},{"id":"9567d1d3.7b3bc","type":"function","z":"5a1cfe92.37e8f","name":"яскравість 100 всі сторони","func":"\n\n\nmsg.payload =\"START1;0;0;102;255;255;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":340,"y":120,"wires":[["265f6972.4cb7b6"]]},{"id":"4c4c12f6.68ea4c","type":"comment","z":"5a1cfe92.37e8f","name":"СТОРОНА 1 ","info":"START1;0;0;1;0;Верхня;Нижня<EOR>\n\nSTART1;0;0;1;іва;фів;","x":110,"y":680,"wires":[]},{"id":"57b60f1d.e38b6","type":"function","z":"70555ce8.17ecb4","name":"Світлофор зелений СТ_0","func":"\n\n           \nmsg.payload =\"START1;0;0;3;1;2;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":220,"wires":[["1a7cb6f1.8ce929"]]},{"id":"216d6a76.0d8776","type":"comment","z":"70555ce8.17ecb4","name":"","info":"START1;0;0;1;0;Верхня;Нижня<EOR>\n\nSTART1;0;0;1;іва;фів;","x":80,"y":20,"wires":[]},{"id":"f4beaf4.121e05","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":60,"wires":[["ff72785a.e38278"]]},{"id":"dd4881e6.fee46","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":940,"wires":[["3eddec3a.8f2b54"]]},{"id":"ff72785a.e38278","type":"function","z":"70555ce8.17ecb4","name":"ТЕСТ 1 сторона 0","func":"\nvar num_avto_r1 = \"ТЕст\";\nvar num_avto_r2 = \"вагова 3\";\n\n\nmsg.payload =\"START1;0;0;1;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n//            START1;0;0;1;0;Верхня;Нижня<EOR>            \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":60,"wires":[["5cf2d93b.5d6828"]]},{"id":"3eddec3a.8f2b54","type":"function","z":"70555ce8.17ecb4","name":"ТЕСТ сторона 1","func":"\nvar num_avto_r1 = \" 7777  \";\nvar num_avto_r2 = \" ТЕск кг \";\n\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n           \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":940,"wires":[["5cf2d93b.5d6828"]]},{"id":"5cf2d93b.5d6828","type":"converter","z":"70555ce8.17ecb4","name":"","from":"win1251","x":840,"y":440,"wires":[["1a7cb6f1.8ce929"]]},{"id":"1a7cb6f1.8ce929","type":"tcp out","z":"70555ce8.17ecb4","host":"10.3.6.229","port":"9761","beserver":"client","base64":false,"end":false,"name":"","x":1060,"y":440,"wires":[]},{"id":"a187e7ce.71ce98","type":"function","z":"70555ce8.17ecb4","name":"Світлофор червний СТ_0","func":"\n\n\nmsg.payload =\"START1;0;1;3;1;1;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":260,"wires":[["1a7cb6f1.8ce929"]]},{"id":"3a95371.a115dc8","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":220,"wires":[["57b60f1d.e38b6"]]},{"id":"b7e1153.966bde8","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":260,"wires":[["a187e7ce.71ce98"]]},{"id":"e743bddf.42b36","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":1060,"wires":[["85ce48d4.6156a8"]]},{"id":"85ce48d4.6156a8","type":"function","z":"70555ce8.17ecb4","name":"погасити світлофори СТ_1","func":"\n\n\nmsg.payload =\"START1;0;0;3;0;0;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":1060,"wires":[["4773fe4c.b5004","1a7cb6f1.8ce929"]]},{"id":"4773fe4c.b5004","type":"debug","z":"70555ce8.17ecb4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":790,"y":1060,"wires":[]},{"id":"4e4758d.ae603a8","type":"debug","z":"70555ce8.17ecb4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":790,"y":980,"wires":[]},{"id":"94767fb0.2f34c","type":"debug","z":"70555ce8.17ecb4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":790,"y":1020,"wires":[]},{"id":"58bd6991.059a48","type":"function","z":"70555ce8.17ecb4","name":"Світлофор червний СТ_1","func":"\n\n\nmsg.payload =\"START1;0;1;3;0;1;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":1020,"wires":[["94767fb0.2f34c","1a7cb6f1.8ce929"]]},{"id":"cc22b002.075de","type":"function","z":"70555ce8.17ecb4","name":"Світлофор зелений СТ_1","func":"\n\n\nmsg.payload =\"START1;0;0;3;0;2;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":980,"wires":[["4e4758d.ae603a8","1a7cb6f1.8ce929"]]},{"id":"2d0d52d.9bbcaae","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":980,"wires":[["cc22b002.075de"]]},{"id":"6f400b43.f4d214","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":1020,"wires":[["58bd6991.059a48"]]},{"id":"e7768915.e54cc8","type":"comment","z":"70555ce8.17ecb4","name":"СТОРОНА 0","info":"START1;0;0;1;0;Верхня;Нижня<EOR>\n\nSTART1;0;0;1;іва;фів;","x":70,"y":160,"wires":[]},{"id":"feaf22ed.351a1","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":300,"wires":[["9f42e3c0.af4c8"]]},{"id":"9f42e3c0.af4c8","type":"function","z":"70555ce8.17ecb4","name":"погасити світлофори СТ_0","func":"\n\n\nmsg.payload =\"START1;0;0;3;1;0;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":300,"wires":[["1a7cb6f1.8ce929"]]},{"id":"40e29d3f.746a74","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":100,"wires":[["d6652c13.b4152"]]},{"id":"d6652c13.b4152","type":"function","z":"70555ce8.17ecb4","name":"яскравість 100 всі сторони","func":"\n\n\nmsg.payload =\"START1;0;0;102;255;255;\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":320,"y":100,"wires":[["1a7cb6f1.8ce929"]]},{"id":"c2c012a8.cd11d","type":"comment","z":"70555ce8.17ecb4","name":"СТОРОНА 1 ","info":"START1;0;0;1;0;Верхня;Нижня<EOR>\n\nSTART1;0;0;1;іва;фів;","x":70,"y":820,"wires":[]},{"id":"9808d519.c3baa8","type":"function","z":"5a1cfe92.37e8f","name":"Дані строки з форми СТ_0","func":"var num_avto_r1 = msg.payload.r1;\nvar num_avto_r2 = msg.payload.r2;\n\n\n\nmsg.payload =\"START1;0;0;1;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":360,"wires":[["c1122f40.02659"]]},{"id":"9f37458c.6027a8","type":"function","z":"5a1cfe92.37e8f","name":"Дані строки з форми СТ_1","func":"var num_avto_r1 = msg.payload.r1;\nvar num_avto_r2 = msg.payload.r2;\n\n\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1300,"wires":[["c1122f40.02659"]]},{"id":"c2df3f8b.fe7a","type":"function","z":"70555ce8.17ecb4","name":"Дані строки з форми СТ_0","func":"var num_avto_r1 = msg.payload.r1;\nvar num_avto_r2 = msg.payload.r2;\n\n\n\nmsg.payload =\"START1;0;0;1;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":340,"wires":[["5cf2d93b.5d6828"]]},{"id":"bfee01c4.4cbc","type":"function","z":"70555ce8.17ecb4","name":"Дані строки з форми СТ_1","func":"var num_avto_r1 = msg.payload.r1;\nvar num_avto_r2 = msg.payload.r2;\n\n\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":900,"wires":[["5cf2d93b.5d6828"]]},{"id":"db0c474c.9f8318","type":"function","z":"5a1cfe92.37e8f","name":"Дані строки з NFC CТ_0","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;1;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":400,"wires":[[]]},{"id":"dc39dd71.db199","type":"function","z":"5a1cfe92.37e8f","name":"Дані строки з NFC CТ_1","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":1260,"wires":[[]]},{"id":"1cbf6837.f923d8","type":"function","z":"70555ce8.17ecb4","name":"Дані строки з NFC CТ_0","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":470,"y":380,"wires":[["5cf2d93b.5d6828"]]},{"id":"92e860a5.4a82e","type":"function","z":"70555ce8.17ecb4","name":"Дані строки з NFC CТ_1","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":860,"wires":[["5cf2d93b.5d6828"]]},{"id":"d04be0bc.69126","type":"ui_form","z":"13ebd25d.3a683e","name":"","label":"Табло 1 IN Сторона 1 (Від вагів)","group":"73729c49.e00d24","order":1,"width":0,"height":0,"options":[{"label":"Номер","value":"r1","type":"text","required":false},{"label":"Вага","value":"r2","type":"text","required":false}],"formValue":{"r1":"","r2":""},"payload":"","submit":"submit","cancel":"cancel","topic":"","x":470,"y":160,"wires":[["5ea2093e.208048"]]},{"id":"105618a6.db1d97","type":"ui_form","z":"13ebd25d.3a683e","name":"","label":"Табло2 OUT Сторона 1 (До вагів)","group":"aa448d43.a0b1c","order":1,"width":0,"height":0,"options":[{"label":"Номер","value":"r1","type":"text","required":false},{"label":"Вага","value":"r2","type":"text","required":false}],"formValue":{"r1":"","r2":""},"payload":"","submit":"submit","cancel":"cancel","topic":"","x":1160,"y":160,"wires":[["7819e26e.638f4c"]]},{"id":"5ea2093e.208048","type":"link out","z":"13ebd25d.3a683e","name":"T1 _ side 1","links":["b9520540.1aa848"],"x":635,"y":160,"wires":[]},{"id":"7819e26e.638f4c","type":"link out","z":"13ebd25d.3a683e","name":"T2_side 1","links":["1f40d33c.2dc40d"],"x":1335,"y":160,"wires":[]},{"id":"b9520540.1aa848","type":"link in","z":"70555ce8.17ecb4","name":"","links":["5ea2093e.208048"],"x":355,"y":900,"wires":[["bfee01c4.4cbc"]]},{"id":"97a658ae.441888","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"73729c49.e00d24","order":1,"width":0,"height":0,"passthru":true,"label":"Зелений","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":400,"y":200,"wires":[["570a2f31.44252"]]},{"id":"5639d0f2.44faa","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"73729c49.e00d24","order":1,"width":0,"height":0,"passthru":true,"label":"Червоний","tooltip":"","color":"","bgcolor":"red","icon":"","payload":"","payloadType":"date","topic":"","x":400,"y":240,"wires":[["7aff36eb.d18888"]]},{"id":"eec1365e.cefc78","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"73729c49.e00d24","order":1,"width":0,"height":0,"passthru":true,"label":"Погасити","tooltip":"","color":"","bgcolor":"gray","icon":"","payload":"","payloadType":"date","topic":"","x":400,"y":280,"wires":[["47d7254.0c7d5dc"]]},{"id":"c26ce2f5.66435","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"aa448d43.a0b1c","order":1,"width":0,"height":0,"passthru":true,"label":"Зелений","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"date","topic":"","x":1160,"y":200,"wires":[["cfb16b6f.4a8b98"]]},{"id":"ba50ab2e.408318","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"aa448d43.a0b1c","order":1,"width":0,"height":0,"passthru":true,"label":"Червоний","tooltip":"","color":"","bgcolor":"red","icon":"","payload":"","payloadType":"date","topic":"","x":1160,"y":240,"wires":[["e6f80f8.0e855f"]]},{"id":"cfb16b6f.4a8b98","type":"link out","z":"13ebd25d.3a683e","name":"Зелений Т2","links":["90b5f347.b8ed6"],"x":1275,"y":200,"wires":[]},{"id":"e6f80f8.0e855f","type":"link out","z":"13ebd25d.3a683e","name":"Чероний Т2","links":["d5fb62b4.460ec"],"x":1275,"y":240,"wires":[]},{"id":"971482ad.fcff3","type":"ui_button","z":"13ebd25d.3a683e","name":"","group":"aa448d43.a0b1c","order":1,"width":0,"height":0,"passthru":true,"label":"Погасити","tooltip":"","color":"","bgcolor":"gray","icon":"","payload":"","payloadType":"date","topic":"","x":1160,"y":280,"wires":[["58535d82.f7d324"]]},{"id":"58535d82.f7d324","type":"link out","z":"13ebd25d.3a683e","name":" погасити Т2","links":["af4093d4.6d00d"],"x":1275,"y":280,"wires":[]},{"id":"570a2f31.44252","type":"link out","z":"13ebd25d.3a683e","name":"T1_side_1_green","links":["ee57d521.bd05d8"],"x":540,"y":200,"wires":[]},{"id":"7aff36eb.d18888","type":"link out","z":"13ebd25d.3a683e","name":"T1_side_1_red","links":["c4692c5c.c392d"],"x":535,"y":240,"wires":[]},{"id":"47d7254.0c7d5dc","type":"link out","z":"13ebd25d.3a683e","name":"T1_side_1_off","links":["c2c40dd2.32fef"],"x":535,"y":280,"wires":[]},{"id":"ee57d521.bd05d8","type":"link in","z":"70555ce8.17ecb4","name":"","links":["570a2f31.44252"],"x":355,"y":1000,"wires":[["cc22b002.075de"]]},{"id":"c4692c5c.c392d","type":"link in","z":"70555ce8.17ecb4","name":"","links":["7aff36eb.d18888"],"x":355,"y":1040,"wires":[["58bd6991.059a48"]]},{"id":"c2c40dd2.32fef","type":"link in","z":"70555ce8.17ecb4","name":"","links":["47d7254.0c7d5dc"],"x":355,"y":1080,"wires":[["85ce48d4.6156a8"]]},{"id":"5688608.85e14a","type":"link out","z":"13ebd25d.3a683e","name":"T1 _ side 0","links":["5e83fd8d.830c14"],"x":315,"y":160,"wires":[]},{"id":"3a5f7dfc.accc72","type":"link out","z":"13ebd25d.3a683e","name":"T1_side_0_green","links":["6ca291aa.463"],"x":215,"y":200,"wires":[]},{"id":"7e0b2082.fb7eb","type":"link out","z":"13ebd25d.3a683e","name":"T1_side_0_red","links":["c72d4dea.51443"],"x":210,"y":240,"wires":[]},{"id":"e6f85945.7153b8","type":"link out","z":"13ebd25d.3a683e","name":"T1_side_0_off","links":["dc1e9cef.460c1"],"x":210,"y":280,"wires":[]},{"id":"5e83fd8d.830c14","type":"link in","z":"70555ce8.17ecb4","name":"T1 _ side 0_t","links":["5688608.85e14a"],"x":315,"y":340,"wires":[["c2df3f8b.fe7a"]]},{"id":"6ca291aa.463","type":"link in","z":"70555ce8.17ecb4","name":"T1_side_0_gree_t","links":["3a5f7dfc.accc72"],"x":275,"y":200,"wires":[["57b60f1d.e38b6"]]},{"id":"c72d4dea.51443","type":"link in","z":"70555ce8.17ecb4","name":"T1_side_0_red_t","links":["7e0b2082.fb7eb"],"x":275,"y":240,"wires":[["a187e7ce.71ce98"]]},{"id":"dc1e9cef.460c1","type":"link in","z":"70555ce8.17ecb4","name":"T1_side_0_off_t","links":["e6f85945.7153b8"],"x":275,"y":280,"wires":[["9f42e3c0.af4c8"]]},{"id":"3572085d.4e37d8","type":"link in","z":"5a1cfe92.37e8f","name":"","links":["b9121206.53afb"],"x":235,"y":360,"wires":[["9808d519.c3baa8"]]},{"id":"afa9628d.db5ba","type":"link in","z":"5a1cfe92.37e8f","name":"","links":["8918c75a.a56b28"],"x":235,"y":220,"wires":[["9e1e786b.0b8a18"]]},{"id":"aeb7f869.2b07f8","type":"link in","z":"5a1cfe92.37e8f","name":"","links":["4b9f81e4.d3168"],"x":235,"y":260,"wires":[["8d1590d5.2434d"]]},{"id":"2c51e85b.729248","type":"link in","z":"5a1cfe92.37e8f","name":"","links":["e626f291.4ed7"],"x":235,"y":300,"wires":[["df1efd3f.49dd4"]]},{"id":"1f40d33c.2dc40d","type":"link in","z":"5a1cfe92.37e8f","name":"T2_side_1","links":["7819e26e.638f4c"],"x":395,"y":1300,"wires":[["9f37458c.6027a8"]]},{"id":"90b5f347.b8ed6","type":"link in","z":"5a1cfe92.37e8f","name":"T2_side_1_green","links":["cfb16b6f.4a8b98"],"x":395,"y":1360,"wires":[["48a13098.9d64c"]]},{"id":"d5fb62b4.460ec","type":"link in","z":"5a1cfe92.37e8f","name":"T2_side_1_red","links":["e6f80f8.0e855f"],"x":395,"y":1400,"wires":[["ba163a46.8bc2a8"]]},{"id":"af4093d4.6d00d","type":"link in","z":"5a1cfe92.37e8f","name":"T2_side_1_off","links":["58535d82.f7d324"],"x":395,"y":1440,"wires":[["fbd74567.846e28"]]},{"id":"5bd9fe43.688aa","type":"comment","z":"13ebd25d.3a683e","name":"До вагів T2 S1","info":"","x":1100,"y":120,"wires":[]},{"id":"129e49cc.fc1db6","type":"comment","z":"13ebd25d.3a683e","name":"Від вагів T2 S0","info":"","x":760,"y":120,"wires":[]},{"id":"5fe27c2d.ebfb84","type":"comment","z":"13ebd25d.3a683e","name":"Від вагів T1 S1","info":"","x":420,"y":120,"wires":[]},{"id":"bf5bbfe4.8ffd9","type":"comment","z":"13ebd25d.3a683e","name":"До вагів T1 S0","info":"","x":100,"y":120,"wires":[]},{"id":"5684296d.24b178","type":"comment","z":"70555ce8.17ecb4","name":"До вагів T1 S0","info":"","x":220,"y":160,"wires":[]},{"id":"37e44dbd.3f7b42","type":"comment","z":"70555ce8.17ecb4","name":"Від вагів T1 S1","info":"","x":220,"y":820,"wires":[]},{"id":"bb90b3b6.263f","type":"comment","z":"5a1cfe92.37e8f","name":"Від вагів T2 S0","info":"","x":220,"y":180,"wires":[]},{"id":"177d6136.fc34ef","type":"comment","z":"5a1cfe92.37e8f","name":"До вагів T2 S1","info":"","x":280,"y":680,"wires":[]},{"id":"a3916a1f.564c68","type":"function","z":"70555ce8.17ecb4","name":"Дані строки з NFC","func":"\nvar num_avto_r1 = msg.payload;\nvar num_avto_r2 = \"\";\n\n\nmsg.payload =\"START1;0;0;1;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":440,"wires":[["5cf2d93b.5d6828"]]},{"id":"88549679.e93978","type":"link in","z":"70555ce8.17ecb4","name":"","links":["dfeabeda.5a578","e4690a36.062b38"],"x":295,"y":440,"wires":[[]]},{"id":"82727b53.ecb368","type":"function","z":"5a1cfe92.37e8f","name":"Дані строки з NFC CT_0","func":"\nvar num_avto_r1 = msg.payload;\nvar num_avto_r2 = \"\";\n\n\nmsg.payload =\"START1;0;0;1;1;\" + num_avto_r1 +\";\" + num_avto_r2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":440,"wires":[["c1122f40.02659"]]},{"id":"7084f4f5.d3b4dc","type":"link in","z":"5a1cfe92.37e8f","name":"","links":["84b6cf0.1e85f3"],"x":235,"y":440,"wires":[["82727b53.ecb368"]]},{"id":"ff68561b.3dd958","type":"link in","z":"70555ce8.17ecb4","name":"1C to Board 1","links":["f41fd7c8.0a9578"],"x":155,"y":500,"wires":[["6249717a.73414","4a171424.53e0fc"]]},{"id":"9cf71a26.9b06e8","type":"function","z":"70555ce8.17ecb4","name":"Дані строки з 1C","func":"msg.payload =\"START1;0;0;1;0;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":330,"y":500,"wires":[["5cf2d93b.5d6828"]]},{"id":"77dfb429.09b43c","type":"link in","z":"70555ce8.17ecb4","name":"rfid truck 1 table 1","links":["46f16a9d.111e54"],"x":155,"y":540,"wires":[["f1c9ba35.d0f9a8"]]},{"id":"f1c9ba35.d0f9a8","type":"function","z":"70555ce8.17ecb4","name":"Дані строки з NFC","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":330,"y":540,"wires":[["65f466b3.04cb68","5cf2d93b.5d6828"]]},{"id":"65f466b3.04cb68","type":"switch","z":"70555ce8.17ecb4","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"finded","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":540,"wires":[["a187e7ce.71ce98"]]},{"id":"6b0ee542.9bee5c","type":"link in","z":"70555ce8.17ecb4","name":"table_in_green_1_S0","links":["9b93a5db.a89dc8"],"x":155,"y":360,"wires":[["57b60f1d.e38b6"]]},{"id":"4bb89c8b.387794","type":"link in","z":"70555ce8.17ecb4","name":"table_in_red_1_S0","links":["d54798a6.ce6378","c7734ae5.72b348"],"x":155,"y":400,"wires":[["a187e7ce.71ce98"]]},{"id":"5ff77cff.223374","type":"function","z":"5a1cfe92.37e8f","name":"Дані строки з NFC","func":"var num_avto_r1 = msg.truck1;\n\nmsg.payload =\"START1;0;0;1;0;\" + num_avto_r1 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":1120,"wires":[["ab4f3c7b.8fd58","c1122f40.02659"]]},{"id":"c92599bb.0bc258","type":"link in","z":"5a1cfe92.37e8f","name":"rfid truck 1 table 2","links":["46f16a9d.111e54"],"x":235,"y":1120,"wires":[["5ff77cff.223374"]]},{"id":"ab4f3c7b.8fd58","type":"switch","z":"5a1cfe92.37e8f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"finded","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":570,"y":1120,"wires":[["ba163a46.8bc2a8"]]},{"id":"c97aa556.56e868","type":"link in","z":"5a1cfe92.37e8f","name":"table_out_green_2_S1","links":["e442cf81.b5bbf"],"x":215,"y":1200,"wires":[["48a13098.9d64c"]]},{"id":"71b01e27.99bc2","type":"link in","z":"5a1cfe92.37e8f","name":"table_out_red_2_S1","links":["e0fddba4.102a98"],"x":215,"y":1240,"wires":[["ba163a46.8bc2a8"]]},{"id":"d57e16c.2cb4de8","type":"link in","z":"5a1cfe92.37e8f","name":"1C to board 2","links":["19d2ce65.fa5f72"],"x":195,"y":760,"wires":[["c6bdf6a4.cb9c38","e623497c.9f1b68"]]},{"id":"445c8272.322a0c","type":"function","z":"5a1cfe92.37e8f","name":"Дані строки з 1C","func":"msg.payload =\"START1;0;0;1;1;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":350,"y":760,"wires":[["c1122f40.02659"]]},{"id":"e113b150.50da","type":"link out","z":"6280a9fb.c72548","name":"1c to Board 1_S1 (rest)","links":["c03cc0a3.d8acb"],"x":735,"y":720,"wires":[]},{"id":"70e34dab.e774d4","type":"link out","z":"6280a9fb.c72548","name":"1c to Board 2_S0 (rest)","links":["80e7a9c3.ec4bd8"],"x":735,"y":760,"wires":[]},{"id":"c03cc0a3.d8acb","type":"link in","z":"70555ce8.17ecb4","name":"1C to Board 1 S1","links":["e113b150.50da"],"x":175,"y":1140,"wires":[["a16dc023.c2bd2"]]},{"id":"a16dc023.c2bd2","type":"function","z":"70555ce8.17ecb4","name":"Дані строки з 1C","func":"msg.payload =\"START1;0;0;1;0;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":1140,"wires":[["5cf2d93b.5d6828"]]},{"id":"80e7a9c3.ec4bd8","type":"link in","z":"5a1cfe92.37e8f","name":"1C to board 2 S0","links":["70e34dab.e774d4"],"x":235,"y":480,"wires":[["c53d41c9.a9345"]]},{"id":"c53d41c9.a9345","type":"function","z":"5a1cfe92.37e8f","name":"Дані строки з 1C","func":"msg.payload =\"START1;0;0;1;1;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":480,"wires":[["c1122f40.02659","1c1d9f61.370ac1"]]},{"id":"70eff66a.f98978","type":"link out","z":"6280a9fb.c72548","name":"t_g_1_s_1","links":["7779a0eb.70ec6"],"x":1315,"y":180,"wires":[]},{"id":"896b8279.e972d","type":"switch","z":"6280a9fb.c72548","name":"green/red","property":"cmd","propertyType":"msg","rules":[{"t":"eq","v":"0100","vt":"str"},{"t":"eq","v":"0180","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1200,"y":160,"wires":[["70eff66a.f98978"],["6cb97ff.987278"]]},{"id":"6cb97ff.987278","type":"link out","z":"6280a9fb.c72548","name":"t_r_1_s_1","links":["3b5651f6.753dde","866003ec.38dfa"],"x":1315,"y":220,"wires":[]},{"id":"4c60517.c7e87b","type":"switch","z":"6280a9fb.c72548","name":"green/red","property":"cmd","propertyType":"msg","rules":[{"t":"eq","v":"0100","vt":"str"},{"t":"eq","v":"0180","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1200,"y":220,"wires":[["ab17c8ab.810258"],["fe6354bc.e97228"]]},{"id":"7779a0eb.70ec6","type":"link in","z":"70555ce8.17ecb4","name":"table_in_green_1_S1","links":["70eff66a.f98978"],"x":195,"y":880,"wires":[["cc22b002.075de"]]},{"id":"866003ec.38dfa","type":"link in","z":"70555ce8.17ecb4","name":"table_in_red_1_S1","links":["6cb97ff.987278"],"x":195,"y":920,"wires":[["58bd6991.059a48"]]},{"id":"f5869c09.4908a","type":"link in","z":"5a1cfe92.37e8f","name":"table_out_green_2_S0","links":["ab17c8ab.810258"],"x":115,"y":380,"wires":[["9e1e786b.0b8a18"]]},{"id":"b0726f2.b7fa89","type":"link in","z":"5a1cfe92.37e8f","name":"table_out_red_2_S0","links":["fe6354bc.e97228"],"x":115,"y":420,"wires":[["8d1590d5.2434d"]]},{"id":"ab17c8ab.810258","type":"link out","z":"6280a9fb.c72548","name":"t_g_2_s_0","links":["f5869c09.4908a","a0fb2f4c.029dc"],"x":1315,"y":260,"wires":[]},{"id":"fe6354bc.e97228","type":"link out","z":"6280a9fb.c72548","name":"t_r_2_s_0","links":["b0726f2.b7fa89"],"x":1315,"y":300,"wires":[]},{"id":"fc04df52.e4cea","type":"http in","z":"6280a9fb.c72548","name":"","url":"/api/platform/getAccessTable","method":"get","upload":false,"swaggerDoc":"","x":160,"y":160,"wires":[["5c7d6abc.d94344","94e51dc9.e5f73"]]},{"id":"5c7d6abc.d94344","type":"function","z":"6280a9fb.c72548","name":"set Access Table","func":"msg.payload = flow.get('accessTable');\nmsg.statusCode = 200;\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":160,"wires":[["813cb043.096e5"]]},{"id":"813cb043.096e5","type":"http response","z":"6280a9fb.c72548","name":"","statusCode":"","headers":{},"x":630,"y":160,"wires":[]},{"id":"cf914825.d26768","type":"function","z":"6280a9fb.c72548","name":"check infrared state","func":"var payload = {\n    'infraredstate1':0,\n    'infraredstate2':0\n}\nvar infraredtimeout = flow.get('infraredtimeout');\nvar cDate = new Date();\nif ((cDate - global.get('infraredstate1Date')) < infraredtimeout){\n    payload.infraredstate1 = global.get('infraredstate1') ;   \n}\n\nif ((cDate - global.get('infraredstate2Date')) < infraredtimeout){\n    payload.infraredstate2 = global.get('infraredstate2') ;   \n}\nmsg.infraredstate1 = Number(payload.infraredstate1.substring(0,1));\nmsg.infraredstate2 = Number(payload.infraredstate2.substring(0,1));\n\nmsg.perimetr = (msg.infraredstate1 == 1 && msg.infraredstate2 == 1);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":500,"wires":[["215be6dd.f2539a"]]},{"id":"e7eb5f52.a5154","type":"switch","z":"6280a9fb.c72548","name":"access_granted","property":"access_granted","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1320,"y":580,"wires":[["c5124814.5a1948","c9682405.69b478"],["1bd8c868.29bd58","1eb6e1fd.2f40ae"]]},{"id":"1bd8c868.29bd58","type":"function","z":"6280a9fb.c72548","name":"send text to board","func":"flow.set('temp_tagID',msg.tagID);\n\nmsg.payload = {\n                \"row1\":\"датчик\",\n                \"row2\":\"перекрито\"\n            };\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1050,"y":660,"wires":[["6454c582.0839dc","19d2ce65.fa5f72","f41fd7c8.0a9578"]]},{"id":"147b71d1.7cb67e","type":"switch","z":"6280a9fb.c72548","name":"access granted","property":"do","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1000,"y":340,"wires":[["b6eddb72.e5dc48"],["6d9298bd.14d408"]]},{"id":"b6eddb72.e5dc48","type":"function","z":"6280a9fb.c72548","name":"set granted ","func":"flow.set('access_granted',true);\nglobal.set('zeroWeight',true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":340,"wires":[["9b5e0c73.f6915","877bbcdc.ec59d"]]},{"id":"9b5e0c73.f6915","type":"function","z":"6280a9fb.c72548","name":"send text to board","func":"msg.payload = {\n                \"row1\":\"пр. карту\",\n                \"row2\":\"#вес\"\n            };\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1430,"y":340,"wires":[["f41fd7c8.0a9578","19d2ce65.fa5f72","9bb5dd3e.52c4e"]]},{"id":"81b56d58.8ba3d","type":"http request","z":"6280a9fb.c72548","name":"to 1C ","method":"POST","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2490,"y":580,"wires":[["94f587e8.19fb38"]]},{"id":"b004c556.2f4d88","type":"function","z":"6280a9fb.c72548","name":"Взвесили с пересеченным периметром","func":"var host = 'http://10.3.6.253/UE_laz/hs/PerimeterControl/api/SmartScales/yag_avto2';\nmsg.payload = {\n    'ИдентификаторОбъекта':msg.tag.tagID,\n    'ИдентификаторАктивности':'ab2abea2-8602-11e9-4782-0242ac130003',\n    'ЗначениеВеса':global.get('weight')\n};\nmsg.url = host;\nmsg.headers = {};\nmsg.req = {};\nmsg.res = {};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2240,"y":580,"wires":[["94f587e8.19fb38","81b56d58.8ba3d","5ff6375e.34b838"]]},{"id":"ffd6d39c.ceeff","type":"switch","z":"6280a9fb.c72548","name":"","property":"perimetr","propertyType":"msg","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":2010,"y":580,"wires":[["b004c556.2f4d88"]]},{"id":"215be6dd.f2539a","type":"switch","z":"6280a9fb.c72548","name":"perimetr true/false","property":"perimetr","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1050,"y":720,"wires":[["c5124814.5a1948"],["e7eb5f52.a5154","753294ac.f81b7c"]]},{"id":"38891bb.080ece4","type":"json","z":"6280a9fb.c72548","name":"","property":"payload","action":"obj","pretty":false,"x":1690,"y":580,"wires":[["36b629a3.cea0e6"]]},{"id":"cc952bdc.c00678","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":80,"wires":[]},{"id":"c5124814.5a1948","type":"function","z":"6280a9fb.c72548","name":"1C get Tag Data","func":"msg.url = \"http://10.3.6.253/UE_laz/hs/PerimeterControl/api/PrincipNodeRed/getTagData\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1360,"y":700,"wires":[["57a838bd.0716c8"]]},{"id":"57a838bd.0716c8","type":"http request","z":"6280a9fb.c72548","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1570,"y":700,"wires":[["db7dcc93.b46d1","35e1c693.b946ba"]]},{"id":"db7dcc93.b46d1","type":"json","z":"6280a9fb.c72548","name":"","property":"payload","action":"obj","pretty":false,"x":1730,"y":700,"wires":[["7c647de1.e73aa4"]]},{"id":"7c647de1.e73aa4","type":"function","z":"6280a9fb.c72548","name":"get tag Data","func":"var tagID   = msg.tag.tagID.toUpperCase();\nvar tagdDataArray = msg.payload;\nvar tagData = {};\nfor(var i=0; i < tagdDataArray.length; i++){\n    if (tagdDataArray[i].tagID === tagID){\n        tagData = tagdDataArray[i];        \n    }\n}\n\nmsg.tagData = tagData;\nmsg.req = {};\nmsg.res = {};\nmsg.url = {};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1870,"y":700,"wires":[["49ca4e89.f450c"]]},{"id":"59c8affe.48d18","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2550,"y":520,"wires":[]},{"id":"697e609a.3bc22","type":"function","z":"70555ce8.17ecb4","name":"Дані строки з 1C","func":"var row1 = flow.get(\"row1\");\nvar row2 = flow.get(\"row2\");\n\n//msg.payload.row1 = flow.get(\"row1\");\n//msg.payload.row2 = flow.get(\"row2\");\n\n\nif(row1 == \"#вес\" ){\n   msg.payload.row1 = global.get(\"weight\");\n   msg.payload.row2 = flow.get(\"row2\"); \n   }else if(row2 == \"#вес\" ){\n   msg.payload.row2 = global.get(\"weight\");\n   msg.payload.row1 = flow.get(\"row1\"); \n}\n\n\nmsg.payload =\"START1;0;0;1;1;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"x":430,"y":1780,"wires":[["a1273f23.82a8c"]]},{"id":"a1273f23.82a8c","type":"debug","z":"70555ce8.17ecb4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":610,"y":1780,"wires":[]},{"id":"ea17b8e.e1dee48","type":"function","z":"70555ce8.17ecb4","name":"true","func":"msg.payload = {\n    row2: \"Очіування \",\n    row1: \"#вес\",\n    ident: \"cmd\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":1620,"wires":[["a88731e4.e0bb6"]]},{"id":"74ee4fb7.5bcb6","type":"function","z":"70555ce8.17ecb4","name":"true","func":"msg.payload = {\n    row2: \"Очіування \",\n    row1: \"TEST\",\n    ident: \"cmd\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":233.55554962158203,"y":1574.9166717529297,"wires":[["a88731e4.e0bb6"]]},{"id":"4788dc7c.482214","type":"inject","z":"70555ce8.17ecb4","name":"1с","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"row2\":\"Аналіз\",\"row1\":\"Очікування\",\"ident\":\"cmd\"}","payloadType":"json","x":93.88886260986328,"y":1615.2777700424194,"wires":[["ea17b8e.e1dee48"]]},{"id":"ed7943bc.521a6","type":"switch","z":"70555ce8.17ecb4","name":"","property":"cmdOts1","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":190,"y":1780,"wires":[["a88731e4.e0bb6"]]},{"id":"6b95f59.8a7250c","type":"inject","z":"70555ce8.17ecb4","name":"1с","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"row2\":\"Аналіз\",\"row1\":\"Очікування\",\"ident\":\"cmd\"}","payloadType":"json","x":83.19442367553711,"y":1576.9445180892944,"wires":[["74ee4fb7.5bcb6"]]},{"id":"3df01fad.22fd3","type":"inject","z":"70555ce8.17ecb4","name":"reset","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"msgPayload","payloadType":"flow","x":70,"y":1780,"wires":[["ed7943bc.521a6","206811f8.640dde"]]},{"id":"30946a18.89da26","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":430,"y":1700,"wires":[["66d97ed8.13422"]]},{"id":"66d97ed8.13422","type":"function","z":"70555ce8.17ecb4","name":"init Змінні для події    #вага","func":"flow.set(\"cmdOts1\",false);\nflow.set(\"msgPayload\",{});\nflow.set(\"row1\",\"\");\nflow.set(\"row2\",\"\");\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":1700,"wires":[[]]},{"id":"f4e65545.61ef18","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"weight","payloadType":"global","x":430,"y":1820,"wires":[["3eb9e359.ce49ec"]]},{"id":"3eb9e359.ce49ec","type":"debug","z":"70555ce8.17ecb4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":1820,"wires":[]},{"id":"4bcc0b03.dbe464","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":1500,"wires":[[]]},{"id":"110fb6c9.e3b8b9","type":"function","z":"70555ce8.17ecb4","name":"true","func":"flow.set(\"cmdOts1\",true);\n\n\n\nmsg.payload = {\n    row2: \"Очіування \",\n    row1: \"#вес\",\n    ident: \"cmd\"\n}\n\nflow.set(\"row1\", msg.payload.row1);\nflow.set(\"row2\", msg.payload.row2);\nflow.set(\"msgPayload\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":1500,"wires":[[]]},{"id":"a88731e4.e0bb6","type":"function","z":"70555ce8.17ecb4","name":"true","func":"var dies_1 = msg.payload.row1;\nvar dies_2 = msg.payload.row2;\n\n    if(dies_1 == \"#вес\" || dies_2 == \"#вес\"){\n        flow.set(\"cmdOts1\",true);\n    }else if(dies_1 !== \"#вес\" && dies_2 !== \"#вес\"){\n        flow.set(\"cmdOts1\",false);\n    }\n\nvar last_mes = {\n    row1: dies_1,\n    row2: dies_2\n}\n\nflow.set(\"row1\", msg.payload.row1);\nflow.set(\"row2\", msg.payload.row2);\nflow.set(\"msgPayload\", last_mes);\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":1620,"wires":[["697e609a.3bc22","2a572402.38567c"]]},{"id":"b8e68803.23c0f8","type":"inject","z":"70555ce8.17ecb4","name":"1с","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"row2\":\"Аналіз\",\"row1\":\"Очікування\",\"ident\":\"cmd\"}","payloadType":"json","x":110,"y":1660,"wires":[["3f9f2c60.bd9c14"]]},{"id":"3f9f2c60.bd9c14","type":"function","z":"70555ce8.17ecb4","name":"true","func":"msg.payload = {\n    row2: \"#вес\",\n    row1: \"АНАЛІЗ\",\n    ident: \"cmd\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":1680,"wires":[["a88731e4.e0bb6","f1fd62d2.4e99a"]]},{"id":"40fab78f.c5a608","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"row1","payloadType":"flow","x":260,"y":1400,"wires":[["43c66046.9e2db"]]},{"id":"43c66046.9e2db","type":"debug","z":"70555ce8.17ecb4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":460,"y":1440,"wires":[]},{"id":"db1b054c.d2efb8","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"row2","payloadType":"flow","x":260,"y":1440,"wires":[["43c66046.9e2db"]]},{"id":"f1fd62d2.4e99a","type":"debug","z":"70555ce8.17ecb4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":370,"y":1540,"wires":[]},{"id":"2a572402.38567c","type":"debug","z":"70555ce8.17ecb4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":490,"y":1600,"wires":[]},{"id":"206811f8.640dde","type":"debug","z":"70555ce8.17ecb4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":210,"y":1860,"wires":[]},{"id":"5c96a6ad.f695e8","type":"inject","z":"70555ce8.17ecb4","name":"reset","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"msgPayload","payloadType":"flow","x":70,"y":720,"wires":[["82357dfe.15b41"]]},{"id":"82357dfe.15b41","type":"switch","z":"70555ce8.17ecb4","name":"","property":"cmdOts1","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":190,"y":720,"wires":[["6249717a.73414"]]},{"id":"6249717a.73414","type":"function","z":"70555ce8.17ecb4","name":"true","func":"var dies_1 = msg.payload.row1;\nvar dies_2 = msg.payload.row2;\n\n    if(dies_1 == \"#вес\" || dies_2 == \"#вес\"){\n        flow.set(\"cmdOts1\",true);\n    }else if(dies_1 !== \"#вес\" && dies_2 !== \"#вес\"){\n        flow.set(\"cmdOts1\",false);\n    }\n\nvar last_mes = {\n    row1: dies_1,\n    row2: dies_2\n}\n\nflow.set(\"row1\", msg.payload.row1);\nflow.set(\"row2\", msg.payload.row2);\nflow.set(\"msgPayload\", last_mes);\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":660,"wires":[["30e80ba1.f805f4"]]},{"id":"30e80ba1.f805f4","type":"function","z":"70555ce8.17ecb4","name":"Дані строки з 1C","func":"var row1 = flow.get(\"row1\");\nvar row2 = flow.get(\"row2\");\n\n//msg.payload.row1 = flow.get(\"row1\");\n//msg.payload.row2 = flow.get(\"row2\");\n\n\nif(row1 == \"#вес\" ){\n   msg.payload.row1 = global.get(\"weight\");\n   msg.payload.row2 = flow.get(\"row2\"); \n   }else if(row2 == \"#вес\" ){\n   msg.payload.row2 = global.get(\"weight\");\n   msg.payload.row1 = flow.get(\"row1\"); \n}\n\n\nmsg.payload =\"START1;0;0;1;1;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":720,"wires":[["8a9041b0.d7942","5cf2d93b.5d6828","ae2eebf0.9a6878"]]},{"id":"8a9041b0.d7942","type":"debug","z":"70555ce8.17ecb4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":470,"y":800,"wires":[]},{"id":"41c239f8.329bb8","type":"function","z":"70555ce8.17ecb4","name":"init Змінні для події    #вага","func":"flow.set(\"cmdOts1\",false);\nflow.set(\"msgPayload\",{});\nflow.set(\"row1\",\"\");\nflow.set(\"row2\",\"\");\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":620,"wires":[[]]},{"id":"5e9997.18aa3668","type":"inject","z":"70555ce8.17ecb4","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":620,"wires":[["41c239f8.329bb8"]]},{"id":"2044d2c4.905ffe","type":"inject","z":"5a1cfe92.37e8f","name":"reset","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"msgPayload","payloadType":"flow","x":110,"y":920,"wires":[["b4b04329.9f80b"]]},{"id":"b4b04329.9f80b","type":"switch","z":"5a1cfe92.37e8f","name":"","property":"cmdOts1","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":230,"y":920,"wires":[["c6bdf6a4.cb9c38"]]},{"id":"c6bdf6a4.cb9c38","type":"function","z":"5a1cfe92.37e8f","name":"true","func":"var dies_1 = msg.payload.row1;\nvar dies_2 = msg.payload.row2;\n\n    if(dies_1 == \"#вес\" || dies_2 == \"#вес\"){\n        flow.set(\"cmdOts1\",true);\n    }else if(dies_1 !== \"#вес\" && dies_2 !== \"#вес\"){\n        flow.set(\"cmdOts1\",false);\n    }\n\nvar last_mes = {\n    row1: dies_1,\n    row2: dies_2\n}\n\nflow.set(\"row1\", msg.payload.row1);\nflow.set(\"row2\", msg.payload.row2);\nflow.set(\"msgPayload\", last_mes);\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":860,"wires":[["a08169a5.7948c8"]]},{"id":"a08169a5.7948c8","type":"function","z":"5a1cfe92.37e8f","name":"Дані строки з 1C","func":"var row1 = flow.get(\"row1\");\nvar row2 = flow.get(\"row2\");\n\n//msg.payload.row1 = flow.get(\"row1\");\n//msg.payload.row2 = flow.get(\"row2\");\n\n\nif(row1 == \"#вес\" ){\n   msg.payload.row1 = global.get(\"weight\");\n   msg.payload.row2 = flow.get(\"row2\"); \n   }else if(row2 == \"#вес\" ){\n   msg.payload.row2 = global.get(\"weight\");\n   msg.payload.row1 = flow.get(\"row1\"); \n}\n\n\nmsg.payload =\"START1;0;0;1;0;\" +  msg.payload.row1 +\";\" + msg.payload.row2 +\";\" + String.fromCharCode(10) + String.fromCharCode(13);\n             \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":920,"wires":[["bdfa8c86.53087","c1122f40.02659"]]},{"id":"1b6904fb.8fe88b","type":"function","z":"5a1cfe92.37e8f","name":"init Змінні для події    #вага","func":"flow.set(\"cmdOts1\",false);\nflow.set(\"msgPayload\",{});\nflow.set(\"row1\",\"\");\nflow.set(\"row2\",\"\");\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":820,"wires":[[]]},{"id":"e59b76bd.00f0a8","type":"inject","z":"5a1cfe92.37e8f","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":820,"wires":[["1b6904fb.8fe88b"]]},{"id":"bdfa8c86.53087","type":"debug","z":"5a1cfe92.37e8f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":510,"y":1000,"wires":[]},{"id":"e623497c.9f1b68","type":"debug","z":"5a1cfe92.37e8f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":330,"y":720,"wires":[]},{"id":"4a171424.53e0fc","type":"debug","z":"70555ce8.17ecb4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":310,"y":580,"wires":[]},{"id":"1c1d9f61.370ac1","type":"delay","z":"5a1cfe92.37e8f","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":390,"y":620,"wires":[["5e6ca35f.e4025c"]]},{"id":"ae2eebf0.9a6878","type":"delay","z":"70555ce8.17ecb4","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":510,"y":660,"wires":[["5fe307dc.4071e8"]]},{"id":"5fe307dc.4071e8","type":"delay","z":"70555ce8.17ecb4","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":600,"wires":[["d6652c13.b4152"]]},{"id":"5e6ca35f.e4025c","type":"delay","z":"5a1cfe92.37e8f","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":480,"y":560,"wires":[["9567d1d3.7b3bc"]]},{"id":"755678ea.3e62f8","type":"function","z":"e5aa27b6.d78288","name":"set global zero weight","func":"var weight = Number(msg.payload);\n\nif (weight === 0){\n    global.set('zeroWeight',true);\n}\nmsg.weight = weight;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":400,"wires":[["faea67a3.a668b8","9193d990.5bfb18"]]},{"id":"faea67a3.a668b8","type":"debug","z":"e5aa27b6.d78288","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":400,"wires":[]},{"id":"647dcbd8.1ea924","type":"inject","z":"13ebd25d.3a683e","name":"","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"zeroWeight","payloadType":"global","x":170,"y":360,"wires":[["1d29a908.5f6a97","800c56c.5e986a8"]]},{"id":"1d29a908.5f6a97","type":"ui_text","z":"13ebd25d.3a683e","group":"beead279.6b01f","order":1,"width":0,"height":0,"name":"","label":"Ноль установлен","format":"{{msg.payload}}","layout":"row-spread","x":570,"y":320,"wires":[]},{"id":"cae9ad67.b0fc8","type":"switch","z":"6280a9fb.c72548","name":"zero Weight","property":"zeroWeight","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1870,"y":440,"wires":[["a0585449.3b3588"],["2c200e85.a1fad2"]]},{"id":"14020f88.70be5","type":"inject","z":"e5aa27b6.d78288","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":500,"wires":[["7a453b49.e3a874"]]},{"id":"7a453b49.e3a874","type":"function","z":"e5aa27b6.d78288","name":"","func":" global.set('zeroWeight',true);\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":500,"wires":[[]]},{"id":"2c200e85.a1fad2","type":"function","z":"6280a9fb.c72548","name":"send text to board","func":"msg.payload = {\n                \"row1\":\"ваги\",\n                \"row2\":\"не обнулені\"\n            };\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":480,"wires":[["19d2ce65.fa5f72","f41fd7c8.0a9578"]]},{"id":"9193d990.5bfb18","type":"ui_chart","z":"e5aa27b6.d78288","name":"","group":"2c1c654f.e9ddca","order":2,"width":0,"height":0,"label":"Графік ваги","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"-100","ymax":"65000","removeOlder":"10","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":840,"y":180,"wires":[[]]},{"id":"800c56c.5e986a8","type":"function","z":"13ebd25d.3a683e","name":"","func":"msg.payload = Number(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":380,"wires":[["cfdc88ac.cfd478"]]},{"id":"cfdc88ac.cfd478","type":"ui_chart","z":"13ebd25d.3a683e","name":"","group":"2a33a361.b71c7c","order":4,"width":0,"height":0,"label":"Графік нуля","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"1","removeOlder":"30","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":570,"y":380,"wires":[[]]},{"id":"c156d98.8671a28","type":"debug","z":"10d39a76.2386c6","name":"rfid_out","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","x":600,"y":240,"wires":[]},{"id":"6a8e4553.24f4cc","type":"function","z":"10d39a76.2386c6","name":"Парсинг строки","func":"var keycode = \"\";\nvar el = \"\";\n\n\nmsg.payload.reverse().forEach(function(element) {\n  if (element.toString('16').length <2) el = \"0\" + element.toString('16'); else el = element.toString('16');\n  keycode = keycode + el;\n});\n\nmsg.payload = keycode;\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":200,"wires":[["c156d98.8671a28","ac93f63b.65d968"]]},{"id":"bd26f5b7.beb548","type":"comment","z":"10d39a76.2386c6","name":"Виїзд","info":"","x":70,"y":200,"wires":[]},{"id":"c3c6db8.1d30e28","type":"delay","z":"10d39a76.2386c6","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":620,"y":100,"wires":[["dfeabeda.5a578"]]},{"id":"ac93f63b.65d968","type":"delay","z":"10d39a76.2386c6","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":620,"y":200,"wires":[["84b6cf0.1e85f3"]]},{"id":"2a480916.a53db6","type":"serial in","z":"10d39a76.2386c6","name":"","serial":"84c7492a.a95898","x":210,"y":200,"wires":[["6a8e4553.24f4cc","47a7459b.c5b07c"]]},{"id":"297b5b60.1852c4","type":"serial in","z":"10d39a76.2386c6","name":"","serial":"b6f82620.2f3998","x":230,"y":100,"wires":[["8ca72b1f.9c4a58","8c1da3fd.2a15e"]]},{"id":"8ca72b1f.9c4a58","type":"function","z":"10d39a76.2386c6","name":"Парсинг строки","func":"var keycode = \"\";\nvar el = \"\";\n\n\nmsg.payload.reverse().forEach(function(element) {\n  if (element.toString('16').length <2) el = \"0\" + element.toString('16'); else el = element.toString('16');\n  keycode = keycode + el;\n});\n\nmsg.payload = keycode;\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":100,"wires":[["10f0fb6b.48c2c5","c3c6db8.1d30e28"]]},{"id":"10f0fb6b.48c2c5","type":"debug","z":"10d39a76.2386c6","name":"rfid_in","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","x":600,"y":140,"wires":[]},{"id":"12e5563e.3ff91a","type":"tcp in","z":"6280a9fb.c72548","name":"","server":"server","host":"","port":"10001","datamode":"stream","datatype":"utf8","newline":"","topic":"","base64":false,"x":80,"y":540,"wires":[["2d6dacfc.f51a64","845c4c4c.bb09c"]]},{"id":"2d6dacfc.f51a64","type":"function","z":"6280a9fb.c72548","name":"UPLOAD","func":"msg.ip = \"NFC_upload\";\nmsg.antennaID = 1;\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":540,"wires":[["9338bf58.fea52"]]},{"id":"26abb833.200eb8","type":"tcp out","z":"6280a9fb.c72548","host":"10.3.45.241","port":"10005","beserver":"client","base64":false,"end":false,"name":"","x":800,"y":820,"wires":[]},{"id":"19dbf625.21f20a","type":"json","z":"6280a9fb.c72548","name":"","property":"payload","action":"str","pretty":false,"x":630,"y":820,"wires":[["26abb833.200eb8","a2ab2d68.7b542"]]},{"id":"9338bf58.fea52","type":"function","z":"6280a9fb.c72548","name":"get IP","func":"msg.tagID = msg.payload;\nvar  s = \"-\";\nmsg.tagID = msg.tagID.substring(0,2)+s+msg.tagID.substring(2,4)+s+msg.tagID.substring(4,6)+s+msg.tagID.substring(6,8);\nmsg.tag   = {\"tagID\":msg.tagID};\nmsg.antennaID = msg.antennaID;\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":540,"wires":[["aff9984a.852f28"]]},{"id":"aff9984a.852f28","type":"function","z":"6280a9fb.c72548","name":"send to 1C","func":"msg.url = flow.get('host1C');\nmsg.tag.lastSeenTimestampUTC = new Date();\nmsg.tag.ip = msg.ip;\nmsg.tag.antenna = String(msg.antennaID);\nmsg.tag.antennaID = String(msg.antennaID);\nmsg.tag.direction = 'IN';\n\nmsg.payload = [msg.tag];\n\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":540,"wires":[["4bb16f1.38d299"]]},{"id":"91210c2a.ef16d","type":"ui_button","z":"e5aa27b6.d78288","name":"","group":"beead279.6b01f","order":2,"width":0,"height":0,"passthru":false,"label":"Зкинути 0","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":380,"wires":[["7a453b49.e3a874"]]},{"id":"bfdc4c71.2198c","type":"link in","z":"13ebd25d.3a683e","name":"","links":["14d34a2e.069cc6"],"x":75,"y":960,"wires":[["546cfb12.208c04"]]},{"id":"630aa590.a8e21c","type":"link in","z":"13ebd25d.3a683e","name":"","links":["937fff02.67285"],"x":75,"y":1040,"wires":[["807b02b6.15205"]]},{"id":"546cfb12.208c04","type":"function","z":"13ebd25d.3a683e","name":"","func":"msg.payload = msg.payload.number;\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":960,"wires":[["8edd5973.e75b48"]]},{"id":"8edd5973.e75b48","type":"ui_text","z":"13ebd25d.3a683e","group":"2005a425.559e9c","order":5,"width":0,"height":0,"name":"","label":"Номер вїзд:","format":"{{msg.payload}}","layout":"row-spread","x":310,"y":960,"wires":[]},{"id":"807b02b6.15205","type":"function","z":"13ebd25d.3a683e","name":"","func":"msg.payload = msg.payload.number;\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":1040,"wires":[["390a0070.1fafb"]]},{"id":"390a0070.1fafb","type":"ui_text","z":"13ebd25d.3a683e","group":"2005a425.559e9c","order":5,"width":0,"height":0,"name":"","label":"Номер виїзд:","format":"{{msg.payload}}","layout":"row-spread","x":320,"y":1040,"wires":[]},{"id":"b6a0141f.ebf4c8","type":"rpi-gpio in","z":"2d1f7cd0.735b14","name":"","pin":"11","intype":"down","debounce":"1000","read":false,"x":200,"y":100,"wires":[["5194e5bd.2bd77c"]]},{"id":"5194e5bd.2bd77c","type":"debug","z":"2d1f7cd0.735b14","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":100,"wires":[]},{"id":"36b629a3.cea0e6","type":"function","z":"6280a9fb.c72548","name":"check infrared state","func":"var payload = {\n    'infraredstate1':0,\n    'infraredstate2':0\n}\nvar infraredtimeout = flow.get('infraredtimeout');\nvar cDate = new Date();\nif ((cDate - global.get('infraredstate1Date')) < infraredtimeout){\n    payload.infraredstate1 = global.get('infraredstate1') ;   \n}\n\nif ((cDate - global.get('infraredstate2Date')) < infraredtimeout){\n    payload.infraredstate2 = global.get('infraredstate2') ;   \n}\n\nmsg.infraredstate1 = Number(payload.infraredstate1.substring(0,1));\nmsg.infraredstate2 = Number(payload.infraredstate2.substring(0,1));\nmsg.perimetr = (msg.infraredstate1 == 1 && msg.infraredstate2 == 1);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1850,"y":580,"wires":[["ffd6d39c.ceeff"]]},{"id":"94f587e8.19fb38","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2650,"y":580,"wires":[]},{"id":"845c4c4c.bb09c","type":"debug","z":"6280a9fb.c72548","name":"tcp:10001","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":260,"y":500,"wires":[]},{"id":"439db6a7.254d38","type":"inject","z":"6280a9fb.c72548","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"123213123","payloadType":"num","x":170,"y":1340,"wires":[["55386f26.9eb4"]]},{"id":"55386f26.9eb4","type":"debug","z":"6280a9fb.c72548","name":"test","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":340,"y":1360,"wires":[]},{"id":"a2ab2d68.7b542","type":"debug","z":"6280a9fb.c72548","name":"board_upload","active":true,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":840,"y":780,"wires":[]},{"id":"1c7ef637.df4daa","type":"debug","z":"6280a9fb.c72548","name":"api/platform/setBoardText","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":300,"y":720,"wires":[]},{"id":"93b33455.378d18","type":"debug","z":"6280a9fb.c72548","name":"api/platform/getReaderConfig","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":350,"y":640,"wires":[]},{"id":"256ccd56.1d2512","type":"json","z":"6280a9fb.c72548","name":"","property":"payload","action":"str","pretty":false,"x":150,"y":640,"wires":[["93b33455.378d18"]]},{"id":"dfd7cad2.30f998","type":"json","z":"6280a9fb.c72548","name":"","property":"payload","action":"str","pretty":false,"x":110,"y":720,"wires":[["1c7ef637.df4daa"]]},{"id":"a26818b2.045c98","type":"inject","z":"10d39a76.2386c6","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"121332","payloadType":"num","x":390,"y":140,"wires":[["10f0fb6b.48c2c5","8c1da3fd.2a15e","47a7459b.c5b07c"]]},{"id":"5354005e.84859","type":"debug","z":"6280a9fb.c72548","name":"send to 1C","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","x":2420,"y":460,"wires":[]},{"id":"5ff6375e.34b838","type":"json","z":"6280a9fb.c72548","name":"","property":"payload","action":"str","pretty":false,"x":2270,"y":460,"wires":[["5354005e.84859"]]},{"id":"bd68e8a0.ee4c68","type":"json","z":"6280a9fb.c72548","name":"","property":"payload","action":"str","pretty":false,"x":390,"y":280,"wires":[["d2c1ceeb.1117e","d83ab0e9.81254"]]},{"id":"d2c1ceeb.1117e","type":"debug","z":"6280a9fb.c72548","name":"POST_/api/platform/setDefaultTable","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":610,"y":280,"wires":[]},{"id":"23a23498.f2a82c","type":"json","z":"6280a9fb.c72548","name":"","property":"payload","action":"str","pretty":false,"x":370,"y":200,"wires":[["53fa7f45.e0009","d83ab0e9.81254"]]},{"id":"53fa7f45.e0009","type":"debug","z":"6280a9fb.c72548","name":"POST_/api/platform/getAccessTable","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":590,"y":200,"wires":[]},{"id":"94e51dc9.e5f73","type":"json","z":"6280a9fb.c72548","name":"","property":"payload","action":"str","pretty":false,"x":390,"y":120,"wires":[["87d57882.0d1dc8"]]},{"id":"87d57882.0d1dc8","type":"debug","z":"6280a9fb.c72548","name":"GET_/api/platform/getAccessTable","active":false,"tosidebar":false,"console":true,"tostatus":false,"complete":"payload","x":610,"y":120,"wires":[]},{"id":"3e0a822.9da8f7e","type":"debug","z":"e5aa27b6.d78288","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":100,"wires":[]},{"id":"a0585449.3b3588","type":"function","z":"6280a9fb.c72548","name":"Stable weight check","func":"var msg1 = msg;\nvar msg2 = msg;\nvar weight = JSON.parse(msg.payload);\nif(weight.stable === true){\n    msg1.payload = msg.payload;\n    return [msg1, null];\n}else{\n    global.set('zeroWeight',true);\n    msg2.payload = {\n                \"row1\":\"вага\",\n                \"row2\":\"нестабільна\"\n    };\n    return [null,msg2];\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","x":2060,"y":420,"wires":[["9fda0279.2585c","28d4b21f.b1d8ee"],["a16f553e.38ca78","f41fd7c8.0a9578","19d2ce65.fa5f72","df91c67.8aaf838"]]},{"id":"9fda0279.2585c","type":"debug","z":"6280a9fb.c72548","name":"if true","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2250,"y":320,"wires":[]},{"id":"a16f553e.38ca78","type":"debug","z":"6280a9fb.c72548","name":"if false","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2270,"y":360,"wires":[]},{"id":"df91c67.8aaf838","type":"delay","z":"6280a9fb.c72548","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2040,"y":360,"wires":[["9b5e0c73.f6915"]]},{"id":"d83ab0e9.81254","type":"function","z":"6280a9fb.c72548","name":"tagsObjCreate","func":"let guidObj = {};\nlet serviceTagsObj = {};\nJSON.parse(msg.payload).forEach(function(obj){\n    obj.tags_data.forEach(function(item){\n        if(item.tag.trim() !== '') guidObj[item.tag.toUpperCase()] = item.guid;\n    });\n});\nJSON.parse(msg.payload).forEach(function(obj){\n    if(obj.pointID === 'Неопределенно'){\n        obj.tags.forEach(function(item){\n            if(item !== '') serviceTagsObj[item.toUpperCase()] = 'service';\n        });\n    }\n});\nflow.set('tagsObj',guidObj);\nflow.set('serviceTagsObj',serviceTagsObj);\nmsg.payload = {guidObj: guidObj, serviceTagsObj: serviceTagsObj};\nreturn msg;","outputs":1,"noerr":0,"x":1440,"y":60,"wires":[["c3560143.b3937"]]},{"id":"2747bde5.e1afb2","type":"debug","z":"6280a9fb.c72548","name":"NewTagsObjFromAccessTable","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","x":1500,"y":100,"wires":[]},{"id":"38357f8f.57e4e","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":280,"wires":[]},{"id":"d3cf2399.a80d6","type":"function","z":"6280a9fb.c72548","name":"check infrared state","func":"var serviceTagsObj = flow.get('serviceTagsObj');\nmsg.do = false;\nmsg.tag = {tagID: 'fc-7a-cd-63'};\nif(serviceTagsObj[msg.tag.tagID.toUpperCase()] === 'service'){\n    msg.do = true;\n}\nmsg.testRes = serviceTagsObj[msg.tag.tagID.toUpperCase()];\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1200,"wires":[["892fdc3c.862b1"]]},{"id":"44e7195e.f579e8","type":"inject","z":"6280a9fb.c72548","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":200,"y":1200,"wires":[["d3cf2399.a80d6","a6c0acd6.695e3"]]},{"id":"892fdc3c.862b1","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":590,"y":1200,"wires":[]},{"id":"a6c0acd6.695e3","type":"function","z":"6280a9fb.c72548","name":"check infrared state","func":"var payload = {\n    'infraredstate1':0,\n    'infraredstate2':0\n}\nvar infraredtimeout = flow.get('infraredtimeout');\nvar cDate = new Date();\nif ((cDate - global.get('infraredstate1Date')) < infraredtimeout){\n    payload.infraredstate1 = global.get('infraredstate1') ;   \n}\n\nif ((cDate - global.get('infraredstate2Date')) < infraredtimeout){\n    payload.infraredstate2 = global.get('infraredstate2') ;   \n}\n\nmsg.infraredstate1 = Number(payload.infraredstate1.substring(0,1));\nmsg.infraredstate2 = Number(payload.infraredstate2.substring(0,1));\nmsg.perimetr = (msg.infraredstate1 == 1 && msg.infraredstate2 == 1);\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1260,"wires":[["fd26dda5.964e4"]]},{"id":"fd26dda5.964e4","type":"debug","z":"6280a9fb.c72548","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":590,"y":1260,"wires":[]},{"id":"d3051d11.f37e3","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":840,"y":220,"wires":[]},{"id":"e7519367.f34d2","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1030,"y":240,"wires":[]},{"id":"85bcd7cb.238288","type":"debug","z":"6280a9fb.c72548","name":"ScanCard","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"elk_log","x":470,"y":420,"wires":[]},{"id":"c3560143.b3937","type":"json","z":"6280a9fb.c72548","name":"","property":"payload","action":"","pretty":false,"x":1590,"y":60,"wires":[["2747bde5.e1afb2"]]},{"id":"bfc06df2.957","type":"debug","z":"6280a9fb.c72548","name":"SOVA URL","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"url","x":1800,"y":280,"wires":[]},{"id":"35e1c693.b946ba","type":"debug","z":"6280a9fb.c72548","name":"TruckNumberParseService","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"paylaod","x":2020,"y":760,"wires":[]},{"id":"47a7459b.c5b07c","type":"debug","z":"10d39a76.2386c6","name":"rfid_out","active":false,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","x":380,"y":260,"wires":[]},{"id":"8c1da3fd.2a15e","type":"debug","z":"10d39a76.2386c6","name":"rfid_in","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","x":380,"y":60,"wires":[]},{"id":"af64abbd.b4d8f8","type":"debug","z":"10d39a76.2386c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":300,"y":340,"wires":[]},{"id":"fc3f570c.990b78","type":"inject","z":"10d39a76.2386c6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[126,25,0,100]","payloadType":"bin","x":110,"y":300,"wires":[["8ca72b1f.9c4a58"]]},{"id":"6454c582.0839dc","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":950,"y":920,"wires":[]},{"id":"877bbcdc.ec59d","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1560,"y":220,"wires":[]},{"id":"c9682405.69b478","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1430,"y":880,"wires":[]},{"id":"1eb6e1fd.2f40ae","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1550,"y":800,"wires":[]},{"id":"753294ac.f81b7c","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1170,"y":900,"wires":[]},{"id":"4eda620d.6547ec","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1270,"y":800,"wires":[]},{"id":"9bb5dd3e.52c4e","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1610,"y":280,"wires":[]},{"id":"d9b6c86c.dda078","type":"inject","z":"6280a9fb.c72548","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":210,"y":960,"wires":[["a4ff8619.940088"]]},{"id":"a4ff8619.940088","type":"function","z":"6280a9fb.c72548","name":"","func":"flow.set('access_granted',false);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":960,"wires":[[]]},{"id":"dbc79ba.9b9fe68","type":"inject","z":"6280a9fb.c72548","name":"","props":[{"p":"payload"},{"p":"url","v":"host1C","vt":"flow"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[{\"tagID\":\"2e-e1-c3-44\",\"lastSeenTimestampUTC\":\"2020-07-30T05:36:52.656Z\",\"ip\":\"NFC_in\",\"antenna\":\"1\",\"antennaID\":\"1\",\"direction\":\"IN\",\"weight\":{\"weight\":80,\"status\":true,\"stable\":true,\"perimetr\":0}}]","payloadType":"json","x":2160,"y":620,"wires":[["4bb16f1.38d299"]]},{"id":"80c8e30c.d3f78","type":"debug","z":"6280a9fb.c72548","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":370,"y":760,"wires":[]}]
